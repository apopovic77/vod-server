(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function IR(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var a1={exports:{}},Iy={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mL;function qQ(){if(mL)return Iy;mL=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,r){var a=null;if(r!==void 0&&(a=""+r),i.key!==void 0&&(a=""+i.key),"key"in i){r={};for(var o in i)o!=="key"&&(r[o]=i[o])}else r=i;return i=r.ref,{$$typeof:s,type:n,key:a,ref:i!==void 0?i:null,props:r}}return Iy.Fragment=e,Iy.jsx=t,Iy.jsxs=t,Iy}var gL;function KQ(){return gL||(gL=1,a1.exports=qQ()),a1.exports}var G=KQ(),o1={exports:{}},Bn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AL;function YQ(){if(AL)return Bn;AL=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;function p(K){return K===null||typeof K!="object"?null:(K=f&&K[f]||K["@@iterator"],typeof K=="function"?K:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,x={};function E(K,te,oe){this.props=K,this.context=te,this.refs=x,this.updater=oe||g}E.prototype.isReactComponent={},E.prototype.setState=function(K,te){if(typeof K!="object"&&typeof K!="function"&&K!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,K,te,"setState")},E.prototype.forceUpdate=function(K){this.updater.enqueueForceUpdate(this,K,"forceUpdate")};function _(){}_.prototype=E.prototype;function b(K,te,oe){this.props=K,this.context=te,this.refs=x,this.updater=oe||g}var C=b.prototype=new _;C.constructor=b,y(C,E.prototype),C.isPureReactComponent=!0;var I=Array.isArray,M={H:null,A:null,T:null,S:null,V:null},R=Object.prototype.hasOwnProperty;function D(K,te,oe,Ee,Ce,se){return oe=se.ref,{$$typeof:s,type:K,key:te,ref:oe!==void 0?oe:null,props:se}}function P(K,te){return D(K.type,te,void 0,void 0,void 0,K.props)}function L(K){return typeof K=="object"&&K!==null&&K.$$typeof===s}function O(K){var te={"=":"=0",":":"=2"};return"$"+K.replace(/[=:]/g,function(oe){return te[oe]})}var U=/\/+/g;function j(K,te){return typeof K=="object"&&K!==null&&K.key!=null?O(""+K.key):te.toString(36)}function H(){}function z(K){switch(K.status){case"fulfilled":return K.value;case"rejected":throw K.reason;default:switch(typeof K.status=="string"?K.then(H,H):(K.status="pending",K.then(function(te){K.status==="pending"&&(K.status="fulfilled",K.value=te)},function(te){K.status==="pending"&&(K.status="rejected",K.reason=te)})),K.status){case"fulfilled":return K.value;case"rejected":throw K.reason}}throw K}function q(K,te,oe,Ee,Ce){var se=typeof K;(se==="undefined"||se==="boolean")&&(K=null);var ie=!1;if(K===null)ie=!0;else switch(se){case"bigint":case"string":case"number":ie=!0;break;case"object":switch(K.$$typeof){case s:case e:ie=!0;break;case h:return ie=K._init,q(ie(K._payload),te,oe,Ee,Ce)}}if(ie)return Ce=Ce(K),ie=Ee===""?"."+j(K,0):Ee,I(Ce)?(oe="",ie!=null&&(oe=ie.replace(U,"$&/")+"/"),q(Ce,te,oe,"",function(Be){return Be})):Ce!=null&&(L(Ce)&&(Ce=P(Ce,oe+(Ce.key==null||K&&K.key===Ce.key?"":(""+Ce.key).replace(U,"$&/")+"/")+ie)),te.push(Ce)),1;ie=0;var ne=Ee===""?".":Ee+":";if(I(K))for(var re=0;re<K.length;re++)Ee=K[re],se=ne+j(Ee,re),ie+=q(Ee,te,oe,se,Ce);else if(re=p(K),typeof re=="function")for(K=re.call(K),re=0;!(Ee=K.next()).done;)Ee=Ee.value,se=ne+j(Ee,re++),ie+=q(Ee,te,oe,se,Ce);else if(se==="object"){if(typeof K.then=="function")return q(z(K),te,oe,Ee,Ce);throw te=String(K),Error("Objects are not valid as a React child (found: "+(te==="[object Object]"?"object with keys {"+Object.keys(K).join(", ")+"}":te)+"). If you meant to render a collection of children, use an array instead.")}return ie}function k(K,te,oe){if(K==null)return K;var Ee=[],Ce=0;return q(K,Ee,"","",function(se){return te.call(oe,se,Ce++)}),Ee}function W(K){if(K._status===-1){var te=K._result;te=te(),te.then(function(oe){(K._status===0||K._status===-1)&&(K._status=1,K._result=oe)},function(oe){(K._status===0||K._status===-1)&&(K._status=2,K._result=oe)}),K._status===-1&&(K._status=0,K._result=te)}if(K._status===1)return K._result.default;throw K._result}var V=typeof reportError=="function"?reportError:function(K){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var te=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof K=="object"&&K!==null&&typeof K.message=="string"?String(K.message):String(K),error:K});if(!window.dispatchEvent(te))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",K);return}console.error(K)};function X(){}return Bn.Children={map:k,forEach:function(K,te,oe){k(K,function(){te.apply(this,arguments)},oe)},count:function(K){var te=0;return k(K,function(){te++}),te},toArray:function(K){return k(K,function(te){return te})||[]},only:function(K){if(!L(K))throw Error("React.Children.only expected to receive a single React element child.");return K}},Bn.Component=E,Bn.Fragment=t,Bn.Profiler=i,Bn.PureComponent=b,Bn.StrictMode=n,Bn.Suspense=l,Bn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,Bn.__COMPILER_RUNTIME={__proto__:null,c:function(K){return M.H.useMemoCache(K)}},Bn.cache=function(K){return function(){return K.apply(null,arguments)}},Bn.cloneElement=function(K,te,oe){if(K==null)throw Error("The argument must be a React element, but you passed "+K+".");var Ee=y({},K.props),Ce=K.key,se=void 0;if(te!=null)for(ie in te.ref!==void 0&&(se=void 0),te.key!==void 0&&(Ce=""+te.key),te)!R.call(te,ie)||ie==="key"||ie==="__self"||ie==="__source"||ie==="ref"&&te.ref===void 0||(Ee[ie]=te[ie]);var ie=arguments.length-2;if(ie===1)Ee.children=oe;else if(1<ie){for(var ne=Array(ie),re=0;re<ie;re++)ne[re]=arguments[re+2];Ee.children=ne}return D(K.type,Ce,void 0,void 0,se,Ee)},Bn.createContext=function(K){return K={$$typeof:a,_currentValue:K,_currentValue2:K,_threadCount:0,Provider:null,Consumer:null},K.Provider=K,K.Consumer={$$typeof:r,_context:K},K},Bn.createElement=function(K,te,oe){var Ee,Ce={},se=null;if(te!=null)for(Ee in te.key!==void 0&&(se=""+te.key),te)R.call(te,Ee)&&Ee!=="key"&&Ee!=="__self"&&Ee!=="__source"&&(Ce[Ee]=te[Ee]);var ie=arguments.length-2;if(ie===1)Ce.children=oe;else if(1<ie){for(var ne=Array(ie),re=0;re<ie;re++)ne[re]=arguments[re+2];Ce.children=ne}if(K&&K.defaultProps)for(Ee in ie=K.defaultProps,ie)Ce[Ee]===void 0&&(Ce[Ee]=ie[Ee]);return D(K,se,void 0,void 0,null,Ce)},Bn.createRef=function(){return{current:null}},Bn.forwardRef=function(K){return{$$typeof:o,render:K}},Bn.isValidElement=L,Bn.lazy=function(K){return{$$typeof:h,_payload:{_status:-1,_result:K},_init:W}},Bn.memo=function(K,te){return{$$typeof:c,type:K,compare:te===void 0?null:te}},Bn.startTransition=function(K){var te=M.T,oe={};M.T=oe;try{var Ee=K(),Ce=M.S;Ce!==null&&Ce(oe,Ee),typeof Ee=="object"&&Ee!==null&&typeof Ee.then=="function"&&Ee.then(X,V)}catch(se){V(se)}finally{M.T=te}},Bn.unstable_useCacheRefresh=function(){return M.H.useCacheRefresh()},Bn.use=function(K){return M.H.use(K)},Bn.useActionState=function(K,te,oe){return M.H.useActionState(K,te,oe)},Bn.useCallback=function(K,te){return M.H.useCallback(K,te)},Bn.useContext=function(K){return M.H.useContext(K)},Bn.useDebugValue=function(){},Bn.useDeferredValue=function(K,te){return M.H.useDeferredValue(K,te)},Bn.useEffect=function(K,te,oe){var Ee=M.H;if(typeof oe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Ee.useEffect(K,te)},Bn.useId=function(){return M.H.useId()},Bn.useImperativeHandle=function(K,te,oe){return M.H.useImperativeHandle(K,te,oe)},Bn.useInsertionEffect=function(K,te){return M.H.useInsertionEffect(K,te)},Bn.useLayoutEffect=function(K,te){return M.H.useLayoutEffect(K,te)},Bn.useMemo=function(K,te){return M.H.useMemo(K,te)},Bn.useOptimistic=function(K,te){return M.H.useOptimistic(K,te)},Bn.useReducer=function(K,te,oe){return M.H.useReducer(K,te,oe)},Bn.useRef=function(K){return M.H.useRef(K)},Bn.useState=function(K){return M.H.useState(K)},Bn.useSyncExternalStore=function(K,te,oe){return M.H.useSyncExternalStore(K,te,oe)},Bn.useTransition=function(){return M.H.useTransition()},Bn.version="19.1.1",Bn}var yL;function t0(){return yL||(yL=1,o1.exports=YQ()),o1.exports}var ee=t0();const sA=IR(ee);var l1={exports:{}},My={},c1={exports:{}},u1={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vL;function XQ(){return vL||(vL=1,(function(s){function e(k,W){var V=k.length;k.push(W);e:for(;0<V;){var X=V-1>>>1,K=k[X];if(0<i(K,W))k[X]=W,k[V]=K,V=X;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var W=k[0],V=k.pop();if(V!==W){k[0]=V;e:for(var X=0,K=k.length,te=K>>>1;X<te;){var oe=2*(X+1)-1,Ee=k[oe],Ce=oe+1,se=k[Ce];if(0>i(Ee,V))Ce<K&&0>i(se,Ee)?(k[X]=se,k[Ce]=V,X=Ce):(k[X]=Ee,k[oe]=V,X=oe);else if(Ce<K&&0>i(se,V))k[X]=se,k[Ce]=V,X=Ce;else break e}}return W}function i(k,W){var V=k.sortIndex-W.sortIndex;return V!==0?V:k.id-W.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;s.unstable_now=function(){return r.now()}}else{var a=Date,o=a.now();s.unstable_now=function(){return a.now()-o}}var l=[],c=[],h=1,f=null,p=3,g=!1,y=!1,x=!1,E=!1,_=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function I(k){for(var W=t(c);W!==null;){if(W.callback===null)n(c);else if(W.startTime<=k)n(c),W.sortIndex=W.expirationTime,e(l,W);else break;W=t(c)}}function M(k){if(x=!1,I(k),!y)if(t(l)!==null)y=!0,R||(R=!0,j());else{var W=t(c);W!==null&&q(M,W.startTime-k)}}var R=!1,D=-1,P=5,L=-1;function O(){return E?!0:!(s.unstable_now()-L<P)}function U(){if(E=!1,R){var k=s.unstable_now();L=k;var W=!0;try{e:{y=!1,x&&(x=!1,b(D),D=-1),g=!0;var V=p;try{t:{for(I(k),f=t(l);f!==null&&!(f.expirationTime>k&&O());){var X=f.callback;if(typeof X=="function"){f.callback=null,p=f.priorityLevel;var K=X(f.expirationTime<=k);if(k=s.unstable_now(),typeof K=="function"){f.callback=K,I(k),W=!0;break t}f===t(l)&&n(l),I(k)}else n(l);f=t(l)}if(f!==null)W=!0;else{var te=t(c);te!==null&&q(M,te.startTime-k),W=!1}}break e}finally{f=null,p=V,g=!1}W=void 0}}finally{W?j():R=!1}}}var j;if(typeof C=="function")j=function(){C(U)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,z=H.port2;H.port1.onmessage=U,j=function(){z.postMessage(null)}}else j=function(){_(U,0)};function q(k,W){D=_(function(){k(s.unstable_now())},W)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(k){k.callback=null},s.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<k?Math.floor(1e3/k):5},s.unstable_getCurrentPriorityLevel=function(){return p},s.unstable_next=function(k){switch(p){case 1:case 2:case 3:var W=3;break;default:W=p}var V=p;p=W;try{return k()}finally{p=V}},s.unstable_requestPaint=function(){E=!0},s.unstable_runWithPriority=function(k,W){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var V=p;p=k;try{return W()}finally{p=V}},s.unstable_scheduleCallback=function(k,W,V){var X=s.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?X+V:X):V=X,k){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=V+K,k={id:h++,callback:W,priorityLevel:k,startTime:V,expirationTime:K,sortIndex:-1},V>X?(k.sortIndex=V,e(c,k),t(l)===null&&k===t(c)&&(x?(b(D),D=-1):x=!0,q(M,V-X))):(k.sortIndex=K,e(l,k),y||g||(y=!0,R||(R=!0,j()))),k},s.unstable_shouldYield=O,s.unstable_wrapCallback=function(k){var W=p;return function(){var V=p;p=W;try{return k.apply(this,arguments)}finally{p=V}}}})(u1)),u1}var EL;function WQ(){return EL||(EL=1,c1.exports=XQ()),c1.exports}var h1={exports:{}},Wr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xL;function $Q(){if(xL)return Wr;xL=1;var s=t0();function e(l){var c="https://react.dev/errors/"+l;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)c+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+l+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function r(l,c,h){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:f==null?null:""+f,children:l,containerInfo:c,implementation:h}}var a=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(l,c){if(l==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return Wr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Wr.createPortal=function(l,c){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(e(299));return r(l,c,null,h)},Wr.flushSync=function(l){var c=a.T,h=n.p;try{if(a.T=null,n.p=2,l)return l()}finally{a.T=c,n.p=h,n.d.f()}},Wr.preconnect=function(l,c){typeof l=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,n.d.C(l,c))},Wr.prefetchDNS=function(l){typeof l=="string"&&n.d.D(l)},Wr.preinit=function(l,c){if(typeof l=="string"&&c&&typeof c.as=="string"){var h=c.as,f=o(h,c.crossOrigin),p=typeof c.integrity=="string"?c.integrity:void 0,g=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;h==="style"?n.d.S(l,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:f,integrity:p,fetchPriority:g}):h==="script"&&n.d.X(l,{crossOrigin:f,integrity:p,fetchPriority:g,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},Wr.preinitModule=function(l,c){if(typeof l=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var h=o(c.as,c.crossOrigin);n.d.M(l,{crossOrigin:h,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&n.d.M(l)},Wr.preload=function(l,c){if(typeof l=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var h=c.as,f=o(h,c.crossOrigin);n.d.L(l,h,{crossOrigin:f,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},Wr.preloadModule=function(l,c){if(typeof l=="string")if(c){var h=o(c.as,c.crossOrigin);n.d.m(l,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:h,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else n.d.m(l)},Wr.requestFormReset=function(l){n.d.r(l)},Wr.unstable_batchedUpdates=function(l,c){return l(c)},Wr.useFormState=function(l,c,h){return a.H.useFormState(l,c,h)},Wr.useFormStatus=function(){return a.H.useHostTransitionStatus()},Wr.version="19.1.1",Wr}var _L;function JQ(){if(_L)return h1.exports;_L=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),h1.exports=$Q(),h1.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SL;function ZQ(){if(SL)return My;SL=1;var s=WQ(),e=t0(),t=JQ();function n(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)d+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function r(u){var d=u,v=u;if(u.alternate)for(;d.return;)d=d.return;else{u=d;do d=u,(d.flags&4098)!==0&&(v=d.return),u=d.return;while(u)}return d.tag===3?v:null}function a(u){if(u.tag===13){var d=u.memoizedState;if(d===null&&(u=u.alternate,u!==null&&(d=u.memoizedState)),d!==null)return d.dehydrated}return null}function o(u){if(r(u)!==u)throw Error(n(188))}function l(u){var d=u.alternate;if(!d){if(d=r(u),d===null)throw Error(n(188));return d!==u?null:u}for(var v=u,S=d;;){var w=v.return;if(w===null)break;var N=w.alternate;if(N===null){if(S=w.return,S!==null){v=S;continue}break}if(w.child===N.child){for(N=w.child;N;){if(N===v)return o(w),u;if(N===S)return o(w),d;N=N.sibling}throw Error(n(188))}if(v.return!==S.return)v=w,S=N;else{for(var $=!1,le=w.child;le;){if(le===v){$=!0,v=w,S=N;break}if(le===S){$=!0,S=w,v=N;break}le=le.sibling}if(!$){for(le=N.child;le;){if(le===v){$=!0,v=N,S=w;break}if(le===S){$=!0,S=N,v=w;break}le=le.sibling}if(!$)throw Error(n(189))}}if(v.alternate!==S)throw Error(n(190))}if(v.tag!==3)throw Error(n(188));return v.stateNode.current===v?u:d}function c(u){var d=u.tag;if(d===5||d===26||d===27||d===6)return u;for(u=u.child;u!==null;){if(d=c(u),d!==null)return d;u=u.sibling}return null}var h=Object.assign,f=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),b=Symbol.for("react.consumer"),C=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),L=Symbol.for("react.activity"),O=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function j(u){return u===null||typeof u!="object"?null:(u=U&&u[U]||u["@@iterator"],typeof u=="function"?u:null)}var H=Symbol.for("react.client.reference");function z(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===H?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case y:return"Fragment";case E:return"Profiler";case x:return"StrictMode";case M:return"Suspense";case R:return"SuspenseList";case L:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case g:return"Portal";case C:return(u.displayName||"Context")+".Provider";case b:return(u._context.displayName||"Context")+".Consumer";case I:var d=u.render;return u=u.displayName,u||(u=d.displayName||d.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case D:return d=u.displayName||null,d!==null?d:z(u.type)||"Memo";case P:d=u._payload,u=u._init;try{return z(u(d))}catch{}}return null}var q=Array.isArray,k=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V={pending:!1,data:null,method:null,action:null},X=[],K=-1;function te(u){return{current:u}}function oe(u){0>K||(u.current=X[K],X[K]=null,K--)}function Ee(u,d){K++,X[K]=u.current,u.current=d}var Ce=te(null),se=te(null),ie=te(null),ne=te(null);function re(u,d){switch(Ee(ie,d),Ee(se,u),Ee(Ce,null),d.nodeType){case 9:case 11:u=(u=d.documentElement)&&(u=u.namespaceURI)?QD(u):0;break;default:if(u=d.tagName,d=d.namespaceURI)d=QD(d),u=VD(d,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}oe(Ce),Ee(Ce,u)}function Be(){oe(Ce),oe(se),oe(ie)}function Ge(u){u.memoizedState!==null&&Ee(ne,u);var d=Ce.current,v=VD(d,u.type);d!==v&&(Ee(se,u),Ee(Ce,v))}function Ue(u){se.current===u&&(oe(Ce),oe(se)),ne.current===u&&(oe(ne),_y._currentValue=V)}var nt=Object.prototype.hasOwnProperty,pe=s.unstable_scheduleCallback,ve=s.unstable_cancelCallback,Ae=s.unstable_shouldYield,Se=s.unstable_requestPaint,be=s.unstable_now,Re=s.unstable_getCurrentPriorityLevel,me=s.unstable_ImmediatePriority,ue=s.unstable_UserBlockingPriority,$e=s.unstable_NormalPriority,gt=s.unstable_LowPriority,ge=s.unstable_IdlePriority,ae=s.log,Pe=s.unstable_setDisableYieldValue,Ve=null,rt=null;function et(u){if(typeof ae=="function"&&Pe(u),rt&&typeof rt.setStrictMode=="function")try{rt.setStrictMode(Ve,u)}catch{}}var Mt=Math.clz32?Math.clz32:Gt,Et=Math.log,Rt=Math.LN2;function Gt(u){return u>>>=0,u===0?32:31-(Et(u)/Rt|0)|0}var pt=256,At=4194304;function Qt(u){var d=u&42;if(d!==0)return d;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function Ut(u,d,v){var S=u.pendingLanes;if(S===0)return 0;var w=0,N=u.suspendedLanes,$=u.pingedLanes;u=u.warmLanes;var le=S&134217727;return le!==0?(S=le&~N,S!==0?w=Qt(S):($&=le,$!==0?w=Qt($):v||(v=le&~u,v!==0&&(w=Qt(v))))):(le=S&~N,le!==0?w=Qt(le):$!==0?w=Qt($):v||(v=S&~u,v!==0&&(w=Qt(v)))),w===0?0:d!==0&&d!==w&&(d&N)===0&&(N=w&-w,v=d&-d,N>=v||N===32&&(v&4194048)!==0)?d:w}function vt(u,d){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&d)===0}function Vt(u,d){switch(u){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Oe(){var u=pt;return pt<<=1,(pt&4194048)===0&&(pt=256),u}function Qe(){var u=At;return At<<=1,(At&62914560)===0&&(At=4194304),u}function St(u){for(var d=[],v=0;31>v;v++)d.push(u);return d}function Nt(u,d){u.pendingLanes|=d,d!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function yt(u,d,v,S,w,N){var $=u.pendingLanes;u.pendingLanes=v,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=v,u.entangledLanes&=v,u.errorRecoveryDisabledLanes&=v,u.shellSuspendCounter=0;var le=u.entanglements,Te=u.expirationTimes,je=u.hiddenUpdates;for(v=$&~v;0<v;){var ct=31-Mt(v),mt=1<<ct;le[ct]=0,Te[ct]=-1;var Xe=je[ct];if(Xe!==null)for(je[ct]=null,ct=0;ct<Xe.length;ct++){var Je=Xe[ct];Je!==null&&(Je.lane&=-536870913)}v&=~mt}S!==0&&dt(u,S,0),N!==0&&w===0&&u.tag!==0&&(u.suspendedLanes|=N&~($&~d))}function dt(u,d,v){u.pendingLanes|=d,u.suspendedLanes&=~d;var S=31-Mt(d);u.entangledLanes|=d,u.entanglements[S]=u.entanglements[S]|1073741824|v&4194090}function zt(u,d){var v=u.entangledLanes|=d;for(u=u.entanglements;v;){var S=31-Mt(v),w=1<<S;w&d|u[S]&d&&(u[S]|=d),v&=~w}}function tn(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function Un(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function Ln(){var u=W.p;return u!==0?u:(u=window.event,u===void 0?32:cL(u.type))}function Hr(u,d){var v=W.p;try{return W.p=u,d()}finally{W.p=v}}var $i=Math.random().toString(36).slice(2),Ji="__reactFiber$"+$i,Ti="__reactProps$"+$i,Zs="__reactContainer$"+$i,Cr="__reactEvents$"+$i,fo="__reactListeners$"+$i,Ts="__reactHandles$"+$i,an="__reactResources$"+$i,mr="__reactMarker$"+$i;function pi(u){delete u[Ji],delete u[Ti],delete u[Cr],delete u[fo],delete u[Ts]}function Z(u){var d=u[Ji];if(d)return d;for(var v=u.parentNode;v;){if(d=v[Zs]||v[Ji]){if(v=d.alternate,d.child!==null||v!==null&&v.child!==null)for(u=YD(u);u!==null;){if(v=u[Ji])return v;u=YD(u)}return d}u=v,v=u.parentNode}return null}function fe(u){if(u=u[Ji]||u[Zs]){var d=u.tag;if(d===5||d===6||d===13||d===26||d===27||d===3)return u}return null}function we(u){var d=u.tag;if(d===5||d===26||d===27||d===6)return u.stateNode;throw Error(n(33))}function qe(u){var d=u[an];return d||(d=u[an]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function Ye(u){u[mr]=!0}var it=new Set,xt={};function J(u,d){ye(u,d),ye(u+"Capture",d)}function ye(u,d){for(xt[u]=d,u=0;u<d.length;u++)it.add(d[u])}var _e=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Me={},xe={};function ht(u){return nt.call(xe,u)?!0:nt.call(Me,u)?!1:_e.test(u)?xe[u]=!0:(Me[u]=!0,!1)}function tt(u,d,v){if(ht(d))if(v===null)u.removeAttribute(d);else{switch(typeof v){case"undefined":case"function":case"symbol":u.removeAttribute(d);return;case"boolean":var S=d.toLowerCase().slice(0,5);if(S!=="data-"&&S!=="aria-"){u.removeAttribute(d);return}}u.setAttribute(d,""+v)}}function at(u,d,v){if(v===null)u.removeAttribute(d);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(d);return}u.setAttribute(d,""+v)}}function ot(u,d,v,S){if(S===null)u.removeAttribute(v);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(v);return}u.setAttributeNS(d,v,""+S)}}var _t,wt;function It(u){if(_t===void 0)try{throw Error()}catch(v){var d=v.stack.trim().match(/\n( *(at )?)/);_t=d&&d[1]||"",wt=-1<v.stack.indexOf(`
    at`)?" (<anonymous>)":-1<v.stack.indexOf("@")?"@unknown:0:0":""}return`
`+_t+u+wt}var Kt=!1;function on(u,d){if(!u||Kt)return"";Kt=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var S={DetermineComponentFrameRoot:function(){try{if(d){var mt=function(){throw Error()};if(Object.defineProperty(mt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(mt,[])}catch(Je){var Xe=Je}Reflect.construct(u,[],mt)}else{try{mt.call()}catch(Je){Xe=Je}u.call(mt.prototype)}}else{try{throw Error()}catch(Je){Xe=Je}(mt=u())&&typeof mt.catch=="function"&&mt.catch(function(){})}}catch(Je){if(Je&&Xe&&typeof Je.stack=="string")return[Je.stack,Xe.stack]}return[null,null]}};S.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(S.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(S.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var N=S.DetermineComponentFrameRoot(),$=N[0],le=N[1];if($&&le){var Te=$.split(`
`),je=le.split(`
`);for(w=S=0;S<Te.length&&!Te[S].includes("DetermineComponentFrameRoot");)S++;for(;w<je.length&&!je[w].includes("DetermineComponentFrameRoot");)w++;if(S===Te.length||w===je.length)for(S=Te.length-1,w=je.length-1;1<=S&&0<=w&&Te[S]!==je[w];)w--;for(;1<=S&&0<=w;S--,w--)if(Te[S]!==je[w]){if(S!==1||w!==1)do if(S--,w--,0>w||Te[S]!==je[w]){var ct=`
`+Te[S].replace(" at new "," at ");return u.displayName&&ct.includes("<anonymous>")&&(ct=ct.replace("<anonymous>",u.displayName)),ct}while(1<=S&&0<=w);break}}}finally{Kt=!1,Error.prepareStackTrace=v}return(v=u?u.displayName||u.name:"")?It(v):""}function nn(u){switch(u.tag){case 26:case 27:case 5:return It(u.type);case 16:return It("Lazy");case 13:return It("Suspense");case 19:return It("SuspenseList");case 0:case 15:return on(u.type,!1);case 11:return on(u.type.render,!1);case 1:return on(u.type,!0);case 31:return It("Activity");default:return""}}function Cn(u){try{var d="";do d+=nn(u),u=u.return;while(u);return d}catch(v){return`
Error generating stack: `+v.message+`
`+v.stack}}function Ht(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function Dt(u){var d=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function Vn(u){var d=Dt(u)?"checked":"value",v=Object.getOwnPropertyDescriptor(u.constructor.prototype,d),S=""+u[d];if(!u.hasOwnProperty(d)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var w=v.get,N=v.set;return Object.defineProperty(u,d,{configurable:!0,get:function(){return w.call(this)},set:function($){S=""+$,N.call(this,$)}}),Object.defineProperty(u,d,{enumerable:v.enumerable}),{getValue:function(){return S},setValue:function($){S=""+$},stopTracking:function(){u._valueTracker=null,delete u[d]}}}}function An(u){u._valueTracker||(u._valueTracker=Vn(u))}function ii(u){if(!u)return!1;var d=u._valueTracker;if(!d)return!0;var v=d.getValue(),S="";return u&&(S=Dt(u)?u.checked?"true":"false":u.value),u=S,u!==v?(d.setValue(u),!0):!1}function In(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var Yn=/[\n"\\]/g;function yn(u){return u.replace(Yn,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function $t(u,d,v,S,w,N,$,le){u.name="",$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"?u.type=$:u.removeAttribute("type"),d!=null?$==="number"?(d===0&&u.value===""||u.value!=d)&&(u.value=""+Ht(d)):u.value!==""+Ht(d)&&(u.value=""+Ht(d)):$!=="submit"&&$!=="reset"||u.removeAttribute("value"),d!=null?Oi(u,$,Ht(d)):v!=null?Oi(u,$,Ht(v)):S!=null&&u.removeAttribute("value"),w==null&&N!=null&&(u.defaultChecked=!!N),w!=null&&(u.checked=w&&typeof w!="function"&&typeof w!="symbol"),le!=null&&typeof le!="function"&&typeof le!="symbol"&&typeof le!="boolean"?u.name=""+Ht(le):u.removeAttribute("name")}function li(u,d,v,S,w,N,$,le){if(N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"&&(u.type=N),d!=null||v!=null){if(!(N!=="submit"&&N!=="reset"||d!=null))return;v=v!=null?""+Ht(v):"",d=d!=null?""+Ht(d):v,le||d===u.value||(u.value=d),u.defaultValue=d}S=S??w,S=typeof S!="function"&&typeof S!="symbol"&&!!S,u.checked=le?u.checked:!!S,u.defaultChecked=!!S,$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(u.name=$)}function Oi(u,d,v){d==="number"&&In(u.ownerDocument)===u||u.defaultValue===""+v||(u.defaultValue=""+v)}function Pn(u,d,v,S){if(u=u.options,d){d={};for(var w=0;w<v.length;w++)d["$"+v[w]]=!0;for(v=0;v<u.length;v++)w=d.hasOwnProperty("$"+u[v].value),u[v].selected!==w&&(u[v].selected=w),w&&S&&(u[v].defaultSelected=!0)}else{for(v=""+Ht(v),d=null,w=0;w<u.length;w++){if(u[w].value===v){u[w].selected=!0,S&&(u[w].defaultSelected=!0);return}d!==null||u[w].disabled||(d=u[w])}d!==null&&(d.selected=!0)}}function Ci(u,d,v){if(d!=null&&(d=""+Ht(d),d!==u.value&&(u.value=d),v==null)){u.defaultValue!==d&&(u.defaultValue=d);return}u.defaultValue=v!=null?""+Ht(v):""}function Du(u,d,v,S){if(d==null){if(S!=null){if(v!=null)throw Error(n(92));if(q(S)){if(1<S.length)throw Error(n(93));S=S[0]}v=S}v==null&&(v=""),d=v}v=Ht(d),u.defaultValue=v,S=u.textContent,S===v&&S!==""&&S!==null&&(u.value=S)}function Cs(u,d){if(d){var v=u.firstChild;if(v&&v===u.lastChild&&v.nodeType===3){v.nodeValue=d;return}}u.textContent=d}var UE=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Td(u,d,v){var S=d.indexOf("--")===0;v==null||typeof v=="boolean"||v===""?S?u.setProperty(d,""):d==="float"?u.cssFloat="":u[d]="":S?u.setProperty(d,v):typeof v!="number"||v===0||UE.has(d)?d==="float"?u.cssFloat=v:u[d]=(""+v).trim():u[d]=v+"px"}function Cd(u,d,v){if(d!=null&&typeof d!="object")throw Error(n(62));if(u=u.style,v!=null){for(var S in v)!v.hasOwnProperty(S)||d!=null&&d.hasOwnProperty(S)||(S.indexOf("--")===0?u.setProperty(S,""):S==="float"?u.cssFloat="":u[S]="");for(var w in d)S=d[w],d.hasOwnProperty(w)&&v[w]!==S&&Td(u,w,S)}else for(var N in d)d.hasOwnProperty(N)&&Td(u,N,d[N])}function Sm(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var p0=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),kE=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Id(u){return kE.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}var bm=null;function Tm(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var mc=null,Lu=null;function m0(u){var d=fe(u);if(d&&(u=d.stateNode)){var v=u[Ti]||null;e:switch(u=d.stateNode,d.type){case"input":if($t(u,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name),d=v.name,v.type==="radio"&&d!=null){for(v=u;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll('input[name="'+yn(""+d)+'"][type="radio"]'),d=0;d<v.length;d++){var S=v[d];if(S!==u&&S.form===u.form){var w=S[Ti]||null;if(!w)throw Error(n(90));$t(S,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(d=0;d<v.length;d++)S=v[d],S.form===u.form&&ii(S)}break e;case"textarea":Ci(u,v.value,v.defaultValue);break e;case"select":d=v.value,d!=null&&Pn(u,!!v.multiple,d,!1)}}}var Md=!1;function g0(u,d,v){if(Md)return u(d,v);Md=!0;try{var S=u(d);return S}finally{if(Md=!1,(mc!==null||Lu!==null)&&(rl(),mc&&(d=mc,u=Lu,Lu=mc=null,m0(d),u)))for(d=0;d<u.length;d++)m0(u[d])}}function Uh(u,d){var v=u.stateNode;if(v===null)return null;var S=v[Ti]||null;if(S===null)return null;v=S[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(u=u.type,S=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!S;break e;default:u=!1}if(u)return null;if(v&&typeof v!="function")throw Error(n(231,d,typeof v));return v}var Vo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wd=!1;if(Vo)try{var kh={};Object.defineProperty(kh,"passive",{get:function(){wd=!0}}),window.addEventListener("test",kh,kh),window.removeEventListener("test",kh,kh)}catch{wd=!1}var Il=null,A0=null,Cm=null;function y0(){if(Cm)return Cm;var u,d=A0,v=d.length,S,w="value"in Il?Il.value:Il.textContent,N=w.length;for(u=0;u<v&&d[u]===w[u];u++);var $=v-u;for(S=1;S<=$&&d[v-S]===w[N-S];S++);return Cm=w.slice(u,1<S?1-S:void 0)}function gc(u){var d=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&d===13&&(u=13)):u=d,u===10&&(u=13),32<=u||u===13?u:0}function Gh(){return!0}function Rd(){return!1}function Ir(u){function d(v,S,w,N,$){this._reactName=v,this._targetInst=w,this.type=S,this.nativeEvent=N,this.target=$,this.currentTarget=null;for(var le in u)u.hasOwnProperty(le)&&(v=u[le],this[le]=v?v(N):N[le]);return this.isDefaultPrevented=(N.defaultPrevented!=null?N.defaultPrevented:N.returnValue===!1)?Gh:Rd,this.isPropagationStopped=Rd,this}return h(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=Gh)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=Gh)},persist:function(){},isPersistent:Gh}),d}var Ac={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hh=Ir(Ac),zh=h({},Ac,{view:0,detail:0}),GE=Ir(zh),Ml,Qh,Vh,jh=h({},zh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Dd,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==Vh&&(Vh&&u.type==="mousemove"?(Ml=u.screenX-Vh.screenX,Qh=u.screenY-Vh.screenY):Qh=Ml=0,Vh=u),Ml)},movementY:function(u){return"movementY"in u?u.movementY:Qh}}),v0=Ir(jh),HE=h({},jh,{dataTransfer:0}),bC=Ir(HE),er=h({},zh,{relatedTarget:0}),Im=Ir(er),zE=h({},Ac,{animationName:0,elapsedTime:0,pseudoElement:0}),QE=Ir(zE),VE=h({},Ac,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),jE=Ir(VE),Bd=h({},Ac,{data:0}),Mm=Ir(Bd),qE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},KE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},YE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function E0(u){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(u):(u=YE[u])?!!d[u]:!1}function Dd(){return E0}var XE=h({},zh,{key:function(u){if(u.key){var d=qE[u.key]||u.key;if(d!=="Unidentified")return d}return u.type==="keypress"?(u=gc(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?KE[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Dd,charCode:function(u){return u.type==="keypress"?gc(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?gc(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),x0=Ir(XE),_0=h({},jh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wm=Ir(_0),WE=h({},zh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Dd}),S0=Ir(WE),$E=h({},Ac,{propertyName:0,elapsedTime:0,pseudoElement:0}),wl=Ir($E),b0=h({},jh,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),TC=Ir(b0),JE=h({},Ac,{newState:0,oldState:0}),yc=Ir(JE),Rl=[9,13,27,32],Ld=Vo&&"CompositionEvent"in window,Ou=null;Vo&&"documentMode"in document&&(Ou=document.documentMode);var Od=Vo&&"TextEvent"in window&&!Ou,Pd=Vo&&(!Ld||Ou&&8<Ou&&11>=Ou),vc=" ",tr=!1;function Nd(u,d){switch(u){case"keyup":return Rl.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function T0(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var Ec=!1;function Fd(u,d){switch(u){case"compositionend":return T0(d);case"keypress":return d.which!==32?null:(tr=!0,vc);case"textInput":return u=d.data,u===vc&&tr?null:u;default:return null}}function C0(u,d){if(Ec)return u==="compositionend"||!Ld&&Nd(u,d)?(u=y0(),Cm=A0=Il=null,Ec=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return Pd&&d.locale!=="ko"?null:d.data;default:return null}}var Rm={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function I0(u){var d=u&&u.nodeName&&u.nodeName.toLowerCase();return d==="input"?!!Rm[u.type]:d==="textarea"}function zr(u,d,v,S){mc?Lu?Lu.push(S):Lu=[S]:mc=S,d=$x(d,"onChange"),0<d.length&&(v=new Hh("onChange","change",null,v,S),u.push({event:v,listeners:d}))}var qh=null,Pu=null;function ZE(u){UD(u,0)}function Ud(u){var d=we(u);if(ii(d))return u}function Bm(u,d){if(u==="change")return d}var Dm=!1;if(Vo){var Lm;if(Vo){var Kh="oninput"in document;if(!Kh){var Yh=document.createElement("div");Yh.setAttribute("oninput","return;"),Kh=typeof Yh.oninput=="function"}Lm=Kh}else Lm=!1;Dm=Lm&&(!document.documentMode||9<document.documentMode)}function zi(){qh&&(qh.detachEvent("onpropertychange",ex),Pu=qh=null)}function ex(u){if(u.propertyName==="value"&&Ud(Pu)){var d=[];zr(d,Pu,u,Tm(u)),g0(ZE,d)}}function CC(u,d,v){u==="focusin"?(zi(),qh=d,Pu=v,qh.attachEvent("onpropertychange",ex)):u==="focusout"&&zi()}function tx(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return Ud(Pu)}function kd(u,d){if(u==="click")return Ud(d)}function xc(u,d){if(u==="input"||u==="change")return Ud(d)}function nx(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}var Qr=typeof Object.is=="function"?Object.is:nx;function po(u,d){if(Qr(u,d))return!0;if(typeof u!="object"||u===null||typeof d!="object"||d===null)return!1;var v=Object.keys(u),S=Object.keys(d);if(v.length!==S.length)return!1;for(S=0;S<v.length;S++){var w=v[S];if(!nt.call(d,w)||!Qr(u[w],d[w]))return!1}return!0}function Vr(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function M0(u,d){var v=Vr(u);u=0;for(var S;v;){if(v.nodeType===3){if(S=u+v.textContent.length,u<=d&&S>=d)return{node:v,offset:d-u};u=S}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=Vr(v)}}function w0(u,d){return u&&d?u===d?!0:u&&u.nodeType===3?!1:d&&d.nodeType===3?w0(u,d.parentNode):"contains"in u?u.contains(d):u.compareDocumentPosition?!!(u.compareDocumentPosition(d)&16):!1:!1}function R0(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var d=In(u.document);d instanceof u.HTMLIFrameElement;){try{var v=typeof d.contentWindow.location.href=="string"}catch{v=!1}if(v)u=d.contentWindow;else break;d=In(u.document)}return d}function Gd(u){var d=u&&u.nodeName&&u.nodeName.toLowerCase();return d&&(d==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||d==="textarea"||u.contentEditable==="true")}var B0=Vo&&"documentMode"in document&&11>=document.documentMode,Bl=null,Om=null,Hd=null,Pm=!1;function D0(u,d,v){var S=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;Pm||Bl==null||Bl!==In(S)||(S=Bl,"selectionStart"in S&&Gd(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),Hd&&po(Hd,S)||(Hd=S,S=$x(Om,"onSelect"),0<S.length&&(d=new Hh("onSelect","select",null,d,v),u.push({event:d,listeners:S}),d.target=Bl)))}function nr(u,d){var v={};return v[u.toLowerCase()]=d.toLowerCase(),v["Webkit"+u]="webkit"+d,v["Moz"+u]="moz"+d,v}var _c={animationend:nr("Animation","AnimationEnd"),animationiteration:nr("Animation","AnimationIteration"),animationstart:nr("Animation","AnimationStart"),transitionrun:nr("Transition","TransitionRun"),transitionstart:nr("Transition","TransitionStart"),transitioncancel:nr("Transition","TransitionCancel"),transitionend:nr("Transition","TransitionEnd")},Nm={},ix={};Vo&&(ix=document.createElement("div").style,"AnimationEvent"in window||(delete _c.animationend.animation,delete _c.animationiteration.animation,delete _c.animationstart.animation),"TransitionEvent"in window||delete _c.transitionend.transition);function Dl(u){if(Nm[u])return Nm[u];if(!_c[u])return u;var d=_c[u],v;for(v in d)if(d.hasOwnProperty(v)&&v in ix)return Nm[u]=d[v];return u}var Mr=Dl("animationend"),L0=Dl("animationiteration"),jr=Dl("animationstart"),sx=Dl("transitionrun"),Ll=Dl("transitionstart"),Xh=Dl("transitioncancel"),Ol=Dl("transitionend"),Fm=new Map,zd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");zd.push("scrollEnd");function Us(u,d){Fm.set(u,d),J(d,[u])}var O0=new WeakMap;function ir(u,d){if(typeof u=="object"&&u!==null){var v=O0.get(u);return v!==void 0?v:(d={value:u,source:d,stack:Cn(d)},O0.set(u,d),d)}return{value:u,source:d,stack:Cn(d)}}var gr=[],Ba=0,Um=0;function Qd(){for(var u=Ba,d=Um=Ba=0;d<u;){var v=gr[d];gr[d++]=null;var S=gr[d];gr[d++]=null;var w=gr[d];gr[d++]=null;var N=gr[d];if(gr[d++]=null,S!==null&&w!==null){var $=S.pending;$===null?w.next=w:(w.next=$.next,$.next=w),S.pending=w}N!==0&&P0(v,w,N)}}function Sc(u,d,v,S){gr[Ba++]=u,gr[Ba++]=d,gr[Ba++]=v,gr[Ba++]=S,Um|=S,u.lanes|=S,u=u.alternate,u!==null&&(u.lanes|=S)}function km(u,d,v,S){return Sc(u,d,v,S),Wh(u)}function Pl(u,d){return Sc(u,null,null,d),Wh(u)}function P0(u,d,v){u.lanes|=v;var S=u.alternate;S!==null&&(S.lanes|=v);for(var w=!1,N=u.return;N!==null;)N.childLanes|=v,S=N.alternate,S!==null&&(S.childLanes|=v),N.tag===22&&(u=N.stateNode,u===null||u._visibility&1||(w=!0)),u=N,N=N.return;return u.tag===3?(N=u.stateNode,w&&d!==null&&(w=31-Mt(v),u=N.hiddenUpdates,S=u[w],S===null?u[w]=[d]:S.push(d),d.lane=v|536870912),N):null}function Wh(u){if(50<sl)throw sl=0,Zu=null,Error(n(185));for(var d=u.return;d!==null;)u=d,d=u.return;return u.tag===3?u.stateNode:null}var bc={};function N0(u,d,v,S){this.tag=u,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qr(u,d,v,S){return new N0(u,d,v,S)}function Vd(u){return u=u.prototype,!(!u||!u.isReactComponent)}function as(u,d){var v=u.alternate;return v===null?(v=qr(u.tag,d,u.key,u.mode),v.elementType=u.elementType,v.type=u.type,v.stateNode=u.stateNode,v.alternate=u,u.alternate=v):(v.pendingProps=d,v.type=u.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=u.flags&65011712,v.childLanes=u.childLanes,v.lanes=u.lanes,v.child=u.child,v.memoizedProps=u.memoizedProps,v.memoizedState=u.memoizedState,v.updateQueue=u.updateQueue,d=u.dependencies,v.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},v.sibling=u.sibling,v.index=u.index,v.ref=u.ref,v.refCleanup=u.refCleanup,v}function F0(u,d){u.flags&=65011714;var v=u.alternate;return v===null?(u.childLanes=0,u.lanes=d,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=v.childLanes,u.lanes=v.lanes,u.child=v.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=v.memoizedProps,u.memoizedState=v.memoizedState,u.updateQueue=v.updateQueue,u.type=v.type,d=v.dependencies,u.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),u}function ks(u,d,v,S,w,N){var $=0;if(S=u,typeof u=="function")Vd(u)&&($=1);else if(typeof u=="string")$=LQ(u,v,Ce.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case L:return u=qr(31,v,d,w),u.elementType=L,u.lanes=N,u;case y:return Tc(v.children,w,N,d);case x:$=8,w|=24;break;case E:return u=qr(12,v,d,w|2),u.elementType=E,u.lanes=N,u;case M:return u=qr(13,v,d,w),u.elementType=M,u.lanes=N,u;case R:return u=qr(19,v,d,w),u.elementType=R,u.lanes=N,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case _:case C:$=10;break e;case b:$=9;break e;case I:$=11;break e;case D:$=14;break e;case P:$=16,S=null;break e}$=29,v=Error(n(130,u===null?"null":typeof u,"")),S=null}return d=qr($,v,d,w),d.elementType=u,d.type=S,d.lanes=N,d}function Tc(u,d,v,S){return u=qr(7,u,S,d),u.lanes=v,u}function jd(u,d,v){return u=qr(6,u,null,d),u.lanes=v,u}function Gm(u,d,v){return d=qr(4,u.children!==null?u.children:[],u.key,d),d.lanes=v,d.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},d}var $h=[],Kr=0,qd=null,Jh=0,sr=[],la=0,Cc=null,jo=1,qo="";function Nl(u,d){$h[Kr++]=Jh,$h[Kr++]=qd,qd=u,Jh=d}function Hm(u,d,v){sr[la++]=jo,sr[la++]=qo,sr[la++]=Cc,Cc=u;var S=jo;u=qo;var w=32-Mt(S)-1;S&=~(1<<w),v+=1;var N=32-Mt(d)+w;if(30<N){var $=w-w%5;N=(S&(1<<$)-1).toString(32),S>>=$,w-=$,jo=1<<32-Mt(d)+w|v<<w|S,qo=N+u}else jo=1<<N|v<<w|S,qo=u}function U0(u){u.return!==null&&(Nl(u,1),Hm(u,1,0))}function k0(u){for(;u===qd;)qd=$h[--Kr],$h[Kr]=null,Jh=$h[--Kr],$h[Kr]=null;for(;u===Cc;)Cc=sr[--la],sr[la]=null,qo=sr[--la],sr[la]=null,jo=sr[--la],sr[la]=null}var wr=null,Vi=null,ti=!1,Da=null,ca=!1,zm=Error(n(519));function Ic(u){var d=Error(n(418,""));throw Nu(ir(d,u)),zm}function rx(u){var d=u.stateNode,v=u.type,S=u.memoizedProps;switch(d[Ji]=u,d[Ti]=S,v){case"dialog":jn("cancel",d),jn("close",d);break;case"iframe":case"object":case"embed":jn("load",d);break;case"video":case"audio":for(v=0;v<gy.length;v++)jn(gy[v],d);break;case"source":jn("error",d);break;case"img":case"image":case"link":jn("error",d),jn("load",d);break;case"details":jn("toggle",d);break;case"input":jn("invalid",d),li(d,S.value,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name,!0),An(d);break;case"select":jn("invalid",d);break;case"textarea":jn("invalid",d),Du(d,S.value,S.defaultValue,S.children),An(d)}v=S.children,typeof v!="string"&&typeof v!="number"&&typeof v!="bigint"||d.textContent===""+v||S.suppressHydrationWarning===!0||zD(d.textContent,v)?(S.popover!=null&&(jn("beforetoggle",d),jn("toggle",d)),S.onScroll!=null&&jn("scroll",d),S.onScrollEnd!=null&&jn("scrollend",d),S.onClick!=null&&(d.onclick=Jx),d=!0):d=!1,d||Ic(u)}function G0(u){for(wr=u.return;wr;)switch(wr.tag){case 5:case 13:ca=!1;return;case 27:case 3:ca=!0;return;default:wr=wr.return}}function mo(u){if(u!==wr)return!1;if(!ti)return G0(u),ti=!0,!1;var d=u.tag,v;if((v=d!==3&&d!==27)&&((v=d===5)&&(v=u.type,v=!(v!=="form"&&v!=="button")||qC(u.type,u.memoizedProps)),v=!v),v&&Vi&&Ic(u),G0(u),d===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(n(317));e:{for(u=u.nextSibling,d=0;u;){if(u.nodeType===8)if(v=u.data,v==="/$"){if(d===0){Vi=Wl(u.nextSibling);break e}d--}else v!=="$"&&v!=="$!"&&v!=="$?"||d++;u=u.nextSibling}Vi=null}}else d===27?(d=Vi,bf(u.type)?(u=WC,WC=null,Vi=u):Vi=d):Vi=wr?Wl(u.stateNode.nextSibling):null;return!0}function Zh(){Vi=wr=null,ti=!1}function si(){var u=Da;return u!==null&&(rn===null?rn=u:rn.push.apply(rn,u),Da=null),u}function Nu(u){Da===null?Da=[u]:Da.push(u)}var H0=te(null),Mc=null,Fl=null;function wc(u,d,v){Ee(H0,d._currentValue),d._currentValue=v}function Ul(u){u._currentValue=H0.current,oe(H0)}function z0(u,d,v){for(;u!==null;){var S=u.alternate;if((u.childLanes&d)!==d?(u.childLanes|=d,S!==null&&(S.childLanes|=d)):S!==null&&(S.childLanes&d)!==d&&(S.childLanes|=d),u===v)break;u=u.return}}function Kd(u,d,v,S){var w=u.child;for(w!==null&&(w.return=u);w!==null;){var N=w.dependencies;if(N!==null){var $=w.child;N=N.firstContext;e:for(;N!==null;){var le=N;N=w;for(var Te=0;Te<d.length;Te++)if(le.context===d[Te]){N.lanes|=v,le=N.alternate,le!==null&&(le.lanes|=v),z0(N.return,v,u),S||($=null);break e}N=le.next}}else if(w.tag===18){if($=w.return,$===null)throw Error(n(341));$.lanes|=v,N=$.alternate,N!==null&&(N.lanes|=v),z0($,v,u),$=null}else $=w.child;if($!==null)$.return=w;else for($=w;$!==null;){if($===u){$=null;break}if(w=$.sibling,w!==null){w.return=$.return,$=w;break}$=$.return}w=$}}function La(u,d,v,S){u=null;for(var w=d,N=!1;w!==null;){if(!N){if((w.flags&524288)!==0)N=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var $=w.alternate;if($===null)throw Error(n(387));if($=$.memoizedProps,$!==null){var le=w.type;Qr(w.pendingProps.value,$.value)||(u!==null?u.push(le):u=[le])}}else if(w===ne.current){if($=w.alternate,$===null)throw Error(n(387));$.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(u!==null?u.push(_y):u=[_y])}w=w.return}u!==null&&Kd(d,u,v,S),d.flags|=262144}function Yd(u){for(u=u.firstContext;u!==null;){if(!Qr(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function Ko(u){Mc=u,Fl=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function Zi(u){return Qm(Mc,u)}function Xd(u,d){return Mc===null&&Ko(u),Qm(u,d)}function Qm(u,d){var v=d._currentValue;if(d={context:d,memoizedValue:v,next:null},Fl===null){if(u===null)throw Error(n(308));Fl=d,u.dependencies={lanes:0,firstContext:d},u.flags|=524288}else Fl=Fl.next=d;return v}var Q0=typeof AbortController<"u"?AbortController:function(){var u=[],d=this.signal={aborted:!1,addEventListener:function(v,S){u.push(S)}};this.abort=function(){d.aborted=!0,u.forEach(function(v){return v()})}},IC=s.unstable_scheduleCallback,ax=s.unstable_NormalPriority,ys={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Vm(){return{controller:new Q0,data:new Map,refCount:0}}function ef(u){u.refCount--,u.refCount===0&&IC(ax,function(){u.controller.abort()})}var tf=null,Wd=0,_n=0,nf=null;function ua(u,d){if(tf===null){var v=tf=[];Wd=0,_n=FC(),nf={status:"pending",value:void 0,then:function(S){v.push(S)}}}return Wd++,d.then(jm,jm),d}function jm(){if(--Wd===0&&tf!==null){nf!==null&&(nf.status="fulfilled");var u=tf;tf=null,_n=0,nf=null;for(var d=0;d<u.length;d++)(0,u[d])()}}function MC(u,d){var v=[],S={status:"pending",value:null,reason:null,then:function(w){v.push(w)}};return u.then(function(){S.status="fulfilled",S.value=d;for(var w=0;w<v.length;w++)(0,v[w])(d)},function(w){for(S.status="rejected",S.reason=w,w=0;w<v.length;w++)(0,v[w])(void 0)}),S}var $d=k.S;k.S=function(u,d){typeof d=="object"&&d!==null&&typeof d.then=="function"&&ua(u,d),$d!==null&&$d(u,d)};var Oa=te(null);function Rc(){var u=Oa.current;return u!==null?u:vn.pooledCache}function Jd(u,d){d===null?Ee(Oa,Oa.current):Ee(Oa,d.pool)}function qm(){var u=Rc();return u===null?null:{parent:ys._currentValue,pool:u}}var Zd=Error(n(460)),V0=Error(n(474)),go=Error(n(542)),ep={then:function(){}};function Km(u){return u=u.status,u==="fulfilled"||u==="rejected"}function sf(){}function Ym(u,d,v){switch(v=u[v],v===void 0?u.push(d):v!==d&&(d.then(sf,sf),d=v),d.status){case"fulfilled":return d.value;case"rejected":throw u=d.reason,ox(u),u;default:if(typeof d.status=="string")d.then(sf,sf);else{if(u=vn,u!==null&&100<u.shellSuspendCounter)throw Error(n(482));u=d,u.status="pending",u.then(function(S){if(d.status==="pending"){var w=d;w.status="fulfilled",w.value=S}},function(S){if(d.status==="pending"){var w=d;w.status="rejected",w.reason=S}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw u=d.reason,ox(u),u}throw Pa=d,Zd}}var Pa=null;function j0(){if(Pa===null)throw Error(n(459));var u=Pa;return Pa=null,u}function ox(u){if(u===Zd||u===go)throw Error(n(483))}var kl=!1;function q0(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fn(u,d){u=u.updateQueue,d.updateQueue===u&&(d.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function Yo(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function Gl(u,d,v){var S=u.updateQueue;if(S===null)return null;if(S=S.shared,(ri&2)!==0){var w=S.pending;return w===null?d.next=d:(d.next=w.next,w.next=d),S.pending=d,d=Wh(u),P0(u,null,v),d}return Sc(u,S,d,v),Wh(u)}function Fu(u,d,v){if(d=d.updateQueue,d!==null&&(d=d.shared,(v&4194048)!==0)){var S=d.lanes;S&=u.pendingLanes,v|=S,d.lanes=v,zt(u,v)}}function rf(u,d){var v=u.updateQueue,S=u.alternate;if(S!==null&&(S=S.updateQueue,v===S)){var w=null,N=null;if(v=v.firstBaseUpdate,v!==null){do{var $={lane:v.lane,tag:v.tag,payload:v.payload,callback:null,next:null};N===null?w=N=$:N=N.next=$,v=v.next}while(v!==null);N===null?w=N=d:N=N.next=d}else w=N=d;v={baseState:S.baseState,firstBaseUpdate:w,lastBaseUpdate:N,shared:S.shared,callbacks:S.callbacks},u.updateQueue=v;return}u=v.lastBaseUpdate,u===null?v.firstBaseUpdate=d:u.next=d,v.lastBaseUpdate=d}var K0=!1;function tp(){if(K0){var u=nf;if(u!==null)throw u}}function af(u,d,v,S){K0=!1;var w=u.updateQueue;kl=!1;var N=w.firstBaseUpdate,$=w.lastBaseUpdate,le=w.shared.pending;if(le!==null){w.shared.pending=null;var Te=le,je=Te.next;Te.next=null,$===null?N=je:$.next=je,$=Te;var ct=u.alternate;ct!==null&&(ct=ct.updateQueue,le=ct.lastBaseUpdate,le!==$&&(le===null?ct.firstBaseUpdate=je:le.next=je,ct.lastBaseUpdate=Te))}if(N!==null){var mt=w.baseState;$=0,ct=je=Te=null,le=N;do{var Xe=le.lane&-536870913,Je=Xe!==le.lane;if(Je?(en&Xe)===Xe:(S&Xe)===Xe){Xe!==0&&Xe===_n&&(K0=!0),ct!==null&&(ct=ct.next={lane:0,tag:le.tag,payload:le.payload,callback:null,next:null});e:{var mn=u,ln=le;Xe=d;var Bi=v;switch(ln.tag){case 1:if(mn=ln.payload,typeof mn=="function"){mt=mn.call(Bi,mt,Xe);break e}mt=mn;break e;case 3:mn.flags=mn.flags&-65537|128;case 0:if(mn=ln.payload,Xe=typeof mn=="function"?mn.call(Bi,mt,Xe):mn,Xe==null)break e;mt=h({},mt,Xe);break e;case 2:kl=!0}}Xe=le.callback,Xe!==null&&(u.flags|=64,Je&&(u.flags|=8192),Je=w.callbacks,Je===null?w.callbacks=[Xe]:Je.push(Xe))}else Je={lane:Xe,tag:le.tag,payload:le.payload,callback:le.callback,next:null},ct===null?(je=ct=Je,Te=mt):ct=ct.next=Je,$|=Xe;if(le=le.next,le===null){if(le=w.shared.pending,le===null)break;Je=le,le=Je.next,Je.next=null,w.lastBaseUpdate=Je,w.shared.pending=null}}while(!0);ct===null&&(Te=mt),w.baseState=Te,w.firstBaseUpdate=je,w.lastBaseUpdate=ct,N===null&&(w.shared.lanes=0),bo|=$,u.lanes=$,u.memoizedState=mt}}function of(u,d){if(typeof u!="function")throw Error(n(191,u));u.call(d)}function lx(u,d){var v=u.callbacks;if(v!==null)for(u.callbacks=null,u=0;u<v.length;u++)of(v[u],d)}var lf=te(null),Xm=te(0);function cx(u,d){u=Ha,Ee(Xm,u),Ee(lf,d),Ha=u|d.baseLanes}function Y0(){Ee(Xm,Ha),Ee(lf,lf.current)}function np(){Ha=Xm.current,oe(lf),oe(Xm)}var Hl=0,Sn=null,ci=null,vs=null,Wm=!1,Bc=!1,Rr=!1,Is=0,Na=0,rr=null,ux=0;function os(){throw Error(n(321))}function Ar(u,d){if(d===null)return!1;for(var v=0;v<d.length&&v<u.length;v++)if(!Qr(u[v],d[v]))return!1;return!0}function zl(u,d,v,S,w,N){return Hl=N,Sn=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,k.H=u===null||u.memoizedState===null?rg:uy,Rr=!1,N=v(S,w),Rr=!1,Bc&&(N=fx(d,v,S,w)),hx(u),N}function hx(u){k.H=rp;var d=ci!==null&&ci.next!==null;if(Hl=0,vs=ci=Sn=null,Wm=!1,Na=0,rr=null,d)throw Error(n(300));u===null||Gs||(u=u.dependencies,u!==null&&Yd(u)&&(Gs=!0))}function fx(u,d,v,S){Sn=u;var w=0;do{if(Bc&&(rr=null),Na=0,Bc=!1,25<=w)throw Error(n(301));if(w+=1,vs=ci=null,u.updateQueue!=null){var N=u.updateQueue;N.lastEffect=null,N.events=null,N.stores=null,N.memoCache!=null&&(N.memoCache.index=0)}k.H=Ux,N=d(v,S)}while(Bc);return N}function wC(){var u=k.H,d=u.useState()[0];return d=typeof d.then=="function"?Ao(d):d,u=u.useState()[0],(ci!==null?ci.memoizedState:null)!==u&&(Sn.flags|=1024),d}function X0(){var u=Is!==0;return Is=0,u}function $m(u,d,v){d.updateQueue=u.updateQueue,d.flags&=-2053,u.lanes&=~v}function W0(u){if(Wm){for(u=u.memoizedState;u!==null;){var d=u.queue;d!==null&&(d.pending=null),u=u.next}Wm=!1}Hl=0,vs=ci=Sn=null,Bc=!1,Na=Is=0,rr=null}function Br(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vs===null?Sn.memoizedState=vs=u:vs=vs.next=u,vs}function Es(){if(ci===null){var u=Sn.alternate;u=u!==null?u.memoizedState:null}else u=ci.next;var d=vs===null?Sn.memoizedState:vs.next;if(d!==null)vs=d,ci=u;else{if(u===null)throw Sn.alternate===null?Error(n(467)):Error(n(310));ci=u,u={memoizedState:ci.memoizedState,baseState:ci.baseState,baseQueue:ci.baseQueue,queue:ci.queue,next:null},vs===null?Sn.memoizedState=vs=u:vs=vs.next=u}return vs}function Dc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ao(u){var d=Na;return Na+=1,rr===null&&(rr=[]),u=Ym(rr,u,d),d=Sn,(vs===null?d.memoizedState:vs.next)===null&&(d=d.alternate,k.H=d===null||d.memoizedState===null?rg:uy),u}function Jm(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return Ao(u);if(u.$$typeof===C)return Zi(u)}throw Error(n(438,String(u)))}function $0(u){var d=null,v=Sn.updateQueue;if(v!==null&&(d=v.memoCache),d==null){var S=Sn.alternate;S!==null&&(S=S.updateQueue,S!==null&&(S=S.memoCache,S!=null&&(d={data:S.data.map(function(w){return w.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),v===null&&(v=Dc(),Sn.updateQueue=v),v.memoCache=d,v=d.data[d.index],v===void 0)for(v=d.data[d.index]=Array(u),S=0;S<u;S++)v[S]=O;return d.index++,v}function Ql(u,d){return typeof d=="function"?d(u):d}function Lc(u){var d=Es();return J0(d,ci,u)}function J0(u,d,v){var S=u.queue;if(S===null)throw Error(n(311));S.lastRenderedReducer=v;var w=u.baseQueue,N=S.pending;if(N!==null){if(w!==null){var $=w.next;w.next=N.next,N.next=$}d.baseQueue=w=N,S.pending=null}if(N=u.baseState,w===null)u.memoizedState=N;else{d=w.next;var le=$=null,Te=null,je=d,ct=!1;do{var mt=je.lane&-536870913;if(mt!==je.lane?(en&mt)===mt:(Hl&mt)===mt){var Xe=je.revertLane;if(Xe===0)Te!==null&&(Te=Te.next={lane:0,revertLane:0,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null}),mt===_n&&(ct=!0);else if((Hl&Xe)===Xe){je=je.next,Xe===_n&&(ct=!0);continue}else mt={lane:0,revertLane:je.revertLane,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null},Te===null?(le=Te=mt,$=N):Te=Te.next=mt,Sn.lanes|=Xe,bo|=Xe;mt=je.action,Rr&&v(N,mt),N=je.hasEagerState?je.eagerState:v(N,mt)}else Xe={lane:mt,revertLane:je.revertLane,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null},Te===null?(le=Te=Xe,$=N):Te=Te.next=Xe,Sn.lanes|=mt,bo|=mt;je=je.next}while(je!==null&&je!==d);if(Te===null?$=N:Te.next=le,!Qr(N,u.memoizedState)&&(Gs=!0,ct&&(v=nf,v!==null)))throw v;u.memoizedState=N,u.baseState=$,u.baseQueue=Te,S.lastRenderedState=N}return w===null&&(S.lanes=0),[u.memoizedState,S.dispatch]}function Z0(u){var d=Es(),v=d.queue;if(v===null)throw Error(n(311));v.lastRenderedReducer=u;var S=v.dispatch,w=v.pending,N=d.memoizedState;if(w!==null){v.pending=null;var $=w=w.next;do N=u(N,$.action),$=$.next;while($!==w);Qr(N,d.memoizedState)||(Gs=!0),d.memoizedState=N,d.baseQueue===null&&(d.baseState=N),v.lastRenderedState=N}return[N,S]}function dx(u,d,v){var S=Sn,w=Es(),N=ti;if(N){if(v===void 0)throw Error(n(407));v=v()}else v=d();var $=!Qr((ci||w).memoizedState,v);$&&(w.memoizedState=v,Gs=!0),w=w.queue;var le=mx.bind(null,S,w,u);if(hf(2048,8,le,[u]),w.getSnapshot!==d||$||vs!==null&&vs.memoizedState.tag&1){if(S.flags|=2048,uf(9,ip(),px.bind(null,S,w,v,d),null),vn===null)throw Error(n(349));N||(Hl&124)!==0||cf(S,d,v)}return v}function cf(u,d,v){u.flags|=16384,u={getSnapshot:d,value:v},d=Sn.updateQueue,d===null?(d=Dc(),Sn.updateQueue=d,d.stores=[u]):(v=d.stores,v===null?d.stores=[u]:v.push(u))}function px(u,d,v,S){d.value=v,d.getSnapshot=S,gx(d)&&Ax(u)}function mx(u,d,v){return v(function(){gx(d)&&Ax(u)})}function gx(u){var d=u.getSnapshot;u=u.value;try{var v=d();return!Qr(u,v)}catch{return!0}}function Ax(u){var d=Pl(u,2);d!==null&&Or(d,u,2)}function ey(u){var d=Br();if(typeof u=="function"){var v=u;if(u=v(),Rr){et(!0);try{v()}finally{et(!1)}}}return d.memoizedState=d.baseState=u,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ql,lastRenderedState:u},d}function yx(u,d,v,S){return u.baseState=v,J0(u,ci,typeof S=="function"?S:Ql)}function RC(u,d,v,S,w){if(sg(u))throw Error(n(485));if(u=d.action,u!==null){var N={payload:w,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function($){N.listeners.push($)}};k.T!==null?v(!0):N.isTransition=!1,S(N),v=d.pending,v===null?(N.next=d.pending=N,vx(d,N)):(N.next=v.next,d.pending=v.next=N)}}function vx(u,d){var v=d.action,S=d.payload,w=u.state;if(d.isTransition){var N=k.T,$={};k.T=$;try{var le=v(w,S),Te=k.S;Te!==null&&Te($,le),Ex(u,d,le)}catch(je){ty(u,d,je)}finally{k.T=N}}else try{N=v(w,S),Ex(u,d,N)}catch(je){ty(u,d,je)}}function Ex(u,d,v){v!==null&&typeof v=="object"&&typeof v.then=="function"?v.then(function(S){xx(u,d,S)},function(S){return ty(u,d,S)}):xx(u,d,v)}function xx(u,d,v){d.status="fulfilled",d.value=v,_x(d),u.state=v,d=u.pending,d!==null&&(v=d.next,v===d?u.pending=null:(v=v.next,d.next=v,vx(u,v)))}function ty(u,d,v){var S=u.pending;if(u.pending=null,S!==null){S=S.next;do d.status="rejected",d.reason=v,_x(d),d=d.next;while(d!==S)}u.action=null}function _x(u){u=u.listeners;for(var d=0;d<u.length;d++)(0,u[d])()}function ny(u,d){return d}function Sx(u,d){if(ti){var v=vn.formState;if(v!==null){e:{var S=Sn;if(ti){if(Vi){t:{for(var w=Vi,N=ca;w.nodeType!==8;){if(!N){w=null;break t}if(w=Wl(w.nextSibling),w===null){w=null;break t}}N=w.data,w=N==="F!"||N==="F"?w:null}if(w){Vi=Wl(w.nextSibling),S=w.data==="F!";break e}}Ic(S)}S=!1}S&&(d=v[0])}}return v=Br(),v.memoizedState=v.baseState=d,S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ny,lastRenderedState:d},v.queue=S,v=Nx.bind(null,Sn,S),S.dispatch=v,S=ey(!1),N=ig.bind(null,Sn,!1,S.queue),S=Br(),w={state:d,dispatch:null,action:u,pending:null},S.queue=w,v=RC.bind(null,Sn,w,N,v),w.dispatch=v,S.memoizedState=u,[d,v,!1]}function bx(u){var d=Es();return Tx(d,ci,u)}function Tx(u,d,v){if(d=J0(u,d,ny)[0],u=Lc(Ql)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var S=Ao(d)}catch($){throw $===Zd?go:$}else S=d;d=Es();var w=d.queue,N=w.dispatch;return v!==d.memoizedState&&(Sn.flags|=2048,uf(9,ip(),BC.bind(null,w,v),null)),[S,N,u]}function BC(u,d){u.action=d}function Cx(u){var d=Es(),v=ci;if(v!==null)return Tx(d,v,u);Es(),d=d.memoizedState,v=Es();var S=v.queue.dispatch;return v.memoizedState=u,[d,S,!1]}function uf(u,d,v,S){return u={tag:u,create:v,deps:S,inst:d,next:null},d=Sn.updateQueue,d===null&&(d=Dc(),Sn.updateQueue=d),v=d.lastEffect,v===null?d.lastEffect=u.next=u:(S=v.next,v.next=u,u.next=S,d.lastEffect=u),u}function ip(){return{destroy:void 0,resource:void 0}}function iy(){return Es().memoizedState}function Zm(u,d,v,S){var w=Br();S=S===void 0?null:S,Sn.flags|=u,w.memoizedState=uf(1|d,ip(),v,S)}function hf(u,d,v,S){var w=Es();S=S===void 0?null:S;var N=w.memoizedState.inst;ci!==null&&S!==null&&Ar(S,ci.memoizedState.deps)?w.memoizedState=uf(d,N,v,S):(Sn.flags|=u,w.memoizedState=uf(1|d,N,v,S))}function sy(u,d){Zm(8390656,8,u,d)}function ry(u,d){hf(2048,8,u,d)}function eg(u,d){return hf(4,2,u,d)}function tg(u,d){return hf(4,4,u,d)}function Ix(u,d){if(typeof d=="function"){u=u();var v=d(u);return function(){typeof v=="function"?v():d(null)}}if(d!=null)return u=u(),d.current=u,function(){d.current=null}}function Mx(u,d,v){v=v!=null?v.concat([u]):null,hf(4,4,Ix.bind(null,d,u),v)}function ay(){}function wx(u,d){var v=Es();d=d===void 0?null:d;var S=v.memoizedState;return d!==null&&Ar(d,S[1])?S[0]:(v.memoizedState=[u,d],u)}function oy(u,d){var v=Es();d=d===void 0?null:d;var S=v.memoizedState;if(d!==null&&Ar(d,S[1]))return S[0];if(S=u(),Rr){et(!0);try{u()}finally{et(!1)}}return v.memoizedState=[S,d],S}function ng(u,d,v){return v===void 0||(Hl&1073741824)!==0?u.memoizedState=d:(u.memoizedState=v,u=gg(),Sn.lanes|=u,bo|=u,v)}function Rx(u,d,v,S){return Qr(v,d)?v:lf.current!==null?(u=ng(u,v,S),Qr(u,d)||(Gs=!0),u):(Hl&42)===0?(Gs=!0,u.memoizedState=v):(u=gg(),Sn.lanes|=u,bo|=u,d)}function Bx(u,d,v,S,w){var N=W.p;W.p=N!==0&&8>N?N:8;var $=k.T,le={};k.T=le,ig(u,!1,d,v);try{var Te=w(),je=k.S;if(je!==null&&je(le,Te),Te!==null&&typeof Te=="object"&&typeof Te.then=="function"){var ct=MC(Te,S);sp(u,d,ct,ns(u))}else sp(u,d,S,ns(u))}catch(mt){sp(u,d,{then:function(){},status:"rejected",reason:mt},ns())}finally{W.p=N,k.T=$}}function DC(){}function ly(u,d,v,S){if(u.tag!==5)throw Error(n(476));var w=Dx(u).queue;Bx(u,w,d,V,v===null?DC:function(){return Lx(u),v(S)})}function Dx(u){var d=u.memoizedState;if(d!==null)return d;d={memoizedState:V,baseState:V,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ql,lastRenderedState:V},next:null};var v={};return d.next={memoizedState:v,baseState:v,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ql,lastRenderedState:v},next:null},u.memoizedState=d,u=u.alternate,u!==null&&(u.memoizedState=d),d}function Lx(u){var d=Dx(u).next.queue;sp(u,d,{},ns())}function cy(){return Zi(_y)}function Ox(){return Es().memoizedState}function Px(){return Es().memoizedState}function LC(u){for(var d=u.return;d!==null;){switch(d.tag){case 24:case 3:var v=ns();u=Yo(v);var S=Gl(d,u,v);S!==null&&(Or(S,d,v),Fu(S,d,v)),d={cache:Vm()},u.payload=d;return}d=d.return}}function OC(u,d,v){var S=ns();v={lane:S,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null},sg(u)?Fx(d,v):(v=km(u,d,v,S),v!==null&&(Or(v,u,S),ha(v,d,S)))}function Nx(u,d,v){var S=ns();sp(u,d,v,S)}function sp(u,d,v,S){var w={lane:S,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null};if(sg(u))Fx(d,w);else{var N=u.alternate;if(u.lanes===0&&(N===null||N.lanes===0)&&(N=d.lastRenderedReducer,N!==null))try{var $=d.lastRenderedState,le=N($,v);if(w.hasEagerState=!0,w.eagerState=le,Qr(le,$))return Sc(u,d,w,0),vn===null&&Qd(),!1}catch{}finally{}if(v=km(u,d,w,S),v!==null)return Or(v,u,S),ha(v,d,S),!0}return!1}function ig(u,d,v,S){if(S={lane:2,revertLane:FC(),action:S,hasEagerState:!1,eagerState:null,next:null},sg(u)){if(d)throw Error(n(479))}else d=km(u,v,S,2),d!==null&&Or(d,u,2)}function sg(u){var d=u.alternate;return u===Sn||d!==null&&d===Sn}function Fx(u,d){Bc=Wm=!0;var v=u.pending;v===null?d.next=d:(d.next=v.next,v.next=d),u.pending=d}function ha(u,d,v){if((v&4194048)!==0){var S=d.lanes;S&=u.pendingLanes,v|=S,d.lanes=v,zt(u,v)}}var rp={readContext:Zi,use:Jm,useCallback:os,useContext:os,useEffect:os,useImperativeHandle:os,useLayoutEffect:os,useInsertionEffect:os,useMemo:os,useReducer:os,useRef:os,useState:os,useDebugValue:os,useDeferredValue:os,useTransition:os,useSyncExternalStore:os,useId:os,useHostTransitionStatus:os,useFormState:os,useActionState:os,useOptimistic:os,useMemoCache:os,useCacheRefresh:os},rg={readContext:Zi,use:Jm,useCallback:function(u,d){return Br().memoizedState=[u,d===void 0?null:d],u},useContext:Zi,useEffect:sy,useImperativeHandle:function(u,d,v){v=v!=null?v.concat([u]):null,Zm(4194308,4,Ix.bind(null,d,u),v)},useLayoutEffect:function(u,d){return Zm(4194308,4,u,d)},useInsertionEffect:function(u,d){Zm(4,2,u,d)},useMemo:function(u,d){var v=Br();d=d===void 0?null:d;var S=u();if(Rr){et(!0);try{u()}finally{et(!1)}}return v.memoizedState=[S,d],S},useReducer:function(u,d,v){var S=Br();if(v!==void 0){var w=v(d);if(Rr){et(!0);try{v(d)}finally{et(!1)}}}else w=d;return S.memoizedState=S.baseState=w,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:w},S.queue=u,u=u.dispatch=OC.bind(null,Sn,u),[S.memoizedState,u]},useRef:function(u){var d=Br();return u={current:u},d.memoizedState=u},useState:function(u){u=ey(u);var d=u.queue,v=Nx.bind(null,Sn,d);return d.dispatch=v,[u.memoizedState,v]},useDebugValue:ay,useDeferredValue:function(u,d){var v=Br();return ng(v,u,d)},useTransition:function(){var u=ey(!1);return u=Bx.bind(null,Sn,u.queue,!0,!1),Br().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,d,v){var S=Sn,w=Br();if(ti){if(v===void 0)throw Error(n(407));v=v()}else{if(v=d(),vn===null)throw Error(n(349));(en&124)!==0||cf(S,d,v)}w.memoizedState=v;var N={value:v,getSnapshot:d};return w.queue=N,sy(mx.bind(null,S,N,u),[u]),S.flags|=2048,uf(9,ip(),px.bind(null,S,N,v,d),null),v},useId:function(){var u=Br(),d=vn.identifierPrefix;if(ti){var v=qo,S=jo;v=(S&~(1<<32-Mt(S)-1)).toString(32)+v,d=""+d+"R"+v,v=Is++,0<v&&(d+="H"+v.toString(32)),d+=""}else v=ux++,d=""+d+"r"+v.toString(32)+"";return u.memoizedState=d},useHostTransitionStatus:cy,useFormState:Sx,useActionState:Sx,useOptimistic:function(u){var d=Br();d.memoizedState=d.baseState=u;var v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=v,d=ig.bind(null,Sn,!0,v),v.dispatch=d,[u,d]},useMemoCache:$0,useCacheRefresh:function(){return Br().memoizedState=LC.bind(null,Sn)}},uy={readContext:Zi,use:Jm,useCallback:wx,useContext:Zi,useEffect:ry,useImperativeHandle:Mx,useInsertionEffect:eg,useLayoutEffect:tg,useMemo:oy,useReducer:Lc,useRef:iy,useState:function(){return Lc(Ql)},useDebugValue:ay,useDeferredValue:function(u,d){var v=Es();return Rx(v,ci.memoizedState,u,d)},useTransition:function(){var u=Lc(Ql)[0],d=Es().memoizedState;return[typeof u=="boolean"?u:Ao(u),d]},useSyncExternalStore:dx,useId:Ox,useHostTransitionStatus:cy,useFormState:bx,useActionState:bx,useOptimistic:function(u,d){var v=Es();return yx(v,ci,u,d)},useMemoCache:$0,useCacheRefresh:Px},Ux={readContext:Zi,use:Jm,useCallback:wx,useContext:Zi,useEffect:ry,useImperativeHandle:Mx,useInsertionEffect:eg,useLayoutEffect:tg,useMemo:oy,useReducer:Z0,useRef:iy,useState:function(){return Z0(Ql)},useDebugValue:ay,useDeferredValue:function(u,d){var v=Es();return ci===null?ng(v,u,d):Rx(v,ci.memoizedState,u,d)},useTransition:function(){var u=Z0(Ql)[0],d=Es().memoizedState;return[typeof u=="boolean"?u:Ao(u),d]},useSyncExternalStore:dx,useId:Ox,useHostTransitionStatus:cy,useFormState:Cx,useActionState:Cx,useOptimistic:function(u,d){var v=Es();return ci!==null?yx(v,ci,u,d):(v.baseState=u,[u,v.queue.dispatch])},useMemoCache:$0,useCacheRefresh:Px},Uu=null,ap=0;function op(u){var d=ap;return ap+=1,Uu===null&&(Uu=[]),Ym(Uu,u,d)}function ff(u,d){d=d.props.ref,u.ref=d!==void 0?d:null}function ag(u,d){throw d.$$typeof===f?Error(n(525)):(u=Object.prototype.toString.call(d),Error(n(31,u==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":u)))}function kx(u){var d=u._init;return d(u._payload)}function Gx(u){function d(Ne,Le){if(u){var ze=Ne.deletions;ze===null?(Ne.deletions=[Le],Ne.flags|=16):ze.push(Le)}}function v(Ne,Le){if(!u)return null;for(;Le!==null;)d(Ne,Le),Le=Le.sibling;return null}function S(Ne){for(var Le=new Map;Ne!==null;)Ne.key!==null?Le.set(Ne.key,Ne):Le.set(Ne.index,Ne),Ne=Ne.sibling;return Le}function w(Ne,Le){return Ne=as(Ne,Le),Ne.index=0,Ne.sibling=null,Ne}function N(Ne,Le,ze){return Ne.index=ze,u?(ze=Ne.alternate,ze!==null?(ze=ze.index,ze<Le?(Ne.flags|=67108866,Le):ze):(Ne.flags|=67108866,Le)):(Ne.flags|=1048576,Le)}function $(Ne){return u&&Ne.alternate===null&&(Ne.flags|=67108866),Ne}function le(Ne,Le,ze,ft){return Le===null||Le.tag!==6?(Le=jd(ze,Ne.mode,ft),Le.return=Ne,Le):(Le=w(Le,ze),Le.return=Ne,Le)}function Te(Ne,Le,ze,ft){var qt=ze.type;return qt===y?ct(Ne,Le,ze.props.children,ft,ze.key):Le!==null&&(Le.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===P&&kx(qt)===Le.type)?(Le=w(Le,ze.props),ff(Le,ze),Le.return=Ne,Le):(Le=ks(ze.type,ze.key,ze.props,null,Ne.mode,ft),ff(Le,ze),Le.return=Ne,Le)}function je(Ne,Le,ze,ft){return Le===null||Le.tag!==4||Le.stateNode.containerInfo!==ze.containerInfo||Le.stateNode.implementation!==ze.implementation?(Le=Gm(ze,Ne.mode,ft),Le.return=Ne,Le):(Le=w(Le,ze.children||[]),Le.return=Ne,Le)}function ct(Ne,Le,ze,ft,qt){return Le===null||Le.tag!==7?(Le=Tc(ze,Ne.mode,ft,qt),Le.return=Ne,Le):(Le=w(Le,ze),Le.return=Ne,Le)}function mt(Ne,Le,ze){if(typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint")return Le=jd(""+Le,Ne.mode,ze),Le.return=Ne,Le;if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case p:return ze=ks(Le.type,Le.key,Le.props,null,Ne.mode,ze),ff(ze,Le),ze.return=Ne,ze;case g:return Le=Gm(Le,Ne.mode,ze),Le.return=Ne,Le;case P:var ft=Le._init;return Le=ft(Le._payload),mt(Ne,Le,ze)}if(q(Le)||j(Le))return Le=Tc(Le,Ne.mode,ze,null),Le.return=Ne,Le;if(typeof Le.then=="function")return mt(Ne,op(Le),ze);if(Le.$$typeof===C)return mt(Ne,Xd(Ne,Le),ze);ag(Ne,Le)}return null}function Xe(Ne,Le,ze,ft){var qt=Le!==null?Le.key:null;if(typeof ze=="string"&&ze!==""||typeof ze=="number"||typeof ze=="bigint")return qt!==null?null:le(Ne,Le,""+ze,ft);if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case p:return ze.key===qt?Te(Ne,Le,ze,ft):null;case g:return ze.key===qt?je(Ne,Le,ze,ft):null;case P:return qt=ze._init,ze=qt(ze._payload),Xe(Ne,Le,ze,ft)}if(q(ze)||j(ze))return qt!==null?null:ct(Ne,Le,ze,ft,null);if(typeof ze.then=="function")return Xe(Ne,Le,op(ze),ft);if(ze.$$typeof===C)return Xe(Ne,Le,Xd(Ne,ze),ft);ag(Ne,ze)}return null}function Je(Ne,Le,ze,ft,qt){if(typeof ft=="string"&&ft!==""||typeof ft=="number"||typeof ft=="bigint")return Ne=Ne.get(ze)||null,le(Le,Ne,""+ft,qt);if(typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case p:return Ne=Ne.get(ft.key===null?ze:ft.key)||null,Te(Le,Ne,ft,qt);case g:return Ne=Ne.get(ft.key===null?ze:ft.key)||null,je(Le,Ne,ft,qt);case P:var Gn=ft._init;return ft=Gn(ft._payload),Je(Ne,Le,ze,ft,qt)}if(q(ft)||j(ft))return Ne=Ne.get(ze)||null,ct(Le,Ne,ft,qt,null);if(typeof ft.then=="function")return Je(Ne,Le,ze,op(ft),qt);if(ft.$$typeof===C)return Je(Ne,Le,ze,Xd(Le,ft),qt);ag(Le,ft)}return null}function mn(Ne,Le,ze,ft){for(var qt=null,Gn=null,Zt=Le,cn=Le=0,Er=null;Zt!==null&&cn<ze.length;cn++){Zt.index>cn?(Er=Zt,Zt=null):Er=Zt.sibling;var oi=Xe(Ne,Zt,ze[cn],ft);if(oi===null){Zt===null&&(Zt=Er);break}u&&Zt&&oi.alternate===null&&d(Ne,Zt),Le=N(oi,Le,cn),Gn===null?qt=oi:Gn.sibling=oi,Gn=oi,Zt=Er}if(cn===ze.length)return v(Ne,Zt),ti&&Nl(Ne,cn),qt;if(Zt===null){for(;cn<ze.length;cn++)Zt=mt(Ne,ze[cn],ft),Zt!==null&&(Le=N(Zt,Le,cn),Gn===null?qt=Zt:Gn.sibling=Zt,Gn=Zt);return ti&&Nl(Ne,cn),qt}for(Zt=S(Zt);cn<ze.length;cn++)Er=Je(Zt,Ne,cn,ze[cn],ft),Er!==null&&(u&&Er.alternate!==null&&Zt.delete(Er.key===null?cn:Er.key),Le=N(Er,Le,cn),Gn===null?qt=Er:Gn.sibling=Er,Gn=Er);return u&&Zt.forEach(function(wf){return d(Ne,wf)}),ti&&Nl(Ne,cn),qt}function ln(Ne,Le,ze,ft){if(ze==null)throw Error(n(151));for(var qt=null,Gn=null,Zt=Le,cn=Le=0,Er=null,oi=ze.next();Zt!==null&&!oi.done;cn++,oi=ze.next()){Zt.index>cn?(Er=Zt,Zt=null):Er=Zt.sibling;var wf=Xe(Ne,Zt,oi.value,ft);if(wf===null){Zt===null&&(Zt=Er);break}u&&Zt&&wf.alternate===null&&d(Ne,Zt),Le=N(wf,Le,cn),Gn===null?qt=wf:Gn.sibling=wf,Gn=wf,Zt=Er}if(oi.done)return v(Ne,Zt),ti&&Nl(Ne,cn),qt;if(Zt===null){for(;!oi.done;cn++,oi=ze.next())oi=mt(Ne,oi.value,ft),oi!==null&&(Le=N(oi,Le,cn),Gn===null?qt=oi:Gn.sibling=oi,Gn=oi);return ti&&Nl(Ne,cn),qt}for(Zt=S(Zt);!oi.done;cn++,oi=ze.next())oi=Je(Zt,Ne,cn,oi.value,ft),oi!==null&&(u&&oi.alternate!==null&&Zt.delete(oi.key===null?cn:oi.key),Le=N(oi,Le,cn),Gn===null?qt=oi:Gn.sibling=oi,Gn=oi);return u&&Zt.forEach(function(jQ){return d(Ne,jQ)}),ti&&Nl(Ne,cn),qt}function Bi(Ne,Le,ze,ft){if(typeof ze=="object"&&ze!==null&&ze.type===y&&ze.key===null&&(ze=ze.props.children),typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case p:e:{for(var qt=ze.key;Le!==null;){if(Le.key===qt){if(qt=ze.type,qt===y){if(Le.tag===7){v(Ne,Le.sibling),ft=w(Le,ze.props.children),ft.return=Ne,Ne=ft;break e}}else if(Le.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===P&&kx(qt)===Le.type){v(Ne,Le.sibling),ft=w(Le,ze.props),ff(ft,ze),ft.return=Ne,Ne=ft;break e}v(Ne,Le);break}else d(Ne,Le);Le=Le.sibling}ze.type===y?(ft=Tc(ze.props.children,Ne.mode,ft,ze.key),ft.return=Ne,Ne=ft):(ft=ks(ze.type,ze.key,ze.props,null,Ne.mode,ft),ff(ft,ze),ft.return=Ne,Ne=ft)}return $(Ne);case g:e:{for(qt=ze.key;Le!==null;){if(Le.key===qt)if(Le.tag===4&&Le.stateNode.containerInfo===ze.containerInfo&&Le.stateNode.implementation===ze.implementation){v(Ne,Le.sibling),ft=w(Le,ze.children||[]),ft.return=Ne,Ne=ft;break e}else{v(Ne,Le);break}else d(Ne,Le);Le=Le.sibling}ft=Gm(ze,Ne.mode,ft),ft.return=Ne,Ne=ft}return $(Ne);case P:return qt=ze._init,ze=qt(ze._payload),Bi(Ne,Le,ze,ft)}if(q(ze))return mn(Ne,Le,ze,ft);if(j(ze)){if(qt=j(ze),typeof qt!="function")throw Error(n(150));return ze=qt.call(ze),ln(Ne,Le,ze,ft)}if(typeof ze.then=="function")return Bi(Ne,Le,op(ze),ft);if(ze.$$typeof===C)return Bi(Ne,Le,Xd(Ne,ze),ft);ag(Ne,ze)}return typeof ze=="string"&&ze!==""||typeof ze=="number"||typeof ze=="bigint"?(ze=""+ze,Le!==null&&Le.tag===6?(v(Ne,Le.sibling),ft=w(Le,ze),ft.return=Ne,Ne=ft):(v(Ne,Le),ft=jd(ze,Ne.mode,ft),ft.return=Ne,Ne=ft),$(Ne)):v(Ne,Le)}return function(Ne,Le,ze,ft){try{ap=0;var qt=Bi(Ne,Le,ze,ft);return Uu=null,qt}catch(Zt){if(Zt===Zd||Zt===go)throw Zt;var Gn=qr(29,Zt,null,Ne.mode);return Gn.lanes=ft,Gn.return=Ne,Gn}finally{}}}var ku=Gx(!0),Hx=Gx(!1),gi=te(null),yo=null;function Oc(u){var d=u.alternate;Ee(ls,ls.current&1),Ee(gi,u),yo===null&&(d===null||lf.current!==null||d.memoizedState!==null)&&(yo=u)}function zx(u){if(u.tag===22){if(Ee(ls,ls.current),Ee(gi,u),yo===null){var d=u.alternate;d!==null&&d.memoizedState!==null&&(yo=u)}}else Pc()}function Pc(){Ee(ls,ls.current),Ee(gi,gi.current)}function Xo(u){oe(gi),yo===u&&(yo=null),oe(ls)}var ls=te(0);function Vl(u){for(var d=u;d!==null;){if(d.tag===13){var v=d.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||XC(v)))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===u)break;for(;d.sibling===null;){if(d.return===null||d.return===u)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}function Nc(u,d,v,S){d=u.memoizedState,v=v(S,d),v=v==null?d:h({},d,v),u.memoizedState=v,u.lanes===0&&(u.updateQueue.baseState=v)}var Dr={enqueueSetState:function(u,d,v){u=u._reactInternals;var S=ns(),w=Yo(S);w.payload=d,v!=null&&(w.callback=v),d=Gl(u,w,S),d!==null&&(Or(d,u,S),Fu(d,u,S))},enqueueReplaceState:function(u,d,v){u=u._reactInternals;var S=ns(),w=Yo(S);w.tag=1,w.payload=d,v!=null&&(w.callback=v),d=Gl(u,w,S),d!==null&&(Or(d,u,S),Fu(d,u,S))},enqueueForceUpdate:function(u,d){u=u._reactInternals;var v=ns(),S=Yo(v);S.tag=2,d!=null&&(S.callback=d),d=Gl(u,S,v),d!==null&&(Or(d,u,v),Fu(d,u,v))}};function Qx(u,d,v,S,w,N,$){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(S,N,$):d.prototype&&d.prototype.isPureReactComponent?!po(v,S)||!po(w,N):!0}function Vx(u,d,v,S){u=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(v,S),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(v,S),d.state!==u&&Dr.enqueueReplaceState(d,d.state,null)}function Wo(u,d){var v=d;if("ref"in d){v={};for(var S in d)S!=="ref"&&(v[S]=d[S])}if(u=u.defaultProps){v===d&&(v=h({},v));for(var w in u)v[w]===void 0&&(v[w]=u[w])}return v}var Gu=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)};function lp(u){Gu(u)}function og(u){console.error(u)}function jx(u){Gu(u)}function lg(u,d){try{var v=u.onUncaughtError;v(d.value,{componentStack:d.stack})}catch(S){setTimeout(function(){throw S})}}function Fa(u,d,v){try{var S=u.onCaughtError;S(v.value,{componentStack:v.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function cg(u,d,v){return v=Yo(v),v.tag=3,v.payload={element:null},v.callback=function(){lg(u,d)},v}function qx(u){return u=Yo(u),u.tag=3,u}function ug(u,d,v,S){var w=v.type.getDerivedStateFromError;if(typeof w=="function"){var N=S.value;u.payload=function(){return w(N)},u.callback=function(){Fa(d,v,S)}}var $=v.stateNode;$!==null&&typeof $.componentDidCatch=="function"&&(u.callback=function(){Fa(d,v,S),typeof w!="function"&&(va===null?va=new Set([this]):va.add(this));var le=S.stack;this.componentDidCatch(S.value,{componentStack:le!==null?le:""})})}function PC(u,d,v,S,w){if(v.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){if(d=v.alternate,d!==null&&La(d,v,w,!0),v=gi.current,v!==null){switch(v.tag){case 13:return yo===null?m():v.alternate===null&&Pi===0&&(Pi=3),v.flags&=-257,v.flags|=65536,v.lanes=w,S===ep?v.flags|=16384:(d=v.updateQueue,d===null?v.updateQueue=new Set([S]):d.add(S),Ze(u,S,w)),!1;case 22:return v.flags|=65536,S===ep?v.flags|=16384:(d=v.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([S])},v.updateQueue=d):(v=d.retryQueue,v===null?d.retryQueue=new Set([S]):v.add(S)),Ze(u,S,w)),!1}throw Error(n(435,v.tag))}return Ze(u,S,w),m(),!1}if(ti)return d=gi.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=w,S!==zm&&(u=Error(n(422),{cause:S}),Nu(ir(u,v)))):(S!==zm&&(d=Error(n(423),{cause:S}),Nu(ir(d,v))),u=u.current.alternate,u.flags|=65536,w&=-w,u.lanes|=w,S=ir(S,v),w=cg(u.stateNode,S,w),rf(u,w),Pi!==4&&(Pi=2)),!1;var N=Error(n(520),{cause:S});if(N=ir(N,v),ai===null?ai=[N]:ai.push(N),Pi!==4&&(Pi=2),d===null)return!0;S=ir(S,v),v=d;do{switch(v.tag){case 3:return v.flags|=65536,u=w&-w,v.lanes|=u,u=cg(v.stateNode,S,u),rf(v,u),!1;case 1:if(d=v.type,N=v.stateNode,(v.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&(va===null||!va.has(N))))return v.flags|=65536,w&=-w,v.lanes|=w,w=qx(w),ug(w,u,v,S),rf(v,w),!1}v=v.return}while(v!==null);return!1}var Kx=Error(n(461)),Gs=!1;function cs(u,d,v,S){d.child=u===null?Hx(d,null,v,S):ku(d,u.child,v,S)}function Yr(u,d,v,S,w){v=v.render;var N=d.ref;if("ref"in S){var $={};for(var le in S)le!=="ref"&&($[le]=S[le])}else $=S;return Ko(d),S=zl(u,d,v,$,N,w),le=X0(),u!==null&&!Gs?($m(u,d,w),Hs(u,d,w)):(ti&&le&&U0(d),d.flags|=1,cs(u,d,S,w),d.child)}function Xr(u,d,v,S,w){if(u===null){var N=v.type;return typeof N=="function"&&!Vd(N)&&N.defaultProps===void 0&&v.compare===null?(d.tag=15,d.type=N,hy(u,d,N,S,w)):(u=ks(v.type,null,S,d,d.mode,w),u.ref=d.ref,u.return=d,d.child=u)}if(N=u.child,!cp(u,w)){var $=N.memoizedProps;if(v=v.compare,v=v!==null?v:po,v($,S)&&u.ref===d.ref)return Hs(u,d,w)}return d.flags|=1,u=as(N,S),u.ref=d.ref,u.return=d,d.child=u}function hy(u,d,v,S,w){if(u!==null){var N=u.memoizedProps;if(po(N,S)&&u.ref===d.ref)if(Gs=!1,d.pendingProps=S=N,cp(u,w))(u.flags&131072)!==0&&(Gs=!0);else return d.lanes=u.lanes,Hs(u,d,w)}return df(u,d,v,S,w)}function Hu(u,d,v){var S=d.pendingProps,w=S.children,N=u!==null?u.memoizedState:null;if(S.mode==="hidden"){if((d.flags&128)!==0){if(S=N!==null?N.baseLanes|v:v,u!==null){for(w=d.child=u.child,N=0;w!==null;)N=N|w.lanes|w.childLanes,w=w.sibling;d.childLanes=N&~S}else d.childLanes=0,d.child=null;return zu(u,d,S,v)}if((v&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},u!==null&&Jd(d,N!==null?N.cachePool:null),N!==null?cx(d,N):Y0(),zx(d);else return d.lanes=d.childLanes=536870912,zu(u,d,N!==null?N.baseLanes|v:v,v)}else N!==null?(Jd(d,N.cachePool),cx(d,N),Pc(),d.memoizedState=null):(u!==null&&Jd(d,null),Y0(),Pc());return cs(u,d,w,v),d.child}function zu(u,d,v,S){var w=Rc();return w=w===null?null:{parent:ys._currentValue,pool:w},d.memoizedState={baseLanes:v,cachePool:w},u!==null&&Jd(d,null),Y0(),zx(d),u!==null&&La(u,d,S,!0),null}function Qu(u,d){var v=d.ref;if(v===null)u!==null&&u.ref!==null&&(d.flags|=4194816);else{if(typeof v!="function"&&typeof v!="object")throw Error(n(284));(u===null||u.ref!==v)&&(d.flags|=4194816)}}function df(u,d,v,S,w){return Ko(d),v=zl(u,d,v,S,void 0,w),S=X0(),u!==null&&!Gs?($m(u,d,w),Hs(u,d,w)):(ti&&S&&U0(d),d.flags|=1,cs(u,d,v,w),d.child)}function fa(u,d,v,S,w,N){return Ko(d),d.updateQueue=null,v=fx(d,S,v,w),hx(u),S=X0(),u!==null&&!Gs?($m(u,d,N),Hs(u,d,N)):(ti&&S&&U0(d),d.flags|=1,cs(u,d,v,N),d.child)}function da(u,d,v,S,w){if(Ko(d),d.stateNode===null){var N=bc,$=v.contextType;typeof $=="object"&&$!==null&&(N=Zi($)),N=new v(S,N),d.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,N.updater=Dr,d.stateNode=N,N._reactInternals=d,N=d.stateNode,N.props=S,N.state=d.memoizedState,N.refs={},q0(d),$=v.contextType,N.context=typeof $=="object"&&$!==null?Zi($):bc,N.state=d.memoizedState,$=v.getDerivedStateFromProps,typeof $=="function"&&(Nc(d,v,$,S),N.state=d.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||($=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),$!==N.state&&Dr.enqueueReplaceState(N,N.state,null),af(d,S,N,w),tp(),N.state=d.memoizedState),typeof N.componentDidMount=="function"&&(d.flags|=4194308),S=!0}else if(u===null){N=d.stateNode;var le=d.memoizedProps,Te=Wo(v,le);N.props=Te;var je=N.context,ct=v.contextType;$=bc,typeof ct=="object"&&ct!==null&&($=Zi(ct));var mt=v.getDerivedStateFromProps;ct=typeof mt=="function"||typeof N.getSnapshotBeforeUpdate=="function",le=d.pendingProps!==le,ct||typeof N.UNSAFE_componentWillReceiveProps!="function"&&typeof N.componentWillReceiveProps!="function"||(le||je!==$)&&Vx(d,N,S,$),kl=!1;var Xe=d.memoizedState;N.state=Xe,af(d,S,N,w),tp(),je=d.memoizedState,le||Xe!==je||kl?(typeof mt=="function"&&(Nc(d,v,mt,S),je=d.memoizedState),(Te=kl||Qx(d,v,Te,S,Xe,je,$))?(ct||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount()),typeof N.componentDidMount=="function"&&(d.flags|=4194308)):(typeof N.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=S,d.memoizedState=je),N.props=S,N.state=je,N.context=$,S=Te):(typeof N.componentDidMount=="function"&&(d.flags|=4194308),S=!1)}else{N=d.stateNode,fn(u,d),$=d.memoizedProps,ct=Wo(v,$),N.props=ct,mt=d.pendingProps,Xe=N.context,je=v.contextType,Te=bc,typeof je=="object"&&je!==null&&(Te=Zi(je)),le=v.getDerivedStateFromProps,(je=typeof le=="function"||typeof N.getSnapshotBeforeUpdate=="function")||typeof N.UNSAFE_componentWillReceiveProps!="function"&&typeof N.componentWillReceiveProps!="function"||($!==mt||Xe!==Te)&&Vx(d,N,S,Te),kl=!1,Xe=d.memoizedState,N.state=Xe,af(d,S,N,w),tp();var Je=d.memoizedState;$!==mt||Xe!==Je||kl||u!==null&&u.dependencies!==null&&Yd(u.dependencies)?(typeof le=="function"&&(Nc(d,v,le,S),Je=d.memoizedState),(ct=kl||Qx(d,v,ct,S,Xe,Je,Te)||u!==null&&u.dependencies!==null&&Yd(u.dependencies))?(je||typeof N.UNSAFE_componentWillUpdate!="function"&&typeof N.componentWillUpdate!="function"||(typeof N.componentWillUpdate=="function"&&N.componentWillUpdate(S,Je,Te),typeof N.UNSAFE_componentWillUpdate=="function"&&N.UNSAFE_componentWillUpdate(S,Je,Te)),typeof N.componentDidUpdate=="function"&&(d.flags|=4),typeof N.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof N.componentDidUpdate!="function"||$===u.memoizedProps&&Xe===u.memoizedState||(d.flags|=4),typeof N.getSnapshotBeforeUpdate!="function"||$===u.memoizedProps&&Xe===u.memoizedState||(d.flags|=1024),d.memoizedProps=S,d.memoizedState=Je),N.props=S,N.state=Je,N.context=Te,S=ct):(typeof N.componentDidUpdate!="function"||$===u.memoizedProps&&Xe===u.memoizedState||(d.flags|=4),typeof N.getSnapshotBeforeUpdate!="function"||$===u.memoizedProps&&Xe===u.memoizedState||(d.flags|=1024),S=!1)}return N=S,Qu(u,d),S=(d.flags&128)!==0,N||S?(N=d.stateNode,v=S&&typeof v.getDerivedStateFromError!="function"?null:N.render(),d.flags|=1,u!==null&&S?(d.child=ku(d,u.child,null,w),d.child=ku(d,null,v,w)):cs(u,d,v,w),d.memoizedState=N.state,u=d.child):u=Hs(u,d,w),u}function Fc(u,d,v,S){return Zh(),d.flags|=256,cs(u,d,v,S),d.child}var vo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Eo(u){return{baseLanes:u,cachePool:qm()}}function Ms(u,d,v){return u=u!==null?u.childLanes&~v:0,d&&(u|=za),u}function pf(u,d,v){var S=d.pendingProps,w=!1,N=(d.flags&128)!==0,$;if(($=N)||($=u!==null&&u.memoizedState===null?!1:(ls.current&2)!==0),$&&(w=!0,d.flags&=-129),$=(d.flags&32)!==0,d.flags&=-33,u===null){if(ti){if(w?Oc(d):Pc(),ti){var le=Vi,Te;if(Te=le){e:{for(Te=le,le=ca;Te.nodeType!==8;){if(!le){le=null;break e}if(Te=Wl(Te.nextSibling),Te===null){le=null;break e}}le=Te}le!==null?(d.memoizedState={dehydrated:le,treeContext:Cc!==null?{id:jo,overflow:qo}:null,retryLane:536870912,hydrationErrors:null},Te=qr(18,null,null,0),Te.stateNode=le,Te.return=d,d.child=Te,wr=d,Vi=null,Te=!0):Te=!1}Te||Ic(d)}if(le=d.memoizedState,le!==null&&(le=le.dehydrated,le!==null))return XC(le)?d.lanes=32:d.lanes=536870912,null;Xo(d)}return le=S.children,S=S.fallback,w?(Pc(),w=d.mode,le=Vu({mode:"hidden",children:le},w),S=Tc(S,w,v,null),le.return=d,S.return=d,le.sibling=S,d.child=le,w=d.child,w.memoizedState=Eo(v),w.childLanes=Ms(u,$,v),d.memoizedState=vo,S):(Oc(d),$o(d,le))}if(Te=u.memoizedState,Te!==null&&(le=Te.dehydrated,le!==null)){if(N)d.flags&256?(Oc(d),d.flags&=-257,d=ar(u,d,v)):d.memoizedState!==null?(Pc(),d.child=u.child,d.flags|=128,d=null):(Pc(),w=S.fallback,le=d.mode,S=Vu({mode:"visible",children:S.children},le),w=Tc(w,le,v,null),w.flags|=2,S.return=d,w.return=d,S.sibling=w,d.child=S,ku(d,u.child,null,v),S=d.child,S.memoizedState=Eo(v),S.childLanes=Ms(u,$,v),d.memoizedState=vo,d=w);else if(Oc(d),XC(le)){if($=le.nextSibling&&le.nextSibling.dataset,$)var je=$.dgst;$=je,S=Error(n(419)),S.stack="",S.digest=$,Nu({value:S,source:null,stack:null}),d=ar(u,d,v)}else if(Gs||La(u,d,v,!1),$=(v&u.childLanes)!==0,Gs||$){if($=vn,$!==null&&(S=v&-v,S=(S&42)!==0?1:tn(S),S=(S&($.suspendedLanes|v))!==0?0:S,S!==0&&S!==Te.retryLane))throw Te.retryLane=S,Pl(u,S),Or($,u,S),Kx;le.data==="$?"||m(),d=ar(u,d,v)}else le.data==="$?"?(d.flags|=192,d.child=u.child,d=null):(u=Te.treeContext,Vi=Wl(le.nextSibling),wr=d,ti=!0,Da=null,ca=!1,u!==null&&(sr[la++]=jo,sr[la++]=qo,sr[la++]=Cc,jo=u.id,qo=u.overflow,Cc=d),d=$o(d,S.children),d.flags|=4096);return d}return w?(Pc(),w=S.fallback,le=d.mode,Te=u.child,je=Te.sibling,S=as(Te,{mode:"hidden",children:S.children}),S.subtreeFlags=Te.subtreeFlags&65011712,je!==null?w=as(je,w):(w=Tc(w,le,v,null),w.flags|=2),w.return=d,S.return=d,S.sibling=w,d.child=S,S=w,w=d.child,le=u.child.memoizedState,le===null?le=Eo(v):(Te=le.cachePool,Te!==null?(je=ys._currentValue,Te=Te.parent!==je?{parent:je,pool:je}:Te):Te=qm(),le={baseLanes:le.baseLanes|v,cachePool:Te}),w.memoizedState=le,w.childLanes=Ms(u,$,v),d.memoizedState=vo,S):(Oc(d),v=u.child,u=v.sibling,v=as(v,{mode:"visible",children:S.children}),v.return=d,v.sibling=null,u!==null&&($=d.deletions,$===null?(d.deletions=[u],d.flags|=16):$.push(u)),d.child=v,d.memoizedState=null,v)}function $o(u,d){return d=Vu({mode:"visible",children:d},u.mode),d.return=u,u.child=d}function Vu(u,d){return u=qr(22,u,null,d),u.lanes=0,u.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},u}function ar(u,d,v){return ku(d,u.child,null,v),u=$o(d,d.pendingProps.children),u.flags|=2,d.memoizedState=null,u}function or(u,d,v){u.lanes|=d;var S=u.alternate;S!==null&&(S.lanes|=d),z0(u.return,d,v)}function Xn(u,d,v,S,w){var N=u.memoizedState;N===null?u.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:S,tail:v,tailMode:w}:(N.isBackwards=d,N.rendering=null,N.renderingStartTime=0,N.last=S,N.tail=v,N.tailMode=w)}function Ua(u,d,v){var S=d.pendingProps,w=S.revealOrder,N=S.tail;if(cs(u,d,S.children,v),S=ls.current,(S&2)!==0)S=S&1|2,d.flags|=128;else{if(u!==null&&(u.flags&128)!==0)e:for(u=d.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&or(u,v,d);else if(u.tag===19)or(u,v,d);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===d)break e;for(;u.sibling===null;){if(u.return===null||u.return===d)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}S&=1}switch(Ee(ls,S),w){case"forwards":for(v=d.child,w=null;v!==null;)u=v.alternate,u!==null&&Vl(u)===null&&(w=v),v=v.sibling;v=w,v===null?(w=d.child,d.child=null):(w=v.sibling,v.sibling=null),Xn(d,!1,w,v,N);break;case"backwards":for(v=null,w=d.child,d.child=null;w!==null;){if(u=w.alternate,u!==null&&Vl(u)===null){d.child=w;break}u=w.sibling,w.sibling=v,v=w,w=u}Xn(d,!0,v,null,N);break;case"together":Xn(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function Hs(u,d,v){if(u!==null&&(d.dependencies=u.dependencies),bo|=d.lanes,(v&d.childLanes)===0)if(u!==null){if(La(u,d,v,!1),(v&d.childLanes)===0)return null}else return null;if(u!==null&&d.child!==u.child)throw Error(n(153));if(d.child!==null){for(u=d.child,v=as(u,u.pendingProps),d.child=v,v.return=d;u.sibling!==null;)u=u.sibling,v=v.sibling=as(u,u.pendingProps),v.return=d;v.sibling=null}return d.child}function cp(u,d){return(u.lanes&d)!==0?!0:(u=u.dependencies,!!(u!==null&&Yd(u)))}function ka(u,d,v){switch(d.tag){case 3:re(d,d.stateNode.containerInfo),wc(d,ys,u.memoizedState.cache),Zh();break;case 27:case 5:Ge(d);break;case 4:re(d,d.stateNode.containerInfo);break;case 10:wc(d,d.type,d.memoizedProps.value);break;case 13:var S=d.memoizedState;if(S!==null)return S.dehydrated!==null?(Oc(d),d.flags|=128,null):(v&d.child.childLanes)!==0?pf(u,d,v):(Oc(d),u=Hs(u,d,v),u!==null?u.sibling:null);Oc(d);break;case 19:var w=(u.flags&128)!==0;if(S=(v&d.childLanes)!==0,S||(La(u,d,v,!1),S=(v&d.childLanes)!==0),w){if(S)return Ua(u,d,v);d.flags|=128}if(w=d.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),Ee(ls,ls.current),S)break;return null;case 22:case 23:return d.lanes=0,Hu(u,d,v);case 24:wc(d,ys,u.memoizedState.cache)}return Hs(u,d,v)}function ju(u,d,v){if(u!==null)if(u.memoizedProps!==d.pendingProps)Gs=!0;else{if(!cp(u,v)&&(d.flags&128)===0)return Gs=!1,ka(u,d,v);Gs=(u.flags&131072)!==0}else Gs=!1,ti&&(d.flags&1048576)!==0&&Hm(d,Jh,d.index);switch(d.lanes=0,d.tag){case 16:e:{u=d.pendingProps;var S=d.elementType,w=S._init;if(S=w(S._payload),d.type=S,typeof S=="function")Vd(S)?(u=Wo(S,u),d.tag=1,d=da(null,d,S,u,v)):(d.tag=0,d=df(null,d,S,u,v));else{if(S!=null){if(w=S.$$typeof,w===I){d.tag=11,d=Yr(null,d,S,u,v);break e}else if(w===D){d.tag=14,d=Xr(null,d,S,u,v);break e}}throw d=z(S)||S,Error(n(306,d,""))}}return d;case 0:return df(u,d,d.type,d.pendingProps,v);case 1:return S=d.type,w=Wo(S,d.pendingProps),da(u,d,S,w,v);case 3:e:{if(re(d,d.stateNode.containerInfo),u===null)throw Error(n(387));S=d.pendingProps;var N=d.memoizedState;w=N.element,fn(u,d),af(d,S,null,v);var $=d.memoizedState;if(S=$.cache,wc(d,ys,S),S!==N.cache&&Kd(d,[ys],v,!0),tp(),S=$.element,N.isDehydrated)if(N={element:S,isDehydrated:!1,cache:$.cache},d.updateQueue.baseState=N,d.memoizedState=N,d.flags&256){d=Fc(u,d,S,v);break e}else if(S!==w){w=ir(Error(n(424)),d),Nu(w),d=Fc(u,d,S,v);break e}else{switch(u=d.stateNode.containerInfo,u.nodeType){case 9:u=u.body;break;default:u=u.nodeName==="HTML"?u.ownerDocument.body:u}for(Vi=Wl(u.firstChild),wr=d,ti=!0,Da=null,ca=!0,v=Hx(d,null,S,v),d.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling}else{if(Zh(),S===w){d=Hs(u,d,v);break e}cs(u,d,S,v)}d=d.child}return d;case 26:return Qu(u,d),u===null?(v=JD(d.type,null,d.pendingProps,null))?d.memoizedState=v:ti||(v=d.type,u=d.pendingProps,S=Zx(ie.current).createElement(v),S[Ji]=d,S[Ti]=u,Pr(S,v,u),Ye(S),d.stateNode=S):d.memoizedState=JD(d.type,u.memoizedProps,d.pendingProps,u.memoizedState),null;case 27:return Ge(d),u===null&&ti&&(S=d.stateNode=XD(d.type,d.pendingProps,ie.current),wr=d,ca=!0,w=Vi,bf(d.type)?(WC=w,Vi=Wl(S.firstChild)):Vi=w),cs(u,d,d.pendingProps.children,v),Qu(u,d),u===null&&(d.flags|=4194304),d.child;case 5:return u===null&&ti&&((w=S=Vi)&&(S=EQ(S,d.type,d.pendingProps,ca),S!==null?(d.stateNode=S,wr=d,Vi=Wl(S.firstChild),ca=!1,w=!0):w=!1),w||Ic(d)),Ge(d),w=d.type,N=d.pendingProps,$=u!==null?u.memoizedProps:null,S=N.children,qC(w,N)?S=null:$!==null&&qC(w,$)&&(d.flags|=32),d.memoizedState!==null&&(w=zl(u,d,wC,null,null,v),_y._currentValue=w),Qu(u,d),cs(u,d,S,v),d.child;case 6:return u===null&&ti&&((u=v=Vi)&&(v=xQ(v,d.pendingProps,ca),v!==null?(d.stateNode=v,wr=d,Vi=null,u=!0):u=!1),u||Ic(d)),null;case 13:return pf(u,d,v);case 4:return re(d,d.stateNode.containerInfo),S=d.pendingProps,u===null?d.child=ku(d,null,S,v):cs(u,d,S,v),d.child;case 11:return Yr(u,d,d.type,d.pendingProps,v);case 7:return cs(u,d,d.pendingProps,v),d.child;case 8:return cs(u,d,d.pendingProps.children,v),d.child;case 12:return cs(u,d,d.pendingProps.children,v),d.child;case 10:return S=d.pendingProps,wc(d,d.type,S.value),cs(u,d,S.children,v),d.child;case 9:return w=d.type._context,S=d.pendingProps.children,Ko(d),w=Zi(w),S=S(w),d.flags|=1,cs(u,d,S,v),d.child;case 14:return Xr(u,d,d.type,d.pendingProps,v);case 15:return hy(u,d,d.type,d.pendingProps,v);case 19:return Ua(u,d,v);case 31:return S=d.pendingProps,v=d.mode,S={mode:S.mode,children:S.children},u===null?(v=Vu(S,v),v.ref=d.ref,d.child=v,v.return=d,d=v):(v=as(u.child,S),v.ref=d.ref,d.child=v,v.return=d,d=v),d;case 22:return Hu(u,d,v);case 24:return Ko(d),S=Zi(ys),u===null?(w=Rc(),w===null&&(w=vn,N=Vm(),w.pooledCache=N,N.refCount++,N!==null&&(w.pooledCacheLanes|=v),w=N),d.memoizedState={parent:S,cache:w},q0(d),wc(d,ys,w)):((u.lanes&v)!==0&&(fn(u,d),af(d,null,null,v),tp()),w=u.memoizedState,N=d.memoizedState,w.parent!==S?(w={parent:S,cache:S},d.memoizedState=w,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=w),wc(d,ys,S)):(S=N.cache,wc(d,ys,S),S!==w.cache&&Kd(d,[ys],v,!0))),cs(u,d,d.pendingProps.children,v),d.child;case 29:throw d.pendingProps}throw Error(n(156,d.tag))}function xo(u){u.flags|=4}function up(u,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!iL(d)){if(d=gi.current,d!==null&&((en&4194048)===en?yo!==null:(en&62914560)!==en&&(en&536870912)===0||d!==yo))throw Pa=ep,V0;u.flags|=8192}}function jl(u,d){d!==null&&(u.flags|=4),u.flags&16384&&(d=u.tag!==22?Qe():536870912,u.lanes|=d,$n|=d)}function qu(u,d){if(!ti)switch(u.tailMode){case"hidden":d=u.tail;for(var v=null;d!==null;)d.alternate!==null&&(v=d),d=d.sibling;v===null?u.tail=null:v.sibling=null;break;case"collapsed":v=u.tail;for(var S=null;v!==null;)v.alternate!==null&&(S=v),v=v.sibling;S===null?d||u.tail===null?u.tail=null:u.tail.sibling=null:S.sibling=null}}function Ii(u){var d=u.alternate!==null&&u.alternate.child===u.child,v=0,S=0;if(d)for(var w=u.child;w!==null;)v|=w.lanes|w.childLanes,S|=w.subtreeFlags&65011712,S|=w.flags&65011712,w.return=u,w=w.sibling;else for(w=u.child;w!==null;)v|=w.lanes|w.childLanes,S|=w.subtreeFlags,S|=w.flags,w.return=u,w=w.sibling;return u.subtreeFlags|=S,u.childLanes=v,d}function fy(u,d,v){var S=d.pendingProps;switch(k0(d),d.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ii(d),null;case 1:return Ii(d),null;case 3:return v=d.stateNode,S=null,u!==null&&(S=u.memoizedState.cache),d.memoizedState.cache!==S&&(d.flags|=2048),Ul(ys),Be(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(u===null||u.child===null)&&(mo(d)?xo(d):u===null||u.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,si())),Ii(d),null;case 26:return v=d.memoizedState,u===null?(xo(d),v!==null?(Ii(d),up(d,v)):(Ii(d),d.flags&=-16777217)):v?v!==u.memoizedState?(xo(d),Ii(d),up(d,v)):(Ii(d),d.flags&=-16777217):(u.memoizedProps!==S&&xo(d),Ii(d),d.flags&=-16777217),null;case 27:Ue(d),v=ie.current;var w=d.type;if(u!==null&&d.stateNode!=null)u.memoizedProps!==S&&xo(d);else{if(!S){if(d.stateNode===null)throw Error(n(166));return Ii(d),null}u=Ce.current,mo(d)?rx(d):(u=XD(w,S,v),d.stateNode=u,xo(d))}return Ii(d),null;case 5:if(Ue(d),v=d.type,u!==null&&d.stateNode!=null)u.memoizedProps!==S&&xo(d);else{if(!S){if(d.stateNode===null)throw Error(n(166));return Ii(d),null}if(u=Ce.current,mo(d))rx(d);else{switch(w=Zx(ie.current),u){case 1:u=w.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:u=w.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":u=w.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":u=w.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":u=w.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof S.is=="string"?w.createElement("select",{is:S.is}):w.createElement("select"),S.multiple?u.multiple=!0:S.size&&(u.size=S.size);break;default:u=typeof S.is=="string"?w.createElement(v,{is:S.is}):w.createElement(v)}}u[Ji]=d,u[Ti]=S;e:for(w=d.child;w!==null;){if(w.tag===5||w.tag===6)u.appendChild(w.stateNode);else if(w.tag!==4&&w.tag!==27&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===d)break e;for(;w.sibling===null;){if(w.return===null||w.return===d)break e;w=w.return}w.sibling.return=w.return,w=w.sibling}d.stateNode=u;e:switch(Pr(u,v,S),v){case"button":case"input":case"select":case"textarea":u=!!S.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&xo(d)}}return Ii(d),d.flags&=-16777217,null;case 6:if(u&&d.stateNode!=null)u.memoizedProps!==S&&xo(d);else{if(typeof S!="string"&&d.stateNode===null)throw Error(n(166));if(u=ie.current,mo(d)){if(u=d.stateNode,v=d.memoizedProps,S=null,w=wr,w!==null)switch(w.tag){case 27:case 5:S=w.memoizedProps}u[Ji]=d,u=!!(u.nodeValue===v||S!==null&&S.suppressHydrationWarning===!0||zD(u.nodeValue,v)),u||Ic(d)}else u=Zx(u).createTextNode(S),u[Ji]=d,d.stateNode=u}return Ii(d),null;case 13:if(S=d.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(w=mo(d),S!==null&&S.dehydrated!==null){if(u===null){if(!w)throw Error(n(318));if(w=d.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(n(317));w[Ji]=d}else Zh(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;Ii(d),w=!1}else w=si(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=w),w=!0;if(!w)return d.flags&256?(Xo(d),d):(Xo(d),null)}if(Xo(d),(d.flags&128)!==0)return d.lanes=v,d;if(v=S!==null,u=u!==null&&u.memoizedState!==null,v){S=d.child,w=null,S.alternate!==null&&S.alternate.memoizedState!==null&&S.alternate.memoizedState.cachePool!==null&&(w=S.alternate.memoizedState.cachePool.pool);var N=null;S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(N=S.memoizedState.cachePool.pool),N!==w&&(S.flags|=2048)}return v!==u&&v&&(d.child.flags|=8192),jl(d,d.updateQueue),Ii(d),null;case 4:return Be(),u===null&&HC(d.stateNode.containerInfo),Ii(d),null;case 10:return Ul(d.type),Ii(d),null;case 19:if(oe(ls),w=d.memoizedState,w===null)return Ii(d),null;if(S=(d.flags&128)!==0,N=w.rendering,N===null)if(S)qu(w,!1);else{if(Pi!==0||u!==null&&(u.flags&128)!==0)for(u=d.child;u!==null;){if(N=Vl(u),N!==null){for(d.flags|=128,qu(w,!1),u=N.updateQueue,d.updateQueue=u,jl(d,u),d.subtreeFlags=0,u=v,v=d.child;v!==null;)F0(v,u),v=v.sibling;return Ee(ls,ls.current&1|2),d.child}u=u.sibling}w.tail!==null&&be()>yr&&(d.flags|=128,S=!0,qu(w,!1),d.lanes=4194304)}else{if(!S)if(u=Vl(N),u!==null){if(d.flags|=128,S=!0,u=u.updateQueue,d.updateQueue=u,jl(d,u),qu(w,!0),w.tail===null&&w.tailMode==="hidden"&&!N.alternate&&!ti)return Ii(d),null}else 2*be()-w.renderingStartTime>yr&&v!==536870912&&(d.flags|=128,S=!0,qu(w,!1),d.lanes=4194304);w.isBackwards?(N.sibling=d.child,d.child=N):(u=w.last,u!==null?u.sibling=N:d.child=N,w.last=N)}return w.tail!==null?(d=w.tail,w.rendering=d,w.tail=d.sibling,w.renderingStartTime=be(),d.sibling=null,u=ls.current,Ee(ls,S?u&1|2:u&1),d):(Ii(d),null);case 22:case 23:return Xo(d),np(),S=d.memoizedState!==null,u!==null?u.memoizedState!==null!==S&&(d.flags|=8192):S&&(d.flags|=8192),S?(v&536870912)!==0&&(d.flags&128)===0&&(Ii(d),d.subtreeFlags&6&&(d.flags|=8192)):Ii(d),v=d.updateQueue,v!==null&&jl(d,v.retryQueue),v=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(v=u.memoizedState.cachePool.pool),S=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(S=d.memoizedState.cachePool.pool),S!==v&&(d.flags|=2048),u!==null&&oe(Oa),null;case 24:return v=null,u!==null&&(v=u.memoizedState.cache),d.memoizedState.cache!==v&&(d.flags|=2048),Ul(ys),Ii(d),null;case 25:return null;case 30:return null}throw Error(n(156,d.tag))}function mf(u,d){switch(k0(d),d.tag){case 1:return u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 3:return Ul(ys),Be(),u=d.flags,(u&65536)!==0&&(u&128)===0?(d.flags=u&-65537|128,d):null;case 26:case 27:case 5:return Ue(d),null;case 13:if(Xo(d),u=d.memoizedState,u!==null&&u.dehydrated!==null){if(d.alternate===null)throw Error(n(340));Zh()}return u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 19:return oe(ls),null;case 4:return Be(),null;case 10:return Ul(d.type),null;case 22:case 23:return Xo(d),np(),u!==null&&oe(Oa),u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 24:return Ul(ys),null;case 25:return null;default:return null}}function gf(u,d){switch(k0(d),d.tag){case 3:Ul(ys),Be();break;case 26:case 27:case 5:Ue(d);break;case 4:Be();break;case 13:Xo(d);break;case 19:oe(ls);break;case 10:Ul(d.type);break;case 22:case 23:Xo(d),np(),u!==null&&oe(Oa);break;case 24:Ul(ys)}}function Ku(u,d){try{var v=d.updateQueue,S=v!==null?v.lastEffect:null;if(S!==null){var w=S.next;v=w;do{if((v.tag&u)===u){S=void 0;var N=v.create,$=v.inst;S=N(),$.destroy=S}v=v.next}while(v!==w)}}catch(le){De(d,d.return,le)}}function pa(u,d,v){try{var S=d.updateQueue,w=S!==null?S.lastEffect:null;if(w!==null){var N=w.next;S=N;do{if((S.tag&u)===u){var $=S.inst,le=$.destroy;if(le!==void 0){$.destroy=void 0,w=d;var Te=v,je=le;try{je()}catch(ct){De(w,Te,ct)}}}S=S.next}while(S!==N)}}catch(ct){De(d,d.return,ct)}}function Yu(u){var d=u.updateQueue;if(d!==null){var v=u.stateNode;try{lx(d,v)}catch(S){De(u,u.return,S)}}}function ql(u,d,v){v.props=Wo(u.type,u.memoizedProps),v.state=u.memoizedState;try{v.componentWillUnmount()}catch(S){De(u,d,S)}}function Xu(u,d){try{var v=u.ref;if(v!==null){switch(u.tag){case 26:case 27:case 5:var S=u.stateNode;break;case 30:S=u.stateNode;break;default:S=u.stateNode}typeof v=="function"?u.refCleanup=v(S):v.current=S}}catch(w){De(u,d,w)}}function Jo(u,d){var v=u.ref,S=u.refCleanup;if(v!==null)if(typeof S=="function")try{S()}catch(w){De(u,d,w)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof v=="function")try{v(null)}catch(w){De(u,d,w)}else v.current=null}function Af(u){var d=u.type,v=u.memoizedProps,S=u.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":v.autoFocus&&S.focus();break e;case"img":v.src?S.src=v.src:v.srcSet&&(S.srcset=v.srcSet)}}catch(w){De(u,u.return,w)}}function hp(u,d,v){try{var S=u.stateNode;mQ(S,u.type,v,d),S[Ti]=d}catch(w){De(u,u.return,w)}}function fp(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&bf(u.type)||u.tag===4}function Uc(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||fp(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&bf(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function kc(u,d,v){var S=u.tag;if(S===5||S===6)u=u.stateNode,d?(v.nodeType===9?v.body:v.nodeName==="HTML"?v.ownerDocument.body:v).insertBefore(u,d):(d=v.nodeType===9?v.body:v.nodeName==="HTML"?v.ownerDocument.body:v,d.appendChild(u),v=v._reactRootContainer,v!=null||d.onclick!==null||(d.onclick=Jx));else if(S!==4&&(S===27&&bf(u.type)&&(v=u.stateNode,d=null),u=u.child,u!==null))for(kc(u,d,v),u=u.sibling;u!==null;)kc(u,d,v),u=u.sibling}function Gc(u,d,v){var S=u.tag;if(S===5||S===6)u=u.stateNode,d?v.insertBefore(u,d):v.appendChild(u);else if(S!==4&&(S===27&&bf(u.type)&&(v=u.stateNode),u=u.child,u!==null))for(Gc(u,d,v),u=u.sibling;u!==null;)Gc(u,d,v),u=u.sibling}function Hc(u){var d=u.stateNode,v=u.memoizedProps;try{for(var S=u.type,w=d.attributes;w.length;)d.removeAttributeNode(w[0]);Pr(d,S,v),d[Ji]=u,d[Ti]=v}catch(N){De(u,u.return,N)}}var Zo=!1,Mi=!1,yf=!1,ma=typeof WeakSet=="function"?WeakSet:Set,Ai=null;function ws(u,d){if(u=u.containerInfo,VC=r_,u=R0(u),Gd(u)){if("selectionStart"in u)var v={start:u.selectionStart,end:u.selectionEnd};else e:{v=(v=u.ownerDocument)&&v.defaultView||window;var S=v.getSelection&&v.getSelection();if(S&&S.rangeCount!==0){v=S.anchorNode;var w=S.anchorOffset,N=S.focusNode;S=S.focusOffset;try{v.nodeType,N.nodeType}catch{v=null;break e}var $=0,le=-1,Te=-1,je=0,ct=0,mt=u,Xe=null;t:for(;;){for(var Je;mt!==v||w!==0&&mt.nodeType!==3||(le=$+w),mt!==N||S!==0&&mt.nodeType!==3||(Te=$+S),mt.nodeType===3&&($+=mt.nodeValue.length),(Je=mt.firstChild)!==null;)Xe=mt,mt=Je;for(;;){if(mt===u)break t;if(Xe===v&&++je===w&&(le=$),Xe===N&&++ct===S&&(Te=$),(Je=mt.nextSibling)!==null)break;mt=Xe,Xe=mt.parentNode}mt=Je}v=le===-1||Te===-1?null:{start:le,end:Te}}else v=null}v=v||{start:0,end:0}}else v=null;for(jC={focusedElem:u,selectionRange:v},r_=!1,Ai=d;Ai!==null;)if(d=Ai,u=d.child,(d.subtreeFlags&1024)!==0&&u!==null)u.return=d,Ai=u;else for(;Ai!==null;){switch(d=Ai,N=d.alternate,u=d.flags,d.tag){case 0:break;case 11:case 15:break;case 1:if((u&1024)!==0&&N!==null){u=void 0,v=d,w=N.memoizedProps,N=N.memoizedState,S=v.stateNode;try{var mn=Wo(v.type,w,v.elementType===v.type);u=S.getSnapshotBeforeUpdate(mn,N),S.__reactInternalSnapshotBeforeUpdate=u}catch(ln){De(v,v.return,ln)}}break;case 3:if((u&1024)!==0){if(u=d.stateNode.containerInfo,v=u.nodeType,v===9)YC(u);else if(v===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":YC(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(n(163))}if(u=d.sibling,u!==null){u.return=d.return,Ai=u;break}Ai=d.return}}function Kl(u,d,v){var S=v.flags;switch(v.tag){case 0:case 11:case 15:Lr(u,v),S&4&&Ku(5,v);break;case 1:if(Lr(u,v),S&4)if(u=v.stateNode,d===null)try{u.componentDidMount()}catch($){De(v,v.return,$)}else{var w=Wo(v.type,d.memoizedProps);d=d.memoizedState;try{u.componentDidUpdate(w,d,u.__reactInternalSnapshotBeforeUpdate)}catch($){De(v,v.return,$)}}S&64&&Yu(v),S&512&&Xu(v,v.return);break;case 3:if(Lr(u,v),S&64&&(u=v.updateQueue,u!==null)){if(d=null,v.child!==null)switch(v.child.tag){case 27:case 5:d=v.child.stateNode;break;case 1:d=v.child.stateNode}try{lx(u,d)}catch($){De(v,v.return,$)}}break;case 27:d===null&&S&4&&Hc(v);case 26:case 5:Lr(u,v),d===null&&S&4&&Af(v),S&512&&Xu(v,v.return);break;case 12:Lr(u,v);break;case 13:Lr(u,v),S&4&&zc(u,v),S&64&&(u=v.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(v=Ni.bind(null,v),_Q(u,v))));break;case 22:if(S=v.memoizedState!==null||Zo,!S){d=d!==null&&d.memoizedState!==null||Mi,w=Zo;var N=Mi;Zo=S,(Mi=d)&&!N?el(u,v,(v.subtreeFlags&8772)!==0):Lr(u,v),Zo=w,Mi=N}break;case 30:break;default:Lr(u,v)}}function Mn(u){var d=u.alternate;d!==null&&(u.alternate=null,Mn(d)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(d=u.stateNode,d!==null&&pi(d)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var sn=null,Wn=!1;function Ga(u,d,v){for(v=v.child;v!==null;)Wu(u,d,v),v=v.sibling}function Wu(u,d,v){if(rt&&typeof rt.onCommitFiberUnmount=="function")try{rt.onCommitFiberUnmount(Ve,v)}catch{}switch(v.tag){case 26:Mi||Jo(v,d),Ga(u,d,v),v.memoizedState?v.memoizedState.count--:v.stateNode&&(v=v.stateNode,v.parentNode.removeChild(v));break;case 27:Mi||Jo(v,d);var S=sn,w=Wn;bf(v.type)&&(sn=v.stateNode,Wn=!1),Ga(u,d,v),yy(v.stateNode),sn=S,Wn=w;break;case 5:Mi||Jo(v,d);case 6:if(S=sn,w=Wn,sn=null,Ga(u,d,v),sn=S,Wn=w,sn!==null)if(Wn)try{(sn.nodeType===9?sn.body:sn.nodeName==="HTML"?sn.ownerDocument.body:sn).removeChild(v.stateNode)}catch(N){De(v,d,N)}else try{sn.removeChild(v.stateNode)}catch(N){De(v,d,N)}break;case 18:sn!==null&&(Wn?(u=sn,KD(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,v.stateNode),Cy(u)):KD(sn,v.stateNode));break;case 4:S=sn,w=Wn,sn=v.stateNode.containerInfo,Wn=!0,Ga(u,d,v),sn=S,Wn=w;break;case 0:case 11:case 14:case 15:Mi||pa(2,v,d),Mi||pa(4,v,d),Ga(u,d,v);break;case 1:Mi||(Jo(v,d),S=v.stateNode,typeof S.componentWillUnmount=="function"&&ql(v,d,S)),Ga(u,d,v);break;case 21:Ga(u,d,v);break;case 22:Mi=(S=Mi)||v.memoizedState!==null,Ga(u,d,v),Mi=S;break;default:Ga(u,d,v)}}function zc(u,d){if(d.memoizedState===null&&(u=d.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{Cy(u)}catch(v){De(d,d.return,v)}}function hg(u){switch(u.tag){case 13:case 19:var d=u.stateNode;return d===null&&(d=u.stateNode=new ma),d;case 22:return u=u.stateNode,d=u._retryCache,d===null&&(d=u._retryCache=new ma),d;default:throw Error(n(435,u.tag))}}function $u(u,d){var v=hg(u);d.forEach(function(S){var w=dn.bind(null,u,S);v.has(S)||(v.add(S),S.then(w,w))})}function zs(u,d){var v=d.deletions;if(v!==null)for(var S=0;S<v.length;S++){var w=v[S],N=u,$=d,le=$;e:for(;le!==null;){switch(le.tag){case 27:if(bf(le.type)){sn=le.stateNode,Wn=!1;break e}break;case 5:sn=le.stateNode,Wn=!1;break e;case 3:case 4:sn=le.stateNode.containerInfo,Wn=!0;break e}le=le.return}if(sn===null)throw Error(n(160));Wu(N,$,w),sn=null,Wn=!1,N=w.alternate,N!==null&&(N.return=null),w.return=null}if(d.subtreeFlags&13878)for(d=d.child;d!==null;)fg(d,u),d=d.sibling}var _o=null;function fg(u,d){var v=u.alternate,S=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:zs(d,u),es(u),S&4&&(pa(3,u,u.return),Ku(3,u),pa(5,u,u.return));break;case 1:zs(d,u),es(u),S&512&&(Mi||v===null||Jo(v,v.return)),S&64&&Zo&&(u=u.updateQueue,u!==null&&(S=u.callbacks,S!==null&&(v=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=v===null?S:v.concat(S))));break;case 26:var w=_o;if(zs(d,u),es(u),S&512&&(Mi||v===null||Jo(v,v.return)),S&4){var N=v!==null?v.memoizedState:null;if(S=u.memoizedState,v===null)if(S===null)if(u.stateNode===null){e:{S=u.type,v=u.memoizedProps,w=w.ownerDocument||w;t:switch(S){case"title":N=w.getElementsByTagName("title")[0],(!N||N[mr]||N[Ji]||N.namespaceURI==="http://www.w3.org/2000/svg"||N.hasAttribute("itemprop"))&&(N=w.createElement(S),w.head.insertBefore(N,w.querySelector("head > title"))),Pr(N,S,v),N[Ji]=u,Ye(N),S=N;break e;case"link":var $=tL("link","href",w).get(S+(v.href||""));if($){for(var le=0;le<$.length;le++)if(N=$[le],N.getAttribute("href")===(v.href==null||v.href===""?null:v.href)&&N.getAttribute("rel")===(v.rel==null?null:v.rel)&&N.getAttribute("title")===(v.title==null?null:v.title)&&N.getAttribute("crossorigin")===(v.crossOrigin==null?null:v.crossOrigin)){$.splice(le,1);break t}}N=w.createElement(S),Pr(N,S,v),w.head.appendChild(N);break;case"meta":if($=tL("meta","content",w).get(S+(v.content||""))){for(le=0;le<$.length;le++)if(N=$[le],N.getAttribute("content")===(v.content==null?null:""+v.content)&&N.getAttribute("name")===(v.name==null?null:v.name)&&N.getAttribute("property")===(v.property==null?null:v.property)&&N.getAttribute("http-equiv")===(v.httpEquiv==null?null:v.httpEquiv)&&N.getAttribute("charset")===(v.charSet==null?null:v.charSet)){$.splice(le,1);break t}}N=w.createElement(S),Pr(N,S,v),w.head.appendChild(N);break;default:throw Error(n(468,S))}N[Ji]=u,Ye(N),S=N}u.stateNode=S}else nL(w,u.type,u.stateNode);else u.stateNode=eL(w,S,u.memoizedProps);else N!==S?(N===null?v.stateNode!==null&&(v=v.stateNode,v.parentNode.removeChild(v)):N.count--,S===null?nL(w,u.type,u.stateNode):eL(w,S,u.memoizedProps)):S===null&&u.stateNode!==null&&hp(u,u.memoizedProps,v.memoizedProps)}break;case 27:zs(d,u),es(u),S&512&&(Mi||v===null||Jo(v,v.return)),v!==null&&S&4&&hp(u,u.memoizedProps,v.memoizedProps);break;case 5:if(zs(d,u),es(u),S&512&&(Mi||v===null||Jo(v,v.return)),u.flags&32){w=u.stateNode;try{Cs(w,"")}catch(Je){De(u,u.return,Je)}}S&4&&u.stateNode!=null&&(w=u.memoizedProps,hp(u,w,v!==null?v.memoizedProps:w)),S&1024&&(yf=!0);break;case 6:if(zs(d,u),es(u),S&4){if(u.stateNode===null)throw Error(n(162));S=u.memoizedProps,v=u.stateNode;try{v.nodeValue=S}catch(Je){De(u,u.return,Je)}}break;case 3:if(n_=null,w=_o,_o=e_(d.containerInfo),zs(d,u),_o=w,es(u),S&4&&v!==null&&v.memoizedState.isDehydrated)try{Cy(d.containerInfo)}catch(Je){De(u,u.return,Je)}yf&&(yf=!1,Qc(u));break;case 4:S=_o,_o=e_(u.stateNode.containerInfo),zs(d,u),es(u),_o=S;break;case 12:zs(d,u),es(u);break;case 13:zs(d,u),es(u),u.child.flags&8192&&u.memoizedState!==null!=(v!==null&&v.memoizedState!==null)&&(mi=be()),S&4&&(S=u.updateQueue,S!==null&&(u.updateQueue=null,$u(u,S)));break;case 22:w=u.memoizedState!==null;var Te=v!==null&&v.memoizedState!==null,je=Zo,ct=Mi;if(Zo=je||w,Mi=ct||Te,zs(d,u),Mi=ct,Zo=je,es(u),S&8192)e:for(d=u.stateNode,d._visibility=w?d._visibility&-2:d._visibility|1,w&&(v===null||Te||Zo||Mi||ga(u)),v=null,d=u;;){if(d.tag===5||d.tag===26){if(v===null){Te=v=d;try{if(N=Te.stateNode,w)$=N.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none";else{le=Te.stateNode;var mt=Te.memoizedProps.style,Xe=mt!=null&&mt.hasOwnProperty("display")?mt.display:null;le.style.display=Xe==null||typeof Xe=="boolean"?"":(""+Xe).trim()}}catch(Je){De(Te,Te.return,Je)}}}else if(d.tag===6){if(v===null){Te=d;try{Te.stateNode.nodeValue=w?"":Te.memoizedProps}catch(Je){De(Te,Te.return,Je)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===u)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===u)break e;for(;d.sibling===null;){if(d.return===null||d.return===u)break e;v===d&&(v=null),d=d.return}v===d&&(v=null),d.sibling.return=d.return,d=d.sibling}S&4&&(S=u.updateQueue,S!==null&&(v=S.retryQueue,v!==null&&(S.retryQueue=null,$u(u,v))));break;case 19:zs(d,u),es(u),S&4&&(S=u.updateQueue,S!==null&&(u.updateQueue=null,$u(u,S)));break;case 30:break;case 21:break;default:zs(d,u),es(u)}}function es(u){var d=u.flags;if(d&2){try{for(var v,S=u.return;S!==null;){if(fp(S)){v=S;break}S=S.return}if(v==null)throw Error(n(160));switch(v.tag){case 27:var w=v.stateNode,N=Uc(u);Gc(u,N,w);break;case 5:var $=v.stateNode;v.flags&32&&(Cs($,""),v.flags&=-33);var le=Uc(u);Gc(u,le,$);break;case 3:case 4:var Te=v.stateNode.containerInfo,je=Uc(u);kc(u,je,Te);break;default:throw Error(n(161))}}catch(ct){De(u,u.return,ct)}u.flags&=-3}d&4096&&(u.flags&=-4097)}function Qc(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var d=u;Qc(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),u=u.sibling}}function Lr(u,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)Kl(u,d.alternate,d),d=d.sibling}function ga(u){for(u=u.child;u!==null;){var d=u;switch(d.tag){case 0:case 11:case 14:case 15:pa(4,d,d.return),ga(d);break;case 1:Jo(d,d.return);var v=d.stateNode;typeof v.componentWillUnmount=="function"&&ql(d,d.return,v),ga(d);break;case 27:yy(d.stateNode);case 26:case 5:Jo(d,d.return),ga(d);break;case 22:d.memoizedState===null&&ga(d);break;case 30:ga(d);break;default:ga(d)}u=u.sibling}}function el(u,d,v){for(v=v&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var S=d.alternate,w=u,N=d,$=N.flags;switch(N.tag){case 0:case 11:case 15:el(w,N,v),Ku(4,N);break;case 1:if(el(w,N,v),S=N,w=S.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(je){De(S,S.return,je)}if(S=N,w=S.updateQueue,w!==null){var le=S.stateNode;try{var Te=w.shared.hiddenCallbacks;if(Te!==null)for(w.shared.hiddenCallbacks=null,w=0;w<Te.length;w++)of(Te[w],le)}catch(je){De(S,S.return,je)}}v&&$&64&&Yu(N),Xu(N,N.return);break;case 27:Hc(N);case 26:case 5:el(w,N,v),v&&S===null&&$&4&&Af(N),Xu(N,N.return);break;case 12:el(w,N,v);break;case 13:el(w,N,v),v&&$&4&&zc(w,N);break;case 22:N.memoizedState===null&&el(w,N,v),Xu(N,N.return);break;case 30:break;default:el(w,N,v)}d=d.sibling}}function dg(u,d){var v=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(v=u.memoizedState.cachePool.pool),u=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(u=d.memoizedState.cachePool.pool),u!==v&&(u!=null&&u.refCount++,v!=null&&ef(v))}function pg(u,d){u=null,d.alternate!==null&&(u=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==u&&(d.refCount++,u!=null&&ef(u))}function yi(u,d,v,S){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)mg(u,d,v,S),d=d.sibling}function mg(u,d,v,S){var w=d.flags;switch(d.tag){case 0:case 11:case 15:yi(u,d,v,S),w&2048&&Ku(9,d);break;case 1:yi(u,d,v,S);break;case 3:yi(u,d,v,S),w&2048&&(u=null,d.alternate!==null&&(u=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==u&&(d.refCount++,u!=null&&ef(u)));break;case 12:if(w&2048){yi(u,d,v,S),u=d.stateNode;try{var N=d.memoizedProps,$=N.id,le=N.onPostCommit;typeof le=="function"&&le($,d.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(Te){De(d,d.return,Te)}}else yi(u,d,v,S);break;case 13:yi(u,d,v,S);break;case 23:break;case 22:N=d.stateNode,$=d.alternate,d.memoizedState!==null?N._visibility&2?yi(u,d,v,S):So(u,d):N._visibility&2?yi(u,d,v,S):(N._visibility|=2,Yl(u,d,v,S,(d.subtreeFlags&10256)!==0)),w&2048&&dg($,d);break;case 24:yi(u,d,v,S),w&2048&&pg(d.alternate,d);break;default:yi(u,d,v,S)}}function Yl(u,d,v,S,w){for(w=w&&(d.subtreeFlags&10256)!==0,d=d.child;d!==null;){var N=u,$=d,le=v,Te=S,je=$.flags;switch($.tag){case 0:case 11:case 15:Yl(N,$,le,Te,w),Ku(8,$);break;case 23:break;case 22:var ct=$.stateNode;$.memoizedState!==null?ct._visibility&2?Yl(N,$,le,Te,w):So(N,$):(ct._visibility|=2,Yl(N,$,le,Te,w)),w&&je&2048&&dg($.alternate,$);break;case 24:Yl(N,$,le,Te,w),w&&je&2048&&pg($.alternate,$);break;default:Yl(N,$,le,Te,w)}d=d.sibling}}function So(u,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var v=u,S=d,w=S.flags;switch(S.tag){case 22:So(v,S),w&2048&&dg(S.alternate,S);break;case 24:So(v,S),w&2048&&pg(S.alternate,S);break;default:So(v,S)}d=d.sibling}}var Aa=8192;function vf(u){if(u.subtreeFlags&Aa)for(u=u.child;u!==null;)Yx(u),u=u.sibling}function Yx(u){switch(u.tag){case 26:vf(u),u.flags&Aa&&u.memoizedState!==null&&PQ(_o,u.memoizedState,u.memoizedProps);break;case 5:vf(u);break;case 3:case 4:var d=_o;_o=e_(u.stateNode.containerInfo),vf(u),_o=d;break;case 22:u.memoizedState===null&&(d=u.alternate,d!==null&&d.memoizedState!==null?(d=Aa,Aa=16777216,vf(u),Aa=d):vf(u));break;default:vf(u)}}function Xx(u){var d=u.alternate;if(d!==null&&(u=d.child,u!==null)){d.child=null;do d=u.sibling,u.sibling=null,u=d;while(u!==null)}}function wi(u){var d=u.deletions;if((u.flags&16)!==0){if(d!==null)for(var v=0;v<d.length;v++){var S=d[v];Ai=S,nl(S,u)}Xx(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)dy(u),u=u.sibling}function dy(u){switch(u.tag){case 0:case 11:case 15:wi(u),u.flags&2048&&pa(9,u,u.return);break;case 3:wi(u);break;case 12:wi(u);break;case 22:var d=u.stateNode;u.memoizedState!==null&&d._visibility&2&&(u.return===null||u.return.tag!==13)?(d._visibility&=-3,tl(u)):wi(u);break;default:wi(u)}}function tl(u){var d=u.deletions;if((u.flags&16)!==0){if(d!==null)for(var v=0;v<d.length;v++){var S=d[v];Ai=S,nl(S,u)}Xx(u)}for(u=u.child;u!==null;){switch(d=u,d.tag){case 0:case 11:case 15:pa(8,d,d.return),tl(d);break;case 22:v=d.stateNode,v._visibility&2&&(v._visibility&=-3,tl(d));break;default:tl(d)}u=u.sibling}}function nl(u,d){for(;Ai!==null;){var v=Ai;switch(v.tag){case 0:case 11:case 15:pa(8,v,d);break;case 23:case 22:if(v.memoizedState!==null&&v.memoizedState.cachePool!==null){var S=v.memoizedState.cachePool.pool;S!=null&&S.refCount++}break;case 24:ef(v.memoizedState.cache)}if(S=v.child,S!==null)S.return=v,Ai=S;else e:for(v=u;Ai!==null;){S=Ai;var w=S.sibling,N=S.return;if(Mn(S),S===v){Ai=null;break e}if(w!==null){w.return=N,Ai=w;break e}Ai=N}}}var ts={getCacheForType:function(u){var d=Zi(ys),v=d.data.get(u);return v===void 0&&(v=u(),d.data.set(u,v)),v}},py=typeof WeakMap=="function"?WeakMap:Map,ri=0,vn=null,On=null,en=0,bn=0,ji=null,ya=!1,Ef=!1,xf=!1,Ha=0,Pi=0,bo=0,il=0,Ju=0,za=0,$n=0,ai=null,rn=null,kn=!1,mi=0,yr=1/0,Qa=null,va=null,Rs=0,vr=null,vi=null,Ea=0,Xl=0,dp=null,xa=null,sl=0,Zu=null;function ns(){if((ri&2)!==0&&en!==0)return en&-en;if(k.T!==null){var u=_n;return u!==0?u:FC()}return Ln()}function gg(){za===0&&(za=(en&536870912)===0||ti?Oe():536870912);var u=gi.current;return u!==null&&(u.flags|=32),za}function Or(u,d,v){(u===vn&&(bn===2||bn===9)||u.cancelPendingCommit!==null)&&(jc(u,0),To(u,en,za,!1)),Nt(u,v),((ri&2)===0||u!==vn)&&(u===vn&&((ri&2)===0&&(il|=v),Pi===4&&To(u,en,za,!1)),Yc(u))}function _f(u,d,v){if((ri&6)!==0)throw Error(n(327));var S=!v&&(d&124)===0&&(d&u.expiredLanes)===0||vt(u,d),w=S?B(u,d):A(u,d,!0),N=S;do{if(w===0){Ef&&!S&&To(u,d,0,!1);break}else{if(v=u.current.alternate,N&&!Vc(v)){w=A(u,d,!1),N=!1;continue}if(w===2){if(N=d,u.errorRecoveryDisabledLanes&N)var $=0;else $=u.pendingLanes&-536870913,$=$!==0?$:$&536870912?536870912:0;if($!==0){d=$;e:{var le=u;w=ai;var Te=le.current.memoizedState.isDehydrated;if(Te&&(jc(le,$).flags|=256),$=A(le,$,!1),$!==2){if(xf&&!Te){le.errorRecoveryDisabledLanes|=N,il|=N,w=4;break e}N=rn,rn=w,N!==null&&(rn===null?rn=N:rn.push.apply(rn,N))}w=$}if(N=!1,w!==2)continue}}if(w===1){jc(u,0),To(u,d,0,!0);break}e:{switch(S=u,N=w,N){case 0:case 1:throw Error(n(345));case 4:if((d&4194048)!==d)break;case 6:To(S,d,za,!ya);break e;case 2:rn=null;break;case 3:case 5:break;default:throw Error(n(329))}if((d&62914560)===d&&(w=mi+300-be(),10<w)){if(To(S,d,za,!ya),Ut(S,0,!0)!==0)break e;S.timeoutHandle=jD(pp.bind(null,S,v,rn,Qa,kn,d,za,il,$n,ya,N,2,-0,0),w);break e}pp(S,v,rn,Qa,kn,d,za,il,$n,ya,N,0,-0,0)}}break}while(!0);Yc(u)}function pp(u,d,v,S,w,N,$,le,Te,je,ct,mt,Xe,Je){if(u.timeoutHandle=-1,mt=d.subtreeFlags,(mt&8192||(mt&16785408)===16785408)&&(xy={stylesheets:null,count:0,unsuspend:OQ},Yx(d),mt=NQ(),mt!==null)){u.cancelPendingCommit=mt(Ct.bind(null,u,d,N,v,S,w,$,le,Te,ct,1,Xe,Je)),To(u,N,$,!je);return}Ct(u,d,N,v,S,w,$,le,Te)}function Vc(u){for(var d=u;;){var v=d.tag;if((v===0||v===11||v===15)&&d.flags&16384&&(v=d.updateQueue,v!==null&&(v=v.stores,v!==null)))for(var S=0;S<v.length;S++){var w=v[S],N=w.getSnapshot;w=w.value;try{if(!Qr(N(),w))return!1}catch{return!1}}if(v=d.child,d.subtreeFlags&16384&&v!==null)v.return=d,d=v;else{if(d===u)break;for(;d.sibling===null;){if(d.return===null||d.return===u)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function To(u,d,v,S){d&=~Ju,d&=~il,u.suspendedLanes|=d,u.pingedLanes&=~d,S&&(u.warmLanes|=d),S=u.expirationTimes;for(var w=d;0<w;){var N=31-Mt(w),$=1<<N;S[N]=-1,w&=~$}v!==0&&dt(u,v,d)}function rl(){return(ri&6)===0?(my(0),!1):!0}function eh(){if(On!==null){if(bn===0)var u=On.return;else u=On,Fl=Mc=null,W0(u),Uu=null,ap=0,u=On;for(;u!==null;)gf(u.alternate,u),u=u.return;On=null}}function jc(u,d){var v=u.timeoutHandle;v!==-1&&(u.timeoutHandle=-1,AQ(v)),v=u.cancelPendingCommit,v!==null&&(u.cancelPendingCommit=null,v()),eh(),vn=u,On=v=as(u.current,null),en=d,bn=0,ji=null,ya=!1,Ef=vt(u,d),xf=!1,$n=za=Ju=il=bo=Pi=0,rn=ai=null,kn=!1,(d&8)!==0&&(d|=d&32);var S=u.entangledLanes;if(S!==0)for(u=u.entanglements,S&=d;0<S;){var w=31-Mt(S),N=1<<w;d|=u[w],S&=~N}return Ha=d,Qd(),v}function Ag(u,d){Sn=null,k.H=rp,d===Zd||d===go?(d=j0(),bn=3):d===V0?(d=j0(),bn=4):bn=d===Kx?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,ji=d,On===null&&(Pi=1,lg(u,ir(d,u.current)))}function Sf(){var u=k.H;return k.H=rp,u===null?rp:u}function yg(){var u=k.A;return k.A=ts,u}function m(){Pi=4,ya||(en&4194048)!==en&&gi.current!==null||(Ef=!0),(bo&134217727)===0&&(il&134217727)===0||vn===null||To(vn,en,za,!1)}function A(u,d,v){var S=ri;ri|=2;var w=Sf(),N=yg();(vn!==u||en!==d)&&(Qa=null,jc(u,d)),d=!1;var $=Pi;e:do try{if(bn!==0&&On!==null){var le=On,Te=ji;switch(bn){case 8:eh(),$=6;break e;case 3:case 2:case 9:case 6:gi.current===null&&(d=!0);var je=bn;if(bn=0,ji=null,Ie(u,le,Te,je),v&&Ef){$=0;break e}break;default:je=bn,bn=0,ji=null,Ie(u,le,Te,je)}}T(),$=Pi;break}catch(ct){Ag(u,ct)}while(!0);return d&&u.shellSuspendCounter++,Fl=Mc=null,ri=S,k.H=w,k.A=N,On===null&&(vn=null,en=0,Qd()),$}function T(){for(;On!==null;)Q(On)}function B(u,d){var v=ri;ri|=2;var S=Sf(),w=yg();vn!==u||en!==d?(Qa=null,yr=be()+500,jc(u,d)):Ef=vt(u,d);e:do try{if(bn!==0&&On!==null){d=On;var N=ji;t:switch(bn){case 1:bn=0,ji=null,Ie(u,d,N,1);break;case 2:case 9:if(Km(N)){bn=0,ji=null,he(d);break}d=function(){bn!==2&&bn!==9||vn!==u||(bn=7),Yc(u)},N.then(d,d);break e;case 3:bn=7;break e;case 4:bn=5;break e;case 7:Km(N)?(bn=0,ji=null,he(d)):(bn=0,ji=null,Ie(u,d,N,7));break;case 5:var $=null;switch(On.tag){case 26:$=On.memoizedState;case 5:case 27:var le=On;if(!$||iL($)){bn=0,ji=null;var Te=le.sibling;if(Te!==null)On=Te;else{var je=le.return;je!==null?(On=je,Fe(je)):On=null}break t}}bn=0,ji=null,Ie(u,d,N,5);break;case 6:bn=0,ji=null,Ie(u,d,N,6);break;case 8:eh(),Pi=6;break e;default:throw Error(n(462))}}F();break}catch(ct){Ag(u,ct)}while(!0);return Fl=Mc=null,k.H=S,k.A=w,ri=v,On!==null?0:(vn=null,en=0,Qd(),Pi)}function F(){for(;On!==null&&!Ae();)Q(On)}function Q(u){var d=ju(u.alternate,u,Ha);u.memoizedProps=u.pendingProps,d===null?Fe(u):On=d}function he(u){var d=u,v=d.alternate;switch(d.tag){case 15:case 0:d=fa(v,d,d.pendingProps,d.type,void 0,en);break;case 11:d=fa(v,d,d.pendingProps,d.type.render,d.ref,en);break;case 5:W0(d);default:gf(v,d),d=On=F0(d,Ha),d=ju(v,d,Ha)}u.memoizedProps=u.pendingProps,d===null?Fe(u):On=d}function Ie(u,d,v,S){Fl=Mc=null,W0(d),Uu=null,ap=0;var w=d.return;try{if(PC(u,w,d,v,en)){Pi=1,lg(u,ir(v,u.current)),On=null;return}}catch(N){if(w!==null)throw On=w,N;Pi=1,lg(u,ir(v,u.current)),On=null;return}d.flags&32768?(ti||S===1?u=!0:Ef||(en&536870912)!==0?u=!1:(ya=u=!0,(S===2||S===9||S===3||S===6)&&(S=gi.current,S!==null&&S.tag===13&&(S.flags|=16384))),lt(d,u)):Fe(d)}function Fe(u){var d=u;do{if((d.flags&32768)!==0){lt(d,ya);return}u=d.return;var v=fy(d.alternate,d,Ha);if(v!==null){On=v;return}if(d=d.sibling,d!==null){On=d;return}On=d=u}while(d!==null);Pi===0&&(Pi=5)}function lt(u,d){do{var v=mf(u.alternate,u);if(v!==null){v.flags&=32767,On=v;return}if(v=u.return,v!==null&&(v.flags|=32768,v.subtreeFlags=0,v.deletions=null),!d&&(u=u.sibling,u!==null)){On=u;return}On=u=v}while(u!==null);Pi=6,On=null}function Ct(u,d,v,S,w,N,$,le,Te){u.cancelPendingCommit=null;do qc();while(Rs!==0);if((ri&6)!==0)throw Error(n(327));if(d!==null){if(d===u.current)throw Error(n(177));if(N=d.lanes|d.childLanes,N|=Um,yt(u,v,N,$,le,Te),u===vn&&(On=vn=null,en=0),vi=d,vr=u,Ea=v,Xl=N,dp=w,xa=S,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,ni($e,function(){return Kc(),null})):(u.callbackNode=null,u.callbackPriority=0),S=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||S){S=k.T,k.T=null,w=W.p,W.p=2,$=ri,ri|=4;try{ws(u,d,v)}finally{ri=$,W.p=w,k.T=S}}Rs=1,Lt(),kt(),En()}}function Lt(){if(Rs===1){Rs=0;var u=vr,d=vi,v=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||v){v=k.T,k.T=null;var S=W.p;W.p=2;var w=ri;ri|=4;try{fg(d,u);var N=jC,$=R0(u.containerInfo),le=N.focusedElem,Te=N.selectionRange;if($!==le&&le&&le.ownerDocument&&w0(le.ownerDocument.documentElement,le)){if(Te!==null&&Gd(le)){var je=Te.start,ct=Te.end;if(ct===void 0&&(ct=je),"selectionStart"in le)le.selectionStart=je,le.selectionEnd=Math.min(ct,le.value.length);else{var mt=le.ownerDocument||document,Xe=mt&&mt.defaultView||window;if(Xe.getSelection){var Je=Xe.getSelection(),mn=le.textContent.length,ln=Math.min(Te.start,mn),Bi=Te.end===void 0?ln:Math.min(Te.end,mn);!Je.extend&&ln>Bi&&($=Bi,Bi=ln,ln=$);var Ne=M0(le,ln),Le=M0(le,Bi);if(Ne&&Le&&(Je.rangeCount!==1||Je.anchorNode!==Ne.node||Je.anchorOffset!==Ne.offset||Je.focusNode!==Le.node||Je.focusOffset!==Le.offset)){var ze=mt.createRange();ze.setStart(Ne.node,Ne.offset),Je.removeAllRanges(),ln>Bi?(Je.addRange(ze),Je.extend(Le.node,Le.offset)):(ze.setEnd(Le.node,Le.offset),Je.addRange(ze))}}}}for(mt=[],Je=le;Je=Je.parentNode;)Je.nodeType===1&&mt.push({element:Je,left:Je.scrollLeft,top:Je.scrollTop});for(typeof le.focus=="function"&&le.focus(),le=0;le<mt.length;le++){var ft=mt[le];ft.element.scrollLeft=ft.left,ft.element.scrollTop=ft.top}}r_=!!VC,jC=VC=null}finally{ri=w,W.p=S,k.T=v}}u.current=d,Rs=2}}function kt(){if(Rs===2){Rs=0;var u=vr,d=vi,v=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||v){v=k.T,k.T=null;var S=W.p;W.p=2;var w=ri;ri|=4;try{Kl(u,d.alternate,d)}finally{ri=w,W.p=S,k.T=v}}Rs=3}}function En(){if(Rs===4||Rs===3){Rs=0,Se();var u=vr,d=vi,v=Ea,S=xa;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?Rs=5:(Rs=0,vi=vr=null,_a(u,u.pendingLanes));var w=u.pendingLanes;if(w===0&&(va=null),Un(v),d=d.stateNode,rt&&typeof rt.onCommitFiberRoot=="function")try{rt.onCommitFiberRoot(Ve,d,void 0,(d.current.flags&128)===128)}catch{}if(S!==null){d=k.T,w=W.p,W.p=2,k.T=null;try{for(var N=u.onRecoverableError,$=0;$<S.length;$++){var le=S[$];N(le.value,{componentStack:le.stack})}}finally{k.T=d,W.p=w}}(Ea&3)!==0&&qc(),Yc(u),w=u.pendingLanes,(v&4194090)!==0&&(w&42)!==0?u===Zu?sl++:(sl=0,Zu=u):sl=0,my(0)}}function _a(u,d){(u.pooledCacheLanes&=d)===0&&(d=u.pooledCache,d!=null&&(u.pooledCache=null,ef(d)))}function qc(u){return Lt(),kt(),En(),Kc()}function Kc(){if(Rs!==5)return!1;var u=vr,d=Xl;Xl=0;var v=Un(Ea),S=k.T,w=W.p;try{W.p=32>v?32:v,k.T=null,v=dp,dp=null;var N=vr,$=Ea;if(Rs=0,vi=vr=null,Ea=0,(ri&6)!==0)throw Error(n(331));var le=ri;if(ri|=4,dy(N.current),mg(N,N.current,$,v),ri=le,my(0,!1),rt&&typeof rt.onPostCommitFiberRoot=="function")try{rt.onPostCommitFiberRoot(Ve,N)}catch{}return!0}finally{W.p=w,k.T=S,_a(u,d)}}function Ke(u,d,v){d=ir(v,d),d=cg(u.stateNode,d,2),u=Gl(u,d,2),u!==null&&(Nt(u,2),Yc(u))}function De(u,d,v){if(u.tag===3)Ke(u,u,v);else for(;d!==null;){if(d.tag===3){Ke(d,u,v);break}else if(d.tag===1){var S=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(va===null||!va.has(S))){u=ir(v,u),v=qx(2),S=Gl(d,v,2),S!==null&&(ug(v,S,d,u),Nt(S,2),Yc(S));break}}d=d.return}}function Ze(u,d,v){var S=u.pingCache;if(S===null){S=u.pingCache=new py;var w=new Set;S.set(d,w)}else w=S.get(d),w===void 0&&(w=new Set,S.set(d,w));w.has(v)||(xf=!0,w.add(v),u=bt.bind(null,u,d,v),d.then(u,u))}function bt(u,d,v){var S=u.pingCache;S!==null&&S.delete(d),u.pingedLanes|=u.suspendedLanes&v,u.warmLanes&=~v,vn===u&&(en&v)===v&&(Pi===4||Pi===3&&(en&62914560)===en&&300>be()-mi?(ri&2)===0&&jc(u,0):Ju|=v,$n===en&&($n=0)),Yc(u)}function Jt(u,d){d===0&&(d=Qe()),u=Pl(u,d),u!==null&&(Nt(u,d),Yc(u))}function Ni(u){var d=u.memoizedState,v=0;d!==null&&(v=d.retryLane),Jt(u,v)}function dn(u,d){var v=0;switch(u.tag){case 13:var S=u.stateNode,w=u.memoizedState;w!==null&&(v=w.retryLane);break;case 19:S=u.stateNode;break;case 22:S=u.stateNode._retryCache;break;default:throw Error(n(314))}S!==null&&S.delete(d),Jt(u,v)}function ni(u,d){return pe(u,d)}var us=null,Nn=null,al=!1,vg=!1,NC=!1,mp=0;function Yc(u){u!==Nn&&u.next===null&&(Nn===null?us=Nn=u:Nn=Nn.next=u),vg=!0,al||(al=!0,lQ())}function my(u,d){if(!NC&&vg){NC=!0;do for(var v=!1,S=us;S!==null;){if(u!==0){var w=S.pendingLanes;if(w===0)var N=0;else{var $=S.suspendedLanes,le=S.pingedLanes;N=(1<<31-Mt(42|u)+1)-1,N&=w&~($&~le),N=N&201326741?N&201326741|1:N?N|2:0}N!==0&&(v=!0,PD(S,N))}else N=en,N=Ut(S,S===vn?N:0,S.cancelPendingCommit!==null||S.timeoutHandle!==-1),(N&3)===0||vt(S,N)||(v=!0,PD(S,N));S=S.next}while(v);NC=!1}}function oQ(){DD()}function DD(){vg=al=!1;var u=0;mp!==0&&(gQ()&&(u=mp),mp=0);for(var d=be(),v=null,S=us;S!==null;){var w=S.next,N=LD(S,d);N===0?(S.next=null,v===null?us=w:v.next=w,w===null&&(Nn=v)):(v=S,(u!==0||(N&3)!==0)&&(vg=!0)),S=w}my(u)}function LD(u,d){for(var v=u.suspendedLanes,S=u.pingedLanes,w=u.expirationTimes,N=u.pendingLanes&-62914561;0<N;){var $=31-Mt(N),le=1<<$,Te=w[$];Te===-1?((le&v)===0||(le&S)!==0)&&(w[$]=Vt(le,d)):Te<=d&&(u.expiredLanes|=le),N&=~le}if(d=vn,v=en,v=Ut(u,u===d?v:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),S=u.callbackNode,v===0||u===d&&(bn===2||bn===9)||u.cancelPendingCommit!==null)return S!==null&&S!==null&&ve(S),u.callbackNode=null,u.callbackPriority=0;if((v&3)===0||vt(u,v)){if(d=v&-v,d===u.callbackPriority)return d;switch(S!==null&&ve(S),Un(v)){case 2:case 8:v=ue;break;case 32:v=$e;break;case 268435456:v=ge;break;default:v=$e}return S=OD.bind(null,u),v=pe(v,S),u.callbackPriority=d,u.callbackNode=v,d}return S!==null&&S!==null&&ve(S),u.callbackPriority=2,u.callbackNode=null,2}function OD(u,d){if(Rs!==0&&Rs!==5)return u.callbackNode=null,u.callbackPriority=0,null;var v=u.callbackNode;if(qc()&&u.callbackNode!==v)return null;var S=en;return S=Ut(u,u===vn?S:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),S===0?null:(_f(u,S,d),LD(u,be()),u.callbackNode!=null&&u.callbackNode===v?OD.bind(null,u):null)}function PD(u,d){if(qc())return null;_f(u,d,!0)}function lQ(){yQ(function(){(ri&6)!==0?pe(me,oQ):DD()})}function FC(){return mp===0&&(mp=Oe()),mp}function ND(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:Id(""+u)}function FD(u,d){var v=d.ownerDocument.createElement("input");return v.name=d.name,v.value=d.value,u.id&&v.setAttribute("form",u.id),d.parentNode.insertBefore(v,d),u=new FormData(u),v.parentNode.removeChild(v),u}function cQ(u,d,v,S,w){if(d==="submit"&&v&&v.stateNode===w){var N=ND((w[Ti]||null).action),$=S.submitter;$&&(d=(d=$[Ti]||null)?ND(d.formAction):$.getAttribute("formAction"),d!==null&&(N=d,$=null));var le=new Hh("action","action",null,S,w);u.push({event:le,listeners:[{instance:null,listener:function(){if(S.defaultPrevented){if(mp!==0){var Te=$?FD(w,$):new FormData(w);ly(v,{pending:!0,data:Te,method:w.method,action:N},null,Te)}}else typeof N=="function"&&(le.preventDefault(),Te=$?FD(w,$):new FormData(w),ly(v,{pending:!0,data:Te,method:w.method,action:N},N,Te))},currentTarget:w}]})}}for(var UC=0;UC<zd.length;UC++){var kC=zd[UC],uQ=kC.toLowerCase(),hQ=kC[0].toUpperCase()+kC.slice(1);Us(uQ,"on"+hQ)}Us(Mr,"onAnimationEnd"),Us(L0,"onAnimationIteration"),Us(jr,"onAnimationStart"),Us("dblclick","onDoubleClick"),Us("focusin","onFocus"),Us("focusout","onBlur"),Us(sx,"onTransitionRun"),Us(Ll,"onTransitionStart"),Us(Xh,"onTransitionCancel"),Us(Ol,"onTransitionEnd"),ye("onMouseEnter",["mouseout","mouseover"]),ye("onMouseLeave",["mouseout","mouseover"]),ye("onPointerEnter",["pointerout","pointerover"]),ye("onPointerLeave",["pointerout","pointerover"]),J("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),J("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),J("onBeforeInput",["compositionend","keypress","textInput","paste"]),J("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),J("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),J("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gy="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fQ=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(gy));function UD(u,d){d=(d&4)!==0;for(var v=0;v<u.length;v++){var S=u[v],w=S.event;S=S.listeners;e:{var N=void 0;if(d)for(var $=S.length-1;0<=$;$--){var le=S[$],Te=le.instance,je=le.currentTarget;if(le=le.listener,Te!==N&&w.isPropagationStopped())break e;N=le,w.currentTarget=je;try{N(w)}catch(ct){Gu(ct)}w.currentTarget=null,N=Te}else for($=0;$<S.length;$++){if(le=S[$],Te=le.instance,je=le.currentTarget,le=le.listener,Te!==N&&w.isPropagationStopped())break e;N=le,w.currentTarget=je;try{N(w)}catch(ct){Gu(ct)}w.currentTarget=null,N=Te}}}}function jn(u,d){var v=d[Cr];v===void 0&&(v=d[Cr]=new Set);var S=u+"__bubble";v.has(S)||(kD(d,u,2,!1),v.add(S))}function GC(u,d,v){var S=0;d&&(S|=4),kD(v,u,S,d)}var Wx="_reactListening"+Math.random().toString(36).slice(2);function HC(u){if(!u[Wx]){u[Wx]=!0,it.forEach(function(v){v!=="selectionchange"&&(fQ.has(v)||GC(v,!1,u),GC(v,!0,u))});var d=u.nodeType===9?u:u.ownerDocument;d===null||d[Wx]||(d[Wx]=!0,GC("selectionchange",!1,d))}}function kD(u,d,v,S){switch(cL(d)){case 2:var w=kQ;break;case 8:w=GQ;break;default:w=t1}v=w.bind(null,d,v,u),w=void 0,!wd||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(w=!0),S?w!==void 0?u.addEventListener(d,v,{capture:!0,passive:w}):u.addEventListener(d,v,!0):w!==void 0?u.addEventListener(d,v,{passive:w}):u.addEventListener(d,v,!1)}function zC(u,d,v,S,w){var N=S;if((d&1)===0&&(d&2)===0&&S!==null)e:for(;;){if(S===null)return;var $=S.tag;if($===3||$===4){var le=S.stateNode.containerInfo;if(le===w)break;if($===4)for($=S.return;$!==null;){var Te=$.tag;if((Te===3||Te===4)&&$.stateNode.containerInfo===w)return;$=$.return}for(;le!==null;){if($=Z(le),$===null)return;if(Te=$.tag,Te===5||Te===6||Te===26||Te===27){S=N=$;continue e}le=le.parentNode}}S=S.return}g0(function(){var je=N,ct=Tm(v),mt=[];e:{var Xe=Fm.get(u);if(Xe!==void 0){var Je=Hh,mn=u;switch(u){case"keypress":if(gc(v)===0)break e;case"keydown":case"keyup":Je=x0;break;case"focusin":mn="focus",Je=Im;break;case"focusout":mn="blur",Je=Im;break;case"beforeblur":case"afterblur":Je=Im;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Je=v0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Je=bC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Je=S0;break;case Mr:case L0:case jr:Je=QE;break;case Ol:Je=wl;break;case"scroll":case"scrollend":Je=GE;break;case"wheel":Je=TC;break;case"copy":case"cut":case"paste":Je=jE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Je=wm;break;case"toggle":case"beforetoggle":Je=yc}var ln=(d&4)!==0,Bi=!ln&&(u==="scroll"||u==="scrollend"),Ne=ln?Xe!==null?Xe+"Capture":null:Xe;ln=[];for(var Le=je,ze;Le!==null;){var ft=Le;if(ze=ft.stateNode,ft=ft.tag,ft!==5&&ft!==26&&ft!==27||ze===null||Ne===null||(ft=Uh(Le,Ne),ft!=null&&ln.push(Ay(Le,ft,ze))),Bi)break;Le=Le.return}0<ln.length&&(Xe=new Je(Xe,mn,null,v,ct),mt.push({event:Xe,listeners:ln}))}}if((d&7)===0){e:{if(Xe=u==="mouseover"||u==="pointerover",Je=u==="mouseout"||u==="pointerout",Xe&&v!==bm&&(mn=v.relatedTarget||v.fromElement)&&(Z(mn)||mn[Zs]))break e;if((Je||Xe)&&(Xe=ct.window===ct?ct:(Xe=ct.ownerDocument)?Xe.defaultView||Xe.parentWindow:window,Je?(mn=v.relatedTarget||v.toElement,Je=je,mn=mn?Z(mn):null,mn!==null&&(Bi=r(mn),ln=mn.tag,mn!==Bi||ln!==5&&ln!==27&&ln!==6)&&(mn=null)):(Je=null,mn=je),Je!==mn)){if(ln=v0,ft="onMouseLeave",Ne="onMouseEnter",Le="mouse",(u==="pointerout"||u==="pointerover")&&(ln=wm,ft="onPointerLeave",Ne="onPointerEnter",Le="pointer"),Bi=Je==null?Xe:we(Je),ze=mn==null?Xe:we(mn),Xe=new ln(ft,Le+"leave",Je,v,ct),Xe.target=Bi,Xe.relatedTarget=ze,ft=null,Z(ct)===je&&(ln=new ln(Ne,Le+"enter",mn,v,ct),ln.target=ze,ln.relatedTarget=Bi,ft=ln),Bi=ft,Je&&mn)t:{for(ln=Je,Ne=mn,Le=0,ze=ln;ze;ze=Eg(ze))Le++;for(ze=0,ft=Ne;ft;ft=Eg(ft))ze++;for(;0<Le-ze;)ln=Eg(ln),Le--;for(;0<ze-Le;)Ne=Eg(Ne),ze--;for(;Le--;){if(ln===Ne||Ne!==null&&ln===Ne.alternate)break t;ln=Eg(ln),Ne=Eg(Ne)}ln=null}else ln=null;Je!==null&&GD(mt,Xe,Je,ln,!1),mn!==null&&Bi!==null&&GD(mt,Bi,mn,ln,!0)}}e:{if(Xe=je?we(je):window,Je=Xe.nodeName&&Xe.nodeName.toLowerCase(),Je==="select"||Je==="input"&&Xe.type==="file")var qt=Bm;else if(I0(Xe))if(Dm)qt=xc;else{qt=tx;var Gn=CC}else Je=Xe.nodeName,!Je||Je.toLowerCase()!=="input"||Xe.type!=="checkbox"&&Xe.type!=="radio"?je&&Sm(je.elementType)&&(qt=Bm):qt=kd;if(qt&&(qt=qt(u,je))){zr(mt,qt,v,ct);break e}Gn&&Gn(u,Xe,je),u==="focusout"&&je&&Xe.type==="number"&&je.memoizedProps.value!=null&&Oi(Xe,"number",Xe.value)}switch(Gn=je?we(je):window,u){case"focusin":(I0(Gn)||Gn.contentEditable==="true")&&(Bl=Gn,Om=je,Hd=null);break;case"focusout":Hd=Om=Bl=null;break;case"mousedown":Pm=!0;break;case"contextmenu":case"mouseup":case"dragend":Pm=!1,D0(mt,v,ct);break;case"selectionchange":if(B0)break;case"keydown":case"keyup":D0(mt,v,ct)}var Zt;if(Ld)e:{switch(u){case"compositionstart":var cn="onCompositionStart";break e;case"compositionend":cn="onCompositionEnd";break e;case"compositionupdate":cn="onCompositionUpdate";break e}cn=void 0}else Ec?Nd(u,v)&&(cn="onCompositionEnd"):u==="keydown"&&v.keyCode===229&&(cn="onCompositionStart");cn&&(Pd&&v.locale!=="ko"&&(Ec||cn!=="onCompositionStart"?cn==="onCompositionEnd"&&Ec&&(Zt=y0()):(Il=ct,A0="value"in Il?Il.value:Il.textContent,Ec=!0)),Gn=$x(je,cn),0<Gn.length&&(cn=new Mm(cn,u,null,v,ct),mt.push({event:cn,listeners:Gn}),Zt?cn.data=Zt:(Zt=T0(v),Zt!==null&&(cn.data=Zt)))),(Zt=Od?Fd(u,v):C0(u,v))&&(cn=$x(je,"onBeforeInput"),0<cn.length&&(Gn=new Mm("onBeforeInput","beforeinput",null,v,ct),mt.push({event:Gn,listeners:cn}),Gn.data=Zt)),cQ(mt,u,je,v,ct)}UD(mt,d)})}function Ay(u,d,v){return{instance:u,listener:d,currentTarget:v}}function $x(u,d){for(var v=d+"Capture",S=[];u!==null;){var w=u,N=w.stateNode;if(w=w.tag,w!==5&&w!==26&&w!==27||N===null||(w=Uh(u,v),w!=null&&S.unshift(Ay(u,w,N)),w=Uh(u,d),w!=null&&S.push(Ay(u,w,N))),u.tag===3)return S;u=u.return}return[]}function Eg(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function GD(u,d,v,S,w){for(var N=d._reactName,$=[];v!==null&&v!==S;){var le=v,Te=le.alternate,je=le.stateNode;if(le=le.tag,Te!==null&&Te===S)break;le!==5&&le!==26&&le!==27||je===null||(Te=je,w?(je=Uh(v,N),je!=null&&$.unshift(Ay(v,je,Te))):w||(je=Uh(v,N),je!=null&&$.push(Ay(v,je,Te)))),v=v.return}$.length!==0&&u.push({event:d,listeners:$})}var dQ=/\r\n?/g,pQ=/\u0000|\uFFFD/g;function HD(u){return(typeof u=="string"?u:""+u).replace(dQ,`
`).replace(pQ,"")}function zD(u,d){return d=HD(d),HD(u)===d}function Jx(){}function Ri(u,d,v,S,w,N){switch(v){case"children":typeof S=="string"?d==="body"||d==="textarea"&&S===""||Cs(u,S):(typeof S=="number"||typeof S=="bigint")&&d!=="body"&&Cs(u,""+S);break;case"className":at(u,"class",S);break;case"tabIndex":at(u,"tabindex",S);break;case"dir":case"role":case"viewBox":case"width":case"height":at(u,v,S);break;case"style":Cd(u,S,N);break;case"data":if(d!=="object"){at(u,"data",S);break}case"src":case"href":if(S===""&&(d!=="a"||v!=="href")){u.removeAttribute(v);break}if(S==null||typeof S=="function"||typeof S=="symbol"||typeof S=="boolean"){u.removeAttribute(v);break}S=Id(""+S),u.setAttribute(v,S);break;case"action":case"formAction":if(typeof S=="function"){u.setAttribute(v,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof N=="function"&&(v==="formAction"?(d!=="input"&&Ri(u,d,"name",w.name,w,null),Ri(u,d,"formEncType",w.formEncType,w,null),Ri(u,d,"formMethod",w.formMethod,w,null),Ri(u,d,"formTarget",w.formTarget,w,null)):(Ri(u,d,"encType",w.encType,w,null),Ri(u,d,"method",w.method,w,null),Ri(u,d,"target",w.target,w,null)));if(S==null||typeof S=="symbol"||typeof S=="boolean"){u.removeAttribute(v);break}S=Id(""+S),u.setAttribute(v,S);break;case"onClick":S!=null&&(u.onclick=Jx);break;case"onScroll":S!=null&&jn("scroll",u);break;case"onScrollEnd":S!=null&&jn("scrollend",u);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(n(61));if(v=S.__html,v!=null){if(w.children!=null)throw Error(n(60));u.innerHTML=v}}break;case"multiple":u.multiple=S&&typeof S!="function"&&typeof S!="symbol";break;case"muted":u.muted=S&&typeof S!="function"&&typeof S!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(S==null||typeof S=="function"||typeof S=="boolean"||typeof S=="symbol"){u.removeAttribute("xlink:href");break}v=Id(""+S),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",v);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":S!=null&&typeof S!="function"&&typeof S!="symbol"?u.setAttribute(v,""+S):u.removeAttribute(v);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":S&&typeof S!="function"&&typeof S!="symbol"?u.setAttribute(v,""):u.removeAttribute(v);break;case"capture":case"download":S===!0?u.setAttribute(v,""):S!==!1&&S!=null&&typeof S!="function"&&typeof S!="symbol"?u.setAttribute(v,S):u.removeAttribute(v);break;case"cols":case"rows":case"size":case"span":S!=null&&typeof S!="function"&&typeof S!="symbol"&&!isNaN(S)&&1<=S?u.setAttribute(v,S):u.removeAttribute(v);break;case"rowSpan":case"start":S==null||typeof S=="function"||typeof S=="symbol"||isNaN(S)?u.removeAttribute(v):u.setAttribute(v,S);break;case"popover":jn("beforetoggle",u),jn("toggle",u),tt(u,"popover",S);break;case"xlinkActuate":ot(u,"http://www.w3.org/1999/xlink","xlink:actuate",S);break;case"xlinkArcrole":ot(u,"http://www.w3.org/1999/xlink","xlink:arcrole",S);break;case"xlinkRole":ot(u,"http://www.w3.org/1999/xlink","xlink:role",S);break;case"xlinkShow":ot(u,"http://www.w3.org/1999/xlink","xlink:show",S);break;case"xlinkTitle":ot(u,"http://www.w3.org/1999/xlink","xlink:title",S);break;case"xlinkType":ot(u,"http://www.w3.org/1999/xlink","xlink:type",S);break;case"xmlBase":ot(u,"http://www.w3.org/XML/1998/namespace","xml:base",S);break;case"xmlLang":ot(u,"http://www.w3.org/XML/1998/namespace","xml:lang",S);break;case"xmlSpace":ot(u,"http://www.w3.org/XML/1998/namespace","xml:space",S);break;case"is":tt(u,"is",S);break;case"innerText":case"textContent":break;default:(!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(v=p0.get(v)||v,tt(u,v,S))}}function QC(u,d,v,S,w,N){switch(v){case"style":Cd(u,S,N);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(n(61));if(v=S.__html,v!=null){if(w.children!=null)throw Error(n(60));u.innerHTML=v}}break;case"children":typeof S=="string"?Cs(u,S):(typeof S=="number"||typeof S=="bigint")&&Cs(u,""+S);break;case"onScroll":S!=null&&jn("scroll",u);break;case"onScrollEnd":S!=null&&jn("scrollend",u);break;case"onClick":S!=null&&(u.onclick=Jx);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!xt.hasOwnProperty(v))e:{if(v[0]==="o"&&v[1]==="n"&&(w=v.endsWith("Capture"),d=v.slice(2,w?v.length-7:void 0),N=u[Ti]||null,N=N!=null?N[v]:null,typeof N=="function"&&u.removeEventListener(d,N,w),typeof S=="function")){typeof N!="function"&&N!==null&&(v in u?u[v]=null:u.hasAttribute(v)&&u.removeAttribute(v)),u.addEventListener(d,S,w);break e}v in u?u[v]=S:S===!0?u.setAttribute(v,""):tt(u,v,S)}}}function Pr(u,d,v){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":jn("error",u),jn("load",u);var S=!1,w=!1,N;for(N in v)if(v.hasOwnProperty(N)){var $=v[N];if($!=null)switch(N){case"src":S=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,d));default:Ri(u,d,N,$,v,null)}}w&&Ri(u,d,"srcSet",v.srcSet,v,null),S&&Ri(u,d,"src",v.src,v,null);return;case"input":jn("invalid",u);var le=N=$=w=null,Te=null,je=null;for(S in v)if(v.hasOwnProperty(S)){var ct=v[S];if(ct!=null)switch(S){case"name":w=ct;break;case"type":$=ct;break;case"checked":Te=ct;break;case"defaultChecked":je=ct;break;case"value":N=ct;break;case"defaultValue":le=ct;break;case"children":case"dangerouslySetInnerHTML":if(ct!=null)throw Error(n(137,d));break;default:Ri(u,d,S,ct,v,null)}}li(u,N,le,Te,je,$,w,!1),An(u);return;case"select":jn("invalid",u),S=$=N=null;for(w in v)if(v.hasOwnProperty(w)&&(le=v[w],le!=null))switch(w){case"value":N=le;break;case"defaultValue":$=le;break;case"multiple":S=le;default:Ri(u,d,w,le,v,null)}d=N,v=$,u.multiple=!!S,d!=null?Pn(u,!!S,d,!1):v!=null&&Pn(u,!!S,v,!0);return;case"textarea":jn("invalid",u),N=w=S=null;for($ in v)if(v.hasOwnProperty($)&&(le=v[$],le!=null))switch($){case"value":S=le;break;case"defaultValue":w=le;break;case"children":N=le;break;case"dangerouslySetInnerHTML":if(le!=null)throw Error(n(91));break;default:Ri(u,d,$,le,v,null)}Du(u,S,w,N),An(u);return;case"option":for(Te in v)if(v.hasOwnProperty(Te)&&(S=v[Te],S!=null))switch(Te){case"selected":u.selected=S&&typeof S!="function"&&typeof S!="symbol";break;default:Ri(u,d,Te,S,v,null)}return;case"dialog":jn("beforetoggle",u),jn("toggle",u),jn("cancel",u),jn("close",u);break;case"iframe":case"object":jn("load",u);break;case"video":case"audio":for(S=0;S<gy.length;S++)jn(gy[S],u);break;case"image":jn("error",u),jn("load",u);break;case"details":jn("toggle",u);break;case"embed":case"source":case"link":jn("error",u),jn("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(je in v)if(v.hasOwnProperty(je)&&(S=v[je],S!=null))switch(je){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,d));default:Ri(u,d,je,S,v,null)}return;default:if(Sm(d)){for(ct in v)v.hasOwnProperty(ct)&&(S=v[ct],S!==void 0&&QC(u,d,ct,S,v,void 0));return}}for(le in v)v.hasOwnProperty(le)&&(S=v[le],S!=null&&Ri(u,d,le,S,v,null))}function mQ(u,d,v,S){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,N=null,$=null,le=null,Te=null,je=null,ct=null;for(Je in v){var mt=v[Je];if(v.hasOwnProperty(Je)&&mt!=null)switch(Je){case"checked":break;case"value":break;case"defaultValue":Te=mt;default:S.hasOwnProperty(Je)||Ri(u,d,Je,null,S,mt)}}for(var Xe in S){var Je=S[Xe];if(mt=v[Xe],S.hasOwnProperty(Xe)&&(Je!=null||mt!=null))switch(Xe){case"type":N=Je;break;case"name":w=Je;break;case"checked":je=Je;break;case"defaultChecked":ct=Je;break;case"value":$=Je;break;case"defaultValue":le=Je;break;case"children":case"dangerouslySetInnerHTML":if(Je!=null)throw Error(n(137,d));break;default:Je!==mt&&Ri(u,d,Xe,Je,S,mt)}}$t(u,$,le,Te,je,ct,N,w);return;case"select":Je=$=le=Xe=null;for(N in v)if(Te=v[N],v.hasOwnProperty(N)&&Te!=null)switch(N){case"value":break;case"multiple":Je=Te;default:S.hasOwnProperty(N)||Ri(u,d,N,null,S,Te)}for(w in S)if(N=S[w],Te=v[w],S.hasOwnProperty(w)&&(N!=null||Te!=null))switch(w){case"value":Xe=N;break;case"defaultValue":le=N;break;case"multiple":$=N;default:N!==Te&&Ri(u,d,w,N,S,Te)}d=le,v=$,S=Je,Xe!=null?Pn(u,!!v,Xe,!1):!!S!=!!v&&(d!=null?Pn(u,!!v,d,!0):Pn(u,!!v,v?[]:"",!1));return;case"textarea":Je=Xe=null;for(le in v)if(w=v[le],v.hasOwnProperty(le)&&w!=null&&!S.hasOwnProperty(le))switch(le){case"value":break;case"children":break;default:Ri(u,d,le,null,S,w)}for($ in S)if(w=S[$],N=v[$],S.hasOwnProperty($)&&(w!=null||N!=null))switch($){case"value":Xe=w;break;case"defaultValue":Je=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(n(91));break;default:w!==N&&Ri(u,d,$,w,S,N)}Ci(u,Xe,Je);return;case"option":for(var mn in v)if(Xe=v[mn],v.hasOwnProperty(mn)&&Xe!=null&&!S.hasOwnProperty(mn))switch(mn){case"selected":u.selected=!1;break;default:Ri(u,d,mn,null,S,Xe)}for(Te in S)if(Xe=S[Te],Je=v[Te],S.hasOwnProperty(Te)&&Xe!==Je&&(Xe!=null||Je!=null))switch(Te){case"selected":u.selected=Xe&&typeof Xe!="function"&&typeof Xe!="symbol";break;default:Ri(u,d,Te,Xe,S,Je)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ln in v)Xe=v[ln],v.hasOwnProperty(ln)&&Xe!=null&&!S.hasOwnProperty(ln)&&Ri(u,d,ln,null,S,Xe);for(je in S)if(Xe=S[je],Je=v[je],S.hasOwnProperty(je)&&Xe!==Je&&(Xe!=null||Je!=null))switch(je){case"children":case"dangerouslySetInnerHTML":if(Xe!=null)throw Error(n(137,d));break;default:Ri(u,d,je,Xe,S,Je)}return;default:if(Sm(d)){for(var Bi in v)Xe=v[Bi],v.hasOwnProperty(Bi)&&Xe!==void 0&&!S.hasOwnProperty(Bi)&&QC(u,d,Bi,void 0,S,Xe);for(ct in S)Xe=S[ct],Je=v[ct],!S.hasOwnProperty(ct)||Xe===Je||Xe===void 0&&Je===void 0||QC(u,d,ct,Xe,S,Je);return}}for(var Ne in v)Xe=v[Ne],v.hasOwnProperty(Ne)&&Xe!=null&&!S.hasOwnProperty(Ne)&&Ri(u,d,Ne,null,S,Xe);for(mt in S)Xe=S[mt],Je=v[mt],!S.hasOwnProperty(mt)||Xe===Je||Xe==null&&Je==null||Ri(u,d,mt,Xe,S,Je)}var VC=null,jC=null;function Zx(u){return u.nodeType===9?u:u.ownerDocument}function QD(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function VD(u,d){if(u===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&d==="foreignObject"?0:u}function qC(u,d){return u==="textarea"||u==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var KC=null;function gQ(){var u=window.event;return u&&u.type==="popstate"?u===KC?!1:(KC=u,!0):(KC=null,!1)}var jD=typeof setTimeout=="function"?setTimeout:void 0,AQ=typeof clearTimeout=="function"?clearTimeout:void 0,qD=typeof Promise=="function"?Promise:void 0,yQ=typeof queueMicrotask=="function"?queueMicrotask:typeof qD<"u"?function(u){return qD.resolve(null).then(u).catch(vQ)}:jD;function vQ(u){setTimeout(function(){throw u})}function bf(u){return u==="head"}function KD(u,d){var v=d,S=0,w=0;do{var N=v.nextSibling;if(u.removeChild(v),N&&N.nodeType===8)if(v=N.data,v==="/$"){if(0<S&&8>S){v=S;var $=u.ownerDocument;if(v&1&&yy($.documentElement),v&2&&yy($.body),v&4)for(v=$.head,yy(v),$=v.firstChild;$;){var le=$.nextSibling,Te=$.nodeName;$[mr]||Te==="SCRIPT"||Te==="STYLE"||Te==="LINK"&&$.rel.toLowerCase()==="stylesheet"||v.removeChild($),$=le}}if(w===0){u.removeChild(N),Cy(d);return}w--}else v==="$"||v==="$?"||v==="$!"?w++:S=v.charCodeAt(0)-48;else S=0;v=N}while(v);Cy(d)}function YC(u){var d=u.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var v=d;switch(d=d.nextSibling,v.nodeName){case"HTML":case"HEAD":case"BODY":YC(v),pi(v);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(v.rel.toLowerCase()==="stylesheet")continue}u.removeChild(v)}}function EQ(u,d,v,S){for(;u.nodeType===1;){var w=v;if(u.nodeName.toLowerCase()!==d.toLowerCase()){if(!S&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(S){if(!u[mr])switch(d){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(N=u.getAttribute("rel"),N==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(N!==w.rel||u.getAttribute("href")!==(w.href==null||w.href===""?null:w.href)||u.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||u.getAttribute("title")!==(w.title==null?null:w.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(N=u.getAttribute("src"),(N!==(w.src==null?null:w.src)||u.getAttribute("type")!==(w.type==null?null:w.type)||u.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&N&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(d==="input"&&u.type==="hidden"){var N=w.name==null?null:""+w.name;if(w.type==="hidden"&&u.getAttribute("name")===N)return u}else return u;if(u=Wl(u.nextSibling),u===null)break}return null}function xQ(u,d,v){if(d==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!v||(u=Wl(u.nextSibling),u===null))return null;return u}function XC(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState==="complete"}function _Q(u,d){var v=u.ownerDocument;if(u.data!=="$?"||v.readyState==="complete")d();else{var S=function(){d(),v.removeEventListener("DOMContentLoaded",S)};v.addEventListener("DOMContentLoaded",S),u._reactRetry=S}}function Wl(u){for(;u!=null;u=u.nextSibling){var d=u.nodeType;if(d===1||d===3)break;if(d===8){if(d=u.data,d==="$"||d==="$!"||d==="$?"||d==="F!"||d==="F")break;if(d==="/$")return null}}return u}var WC=null;function YD(u){u=u.previousSibling;for(var d=0;u;){if(u.nodeType===8){var v=u.data;if(v==="$"||v==="$!"||v==="$?"){if(d===0)return u;d--}else v==="/$"&&d++}u=u.previousSibling}return null}function XD(u,d,v){switch(d=Zx(v),u){case"html":if(u=d.documentElement,!u)throw Error(n(452));return u;case"head":if(u=d.head,!u)throw Error(n(453));return u;case"body":if(u=d.body,!u)throw Error(n(454));return u;default:throw Error(n(451))}}function yy(u){for(var d=u.attributes;d.length;)u.removeAttributeNode(d[0]);pi(u)}var ol=new Map,WD=new Set;function e_(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var th=W.d;W.d={f:SQ,r:bQ,D:TQ,C:CQ,L:IQ,m:MQ,X:RQ,S:wQ,M:BQ};function SQ(){var u=th.f(),d=rl();return u||d}function bQ(u){var d=fe(u);d!==null&&d.tag===5&&d.type==="form"?Lx(d):th.r(u)}var xg=typeof document>"u"?null:document;function $D(u,d,v){var S=xg;if(S&&typeof d=="string"&&d){var w=yn(d);w='link[rel="'+u+'"][href="'+w+'"]',typeof v=="string"&&(w+='[crossorigin="'+v+'"]'),WD.has(w)||(WD.add(w),u={rel:u,crossOrigin:v,href:d},S.querySelector(w)===null&&(d=S.createElement("link"),Pr(d,"link",u),Ye(d),S.head.appendChild(d)))}}function TQ(u){th.D(u),$D("dns-prefetch",u,null)}function CQ(u,d){th.C(u,d),$D("preconnect",u,d)}function IQ(u,d,v){th.L(u,d,v);var S=xg;if(S&&u&&d){var w='link[rel="preload"][as="'+yn(d)+'"]';d==="image"&&v&&v.imageSrcSet?(w+='[imagesrcset="'+yn(v.imageSrcSet)+'"]',typeof v.imageSizes=="string"&&(w+='[imagesizes="'+yn(v.imageSizes)+'"]')):w+='[href="'+yn(u)+'"]';var N=w;switch(d){case"style":N=_g(u);break;case"script":N=Sg(u)}ol.has(N)||(u=h({rel:"preload",href:d==="image"&&v&&v.imageSrcSet?void 0:u,as:d},v),ol.set(N,u),S.querySelector(w)!==null||d==="style"&&S.querySelector(vy(N))||d==="script"&&S.querySelector(Ey(N))||(d=S.createElement("link"),Pr(d,"link",u),Ye(d),S.head.appendChild(d)))}}function MQ(u,d){th.m(u,d);var v=xg;if(v&&u){var S=d&&typeof d.as=="string"?d.as:"script",w='link[rel="modulepreload"][as="'+yn(S)+'"][href="'+yn(u)+'"]',N=w;switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":N=Sg(u)}if(!ol.has(N)&&(u=h({rel:"modulepreload",href:u},d),ol.set(N,u),v.querySelector(w)===null)){switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(v.querySelector(Ey(N)))return}S=v.createElement("link"),Pr(S,"link",u),Ye(S),v.head.appendChild(S)}}}function wQ(u,d,v){th.S(u,d,v);var S=xg;if(S&&u){var w=qe(S).hoistableStyles,N=_g(u);d=d||"default";var $=w.get(N);if(!$){var le={loading:0,preload:null};if($=S.querySelector(vy(N)))le.loading=5;else{u=h({rel:"stylesheet",href:u,"data-precedence":d},v),(v=ol.get(N))&&$C(u,v);var Te=$=S.createElement("link");Ye(Te),Pr(Te,"link",u),Te._p=new Promise(function(je,ct){Te.onload=je,Te.onerror=ct}),Te.addEventListener("load",function(){le.loading|=1}),Te.addEventListener("error",function(){le.loading|=2}),le.loading|=4,t_($,d,S)}$={type:"stylesheet",instance:$,count:1,state:le},w.set(N,$)}}}function RQ(u,d){th.X(u,d);var v=xg;if(v&&u){var S=qe(v).hoistableScripts,w=Sg(u),N=S.get(w);N||(N=v.querySelector(Ey(w)),N||(u=h({src:u,async:!0},d),(d=ol.get(w))&&JC(u,d),N=v.createElement("script"),Ye(N),Pr(N,"link",u),v.head.appendChild(N)),N={type:"script",instance:N,count:1,state:null},S.set(w,N))}}function BQ(u,d){th.M(u,d);var v=xg;if(v&&u){var S=qe(v).hoistableScripts,w=Sg(u),N=S.get(w);N||(N=v.querySelector(Ey(w)),N||(u=h({src:u,async:!0,type:"module"},d),(d=ol.get(w))&&JC(u,d),N=v.createElement("script"),Ye(N),Pr(N,"link",u),v.head.appendChild(N)),N={type:"script",instance:N,count:1,state:null},S.set(w,N))}}function JD(u,d,v,S){var w=(w=ie.current)?e_(w):null;if(!w)throw Error(n(446));switch(u){case"meta":case"title":return null;case"style":return typeof v.precedence=="string"&&typeof v.href=="string"?(d=_g(v.href),v=qe(w).hoistableStyles,S=v.get(d),S||(S={type:"style",instance:null,count:0,state:null},v.set(d,S)),S):{type:"void",instance:null,count:0,state:null};case"link":if(v.rel==="stylesheet"&&typeof v.href=="string"&&typeof v.precedence=="string"){u=_g(v.href);var N=qe(w).hoistableStyles,$=N.get(u);if($||(w=w.ownerDocument||w,$={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},N.set(u,$),(N=w.querySelector(vy(u)))&&!N._p&&($.instance=N,$.state.loading=5),ol.has(u)||(v={rel:"preload",as:"style",href:v.href,crossOrigin:v.crossOrigin,integrity:v.integrity,media:v.media,hrefLang:v.hrefLang,referrerPolicy:v.referrerPolicy},ol.set(u,v),N||DQ(w,u,v,$.state))),d&&S===null)throw Error(n(528,""));return $}if(d&&S!==null)throw Error(n(529,""));return null;case"script":return d=v.async,v=v.src,typeof v=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=Sg(v),v=qe(w).hoistableScripts,S=v.get(d),S||(S={type:"script",instance:null,count:0,state:null},v.set(d,S)),S):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,u))}}function _g(u){return'href="'+yn(u)+'"'}function vy(u){return'link[rel="stylesheet"]['+u+"]"}function ZD(u){return h({},u,{"data-precedence":u.precedence,precedence:null})}function DQ(u,d,v,S){u.querySelector('link[rel="preload"][as="style"]['+d+"]")?S.loading=1:(d=u.createElement("link"),S.preload=d,d.addEventListener("load",function(){return S.loading|=1}),d.addEventListener("error",function(){return S.loading|=2}),Pr(d,"link",v),Ye(d),u.head.appendChild(d))}function Sg(u){return'[src="'+yn(u)+'"]'}function Ey(u){return"script[async]"+u}function eL(u,d,v){if(d.count++,d.instance===null)switch(d.type){case"style":var S=u.querySelector('style[data-href~="'+yn(v.href)+'"]');if(S)return d.instance=S,Ye(S),S;var w=h({},v,{"data-href":v.href,"data-precedence":v.precedence,href:null,precedence:null});return S=(u.ownerDocument||u).createElement("style"),Ye(S),Pr(S,"style",w),t_(S,v.precedence,u),d.instance=S;case"stylesheet":w=_g(v.href);var N=u.querySelector(vy(w));if(N)return d.state.loading|=4,d.instance=N,Ye(N),N;S=ZD(v),(w=ol.get(w))&&$C(S,w),N=(u.ownerDocument||u).createElement("link"),Ye(N);var $=N;return $._p=new Promise(function(le,Te){$.onload=le,$.onerror=Te}),Pr(N,"link",S),d.state.loading|=4,t_(N,v.precedence,u),d.instance=N;case"script":return N=Sg(v.src),(w=u.querySelector(Ey(N)))?(d.instance=w,Ye(w),w):(S=v,(w=ol.get(N))&&(S=h({},v),JC(S,w)),u=u.ownerDocument||u,w=u.createElement("script"),Ye(w),Pr(w,"link",S),u.head.appendChild(w),d.instance=w);case"void":return null;default:throw Error(n(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(S=d.instance,d.state.loading|=4,t_(S,v.precedence,u));return d.instance}function t_(u,d,v){for(var S=v.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=S.length?S[S.length-1]:null,N=w,$=0;$<S.length;$++){var le=S[$];if(le.dataset.precedence===d)N=le;else if(N!==w)break}N?N.parentNode.insertBefore(u,N.nextSibling):(d=v.nodeType===9?v.head:v,d.insertBefore(u,d.firstChild))}function $C(u,d){u.crossOrigin==null&&(u.crossOrigin=d.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=d.referrerPolicy),u.title==null&&(u.title=d.title)}function JC(u,d){u.crossOrigin==null&&(u.crossOrigin=d.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=d.referrerPolicy),u.integrity==null&&(u.integrity=d.integrity)}var n_=null;function tL(u,d,v){if(n_===null){var S=new Map,w=n_=new Map;w.set(v,S)}else w=n_,S=w.get(v),S||(S=new Map,w.set(v,S));if(S.has(u))return S;for(S.set(u,null),v=v.getElementsByTagName(u),w=0;w<v.length;w++){var N=v[w];if(!(N[mr]||N[Ji]||u==="link"&&N.getAttribute("rel")==="stylesheet")&&N.namespaceURI!=="http://www.w3.org/2000/svg"){var $=N.getAttribute(d)||"";$=u+$;var le=S.get($);le?le.push(N):S.set($,[N])}}return S}function nL(u,d,v){u=u.ownerDocument||u,u.head.insertBefore(v,d==="title"?u.querySelector("head > title"):null)}function LQ(u,d,v){if(v===1||d.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return u=d.disabled,typeof d.precedence=="string"&&u==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function iL(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}var xy=null;function OQ(){}function PQ(u,d,v){if(xy===null)throw Error(n(475));var S=xy;if(d.type==="stylesheet"&&(typeof v.media!="string"||matchMedia(v.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var w=_g(v.href),N=u.querySelector(vy(w));if(N){u=N._p,u!==null&&typeof u=="object"&&typeof u.then=="function"&&(S.count++,S=i_.bind(S),u.then(S,S)),d.state.loading|=4,d.instance=N,Ye(N);return}N=u.ownerDocument||u,v=ZD(v),(w=ol.get(w))&&$C(v,w),N=N.createElement("link"),Ye(N);var $=N;$._p=new Promise(function(le,Te){$.onload=le,$.onerror=Te}),Pr(N,"link",v),d.instance=N}S.stylesheets===null&&(S.stylesheets=new Map),S.stylesheets.set(d,u),(u=d.state.preload)&&(d.state.loading&3)===0&&(S.count++,d=i_.bind(S),u.addEventListener("load",d),u.addEventListener("error",d))}}function NQ(){if(xy===null)throw Error(n(475));var u=xy;return u.stylesheets&&u.count===0&&ZC(u,u.stylesheets),0<u.count?function(d){var v=setTimeout(function(){if(u.stylesheets&&ZC(u,u.stylesheets),u.unsuspend){var S=u.unsuspend;u.unsuspend=null,S()}},6e4);return u.unsuspend=d,function(){u.unsuspend=null,clearTimeout(v)}}:null}function i_(){if(this.count--,this.count===0){if(this.stylesheets)ZC(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var s_=null;function ZC(u,d){u.stylesheets=null,u.unsuspend!==null&&(u.count++,s_=new Map,d.forEach(FQ,u),s_=null,i_.call(u))}function FQ(u,d){if(!(d.state.loading&4)){var v=s_.get(u);if(v)var S=v.get(null);else{v=new Map,s_.set(u,v);for(var w=u.querySelectorAll("link[data-precedence],style[data-precedence]"),N=0;N<w.length;N++){var $=w[N];($.nodeName==="LINK"||$.getAttribute("media")!=="not all")&&(v.set($.dataset.precedence,$),S=$)}S&&v.set(null,S)}w=d.instance,$=w.getAttribute("data-precedence"),N=v.get($)||S,N===S&&v.set(null,w),v.set($,w),this.count++,S=i_.bind(this),w.addEventListener("load",S),w.addEventListener("error",S),N?N.parentNode.insertBefore(w,N.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(w,u.firstChild)),d.state.loading|=4}}var _y={$$typeof:C,Provider:null,Consumer:null,_currentValue:V,_currentValue2:V,_threadCount:0};function UQ(u,d,v,S,w,N,$,le){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=St(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=St(0),this.hiddenUpdates=St(null),this.identifierPrefix=S,this.onUncaughtError=w,this.onCaughtError=N,this.onRecoverableError=$,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=le,this.incompleteTransitions=new Map}function sL(u,d,v,S,w,N,$,le,Te,je,ct,mt){return u=new UQ(u,d,v,$,le,Te,je,mt),d=1,N===!0&&(d|=24),N=qr(3,null,null,d),u.current=N,N.stateNode=u,d=Vm(),d.refCount++,u.pooledCache=d,d.refCount++,N.memoizedState={element:S,isDehydrated:v,cache:d},q0(N),u}function rL(u){return u?(u=bc,u):bc}function aL(u,d,v,S,w,N){w=rL(w),S.context===null?S.context=w:S.pendingContext=w,S=Yo(d),S.payload={element:v},N=N===void 0?null:N,N!==null&&(S.callback=N),v=Gl(u,S,d),v!==null&&(Or(v,u,d),Fu(v,u,d))}function oL(u,d){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var v=u.retryLane;u.retryLane=v!==0&&v<d?v:d}}function e1(u,d){oL(u,d),(u=u.alternate)&&oL(u,d)}function lL(u){if(u.tag===13){var d=Pl(u,67108864);d!==null&&Or(d,u,67108864),e1(u,67108864)}}var r_=!0;function kQ(u,d,v,S){var w=k.T;k.T=null;var N=W.p;try{W.p=2,t1(u,d,v,S)}finally{W.p=N,k.T=w}}function GQ(u,d,v,S){var w=k.T;k.T=null;var N=W.p;try{W.p=8,t1(u,d,v,S)}finally{W.p=N,k.T=w}}function t1(u,d,v,S){if(r_){var w=n1(S);if(w===null)zC(u,d,S,a_,v),uL(u,S);else if(zQ(w,u,d,v,S))S.stopPropagation();else if(uL(u,S),d&4&&-1<HQ.indexOf(u)){for(;w!==null;){var N=fe(w);if(N!==null)switch(N.tag){case 3:if(N=N.stateNode,N.current.memoizedState.isDehydrated){var $=Qt(N.pendingLanes);if($!==0){var le=N;for(le.pendingLanes|=2,le.entangledLanes|=2;$;){var Te=1<<31-Mt($);le.entanglements[1]|=Te,$&=~Te}Yc(N),(ri&6)===0&&(yr=be()+500,my(0))}}break;case 13:le=Pl(N,2),le!==null&&Or(le,N,2),rl(),e1(N,2)}if(N=n1(S),N===null&&zC(u,d,S,a_,v),N===w)break;w=N}w!==null&&S.stopPropagation()}else zC(u,d,S,null,v)}}function n1(u){return u=Tm(u),i1(u)}var a_=null;function i1(u){if(a_=null,u=Z(u),u!==null){var d=r(u);if(d===null)u=null;else{var v=d.tag;if(v===13){if(u=a(d),u!==null)return u;u=null}else if(v===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;u=null}else d!==u&&(u=null)}}return a_=u,null}function cL(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Re()){case me:return 2;case ue:return 8;case $e:case gt:return 32;case ge:return 268435456;default:return 32}default:return 32}}var s1=!1,Tf=null,Cf=null,If=null,Sy=new Map,by=new Map,Mf=[],HQ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function uL(u,d){switch(u){case"focusin":case"focusout":Tf=null;break;case"dragenter":case"dragleave":Cf=null;break;case"mouseover":case"mouseout":If=null;break;case"pointerover":case"pointerout":Sy.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":by.delete(d.pointerId)}}function Ty(u,d,v,S,w,N){return u===null||u.nativeEvent!==N?(u={blockedOn:d,domEventName:v,eventSystemFlags:S,nativeEvent:N,targetContainers:[w]},d!==null&&(d=fe(d),d!==null&&lL(d)),u):(u.eventSystemFlags|=S,d=u.targetContainers,w!==null&&d.indexOf(w)===-1&&d.push(w),u)}function zQ(u,d,v,S,w){switch(d){case"focusin":return Tf=Ty(Tf,u,d,v,S,w),!0;case"dragenter":return Cf=Ty(Cf,u,d,v,S,w),!0;case"mouseover":return If=Ty(If,u,d,v,S,w),!0;case"pointerover":var N=w.pointerId;return Sy.set(N,Ty(Sy.get(N)||null,u,d,v,S,w)),!0;case"gotpointercapture":return N=w.pointerId,by.set(N,Ty(by.get(N)||null,u,d,v,S,w)),!0}return!1}function hL(u){var d=Z(u.target);if(d!==null){var v=r(d);if(v!==null){if(d=v.tag,d===13){if(d=a(v),d!==null){u.blockedOn=d,Hr(u.priority,function(){if(v.tag===13){var S=ns();S=tn(S);var w=Pl(v,S);w!==null&&Or(w,v,S),e1(v,S)}});return}}else if(d===3&&v.stateNode.current.memoizedState.isDehydrated){u.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}u.blockedOn=null}function o_(u){if(u.blockedOn!==null)return!1;for(var d=u.targetContainers;0<d.length;){var v=n1(u.nativeEvent);if(v===null){v=u.nativeEvent;var S=new v.constructor(v.type,v);bm=S,v.target.dispatchEvent(S),bm=null}else return d=fe(v),d!==null&&lL(d),u.blockedOn=v,!1;d.shift()}return!0}function fL(u,d,v){o_(u)&&v.delete(d)}function QQ(){s1=!1,Tf!==null&&o_(Tf)&&(Tf=null),Cf!==null&&o_(Cf)&&(Cf=null),If!==null&&o_(If)&&(If=null),Sy.forEach(fL),by.forEach(fL)}function l_(u,d){u.blockedOn===d&&(u.blockedOn=null,s1||(s1=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,QQ)))}var c_=null;function dL(u){c_!==u&&(c_=u,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){c_===u&&(c_=null);for(var d=0;d<u.length;d+=3){var v=u[d],S=u[d+1],w=u[d+2];if(typeof S!="function"){if(i1(S||v)===null)continue;break}var N=fe(v);N!==null&&(u.splice(d,3),d-=3,ly(N,{pending:!0,data:w,method:v.method,action:S},S,w))}}))}function Cy(u){function d(Te){return l_(Te,u)}Tf!==null&&l_(Tf,u),Cf!==null&&l_(Cf,u),If!==null&&l_(If,u),Sy.forEach(d),by.forEach(d);for(var v=0;v<Mf.length;v++){var S=Mf[v];S.blockedOn===u&&(S.blockedOn=null)}for(;0<Mf.length&&(v=Mf[0],v.blockedOn===null);)hL(v),v.blockedOn===null&&Mf.shift();if(v=(u.ownerDocument||u).$$reactFormReplay,v!=null)for(S=0;S<v.length;S+=3){var w=v[S],N=v[S+1],$=w[Ti]||null;if(typeof N=="function")$||dL(v);else if($){var le=null;if(N&&N.hasAttribute("formAction")){if(w=N,$=N[Ti]||null)le=$.formAction;else if(i1(w)!==null)continue}else le=$.action;typeof le=="function"?v[S+1]=le:(v.splice(S,3),S-=3),dL(v)}}}function r1(u){this._internalRoot=u}u_.prototype.render=r1.prototype.render=function(u){var d=this._internalRoot;if(d===null)throw Error(n(409));var v=d.current,S=ns();aL(v,S,u,d,null,null)},u_.prototype.unmount=r1.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var d=u.containerInfo;aL(u.current,2,null,u,null,null),rl(),d[Zs]=null}};function u_(u){this._internalRoot=u}u_.prototype.unstable_scheduleHydration=function(u){if(u){var d=Ln();u={blockedOn:null,target:u,priority:d};for(var v=0;v<Mf.length&&d!==0&&d<Mf[v].priority;v++);Mf.splice(v,0,u),v===0&&hL(u)}};var pL=e.version;if(pL!=="19.1.1")throw Error(n(527,pL,"19.1.1"));W.findDOMNode=function(u){var d=u._reactInternals;if(d===void 0)throw typeof u.render=="function"?Error(n(188)):(u=Object.keys(u).join(","),Error(n(268,u)));return u=l(d),u=u!==null?c(u):null,u=u===null?null:u.stateNode,u};var VQ={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var h_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!h_.isDisabled&&h_.supportsFiber)try{Ve=h_.inject(VQ),rt=h_}catch{}}return My.createRoot=function(u,d){if(!i(u))throw Error(n(299));var v=!1,S="",w=lp,N=og,$=jx,le=null;return d!=null&&(d.unstable_strictMode===!0&&(v=!0),d.identifierPrefix!==void 0&&(S=d.identifierPrefix),d.onUncaughtError!==void 0&&(w=d.onUncaughtError),d.onCaughtError!==void 0&&(N=d.onCaughtError),d.onRecoverableError!==void 0&&($=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(le=d.unstable_transitionCallbacks)),d=sL(u,1,!1,null,null,v,S,w,N,$,le,null),u[Zs]=d.current,HC(u),new r1(d)},My.hydrateRoot=function(u,d,v){if(!i(u))throw Error(n(299));var S=!1,w="",N=lp,$=og,le=jx,Te=null,je=null;return v!=null&&(v.unstable_strictMode===!0&&(S=!0),v.identifierPrefix!==void 0&&(w=v.identifierPrefix),v.onUncaughtError!==void 0&&(N=v.onUncaughtError),v.onCaughtError!==void 0&&($=v.onCaughtError),v.onRecoverableError!==void 0&&(le=v.onRecoverableError),v.unstable_transitionCallbacks!==void 0&&(Te=v.unstable_transitionCallbacks),v.formState!==void 0&&(je=v.formState)),d=sL(u,1,!0,d,v??null,S,w,N,$,le,Te,je),d.context=rL(null),v=d.current,S=ns(),S=tn(S),w=Yo(S),w.callback=null,Gl(v,w,S),v=S,d.current.lanes=v,Nt(d,v),Yc(d),u[Zs]=d.current,HC(u),new u_(d)},My.version="19.1.1",My}var bL;function e8(){if(bL)return l1.exports;bL=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),l1.exports=ZQ(),l1.exports}var t8=e8();/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var TL="popstate";function n8(s={}){function e(n,i){let{pathname:r,search:a,hash:o}=n.location;return JM("",{pathname:r,search:a,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(n,i){return typeof i=="string"?i:Cv(i)}return s8(e,t,null,s)}function As(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function dc(s,e){if(!s){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function i8(){return Math.random().toString(36).substring(2,10)}function CL(s,e){return{usr:s.state,key:s.key,idx:e}}function JM(s,e,t=null,n){return{pathname:typeof s=="string"?s:s.pathname,search:"",hash:"",...typeof e=="string"?n0(e):e,state:t,key:e&&e.key||n||i8()}}function Cv({pathname:s="/",search:e="",hash:t=""}){return e&&e!=="?"&&(s+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(s+=t.charAt(0)==="#"?t:"#"+t),s}function n0(s){let e={};if(s){let t=s.indexOf("#");t>=0&&(e.hash=s.substring(t),s=s.substring(0,t));let n=s.indexOf("?");n>=0&&(e.search=s.substring(n),s=s.substring(0,n)),s&&(e.pathname=s)}return e}function s8(s,e,t,n={}){let{window:i=document.defaultView,v5Compat:r=!1}=n,a=i.history,o="POP",l=null,c=h();c==null&&(c=0,a.replaceState({...a.state,idx:c},""));function h(){return(a.state||{idx:null}).idx}function f(){o="POP";let E=h(),_=E==null?null:E-c;c=E,l&&l({action:o,location:x.location,delta:_})}function p(E,_){o="PUSH";let b=JM(x.location,E,_);c=h()+1;let C=CL(b,c),I=x.createHref(b);try{a.pushState(C,"",I)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;i.location.assign(I)}r&&l&&l({action:o,location:x.location,delta:1})}function g(E,_){o="REPLACE";let b=JM(x.location,E,_);c=h();let C=CL(b,c),I=x.createHref(b);a.replaceState(C,"",I),r&&l&&l({action:o,location:x.location,delta:0})}function y(E){return r8(E)}let x={get action(){return o},get location(){return s(i,a)},listen(E){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(TL,f),l=E,()=>{i.removeEventListener(TL,f),l=null}},createHref(E){return e(i,E)},createURL:y,encodeLocation(E){let _=y(E);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:p,replace:g,go(E){return a.go(E)}};return x}function r8(s,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),As(t,"No window.location.(origin|href) available to create URL");let n=typeof s=="string"?s:Cv(s);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}function YF(s,e,t="/"){return a8(s,e,t,!1)}function a8(s,e,t,n){let i=typeof e=="string"?n0(e):e,r=wh(i.pathname||"/",t);if(r==null)return null;let a=XF(s);o8(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let c=y8(r);o=g8(a[l],c,n)}return o}function XF(s,e=[],t=[],n="",i=!1){let r=(a,o,l=i,c)=>{let h={relativePath:c===void 0?a.path||"":c,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(n)&&l)return;As(h.relativePath.startsWith(n),`Absolute route path "${h.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(n.length)}let f=Th([n,h.relativePath]),p=t.concat(h);a.children&&a.children.length>0&&(As(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),XF(a.children,e,p,f,l)),!(a.path==null&&!a.index)&&e.push({path:f,score:p8(f,a.index),routesMeta:p})};return s.forEach((a,o)=>{if(a.path===""||!a.path?.includes("?"))r(a,o);else for(let l of WF(a.path))r(a,o,!0,l)}),e}function WF(s){let e=s.split("/");if(e.length===0)return[];let[t,...n]=e,i=t.endsWith("?"),r=t.replace(/\?$/,"");if(n.length===0)return i?[r,""]:[r];let a=WF(n.join("/")),o=[];return o.push(...a.map(l=>l===""?r:[r,l].join("/"))),i&&o.push(...a),o.map(l=>s.startsWith("/")&&l===""?"/":l)}function o8(s){s.sort((e,t)=>e.score!==t.score?t.score-e.score:m8(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var l8=/^:[\w-]+$/,c8=3,u8=2,h8=1,f8=10,d8=-2,IL=s=>s==="*";function p8(s,e){let t=s.split("/"),n=t.length;return t.some(IL)&&(n+=d8),e&&(n+=u8),t.filter(i=>!IL(i)).reduce((i,r)=>i+(l8.test(r)?c8:r===""?h8:f8),n)}function m8(s,e){return s.length===e.length&&s.slice(0,-1).every((n,i)=>n===e[i])?s[s.length-1]-e[e.length-1]:0}function g8(s,e,t=!1){let{routesMeta:n}=s,i={},r="/",a=[];for(let o=0;o<n.length;++o){let l=n[o],c=o===n.length-1,h=r==="/"?e:e.slice(r.length)||"/",f=ub({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},h),p=l.route;if(!f&&c&&t&&!n[n.length-1].route.index&&(f=ub({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},h)),!f)return null;Object.assign(i,f.params),a.push({params:i,pathname:Th([r,f.pathname]),pathnameBase:_8(Th([r,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(r=Th([r,f.pathnameBase]))}return a}function ub(s,e){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[t,n]=A8(s.path,s.caseSensitive,s.end),i=e.match(t);if(!i)return null;let r=i[0],a=r.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:n.reduce((c,{paramName:h,isOptional:f},p)=>{if(h==="*"){let y=o[p]||"";a=r.slice(0,r.length-y.length).replace(/(.)\/+$/,"$1")}const g=o[p];return f&&!g?c[h]=void 0:c[h]=(g||"").replace(/%2F/g,"/"),c},{}),pathname:r,pathnameBase:a,pattern:s}}function A8(s,e=!1,t=!0){dc(s==="*"||!s.endsWith("*")||s.endsWith("/*"),`Route path "${s}" will be treated as if it were "${s.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${s.replace(/\*$/,"/*")}".`);let n=[],i="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(n.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return s.endsWith("*")?(n.push({paramName:"*"}),i+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":s!==""&&s!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function y8(s){try{return s.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return dc(!1,`The URL path "${s}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),s}}function wh(s,e){if(e==="/")return s;if(!s.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=s.charAt(t);return n&&n!=="/"?null:s.slice(t)||"/"}function v8(s,e="/"){let{pathname:t,search:n="",hash:i=""}=typeof s=="string"?n0(s):s;return{pathname:t?t.startsWith("/")?t:E8(t,e):e,search:S8(n),hash:b8(i)}}function E8(s,e){let t=e.replace(/\/+$/,"").split("/");return s.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function f1(s,e,t,n){return`Cannot include a '${s}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function x8(s){return s.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function $F(s){let e=x8(s);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function JF(s,e,t,n=!1){let i;typeof s=="string"?i=n0(s):(i={...s},As(!i.pathname||!i.pathname.includes("?"),f1("?","pathname","search",i)),As(!i.pathname||!i.pathname.includes("#"),f1("#","pathname","hash",i)),As(!i.search||!i.search.includes("#"),f1("#","search","hash",i)));let r=s===""||i.pathname==="",a=r?"/":i.pathname,o;if(a==null)o=t;else{let f=e.length-1;if(!n&&a.startsWith("..")){let p=a.split("/");for(;p[0]==="..";)p.shift(),f-=1;i.pathname=p.join("/")}o=f>=0?e[f]:"/"}let l=v8(i,o),c=a&&a!=="/"&&a.endsWith("/"),h=(r||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||h)&&(l.pathname+="/"),l}var Th=s=>s.join("/").replace(/\/\/+/g,"/"),_8=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),S8=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,b8=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function T8(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}var ZF=["POST","PUT","PATCH","DELETE"];new Set(ZF);var C8=["GET",...ZF];new Set(C8);var i0=ee.createContext(null);i0.displayName="DataRouter";var ET=ee.createContext(null);ET.displayName="DataRouterState";ee.createContext(!1);var eU=ee.createContext({isTransitioning:!1});eU.displayName="ViewTransition";var I8=ee.createContext(new Map);I8.displayName="Fetchers";var M8=ee.createContext(null);M8.displayName="Await";var Ru=ee.createContext(null);Ru.displayName="Navigation";var cE=ee.createContext(null);cE.displayName="Location";var Oh=ee.createContext({outlet:null,matches:[],isDataRoute:!1});Oh.displayName="Route";var MR=ee.createContext(null);MR.displayName="RouteError";function w8(s,{relative:e}={}){As(uE(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=ee.useContext(Ru),{hash:i,pathname:r,search:a}=hE(s,{relative:e}),o=r;return t!=="/"&&(o=r==="/"?t:Th([t,r])),n.createHref({pathname:o,search:a,hash:i})}function uE(){return ee.useContext(cE)!=null}function Ph(){return As(uE(),"useLocation() may be used only in the context of a <Router> component."),ee.useContext(cE).location}var tU="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function nU(s){ee.useContext(Ru).static||ee.useLayoutEffect(s)}function s0(){let{isDataRoute:s}=ee.useContext(Oh);return s?z8():R8()}function R8(){As(uE(),"useNavigate() may be used only in the context of a <Router> component.");let s=ee.useContext(i0),{basename:e,navigator:t}=ee.useContext(Ru),{matches:n}=ee.useContext(Oh),{pathname:i}=Ph(),r=JSON.stringify($F(n)),a=ee.useRef(!1);return nU(()=>{a.current=!0}),ee.useCallback((l,c={})=>{if(dc(a.current,tU),!a.current)return;if(typeof l=="number"){t.go(l);return}let h=JF(l,JSON.parse(r),i,c.relative==="path");s==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Th([e,h.pathname])),(c.replace?t.replace:t.push)(h,c.state,c)},[e,t,r,i,s])}ee.createContext(null);function hE(s,{relative:e}={}){let{matches:t}=ee.useContext(Oh),{pathname:n}=Ph(),i=JSON.stringify($F(t));return ee.useMemo(()=>JF(s,JSON.parse(i),n,e==="path"),[s,i,n,e])}function B8(s,e){return iU(s,e)}function iU(s,e,t,n,i){As(uE(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=ee.useContext(Ru),{matches:a}=ee.useContext(Oh),o=a[a.length-1],l=o?o.params:{},c=o?o.pathname:"/",h=o?o.pathnameBase:"/",f=o&&o.route;{let b=f&&f.path||"";sU(c,!f||b.endsWith("*")||b.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${b}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${b}"> to <Route path="${b==="/"?"*":`${b}/*`}">.`)}let p=Ph(),g;if(e){let b=typeof e=="string"?n0(e):e;As(h==="/"||b.pathname?.startsWith(h),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${h}" but pathname "${b.pathname}" was given in the \`location\` prop.`),g=b}else g=p;let y=g.pathname||"/",x=y;if(h!=="/"){let b=h.replace(/^\//,"").split("/");x="/"+y.replace(/^\//,"").split("/").slice(b.length).join("/")}let E=YF(s,{pathname:x});dc(f||E!=null,`No routes matched location "${g.pathname}${g.search}${g.hash}" `),dc(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${g.pathname}${g.search}${g.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let _=N8(E&&E.map(b=>Object.assign({},b,{params:Object.assign({},l,b.params),pathname:Th([h,r.encodeLocation?r.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?h:Th([h,r.encodeLocation?r.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),a,t,n,i);return e&&_?ee.createElement(cE.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...g},navigationType:"POP"}},_):_}function D8(){let s=H8(),e=T8(s)?`${s.status} ${s.statusText}`:s instanceof Error?s.message:JSON.stringify(s),t=s instanceof Error?s.stack:null,n="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:n},r={padding:"2px 4px",backgroundColor:n},a=null;return console.error("Error handled by React Router default ErrorBoundary:",s),a=ee.createElement(ee.Fragment,null,ee.createElement("p",null," Hey developer "),ee.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ee.createElement("code",{style:r},"ErrorBoundary")," or"," ",ee.createElement("code",{style:r},"errorElement")," prop on your route.")),ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},e),t?ee.createElement("pre",{style:i},t):null,a)}var L8=ee.createElement(D8,null),O8=class extends ee.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,e){return e.location!==s.location||e.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:e.error,location:e.location,revalidation:s.revalidation||e.revalidation}}componentDidCatch(s,e){this.props.unstable_onError?this.props.unstable_onError(s,e):console.error("React Router caught the following error during render",s)}render(){return this.state.error!==void 0?ee.createElement(Oh.Provider,{value:this.props.routeContext},ee.createElement(MR.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function P8({routeContext:s,match:e,children:t}){let n=ee.useContext(i0);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),ee.createElement(Oh.Provider,{value:s},t)}function N8(s,e=[],t=null,n=null,i=null){if(s==null){if(!t)return null;if(t.errors)s=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)s=t.matches;else return null}let r=s,a=t?.errors;if(a!=null){let c=r.findIndex(h=>h.route.id&&a?.[h.route.id]!==void 0);As(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),r=r.slice(0,Math.min(r.length,c+1))}let o=!1,l=-1;if(t)for(let c=0;c<r.length;c++){let h=r[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=c),h.route.id){let{loaderData:f,errors:p}=t,g=h.route.loader&&!f.hasOwnProperty(h.route.id)&&(!p||p[h.route.id]===void 0);if(h.route.lazy||g){o=!0,l>=0?r=r.slice(0,l+1):r=[r[0]];break}}}return r.reduceRight((c,h,f)=>{let p,g=!1,y=null,x=null;t&&(p=a&&h.route.id?a[h.route.id]:void 0,y=h.route.errorElement||L8,o&&(l<0&&f===0?(sU("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),g=!0,x=null):l===f&&(g=!0,x=h.route.hydrateFallbackElement||null)));let E=e.concat(r.slice(0,f+1)),_=()=>{let b;return p?b=y:g?b=x:h.route.Component?b=ee.createElement(h.route.Component,null):h.route.element?b=h.route.element:b=c,ee.createElement(P8,{match:h,routeContext:{outlet:c,matches:E,isDataRoute:t!=null},children:b})};return t&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?ee.createElement(O8,{location:t.location,revalidation:t.revalidation,component:y,error:p,children:_(),routeContext:{outlet:null,matches:E,isDataRoute:!0},unstable_onError:n}):_()},null)}function wR(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function F8(s){let e=ee.useContext(i0);return As(e,wR(s)),e}function U8(s){let e=ee.useContext(ET);return As(e,wR(s)),e}function k8(s){let e=ee.useContext(Oh);return As(e,wR(s)),e}function RR(s){let e=k8(s),t=e.matches[e.matches.length-1];return As(t.route.id,`${s} can only be used on routes that contain a unique "id"`),t.route.id}function G8(){return RR("useRouteId")}function H8(){let s=ee.useContext(MR),e=U8("useRouteError"),t=RR("useRouteError");return s!==void 0?s:e.errors?.[t]}function z8(){let{router:s}=F8("useNavigate"),e=RR("useNavigate"),t=ee.useRef(!1);return nU(()=>{t.current=!0}),ee.useCallback(async(i,r={})=>{dc(t.current,tU),t.current&&(typeof i=="number"?s.navigate(i):await s.navigate(i,{fromRouteId:e,...r}))},[s,e])}var ML={};function sU(s,e,t){!e&&!ML[s]&&(ML[s]=!0,dc(!1,t))}ee.memo(Q8);function Q8({routes:s,future:e,state:t,unstable_onError:n}){return iU(s,void 0,t,n,e)}function ia(s){As(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function V8({basename:s="/",children:e=null,location:t,navigationType:n="POP",navigator:i,static:r=!1}){As(!uE(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=s.replace(/^\/*/,"/"),o=ee.useMemo(()=>({basename:a,navigator:i,static:r,future:{}}),[a,i,r]);typeof t=="string"&&(t=n0(t));let{pathname:l="/",search:c="",hash:h="",state:f=null,key:p="default"}=t,g=ee.useMemo(()=>{let y=wh(l,a);return y==null?null:{location:{pathname:y,search:c,hash:h,state:f,key:p},navigationType:n}},[a,l,c,h,f,p,n]);return dc(g!=null,`<Router basename="${a}"> is not able to match the URL "${l}${c}${h}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:ee.createElement(Ru.Provider,{value:o},ee.createElement(cE.Provider,{children:e,value:g}))}function j8({children:s,location:e}){return B8(ZM(s),e)}function ZM(s,e=[]){let t=[];return ee.Children.forEach(s,(n,i)=>{if(!ee.isValidElement(n))return;let r=[...e,i];if(n.type===ee.Fragment){t.push.apply(t,ZM(n.props.children,r));return}As(n.type===ia,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),As(!n.props.index||!n.props.children,"An index route cannot have child routes.");let a={id:n.props.id||r.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=ZM(n.props.children,r)),t.push(a)}),t}var NS="get",FS="application/x-www-form-urlencoded";function xT(s){return s!=null&&typeof s.tagName=="string"}function q8(s){return xT(s)&&s.tagName.toLowerCase()==="button"}function K8(s){return xT(s)&&s.tagName.toLowerCase()==="form"}function Y8(s){return xT(s)&&s.tagName.toLowerCase()==="input"}function X8(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function W8(s,e){return s.button===0&&(!e||e==="_self")&&!X8(s)}function ew(s=""){return new URLSearchParams(typeof s=="string"||Array.isArray(s)||s instanceof URLSearchParams?s:Object.keys(s).reduce((e,t)=>{let n=s[t];return e.concat(Array.isArray(n)?n.map(i=>[t,i]):[[t,n]])},[]))}function $8(s,e){let t=ew(s);return e&&e.forEach((n,i)=>{t.has(i)||e.getAll(i).forEach(r=>{t.append(i,r)})}),t}var f_=null;function J8(){if(f_===null)try{new FormData(document.createElement("form"),0),f_=!1}catch{f_=!0}return f_}var Z8=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function d1(s){return s!=null&&!Z8.has(s)?(dc(!1,`"${s}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${FS}"`),null):s}function e5(s,e){let t,n,i,r,a;if(K8(s)){let o=s.getAttribute("action");n=o?wh(o,e):null,t=s.getAttribute("method")||NS,i=d1(s.getAttribute("enctype"))||FS,r=new FormData(s)}else if(q8(s)||Y8(s)&&(s.type==="submit"||s.type==="image")){let o=s.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=s.getAttribute("formaction")||o.getAttribute("action");if(n=l?wh(l,e):null,t=s.getAttribute("formmethod")||o.getAttribute("method")||NS,i=d1(s.getAttribute("formenctype"))||d1(o.getAttribute("enctype"))||FS,r=new FormData(o,s),!J8()){let{name:c,type:h,value:f}=s;if(h==="image"){let p=c?`${c}.`:"";r.append(`${p}x`,"0"),r.append(`${p}y`,"0")}else c&&r.append(c,f)}}else{if(xT(s))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=NS,n=null,i=FS,a=s}return r&&i==="text/plain"&&(a=r,r=void 0),{action:n,method:t.toLowerCase(),encType:i,formData:r,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function BR(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function t5(s,e,t){let n=typeof s=="string"?new URL(s,typeof window>"u"?"server://singlefetch/":window.location.origin):s;return n.pathname==="/"?n.pathname=`_root.${t}`:e&&wh(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${t}`,n}async function n5(s,e){if(s.id in e)return e[s.id];try{let t=await import(s.module);return e[s.id]=t,t}catch(t){return console.error(`Error loading route module \`${s.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function i5(s){return s==null?!1:s.href==null?s.rel==="preload"&&typeof s.imageSrcSet=="string"&&typeof s.imageSizes=="string":typeof s.rel=="string"&&typeof s.href=="string"}async function s5(s,e,t){let n=await Promise.all(s.map(async i=>{let r=e.routes[i.route.id];if(r){let a=await n5(r,t);return a.links?a.links():[]}return[]}));return l5(n.flat(1).filter(i5).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function wL(s,e,t,n,i,r){let a=(l,c)=>t[c]?l.route.id!==t[c].route.id:!0,o=(l,c)=>t[c].pathname!==l.pathname||t[c].route.path?.endsWith("*")&&t[c].params["*"]!==l.params["*"];return r==="assets"?e.filter((l,c)=>a(l,c)||o(l,c)):r==="data"?e.filter((l,c)=>{let h=n.routes[l.route.id];if(!h||!h.hasLoader)return!1;if(a(l,c)||o(l,c))return!0;if(l.route.shouldRevalidate){let f=l.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(s,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function r5(s,e,{includeHydrateFallback:t}={}){return a5(s.map(n=>{let i=e.routes[n.route.id];if(!i)return[];let r=[i.module];return i.clientActionModule&&(r=r.concat(i.clientActionModule)),i.clientLoaderModule&&(r=r.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(r=r.concat(i.hydrateFallbackModule)),i.imports&&(r=r.concat(i.imports)),r}).flat(1))}function a5(s){return[...new Set(s)]}function o5(s){let e={},t=Object.keys(s).sort();for(let n of t)e[n]=s[n];return e}function l5(s,e){let t=new Set;return new Set(e),s.reduce((n,i)=>{let r=JSON.stringify(o5(i));return t.has(r)||(t.add(r),n.push({key:r,link:i})),n},[])}function rU(){let s=ee.useContext(i0);return BR(s,"You must render this element inside a <DataRouterContext.Provider> element"),s}function c5(){let s=ee.useContext(ET);return BR(s,"You must render this element inside a <DataRouterStateContext.Provider> element"),s}var DR=ee.createContext(void 0);DR.displayName="FrameworkContext";function aU(){let s=ee.useContext(DR);return BR(s,"You must render this element inside a <HydratedRouter> element"),s}function u5(s,e){let t=ee.useContext(DR),[n,i]=ee.useState(!1),[r,a]=ee.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:c,onMouseLeave:h,onTouchStart:f}=e,p=ee.useRef(null);ee.useEffect(()=>{if(s==="render"&&a(!0),s==="viewport"){let x=_=>{_.forEach(b=>{a(b.isIntersecting)})},E=new IntersectionObserver(x,{threshold:.5});return p.current&&E.observe(p.current),()=>{E.disconnect()}}},[s]),ee.useEffect(()=>{if(n){let x=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(x)}}},[n]);let g=()=>{i(!0)},y=()=>{i(!1),a(!1)};return t?s!=="intent"?[r,p,{}]:[r,p,{onFocus:wy(o,g),onBlur:wy(l,y),onMouseEnter:wy(c,g),onMouseLeave:wy(h,y),onTouchStart:wy(f,g)}]:[!1,p,{}]}function wy(s,e){return t=>{s&&s(t),t.defaultPrevented||e(t)}}function h5({page:s,...e}){let{router:t}=rU(),n=ee.useMemo(()=>YF(t.routes,s,t.basename),[t.routes,s,t.basename]);return n?ee.createElement(d5,{page:s,matches:n,...e}):null}function f5(s){let{manifest:e,routeModules:t}=aU(),[n,i]=ee.useState([]);return ee.useEffect(()=>{let r=!1;return s5(s,e,t).then(a=>{r||i(a)}),()=>{r=!0}},[s,e,t]),n}function d5({page:s,matches:e,...t}){let n=Ph(),{manifest:i,routeModules:r}=aU(),{basename:a}=rU(),{loaderData:o,matches:l}=c5(),c=ee.useMemo(()=>wL(s,e,l,i,n,"data"),[s,e,l,i,n]),h=ee.useMemo(()=>wL(s,e,l,i,n,"assets"),[s,e,l,i,n]),f=ee.useMemo(()=>{if(s===n.pathname+n.search+n.hash)return[];let y=new Set,x=!1;if(e.forEach(_=>{let b=i.routes[_.route.id];!b||!b.hasLoader||(!c.some(C=>C.route.id===_.route.id)&&_.route.id in o&&r[_.route.id]?.shouldRevalidate||b.hasClientLoader?x=!0:y.add(_.route.id))}),y.size===0)return[];let E=t5(s,a,"data");return x&&y.size>0&&E.searchParams.set("_routes",e.filter(_=>y.has(_.route.id)).map(_=>_.route.id).join(",")),[E.pathname+E.search]},[a,o,n,i,c,e,s,r]),p=ee.useMemo(()=>r5(h,i),[h,i]),g=f5(h);return ee.createElement(ee.Fragment,null,f.map(y=>ee.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...t})),p.map(y=>ee.createElement("link",{key:y,rel:"modulepreload",href:y,...t})),g.map(({key:y,link:x})=>ee.createElement("link",{key:y,nonce:t.nonce,...x})))}function p5(...s){return e=>{s.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var oU=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{oU&&(window.__reactRouterVersion="7.8.2")}catch{}function m5({basename:s,children:e,window:t}){let n=ee.useRef();n.current==null&&(n.current=n8({window:t,v5Compat:!0}));let i=n.current,[r,a]=ee.useState({action:i.action,location:i.location}),o=ee.useCallback(l=>{ee.startTransition(()=>a(l))},[a]);return ee.useLayoutEffect(()=>i.listen(o),[i,o]),ee.createElement(V8,{basename:s,children:e,location:r.location,navigationType:r.action,navigator:i})}var lU=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Yf=ee.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:i,reloadDocument:r,replace:a,state:o,target:l,to:c,preventScrollReset:h,viewTransition:f,...p},g){let{basename:y}=ee.useContext(Ru),x=typeof c=="string"&&lU.test(c),E,_=!1;if(typeof c=="string"&&x&&(E=c,oU))try{let L=new URL(window.location.href),O=c.startsWith("//")?new URL(L.protocol+c):new URL(c),U=wh(O.pathname,y);O.origin===L.origin&&U!=null?c=U+O.search+O.hash:_=!0}catch{dc(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let b=w8(c,{relative:i}),[C,I,M]=u5(n,p),R=v5(c,{replace:a,state:o,target:l,preventScrollReset:h,relative:i,viewTransition:f});function D(L){e&&e(L),L.defaultPrevented||R(L)}let P=ee.createElement("a",{...p,...M,href:E||b,onClick:_||r?e:D,ref:p5(g,I),target:l,"data-discover":!x&&t==="render"?"true":void 0});return C&&!x?ee.createElement(ee.Fragment,null,P,ee.createElement(h5,{page:b})):P});Yf.displayName="Link";var g5=ee.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:i=!1,style:r,to:a,viewTransition:o,children:l,...c},h){let f=hE(a,{relative:c.relative}),p=Ph(),g=ee.useContext(ET),{navigator:y,basename:x}=ee.useContext(Ru),E=g!=null&&b5(f)&&o===!0,_=y.encodeLocation?y.encodeLocation(f).pathname:f.pathname,b=p.pathname,C=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;t||(b=b.toLowerCase(),C=C?C.toLowerCase():null,_=_.toLowerCase()),C&&x&&(C=wh(C,x)||C);const I=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let M=b===_||!i&&b.startsWith(_)&&b.charAt(I)==="/",R=C!=null&&(C===_||!i&&C.startsWith(_)&&C.charAt(_.length)==="/"),D={isActive:M,isPending:R,isTransitioning:E},P=M?e:void 0,L;typeof n=="function"?L=n(D):L=[n,M?"active":null,R?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let O=typeof r=="function"?r(D):r;return ee.createElement(Yf,{...c,"aria-current":P,className:L,ref:h,style:O,to:a,viewTransition:o},typeof l=="function"?l(D):l)});g5.displayName="NavLink";var A5=ee.forwardRef(({discover:s="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:i,state:r,method:a=NS,action:o,onSubmit:l,relative:c,preventScrollReset:h,viewTransition:f,...p},g)=>{let y=_5(),x=S5(o,{relative:c}),E=a.toLowerCase()==="get"?"get":"post",_=typeof o=="string"&&lU.test(o),b=C=>{if(l&&l(C),C.defaultPrevented)return;C.preventDefault();let I=C.nativeEvent.submitter,M=I?.getAttribute("formmethod")||a;y(I||C.currentTarget,{fetcherKey:e,method:M,navigate:t,replace:i,state:r,relative:c,preventScrollReset:h,viewTransition:f})};return ee.createElement("form",{ref:g,method:E,action:x,onSubmit:n?l:b,...p,"data-discover":!_&&s==="render"?"true":void 0})});A5.displayName="Form";function y5(s){return`${s} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function cU(s){let e=ee.useContext(i0);return As(e,y5(s)),e}function v5(s,{target:e,replace:t,state:n,preventScrollReset:i,relative:r,viewTransition:a}={}){let o=s0(),l=Ph(),c=hE(s,{relative:r});return ee.useCallback(h=>{if(W8(h,e)){h.preventDefault();let f=t!==void 0?t:Cv(l)===Cv(c);o(s,{replace:f,state:n,preventScrollReset:i,relative:r,viewTransition:a})}},[l,o,c,t,n,e,s,i,r,a])}function LR(s){dc(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=ee.useRef(ew(s)),t=ee.useRef(!1),n=Ph(),i=ee.useMemo(()=>$8(n.search,t.current?null:e.current),[n.search]),r=s0(),a=ee.useCallback((o,l)=>{const c=ew(typeof o=="function"?o(new URLSearchParams(i)):o);t.current=!0,r("?"+c,l)},[r,i]);return[i,a]}var E5=0,x5=()=>`__${String(++E5)}__`;function _5(){let{router:s}=cU("useSubmit"),{basename:e}=ee.useContext(Ru),t=G8();return ee.useCallback(async(n,i={})=>{let{action:r,method:a,encType:o,formData:l,body:c}=e5(n,e);if(i.navigate===!1){let h=i.fetcherKey||x5();await s.fetch(h,t,i.action||r,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||a,formEncType:i.encType||o,flushSync:i.flushSync})}else await s.navigate(i.action||r,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||a,formEncType:i.encType||o,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[s,e,t])}function S5(s,{relative:e}={}){let{basename:t}=ee.useContext(Ru),n=ee.useContext(Oh);As(n,"useFormAction must be used inside a RouteContext");let[i]=n.matches.slice(-1),r={...hE(s||".",{relative:e})},a=Ph();if(s==null){r.search=a.search;let o=new URLSearchParams(r.search),l=o.getAll("index");if(l.some(h=>h==="")){o.delete("index"),l.filter(f=>f).forEach(f=>o.append("index",f));let h=o.toString();r.search=h?`?${h}`:""}}return(!s||s===".")&&i.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(r.pathname=r.pathname==="/"?t:Th([t,r.pathname])),Cv(r)}function b5(s,{relative:e}={}){let t=ee.useContext(eU);As(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=cU("useViewTransitionState"),i=hE(s,{relative:e});if(!t.isTransitioning)return!1;let r=wh(t.currentLocation.pathname,n)||t.currentLocation.pathname,a=wh(t.nextLocation.pathname,n)||t.nextLocation.pathname;return ub(i.pathname,a)!=null||ub(i.pathname,r)!=null}function T5(){const s=Ph(),e=s.pathname.startsWith("/vod/theater")||s.pathname.startsWith("/share/videoshare")||s.pathname.startsWith("/share/imageshare"),[t,n]=ee.useState(!1);return G.jsxs("header",{className:`header${e?" compact":""}`,role:"banner",children:[G.jsxs("div",{className:"brand",children:[G.jsx("div",{className:"logo","aria-label":"AP logo",children:"AP"}),G.jsxs("nav",{className:"nav brand-nav","aria-label":"Primary",children:[G.jsx(Yf,{className:"pill",to:"/",children:"Home"}),G.jsx("a",{className:"pill",href:"#work",children:"Work"}),G.jsx("a",{className:"pill",href:"#projects",children:"Projects"}),G.jsx("a",{className:"pill",href:"#about",children:"About"}),G.jsx("a",{className:"pill",href:"#contact",children:"Contact"}),G.jsx(Yf,{className:"pill",to:"/motion",children:"Motion Design"}),G.jsx(Yf,{className:"pill",to:"/vod",children:"VOD"}),G.jsx(Yf,{className:"pill",to:"/fieldshare",children:"FieldShare"}),G.jsx("a",{className:"pill primary",href:"#contact",children:"Let's collaborate"})]})]}),G.jsx("div",{className:"nav",children:G.jsx("button",{className:"menu-toggle","aria-label":"Open menu","aria-expanded":t,onClick:()=>n(i=>!i),children:G.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:G.jsx("path",{d:"M4 6h16v2H4V6zm0 5h16v2H4v-2zm0 5h16v2H4v-2z"})})})})]})}function C5(){return G.jsxs("footer",{role:"contentinfo",children:[G.jsxs("div",{className:"foot",children:[G.jsxs("div",{children:[G.jsx("h3",{children:"Updates"}),G.jsxs("ul",{children:[G.jsx("li",{children:G.jsx("a",{href:"#",children:"Newsletter"})}),G.jsx("li",{children:G.jsx("a",{href:"#",children:"Instagram"})})]})]}),G.jsxs("div",{children:[G.jsx("h3",{children:"Clients & Partners"}),G.jsxs("ul",{children:[G.jsx("li",{children:"FFG / KWF (projects)"}),G.jsx("li",{children:"Makerspace Villach"}),G.jsx("li",{children:"Local schools & tourism"})]})]}),G.jsxs("div",{children:[G.jsx("h3",{children:"Legal"}),G.jsxs("ul",{children:[G.jsx("li",{children:G.jsx("a",{href:"#",children:"Imprint"})}),G.jsx("li",{children:G.jsx("a",{href:"#",children:"Privacy"})})]})]}),G.jsxs("div",{children:[G.jsx("h3",{children:"Credits"}),G.jsx("ul",{children:G.jsx("li",{children:"Design & Dev: Alexander Popovic"})})]})]}),G.jsxs("div",{className:"foot-bottom",children:[" ",G.jsx("span",{id:"y"})," Alexander Popovic"]})]})}const Ft=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},I5=Number.isSafeInteger||function(s){return typeof s=="number"&&Math.abs(s)<=M5},M5=Number.MAX_SAFE_INTEGER||9007199254740991;let Wt=(function(s){return s.NETWORK_ERROR="networkError",s.MEDIA_ERROR="mediaError",s.KEY_SYSTEM_ERROR="keySystemError",s.MUX_ERROR="muxError",s.OTHER_ERROR="otherError",s})({}),He=(function(s){return s.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",s.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",s.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_PARSING_ERROR="levelParsingError",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.FRAG_GAP="fragGap",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.ASSET_LIST_LOAD_ERROR="assetListLoadError",s.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",s.ASSET_LIST_PARSING_ERROR="assetListParsingError",s.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.ATTACH_MEDIA_ERROR="attachMediaError",s.UNKNOWN="unknown",s})({}),Y=(function(s){return s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.MEDIA_ENDED="hlsMediaEnded",s.STALL_RESOLVED="hlsStallResolved",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFERED_TO_END="hlsBufferedToEnd",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached",s.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",s.ASSET_LIST_LOADING="hlsAssetListLoading",s.ASSET_LIST_LOADED="hlsAssetListLoaded",s.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",s.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",s.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",s.INTERSTITIAL_STARTED="hlsInterstitialStarted",s.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",s.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",s.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",s.INTERSTITIAL_ENDED="hlsInterstitialEnded",s.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",s.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",s.EVENT_CUE_ENTER="hlsEventCueEnter",s})({});var Hn={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},jt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class bg{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class w5{constructor(e,t,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new bg(e),this.fast_=new bg(t),this.defaultTTFB_=i,this.ttfb_=new bg(e)}update(e,t){const{slow_:n,fast_:i,ttfb_:r}=this;n.halfLife!==e&&(this.slow_=new bg(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new bg(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new bg(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,i=e/1e3,r=n/i;this.fast_.sample(i,r),this.slow_.sample(i,r)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function R5(s,e,t){return(e=D5(e))in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Li(){return Li=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},Li.apply(null,arguments)}function RL(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),t.push.apply(t,n)}return t}function Di(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?RL(Object(t),!0).forEach(function(n){R5(s,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):RL(Object(t)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(t,n))})}return s}function B5(s,e){if(typeof s!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var n=t.call(s,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function D5(s){var e=B5(s,"string");return typeof e=="symbol"?e:e+""}let Sl=class{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=Vf,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}};const Vf=function(){},L5={trace:Vf,debug:Vf,log:Vf,warn:Vf,info:Vf,error:Vf};function tw(){return Li({},L5)}function O5(s,e){const t=self.console[s];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${s}] >`):Vf}function BL(s,e,t){return e[s]?e[s].bind(e):O5(s,t)}const nw=tw();function P5(s,e,t){const n=tw();if(typeof console=="object"&&s===!0||typeof s=="object"){const i=["debug","log","info","warn","error"];i.forEach(r=>{n[r]=BL(r,s,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.11`)}catch{return tw()}i.forEach(r=>{nw[r]=BL(r,s)})}else Li(nw,n);return n}const _i=nw;function od(s=!0){return typeof self>"u"?void 0:(s||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function N5(s){return typeof self<"u"&&s===self.ManagedMediaSource}function uU(s,e){const t=Object.keys(s),n=Object.keys(e),i=t.length,r=n.length;return!i||!r||i===r&&!t.some(a=>n.indexOf(a)===-1)}function Fo(s,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(s);if(e){const h=c.indexOf("\0");return h!==-1?c.substring(0,h):c}return c.replace(/\0/g,"")}const t=s.length;let n,i,r,a="",o=0;for(;o<t;){if(n=s[o++],n===0&&e)return a;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:i=s[o++],a+=String.fromCharCode((n&31)<<6|i&63);break;case 14:i=s[o++],r=s[o++],a+=String.fromCharCode((n&15)<<12|(i&63)<<6|(r&63)<<0);break}}return a}function wo(s){let e="";for(let t=0;t<s.length;t++){let n=s[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function hU(s){return Uint8Array.from(s.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function F5(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var p1={exports:{}},DL;function U5(){return DL||(DL=1,(function(s,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,c,h){if(h=h||{},l=l.trim(),c=c.trim(),!c){if(!h.alwaysNormalize)return l;var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");return f.path=o.normalizePath(f.path),o.buildURLFromParts(f)}var p=o.parseURL(c);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return h.alwaysNormalize?(p.path=o.normalizePath(p.path),o.buildURLFromParts(p)):c;var g=o.parseURL(l);if(!g)throw new Error("Error trying to parse base URL.");if(!g.netLoc&&g.path&&g.path[0]!=="/"){var y=i.exec(g.path);g.netLoc=y[1],g.path=y[2]}g.netLoc&&!g.path&&(g.path="/");var x={scheme:g.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(x.netLoc=g.netLoc,p.path[0]!=="/"))if(!p.path)x.path=g.path,p.params||(x.params=g.params,p.query||(x.query=g.query));else{var E=g.path,_=E.substring(0,E.lastIndexOf("/")+1)+p.path;x.path=o.normalizePath(_)}return x.path===null&&(x.path=h.alwaysNormalize?o.normalizePath(p.path):p.path),o.buildURLFromParts(x)},parseURL:function(l){var c=n.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(r,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};s.exports=o})()})(p1)),p1.exports}var OR=U5();class PR{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Gi={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class fU{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,G5(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let i;n.length===1?i=t?.byteRangeEndOffset||0:i=parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Gi.AUDIO]:null,[Gi.VIDEO]:null,[Gi.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new PR),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=OR.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Gi.AUDIO]=null,e[Gi.VIDEO]=null,e[Gi.AUDIOVIDEO]=null}}function Ks(s){return s.sn!=="initSegment"}class m1 extends fU{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Ft(e)&&Ft(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const n=Object.keys(this.levelkeys);if(n.length===1){const i=this._decryptdata=this.levelkeys[n[0]]||null;if(i)return i.getDecryptData(this.sn)}}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Ft(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),i=n.length;if(i>1||i===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ft(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ks(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,i,r,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:r,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,n),l.startDTS=Math.min(l.startDTS,i),l.endDTS=Math.max(l.endDTS,r)}}class k5 extends fU{constructor(e,t,n,i,r){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function dU(s,e){const t=Object.getPrototypeOf(s);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||dU(t,e)}}function G5(s,e){const t=dU(s,e);t&&(t.enumerable=!0,Object.defineProperty(s,e,t))}const LL=Math.pow(2,32)-1,H5=[].push,pU={video:1,audio:2,id3:3,text:4};function cr(s){return String.fromCharCode.apply(null,s)}function mU(s,e){const t=s[e]<<8|s[e+1];return t<0?65536+t:t}function gn(s,e){const t=gU(s,e);return t<0?4294967296+t:t}function OL(s,e){let t=gn(s,e);return t*=Math.pow(2,32),t+=gn(s,e+4),t}function gU(s,e){return s[e]<<24|s[e+1]<<16|s[e+2]<<8|s[e+3]}function z5(s){const e=s.byteLength;for(let t=0;t<e;){const n=gn(s,t);if(n>8&&s[t+4]===109&&s[t+5]===111&&s[t+6]===111&&s[t+7]===102)return!0;t=n>1?t+n:e}return!1}function Fn(s,e){const t=[];if(!e.length)return t;const n=s.byteLength;for(let i=0;i<n;){const r=gn(s,i),a=cr(s.subarray(i+4,i+8)),o=r>1?i+r:n;if(a===e[0])if(e.length===1)t.push(s.subarray(i+8,o));else{const l=Fn(s.subarray(i+8,o),e.slice(1));l.length&&H5.apply(t,l)}i=o}return t}function Q5(s){const e=[],t=s[0];let n=8;const i=gn(s,n);n+=4;let r=0,a=0;t===0?(r=gn(s,n),a=gn(s,n+4),n+=8):(r=OL(s,n),a=OL(s,n+8),n+=16),n+=2;let o=s.length+a;const l=mU(s,n);n+=2;for(let c=0;c<l;c++){let h=n;const f=gn(s,h);h+=4;const p=f&2147483647;if((f&2147483648)>>>31===1)return _i.warn("SIDX has hierarchical references (not supported)"),null;const y=gn(s,h);h+=4,e.push({referenceSize:p,subsegmentDuration:y,info:{duration:y/i,start:o,end:o+p-1}}),o+=p,h+=4,n=h}return{earliestPresentationTime:r,timescale:i,version:t,referencesCount:l,references:e}}function AU(s){const e=[],t=Fn(s,["moov","trak"]);for(let i=0;i<t.length;i++){const r=t[i],a=Fn(r,["tkhd"])[0];if(a){let o=a[0];const l=gn(a,o===0?12:20),c=Fn(r,["mdia","mdhd"])[0];if(c){o=c[0];const h=gn(c,o===0?12:20),f=Fn(r,["mdia","hdlr"])[0];if(f){const p=cr(f.subarray(8,12)),g={soun:Gi.AUDIO,vide:Gi.VIDEO}[p],y=Fn(r,["mdia","minf","stbl","stsd"])[0],x=V5(y);g?(e[l]={timescale:h,type:g,stsd:x},e[g]=Di({timescale:h,id:l},x)):e[l]={timescale:h,type:p,stsd:x}}}}}return Fn(s,["moov","mvex","trex"]).forEach(i=>{const r=gn(i,4),a=e[r];a&&(a.default={duration:gn(i,12),flags:gn(i,20)})}),e}function V5(s){const e=s.subarray(8),t=e.subarray(86),n=cr(e.subarray(4,8));let i=n,r;const a=n==="enca"||n==="encv";if(a){const c=Fn(e,[n])[0].subarray(n==="enca"?28:78);Fn(c,["sinf"]).forEach(f=>{const p=Fn(f,["schm"])[0];if(p){const g=cr(p.subarray(4,8));if(g==="cbcs"||g==="cenc"){const y=Fn(f,["frma"])[0];y&&(i=cr(y))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const l=Fn(t,["avcC"])[0];l&&l.length>3&&(i+="."+p_(l[1])+p_(l[2])+p_(l[3]),r=d_(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=Fn(e,[n])[0],c=Fn(l.subarray(28),["esds"])[0];if(c&&c.length>7){let h=4;if(c[h++]!==3)break;h=g1(c,h),h+=2;const f=c[h++];if(f&128&&(h+=2),f&64&&(h+=c[h++]),c[h++]!==4)break;h=g1(c,h);const p=c[h++];if(p===64)i+="."+p_(p);else break;if(h+=12,c[h++]!==5)break;h=g1(c,h);const g=c[h++];let y=(g&248)>>3;y===31&&(y+=1+((g&7)<<3)+((c[h]&224)>>5)),i+="."+y}break}case"hvc1":case"hev1":{const l=Fn(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],h=["","A","B","C"][c>>6],f=c&31,p=gn(l,2),g=(c&32)>>5?"H":"L",y=l[12],x=l.subarray(6,12);i+="."+h+f,i+="."+j5(p).toString(16).toUpperCase(),i+="."+g+y;let E="";for(let _=x.length;_--;){const b=x[_];(b||E)&&(E="."+b.toString(16).toUpperCase()+E)}i+=E}r=d_(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=d_(i,t)||i;break}case"vp09":{const l=Fn(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],h=l[5],f=l[6]>>4&15;i+="."+uu(c)+"."+uu(h)+"."+uu(f)}break}case"av01":{const l=Fn(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,h=l[1]&31,f=l[2]>>>7?"H":"M",p=(l[2]&64)>>6,g=(l[2]&32)>>5,y=c===2&&p?g?12:10:p?10:8,x=(l[2]&16)>>4,E=(l[2]&8)>>3,_=(l[2]&4)>>2,b=l[2]&3;i+="."+c+"."+uu(h)+f+"."+uu(y)+"."+x+"."+E+_+b+"."+uu(1)+"."+uu(1)+"."+uu(1)+"."+0,r=d_("dav1",t)}break}}return{codec:i,encrypted:a,supplemental:r}}function d_(s,e){const t=Fn(e,["dvvC"]),n=t.length?t[0]:Fn(e,["dvcC"])[0];if(n){const i=n[2]>>1&127,r=n[2]<<5&32|n[3]>>3&31;return s+"."+uu(i)+"."+uu(r)}}function j5(s){let e=0;for(let t=0;t<32;t++)e|=(s>>t&1)<<31-t;return e>>>0}function g1(s,e){const t=e+5;for(;s[e++]&128&&e<t;);return e}function p_(s){return("0"+s.toString(16).toUpperCase()).slice(-2)}function uu(s){return(s<10?"0":"")+s}function q5(s,e){if(!s||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Fn(s,["moov","trak"]).forEach(i=>{const a=Fn(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let o=Fn(a,["enca"]);const l=o.length>0;l||(o=Fn(a,["encv"])),o.forEach(c=>{const h=l?c.subarray(28):c.subarray(78);Fn(h,["sinf"]).forEach(p=>{const g=yU(p);if(g){const y=g.subarray(8,24);y.some(x=>x!==0)||(_i.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${wo(y)} -> ${wo(t)}`),g.set(t,8))}})})})}function yU(s){const e=Fn(s,["schm"])[0];if(e){const t=cr(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Fn(s,["schi","tenc"])[0]}return null}function K5(s,e,t){const n={},i=Fn(s,["moof","traf"]);for(let r=0;r<i.length;r++){const a=i[r],o=Fn(a,["tfhd"])[0],l=gn(o,4),c=e[l];if(!c)continue;n[l]||(n[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const h=n[l],f=Fn(a,["tfdt"])[0];if(f){const C=f[0];let I=gn(f,4);C===1&&(I===LL?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(I*=LL+1,I+=gn(f,8))),Ft(I)&&(!Ft(h.start)||I<h.start)&&(h.start=I)}const p=c.default,g=gn(o,0)|p?.flags;let y=p?.duration||0;g&8&&(g&2?y=gn(o,12):y=gn(o,8));const x=Fn(a,["trun"]);let E=h.start||0,_=0,b=y;for(let C=0;C<x.length;C++){const I=x[C],M=gn(I,4),R=h.sampleCount;h.sampleCount+=M;const D=I[3]&1,P=I[3]&4,L=I[2]&1,O=I[2]&2,U=I[2]&4,j=I[2]&8;let H=8,z=M;for(D&&(H+=4),P&&M&&(!(I[H+1]&1)&&h.keyFrameIndex===void 0&&(h.keyFrameIndex=R),H+=4,L?(b=gn(I,H),H+=4):b=y,O&&(H+=4),j&&(H+=4),E+=b,_+=b,z--);z--;)L?(b=gn(I,H),H+=4):b=y,O&&(H+=4),U&&(I[H+1]&1||h.keyFrameIndex===void 0&&(h.keyFrameIndex=h.sampleCount-(z+1),h.keyFrameStart=E),H+=4),j&&(H+=4),E+=b,_+=b;!_&&y&&(_+=y*M)}h.duration+=_}if(!Object.keys(n).some(r=>n[r].duration)){let r=1/0,a=0;const o=Fn(s,["sidx"]);for(let l=0;l<o.length;l++){const c=Q5(o[l]);if(c!=null&&c.references){r=Math.min(r,c.earliestPresentationTime/c.timescale);const h=c.references.reduce((f,p)=>f+p.info.duration||0,0);a=Math.max(a,h+c.earliestPresentationTime/c.timescale)}}a&&Ft(a)&&Object.keys(n).forEach(l=>{n[l].duration||(n[l].duration=a*n[l].timescale-n[l].start)})}return n}function Y5(s){const e={valid:null,remainder:null},t=Fn(s,["moof"]);if(t.length<2)return e.remainder=s,e;const n=t[t.length-1];return e.valid=s.slice(0,n.byteOffset-8),e.remainder=s.slice(n.byteOffset-8),e}function xl(s,e){const t=new Uint8Array(s.length+e.length);return t.set(s),t.set(e,s.length),t}function PL(s,e){const t=[],n=e.samples,i=e.timescale,r=e.id;let a=!1;return Fn(n,["moof"]).map(l=>{const c=l.byteOffset-8;Fn(l,["traf"]).map(f=>{const p=Fn(f,["tfdt"]).map(g=>{const y=g[0];let x=gn(g,4);return y===1&&(x*=Math.pow(2,32),x+=gn(g,8)),x/i})[0];return p!==void 0&&(s=p),Fn(f,["tfhd"]).map(g=>{const y=gn(g,4),x=gn(g,0)&16777215,E=(x&1)!==0,_=(x&2)!==0,b=(x&8)!==0;let C=0;const I=(x&16)!==0;let M=0;const R=(x&32)!==0;let D=8;y===r&&(E&&(D+=8),_&&(D+=4),b&&(C=gn(g,D),D+=4),I&&(M=gn(g,D),D+=4),R&&(D+=4),e.type==="video"&&(a=_T(e.codec)),Fn(f,["trun"]).map(P=>{const L=P[0],O=gn(P,0)&16777215,U=(O&1)!==0;let j=0;const H=(O&4)!==0,z=(O&256)!==0;let q=0;const k=(O&512)!==0;let W=0;const V=(O&1024)!==0,X=(O&2048)!==0;let K=0;const te=gn(P,4);let oe=8;U&&(j=gn(P,oe),oe+=4),H&&(oe+=4);let Ee=j+c;for(let Ce=0;Ce<te;Ce++){if(z?(q=gn(P,oe),oe+=4):q=C,k?(W=gn(P,oe),oe+=4):W=M,V&&(oe+=4),X&&(L===0?K=gn(P,oe):K=gU(P,oe),oe+=4),e.type===Gi.VIDEO){let se=0;for(;se<W;){const ie=gn(n,Ee);if(Ee+=4,X5(a,n[Ee])){const ne=n.subarray(Ee,Ee+ie);NR(ne,a?2:1,s+K/i,t)}Ee+=ie,se+=ie+4}}s+=q/i}}))})})}),t}function _T(s){if(!s)return!1;const e=s.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function X5(s,e){if(s){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function NR(s,e,t,n){const i=vU(s);let r=0;r+=e;let a=0,o=0,l=0;for(;r<i.length;){a=0;do{if(r>=i.length)break;l=i[r++],a+=l}while(l===255);o=0;do{if(r>=i.length)break;l=i[r++],o+=l}while(l===255);const c=i.length-r;let h=r;if(o<c)r+=o;else if(o>c){_i.error(`Malformed SEI payload. ${o} is too small, only ${c} bytes left to parse.`);break}if(a===4){if(i[h++]===181){const p=mU(i,h);if(h+=2,p===49){const g=gn(i,h);if(h+=4,g===1195456820){const y=i[h++];if(y===3){const x=i[h++],E=31&x,_=64&x,b=_?2+E*3:0,C=new Uint8Array(b);if(_){C[0]=x;for(let I=1;I<b;I++)C[I]=i[h++]}n.push({type:y,payloadType:a,pts:t,bytes:C})}}}}}else if(a===5&&o>16){const f=[];for(let y=0;y<16;y++){const x=i[h++].toString(16);f.push(x.length==1?"0"+x:x),(y===3||y===5||y===7||y===9)&&f.push("-")}const p=o-16,g=new Uint8Array(p);for(let y=0;y<p;y++)g[y]=i[h++];n.push({payloadType:a,pts:t,uuid:f.join(""),userData:Fo(g),userDataBytes:g})}}}function vU(s){const e=s.byteLength,t=[];let n=1;for(;n<e-2;)s[n]===0&&s[n+1]===0&&s[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return s;const i=e-t.length,r=new Uint8Array(i);let a=0;for(n=0;n<i;a++,n++)a===t[0]&&(a++,t.shift()),r[n]=s[a];return r}function W5(s){const e=s[0];let t="",n="",i=0,r=0,a=0,o=0,l=0,c=0;if(e===0){for(;cr(s.subarray(c,c+1))!=="\0";)t+=cr(s.subarray(c,c+1)),c+=1;for(t+=cr(s.subarray(c,c+1)),c+=1;cr(s.subarray(c,c+1))!=="\0";)n+=cr(s.subarray(c,c+1)),c+=1;n+=cr(s.subarray(c,c+1)),c+=1,i=gn(s,12),r=gn(s,16),o=gn(s,20),l=gn(s,24),c=28}else if(e===1){c+=4,i=gn(s,c),c+=4;const f=gn(s,c);c+=4;const p=gn(s,c);for(c+=4,a=2**32*f+p,I5(a)||(a=Number.MAX_SAFE_INTEGER,_i.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=gn(s,c),c+=4,l=gn(s,c),c+=4;cr(s.subarray(c,c+1))!=="\0";)t+=cr(s.subarray(c,c+1)),c+=1;for(t+=cr(s.subarray(c,c+1)),c+=1;cr(s.subarray(c,c+1))!=="\0";)n+=cr(s.subarray(c,c+1)),c+=1;n+=cr(s.subarray(c,c+1)),c+=1}const h=s.subarray(c,s.byteLength);return{schemeIdUri:t,value:n,timeScale:i,presentationTime:a,presentationTimeDelta:r,eventDuration:o,id:l,payload:h}}function $5(s,...e){const t=e.length;let n=8,i=t;for(;i--;)n+=e[i].byteLength;const r=new Uint8Array(n);for(r[0]=n>>24&255,r[1]=n>>16&255,r[2]=n>>8&255,r[3]=n&255,r.set(s,4),i=0,n=8;i<t;i++)r.set(e[i],n),n+=e[i].byteLength;return r}function J5(s,e,t){if(s.byteLength!==16)throw new RangeError("Invalid system id");let n,i;n=0,i=new Uint8Array;let r;n>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),$5([112,115,115,104],new Uint8Array([n,0,0,0]),s,r,i,a,t)}const EU=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),BA={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function FR(s,e){const t=BA[e];return!!t&&!!t[s.slice(0,4)]}function iw(s,e,t=!0){return!s.split(",").some(n=>!UR(n,e,t))}function UR(s,e,t=!0){var n;const i=od(t);return(n=i?.isTypeSupported(Iv(s,e)))!=null?n:!1}function Iv(s,e){return`${e}/mp4;codecs=${s}`}function NL(s){if(s){const e=s.substring(0,4);return BA.video[e]}return 2}function hb(s){const e=EU();return s.split(",").reduce((t,n)=>{const r=e&&_T(n)?9:BA.video[n];return r?(r*2+t)/(t?3:2):(BA.audio[n]+t)/(t?2:1)},0)}const A1={};function Z5(s,e=!0){if(A1[s])return A1[s];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[s];for(let i=0;i<t.length;i++){var n;if(UR(t[i],"audio",e))return A1[s]=t[i],t[i];if(t[i]==="mp3"&&(n=od(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return s}const eV=/flac|opus|mp4a\.40\.34/i;function fb(s,e=!0){return s.replace(eV,t=>Z5(t.toLowerCase(),e))}function tV(s,e){const t=[];if(s){const n=s.split(",");for(let i=0;i<n.length;i++)FR(n[i],"video")||t.push(n[i])}return e&&t.push(e),t.join(",")}function US(s,e){if(s&&(s.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(s)!==-1)&&(FL(s,"audio")||FL(s,"video")))return s;if(e){const t=e.split(",");if(t.length>1){if(s){for(let n=t.length;n--;)if(t[n].substring(0,4)===s.substring(0,4))return t[n]}return t[0]}}return e||s}function FL(s,e){return FR(s,e)&&UR(s,e)}function nV(s){const e=s.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function iV(s){if(s.startsWith("av01.")){const e=s.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return s}function UL(s){const e=od(s)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function sw(s){return s.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const sV={supported:!0,powerEfficient:!0,smooth:!0},rV={supported:!1,smooth:!1,powerEfficient:!1},xU={supported:!0,configurations:[],decodingInfoResults:[sV]};function _U(s,e){return{supported:!1,configurations:e,decodingInfoResults:[rV],error:s}}function aV(s,e,t,n,i,r){const a=s.videoCodec,o=s.audioCodec?s.audioGroups:null,l=r?.audioCodec,c=r?.channels,h=c?parseInt(c):l?1/0:2;let f=null;if(o!=null&&o.length)try{o.length===1&&o[0]?f=e.groups[o[0]].channels:f=o.reduce((p,g)=>{if(g){const y=e.groups[g];if(!y)throw new Error(`Audio track group ${g} not found`);Object.keys(y.channels).forEach(x=>{p[x]=(p[x]||0)+y.channels[x]})}return p},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(p=>_T(p))||s.width>1920&&s.height>1088||s.height>1920&&s.width>1088||s.frameRate>Math.max(n,30)||s.videoRange!=="SDR"&&s.videoRange!==t||s.bitrate>Math.max(i,8e6))||!!f&&Ft(h)&&Object.keys(f).some(p=>parseInt(p)>h)}function SU(s,e,t,n={}){const i=s.videoCodec;if(!i&&!s.audioCodec||!t)return Promise.resolve(xU);const r=[],a=oV(s),o=a.length,l=lV(s,e,o>0),c=l.length;for(let h=o||1*c||1;h--;){const f={type:"media-source"};if(o&&(f.video=a[h%o]),c){f.audio=l[h%c];const p=f.audio.bitrate;f.video&&p&&(f.video.bitrate-=p)}r.push(f)}if(i){const h=navigator.userAgent;if(i.split(",").some(f=>_T(f))&&EU())return Promise.resolve(_U(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${h})`),r))}return Promise.all(r.map(h=>{const f=uV(h);return n[f]||(n[f]=t.decodingInfo(h))})).then(h=>({supported:!h.some(f=>!f.supported),configurations:r,decodingInfoResults:h})).catch(h=>({supported:!1,configurations:r,decodingInfoResults:[],error:h}))}function oV(s){var e;const t=(e=s.videoCodec)==null?void 0:e.split(","),n=bU(s),i=s.width||640,r=s.height||480,a=s.frameRate||30,o=s.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:Iv(iV(l),"video"),width:i,height:r,bitrate:n,framerate:a};return o!=="sdr"&&(c.transferFunction=o),c}):[]}function lV(s,e,t){var n;const i=(n=s.audioCodec)==null?void 0:n.split(","),r=bU(s);return i&&s.audioGroups?s.audioGroups.reduce((a,o)=>{var l;const c=o?(l=e.groups[o])==null?void 0:l.tracks:null;return c?c.reduce((h,f)=>{if(f.groupId===o){const p=parseFloat(f.channels||"");i.forEach(g=>{const y={contentType:Iv(g,"audio"),bitrate:t?cV(g,r):r};p&&(y.channels=""+p),h.push(y)})}return h},a):a},[]):[]}function cV(s,e){if(e<=1)return 1;let t=128e3;return s==="ec-3"?t=768e3:s==="ac-3"&&(t=64e4),Math.min(e/2,t)}function bU(s){return Math.ceil(Math.max(s.bitrate*.9,s.averageBitrate)/1e3)*1e3||1}function uV(s){let e="";const{audio:t,video:n}=s;if(n){const i=sw(n.contentType);e+=`${i}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const i=sw(t.contentType);e+=`${n?"_":""}${i}_c${t.channels}`}return e}const rw=["NONE","TYPE-0","TYPE-1",null];function hV(s){return rw.indexOf(s)>-1}const db=["SDR","PQ","HLG"];function fV(s){return!!s&&db.indexOf(s)>-1}var kS={No:"",Yes:"YES",v2:"v2"};function kL(s){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=s,i=n<e/2;return e&&i?t?kS.v2:kS.Yes:kS.No}class GL{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Mv{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return HL(this._audioGroups,e)}hasSubtitleGroup(e){return HL(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function HL(s,e){return!e||!s?!1:s.indexOf(e)!==-1}function dV(){if(typeof matchMedia=="function"){const s=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(s.media!==e.media)return s.matches===!0}return!1}function pV(s,e){let t=!1,n=[];if(s&&(t=s!=="SDR",n=[s]),e){n=e.allowedVideoRanges||db.slice(0);const i=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&dV(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const mV=s=>{const e=new WeakSet;return(t,n)=>{if(s&&(n=s(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},Wi=(s,e)=>JSON.stringify(s,mV(e));function gV(s,e,t,n,i){const r=Object.keys(s),a=n?.channels,o=n?.audioCodec,l=i?.videoCodec,c=a&&parseInt(a)===2;let h=!1,f=!1,p=1/0,g=1/0,y=1/0,x=1/0,E=0,_=[];const{preferHDR:b,allowedVideoRanges:C}=pV(e,i);for(let P=r.length;P--;){const L=s[r[P]];h||(h=L.channels[2]>0),p=Math.min(p,L.minHeight),g=Math.min(g,L.minFramerate),y=Math.min(y,L.minBitrate),C.filter(U=>L.videoRanges[U]>0).length>0&&(f=!0)}p=Ft(p)?p:0,g=Ft(g)?g:0;const I=Math.max(1080,p),M=Math.max(30,g);y=Ft(y)?y:t,t=Math.max(y,t),f||(e=void 0);const R=r.length>1;return{codecSet:r.reduce((P,L)=>{const O=s[L];if(L===P)return P;if(_=f?C.filter(U=>O.videoRanges[U]>0):[],R){if(O.minBitrate>t)return Xc(L,`min bitrate of ${O.minBitrate} > current estimate of ${t}`),P;if(!O.hasDefaultAudio)return Xc(L,"no renditions with default or auto-select sound found"),P;if(o&&L.indexOf(o.substring(0,4))%5!==0)return Xc(L,`audio codec preference "${o}" not found`),P;if(a&&!c){if(!O.channels[a])return Xc(L,`no renditions with ${a} channel sound found (channels options: ${Object.keys(O.channels)})`),P}else if((!o||c)&&h&&O.channels[2]===0)return Xc(L,"no renditions with stereo sound found"),P;if(O.minHeight>I)return Xc(L,`min resolution of ${O.minHeight} > maximum of ${I}`),P;if(O.minFramerate>M)return Xc(L,`min framerate of ${O.minFramerate} > maximum of ${M}`),P;if(!_.some(U=>O.videoRanges[U]>0))return Xc(L,`no variants with VIDEO-RANGE of ${Wi(_)} found`),P;if(l&&L.indexOf(l.substring(0,4))%5!==0)return Xc(L,`video codec preference "${l}" not found`),P;if(O.maxScore<E)return Xc(L,`max score of ${O.maxScore} < selected max of ${E}`),P}return P&&(hb(L)>=hb(P)||O.fragmentError>s[P].fragmentError)?P:(x=O.minIndex,E=O.maxScore,L)},void 0),videoRanges:_,preferHDR:b,minFramerate:g,minBitrate:y,minIndex:x}}function Xc(s,e){_i.log(`[abr] start candidates with "${s}" ignored because ${e}`)}function TU(s){return s.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function AV(s,e,t,n){return s.slice(t,n+1).reduce((i,r,a)=>{if(!r.codecSet)return i;const o=r.audioGroups;let l=i[r.codecSet];l||(i[r.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,r.bitrate);const c=Math.min(r.height,r.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,r.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,r.score),l.fragmentError+=r.fragmentError,l.videoRanges[r.videoRange]=(l.videoRanges[r.videoRange]||0)+1,o&&o.forEach(h=>{if(!h)return;const f=e.groups[h];f&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?f.hasDefault:f.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(f.channels).forEach(p=>{l.channels[p]=(l.channels[p]||0)+f.channels[p]}))}),i},{})}function zL(s){if(!s)return s;const{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:r}=s;return{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:r}}function pu(s,e,t){if("attrs"in s){const n=e.indexOf(s);if(n!==-1)return n}for(let n=0;n<e.length;n++){const i=e[n];if(tm(s,i,t))return n}return-1}function tm(s,e,t){const{groupId:n,name:i,lang:r,assocLang:a,default:o}=s,l=s.forced;return(n===void 0||e.groupId===n)&&(i===void 0||e.name===i)&&(r===void 0||yV(r,e.lang))&&(r===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in s)||vV(s.characteristics||"",e.characteristics))&&(t===void 0||t(s,e))}function yV(s,e="--"){return s.length===e.length?s===e:s.startsWith(e)||e.startsWith(s)}function vV(s,e=""){const t=s.split(","),n=e.split(",");return t.length===n.length&&!t.some(i=>n.indexOf(i)===-1)}function Fp(s,e){const{audioCodec:t,channels:n}=s;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function EV(s,e,t,n,i){const r=e[n],o=e.reduce((p,g,y)=>{const x=g.uri;return(p[x]||(p[x]=[])).push(y),p},{})[r.uri];o.length>1&&(n=Math.max.apply(Math,o));const l=r.videoRange,c=r.frameRate,h=r.codecSet.substring(0,4),f=QL(e,n,p=>{if(p.videoRange!==l||p.frameRate!==c||p.codecSet.substring(0,4)!==h)return!1;const g=p.audioGroups,y=t.filter(x=>!g||g.indexOf(x.groupId)!==-1);return pu(s,y,i)>-1});return f>-1?f:QL(e,n,p=>{const g=p.audioGroups,y=t.filter(x=>!g||g.indexOf(x.groupId)!==-1);return pu(s,y,i)>-1})}function QL(s,e,t){for(let n=e;n>-1;n--)if(t(s[n]))return n;for(let n=e+1;n<s.length;n++)if(t(s[n]))return n;return-1}function pb(s,e){var t;return!!s&&s!==((t=e.loadLevelObj)==null?void 0:t.uri)}class xV extends Sl{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:i,partCurrent:r,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!i||!l)return;const c=performance.now(),h=r?r.stats:i.stats,f=r?r.duration:i.duration,p=c-h.loading.start,g=a.minAutoLevel,y=i.level,x=this._nextAutoLevel;if(h.aborted||h.loaded&&h.loaded===h.total||y<=g){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const E=x>-1&&x!==y,_=!!t||E;if(!_&&(l.paused||!l.playbackRate||!l.readyState))return;const b=a.mainForwardBufferInfo;if(!_&&b===null)return;const C=this.bwEstimator.getEstimateTTFB(),I=Math.abs(l.playbackRate);if(p<=Math.max(C,1e3*(f/(I*2))))return;const M=b?b.len/I:0,R=h.loading.first?h.loading.first-h.loading.start:-1,D=h.loaded&&R>-1,P=this.getBwEstimate(),L=a.levels,O=L[y],U=Math.max(h.loaded,Math.round(f*(i.bitrate||O.averageBitrate)/8));let j=D?p-R:p;j<1&&D&&(j=Math.min(p,h.loaded*8/P));const H=D?h.loaded*1e3/j:0,z=C/1e3,q=H?(U-h.loaded)/H:U*8/P+z;if(q<=M)return;const k=H?H*8:P,W=((n=t?.details||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,V=this.hls.config.abrBandWidthUpFactor;let X=Number.POSITIVE_INFINITY,K;for(K=y-1;K>g;K--){const Ce=L[K].maxBitrate,se=!L[K].details||W;if(X=this.getTimeToLoadFrag(z,k,f*Ce,se),X<Math.min(M,f+z))break}if(X>=q||X>f*10)return;D?this.bwEstimator.sample(p-Math.min(C,R),h.loaded):this.bwEstimator.sampleTTFB(p);const te=L[K].maxBitrate;this.getBwEstimate()*V>te&&this.resetEstimator(te);const oe=this.findBestLevel(te,g,K,0,M,1,1);oe>-1&&(K=oe),this.warn(`Fragment ${i.sn}${r?" part "+r.index:""} of level ${y} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${M.toFixed(3)} s
      Estimated load time for current fragment: ${q.toFixed(3)} s
      Estimated load time for down switch fragment: ${X.toFixed(3)} s
      TTFB estimate: ${R|0} ms
      Current BW estimate: ${Ft(P)?P|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${K} @ ${te|0} bps`),a.nextLoadLevel=a.nextAutoLevel=K,this.clearTimer();const Ee=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===K&&K>0){const Ce=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${K>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${Ce.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,K>g){let se=this.findBestLevel(this.hls.levels[g].bitrate,g,K,0,Ce,1,1);se===-1&&(se=g),this.hls.nextLoadLevel=this.hls.nextAutoLevel=se,this.resetEstimator(this.hls.levels[se].bitrate)}}};E||q>X*2?Ee():this.timer=self.setInterval(Ee,X*1e3),a.trigger(Y.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:r,stats:h})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new w5(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.FRAG_LOADING,this.onFragLoading,this),e.on(Y.FRAG_LOADED,this.onFragLoaded,this),e.on(Y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(Y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.FRAG_LOADING,this.onFragLoading,this),e.off(Y.FRAG_LOADED,this.onFragLoaded,this),e.off(Y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(Y.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var i;this.fragCurrent=n,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case He.BUFFER_ADD_CODEC_ERROR:case He.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case He.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:i,partCurrent:r}=this;if(n&&i&&n.sn===i.sn&&n.level===i.level){const a=performance.now(),o=r?r.stats:n.stats,l=a-o.loading.start,c=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&c>-1){const f=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(f,c),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,n,i){const r=e+n/t,a=i?e+this.lastLevelLoadSec:0;return r+a}onLevelLoaded(e,t){const n=this.hls.config,{loading:i}=t.stats,r=i.end-i.first;Ft(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const i=n?n.stats:t.stats;if(t.type===jt.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=n?n.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+i.loaded,l=(a.loaded?a.loaded.duration:0)+r;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const r={stats:i,frag:t,part:n,id:t.type};this.onFragBuffered(Y.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:i}=t,r=i!=null&&i.stats.loaded?i.stats:n.stats;if(r.aborted||this.ignoreFragment(n))return;const a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==jt.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(n,t,e,0,i,1,1);if(r>-1)return r;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=n&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,r)&&a[e].loadError<=a[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:i,config:r,minAutoLevel:a}=n,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let h=r.abrBandWidthFactor,f=r.abrBandWidthUpFactor;if(c){const E=this.findBestLevel(l,a,i,c,0,h,f);if(E>=0)return this.rebufferNotice=-1,E}let p=o?Math.min(o,r.maxStarvationDelay):r.maxStarvationDelay;if(!c){const E=this.bitrateTestDelay;E&&(p=(o?Math.min(o,r.maxLoadingDelay):r.maxLoadingDelay)-E,this.info(`bitrate test took ${Math.round(1e3*E)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),h=f=1)}const g=this.findBestLevel(l,a,i,c,p,h,f);if(this.rebufferNotice!==g&&(this.rebufferNotice=g,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${g}`)),g>-1)return g;const y=n.levels[a],x=n.loadLevelObj;return x&&y?.bitrate<x.bitrate?a:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,i,r,a,o){var l;const c=i+r,h=this.lastLoadedFragLevel,f=h===-1?this.hls.firstLevel:h,{fragCurrent:p,partCurrent:g}=this,{levels:y,allAudioTracks:x,loadLevel:E,config:_}=this.hls;if(y.length===1)return 0;const b=y[f],C=!!((l=this.hls.latestLevelDetails)!=null&&l.live),I=E===-1||h===-1;let M,R="SDR",D=b?.frameRate||0;const{audioPreference:P,videoPreference:L}=_,O=this.audioTracksByGroup||(this.audioTracksByGroup=TU(x));let U=-1;if(I){if(this.firstSelection!==-1)return this.firstSelection;const k=this.codecTiers||(this.codecTiers=AV(y,O,t,n)),W=gV(k,R,e,P,L),{codecSet:V,videoRanges:X,minFramerate:K,minBitrate:te,minIndex:oe,preferHDR:Ee}=W;U=oe,M=V,R=Ee?X[X.length-1]:X[0],D=K,e=Math.max(e,te),this.log(`picked start tier ${Wi(W)}`)}else M=b?.codecSet,R=b?.videoRange;const j=g?g.duration:p?p.duration:0,H=this.bwEstimator.getEstimateTTFB()/1e3,z=[];for(let k=n;k>=t;k--){var q;const W=y[k],V=k>f;if(!W)continue;if(_.useMediaCapabilities&&!W.supportedResult&&!W.supportedPromise){const se=navigator.mediaCapabilities;typeof se?.decodingInfo=="function"&&aV(W,O,R,D,e,P)?(W.supportedPromise=SU(W,O,se,this.supportedCache),W.supportedPromise.then(ie=>{if(!this.hls)return;W.supportedResult=ie;const ne=this.hls.levels,re=ne.indexOf(W);ie.error?this.warn(`MediaCapabilities decodingInfo error: "${ie.error}" for level ${re} ${Wi(ie)}`):ie.supported?ie.decodingInfoResults.some(Be=>Be.smooth===!1||Be.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${re} not smooth or powerEfficient: ${Wi(ie)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${re} ${Wi(ie)}`),re>-1&&ne.length>1&&(this.log(`Removing unsupported level ${re}`),this.hls.removeLevel(re),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ie=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ie}`)})):W.supportedResult=xU}if((M&&W.codecSet!==M||R&&W.videoRange!==R||V&&D>W.frameRate||!V&&D>0&&D<W.frameRate||(q=W.supportedResult)!=null&&(q=q.decodingInfoResults)!=null&&q.some(se=>se.smooth===!1))&&(!I||k!==U)){z.push(k);continue}const X=W.details,K=(g?X?.partTarget:X?.averagetargetduration)||j;let te;V?te=o*e:te=a*e;const oe=j&&i>=j*2&&r===0?W.averageBitrate:W.maxBitrate,Ee=this.getTimeToLoadFrag(H,te,oe*K,X===void 0);if(te>=oe&&(k===h||W.loadError===0&&W.fragmentError===0)&&(Ee<=H||!Ft(Ee)||C&&!this.bitrateTestDelay||Ee<c)){const se=this.forcedAutoLevel;return k!==E&&(se===-1||se!==E)&&(z.length&&this.trace(`Skipped level(s) ${z.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${y[z[0]].codecs}" ${y[z[0]].videoRange}; not compatible with "${M}" ${R}`),this.info(`switch candidate:${f}->${k} adjustedbw(${Math.round(te)})-bitrate=${Math.round(te-oe)} ttfb:${H.toFixed(1)} avgDuration:${K.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${Ee.toFixed(1)} firstSelection:${I} codecSet:${W.codecSet} videoRange:${W.videoRange} hls.loadLevel:${E}`)),I&&(this.firstSelection=k),k}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const CU={search:function(s,e){let t=0,n=s.length-1,i=null,r=null;for(;t<=n;){i=(t+n)/2|0,r=s[i];const a=e(r);if(a>0)t=i+1;else if(a<0)n=i-1;else return r}return null}};function _V(s,e,t){if(e===null||!Array.isArray(s)||!s.length||!Ft(e))return null;const n=s[0].programDateTime;if(e<(n||0))return null;const i=s[s.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let r=0;r<s.length;++r){const a=s[r];if(bV(e,t,a))return a}return null}function um(s,e,t=0,n=0,i=.005){let r=null;if(s){r=e[1+s.sn-e[0].sn]||null;const o=s.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),r&&s.level!==r.level&&r.end<=s.end&&(r=e[2+s.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!s||s.level===r.level)&&VL(t,n,r)===0||SV(r,s,Math.min(i,n))))return r;const a=CU.search(e,VL.bind(null,t,n));return a&&(a!==s||!r)?a:r}function SV(s,e,t){if(e&&e.start===0&&e.level<s.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((i,r)=>(r[0]==="INF"&&(i+=parseFloat(r[1])),i),t);return s.start<=n}return!1}function VL(s=0,e=0,t){if(t.start<=s&&t.start+t.duration>s)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=s?1:t.start-n>s&&t.start?-1:0}function bV(s,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>s}function IU(s,e,t){if(s&&s.startCC<=e&&s.endCC>=e){let n=s.fragments;const{fragmentHint:i}=s;i&&(n=n.concat(i));let r;return CU.search(n,a=>a.cc<e?1:a.cc>e?-1:(r=a,a.end<=t?1:a.start>t?-1:0)),r||null}return null}function mb(s){switch(s.details){case He.FRAG_LOAD_TIMEOUT:case He.KEY_LOAD_TIMEOUT:case He.LEVEL_LOAD_TIMEOUT:case He.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function jL(s,e){const t=mb(e);return s.default[`${t?"timeout":"error"}Retry`]}function kR(s,e){const t=s.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*s.retryDelayMs,s.maxRetryDelayMs)}function qL(s){return Di(Di({},s),{errorRetry:null,timeoutRetry:null})}function gb(s,e,t,n){if(!s)return!1;const i=n?.code,r=e<s.maxNumRetry&&(TV(i)||!!t);return s.shouldRetry?s.shouldRetry(s,e,t,n,r):r}function TV(s){return aw(s)||!!s&&(s<400||s>499)}function aw(s){return s===0&&navigator.onLine===!1}var Nr={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Mo={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class CV extends Sl{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Y.ERROR,this.onError,this),e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Y.ERROR,this.onError,this),e.off(Y.ERROR,this.onErrorOut,this),e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===jt.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(a=>i.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const i=this.hls,r=t.context;switch(t.details){case He.FRAG_LOAD_ERROR:case He.FRAG_LOAD_TIMEOUT:case He.KEY_LOAD_ERROR:case He.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case He.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=fA();return}case He.FRAG_GAP:case He.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Nr.SendAlternateToPenaltyBox;return}case He.LEVEL_EMPTY_ERROR:case He.LEVEL_PARSING_ERROR:{var a;const l=t.parent===jt.MAIN?t.level:i.loadLevel;t.details===He.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case He.LEVEL_LOAD_ERROR:case He.LEVEL_LOAD_TIMEOUT:typeof r?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case He.AUDIO_TRACK_LOAD_ERROR:case He.AUDIO_TRACK_LOAD_TIMEOUT:case He.SUBTITLE_LOAD_ERROR:case He.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const l=i.loadLevelObj;if(l&&(r.type===Hn.AUDIO_TRACK&&l.hasAudioGroup(r.groupId)||r.type===Hn.SUBTITLE_TRACK&&l.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Nr.SendAlternateToPenaltyBox,t.errorAction.flags=Mo.MoveAllAlternatesMatchingHost;return}}return;case He.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Nr.SendAlternateToPenaltyBox,flags:Mo.MoveAllAlternatesMatchingHDCP};return;case He.KEY_SYSTEM_SESSION_UPDATE_FAILED:case He.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case He.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Nr.SendAlternateToPenaltyBox,flags:Mo.MoveAllAlternatesMatchingKey};return;case He.BUFFER_ADD_CODEC_ERROR:case He.REMUX_ALLOC_ERROR:case He.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:i.loadLevel)}return;case He.INTERNAL_EXCEPTION:case He.BUFFER_APPENDING_ERROR:case He.BUFFER_FULL_ERROR:case He.LEVEL_SWITCH_ERROR:case He.BUFFER_STALLED_ERROR:case He.BUFFER_SEEK_OVER_HOLE:case He.BUFFER_NUDGE_ON_STALL:t.errorAction=fA();return}t.type===Wt.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=fA())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,i=jL(n.config.playlistLoadPolicy,e),r=this.playlistError++;if(gb(i,r,mb(e),e.response))return{action:Nr.RetryRequest,flags:Mo.None,retryConfig:i,retryCount:r};const o=this.getLevelSwitchAction(e,t);return i&&(o.retryConfig=i,o.retryCount=r),o}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:r,keyLoadPolicy:a}=t.config,o=jL(e.details.startsWith("key")?a:r,e),l=t.levels.reduce((h,f)=>h+f.fragmentError,0);if(i&&(e.details!==He.FRAG_GAP&&i.fragmentError++,gb(o,l,mb(e),e.response)))return{action:Nr.RetryRequest,flags:Mo.None,retryConfig:o,retryCount:l};const c=this.getLevelSwitchAction(e,n);return o&&(c.retryConfig=o,c.retryCount=l),c}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const i=this.hls.levels[t];if(i){var r,a;const c=e.details;i.loadError++,c===He.BUFFER_APPEND_ERROR&&i.fragmentError++;let h=-1;const{levels:f,loadLevel:p,minAutoLevel:g,maxAutoLevel:y}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const x=(r=e.frag)==null?void 0:r.type,_=(x===jt.AUDIO&&c===He.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===He.BUFFER_ADD_CODEC_ERROR||c===He.BUFFER_APPEND_ERROR))&&f.some(({audioCodec:R})=>i.audioCodec!==R),C=e.sourceBufferName==="video"&&(c===He.BUFFER_ADD_CODEC_ERROR||c===He.BUFFER_APPEND_ERROR)&&f.some(({codecSet:R,audioCodec:D})=>i.codecSet!==R&&i.audioCodec===D),{type:I,groupId:M}=(a=e.context)!=null?a:{};for(let R=f.length;R--;){const D=(R+p)%f.length;if(D!==p&&D>=g&&D<=y&&f[D].loadError===0){var o,l;const P=f[D];if(c===He.FRAG_GAP&&x===jt.MAIN&&e.frag){const L=f[D].details;if(L){const O=um(e.frag,L.fragments,e.frag.start);if(O!=null&&O.gap)continue}}else{if(I===Hn.AUDIO_TRACK&&P.hasAudioGroup(M)||I===Hn.SUBTITLE_TRACK&&P.hasSubtitleGroup(M))continue;if(x===jt.AUDIO&&(o=i.audioGroups)!=null&&o.some(L=>P.hasAudioGroup(L))||x===jt.SUBTITLE&&(l=i.subtitleGroups)!=null&&l.some(L=>P.hasSubtitleGroup(L))||_&&i.audioCodec===P.audioCodec||C&&i.codecSet===P.codecSet||!_&&i.codecSet!==P.codecSet)continue}h=D;break}}if(h>-1&&n.loadLevel!==h)return e.levelRetry=!0,this.playlistError=0,{action:Nr.SendAlternateToPenaltyBox,flags:Mo.None,nextAutoLevel:h}}return{action:Nr.SendAlternateToPenaltyBox,flags:Mo.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Nr.DoNothing:break;case Nr.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==He.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:i}=n,r=n.nextAutoLevel;switch(i){case Mo.None:this.switchLevel(e,r);break;case Mo.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),c=t.levels[l],h=c?.attrs["HDCP-LEVEL"];if(n.hdcpLevel=h,h){t.maxHdcpLevel=rw[rw.indexOf(h)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Mo.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const c=this.hls.levels;for(let h=c.length;h--;)if(this.variantHasKey(c[h],l)){var a,o;this.log(`Banned key found in level ${h} (${c[h].bitrate}bps) or audio group "${(a=c[h].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${wo(l.keyId||[])}`),c[h].fragmentError++,c[h].loadError++,this.log(`Removing level ${h} with key error (${e.error})`),this.hls.removeLevel(h)}c.length&&(n.resolved=!0)}break}}n.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===He.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=sw(e.mimeType),i=this.hls.levels;for(let r=i.length;r--;)i[r][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${r} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(r))}}}function fA(s){const e={action:Nr.DoNothing,flags:Mo.None};return s&&(e.resolved=!0),e}var ur={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class IV{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Y.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Y.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let i=n.length;i--;){const r=n[i];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:i}=this,r=Object.keys(i);for(let a=r.length;a--;){const o=i[r[a]];if(o?.body.type===t&&(!n||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,n,i,r){this.timeRanges&&(this.timeRanges[e]=t);const a=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||r)){l.body.type===n&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(h=>{const f=!this.isTimeBuffered(h.startPTS,h.endPTS,t);return f&&this.removeFragment(l.body),f})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,i=Tg(n),r=this.fragments[i];if(!r||r.buffered&&n.gap)return;const a=!n.relurl;Object.keys(t).forEach(o=>{const l=n.elementaryStreams[o];if(!l)return;const c=t[o],h=a||l.partial===!0;r.range[o]=this.getBufferedTimes(n,e.part,h,c)}),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,(r.body.endList=n.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),m_(r)||this.removeParts(n.sn-1,n.type)):this.removeFragment(r.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=KL(n,i=>i.fragment.sn>=e))}fragBuffered(e,t){const n=Tg(e);let i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,n,i){const r={time:[],partial:n},a=e.start,o=e.end,l=e.minEndPTS||o,c=e.maxStartPTS||a;for(let h=0;h<i.length;h++){const f=i.start(h)-this.bufferPadding,p=i.end(h)+this.bufferPadding;if(c>=f&&l<=p){r.time.push({startPTS:Math.max(a,i.start(h)),endPTS:Math.min(o,i.end(h))});break}else if(a<p&&o>f){const g=Math.max(a,i.start(h)),y=Math.min(o,i.end(h));y>g&&(r.partial=!0,r.time.push({startPTS:g,endPTS:y}))}else if(o<=f)break}return r}getPartialFragment(e){let t=null,n,i,r,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(c=>{const h=l[c];h&&m_(h)&&(i=h.body.start-o,r=h.body.end+o,e>=i&&e<=r&&(n=Math.min(e-i,r-e),a<=n&&(t=h.body,a=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||m_(t))}getState(e){const t=Tg(e),n=this.fragments[t];return n?n.buffered?m_(n)?ur.PARTIAL:ur.OK:ur.APPENDING:ur.NOT_LOADED}isTimeBuffered(e,t,n){let i,r;for(let a=0;a<n.length;a++){if(i=n.start(a)-this.bufferPadding,r=n.end(a)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,i=t.part?null:t,r=Tg(n);this.fragments[r]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:i,timeRanges:r,type:a}=t;if(n.sn==="initSegment")return;const o=n.type;if(i){let c=this.activePartLists[o];c||(this.activePartLists[o]=c=[]),c.push(i)}this.timeRanges=r;const l=r[a];this.detectEvictedFragments(a,l,o,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Tg(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let i=n.length;i--;){const r=t[n[i]];if(r?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==n||i&&!l.gap||l.start<t&&l.end>e&&(o.buffered||r)&&this.removeFragment(l)})}removeFragment(e){const t=Tg(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const i=e.sn;this.activePartLists[e.type]=KL(n,r=>r.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function m_(s){var e,t,n;return s.buffered&&!!(s.body.gap||(e=s.range.video)!=null&&e.partial||(t=s.range.audio)!=null&&t.partial||(n=s.range.audiovideo)!=null&&n.partial)}function Tg(s){return`${s.type}_${s.level}_${s.sn}`}function KL(s,e){return s.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var ld={cbc:0,ctr:1};class MV{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case ld.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ld.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function wV(s){const e=s.byteLength,t=e&&new DataView(s.buffer).getUint8(e-1);return t?s.slice(0,e-t):s}class RV{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=t.getUint32(i*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],r=n[1],a=n[2],o=n[3],l=this.invSubMix,c=l[0],h=l[1],f=l[2],p=l[3],g=new Uint32Array(256);let y=0,x=0,E=0;for(E=0;E<256;E++)E<128?g[E]=E<<1:g[E]=E<<1^283;for(E=0;E<256;E++){let _=x^x<<1^x<<2^x<<3^x<<4;_=_>>>8^_&255^99,e[y]=_,t[_]=y;const b=g[y],C=g[b],I=g[C];let M=g[_]*257^_*16843008;i[y]=M<<24|M>>>8,r[y]=M<<16|M>>>16,a[y]=M<<8|M>>>24,o[y]=M,M=I*16843009^C*65537^b*257^y*16843008,c[_]=M<<24|M>>>8,h[_]=M<<16|M>>>16,f[_]=M<<8|M>>>24,p[_]=M,y?(y=b^g[g[g[I^b]]],x^=g[g[x]]):y=x=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;for(;i<t.length&&n;)n=t[i]===this.key[i],i++;if(n)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const a=this.ksRows=(r+6+1)*4;let o,l;const c=this.keySchedule=new Uint32Array(a),h=this.invKeySchedule=new Uint32Array(a),f=this.sBox,p=this.rcon,g=this.invSubMix,y=g[0],x=g[1],E=g[2],_=g[3];let b,C;for(o=0;o<a;o++){if(o<r){b=c[o]=t[o];continue}C=b,o%r===0?(C=C<<8|C>>>24,C=f[C>>>24]<<24|f[C>>>16&255]<<16|f[C>>>8&255]<<8|f[C&255],C^=p[o/r|0]<<24):r>6&&o%r===4&&(C=f[C>>>24]<<24|f[C>>>16&255]<<16|f[C>>>8&255]<<8|f[C&255]),c[o]=b=(c[o-r]^C)>>>0}for(l=0;l<a;l++)o=a-l,l&3?C=c[o]:C=c[o-4],l<4||o<=4?h[l]=C:h[l]=y[f[C>>>24]]^x[f[C>>>16&255]]^E[f[C>>>8&255]]^_[f[C&255]],h[l]=h[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const i=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],c=o[1],h=o[2],f=o[3],p=this.uint8ArrayToUint32Array_(n);let g=p[0],y=p[1],x=p[2],E=p[3];const _=new Int32Array(e),b=new Int32Array(_.length);let C,I,M,R,D,P,L,O,U,j,H,z,q,k;const W=this.networkToHostOrderSwap;for(;t<_.length;){for(U=W(_[t]),j=W(_[t+1]),H=W(_[t+2]),z=W(_[t+3]),D=U^r[0],P=z^r[1],L=H^r[2],O=j^r[3],q=4,k=1;k<i;k++)C=l[D>>>24]^c[P>>16&255]^h[L>>8&255]^f[O&255]^r[q],I=l[P>>>24]^c[L>>16&255]^h[O>>8&255]^f[D&255]^r[q+1],M=l[L>>>24]^c[O>>16&255]^h[D>>8&255]^f[P&255]^r[q+2],R=l[O>>>24]^c[D>>16&255]^h[P>>8&255]^f[L&255]^r[q+3],D=C,P=I,L=M,O=R,q=q+4;C=a[D>>>24]<<24^a[P>>16&255]<<16^a[L>>8&255]<<8^a[O&255]^r[q],I=a[P>>>24]<<24^a[L>>16&255]<<16^a[O>>8&255]<<8^a[D&255]^r[q+1],M=a[L>>>24]<<24^a[O>>16&255]<<16^a[D>>8&255]<<8^a[P&255]^r[q+2],R=a[O>>>24]<<24^a[D>>16&255]<<16^a[P>>8&255]<<8^a[L&255]^r[q+3],b[t]=W(C^g),b[t+1]=W(R^y),b[t+2]=W(M^x),b[t+3]=W(I^E),g=U,y=j,x=H,E=z,t=t+4}return b.buffer}}class BV{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=DV(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function DV(s){switch(s){case ld.cbc:return"AES-CBC";case ld.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${s}`)}}const LV=16;class GR{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?wV(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,i){return this.useSoftware?new Promise((r,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,n,i);const l=this.flush();l?r(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,i)}softwareDecrypt(e,t,n,i){const{currentIV:r,currentResult:a,remainderData:o}=this;if(i!==ld.cbc||t.byteLength!==16)return _i.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=xl(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;r&&(n=r);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new RV),c.expandKey(t);const h=a;return this.currentResult=c.decrypt(l.buffer,0,n),this.currentIV=l.slice(-16).buffer,h||null}webCryptoDecrypt(e,t,n,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,i));this.key=t,this.fastAesKey=new BV(this.subtle,t,i)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new MV(this.subtle,new Uint8Array(n),i).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(_i.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,n,i)))}onWebCryptoError(e,t,n,i){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,i);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%LV;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(_i.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const YL=Math.pow(2,17);class OV{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new gh({type:Wt.NETWORK_ERROR,details:He.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(y=>y[0]==="GAP")){l(WL(e));return}else e.gap=!1;const c=this.loader=r?new r(i):new a(i),h=XL(e);e.loader=c;const f=qL(i.fragLoadPolicy.default),p={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:YL};e.stats=c.stats;const g={onSuccess:(y,x,E,_)=>{this.resetLoader(e,c);let b=y.data;E.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(b.slice(0,16)),b=b.slice(16)),o({frag:e,part:null,payload:b,networkDetails:_})},onError:(y,x,E,_)=>{this.resetLoader(e,c),l(new gh({type:Wt.NETWORK_ERROR,details:He.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Di({url:n,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:E,stats:_}))},onAbort:(y,x,E)=>{this.resetLoader(e,c),l(new gh({type:Wt.NETWORK_ERROR,details:He.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:E,stats:y}))},onTimeout:(y,x,E)=>{this.resetLoader(e,c),l(new gh({type:Wt.NETWORK_ERROR,details:He.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:E,stats:y}))}};t&&(g.onProgress=(y,x,E,_)=>t({frag:e,part:null,payload:E,networkDetails:_})),c.load(h,p,g)})}loadPart(e,t,n){this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(WL(e,t));return}const c=this.loader=r?new r(i):new a(i),h=XL(e,t);e.loader=c;const f=qL(i.fragLoadPolicy.default),p={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:YL};t.stats=c.stats,c.load(h,p,{onSuccess:(g,y,x,E)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const _={frag:e,part:t,payload:g.data,networkDetails:E};n(_),o(_)},onError:(g,y,x,E)=>{this.resetLoader(e,c),l(new gh({type:Wt.NETWORK_ERROR,details:He.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Di({url:h.url,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:x,stats:E}))},onAbort:(g,y,x)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new gh({type:Wt.NETWORK_ERROR,details:He.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:x,stats:g}))},onTimeout:(g,y,x)=>{this.resetLoader(e,c),l(new gh({type:Wt.NETWORK_ERROR,details:He.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:x,stats:g}))}})})}updateStatsFromPart(e,t){const n=e.stats,i=t.stats,r=i.total;if(n.loaded+=i.loaded,r){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/r),l),f=(l-c)*Math.round(n.loaded/c);n.total=n.loaded+f}else n.total=Math.max(n.loaded,n.total);const a=n.loading,o=i.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function XL(s,e=null){const t=e||s,n={frag:s,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(Ft(i)&&Ft(r)){var a;let o=i,l=r;if(s.sn==="initSegment"&&PV((a=s.decryptdata)==null?void 0:a.method)){const c=r-i;c%16&&(l=r+(16-c%16)),i!==0&&(n.resetIV=!0,o=i-16)}n.rangeStart=o,n.rangeEnd=l}return n}function WL(s,e){const t=new Error(`GAP ${s.gap?"tag":"attribute"} found`),n={type:Wt.MEDIA_ERROR,details:He.FRAG_GAP,fatal:!1,frag:s,error:t,networkDetails:null};return e&&(n.part=e),(e||s).stats.aborted=!0,new gh(n)}function PV(s){return s==="AES-128"||s==="AES-256"}class gh extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class MU extends Sl{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class HR{constructor(e,t,n,i=0,r=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=g_(),this.buffering={audio:g_(),video:g_(),audiovideo:g_()},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=r,this.partial=a}}function g_(){return{start:0,executeStart:0,executeEnd:0,end:0}}const $L={length:0,start:()=>0,end:()=>0};class xn{static isBuffered(e,t){if(e){const n=xn.getBuffered(e);for(let i=n.length;i--;)if(t>=n.start(i)&&t<=n.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=xn.getBuffered(e);return xn.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const i=xn.bufferedRanges(e);if(i.length)return xn.bufferedInfo(i,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((h,f)=>h.start-f.start||f.end-h.end);let i=-1,r=[];if(n)for(let h=0;h<e.length;h++){t>=e[h].start&&t<=e[h].end&&(i=h);const f=r.length;if(f){const p=r[f-1].end;e[h].start-p<n?e[h].end>p&&(r[f-1].end=e[h].end):r.push(e[h])}else r.push(e[h])}else r=e;let a=0,o,l=t,c=t;for(let h=0;h<r.length;h++){const f=r[h].start,p=r[h].end;if(i===-1&&t>=f&&t<=p&&(i=h),t+n>=f&&t<p)l=f,c=p,a=c-t;else if(t+n<f){o=f;break}}return{len:a,start:l||0,end:c||0,nextStart:o,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||$L}catch(t){return _i.log("failed to get media.buffered",t),$L}}}const wU=/\{\$([a-zA-Z0-9-_]+)\}/g;function JL(s){return wU.test(s)}function ow(s,e){if(s.variableList!==null||s.hasVariableRefs){const t=s.variableList;return e.replace(wU,n=>{const i=n.substring(2,n.length-1),r=t?.[i];return r===void 0?(s.playlistParsingError||(s.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),n):r})}return e}function ZL(s,e,t){let n=s.variableList;n||(s.variableList=n={});let i,r;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(i))r=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,r=e.VALUE;i in n?s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=r||""}function NV(s,e,t){const n=e.IMPORT;if(t&&n in t){let i=s.variableList;i||(s.variableList=i={}),i[n]=t[n]}else s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const FV=/^(\d+)x(\d+)$/,e2=/(.+?)=(".*?"|.*?)(?:,|$)/g;class hs{constructor(e,t){typeof e=="string"&&(e=hs.parseAttrList(e,t)),Li(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)n[i]=parseInt(t.slice(i*2,i*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((i,r)=>(i[r.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=FV.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const i={};for(e2.lastIndex=0;(n=e2.exec(e))!==null;){const a=n[1].trim();let o=n[2];const l=o.indexOf('"')===0&&o.lastIndexOf('"')===o.length-1;let c=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))o=ow(t,o);else if(!c&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":_i.warn(`${e}: attribute ${a} is missing quotes`)}i[a]=o}return i}}const UV="com.apple.hls.interstitial";function kV(s){return s!=="ID"&&s!=="CLASS"&&s!=="CUE"&&s!=="START-DATE"&&s!=="DURATION"&&s!=="END-DATE"&&s!=="END-ON-NEXT"}function GV(s){return s==="SCTE35-OUT"||s==="SCTE35-IN"||s==="SCTE35-CMD"}class RU{constructor(e,t,n=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(i=t?.tagOrder)!=null?i:n,t){const r=t.attr;for(const a in r)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==r[a]){_i.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=Li(new hs({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=t?.endDate||new Date(this.attr["END-DATE"]);Ft(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(_i.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ft(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===UV}get isValid(){return!!this.id&&!this._badValueForSameId&&Ft(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const HV=10;class zV{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?Ft(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||HV}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function BU(s,e){return s.length===e.length?!s.some((t,n)=>t!==e[n]):!1}function t2(s,e){return!s&&!e?!0:!s||!e?!1:BU(s,e)}function dA(s){return s==="AES-128"||s==="AES-256"||s==="AES-256-CTR"}function zR(s){switch(s){case"AES-128":case"AES-256":return ld.cbc;case"AES-256-CTR":return ld.ctr;default:throw new Error(`invalid full segment method ${s}`)}}function QR(s){return Uint8Array.from(atob(s),e=>e.charCodeAt(0))}function lw(s){return Uint8Array.from(unescape(encodeURIComponent(s)),e=>e.charCodeAt(0))}function QV(s){const e=lw(s).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function VV(s){const e=function(n,i,r){const a=n[i];n[i]=n[r],n[r]=a};e(s,0,3),e(s,1,2),e(s,4,5),e(s,6,7)}function jV(s){const e=s.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),i=n[n.length-1].split(",");if(i.length===2){const r=i[0]==="base64",a=i[1];r?(n.splice(-1,1),t=QR(a)):t=QV(a)}}return t}const Ab=typeof self<"u"?self:void 0;var Ss={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Za={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function GS(s){switch(s){case Za.FAIRPLAY:return Ss.FAIRPLAY;case Za.PLAYREADY:return Ss.PLAYREADY;case Za.WIDEVINE:return Ss.WIDEVINE;case Za.CLEARKEY:return Ss.CLEARKEY}}function y1(s){switch(s){case Ss.FAIRPLAY:return Za.FAIRPLAY;case Ss.PLAYREADY:return Za.PLAYREADY;case Ss.WIDEVINE:return Za.WIDEVINE;case Ss.CLEARKEY:return Za.CLEARKEY}}function nv(s){const{drmSystems:e,widevineLicenseUrl:t}=s,n=e?[Ss.FAIRPLAY,Ss.WIDEVINE,Ss.PLAYREADY,Ss.CLEARKEY].filter(i=>!!e[i]):[];return!n[Ss.WIDEVINE]&&t&&n.push(Ss.WIDEVINE),n}const DU=(function(s){return Ab!=null&&(s=Ab.navigator)!=null&&s.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function qV(s,e,t,n){let i;switch(s){case Ss.FAIRPLAY:i=["cenc","sinf"];break;case Ss.WIDEVINE:case Ss.PLAYREADY:i=["cenc"];break;case Ss.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${s}`)}return KV(i,e,t,n)}function KV(s,e,t,n){return[{initDataTypes:s,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function YV(s){var e;return!!s&&(s.sessionType==="persistent-license"||!!((e=s.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function XV(s){const e=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=QR(o).subarray(0,16);return VV(l),l}}return null}let A_={};class ST{static clearKeyUriToKeyIdMap(){A_={}}constructor(e,t,n,i=[1],r=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!dA(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(hU(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&BU(e.keyFormatVersions,this.keyFormatVersions)&&t2(e.iv,this.iv)&&t2(e.keyId,this.keyId)}isSupported(){if(this.method){if(dA(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Za.FAIRPLAY:case Za.WIDEVINE:case Za.PLAYREADY:case Za.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(dA(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(_i.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const n=WV(e);return new ST(this.method,this.uri,"identity",this.keyFormatVersions,n)}if(this.pssh&&this.keyId)return this;const t=jV(this.uri);if(t)switch(this.keyFormat){case Za.WIDEVINE:if(this.pssh=t,!this.keyId&&t.length>=22){const n=t.length-22;this.keyId=t.subarray(n,n+16)}break;case Za.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=J5(n,null,t),this.keyId=XV(t);break}default:{let n=t.subarray(0,16);if(n.length!==16){const i=new Uint8Array(16);i.set(n,16-n.length),n=i}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n=A_[this.uri];if(!n){const i=Object.keys(A_).length%Number.MAX_SAFE_INTEGER;n=new Uint8Array(16),new DataView(n.buffer,12,4).setUint32(0,i),A_[this.uri]=n}this.keyId=n}return this}}function WV(s){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=s>>8*(15-t)&255;return e}const n2=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,i2=/#EXT-X-MEDIA:(.*)/g,$V=/^#EXT(?:INF|-X-TARGETDURATION):/m,v1=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),JV=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class mu{static findGroup(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===t)return i}}static resolve(e,t){return OR.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return $V.test(e)}static parseMasterPlaylist(e,t){const n=JL(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},r=[];n2.lastIndex=0;let a;for(;(a=n2.exec(e))!=null;)if(a[1]){var o;const c=new hs(a[1],i),h=ow(i,a[2]),f={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:mu.resolve(h,t)},p=c.decimalResolution("RESOLUTION");p&&(f.width=p.width,f.height=p.height),a2(c.CODECS,f);const g=c["SUPPLEMENTAL-CODECS"];g&&(f.supplemental={},a2(g,f.supplemental)),(o=f.unknownCodecs)!=null&&o.length||r.push(f),i.levels.push(f)}else if(a[3]){const c=a[3],h=a[4];switch(c){case"SESSION-DATA":{const f=new hs(h,i),p=f["DATA-ID"];p&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[p]=f);break}case"SESSION-KEY":{const f=s2(h,t,i);f.encrypted&&f.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(f)):_i.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const f=new hs(h,i);ZL(i,f,t)}break}case"CONTENT-STEERING":{const f=new hs(h,i);i.contentSteering={uri:mu.resolve(f["SERVER-URI"],t),pathwayId:f["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=r2(h);break}}}const l=r.length>0&&r.length<i.levels.length;return i.levels=l?r:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,n){let i;const r={},a=n.levels,o={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(i2.lastIndex=0;(i=i2.exec(e))!==null;){const c=new hs(i[1],n),h=c.TYPE;if(h){const f=o[h],p=r[h]||[];r[h]=p;const g=c.LANGUAGE,y=c["ASSOC-LANGUAGE"],x=c.CHANNELS,E=c.CHARACTERISTICS,_=c["INSTREAM-ID"],b={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||g||"",type:h,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:g,url:c.URI?mu.resolve(c.URI,t):""};if(y&&(b.assocLang=y),x&&(b.channels=x),E&&(b.characteristics=E),_&&(b.instreamId=_),f!=null&&f.length){const C=mu.findGroup(f,b.groupId)||f[0];o2(b,C,"audioCodec"),o2(b,C,"textCodec")}p.push(b)}}return r}static parseLevelPlaylist(e,t,n,i,r,a){var o;const l={url:t},c=new zV(t),h=c.fragments,f=[];let p=null,g=0,y=0,x=0,E=0,_=0,b=null,C=new m1(i,l),I,M,R,D=-1,P=!1,L=null,O;if(v1.lastIndex=0,c.m3u8=e,c.hasVariableRefs=JL(e),((o=v1.exec(e))==null?void 0:o[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(I=v1.exec(e))!==null;){P&&(P=!1,C=new m1(i,l),C.playlistOffset=x,C.setStart(x),C.sn=g,C.cc=E,_&&(C.bitrate=_),C.level=n,p&&(C.initSegment=p,p.rawProgramDateTime&&(C.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),L&&(C.setByteRange(L),L=null)));const z=I[1];if(z){C.duration=parseFloat(z);const q=(" "+I[2]).slice(1);C.title=q||null,C.tagList.push(q?["INF",z,q]:["INF",z])}else if(I[3]){if(Ft(C.duration)){C.playlistOffset=x,C.setStart(x),R&&c2(C,R,c),C.sn=g,C.level=n,C.cc=E,h.push(C);const q=(" "+I[3]).slice(1);C.relurl=ow(c,q),cw(C,b,f),b=C,x+=C.duration,g++,y=0,P=!0}}else{if(I=I[0].match(JV),!I){_i.warn("No matches on slow regex match for level playlist!");continue}for(M=1;M<I.length&&I[M]===void 0;M++);const q=(" "+I[M]).slice(1),k=(" "+I[M+1]).slice(1),W=I[M+2]?(" "+I[M+2]).slice(1):null;switch(q){case"BYTERANGE":b?C.setByteRange(k,b):C.setByteRange(k);break;case"PROGRAM-DATE-TIME":C.rawProgramDateTime=k,C.tagList.push(["PROGRAM-DATE-TIME",k]),D===-1&&(D=h.length);break;case"PLAYLIST-TYPE":c.type&&nh(c,q,I),c.type=k.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?nh(c,q,I):h.length>0&&u2(c,q,I),g=c.startSN=parseInt(k);break;case"SKIP":{c.skippedSegments&&nh(c,q,I);const V=new hs(k,c),X=V.decimalInteger("SKIPPED-SEGMENTS");if(Ft(X)){c.skippedSegments+=X;for(let te=X;te--;)h.push(null);g+=X}const K=V.enumeratedString("RECENTLY-REMOVED-DATERANGES");K&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(K.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&nh(c,q,I),c.targetduration=Math.max(parseInt(k),1);break;case"VERSION":c.version!==null&&nh(c,q,I),c.version=parseInt(k);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||nh(c,q,I),c.live=!1;break;case"#":(k||W)&&C.tagList.push(W?[k,W]:[k]);break;case"DISCONTINUITY":E++,C.tagList.push(["DIS"]);break;case"GAP":C.gap=!0,C.tagList.push([q]);break;case"BITRATE":C.tagList.push([q,k]),_=parseInt(k)*1e3,Ft(_)?C.bitrate=_:_=0;break;case"DATERANGE":{const V=new hs(k,c),X=new RU(V,c.dateRanges[V.ID],c.dateRangeTagCount);c.dateRangeTagCount++,X.isValid||c.skippedSegments?c.dateRanges[X.id]=X:_i.warn(`Ignoring invalid DATERANGE tag: "${k}"`),C.tagList.push(["EXT-X-DATERANGE",k]);break}case"DEFINE":{{const V=new hs(k,c);"IMPORT"in V?NV(c,V,a):ZL(c,V,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?nh(c,q,I):h.length>0&&u2(c,q,I),c.startCC=E=parseInt(k);break;case"KEY":{const V=s2(k,t,c);if(V.isSupported()){if(V.method==="NONE"){R=void 0;break}R||(R={});const X=R[V.keyFormat];X!=null&&X.matches(V)||(X&&(R=Li({},R)),R[V.keyFormat]=V)}else _i.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${k}"`);break}case"START":c.startTimeOffset=r2(k);break;case"MAP":{const V=new hs(k,c);if(C.duration){const X=new m1(i,l);l2(X,V,n,R),p=X,C.initSegment=p,p.rawProgramDateTime&&!C.rawProgramDateTime&&(C.rawProgramDateTime=p.rawProgramDateTime)}else{const X=C.byteRangeEndOffset;if(X){const K=C.byteRangeStartOffset;L=`${X-K}@${K}`}else L=null;l2(C,V,n,R),p=C,P=!0}p.cc=E;break}case"SERVER-CONTROL":{O&&nh(c,q,I),O=new hs(k),c.canBlockReload=O.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=O.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&O.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=O.optionalFloat("PART-HOLD-BACK",0),c.holdBack=O.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&nh(c,q,I);const V=new hs(k);c.partTarget=V.decimalFloatingPoint("PART-TARGET");break}case"PART":{let V=c.partList;V||(V=c.partList=[]);const X=y>0?V[V.length-1]:void 0,K=y++,te=new hs(k,c),oe=new k5(te,C,l,K,X);V.push(oe),C.duration+=oe.duration;break}case"PRELOAD-HINT":{const V=new hs(k,c);c.preloadHint=V;break}case"RENDITION-REPORT":{const V=new hs(k,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(V);break}default:_i.warn(`line parsed but not handled: ${I}`);break}}}b&&!b.relurl?(h.pop(),x-=b.duration,c.partList&&(c.fragmentHint=b)):c.partList&&(cw(C,b,f),C.cc=E,c.fragmentHint=C,R&&c2(C,R,c)),c.targetduration||(c.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const U=h.length,j=h[0],H=h[U-1];if(x+=c.skippedSegments*c.targetduration,x>0&&U&&H){c.averagetargetduration=x/U;const z=H.sn;c.endSN=z!=="initSegment"?z:0,c.live||(H.endList=!0),D>0&&(e6(h,D),j&&f.unshift(j))}return c.fragmentHint&&(x+=c.fragmentHint.duration),c.totalduration=x,f.length&&c.dateRangeTagCount&&j&&LU(f,c),c.endCC=E,c}}function LU(s,e){let t=s.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];s.push(o),t++}else return;const n=s[t-1],i=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let o=r.length;o--;){const l=e.dateRanges[r[o]],c=l.startDate.getTime();l.tagAnchor=n.ref;for(let h=t;h--;){var a;if(((a=s[h])==null?void 0:a.sn)<e.startSN)break;const f=ZV(e,c,s,h,i);if(f!==-1){l.tagAnchor=e.fragments[f].ref;break}}}}function ZV(s,e,t,n,i){const r=t[n];if(r){const o=r.programDateTime;if(e>=o||n===0){var a;const l=(((a=t[n+1])==null?void 0:a.start)||i)-r.start;if(e<=o+l*1e3){const c=t[n].sn-s.startSN;if(c<0)return-1;const h=s.fragments;if(h.length>t.length){const p=(t[n+1]||h[h.length-1]).sn-s.startSN;for(let g=p;g>c;g--){const y=h[g].programDateTime;if(e>=y&&e<y+h[g].duration*1e3)return g}}return c}}}return-1}function s2(s,e,t){var n,i;const r=new hs(s,t),a=(n=r.METHOD)!=null?n:"",o=r.URI,l=r.hexadecimalInteger("IV"),c=r.KEYFORMATVERSIONS,h=(i=r.KEYFORMAT)!=null?i:"identity";o&&r.IV&&!l&&_i.error(`Invalid IV: ${r.IV}`);const f=o?mu.resolve(o,e):"",p=(c||"1").split("/").map(Number).filter(Number.isFinite);return new ST(a,f,h,p,l,r.KEYID)}function r2(s){const t=new hs(s).decimalFloatingPoint("TIME-OFFSET");return Ft(t)?t:null}function a2(s,e){let t=(s||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const i=t.filter(r=>FR(r,n));i.length&&(e[`${n}Codec`]=i.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>i.indexOf(r)===-1))}),e.unknownCodecs=t}function o2(s,e,t){const n=e[t];n&&(s[t]=n)}function e6(s,e){let t=s[e];for(let n=e;n--;){const i=s[n];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function cw(s,e,t){s.rawProgramDateTime?t.push(s):e!=null&&e.programDateTime&&(s.programDateTime=e.endProgramDateTime)}function l2(s,e,t,n){s.relurl=e.URI,e.BYTERANGE&&s.setByteRange(e.BYTERANGE),s.level=t,s.sn="initSegment",n&&(s.levelkeys=n),s.initSegment=null}function c2(s,e,t){s.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&n.push(s)}function nh(s,e,t){s.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function u2(s,e,t){s.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function E1(s,e){const t=e.startPTS;if(Ft(t)){let n=0,i;e.sn>s.sn?(n=t-s.start,i=s):(n=s.start-t,i=e),i.duration!==n&&i.setDuration(n)}else e.sn>s.sn?s.cc===e.cc&&s.minEndPTS?e.setStart(s.start+(s.minEndPTS-s.start)):e.setStart(s.start+s.duration):e.setStart(Math.max(s.start-e.duration,0))}function OU(s,e,t,n,i,r,a){n-t<=0&&(a.warn("Fragment should have a positive duration",e),n=t+e.duration,r=i+e.duration);let l=t,c=n;const h=e.startPTS,f=e.endPTS;if(Ft(h)){const _=Math.abs(h-t);s&&_>s.totalduration?a.warn(`media timestamps and playlist times differ by ${_}s for level ${e.level} ${s.url}`):Ft(e.deltaPTS)?e.deltaPTS=Math.max(_,e.deltaPTS):e.deltaPTS=_,l=Math.max(t,h),t=Math.min(t,h),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,c=Math.min(n,f),n=Math.max(n,f),r=e.endDTS!==void 0?Math.max(r,e.endDTS):r}const p=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=i,e.endPTS=n,e.minEndPTS=c,e.endDTS=r;const g=e.sn;if(!s||g<s.startSN||g>s.endSN)return 0;let y;const x=g-s.startSN,E=s.fragments;for(E[x]=e,y=x;y>0;y--)E1(E[y],E[y-1]);for(y=x;y<E.length-1;y++)E1(E[y],E[y+1]);return s.fragmentHint&&E1(E[E.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,p}function t6(s,e,t){if(s===e)return;let n=null;const i=s.fragments;for(let h=i.length-1;h>=0;h--){const f=i[h].initSegment;if(f){n=f;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;let r;s6(s,e,(h,f,p,g)=>{if((!e.startCC||e.skippedSegments)&&f.cc!==h.cc){const y=h.cc-f.cc;for(let x=p;x<g.length;x++)g[x].cc+=y;e.endCC=g[g.length-1].cc}Ft(h.startPTS)&&Ft(h.endPTS)&&(f.setStart(f.startPTS=h.startPTS),f.startDTS=h.startDTS,f.maxStartPTS=h.maxStartPTS,f.endPTS=h.endPTS,f.endDTS=h.endDTS,f.minEndPTS=h.minEndPTS,f.setDuration(h.endPTS-h.startPTS),f.duration&&(r=f),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(f.elementaryStreams=h.elementaryStreams),f.loader=h.loader,h.hasStats&&(f.stats=h.stats),h.initSegment&&(f.initSegment=h.initSegment,n=h.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(n&&o.forEach(h=>{var f;h&&(!h.initSegment||h.initSegment.relurl===((f=n)==null?void 0:f.relurl))&&(h.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(h=>!h),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=n6(s.dateRanges,e,t));const h=s.fragments.filter(f=>f.rawProgramDateTime);if(s.hasProgramDateTime&&!e.hasProgramDateTime)for(let f=1;f<o.length;f++)o[f].programDateTime===null&&cw(o[f],o[f-1],h);LU(h,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const h=FU(s,e.startSN-1);e.startCC=(l=h?.cc)!=null?l:a[0].cc}i6(s.partList,e.partList,(h,f)=>{f.elementaryStreams=h.elementaryStreams,f.stats=h.stats}),r?OU(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,t):PU(s,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=s.driftStartTime,e.driftStart=s.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const h=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=h),e.driftEndTime=c,e.driftEnd=h}else e.driftEndTime=s.driftEndTime,e.driftEnd=s.driftEnd,e.advancedDateTime=s.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=s.requestScheduled)}function n6(s,e,t){const{dateRanges:n,recentlyRemovedDateranges:i}=e,r=Li({},s);i&&i.forEach(l=>{delete r[l]});const o=Object.keys(r).length;return o?(Object.keys(n).forEach(l=>{const c=r[l],h=new RU(n[l].attr,c);h.isValid?(r[l]=h,c||(h.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Wi(n[l].attr)}"`)}),r):n}function i6(s,e,t){if(s&&e){let n=0;for(let i=0,r=s.length;i<=r;i++){const a=s[i],o=e[i+n];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):n--}}}function s6(s,e,t){const n=e.skippedSegments,i=Math.max(s.startSN,e.startSN)-e.startSN,r=(s.fragmentHint?1:0)+(n?e.endSN:Math.min(s.endSN,e.endSN))-e.startSN,a=e.startSN-s.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments;for(let c=i;c<=r;c++){const h=l[a+c];let f=o[c];if(n&&!f&&h&&(f=e.fragments[c]=h),h&&f){t(h,f,c,o);const p=h.relurl,g=f.relurl;if(p&&r6(p,g)){e.playlistParsingError=h2(`media sequence mismatch ${f.sn}:`,s,e,h,f);return}else if(h.cc!==f.cc){e.playlistParsingError=h2(`discontinuity sequence mismatch (${h.cc}!=${f.cc})`,s,e,h,f);return}}}}function h2(s,e,t,n,i){return new Error(`${s} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function PU(s,e,t=!0){const n=e.startSN+e.skippedSegments-s.startSN,i=s.fragments,r=n>=0;let a=0;if(r&&n<i.length)a=i[n].start;else if(r&&e.startSN===s.endSN+1)a=s.fragmentEnd;else if(r&&t)a=s.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=s.fragmentStart;else return;uw(e,a)}function uw(s,e){if(e){const t=s.fragments;for(let n=s.skippedSegments;n<t.length;n++)t[n].addStart(e);s.fragmentHint&&s.fragmentHint.addStart(e)}}function NU(s,e=1/0){let t=1e3*s.targetduration;if(s.updated){const n=s.fragments;if(n.length&&t*4>e){const r=n[n.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function FU(s,e,t){if(!s)return null;let n=s.fragments[e-s.startSN];return n||(n=s.fragmentHint,n&&n.sn===e)?n:e<s.startSN&&t&&t.sn===e?t:null}function f2(s,e,t){return s?UU(s.partList,e,t):null}function UU(s,e,t){if(s)for(let n=s.length;n--;){const i=s[n];if(i.index===t&&i.fragment.sn===e)return i}return null}function kU(s){s.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function r6(s,e){return s!==e&&e?d2(s)!==d2(e):!1}function d2(s){return s.replace(/\?[^?]*$/,"")}function lv(s,e){for(let n=0,i=s.length;n<i;n++){var t;if(((t=s[n])==null?void 0:t.cc)===e)return s[n]}return null}function a6(s,e){return!!(s&&e.startCC<s.endCC&&e.endCC>s.startCC)}function p2(s,e){const t=s.start+e;s.startPTS=t,s.setStart(t),s.endPTS=t+s.duration}function GU(s,e){const t=e.fragments;for(let n=0,i=t.length;n<i;n++)p2(t[n],s);e.fragmentHint&&p2(e.fragmentHint,s),e.alignedSliding=!0}function o6(s,e){s&&(HU(e,s),e.alignedSliding||yb(e,s),!e.alignedSliding&&!e.skippedSegments&&PU(s,e,!1))}function HU(s,e){if(!a6(e,s))return;const t=Math.min(e.endCC,s.endCC),n=lv(e.fragments,t),i=lv(s.fragments,t);if(!n||!i)return;_i.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=n.start-i.start;GU(r,s)}function yb(s,e){if(!s.hasProgramDateTime||!e.hasProgramDateTime)return;const t=s.fragments,n=e.fragments;if(!t.length||!n.length)return;let i,r;const a=Math.min(e.endCC,s.endCC);e.startCC<a&&s.startCC<a&&(i=lv(n,a),r=lv(t,a)),(!i||!r)&&(i=n[Math.floor(n.length/2)],r=lv(t,i.cc)||t[Math.floor(t.length/2)]);const o=i.programDateTime,l=r.programDateTime;if(!o||!l)return;const c=(l-o)/1e3-(r.start-i.start);GU(c,s)}function Ma(s,e,t){no(s,e,t),s.addEventListener(e,t)}function no(s,e,t){s.removeEventListener(e,t)}const l6={toString:function(s){let e="";const t=s.length;for(let n=0;n<t;n++)e+=`[${s.start(n).toFixed(3)}-${s.end(n).toFixed(3)}]`;return e}},ut={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class VR extends MU{constructor(e,t,n,i,r){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ut.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:c,state:h}=this,f=l?l.currentTime:0,p=xn.bufferInfo(c||l,f,a.maxBufferHole),g=!p.len;if(this.log(`Media seeking to ${Ft(f)?f.toFixed(3):f}, state: ${h}, ${g?"out of":"in"} buffer`),this.state===ut.ENDED)this.resetLoadingState();else if(o){const y=a.maxFragLookUpTolerance,x=o.start-y,E=o.start+o.duration+y;if(g||E<p.start||x>p.end){const _=f>E;(f<x||_)&&(_&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(f,1/0,this.playlistType,!0);const y=this.lastCurrentTime;if(f>y&&(this.lastCurrentTime=f),!this.loadingParts){const x=Math.max(p.end,f),E=this.shouldLoadParts(this.getLevelDetails(),x);E&&(this.log(`LL-Part loading ON after seeking to ${f.toFixed(2)} with buffer @${x.toFixed(2)}`),this.loadingParts=E)}}this.hls.hasEnoughToStart||(this.log(`Setting ${g?"startPosition":"nextLoadPosition"} to ${f} for seek without enough to start`),this.nextLoadPosition=f,g&&(this.startPosition=f)),g&&this.state===ut.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new OV(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new GR(e.config)}registerListeners(){const{hls:e}=this;e.on(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Y.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ut.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ut.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,i=this.config.timelineOffset||0;if(n<=i)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=xn.bufferedInfo(r,e.start,0));const a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const h=l[l.length-1];return xn.isBuffered(this.media,h.start+h.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;Ma(n,"seeking",this.onMediaSeeking),Ma(n,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===ut.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),no(i,"seeking",this.onMediaSeeking),no(i,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ut.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const i=r=>{const a=r.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(a,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,n,i).then(r=>{if(!r)return;const a=this.state,o=r.frag;if(this.fragContextChanged(o)){(a===ut.FRAG_LOADING||!this.fragCurrent&&a===ut.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=ut.IDLE);return}"payload"in r&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(Y.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===ut.STOPPED||this.state===ut.ERROR||(this.warn(`Frag error: ${r?.message||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===ur.APPENDING){const r=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,r),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===ur.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:n};this.hls.trigger(Y.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const i=n?.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:i}=this,{frag:r,payload:a}=n,o=r.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&dA(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,zR(o.method)).catch(c=>{throw i.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:r}),c}).then(c=>{const h=self.performance.now();return i.trigger(Y.FRAG_DECRYPTED,{frag:r,payload:c,stats:{tstart:l,tdecrypt:h}}),n.payload=c,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===ut.STOPPED||this.state===ut.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==ut.STOPPED&&(this.state=ut.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,i;const r=e.tracks;if(r&&!t.encrypted&&((n=r.audio)!=null&&n.encrypted||(i=r.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(Y.ERROR,{type:Wt.KEY_SYSTEM_ERROR,details:He.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?l6.toString(xn.getBuffered(n)):"(detached)"})`),Ks(e)){var i;if(e.type!==jt.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=ut.IDLE;return}}const r=(i=this.levels)==null?void 0:i[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=ut.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:i,partsLoaded:r}=e,a=!r||r.length===0||r.some(l=>!l),o=new HR(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,i){var r;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((r=e.decryptdata)!=null&&r.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ut.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(p=>{if(!this.fragContextChanged(p.frag))return this.hls.trigger(Y.KEY_LOADED,p),this.state===ut.KEY_LOADING&&(this.state=ut.IDLE),p}),this.hls.trigger(Y.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(Ks(e)&&(!l||e.sn!==l.sn)){const p=this.shouldLoadParts(t.details,e.end);p!==this.loadingParts&&(this.log(`LL-Part loading ${p?"ON":"OFF"} loading sn ${l?.sn}->${e.sn}`),this.loadingParts=p)}if(n=Math.max(e.start,n||0),this.loadingParts&&Ks(e)){const p=a.partList;if(p&&i){n>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const g=this.getNextPart(p,e,n);if(g>-1){const y=p[g];e=this.fragCurrent=y.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${y.index} (${g}/${p.length-1}) of ${this.fragInfo(e,!1,y)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=y.start+y.duration,this.state=ut.FRAG_LOADING;let x;return o?x=o.then(E=>!E||this.fragContextChanged(E.frag)?null:this.doFragPartsLoad(e,y,t,i)).catch(E=>this.handleFragLoadError(E)):x=this.doFragPartsLoad(e,y,t,i).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(Y.FRAG_LOADING,{frag:e,part:y,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):x}else if(!e.url||this.loadedEndOfParts(p,n))return Promise.resolve(null)}}if(Ks(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=a.partList)==null?void 0:c.filter(p=>p.loaded).map(p=>`[${p.start}-${p.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),Ft(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ut.FRAG_LOADING;const h=this.config.progressive;let f;return h&&o?f=o.then(p=>!p||this.fragContextChanged(p.frag)?null:this.fragmentLoader.load(e,i)).catch(p=>this.handleFragLoadError(p)):f=Promise.all([this.fragmentLoader.load(e,h?i:void 0),o]).then(([p])=>(!h&&i&&i(p),p)).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(Y.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):f}doFragPartsLoad(e,t,n,i){return new Promise((r,a)=>{var o;const l=[],c=(o=n.details)==null?void 0:o.partList,h=f=>{this.fragmentLoader.loadPart(e,f,i).then(p=>{l[f.index]=p;const g=p.part;this.hls.trigger(Y.FRAG_LOADED,p);const y=f2(n.details,e.sn,f.index+1)||UU(c,e.sn,f.index+1);if(y)h(y);else return r({frag:e,part:g,partsLoaded:l})}).catch(a)};h(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===He.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Wt.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetFragmentLoading(t.frag)):this.hls.trigger(Y.ERROR,t)}else this.hls.trigger(Y.ERROR,{type:Wt.OTHER_ERROR,details:He.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ut.PARSING){!this.fragCurrent&&this.state!==ut.STOPPED&&this.state!==ut.ERROR&&(this.state=ut.IDLE);return}const{frag:n,part:i,level:r}=t,a=self.performance.now();n.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const o=this.getLevelDetails(),c=o&&n.sn>o.endSN||this.shouldLoadParts(o,n.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(n,i,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const r=e.partList[0];if(r.fragment.type===jt.SUBTITLE)return!1;const a=r.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=a){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:i,sn:r,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const o=t[i],l=o.details,c=a>-1?f2(l,r,a):null,h=c?c.fragment:FU(l,r,n);return h?(n&&n!==h&&(h.stats=n.stats),{frag:h,part:c,level:o}):null}bufferFragmentData(e,t,n,i,r){if(this.state!==ut.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(o&&(l=xl(a,o)),!l.length)return;const c=this.initPTS[t.cc],h=c?-c.baseTime/c.timescale:void 0,f={type:e.type,frag:t,part:n,chunkMeta:i,offset:h,parent:t.type,data:l};if(this.hls.trigger(Y.BUFFER_APPENDING,f),e.dropped&&e.independent&&!n){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!xn.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,i=xn.bufferInfo(t,n,0),r=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),o=Math.max(Math.min(e.start-a,i.end-a),n+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var n;const i=this.getLoadPosition();if(!Ft(i))return null;const a=this.lastCurrentTime>i||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,a)}getFwdBufferInfoAtPos(e,t,n,i){const r=xn.bufferInfo(e,t,i);if(r.len===0&&r.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&(r.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(r.nextStart,a.end)-t,i);return xn.bufferInfo(e,t,o)}}return r}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,i=Math.max(Math.min(e-t,n.maxBufferLength),t),r=Math.max(e-t*3,n.maxMaxBufferLength/2,i);return r>=i?(n.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=jt.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,i=n.length;if(!i)return null;const{config:r}=this,a=n[0].start,o=r.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const f=r.initialLiveManifestSize;if(i<f)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${f})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var c;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const p=this.hls.startPosition,g=this.hls.liveSyncPosition,y=l?(p!==-1&&p>=a?p:g)||l.start:e;this.log(`Setting startPosition to ${y} to match start frag at live edge. mainStart: ${p} liveSyncPosition: ${g} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=y}}else e<=a&&(l=n[0]);if(!l){const f=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,f,t)}let h=this.filterReplacedPrimary(l,t);if(!h&&l){const f=l.sn-t.startSN;h=this.filterReplacedPrimary(n[f+1]||null,t)}return this.mapToInitFragWhenRequired(h)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===ur.OK||n===ur.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,r){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&n.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i,0);if(o!==null&&n.len+o.len>=r){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(m2(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(m2(this.config)&&e.type!==jt.SUBTITLE){const n=this.hls.interstitialsManager,i=n?.bufferingItem;if(i){const a=i.event;if(a){if(a.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&t?.live===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const r=n?.playerQueue;if(r)for(let a=r.length;a--;){const o=r[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let i=-1,r=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const c=e[o];if(a=a&&!c.independent,i>-1&&n<c.start)break;const h=c.loaded;h?i=-1:(r||(c.independent||a)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${c.start}`),i=o),r=h}return i}loadedEndOfParts(e,t){let n;for(let i=e.length;i--;){if(n=e[i],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let i=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=_V(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=n.sn+1;if(r>=e.startSN&&r<=e.endSN){const a=t[r-e.startSN];n.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=IU(e,n.cc,n.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(i=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,n){const{config:i}=this;let{fragPrevious:r}=this,{fragments:a,endSN:o}=n;const{fragmentHint:l}=n,{maxFragLookUpTolerance:c}=i,h=n.partList,f=!!(this.loadingParts&&h!=null&&h.length&&l);f&&!this.bitrateTest&&h[h.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let p;if(e<t){var g;const x=e<this.lastCurrentTime||e>t-c||(g=this.media)!=null&&g.paused||!this.startFragRequested?0:c;p=um(r,a,e,x)}else p=a[a.length-1];if(p){const y=p.sn-n.startSN,x=this.fragmentTracker.getState(p);if((x===ur.OK||x===ur.PARTIAL&&p.gap)&&(r=p),r&&p.sn===r.sn&&(!f||h[0].fragment.sn>p.sn||!n.live)&&p.level===r.level){const _=a[y+1];p.sn<o&&this.fragmentTracker.getState(_)!==ur.OK?p=_:p=null}}return p}alignPlaylists(e,t,n){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,a=!t,o=e.alignedSliding&&Ft(r);if(a||!o&&!r){o6(n,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),l}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const i=this.timelineOffset;if(n===-1){const r=this.startTimeOffset!==null,a=r?this.startTimeOffset:e.startTimeOffset;a!==null&&Ft(a)?(n=t+a,a<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${a} found in ${r?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+i}this.nextLoadPosition=n+i}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ks(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ut.FRAG_LOADING_WAITING_RETRY)&&(this.state=ut.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const _=this.getCurrentContext(t.chunkMeta);_&&(t.frag=_.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var r;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const a=t.details===He.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);const o=t.errorAction;if(!o){this.state=ut.ERROR;return}const{action:l,flags:c,retryCount:h=0,retryConfig:f}=o,p=!!f,g=p&&l===Nr.RetryRequest,y=p&&!o.resolved&&c===Mo.MoveAllAlternatesMatchingHost,x=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!g&&y&&Ks(i)&&!i.endList&&x)this.resetFragmentErrors(e),this.treatAsGap(i),o.resolved=!0;else if((g||y)&&h<f.maxNumRetry){var E;const _=aw((E=t.response)==null?void 0:E.code),b=kR(f,h);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+b,this.state=ut.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,_){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${h+1}/${f.maxNumRetry} in ${b}ms`)}else if(f)if(this.resetFragmentErrors(e),h<f.maxNumRetry)!a&&l!==Nr.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}else l===Nr.SendAlternateToPenaltyBox?this.state=ut.WAITING_LEVEL:this.state=ut.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!aw(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ut.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ut.PARSING||this.state===ut.PARSED){const t=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,t?.duration||10);const a=!r;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===jt.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ut.STOPPED&&(this.state=ut.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const i=xn.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===ut.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ut.STOPPED&&(this.state=ut.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){const r=n.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const h=e.elementaryStreams[c];if(h){const f=h.endPTS-h.startPTS;if(f<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${f})`),l||!1;const p=i?0:OU(r,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS,this);return this.hls.trigger(Y.LEVEL_PTS_UPDATED,{details:r,level:n,drift:p,type:c,frag:e,start:h.startPTS,end:h.endPTS}),!0}return l},!1)){var o;if(n.fragmentError===0&&this.treatAsGap(e,n),((o=this.transmuxer)==null?void 0:o.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ut.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(Y.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===jt.MAIN?"level":"track"}fragInfo(e,t=!0,n){var i,r;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((i=t&&!n?e.startPTS:(n||e).start)!=null?i:NaN).toFixed(3)}-${((r=t&&!n?e.endPTS:(n||e).end)!=null?r:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function m2(s){return!!s.interstitialsController&&s.enableInterstitialPlayback!==!1}class zU{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=c6(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function c6(s,e){const t=new Uint8Array(e);let n=0;for(let i=0;i<s.length;i++){const r=s[i];t.set(r,n),n+=r.length}return t}var x1={exports:{}},g2;function u6(){return g2||(g2=1,(function(s){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(l,c,h){this.fn=l,this.context=c,this.once=h||!1}function r(l,c,h,f,p){if(typeof h!="function")throw new TypeError("The listener must be a function");var g=new i(h,f||l,p),y=t?t+c:c;return l._events[y]?l._events[y].fn?l._events[y]=[l._events[y],g]:l._events[y].push(g):(l._events[y]=g,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],h,f;if(this._eventsCount===0)return c;for(f in h=this._events)e.call(h,f)&&c.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},o.prototype.listeners=function(c){var h=t?t+c:c,f=this._events[h];if(!f)return[];if(f.fn)return[f.fn];for(var p=0,g=f.length,y=new Array(g);p<g;p++)y[p]=f[p].fn;return y},o.prototype.listenerCount=function(c){var h=t?t+c:c,f=this._events[h];return f?f.fn?1:f.length:0},o.prototype.emit=function(c,h,f,p,g,y){var x=t?t+c:c;if(!this._events[x])return!1;var E=this._events[x],_=arguments.length,b,C;if(E.fn){switch(E.once&&this.removeListener(c,E.fn,void 0,!0),_){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,h),!0;case 3:return E.fn.call(E.context,h,f),!0;case 4:return E.fn.call(E.context,h,f,p),!0;case 5:return E.fn.call(E.context,h,f,p,g),!0;case 6:return E.fn.call(E.context,h,f,p,g,y),!0}for(C=1,b=new Array(_-1);C<_;C++)b[C-1]=arguments[C];E.fn.apply(E.context,b)}else{var I=E.length,M;for(C=0;C<I;C++)switch(E[C].once&&this.removeListener(c,E[C].fn,void 0,!0),_){case 1:E[C].fn.call(E[C].context);break;case 2:E[C].fn.call(E[C].context,h);break;case 3:E[C].fn.call(E[C].context,h,f);break;case 4:E[C].fn.call(E[C].context,h,f,p);break;default:if(!b)for(M=1,b=new Array(_-1);M<_;M++)b[M-1]=arguments[M];E[C].fn.apply(E[C].context,b)}}return!0},o.prototype.on=function(c,h,f){return r(this,c,h,f,!1)},o.prototype.once=function(c,h,f){return r(this,c,h,f,!0)},o.prototype.removeListener=function(c,h,f,p){var g=t?t+c:c;if(!this._events[g])return this;if(!h)return a(this,g),this;var y=this._events[g];if(y.fn)y.fn===h&&(!p||y.once)&&(!f||y.context===f)&&a(this,g);else{for(var x=0,E=[],_=y.length;x<_;x++)(y[x].fn!==h||p&&!y[x].once||f&&y[x].context!==f)&&E.push(y[x]);E.length?this._events[g]=E.length===1?E[0]:E:a(this,g)}return this},o.prototype.removeAllListeners=function(c){var h;return c?(h=t?t+c:c,this._events[h]&&a(this,h)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,s.exports=o})(x1)),x1.exports}var h6=u6(),jR=F5(h6);const wv="1.6.11",DA={};function f6(){return typeof __HLS_WORKER_BUNDLE__=="function"}function d6(){const s=DA[wv];if(s)return s.clientCount++,s;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return DA[wv]=i,i}function p6(s){const e=DA[s];if(e)return e.clientCount++,e;const t=new self.URL(s,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return DA[s]=i,i}function m6(s){const e=DA[s||wv];if(e&&e.clientCount--===1){const{worker:n,objectURL:i}=e;delete DA[s||wv],i&&self.URL.revokeObjectURL(i),n.terminate()}}function QU(s,e){return e+10<=s.length&&s[e]===51&&s[e+1]===68&&s[e+2]===73&&s[e+3]<255&&s[e+4]<255&&s[e+6]<128&&s[e+7]<128&&s[e+8]<128&&s[e+9]<128}function qR(s,e){return e+10<=s.length&&s[e]===73&&s[e+1]===68&&s[e+2]===51&&s[e+3]<255&&s[e+4]<255&&s[e+6]<128&&s[e+7]<128&&s[e+8]<128&&s[e+9]<128}function bT(s,e){let t=0;return t=(s[e]&127)<<21,t|=(s[e+1]&127)<<14,t|=(s[e+2]&127)<<7,t|=s[e+3]&127,t}function Rv(s,e){const t=e;let n=0;for(;qR(s,e);){n+=10;const i=bT(s,e+6);n+=i,QU(s,e+10)&&(n+=10),e+=n}if(n>0)return s.subarray(t,t+n)}function g6(s,e,t,n){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],a=r>>2&15;if(a>12){const g=new Error(`invalid ADTS sampling index:${a}`);s.emit(Y.ERROR,Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.FRAG_PARSING_ERROR,fatal:!0,error:g,reason:g.message});return}const o=(r>>6&3)+1,l=e[t+3]>>6&3|(r&1)<<2,c="mp4a.40."+o,h=i[a];let f=a;(o===5||o===29)&&(f-=3);const p=[o<<3|(f&14)>>1,(f&1)<<7|l<<3];return _i.log(`manifest codec:${n}, parsed codec:${c}, channels:${l}, rate:${h} (ADTS object type:${o} sampling index:${a})`),{config:p,samplerate:h,channelCount:l,codec:c,parsedCodec:c,manifestCodec:n}}function VU(s,e){return s[e]===255&&(s[e+1]&246)===240}function jU(s,e){return s[e+1]&1?7:9}function KR(s,e){return(s[e+3]&3)<<11|s[e+4]<<3|(s[e+5]&224)>>>5}function A6(s,e){return e+5<s.length}function vb(s,e){return e+1<s.length&&VU(s,e)}function y6(s,e){return A6(s,e)&&VU(s,e)&&KR(s,e)<=s.length-e}function v6(s,e){if(vb(s,e)){const t=jU(s,e);if(e+t>=s.length)return!1;const n=KR(s,e);if(n<=t)return!1;const i=e+n;return i===s.length||vb(s,i)}return!1}function qU(s,e,t,n,i){if(!s.samplerate){const r=g6(e,t,n,i);if(!r)return;Li(s,r)}}function KU(s){return 1024*9e4/s}function E6(s,e){const t=jU(s,e);if(e+t<=s.length){const n=KR(s,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function YU(s,e,t,n,i){const r=KU(s.samplerate),a=n+i*r,o=E6(e,t);let l;if(o){const{frameLength:f,headerLength:p}=o,g=p+f,y=Math.max(0,t+g-e.length);y?(l=new Uint8Array(g-p),l.set(e.subarray(t+p,e.length),0)):l=e.subarray(t+p,t+g);const x={unit:l,pts:a};return y||s.samples.push(x),{sample:x,length:g,missing:y}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:c,missing:-1}}function x6(s,e){return qR(s,e)&&bT(s,e+6)+10<=s.length-e}function _6(s){return s instanceof ArrayBuffer?s:s.byteOffset==0&&s.byteLength==s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer}function _1(s,e=0,t=1/0){return S6(s,e,t,Uint8Array)}function S6(s,e,t,n){const i=b6(s);let r=1;"BYTES_PER_ELEMENT"in n&&(r=n.BYTES_PER_ELEMENT);const a=T6(s)?s.byteOffset:0,o=(a+s.byteLength)/r,l=(a+e)/r,c=Math.floor(Math.max(0,Math.min(l,o))),h=Math.floor(Math.min(c+Math.max(t,0),o));return new n(i,c,h-c)}function b6(s){return s instanceof ArrayBuffer?s:s.buffer}function T6(s){return s&&s.buffer instanceof ArrayBuffer&&s.byteLength!==void 0&&s.byteOffset!==void 0}function C6(s){const e={key:s.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(s.size<2)return;if(s.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=s.data.subarray(1).indexOf(0);if(n===-1)return;const i=Fo(_1(s.data,1,n)),r=s.data[2+n],a=s.data.subarray(3+n).indexOf(0);if(a===-1)return;const o=Fo(_1(s.data,3+n,a));let l;return i==="-->"?l=Fo(_1(s.data,4+n+a)):l=_6(s.data.subarray(4+n+a)),e.mimeType=i,e.pictureType=r,e.description=o,e.data=l,e}function I6(s){if(s.size<2)return;const e=Fo(s.data,!0),t=new Uint8Array(s.data.subarray(e.length+1));return{key:s.type,info:e,data:t.buffer}}function M6(s){if(s.size<2)return;if(s.type==="TXXX"){let t=1;const n=Fo(s.data.subarray(t),!0);t+=n.length+1;const i=Fo(s.data.subarray(t));return{key:s.type,info:n,data:i}}const e=Fo(s.data.subarray(1));return{key:s.type,info:"",data:e}}function w6(s){if(s.type==="WXXX"){if(s.size<2)return;let t=1;const n=Fo(s.data.subarray(t),!0);t+=n.length+1;const i=Fo(s.data.subarray(t));return{key:s.type,info:n,data:i}}const e=Fo(s.data);return{key:s.type,info:"",data:e}}function R6(s){return s.type==="PRIV"?I6(s):s.type[0]==="W"?w6(s):s.type==="APIC"?C6(s):M6(s)}function B6(s){const e=String.fromCharCode(s[0],s[1],s[2],s[3]),t=bT(s,4),n=10;return{type:e,size:t,data:s.subarray(n,n+t)}}const y_=10,D6=10;function XU(s){let e=0;const t=[];for(;qR(s,e);){const n=bT(s,e+6);s[e+5]>>6&1&&(e+=y_),e+=y_;const i=e+n;for(;e+D6<i;){const r=B6(s.subarray(e)),a=R6(r);a&&t.push(a),e+=r.size+y_}QU(s,e)&&(e+=y_)}return t}function WU(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"}function L6(s){if(s.data.byteLength===8){const e=new Uint8Array(s.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function YR(s){const e=XU(s);for(let t=0;t<e.length;t++){const n=e[t];if(WU(n))return L6(n)}}let Bo=(function(s){return s.audioId3="org.id3",s.dateRange="com.apple.quicktime.HLS",s.emsg="https://aomedia.org/emsg/ID3",s.misbklv="urn:misb:KLV:bin:1910.1",s})({});function fu(s="",e=9e4){return{type:s,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class XR{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=xl(this.cachedData,e),this.cachedData=null);let n=Rv(e,0),i=n?n.length:0,r;const a=this._audioTrack,o=this._id3Track,l=n?YR(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&Ft(l))&&(this.basePTS=O6(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Bo.audioId3,duration:Number.POSITIVE_INFINITY});i<c;){if(this.canParse(e,i)){const h=this.appendFrame(a,e,i);h?(this.frameIndex++,this.lastPTS=h.sample.pts,i+=h.length,r=i):i=c}else x6(e,i)?(n=Rv(e,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Bo.audioId3,duration:Number.POSITIVE_INFINITY}),i+=n.length,r=i):i++;if(i===c&&r!==c){const h=e.slice(r);this.cachedData?this.cachedData=xl(this.cachedData,h):this.cachedData=h}}return{audioTrack:a,videoTrack:fu(),id3Track:o,textTrack:fu()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:fu(),id3Track:this._id3Track,textTrack:fu()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const O6=(s,e,t)=>{if(Ft(s))return s*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let v_=null;const P6=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],N6=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],F6=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],U6=[0,1,1,4];function $U(s,e,t,n,i){if(t+24>e.length)return;const r=JU(e,t);if(r&&t+r.frameLength<=e.length){const a=r.samplesPerFrame*9e4/r.sampleRate,o=n+i*a,l={unit:e.subarray(t,t+r.frameLength),pts:o,dts:o};return s.config=[],s.channelCount=r.channelCount,s.samplerate=r.sampleRate,s.samples.push(l),{sample:l,length:r.frameLength,missing:0}}}function JU(s,e){const t=s[e+1]>>3&3,n=s[e+1]>>1&3,i=s[e+2]>>4&15,r=s[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&r!==3){const a=s[e+2]>>1&1,o=s[e+3]>>6,l=t===3?3-n:n===3?3:4,c=P6[l*14+i-1]*1e3,f=N6[(t===3?0:t===2?1:2)*3+r],p=o===3?1:2,g=F6[t][n],y=U6[n],x=g*8*y,E=Math.floor(g*c/f+a)*y;if(v_===null){const C=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);v_=C?parseInt(C[1]):0}return!!v_&&v_<=87&&n===2&&c>=224e3&&o===0&&(s[e+3]=s[e+3]|128),{sampleRate:f,channelCount:p,frameLength:E,samplesPerFrame:x}}}function WR(s,e){return s[e]===255&&(s[e+1]&224)===224&&(s[e+1]&6)!==0}function ZU(s,e){return e+1<s.length&&WR(s,e)}function k6(s,e){return WR(s,e)&&4<=s.length-e}function e3(s,e){if(e+1<s.length&&WR(s,e)){const n=JU(s,e);let i=4;n!=null&&n.frameLength&&(i=n.frameLength);const r=e+i;return r===s.length||ZU(s,r)}return!1}class G6 extends XR{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Rv(e,0);let i=n?.length||0;if(e3(e,i))return!1;for(let r=e.length;i<r;i++)if(v6(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return y6(e,t)}appendFrame(e,t,n){qU(e,this.observer,t,n,e.manifestCodec);const i=YU(e,t,n,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const t3=(s,e)=>{let t=0,n=5;e+=n;const i=new Uint32Array(1),r=new Uint32Array(1),a=new Uint8Array(1);for(;n>0;){a[0]=s[e];const o=Math.min(n,8),l=8-o;r[0]=4278190080>>>24+l<<l,i[0]=(a[0]&r[0])>>l,t=t?t<<o|i[0]:i[0],e+=1,n-=o}return t};class H6 extends XR{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const i=n3(e,t,n,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Rv(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&YR(t)!==void 0&&t3(e,n)<16}}function n3(s,e,t,n,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const o=[48e3,44100,32e3][r],l=e[t+4]&63,h=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+r]*2;if(t+h>e.length)return-1;const f=e[t+6]>>5;let p=0;f===2?p+=2:(f&1&&f!==1&&(p+=2),f&4&&(p+=2));const g=(e[t+6]<<8|e[t+7])>>12-p&1,x=[2,1,2,3,3,4,4,5][f]+g,E=e[t+5]>>3,_=e[t+5]&7,b=new Uint8Array([r<<6|E<<1|_>>2,(_&3)<<6|f<<3|g<<2|l>>4,l<<4&224]),C=1536/o*9e4,I=n+i*C,M=e.subarray(t,t+h);return s.config=b,s.channelCount=x,s.samplerate=o,s.samples.push({unit:M,pts:I}),h}class z6 extends XR{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Rv(e,0);let n=t?.length||0;if(t&&e[n]===11&&e[n+1]===119&&YR(t)!==void 0&&t3(e,n)<=16)return!1;for(let i=e.length;n<i;n++)if(e3(e,n))return _i.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return k6(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return $U(e,t,n,this.basePTS,this.frameIndex)}}const Q6=/\/emsg[-/]ID3/i;class V6{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){const r=this.videoTrack=fu("video",1),a=this.audioTrack=fu("audio",1),o=this.txtTrack=fu("text",1);if(this.id3Track=fu("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=AU(e);if(l.video){const{id:c,timescale:h,codec:f,supplemental:p}=l.video;r.id=c,r.timescale=o.timescale=h,r.codec=f,r.supplemental=p}if(l.audio){const{id:c,timescale:h,codec:f}=l.audio;a.id=c,a.timescale=h,a.codec=f}o.id=pU.text,r.sampleDuration=0,r.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return z5(e)}demux(e,t){this.timeOffset=t;let n=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=xl(this.remainderData,e));const o=Y5(n);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=n;const a=this.extractID3Track(i,t);return r.samples=PL(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return n.samples=PL(e,t),{videoTrack:t,audioTrack:fu(),id3Track:i,textTrack:fu()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const i=Fn(e.samples,["emsg"]);i&&i.forEach(r=>{const a=W5(r);if(Q6.test(a.schemeIdUri)){const o=A2(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=a.payload;n.samples.push({data:c,len:c.byteLength,dts:o,pts:o,type:Bo.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=A2(a,t);n.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:Bo.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function A2(s,e){return Ft(s.presentationTime)?s.presentationTime/s.timeScale:e+s.presentationTimeDelta/s.timeScale}class j6{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new GR(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ld.cbc)}decryptAacSample(e,t,n){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);i.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)n.set(e.subarray(r,r+16),i);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)e.set(n.subarray(i,i+16),r);return e}decryptAvcSample(e,t,n,i,r){const a=vU(r.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{r.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)}).catch(i)}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){i();return}const r=e[t].units;for(;!(n>=r.length);n++){const a=r[n];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,n,i,a),!this.decrypter.isSync()))return}}}}class i3{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,i;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const r=n.units;i=r[r.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,i=n.length;if(i){const r=n[i-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const i=t.byteLength;let r=e.naluState||0;const a=r,o=[];let l=0,c,h,f,p=-1,g=0;for(r===-1&&(p=0,g=this.getNALuType(t,0),r=0,l=1);l<i;){if(c=t[l++],!r){r=c?0:1;continue}if(r===1){r=c?0:2;continue}if(!c)r=3;else if(c===1){if(h=l-r-1,p>=0){const y={data:t.subarray(p,h),type:g};o.push(y)}else{const y=this.getLastNalUnit(e.samples);y&&(a&&l<=4-a&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-a)),h>0&&(y.data=xl(y.data,t.subarray(0,h)),y.state=0))}l<i?(f=this.getNALuType(t,l),p=l,g=f,r=0):r=-1}else r=0}if(p>=0&&r>=0){const y={data:t.subarray(p,i),type:g,state:r};o.push(y)}if(o.length===0){const y=this.getLastNalUnit(e.samples);y&&(y.data=xl(y.data,t))}return e.naluState=r,o}}class cv{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");i.set(e.subarray(n,n+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&_i.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class q6 extends i3{parsePES(e,t,n,i){const r=this.parseNALu(e,n.data,i);let a=this.VideoSample,o,l=!1;n.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),r.forEach(c=>{var h,f;switch(c.type){case 1:{let x=!1;o=!0;const E=c.data;if(l&&E.length>4){const _=this.readSliceType(E);(_===2||_===4||_===7||_===9)&&(x=!0)}if(x){var p;(p=a)!=null&&p.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=x;break}case 5:o=!0,(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,NR(c.data,1,n.pts,t.samples);break}case 7:{var g,y;o=!0,l=!0;const x=c.data,E=this.readSPS(x);if(!e.sps||e.width!==E.width||e.height!==E.height||((g=e.pixelRatio)==null?void 0:g[0])!==E.pixelRatio[0]||((y=e.pixelRatio)==null?void 0:y[1])!==E.pixelRatio[1]){e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.sps=[x];const _=x.subarray(1,4);let b="avc1.";for(let C=0;C<3;C++){let I=_[C].toString(16);I.length<2&&(I="0"+I),b+=I}e.codec=b}break}case 8:o=!0,e.pps=[c.data];break;case 9:o=!0,e.audFound=!0,(f=a)!=null&&f.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(c)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new cv(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,i=8,r;for(let a=0;a<e;a++)i!==0&&(r=t.readEG(),i=(n+r+256)%256),n=i===0?n:i}readSPS(e){const t=new cv(e);let n=0,i=0,r=0,a=0,o,l,c;const h=t.readUByte.bind(t),f=t.readBits.bind(t),p=t.readUEG.bind(t),g=t.readBoolean.bind(t),y=t.skipBits.bind(t),x=t.skipEG.bind(t),E=t.skipUEG.bind(t),_=this.skipScalingList.bind(this);h();const b=h();if(f(5),y(3),h(),E(),b===100||b===110||b===122||b===244||b===44||b===83||b===86||b===118||b===128){const P=p();if(P===3&&y(1),E(),E(),y(1),g())for(l=P!==3?8:12,c=0;c<l;c++)g()&&(c<6?_(16,t):_(64,t))}E();const C=p();if(C===0)p();else if(C===1)for(y(1),x(),x(),o=p(),c=0;c<o;c++)x();E(),y(1);const I=p(),M=p(),R=f(1);R===0&&y(1),y(1),g()&&(n=p(),i=p(),r=p(),a=p());let D=[1,1];if(g()&&g())switch(h()){case 1:D=[1,1];break;case 2:D=[12,11];break;case 3:D=[10,11];break;case 4:D=[16,11];break;case 5:D=[40,33];break;case 6:D=[24,11];break;case 7:D=[20,11];break;case 8:D=[32,11];break;case 9:D=[80,33];break;case 10:D=[18,11];break;case 11:D=[15,11];break;case 12:D=[64,33];break;case 13:D=[160,99];break;case 14:D=[4,3];break;case 15:D=[3,2];break;case 16:D=[2,1];break;case 255:{D=[h()<<8|h(),h()<<8|h()];break}}return{width:Math.ceil((I+1)*16-n*2-i*2),height:(2-R)*(M+1)*16-(R?2:4)*(r+a),pixelRatio:D}}}class K6 extends i3{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,i){const r=this.parseNALu(e,n.data,i);let a=this.VideoSample,o,l=!1;n.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),r.forEach(c=>{var h,f;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var p;(p=a)!=null&&p.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,NR(c.data,2,n.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Li(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const g=this.readSPS(c.data);e.width=g.width,e.height=g.height,e.pixelRatio=g.pixelRatio,e.codec=g.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const y in g.params)e.params[y]=g.params[y]}this.pushParameterSet(e.sps,c.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const g=this.readPPS(c.data);for(const y in g)e.params[y]=g[y]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(f=a)!=null&&f.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:o=!1;break}a&&o&&a.units.push(c)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[n]=e[i],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new cv(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:i}}readSPS(e){const t=new cv(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const i=t.readBits(2),r=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),h=t.readUByte(),f=t.readUByte(),p=t.readUByte(),g=t.readUByte(),y=t.readUByte(),x=t.readUByte(),E=t.readUByte(),_=t.readUByte(),b=[],C=[];for(let Se=0;Se<n;Se++)b.push(t.readBoolean()),C.push(t.readBoolean());if(n>0)for(let Se=n;Se<8;Se++)t.readBits(2);for(let Se=0;Se<n;Se++)b[Se]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),C[Se]&&t.readUByte();t.readUEG();const I=t.readUEG();I==3&&t.skipBits(1);const M=t.readUEG(),R=t.readUEG(),D=t.readBoolean();let P=0,L=0,O=0,U=0;D&&(P+=t.readUEG(),L+=t.readUEG(),O+=t.readUEG(),U+=t.readUEG());const j=t.readUEG(),H=t.readUEG(),z=t.readUEG(),q=t.readBoolean();for(let Se=q?0:n;Se<=n;Se++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let be=0;be<4;be++)for(let Re=0;Re<(be===3?2:6);Re++)if(!t.readBoolean())t.readUEG();else{const ue=Math.min(64,1<<4+(be<<1));be>1&&t.readEG();for(let $e=0;$e<ue;$e++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const V=t.readUEG();let X=0;for(let Se=0;Se<V;Se++){let be=!1;if(Se!==0&&(be=t.readBoolean()),be){Se===V&&t.readUEG(),t.readBoolean(),t.readUEG();let Re=0;for(let me=0;me<=X;me++){const ue=t.readBoolean();let $e=!1;ue||($e=t.readBoolean()),(ue||$e)&&Re++}X=Re}else{const Re=t.readUEG(),me=t.readUEG();X=Re+me;for(let ue=0;ue<Re;ue++)t.readUEG(),t.readBoolean();for(let ue=0;ue<me;ue++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Se=t.readUEG();for(let be=0;be<Se;be++){for(let Re=0;Re<z+4;Re++)t.readBits(1);t.readBits(1)}}let te=0,oe=1,Ee=1,Ce=!0,se=1,ie=0;t.readBoolean(),t.readBoolean();let ne=!1;if(t.readBoolean()){if(t.readBoolean()){const gt=t.readUByte(),ge=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ae=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];gt>0&&gt<16?(oe=ge[gt-1],Ee=ae[gt-1]):gt===255&&(oe=t.readBits(16),Ee=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ne=t.readBoolean(),ne&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(se=t.readBits(32),ie=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const ae=t.readBoolean(),Pe=t.readBoolean();let Ve=!1;(ae||Pe)&&(Ve=t.readBoolean(),Ve&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ve&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let rt=0;rt<=n;rt++){Ce=t.readBoolean();const et=Ce||t.readBoolean();let Mt=!1;et?t.readEG():Mt=t.readBoolean();const Et=Mt?1:t.readUEG()+1;if(ae)for(let Rt=0;Rt<Et;Rt++)t.readUEG(),t.readUEG(),Ve&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Pe)for(let Rt=0;Rt<Et;Rt++)t.readUEG(),t.readUEG(),Ve&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),te=t.readUEG())}let Be=M,Ge=R;if(D){let Se=1,be=1;I===1?Se=be=2:I==2&&(Se=2),Be=M-Se*L-Se*P,Ge=R-be*U-be*O}const Ue=i?["A","B","C"][i]:"",nt=o<<24|l<<16|c<<8|h;let pe=0;for(let Se=0;Se<32;Se++)pe=(pe|(nt>>Se&1)<<31-Se)>>>0;let ve=pe.toString(16);return a===1&&ve==="2"&&(ve="6"),{codecString:`hvc1.${Ue}${a}.${ve}.${r?"H":"L"}${_}.B0`,params:{general_tier_flag:r,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[o,l,c,h],general_constraint_indicator_flags:[f,p,g,y,x,E],general_level_idc:_,bit_depth:j+8,bit_depth_luma_minus8:j,bit_depth_chroma_minus8:H,min_spatial_segmentation_idc:te,chroma_format_idc:I,frame_rate:{fixed:Ce,fps:ie/se}},width:Be,height:Ge,pixelRatio:[oe,Ee]}}readPPS(e){const t=new cv(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),r=t.readBoolean();let a=1;return r&&i?a=0:r?a=3:i&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const xr=188;class jf{constructor(e,t,n,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=i,this.videoParser=null}static probe(e,t){const n=jf.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(xr*5,t-xr)+1,i=0;for(;i<n;){let r=!1,a=-1,o=0;for(let l=i;l<t;l+=xr)if(e[l]===71&&(t-l===xr||e[l+xr]===71)){if(o++,a===-1&&(a=l,a!==0&&(n=Math.min(a+xr*99,e.length-xr)+1)),r||(r=hw(e,l)===0),r&&o>1&&(a===0&&o>2||l+xr>n))return a}else{if(o)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:pU[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=jf.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=jf.createTrack("audio",i),this._id3Track=jf.createTrack("id3"),this._txtTrack=jf.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,i=!1){n||(this.sampleAes=null);let r;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,c=this._txtTrack;let h=a.pid,f=a.pesData,p=o.pid,g=l.pid,y=o.pesData,x=l.pesData,E=null,_=this.pmtParsed,b=this._pmtId,C=e.length;if(this.remainderData&&(e=xl(this.remainderData,e),C=e.length,this.remainderData=null),C<xr&&!i)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};const I=Math.max(0,jf.syncOffset(e));C-=(C-I)%xr,C<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,C,e.buffer.byteLength-C));let M=0;for(let D=I;D<C;D+=xr)if(e[D]===71){const P=!!(e[D+1]&64),L=hw(e,D),O=(e[D+3]&48)>>4;let U;if(O>1){if(U=D+5+e[D+4],U===D+xr)continue}else U=D+4;switch(L){case h:P&&(f&&(r=Cg(f,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,c,r,!1)),f={data:[],size:0}),f&&(f.data.push(e.subarray(U,D+xr)),f.size+=D+xr-U);break;case p:if(P){if(y&&(r=Cg(y,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,r);break;case"mp3":this.parseMPEGPES(o,r);break;case"ac3":this.parseAC3PES(o,r);break}y={data:[],size:0}}y&&(y.data.push(e.subarray(U,D+xr)),y.size+=D+xr-U);break;case g:P&&(x&&(r=Cg(x,this.logger))&&this.parseID3PES(l,r),x={data:[],size:0}),x&&(x.data.push(e.subarray(U,D+xr)),x.size+=D+xr-U);break;case 0:P&&(U+=e[U]+1),b=this._pmtId=Y6(e,U);break;case b:{P&&(U+=e[U]+1);const j=X6(e,U,this.typeSupported,n,this.observer,this.logger);h=j.videoPid,h>0&&(a.pid=h,a.segmentCodec=j.segmentVideoCodec),p=j.audioPid,p>0&&(o.pid=p,o.segmentCodec=j.segmentAudioCodec),g=j.id3Pid,g>0&&(l.pid=g),E!==null&&!_&&(this.logger.warn(`MPEG-TS PMT found at ${D} after unknown PID '${E}'. Backtracking to sync byte @${I} to parse all TS packets.`),E=null,D=I-188),_=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=L;break}}else M++;M>0&&fw(this.observer,new Error(`Found ${M} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=f,o.pesData=y,l.pesData=x;const R={audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};return i&&this.extractRemainingSamples(R),R}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:i,textTrack:r}=e,a=n.pesData,o=t.pesData,l=i.pesData;let c;if(a&&(c=Cg(a,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,r,c,!0),n.pesData=null)):n.pesData=a,o&&(c=Cg(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(c=Cg(l,this.logger))?(this.parseID3PES(i,c),i.pesData=null):i.pesData=l}demuxSampleAes(e,t,n){const i=this.demux(e,n,!0,!this.config.progressive),r=this.sampleAes=new j6(this.observer,this.config,t);return this.decrypt(i,r)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new q6:e==="hevc"&&(this.videoParser=new K6))}decrypt(e,t){return new Promise(n=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{n(e)}):n(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const i=this.aacOverFlow;let r=t.data;if(i){this.aacOverFlow=null;const f=i.missing,p=i.sample.unit.byteLength;if(f===-1)r=xl(i.sample.unit,r);else{const g=p-f;i.sample.unit.set(r.subarray(0,f),g),e.samples.push(i.sample),n=i.missing}}let a,o;for(a=n,o=r.length;a<o-1&&!vb(r,a);a++);if(a!==n){let f;const p=a<o-1;if(p?f=`AAC PES did not start with ADTS header,offset:${a}`:f="No ADTS header found in AAC PES",fw(this.observer,new Error(f),p,this.logger),!p)return}qU(e,this.observer,r,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(i){const f=KU(e.samplerate);l=i.sample.pts+f}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,h;for(;a<o;)if(h=YU(e,r,a,l,c),a+=h.length,h.missing){this.aacOverFlow=h;break}else for(c++;a<o-1&&!vb(r,a);a++);}parseMPEGPES(e,t){const n=t.data,i=n.length;let r=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(ZU(n,a)){const l=$U(e,n,a,o,r);if(l)a+=l.length,r++;else break}else a++}parseAC3PES(e,t){{const n=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=n.length;let a=0,o=0,l;for(;o<r&&(l=n3(e,n,o,i,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=Li({},t,{type:this._videoTrack?Bo.emsg:Bo.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function hw(s,e){return((s[e+1]&31)<<8)+s[e+2]}function Y6(s,e){return(s[e+10]&31)<<8|s[e+11]}function X6(s,e,t,n,i,r){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(s[e+1]&15)<<8|s[e+2],l=e+3+o-4,c=(s[e+10]&15)<<8|s[e+11];for(e+=12+c;e<l;){const h=hw(s,e),f=(s[e+3]&15)<<8|s[e+4];switch(s[e]){case 207:if(!n){S1("ADTS AAC",r);break}case 15:a.audioPid===-1&&(a.audioPid=h);break;case 21:a.id3Pid===-1&&(a.id3Pid=h);break;case 219:if(!n){S1("H.264",r);break}case 27:a.videoPid===-1&&(a.videoPid=h);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=h,a.segmentAudioCodec="mp3");break;case 193:if(!n){S1("AC-3",r);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=h,a.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&f>0){let p=e+5,g=f;for(;g>2;){switch(s[p]){case 106:t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=h,a.segmentAudioCodec="ac3");break}const x=s[p+1]+2;p+=x,g-=x}}break;case 194:case 135:return fw(i,new Error("Unsupported EC-3 in M2TS found"),void 0,r),a;case 36:a.videoPid===-1&&(a.videoPid=h,a.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=f+5}return a}function fw(s,e,t,n){n.warn(`parsing error: ${e.message}`),s.emit(Y.ERROR,Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function S1(s,e){e.log(`${s} with AES-128-CBC encryption found in unencrypted stream`)}function Cg(s,e){let t=0,n,i,r,a,o;const l=s.data;if(!s||s.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=xl(l[0],l[1]),l.splice(1,1);if(n=l[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(i=(n[4]<<8)+n[5],i&&i>s.size-6)return null;const h=n[7];h&192&&(a=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,h&64?(o=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),r=n[8];let f=r+9;if(s.size<=f)return null;s.size-=f;const p=new Uint8Array(s.size);for(let g=0,y=l.length;g<y;g++){n=l[g];let x=n.byteLength;if(f)if(f>x){f-=x;continue}else n=n.subarray(f),x-=f,f=0;p.set(n,t),t+=x}return i&&(i-=r+3),{data:p,pts:a,dts:o,len:i}}return null}class W6{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Rf=Math.pow(2,32)-1;class ke{static init(){ke.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in ke.types)ke.types.hasOwnProperty(e)&&(ke.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);ke.HDLR_TYPES={video:t,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);ke.STTS=ke.STSC=ke.STCO=r,ke.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),ke.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),ke.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),ke.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);ke.FTYP=ke.box(ke.types.ftyp,a,l,a,o),ke.DINF=ke.box(ke.types.dinf,ke.box(ke.types.dref,i))}static box(e,...t){let n=8,i=t.length;const r=i;for(;i--;)n+=t[i].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(e,4),i=0,n=8;i<r;i++)a.set(t[i],n),n+=t[i].byteLength;return a}static hdlr(e){return ke.box(ke.types.hdlr,ke.HDLR_TYPES[e])}static mdat(e){return ke.box(ke.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Rf+1)),i=Math.floor(t%(Rf+1));return ke.box(ke.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return ke.box(ke.types.mdia,ke.mdhd(e.timescale||0,e.duration||0),ke.hdlr(e.type),ke.minf(e))}static mfhd(e){return ke.box(ke.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?ke.box(ke.types.minf,ke.box(ke.types.smhd,ke.SMHD),ke.DINF,ke.stbl(e)):ke.box(ke.types.minf,ke.box(ke.types.vmhd,ke.VMHD),ke.DINF,ke.stbl(e))}static moof(e,t,n){return ke.box(ke.types.moof,ke.mfhd(e),ke.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=ke.trak(e[t]);return ke.box.apply(null,[ke.types.moov,ke.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(ke.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=ke.trex(e[t]);return ke.box.apply(null,[ke.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Rf+1)),i=Math.floor(t%(Rf+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return ke.box(ke.types.mvhd,r)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return ke.box(ke.types.sdtp,n)}static stbl(e){return ke.box(ke.types.stbl,ke.stsd(e),ke.box(ke.types.stts,ke.STTS),ke.box(ke.types.stsc,ke.STSC),ke.box(ke.types.stsz,ke.STSZ),ke.box(ke.types.stco,ke.STCO))}static avc1(e){let t=[],n=[],i,r,a;for(i=0;i<e.sps.length;i++)r=e.sps[i],a=r.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(r));for(i=0;i<e.pps.length;i++)r=e.pps[i],a=r.byteLength,n.push(a>>>8&255),n.push(a&255),n=n.concat(Array.prototype.slice.call(r));const o=ke.box(ke.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),l=e.width,c=e.height,h=e.pixelRatio[0],f=e.pixelRatio[1];return ke.box(ke.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,ke.box(ke.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),ke.box(ke.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,f>>24,f>>16&255,f>>8&255,f&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return ke.box(ke.types.mp4a,ke.audioStsd(e),ke.box(ke.types.esds,ke.esds(e)))}static mp3(e){return ke.box(ke.types[".mp3"],ke.audioStsd(e))}static ac3(e){return ke.box(ke.types["ac-3"],ke.audioStsd(e),ke.box(ke.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return ke.box(ke.types.stsd,ke.STSD,ke.mp4a(e));if(t==="ac3"&&e.config)return ke.box(ke.types.stsd,ke.STSD,ke.ac3(e));if(t==="mp3"&&e.codec==="mp3")return ke.box(ke.types.stsd,ke.STSD,ke.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return ke.box(ke.types.stsd,ke.STSD,ke.avc1(e));if(t==="hevc"&&e.vps)return ke.box(ke.types.stsd,ke.STSD,ke.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),i=e.width||0,r=e.height||0,a=Math.floor(n/(Rf+1)),o=Math.floor(n%(Rf+1));return ke.box(ke.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const n=ke.sdtp(e),i=e.id,r=Math.floor(t/(Rf+1)),a=Math.floor(t%(Rf+1));return ke.box(ke.types.traf,ke.box(ke.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),ke.box(ke.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,a>>24,a>>16&255,a>>8&255,a&255])),ke.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,ke.box(ke.types.trak,ke.tkhd(e),ke.mdia(e))}static trex(e){const t=e.id;return ke.box(ke.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],i=n.length,r=12+16*i,a=new Uint8Array(r);let o,l,c,h,f,p;for(t+=8+r,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<i;o++)l=n[o],c=l.duration,h=l.size,f=l.flags,p=l.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,f.degradPrio&61440,f.degradPrio&15,p>>>24&255,p>>>16&255,p>>>8&255,p&255],12+16*o);return ke.box(ke.types.trun,a)}static initSegment(e){ke.types||ke.init();const t=ke.moov(e);return xl(ke.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],i=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let a=r.length;for(let y=0;y<n.length;y+=1){a+=3;for(let x=0;x<n[y].length;x+=1)a+=2+n[y][x].length}const o=new Uint8Array(a);o.set(r,0),a=r.length;const l=n.length-1;for(let y=0;y<n.length;y+=1){o.set(new Uint8Array([32+y|(y===l?128:0),0,n[y].length]),a),a+=3;for(let x=0;x<n[y].length;x+=1)o.set(new Uint8Array([n[y][x].length>>8,n[y][x].length&255]),a),a+=2,o.set(n[y][x],a),a+=n[y][x].length}const c=ke.box(ke.types.hvcC,o),h=e.width,f=e.height,p=e.pixelRatio[0],g=e.pixelRatio[1];return ke.box(ke.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,ke.box(ke.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),ke.box(ke.types.pasp,new Uint8Array([p>>24,p>>16&255,p>>8&255,p&255,g>>24,g>>16&255,g>>8&255,g&255])))}}ke.types=void 0;ke.HDLR_TYPES=void 0;ke.STTS=void 0;ke.STSC=void 0;ke.STCO=void 0;ke.STSZ=void 0;ke.VMHD=void 0;ke.SMHD=void 0;ke.STSD=void 0;ke.FTYP=void 0;ke.DINF=void 0;const s3=9e4;function $R(s,e,t=1,n=!1){const i=s*e*t;return n?Math.round(i):i}function $6(s,e,t=1,n=!1){return $R(s,e,1/t,n)}function Ry(s,e=!1){return $R(s,1e3,1/s3,e)}function J6(s,e=1){return $R(s,s3,1/e)}const Z6=10*1e3,e9=1024,t9=1152,n9=1536;let Ig=null,b1=null;function y2(s,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:s?2:1,isNonSync:s?0:1}}}class HS extends Sl{constructor(e,t,n,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Ig===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ig=a?parseInt(a[1]):0}if(b1===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);b1=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,i=e.reduce((r,a)=>{let o=a.pts,l=o-r;return l<-4294967296&&(t=!0,o=pl(o,n),l=o-r),l>0?r:o},n);return t&&this.debug("PTS rollover detected"),i}remux(e,t,n,i,r,a,o,l){let c,h,f,p,g,y,x=r,E=r;const _=e.pid>-1,b=t.pid>-1,C=t.samples.length,I=e.samples.length>0,M=o&&C>0||C>1;if((!_||I)&&(!b||M)||this.ISGenerated||o){if(this.ISGenerated){var D,P,L,O;const z=this.videoTrackConfig;(z&&(t.width!==z.width||t.height!==z.height||((D=t.pixelRatio)==null?void 0:D[0])!==((P=z.pixelRatio)==null?void 0:P[0])||((L=t.pixelRatio)==null?void 0:L[1])!==((O=z.pixelRatio)==null?void 0:O[1]))||!z&&M||this.nextAudioTs===null&&I)&&this.resetInitSegment()}this.ISGenerated||(f=this.generateIS(e,t,r,a));const U=this.isVideoContiguous;let j=-1,H;if(M&&(j=i9(t.samples),!U&&this.config.forceKeyFrameOnDiscontinuity))if(y=!0,j>0){this.warn(`Dropped ${j} out of ${C} video samples due to a missing keyframe`);const z=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(j),t.dropped+=j,E+=(t.samples[0].pts-z)/t.inputTimeScale,H=E}else j===-1&&(this.warn(`No keyframe found out of ${C} video samples`),y=!1);if(this.ISGenerated){if(I&&M){const z=this.getVideoStartPts(t.samples),k=(pl(e.samples[0].pts,z)-z)/t.inputTimeScale;x+=Math.max(0,k),E+=Math.max(0,-k)}if(I){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),f=this.generateIS(e,t,r,a)),h=this.remuxAudio(e,x,this.isAudioContiguous,a,b||M||l===jt.AUDIO?E:void 0),M){const z=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),f=this.generateIS(e,t,r,a)),c=this.remuxVideo(t,E,U,z)}}else M&&(c=this.remuxVideo(t,E,U,0));c&&(c.firstKeyFrame=j,c.independent=j!==-1,c.firstKeyFramePTS=H)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(g=r3(n,r,this._initPTS,this._initDTS)),i.samples.length&&(p=a3(i,r,this._initPTS))),{audio:h,video:c,initSegment:f,independent:y,text:p,id3:g}}generateIS(e,t,n,i){const r=e.samples,a=t.samples,o=this.typeSupported,l={},c=this._initPTS;let h=!c||i,f="audio/mp4",p,g,y,x=-1;if(h&&(p=g=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(f="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:f,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):ke.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(x=e.id,y=e.inputTimeScale,!c||y!==c.timescale?p=g=r[0].pts-Math.round(y*n):h=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:ke.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(x=t.id,y=t.inputTimeScale,!c||y!==c.timescale){const E=this.getVideoStartPts(a),_=Math.round(y*n);g=Math.min(g,pl(a[0].dts,E)-_),p=Math.min(p,E-_)}else h=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,h?(c&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${n} ${p/y} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${p/y} (${p}/${y}) trackId: ${x}`),this._initPTS={baseTime:p,timescale:y,trackId:x},this._initDTS={baseTime:g,timescale:y,trackId:x}):p=y=void 0,{tracks:l,initPTS:p,timescale:y,trackId:x}}remuxVideo(e,t,n,i){const r=e.inputTimeScale,a=e.samples,o=[],l=a.length,c=this._initPTS,h=c.baseTime*r/c.timescale;let f=this.nextVideoTs,p=8,g=this.videoSampleDuration,y,x,E=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,b=!1;if(!n||f===null){const te=h+t*r,oe=a[0].pts-pl(a[0].dts,a[0].pts);Ig&&f!==null&&Math.abs(te-oe-(f+h))<15e3?n=!0:f=te-oe-h}const C=f+h;for(let te=0;te<l;te++){const oe=a[te];oe.pts=pl(oe.pts,C),oe.dts=pl(oe.dts,C),oe.dts<a[te>0?te-1:te].dts&&(b=!0)}b&&a.sort(function(te,oe){const Ee=te.dts-oe.dts,Ce=te.pts-oe.pts;return Ee||Ce}),y=a[0].dts,x=a[a.length-1].dts;const I=x-y,M=I?Math.round(I/(l-1)):g||e.inputTimeScale/30;if(n){const te=y-C,oe=te>M,Ee=te<-1;if((oe||Ee)&&(oe?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ry(te,!0)} ms (${te}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ry(-te,!0)} ms (${te}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!Ee||C>=a[0].pts||Ig)){y=C;const Ce=a[0].pts-te;if(oe)a[0].dts=y,a[0].pts=Ce;else{let se=!0;for(let ie=0;ie<a.length&&!(a[ie].dts>Ce&&se);ie++){const ne=a[ie].pts;if(a[ie].dts-=te,a[ie].pts-=te,ie<a.length-1){const re=a[ie+1].pts,Be=a[ie].pts,Ge=re<=Be,Ue=re<=ne;se=Ge==Ue}}}this.log(`Video: Initial PTS/DTS adjusted: ${Ry(Ce,!0)}/${Ry(y,!0)}, delta: ${Ry(te,!0)} ms`)}}y=Math.max(0,y);let R=0,D=0,P=y;for(let te=0;te<l;te++){const oe=a[te],Ee=oe.units,Ce=Ee.length;let se=0;for(let ie=0;ie<Ce;ie++)se+=Ee[ie].data.length;D+=se,R+=Ce,oe.length=se,oe.dts<P?(oe.dts=P,P+=M/4|0||1):P=oe.dts,E=Math.min(oe.pts,E),_=Math.max(oe.pts,_)}x=a[l-1].dts;const L=D+4*R+8;let O;try{O=new Uint8Array(L)}catch(te){this.observer.emit(Y.ERROR,Y.ERROR,{type:Wt.MUX_ERROR,details:He.REMUX_ALLOC_ERROR,fatal:!1,error:te,bytes:L,reason:`fail allocating video mdat ${L}`});return}const U=new DataView(O.buffer);U.setUint32(0,L),O.set(ke.types.mdat,4);let j=!1,H=Number.POSITIVE_INFINITY,z=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let te=0;te<l;te++){const oe=a[te],Ee=oe.units;let Ce=0;for(let ne=0,re=Ee.length;ne<re;ne++){const Be=Ee[ne],Ge=Be.data,Ue=Be.data.byteLength;U.setUint32(p,Ue),p+=4,O.set(Ge,p),p+=Ue,Ce+=4+Ue}let se;if(te<l-1)g=a[te+1].dts-oe.dts,se=a[te+1].pts-oe.pts;else{const ne=this.config,re=te>0?oe.dts-a[te-1].dts:M;if(se=te>0?oe.pts-a[te-1].pts:M,ne.stretchShortVideoTrack&&this.nextAudioTs!==null){const Be=Math.floor(ne.maxBufferHole*r),Ge=(i?E+i*r:this.nextAudioTs+h)-oe.pts;Ge>Be?(g=Ge-re,g<0?g=re:j=!0,this.log(`It is approximately ${Ge/90} ms to the next segment; using duration ${g/90} ms for the last video frame.`)):g=re}else g=re}const ie=Math.round(oe.pts-oe.dts);H=Math.min(H,g),q=Math.max(q,g),z=Math.min(z,se),k=Math.max(k,se),o.push(y2(oe.key,g,Ce,ie))}if(o.length){if(Ig){if(Ig<70){const te=o[0].flags;te.dependsOn=2,te.isNonSync=0}}else if(b1&&k-z<q-H&&M/q<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let te=y;for(let oe=0,Ee=o.length;oe<Ee;oe++){const Ce=te+o[oe].duration,se=te+o[oe].cts;if(oe<Ee-1){const ie=Ce+o[oe+1].cts;o[oe].duration=ie-se}else o[oe].duration=oe?o[oe-1].duration:M;o[oe].cts=0,te=Ce}}}g=j||!g?M:g;const W=x+g;this.nextVideoTs=f=W-h,this.videoSampleDuration=g,this.isVideoContiguous=!0;const K={data1:ke.moof(e.sequenceNumber++,y,Li(e,{samples:o})),data2:O,startPTS:(E-h)/r,endPTS:(_+g-h)/r,startDTS:(y-h)/r,endDTS:f/r,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,K}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return t9;case"ac3":return n9;default:return e9}}remuxAudio(e,t,n,i,r){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,c=this.getSamplesPerFrame(e),h=c*l,f=this._initPTS,p=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,g=[],y=r!==void 0;let x=e.samples,E=p?0:8,_=this.nextAudioTs||-1;const b=f.baseTime*a/f.timescale,C=b+t*a;if(this.isAudioContiguous=n=n||x.length&&_>0&&(i&&Math.abs(C-(_+b))<9e3||Math.abs(pl(x[0].pts,C)-(_+b))<20*h),x.forEach(function(k){k.pts=pl(k.pts,C)}),!n||_<0){if(x=x.filter(k=>k.pts>=0),!x.length)return;r===0?_=0:i&&!y?_=Math.max(0,C-b):_=x[0].pts-b}if(e.segmentCodec==="aac"){const k=this.config.maxAudioFramesDrift;for(let W=0,V=_+b;W<x.length;W++){const X=x[W],K=X.pts,te=K-V,oe=Math.abs(1e3*te/a);if(te<=-k*h&&y)W===0&&(this.warn(`Audio frame @ ${(K/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*te/a)} ms.`),this.nextAudioTs=_=K-b,V=K);else if(te>=k*h&&oe<Z6&&y){let Ee=Math.round(te/h);for(V=K-Ee*h;V<0&&Ee&&h;)Ee--,V+=h;W===0&&(this.nextAudioTs=_=V-b),this.warn(`Injecting ${Ee} audio frames @ ${((V-b)/a).toFixed(3)}s due to ${Math.round(1e3*te/a)} ms gap.`);for(let Ce=0;Ce<Ee;Ce++){let se=W6.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);se||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),se=X.unit.subarray()),x.splice(W,0,{unit:se,pts:V}),V+=h,W++}}X.pts=V,V+=h}}let I=null,M=null,R,D=0,P=x.length;for(;P--;)D+=x[P].unit.byteLength;for(let k=0,W=x.length;k<W;k++){const V=x[k],X=V.unit;let K=V.pts;if(M!==null){const oe=g[k-1];oe.duration=Math.round((K-M)/l)}else if(n&&e.segmentCodec==="aac"&&(K=_+b),I=K,D>0){D+=E;try{R=new Uint8Array(D)}catch(oe){this.observer.emit(Y.ERROR,Y.ERROR,{type:Wt.MUX_ERROR,details:He.REMUX_ALLOC_ERROR,fatal:!1,error:oe,bytes:D,reason:`fail allocating audio mdat ${D}`});return}p||(new DataView(R.buffer).setUint32(0,D),R.set(ke.types.mdat,4))}else return;R.set(X,E);const te=X.byteLength;E+=te,g.push(y2(!0,c,te,0)),M=K}const L=g.length;if(!L)return;const O=g[g.length-1];_=M-b,this.nextAudioTs=_+l*O.duration;const U=p?new Uint8Array(0):ke.moof(e.sequenceNumber++,I/l,Li({},e,{samples:g}));e.samples=[];const j=(I-b)/a,H=_/a,q={data1:U,data2:R,startPTS:j,endPTS:H,startDTS:j,endDTS:H,type:"audio",hasAudio:!0,hasVideo:!1,nb:L};return this.isAudioContiguous=!0,q}}function pl(s,e){let t;if(e===null)return s;for(e<s?t=-8589934592:t=8589934592;Math.abs(s-e)>4294967296;)s+=t;return s}function i9(s){for(let e=0;e<s.length;e++)if(s[e].key)return e;return-1}function r3(s,e,t,n){const i=s.samples.length;if(!i)return;const r=s.inputTimeScale;for(let o=0;o<i;o++){const l=s.samples[o];l.pts=pl(l.pts-t.baseTime*r/t.timescale,e*r)/r,l.dts=pl(l.dts-n.baseTime*r/n.timescale,e*r)/r}const a=s.samples;return s.samples=[],{samples:a}}function a3(s,e,t){const n=s.samples.length;if(!n)return;const i=s.inputTimeScale;for(let a=0;a<n;a++){const o=s.samples[a];o.pts=pl(o.pts-t.baseTime*i/t.timescale,e*i)/i}s.samples.sort((a,o)=>a.pts-o.pts);const r=s.samples;return s.samples=[],{samples:r}}class s9 extends Sl{constructor(e,t,n,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:r,video:a}=this.initData=AU(e);if(t)q5(e,t);else{const l=r||a;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}r&&(n=v2(r,Gi.AUDIO,this)),a&&(i=v2(a,Gi.VIDEO,this));const o={};r&&a?o.audiovideo={container:"video/mp4",codec:n+","+i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:r?o.audio={container:"audio/mp4",codec:n,encrypted:r.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,n,i,r,a){var o,l;let{initPTS:c,lastEndTime:h}=this;const f={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};Ft(h)||(h=this.lastEndTime=r||0);const p=t.samples;if(!p.length)return f;const g={initPTS:void 0,timescale:void 0,trackId:void 0};let y=this.initData;if((o=y)!=null&&o.length||(this.generateInitSegment(p),y=this.initData),!((l=y)!=null&&l.length))return this.warn("Failed to generate initSegment."),f;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1);const x=K5(p,y,this),E=y.audio?x[y.audio.id]:null,_=y.video?x[y.video.id]:null,b=E_(_,1/0),C=E_(E,1/0),I=E_(_,0,!0),M=E_(E,0,!0);let R=r,D=0;const P=E&&(!_||!c&&C<b||c&&c.trackId===y.audio.id),L=P?E:_;if(L){const V=L.timescale,X=L.start-r*V,K=P?y.audio.id:y.video.id;R=L.start/V,D=P?M-C:I-b,(a||!c)&&(r9(c,R,r,D)||V!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${r} ${X/V} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${R-r} (${X}/${V}) trackId: ${K}`),c=null,g.initPTS=X,g.timescale=V,g.trackId=K)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);c?(g.initPTS=c.baseTime,g.timescale=c.timescale,g.trackId=c.trackId):((!g.timescale||g.trackId===void 0||g.initPTS===void 0)&&(this.warn("Could not set initPTS"),g.initPTS=R,g.timescale=1,g.trackId=-1),this.initPTS=c={baseTime:g.initPTS,timescale:g.timescale,trackId:g.trackId});const O=R-c.baseTime/c.timescale,U=O+D;D>0?this.lastEndTime=U:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const j=!!y.audio,H=!!y.video;let z="";j&&(z+="audio"),H&&(z+="video");const q=(y.audio?y.audio.encrypted:!1)||(y.video?y.video.encrypted:!1),k={data1:p,startPTS:O,startDTS:O,endPTS:U,endDTS:U,type:z,hasAudio:j,hasVideo:H,nb:1,dropped:0,encrypted:q};f.audio=j&&!H?k:void 0,f.video=H?k:void 0;const W=_?.sampleCount;if(W){const V=_.keyFrameIndex,X=V!==-1;k.nb=W,k.dropped=V===0||this.isVideoContiguous?0:X?V:W,k.independent=X,k.firstKeyFrame=V,X&&_.keyFrameStart&&(k.firstKeyFramePTS=(_.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(f.independent=X),this.isVideoContiguous||(this.isVideoContiguous=X),k.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${V}/${W} dropped: ${k.dropped} start: ${k.firstKeyFramePTS||"NA"}`)}return f.initSegment=g,f.id3=r3(n,r,c,c),i.samples.length&&(f.text=a3(i,r,c)),f}}function E_(s,e,t=!1){return s?.start!==void 0?(s.start+(t?s.duration:0))/s.timescale:e}function r9(s,e,t,n){if(s===null)return!0;const i=Math.max(n,1),r=e-s.baseTime/s.timescale;return Math.abs(r-t)>i}function v2(s,e,t){const n=s.codec;return n&&n.length>4?n:e===Gi.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?fb(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let Ah;try{Ah=self.performance.now.bind(self.performance)}catch{Ah=Date.now}const zS=[{demux:V6,remux:s9},{demux:jf,remux:HS},{demux:G6,remux:HS},{demux:z6,remux:HS}];zS.splice(2,0,{demux:H6,remux:HS});class E2{constructor(e,t,n,i,r,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=r,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){const r=n.transmuxing;r.executeStart=Ah();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;i&&(this.currentTransmuxState=i);const{contiguous:c,discontinuity:h,trackSwitch:f,accurateTimeOffset:p,timeOffset:g,initSegmentChange:y}=i||o,{audioCodec:x,videoCodec:E,defaultInitPts:_,duration:b,initSegmentData:C}=l,I=a9(a,t);if(I&&dA(I.method)){const P=this.getDecrypter(),L=zR(I.method);if(P.isSync()){let O=P.softwareDecrypt(a,I.key.buffer,I.iv.buffer,L);if(n.part>-1){const j=P.flush();O=j&&j.buffer}if(!O)return r.executeEnd=Ah(),T1(n);a=new Uint8Array(O)}else return this.asyncResult=!0,this.decryptionPromise=P.webCryptoDecrypt(a,I.key.buffer,I.iv.buffer,L).then(O=>{const U=this.push(O,null,n);return this.decryptionPromise=null,U}),this.decryptionPromise}const M=this.needsProbing(h,f);if(M){const P=this.configureTransmuxer(a);if(P)return this.logger.warn(`[transmuxer] ${P.message}`),this.observer.emit(Y.ERROR,Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.FRAG_PARSING_ERROR,fatal:!1,error:P,reason:P.message}),r.executeEnd=Ah(),T1(n)}(h||f||y||M)&&this.resetInitSegment(C,x,E,b,t),(h||y||M)&&this.resetInitialTimestamp(_),c||this.resetContiguity();const R=this.transmux(a,I,g,p,n);this.asyncResult=Bv(R);const D=this.currentTransmuxState;return D.contiguous=!0,D.discontinuity=!1,D.trackSwitch=!1,r.executeEnd=Ah(),R}flush(e){const t=e.transmuxing;t.executeStart=Ah();const{decrypter:n,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const a=[],{timeOffset:o}=i;if(n){const f=n.flush();f&&a.push(this.push(f.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=Ah();const f=[T1(e)];return this.asyncResult?Promise.resolve(f):f}const h=l.flush(o);return Bv(h)?(this.asyncResult=!0,h.then(f=>(this.flushRemux(a,f,e),a))):(this.flushRemux(a,h,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,n){const{audioTrack:i,videoTrack:r,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===jt.MAIN?"level":"track"} ${n.level}`);const h=this.remuxer.remux(i,r,a,o,c,l,!0,this.id);e.push({remuxResult:h,chunkMeta:n}),n.transmuxing.executeEnd=Ah()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,r){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,n,i),o.resetInitSegment(e,t,n,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,r){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,n,i,r):a=this.transmuxUnencrypted(e,n,i,r),a}transmuxUnencrypted(e,t,n,i){const{audioTrack:r,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,a,o,l,t,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,n,i,r){return this.demuxer.demuxSampleAes(e,t,n).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,n,i,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:i}=this;let r;for(let f=0,p=zS.length;f<p;f++){var a;if((a=zS[f].demux)!=null&&a.probe(e,this.logger)){r=zS[f];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,c=r.remux,h=r.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(n,t,i,this.logger)),(!o||!(o instanceof h))&&(this.demuxer=new h(n,t,i,this.logger),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new GR(this.config)),e}}function a9(s,e){let t=null;return s.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const T1=s=>({remuxResult:{},chunkMeta:s});function Bv(s){return"then"in s&&s.then instanceof Function}class o9{constructor(e,t,n,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=r||null}}class l9{constructor(e,t,n,i,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=a}}let x2=0;class o3{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=x2++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,h=this.hls;if(!(!h||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var f;const p=(f=this.workerContext)==null?void 0:f.objectURL;p&&self.URL.revokeObjectURL(p);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{h.logger[c.data.logType]&&h.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,h.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(Y.ERROR,{type:Wt.OTHER_ERROR,details:He.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const a=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===Y.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new jR,this.observer.on(Y.FRAG_DECRYPTED,a),this.observer.on(Y.ERROR,a);const o=UL(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(r.workerPath||f6()){try{r.workerPath?(l.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=p6(r.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=d6());const{worker:h}=this.workerContext;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:Wi(r)})}catch(h){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,h),this.terminateWorker(),this.error=null,this.transmuxer=new E2(this.observer,o,r,"",t,e.logger)}return}}this.transmuxer=new E2(this.observer,o,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=x2++;const t=this.hls.config,n=UL(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:Wi(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),m6(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,i,r,a,o,l,c,h){var f,p;c.transmuxing.start=self.performance.now();const{instanceNo:g,transmuxer:y}=this,x=a?a.start:r.start,E=r.decryptdata,_=this.frag,b=!(_&&r.cc===_.cc),C=!(_&&c.level===_.level),I=_?c.sn-_.sn:-1,M=this.part?c.part-this.part.index:-1,R=I===0&&c.id>1&&c.id===_?.stats.chunkCount,D=!C&&(I===1||I===0&&(M===1||R&&M<=0)),P=self.performance.now();(C||I||r.stats.parsing.start===0)&&(r.stats.parsing.start=P),a&&(M||!D)&&(a.stats.parsing.start=P);const L=!(_&&((f=r.initSegment)==null?void 0:f.url)===((p=_.initSegment)==null?void 0:p.url)),O=new l9(b,D,l,C,x,L);if(!D||b||L){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===jt.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${b}
        trackSwitch: ${C}
        contiguous: ${D}
        accurateTimeOffset: ${l}
        timeOffset: ${x}
        initSegmentChange: ${L}`);const U=new o9(n,i,t,o,h);this.configureTransmuxer(U)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:g,cmd:"demux",data:e,decryptdata:E,chunkMeta:c,state:O},e instanceof ArrayBuffer?[e]:[]);else if(y){const U=y.push(e,E,c,O);Bv(U)?U.then(j=>{this.handleTransmuxComplete(j)}).catch(j=>{this.transmuxerError(j,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(U)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const i=n.flush(e);Bv(i)?i.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const _2=100;class c9 extends VR{constructor(e,t,n){super(e,t,n,"audio-stream-controller",jt.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(Y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Y.BUFFER_RESET,this.onBufferReset,this),e.on(Y.BUFFER_CREATED,this.onBufferCreated,this),e.on(Y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Y.FRAG_LOADING,this.onFragLoading,this),e.on(Y.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(Y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(Y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Y.BUFFER_RESET,this.onBufferReset,this),e.off(Y.BUFFER_CREATED,this.onBufferCreated,this),e.off(Y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Y.FRAG_LOADING,this.onFragLoading,this),e.off(Y.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:r,trackId:a}){if(n===jt.MAIN){const o=t.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:i,timescale:r,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${i/r} (${i}/${r}) trackId: ${a}`),this.mainAnchor=t,this.state===ut.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==o)&&this.syncWithAnchor(t,c?.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===ut.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const i=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&i?.cc===t.cc)return;const r=(i||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=IU(a,r,o);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===ut.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ut.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(_2),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=ut.IDLE):this.state=ut.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ut.IDLE:this.doTickIdle();break;case ut.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e?.[t],i=n?.details;if(i&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(i))break;this.state=ut.WAITING_INIT_PTS}break}case ut.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ut.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:i,complete:r}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ut.FRAG_LOADING;const o=i.flush().buffer,l={frag:t,part:n,payload:o,networkDetails:null};this._handleFragmentLoadProgress(l),r&&super._handleFragmentLoadComplete(l)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=ut.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:i,trackId:r}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(n!=null&&n[r]))return;const o=n[r],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=ut.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,Gi.AUDIO,jt.AUDIO));const h=this.getFwdBufferInfo(c,jt.AUDIO);if(h===null)return;if(!this.switchingTrack&&this._streamEnded(h,l)){t.trigger(Y.BUFFER_EOS,{type:"audio"}),this.state=ut.ENDED;return}const f=h.len,p=t.maxBufferLength,g=l.fragments,y=g[0].start,x=this.getLoadPosition(),E=this.flushing?x:h.end;if(this.switchingTrack&&i){const C=x;l.PTSKnown&&C<y&&(h.end>y||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=y+.05)}if(f>=p&&!this.switchingTrack&&E<g[g.length-1].start)return;let _=this.getNextFragment(E,l);if(_&&this.isLoopLoading(_,E)&&(_=this.getNextFragmentLoopLoading(_,l,h,jt.MAIN,p)),!_){this.bufferFlushed=!0;return}let b=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&b&&Ks(_)&&!_.endList&&(!l.live||!this.loadingParts&&E<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(b)===ur.OK&&(this.mainFragLoading=b=null),b&&Ks(b))){if(_.start>b.end){const I=this.fragmentTracker.getFragAtPos(E,jt.MAIN);I&&I.end>b.end&&(b=I,this.mainFragLoading={frag:I,targetBufferTime:null})}if(_.start>b.end)return}this.loadFragment(_,o,E)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new Mv(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ut.STOPPED&&(this.setInterval(_2),this.state=ut.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(Y.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:i}=this,{details:r,id:a,groupId:o,track:l}=t;if(!i){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const c=this.mainDetails;if(!c||r.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==ut.STOPPED&&(this.state=ut.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const h=i[a];let f=0;if(r.live||(n=h.details)!=null&&n.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(h.details){var p;f=this.alignPlaylists(r,h.details,(p=this.levelLastLoaded)==null?void 0:p.details)}r.alignedSliding||(HU(r,c),r.alignedSliding||yb(r,c),f=r.fragmentStart)}h.details=r,this.levelLastLoaded=h,this.startFragRequested||this.setStartPosition(c,f),this.hls.trigger(Y.AUDIO_TRACK_UPDATED,{details:r,id:a,groupId:t.groupId}),this.state===ut.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=ut.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:r}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=l[o];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const h=c.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const f=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let p=this.transmuxer;p||(p=this.transmuxer=new o3(this.hls,jt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const g=this.initPTS[n.cc],y=(t=n.initSegment)==null?void 0:t.data;if(g!==void 0){const E=i?i.index:-1,_=E!==-1,b=new HR(n.level,n.sn,n.stats.chunkCount,r.byteLength,E,_);p.push(r,y,f,"",n,i,h.totalduration,!1,b,g)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${h.startSN} ,${h.endSN}],track ${o}`);const{cache:x}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new zU,complete:!1};x.push(new Uint8Array(r)),this.state!==ut.STOPPED&&(this.state=ut.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===jt.MAIN&&Ks(t.frag)&&(this.mainFragLoading=t,this.state===ut.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n.type!==jt.AUDIO){!this.audioOnly&&n.type===jt.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ks(n)){this.fragPrevious=n;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(Y.AUDIO_TRACK_SWITCHED,Di({},r)))}this.fragBufferedComplete(n,i),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=ut.ERROR;return}switch(t.details){case He.FRAG_GAP:case He.FRAG_PARSING_ERROR:case He.FRAG_DECRYPT_ERROR:case He.FRAG_LOAD_ERROR:case He.FRAG_LOAD_TIMEOUT:case He.KEY_LOAD_ERROR:case He.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(jt.AUDIO,t);break;case He.AUDIO_TRACK_LOAD_ERROR:case He.AUDIO_TRACK_LOAD_TIMEOUT:case He.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ut.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===Hn.AUDIO_TRACK&&(this.state=ut.IDLE);break;case He.BUFFER_ADD_CODEC_ERROR:case He.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case He.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case He.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Gi.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Gi.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ut.ENDED&&(this.state=ut.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,jt.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:c,level:h}=o,{details:f}=h,{audio:p,text:g,id3:y,initSegment:x}=r;if(this.fragContextChanged(l)||!f){this.fragmentTracker.removeFragment(l);return}if(this.state=ut.PARSING,this.switchingTrack&&p&&this.completeAudioSwitch(this.switchingTrack),x!=null&&x.tracks){const E=l.initSegment||l;if(this.unhandledEncryptionError(x,l))return;this._bufferInitSegment(h,x.tracks,E,a),i.trigger(Y.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:n,tracks:x.tracks})}if(p){const{startPTS:E,endPTS:_,startDTS:b,endDTS:C}=p;c&&(c.elementaryStreams[Gi.AUDIO]={startPTS:E,endPTS:_,startDTS:b,endDTS:C}),l.setElementaryStreamInfo(Gi.AUDIO,E,_,b,C),this.bufferFragmentData(p,l,c,a)}if(y!=null&&(t=y.samples)!=null&&t.length){const E=Li({id:n,frag:l,details:f},y);i.trigger(Y.FRAG_PARSING_METADATA,E)}if(g){const E=Li({id:n,frag:l,details:f},g);i.trigger(Y.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(e,t,n,i){if(this.state!==ut.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=jt.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${a}/${r.codec}]`),a&&a.split(",").length===1&&(r.levelCodec=a),this.hls.trigger(Y.BUFFER_CODECS,t);const o=r.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:o};this.hls.trigger(Y.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===ur.NOT_LOADED||i===ur.PARTIAL){var r;if(!Ks(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ut.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&yb(t.details,a)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:i,characteristics:r,audioCodec:a,channels:o}=this.bufferedTrack;tm({name:t,lang:n,assocLang:i,characteristics:r,audioCodec:a,channels:o},e,Fp)||(pb(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(Y.AUDIO_TRACK_SWITCHED,Di({},e))}}class JR extends Sl{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const i=t?.renditionReports;if(i){let r=-1;for(let a=0;a<i.length;a++){const o=i[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=o.URI||""}if(l===e){r=a;break}else l===e.substring(0,l.length)&&(r=a)}if(r!==-1){const a=i[r],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let l=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const h=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&h>t.partTarget&&(l+=1)}const c=n&&kL(n);return new GL(o,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:i,stats:r}=t,a=self.performance.now(),o=r.loading.first?Math.max(0,a-r.loading.first):0;i.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==i.appliedTimelineOffset){const h=Math.max(l||0,0);i.appliedTimelineOffset=h,i.fragments.forEach(f=>{f.setStart(f.playlistOffset+h)})}if(i.live||n!=null&&n.live){const h="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(n),n&&i.fragments.length>0){t6(n,i,this);const b=i.playlistParsingError;if(b){this.warn(b);const C=this.hls;if(!C.config.ignorePlaylistParsingErrors){var c;const{networkDetails:I}=t;C.trigger(Y.ERROR,{type:Wt.NETWORK_ERROR,details:He.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:b,reason:b.message,level:t.level||void 0,parent:(c=i.fragments[0])==null?void 0:c.type,networkDetails:I,stats:r});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=r.loading.start);const f=this.hls.mainForwardBufferInfo,p=f?f.end-f.len:0,g=(i.edge-p)*1e3,y=NU(i,g);if(i.requestScheduled+y<a?i.requestScheduled=a:i.requestScheduled+=y,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let x,E,_;if(i.canBlockReload&&i.endSN&&i.advanced){const b=this.hls.config.lowLatencyMode,C=i.lastPartSn,I=i.endSN,M=i.lastPartIndex,R=M!==-1,D=C===I;R?D?(E=I+1,_=b?0:M):(E=C,_=b?M+1:i.maxPartIndex):E=I+1;const P=i.age,L=P+i.ageHeader;let O=Math.min(L-i.partTarget,i.targetduration*1.5);if(O>0){if(L>i.targetduration*3)this.log(`Playlist last advanced ${P.toFixed(2)}s ago. Omitting segment and part directives.`),E=void 0,_=void 0;else if(n!=null&&n.tuneInGoal&&L-i.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${O} with playlist age: ${i.age}`),O=0;else{const U=Math.floor(O/i.targetduration);if(E+=U,_!==void 0){const j=Math.round(O%i.targetduration/i.partTarget);_+=j}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${P.toFixed(2)}s goal: ${O} skip sn ${U} to part ${_}`)}i.tuneInGoal=O}if(x=this.getDeliveryDirectives(i,t.deliveryDirectives,E,_),b||!D){i.requestScheduled=a,this.loadingPlaylist(h,x);return}}else(i.canBlockReload||i.canSkipUntil)&&(x=this.getDeliveryDirectives(i,t.deliveryDirectives,E,_));x&&E!==void 0&&i.canBlockReload&&(i.requestScheduled=r.loading.first+Math.max(y-o*2,y/2)),this.scheduleLoading(h,x,i)}else this.clearTimer()}scheduleLoading(e,t,n){const i=n||e.details;if(!i){this.loadingPlaylist(e,t);return}const r=self.performance.now(),a=i.requestScheduled;if(r>=a){this.loadingPlaylist(e,t);return}const o=a-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,n,i){let r=kL(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,r=kS.No),new GL(n,i,r)}checkRetry(e){const t=e.details,n=mb(e),i=e.errorAction,{action:r,retryCount:a=0,retryConfig:o}=i||{},l=!!i&&!!o&&(r===Nr.RetryRequest||!i.resolved&&r===Nr.SendAlternateToPenaltyBox);if(l){var c;if(a>=o.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const h=kR(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${h}ms`)}e.levelRetry=!0,i.resolved=!0}return l}}function l3(s,e){if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(!Dv(s[t].attrs,e[t].attrs))return!1;return!0}function Dv(s,e,t){const n=s["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>s[i]!==e[i])}function dw(s,e){return e.label.toLowerCase()===s.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(s.lang||"").toLowerCase())}class u9 extends JR{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Y.LEVEL_LOADING,this.onLevelLoading,this),e.on(Y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Y.LEVEL_LOADING,this.onLevelLoading,this),e.off(Y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Y.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:i,details:r}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i){this.warn(`Audio track with id:${n} and group:${i} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||i?.length!==n?.length||n!=null&&n.some(o=>i?.indexOf(o)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(p=>!n||n.indexOf(p.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(p=>p.default)&&(this.selectDefaultTrack=!1),o.forEach((p,g)=>{p.id=g});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!r&&l){const p=pu(l,o,Fp);if(p>-1)r=o[p];else{const g=pu(l,this.tracks);r=this.tracks[g]}}let c=this.findTrackId(r);c===-1&&r&&(c=this.findTrackId(null));const h={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${n?.join(",")}`),this.hls.trigger(Y.AUDIO_TRACKS_UPDATED,h);const f=this.trackId;if(c!==-1&&f===-1)this.setAudioTrack(c);else if(o.length&&f===-1){var a;const p=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(p.message),this.hls.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}}onError(e,t){t.fatal||!t.context||t.context.type===Hn.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&tm(e,i,Fp))return i;const r=pu(e,this.tracksInGroup,Fp);if(r>-1){const a=this.tracksInGroup[r];return this.setAudioTrack(r),a}else if(i){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=EV(e,t.levels,n,a,Fp);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=pu(e,n);if(a>-1)return n[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===n&&r||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(Y.AUDIO_TRACK_SWITCHING,Di({},i)),r))return;const a=this.switchParams(i.url,n?.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(!(this.selectDefaultTrack&&!i.default)&&(!e||tm(e,i,Fp)))return n}if(e){const{name:n,lang:i,assocLang:r,characteristics:a,audioCodec:o,channels:l}=e;for(let c=0;c<t.length;c++){const h=t[c];if(tm({name:n,lang:i,assocLang:r,characteristics:a,audioCodec:o,channels:l},h,Fp))return c}for(let c=0;c<t.length;c++){const h=t[c];if(Dv(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const h=t[c];if(Dv(e.attrs,h.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&pb(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(Y.AUDIO_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:t||null,track:e})}}class h9{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(r){var n;if(i.onError(r),this.queues===null||this.tracks===null)return;const a=(n=this.tracks[e])==null?void 0:n.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],i=n?.buffer;return i?`SourceBuffer${i.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const S2=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,c3="HlsJsTrackRemovedError";class f9 extends Error{constructor(e){super(e),this.name=c3}}class d9 extends Sl{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:i,mediaSource:r}=this;n&&this.log("Media source opened"),!(!i||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(Y.MEDIA_ATTACHED,{media:i,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:i}=this;n!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=N5(od(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Y.BUFFER_RESET,this.onBufferReset,this),e.on(Y.BUFFER_APPENDING,this.onBufferAppending,this),e.on(Y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Y.BUFFER_EOS,this.onBufferEos,this),e.on(Y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Y.FRAG_PARSED,this.onFragParsed,this),e.on(Y.FRAG_CHANGED,this.onFragChanged,this),e.on(Y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Y.BUFFER_RESET,this.onBufferReset,this),e.off(Y.BUFFER_APPENDING,this.onBufferAppending,this),e.off(Y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Y.BUFFER_EOS,this.onBufferEos,this),e.off(Y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Y.FRAG_PARSED,this.onFragParsed,this),e.off(Y.FRAG_CHANGED,this.onFragChanged,this),e.off(Y.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const a=this.isQueued();(r||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?Li(n,i.tracks):this.sourceBuffers.forEach(r=>{const[a]=r;a&&(n[a]=Li({},this.tracks[a]),this.removeBuffer(a)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const i=od(this.appendSource);if(i){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),r)this._objectUrl=n.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{n.removeAttribute("src");const l=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||l&&a instanceof l,b2(n),p9(n,o),n.load()}catch{n.src=o}else n.src=o}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,i=t.tracks,r=i?Object.keys(i):null,a=r?r.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&r&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Wi(n,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${Wi(i,(l,c)=>l==="initSegment"?void 0:c)}}`),!uU(i,n)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,h=Math.max(l,c?.fragments[0].start||0);if(h-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${h}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(n)}") start time: ${h} currentTime: ${l}`),this.onMediaDetaching(Y.MEDIA_DETACHING,{}),this.onMediaAttaching(Y.MEDIA_ATTACHING,t),e.currentTime=h;return}this.transferData=void 0,r.forEach(l=>{const c=l,h=i[c];if(h){const f=h.buffer;if(f){const p=this.fragmentTracker,g=h.id;if(p.hasFragments(g)||p.hasParts(g)){const E=xn.getBuffered(f);p.detectEvictedFragments(c,E,g,null,!0)}const y=C1(c),x=[c,f];this.sourceBuffers[y]=x,f.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,h)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:r,_objectUrl:a}=this;if(r){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=r.readyState==="open";try{const l=r.sourceBuffers;for(let c=l.length;c--;)o&&l[c].abort(),r.removeSourceBuffer(l[c]);o&&r.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),n||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&b2(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(Y.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[C1(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new h9(this.tracks)}onBufferCodecs(e,t){const n=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const r="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),a=!r&&this.sourceBufferCount&&this.media&&i.some(o=>!n[o]);if(r||a){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${i}" SourceBuffers`);return}i.forEach(o=>{var l,c;const h=t[o],{id:f,codec:p,levelCodec:g,container:y,metadata:x,supplemental:E}=h;let _=n[o];const b=(l=this.transferData)==null||(l=l.tracks)==null?void 0:l[o],C=b!=null&&b.buffer?b:_,I=C?.pendingCodec||C?.codec,M=C?.levelCodec;_||(_=n[o]={buffer:void 0,listeners:[],codec:p,supplemental:E,container:y,levelCodec:g,metadata:x,id:f});const R=US(I,M),D=R?.replace(S2,"$1");let P=US(p,g);const L=(c=P)==null?void 0:c.replace(S2,"$1");P&&R&&D!==L&&(o.slice(0,5)==="audio"&&(P=fb(P,this.appendSource)),this.log(`switching codec ${I} to ${P}`),P!==(_.pendingCodec||_.codec)&&(_.pendingCodec=P),_.container=y,this.appendChangeType(o,y,P))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const i=`${t};codecs=${n}`,r={label:`change-type=${i}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),o.changeType(i),a.codec=n,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,i=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,jt.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>i||l!=null&&l.buffer&&xn.isBuffered(l.buffer,i)||((o=this.fragmentTracker.getAppendedFrag(i,jt.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:i,type:r,parent:a,frag:o,part:l,chunkMeta:c,offset:h}=t,f=c.buffering[r],{sn:p,cc:g}=o,y=self.performance.now();f.start=y;const x=o.stats.buffering,E=l?l.stats.buffering:null;x.start===0&&(x.start=y),E&&E.start===0&&(E.start=y);const _=n.audio;let b=!1;r==="audio"&&_?.container==="audio/mpeg"&&(b=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const C=n.video,I=C?.buffer;if(I&&p!=="initSegment"){const D=l||o,P=this.blockedAudioAppend;if(r==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(C.ending||C.ended)){const O=D.start+D.duration*.05,U=I.buffered,j=this.currentOp("video");!U.length&&!j?this.blockAudio(D):!j&&!xn.isBuffered(I,O)&&this.lastVideoAppendEnd<O&&this.blockAudio(D)}else if(r==="video"){const L=D.end;if(P){const O=P.frag.start;(L>O||L<this.lastVideoAppendEnd||xn.isBuffered(I,O))&&this.unblockAudio()}this.lastVideoAppendEnd=L}}const M=(l||o).start,R={label:`append-${r}`,execute:()=>{var D;f.executeStart=self.performance.now();const P=(D=this.tracks[r])==null?void 0:D.buffer;P&&(b?this.updateTimestampOffset(P,M,.1,r,p,g):h!==void 0&&Ft(h)&&this.updateTimestampOffset(P,h,1e-6,r,p,g)),this.appendExecutor(i,r)},onStart:()=>{},onComplete:()=>{const D=self.performance.now();f.executeEnd=f.end=D,x.first===0&&(x.first=D),E&&E.first===0&&(E.first=D);const P={};this.sourceBuffers.forEach(([L,O])=>{L&&(P[L]=xn.getBuffered(O))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Y.BUFFER_APPENDED,{type:r,frag:o,part:l,chunkMeta:c,parent:o.type,timeRanges:P})},onError:D=>{var P;const L={type:Wt.MEDIA_ERROR,parent:o.type,details:He.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:o,part:l,chunkMeta:c,error:D,err:D,fatal:!1},O=(P=this.media)==null?void 0:P.error;if(D.code===DOMException.QUOTA_EXCEEDED_ERR||D.name=="QuotaExceededError"||"quota"in D)L.details=He.BUFFER_FULL_ERROR;else if(D.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!O)L.errorAction=fA(!0);else if(D.name===c3&&this.sourceBufferCount===0)L.errorAction=fA(!0);else{const U=++this.appendErrors[r];this.warn(`Failed ${U}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${O||"no media error"})`),(U>=this.hls.config.appendErrorMaxRetry||O)&&(L.fatal=!0)}this.hls.trigger(Y.ERROR,L)}};this.append(R,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(Y.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:n,startOffset:i,endOffset:r}=t;n?this.append(this.getFlushOp(n,i,r),n):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,i,r),a)})}onFragParsed(e,t){const{frag:n,part:i}=t,r=[],a=i?i.elementaryStreams:n.elementaryStreams;a[Gi.AUDIOVIDEO]?r.push("audiovideo"):(a[Gi.AUDIO]&&r.push("audio"),a[Gi.VIDEO]&&r.push("video"));const o=()=>{const l=self.performance.now();n.stats.buffering.end=l,i&&(i.stats.buffering.end=l);const c=i?i.stats:n.stats;this.hls.trigger(Y.FRAG_BUFFERED,{frag:n,part:i,stats:c,id:n.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(o,r).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const i=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(Y.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(Y.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===He.BUFFER_APPEND_ERROR&&t.frag){var n;const i=(n=t.errorAction)==null?void 0:n.nextAutoLevel;Ft(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const i=e.config,r=n.currentTime,a=t.levelTargetDuration,o=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(Ft(o)&&o>=0){const c=Math.max(o,a),h=Math.floor(r/a)*a-c;this.flushBackBuffer(r,a,h)}const l=i.frontBufferFlushThreshold;if(Ft(l)&&l>0){const c=Math.max(i.maxBufferLength,l),h=Math.max(c,a),f=Math.floor(r/a)*a+h;this.flushFrontBuffer(r,a,f)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([i,r])=>{if(r){const o=xn.getBuffered(r);if(o.length>0&&n>o.start(0)){var a;this.hls.trigger(Y.BACK_BUFFER_REACHED,{bufferEnd:n});const l=this.tracks[i];if((a=this.details)!=null&&a.live)this.hls.trigger(Y.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(l!=null&&l.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Y.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:i})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([i,r])=>{if(r){const a=xn.getBuffered(r),o=a.length;if(o<2)return;const l=a.start(o-1),c=a.end(o-1);if(n>l||e>=l&&e<=c)return;this.hls.trigger(Y.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||n?.readyState!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),h=Math.max(c,i);return{duration:1/0,start:c,end:h}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return Ft(r)?{duration:r}:null;const a=this.media.duration,o=Ft(n.duration)?n.duration:0;return i>o&&i>a||!Ft(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:n}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(Ft(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${n}.`),i.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Wi(n)}`),this.tracksReady){var i;const r=(i=this.transferData)==null?void 0:i.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const i=this.tracks[t];e[t]={buffer:n,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(Y.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const a=r,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),c=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(a)?" Queued":""} ${Wi(o)}`);try{const h=n.addSourceBuffer(c),f=C1(a),p=[a,h];t[f]=p,o.buffer=h}catch(h){var i;this.error(`error while trying to add sourceBuffer: ${h.message}`),this.shiftAndExecuteNext(a),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[a],this.hls.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,sourceBufferName:a,mimeType:c,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let i=e.codec;n&&(t==="video"||t==="audiovideo")&&iw(n,"video")&&(i=tV(i,n));const r=US(i,e.levelCodec);return r?t.slice(0,5)==="audio"?fb(r,this.appendSource):r:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(Y.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${i}`,t),this.hls.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.currentOp(e);r&&r.onError(i)}updateTimestampOffset(e,t,n,i,r,a){const o=t-e.timestampOffset;Math.abs(o)>=n&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:i,mediaSource:r}=this,a=this.tracks[e],o=a?.buffer;if(!i||!r||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=Ft(i.duration)?i.duration:1/0,c=Ft(r.duration)?r.duration:1/0,h=Math.max(0,t),f=Math.min(n,l,c);f>h&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${h},${f}] from the ${e} SourceBuffer`),o.remove(h,f)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],i=n?.buffer;if(!i)throw new f9(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,i=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(a=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const i=(n=this.tracks[t])==null?void 0:n.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const i=this.tracks[e];if(!i)return;const r=i.buffer;if(!r)return;const a=n.bind(this,e);i.listeners.push({event:t,listener:a}),r.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(i=>{n.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function b2(s){const e=s.querySelectorAll("source");[].slice.call(e).forEach(t=>{s.removeChild(t)})}function p9(s,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,s.appendChild(t)}function C1(s){return s==="audio"?1:0}class ZR{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(Y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Y.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(Y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Y.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ft(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((i,r)=>this.isLevelAllowed(i)&&r<=e);return this.clientRect=null,ZR.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const i=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let r=e.length-1;const a=Math.max(t,n);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&i(l,e[o+1])){r=o;break}}return r}}const m9={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Va=m9,g9={HLS:"h"},A9=g9;class _u{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof _u?n:new _u(n))),this.value=e,this.params=t}}const y9="Dict";function v9(s){return Array.isArray(s)?JSON.stringify(s):s instanceof Map?"Map{}":s instanceof Set?"Set{}":typeof s=="object"?JSON.stringify(s):String(s)}function E9(s,e,t,n){return new Error(`failed to ${s} "${v9(e)}" as ${t}`,{cause:n})}function Su(s,e,t){return E9("serialize",s,e,t)}class u3{constructor(e){this.description=e}}const T2="Bare Item",x9="Boolean";function _9(s){if(typeof s!="boolean")throw Su(s,x9);return s?"?1":"?0"}function S9(s){return btoa(String.fromCharCode(...s))}const b9="Byte Sequence";function T9(s){if(ArrayBuffer.isView(s)===!1)throw Su(s,b9);return`:${S9(s)}:`}const C9="Integer";function I9(s){return s<-999999999999999||999999999999999<s}function h3(s){if(I9(s))throw Su(s,C9);return s.toString()}function M9(s){return`@${h3(s.getTime()/1e3)}`}function f3(s,e){if(s<0)return-f3(-s,e);const t=Math.pow(10,e);if(Math.abs(s*t%1-.5)<Number.EPSILON){const i=Math.floor(s*t);return(i%2===0?i:i+1)/t}else return Math.round(s*t)/t}const w9="Decimal";function R9(s){const e=f3(s,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Su(s,w9);const t=e.toString();return t.includes(".")?t:`${t}.0`}const B9="String",D9=/[\x00-\x1f\x7f]+/;function L9(s){if(D9.test(s))throw Su(s,B9);return`"${s.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function O9(s){return s.description||s.toString().slice(7,-1)}const P9="Token";function C2(s){const e=O9(s);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Su(e,P9);return e}function pw(s){switch(typeof s){case"number":if(!Ft(s))throw Su(s,T2);return Number.isInteger(s)?h3(s):R9(s);case"string":return L9(s);case"symbol":return C2(s);case"boolean":return _9(s);case"object":if(s instanceof Date)return M9(s);if(s instanceof Uint8Array)return T9(s);if(s instanceof u3)return C2(s);default:throw Su(s,T2)}}const N9="Key";function mw(s){if(/^[a-z*][a-z0-9\-_.*]*$/.test(s)===!1)throw Su(s,N9);return s}function eB(s){return s==null?"":Object.entries(s).map(([e,t])=>t===!0?`;${mw(e)}`:`;${mw(e)}=${pw(t)}`).join("")}function d3(s){return s instanceof _u?`${pw(s.value)}${eB(s.params)}`:pw(s)}function F9(s){return`(${s.value.map(d3).join(" ")})${eB(s.params)}`}function U9(s,e={whitespace:!0}){if(typeof s!="object"||s==null)throw Su(s,y9);const t=s instanceof Map?s.entries():Object.entries(s),n=e?.whitespace?" ":"";return Array.from(t).map(([i,r])=>{r instanceof _u||(r=new _u(r));let a=mw(i);return r.value===!0?a+=eB(r.params):(a+="=",Array.isArray(r.value)?a+=F9(r):a+=d3(r)),a}).join(`,${n}`)}function p3(s,e){return U9(s,e)}const Wc="CMCD-Object",_s="CMCD-Request",gp="CMCD-Session",Bf="CMCD-Status",k9={br:Wc,ab:Wc,d:Wc,ot:Wc,tb:Wc,tpb:Wc,lb:Wc,tab:Wc,lab:Wc,url:Wc,pb:_s,bl:_s,tbl:_s,dl:_s,ltc:_s,mtp:_s,nor:_s,nrr:_s,rc:_s,sn:_s,sta:_s,su:_s,ttfb:_s,ttfbb:_s,ttlb:_s,cmsdd:_s,cmsds:_s,smrt:_s,df:_s,cs:_s,ts:_s,cid:gp,pr:gp,sf:gp,sid:gp,st:gp,v:gp,msd:gp,bs:Bf,bsd:Bf,cdn:Bf,rtp:Bf,bg:Bf,pt:Bf,ec:Bf,e:Bf},G9={REQUEST:_s};function H9(s){return Object.keys(s).reduce((e,t)=>{var n;return(n=s[t])===null||n===void 0||n.forEach(i=>e[i]=t),e},{})}function z9(s,e){const t={};if(!s)return t;const n=Object.keys(s),i=e?H9(e):{};return n.reduce((r,a)=>{var o;const l=k9[a]||i[a]||G9.REQUEST,c=(o=r[l])!==null&&o!==void 0?o:r[l]={};return c[a]=s[a],r},t)}function Q9(s){return["ot","sf","st","e","sta"].includes(s)}function V9(s){return typeof s=="number"?Ft(s):s!=null&&s!==""&&s!==!1}const m3="event";function j9(s,e){const t=new URL(s),n=new URL(e);if(t.origin!==n.origin)return s;const i=t.pathname.split("/").slice(1),r=n.pathname.split("/").slice(1,-1);for(;i[0]===r[0];)i.shift(),r.shift();for(;r.length;)r.shift(),i.unshift("..");return i.join("/")+t.search+t.hash}const QS=s=>Math.round(s),gw=(s,e)=>Array.isArray(s)?s.map(t=>gw(t,e)):s instanceof _u&&typeof s.value=="string"?new _u(gw(s.value,e),s.params):(e.baseUrl&&(s=j9(s,e.baseUrl)),e.version===1?encodeURIComponent(s):s),x_=s=>QS(s/100)*100,q9=(s,e)=>{let t=s;return e.version>=2&&(s instanceof _u&&typeof s.value=="string"?t=new _u([s]):typeof s=="string"&&(t=[s])),gw(t,e)},K9={br:QS,d:QS,bl:x_,dl:x_,mtp:x_,nor:q9,rtp:x_,tb:QS},g3="request",A3="response",tB=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Y9=["e"],X9=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function TT(s){return X9.test(s)}function W9(s){return tB.includes(s)||Y9.includes(s)||TT(s)}const y3=["d","dl","nor","ot","rtp","su"];function $9(s){return tB.includes(s)||y3.includes(s)||TT(s)}const J9=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function Z9(s){return tB.includes(s)||y3.includes(s)||J9.includes(s)||TT(s)}const ej=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function tj(s){return ej.includes(s)||TT(s)}const nj={[A3]:Z9,[m3]:W9,[g3]:$9};function v3(s,e={}){const t={};if(s==null||typeof s!="object")return t;const n=e.version||s.v||1,i=e.reportingMode||g3,r=n===1?tj:nj[i];let a=Object.keys(s).filter(r);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const l=i===A3||i===m3;l&&!a.includes("ts")&&a.push("ts"),n>1&&!a.includes("v")&&a.push("v");const c=Li({},K9,e.formatters),h={version:n,reportingMode:i,baseUrl:e.baseUrl};return a.sort().forEach(f=>{let p=s[f];const g=c[f];if(typeof g=="function"&&(p=g(p,h)),f==="v"){if(n===1)return;p=n}f=="pr"&&p===1||(l&&f==="ts"&&!Ft(p)&&(p=Date.now()),V9(p)&&(Q9(f)&&typeof p=="string"&&(p=new u3(p)),t[f]=p))}),t}function ij(s,e={}){const t={};if(!s)return t;const n=v3(s,e),i=z9(n,e?.customHeaderMap);return Object.entries(i).reduce((r,[a,o])=>{const l=p3(o,{whitespace:!1});return l&&(r[a]=l),r},t)}function sj(s,e,t){return Li(s,ij(e,t))}const rj="CMCD";function aj(s,e={}){return s?p3(v3(s,e),{whitespace:!1}):""}function oj(s,e={}){if(!s)return"";const t=aj(s,e);return encodeURIComponent(t)}function lj(s,e={}){if(!s)return"";const t=oj(s,e);return`${rj}=${t}`}const I2=/CMCD=[^&#]+/;function cj(s,e,t){const n=lj(e,t);if(!n)return s;if(I2.test(s))return s.replace(I2,n);const i=s.includes("?")?"&":"?";return`${s}${i}${n}`}class uj{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Va.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=i=>{try{const{frag:r,part:a}=i,o=this.hls.levels[r.level],l=this.getObjectType(r),c={d:(a||r).duration*1e3,ot:l};(l===Va.VIDEO||l===Va.AUDIO||l==Va.MUXED)&&(c.br=o.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const h=a?this.getNextPart(a):this.getNextFrag(r);h!=null&&h.url&&h.url!==r.url&&(c.nor=h.url),this.apply(i,c)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Y.MEDIA_DETACHED,this.onMediaDetached,this),e.on(Y.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Y.MEDIA_DETACHED,this.onMediaDetached,this),e.off(Y.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:A9.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Li(t,this.createData());const n=t.ot===Va.INIT||t.ot===Va.VIDEO||t.ot===Va.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((a,o)=>(i.includes(o)&&(a[o]=t[o]),a),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),sj(e.headers,t,r)):e.url=cj(e.url,t,r)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const i=e.sn-n.startSN;return n.fragments[i+1]}}getNextPart(e){var t;const{index:n,fragment:i}=e,r=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(r){const{sn:a}=i;for(let o=r.length-1;o>=0;o--){const l=r[o];if(l.index===n&&l.fragment.sn===a)return r[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Va.TIMED_TEXT;if(e.sn==="initSegment")return Va.INIT;if(t==="audio")return Va.AUDIO;if(t==="main")return this.hls.audioTracks.length?Va.VIDEO:Va.MUXED}getTopBandwidth(e){let t=0,n;const i=this.hls;if(e===Va.AUDIO)n=i.audioTracks;else{const r=i.maxAutoLevel,a=r>-1?r+1:i.levels.length;n=i.levels.slice(0,a)}return n.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===Va.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:xn.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new n(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,o){t(r),this.loader.load(r,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new n(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,o){t(r),this.loader.load(r,a,o)}}}}const hj=3e5;class fj extends Sl{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Y.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Y.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if(n?.action===Nr.SendAlternateToPenaltyBox&&n.flags===Mo.MoveAllAlternatesMatchingHost){const i=this.levels;let r=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:c}=t.context;o&&i?a=this.getPathwayForGroupId(o,c,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!r&&i&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),n.resolved=this.pathwayId!==a),t.details===He.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${i&&i.length} priorities: ${Wi(r)} penalized: ${Wi(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(r=>{i-n[r]>hj&&delete n[r]});for(let r=0;r<e.length;r++){const a=e[r];if(a in n)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,kU(t),this.hls.trigger(Y.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[o];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let r=0;r<i.length;r++)if(t===Hn.AUDIO_TRACK&&i[r].hasAudioGroup(e)||t===Hn.SUBTITLE_TRACK&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},i={};e.forEach(r=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=r;if(t.some(h=>h.pathwayId===a))return;const c=this.getLevelsForPathway(o).map(h=>{const f=new hs(h.attrs);f["PATHWAY-ID"]=a;const p=f.AUDIO&&`${f.AUDIO}_clone_${a}`,g=f.SUBTITLES&&`${f.SUBTITLES}_clone_${a}`;p&&(n[f.AUDIO]=p,f.AUDIO=p),g&&(i[f.SUBTITLES]=g,f.SUBTITLES=g);const y=E3(h.uri,f["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),x=new Mv({attrs:f,audioCodec:h.audioCodec,bitrate:h.bitrate,height:h.height,name:h.name,url:y,videoCodec:h.videoCodec,width:h.width});if(h.audioGroups)for(let E=1;E<h.audioGroups.length;E++)x.addGroupId("audio",`${h.audioGroups[E]}_clone_${a}`);if(h.subtitleGroups)for(let E=1;E<h.subtitleGroups.length;E++)x.addGroupId("text",`${h.subtitleGroups[E]}_clone_${a}`);return x});t.push(...c),M2(this.audioTracks,n,l,a),M2(this.subtitleTracks,i,l,a)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+h)}const r={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(h,f,p,g)=>{this.log(`Loaded steering manifest: "${i}"`);const y=h.data;if(y?.VERSION!==1){this.log(`Steering VERSION ${y.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=y.TTL;const{"RELOAD-URI":x,"PATHWAY-CLONES":E,"PATHWAY-PRIORITY":_}=y;if(x)try{this.uri=new self.URL(x,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${x}`);return}this.scheduleRefresh(this.uri||p.url),E&&this.clonePathways(E);const b={steeringManifest:y,url:i.toString()};this.hls.trigger(Y.STEERING_MANIFEST_LOADED,b),_&&this.updatePathwayPriority(_)},onError:(h,f,p,g)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${f.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${f.url} no longer available`);return}let y=this.timeToLoad*1e3;if(h.code===429){const x=this.loader;if(typeof x?.getResponseHeader=="function"){const E=x.getResponseHeader("Retry-After");E&&(y=parseFloat(E)*1e3)}this.log(`Steering manifest ${f.url} rate limited`);return}this.scheduleRefresh(this.uri||f.url,y)},onTimeout:(h,f,p)=>{this.log(`Timeout loading steering manifest (${f.url})`),this.scheduleRefresh(this.uri||f.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const i=(n=this.hls)==null?void 0:n.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function M2(s,e,t,n){s&&Object.keys(e).forEach(i=>{const r=s.filter(a=>a.groupId===i).map(a=>{const o=Li({},a);return o.details=void 0,o.attrs=new hs(o.attrs),o.url=o.attrs.URI=E3(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[i],o.attrs["PATHWAY-ID"]=n,o});s.push(...r)})}function E3(s,e,t,n){const{HOST:i,PARAMS:r,[t]:a}=n;let o;e&&(o=a?.[e],o&&(s=o));const l=new self.URL(s);return i&&!o&&(l.host=i),r&&Object.keys(r).sort().forEach(c=>{c&&l.searchParams.set(c,r[c])}),l.href}class pA extends Sl{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=pA.CDMCleanupPromise?[pA.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:i}=t,r=`"${t.type}" event: init data type: "${n}"`;if(this.debug(r),i!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=nv(this.config));const o=a.map(y1).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=GS(a);if(n!=="sinf"||o!==Ss.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${o}`);return}let l;try{const g=cr(new Uint8Array(i)),y=QR(JSON.parse(g).sinf),x=yU(y);if(!x)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(x.subarray(8,24))}catch(g){this.warn(`${r} Failed to parse sinf: ${g}`);return}const c=wo(l),{keyIdToKeySessionPromise:h,mediaKeySessions:f}=this;let p=h[c];for(let g=0;g<f.length;g++){const y=f[g],x=y.decryptdata;if(!x.keyId)continue;const E=wo(x.keyId);if(c===E||x.uri.replace(/-/g,"").indexOf(c)!==-1){if(p=h[E],!p)continue;if(x.pssh)break;delete h[E],x.pssh=new Uint8Array(i),x.keyId=l,p=h[c]=p.then(()=>this.generateRequestWithPreferredKeySession(y,n,i,"encrypted-event-key-match")),p.catch(_=>this.handleError(_));break}}p||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${f.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(Y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(Y.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(Y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(Y.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,i=t?.[e];if(i)return i.licenseUrl;if(e===Ss.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t?.[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(a,o,l)=>!!a&&l.indexOf(a)===o,i=t.map(a=>a.audioCodec).filter(n),r=t.map(a=>a.videoCodec).filter(n);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise((a,o)=>{const l=c=>{const h=c.shift();this.getMediaKeysPromise(h,i,r).then(f=>a({keySystem:h,mediaKeys:f})).catch(f=>{c.length?l(c):f instanceof rc?o(f):o(new rc({type:Wt.KEY_SYSTEM_ERROR,details:He.KEY_SYSTEM_NO_ACCESS,error:f,fatal:!0},f.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${n}`;return DU===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return n(e,t)}getMediaKeysPromise(e,t,n){var i;const r=qV(e,t,n,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(i=a)==null?void 0:i.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Wi(r)}`),o=this.requestMediaKeySystemAccess(e,r);const l=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),o.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const h=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const f=l.mediaKeys=c.createMediaKeys().then(p=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,h.then(g=>g?this.setMediaKeysServerCertificate(p,e,g):p)));return f.catch(p=>{this.error(`Failed to create media-keys for "${e}"}: ${p}`)}),f})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${wo(e.keyId||[])}`);const i=n.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return wo(e.keyId)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${wo(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>y1(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const r=y1(i);r?t(r):n(new Error(`Unable to find format for key-system "${i}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=nv(this.config),n=e.map(GS).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(n)}loadKey(e){const t=e.keyInfo.decryptdata,n=this.getKeyIdString(t),i=this.bannedKeyIds[n];if(i){const o=w2(i,t);return this.handleError(o,e.frag),Promise.reject(o)}const r=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);const a=this.keyIdToKeySessionPromise[n];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(l,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:t}))))).then(l=>{const c="cenc",h=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,c,h,"playlist-key")});return o.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[n]=o,o}return a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){this.hls&&(this.error(e.message),e instanceof rc?(t&&(e.data.frag=t),this.hls.trigger(Y.ERROR,e.data)):this.hls.trigger(Y.ERROR,{type:Wt.KEY_SYSTEM_ERROR,details:He.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){const i=GS(e.keyFormat),r=i?[i]:nv(this.config);return this.attemptKeySystemAccess(r)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=nv(this.config)),e.length===0)throw new rc({type:Wt.KEY_SYSTEM_ERROR,details:He.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Wi({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(n).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>n.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,n,i){var r;const a=(r=this.config.drmSystems)==null||(r=r[e.keySystem])==null?void 0:r.generateRequest;if(a)try{const p=a.call(this.hls,t,n,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");t=p.initDataType,n=p.initData?p.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(p){if(this.warn(p.message),this.hls&&this.hls.config.debug)throw p}if(n===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const o=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${o} (init data type: ${t} length: ${n.byteLength})`);const l=new jR,c=e._onmessage=p=>{const g=e.mediaKeysSession;if(!g){l.emit("error",new Error("invalid state"));return}const{messageType:y,message:x}=p;this.log(`"${y}" message event for session "${g.sessionId}" message size: ${x.byteLength}`),y==="license-request"||y==="license-renewal"?this.renewLicense(e,x).catch(E=>{l.eventNames().length?l.emit("error",E):this.handleError(E)}):y==="license-release"?e.keySystem===Ss.FAIRPLAY&&(this.updateKeySession(e,lw("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${y}"`)},h=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){l.emit("error",new Error("invalid state"));return}const y=e.keyStatus;this.onKeyStatusChange(e);const x=e.keyStatus;x!==y&&(l.emit("keyStatus",x,e),x==="expired"&&(this.log(`${e.keySystem} expired for key ${o}`),this.renewKeySession(e)))};Ma(e.mediaKeysSession,"message",c),Ma(e.mediaKeysSession,"keystatuseschange",h);const f=new Promise((p,g)=>{l.on("error",g),l.on("keyStatus",(y,{decryptdata:x})=>{y.startsWith("usable")?p():y==="internal-error"||y==="output-restricted"?g(w2(y,x)):y==="expired"?g(new Error(`key expired while generating request (keyId: ${o})`)):this.warn(`unhandled key status change "${y}" (keyId: ${o})`)})});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o}`)}).catch(p=>{throw new rc({type:Wt.KEY_SYSTEM_ERROR,details:He.KEY_SYSTEM_NO_SESSION,error:p,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>f).catch(p=>{throw l.removeAllListeners(),this.removeSession(e),p}).then(()=>(l.removeAllListeners(),e))}onKeyStatusChange(e){const t=wo(new Uint8Array(e.decryptdata.keyId||[]));e.mediaKeysSession.keyStatuses.forEach((n,i)=>{if(typeof i=="string"&&typeof n=="object"){const o=i;i=n,n=o}const r=wo("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i));n==="internal-error"&&(this.bannedKeyIds[r]=n);const a=r===t;this.log(`${a?"":"un"}matched key status change "${n}" for keyStatuses keyId: ${r} session keyId: ${t} uri: ${e.decryptdata.uri}`),a&&(e.keyStatus=n)})}fetchServerCertificate(e){const t=this.config,n=t.loader,i=new n(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:r},c=t.certLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(p,g,y,x)=>{a(p.data)},onError:(p,g,y,x)=>{o(new rc({type:Wt.KEY_SYSTEM_ERROR,details:He.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:Di({url:l.url,data:void 0},p)},`"${e}" certificate request failed (${r}). Status: ${p.code} (${p.text})`))},onTimeout:(p,g,y)=>{o(new rc({type:Wt.KEY_SYSTEM_ERROR,details:He.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(p,g,y)=>{o(new Error("aborted"))}};i.load(l,h,f)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,r)=>{e.setServerCertificate(n).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),i(e)}).catch(a=>{r(new rc({type:Wt.KEY_SYSTEM_ERROR,details:He.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(i=>{throw new rc({type:Wt.KEY_SYSTEM_ERROR,details:He.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(n,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let h;for(let f=0,p=r.length;f<p;f++){var a,o;h=r[f];const g=(a=h.querySelector("name"))==null?void 0:a.textContent,y=(o=h.querySelector("value"))==null?void 0:o.textContent;g&&y&&e.setRequestHeader(g,y)}}const l=i.querySelector("Challenge"),c=l?.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return lw(atob(c))}setupLicenseXHR(e,t,n,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,n,i)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",t,!0),r.call(this.hls,e,t,n,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((i,r)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,o,a,e)}catch(h){this.error(h)}i(l)}else{const l=n.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||o.status>=400&&o.status<500)r(new rc({type:Wt.KEY_SYSTEM_ERROR,details:He.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const h=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,t).then(i,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==Ss.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,Ma(n,"encrypted",this.onMediaEncrypted),Ma(n,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(no(e,"encrypted",this.onMediaEncrypted),no(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ST.clearKeyUriToKeyIdMap();const i=n.length;pA.CDMCleanupPromise=Promise.all(n.map(r=>this.removeSession(r)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(r=>{this.log(`Could not clear media keys: ${r}`),this.hls&&this.hls.trigger(Y.ERROR,{type:Wt.OTHER_ERROR,details:He.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${r}`)})}))).catch(r=>{this.log(`Could not close sessions and clear media keys: ${r}`),this.hls&&this.hls.trigger(Y.ERROR,{type:Wt.OTHER_ERROR,details:He.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${r}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((i,r)=>(i.indexOf(r.keyFormat)===-1&&i.push(r.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:i}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${wo(i?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{drmSystemOptions:a}=this.config;return(YV(a)?new Promise((l,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(l).catch(c)}):Promise.resolve()).catch(l=>{this.log(`Could not remove session: ${l}`),this.hls&&this.hls.trigger(Y.ERROR,{type:Wt.OTHER_ERROR,details:He.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${l}`)})}).then(()=>t.close()).catch(l=>{this.log(`Could not close session: ${l}`),this.hls&&this.hls.trigger(Y.ERROR,{type:Wt.OTHER_ERROR,details:He.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${l}`)})})}}}pA.CDMCleanupPromise=void 0;class rc extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function w2(s,e){const t=s==="output-restricted",n=t?He.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:He.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new rc({type:Wt.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${s}"`)}class dj{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(Y.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(Y.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const i=performance.now();if(t){if(this.lastTime){const r=i-this.lastTime,a=n-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/r,c=this.hls;if(c.trigger(Y.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:n}),l>0&&a>c.config.fpsDroppedMonitoringThreshold*o){let h=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=h)&&(h=h-1,c.trigger(Y.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function x3(s,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=s,e.dispatchEvent(t)}function _3(s,e){const t=s.mode;if(t==="disabled"&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(e.id))try{if(s.addCue(e),!s.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){_i.debug(`[texttrack-utils]: ${n}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,s.addCue(i)}catch(i){_i.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(s.mode=t)}function rA(s,e){const t=s.mode;if(t==="disabled"&&(s.mode="hidden"),s.cues)for(let n=s.cues.length;n--;)e&&s.cues[n].removeEventListener("enter",e),s.removeCue(s.cues[n]);t==="disabled"&&(s.mode=t)}function Aw(s,e,t,n){const i=s.mode;if(i==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0){const r=mj(s.cues,e,t);for(let a=0;a<r.length;a++)(!n||n(r[a]))&&s.removeCue(r[a])}i==="disabled"&&(s.mode=i)}function pj(s,e){if(e<=s[0].startTime)return 0;const t=s.length-1;if(e>s[t].endTime)return-1;let n=0,i=t,r;for(;n<=i;)if(r=Math.floor((i+n)/2),e<s[r].startTime)i=r-1;else if(e>s[r].startTime&&n<t)n=r+1;else return r;return s[n].startTime-e<e-s[i].startTime?n:i}function mj(s,e,t){const n=[],i=pj(s,e);if(i>-1)for(let r=i,a=s.length;r<a;r++){const o=s[r];if(o.startTime>=e&&o.endTime<=t)n.push(o);else if(o.startTime>t)return n}return n}function VS(s){const e=[];for(let t=0;t<s.length;t++){const n=s[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(s[t])}return e}class gj extends JR{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=VS(this.media.textTracks);for(let r=0;r<n.length;r++)if(n[r].mode==="hidden")t=n[r];else if(n[r].mode==="showing"){t=n[r];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Y.LEVEL_LOADING,this.onLevelLoading,this),e.on(Y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Y.LEVEL_LOADING,this.onLevelLoading,this),e.off(Y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Y.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;VS(n.textTracks).forEach(a=>{rA(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:i,details:r}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${n} and group:${i} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||i?.length!==n?.length||n!=null&&n.some(a=>i?.indexOf(a)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(h=>!n||n.indexOf(h.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(h=>h.default)&&(this.selectDefaultTrack=!1),a.forEach((h,f)=>{h.id=f});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!r&&o){this.selectDefaultTrack=!1;const h=pu(o,a);if(h>-1)r=a[h];else{const f=pu(o,this.tracks);r=this.tracks[f]}}let l=this.findTrackId(r);l===-1&&r&&(l=this.findTrackId(null));const c={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${n?.join(",")}" group-id`),this.hls.trigger(Y.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if(!(n&&!r.default||!n&&!e)&&(!e||tm(r,e)))return i}if(e){for(let i=0;i<t.length;i++){const r=t[i];if(Dv(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const r=t[i];if(Dv(e.attrs,r.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(dw(i,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Hn.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&tm(e,n))return n;const i=pu(e,this.tracksInGroup);if(i>-1){const r=this.tracksInGroup[i];return this.setSubtitleTrack(i),r}else{if(n)return null;{const r=pu(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(Y.SUBTITLE_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=VS(e.textTracks),n=this.currentTrack;let i;if(n&&(i=t.filter(r=>dw(n,r))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==i&&(r.mode="disabled")}),i){const r=this.subtitleDisplay?"showing":"hidden";i.mode!==r&&(i.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Ft(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(Y.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!i.details&&!i.details.live;if(e===this.trackId&&i===n&&r)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:o="",name:l,type:c,url:h}=i;this.hls.trigger(Y.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:c,url:h});const f=this.switchParams(i.url,n?.details,i.details);this.loadPlaylist(f)}}function Aj(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?r:r&3|8).toString(16)})}}}function uv(s){let e=5381,t=s.length;for(;t;)e=e*33^s.charCodeAt(--t);return(e>>>0).toString()}const mA=.025;let Eb=(function(s){return s[s.Point=0]="Point",s[s.Range=1]="Range",s})({});function yj(s,e,t){return`${s.identifier}-${t+1}-${uv(e)}`}class vj{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return I1(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=I1(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Ft(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return I1(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<mA))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Eb.Range:Eb.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Ej(this)}}function I1(s,e){return s-e.start<e.duration/2&&!(Math.abs(s-(e.start+e.duration))<mA)?e.start:e.start+e.duration}function S3(s,e,t){const n=new self.URL(s,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function M1(s,e){for(;(t=s.assetList[++e])!=null&&t.error;)var t;return e}function Ej(s){return`["${s.identifier}" ${s.cue.pre?"<pre>":s.cue.post?"<post>":""}${s.timelineStart.toFixed(2)}-${s.resumeTime.toFixed(2)}]`}function nA(s){const e=s.timelineStart,t=s.duration||0;return`["${s.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class xj{constructor(e,t,n,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(Y.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=n,this.assetItem=i;const a=()=>{this.hasDetails=!0};r.once(Y.LEVEL_LOADED,a),r.once(Y.AUDIO_TRACK_LOADED,a),r.once(Y.SUBTITLE_TRACK_LOADED,a),r.on(Y.MEDIA_ATTACHING,(o,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(Y.BUFFER_APPENDED,()=>{const h=this.bufferedEnd;this.reachedPlayout(h)&&(this._bufferedEosTime=h,r.trigger(Y.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=S3(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,r=xn.bufferInfo(e,i,0);return this.getAssetTime(r.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=xn.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var i;(i=this.hls)==null||i.on(e,t)}once(e,t,n){var i;(i=this.hls)==null||i.once(e,t)}off(e,t,n){var i;(i=this.hls)==null||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${nA(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const R2=.033;class _j extends Sl{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(r=i[n])!=null&&r.event;){var r;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let i=0;i<n.length;i++){let r=n[i];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return i}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let i=e;i<=t&&n[i];i++){const r=n[i].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var n;if(((n=t[i].event)==null?void 0:n.identifier)===e)return i}return-1}findAssetIndex(e,t){const n=e.assetList,i=n.length;if(i>1)for(let r=0;r<i;r++){const a=n[r];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||r===i-1))return r}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,i=n[n.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:i}=n,r=this.events,a=this.parseDateRanges(i,{url:n.url},t),o=Object.keys(i),l=r?r.filter(c=>!o.includes(c.identifier)):[];a.length&&a.sort((c,h)=>{const f=c.cue.pre,p=c.cue.post,g=h.cue.pre,y=h.cue.post;if(f&&!g)return-1;if(g&&!f||p&&!y)return 1;if(y&&!p)return-1;if(!f&&!g&&!p&&!y){const x=c.startTime,E=h.startTime;if(x!==E)return x-E}return c.dateRange.tagOrder-h.dateRange.tagOrder}),this.events=a,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],n=!1){const i=this.events||[];if(i.length||t.length||this.length<2){const r=this.items,a=this.parseSchedule(i,e);(n||t.length||r?.length!==a.length||a.some((l,c)=>Math.abs(l.playout.start-r[c].playout.start)>.005||Math.abs(l.playout.end-r[c].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,n){const i=[],r=Object.keys(e);for(let a=0;a<r.length;a++){const o=r[a],l=e[o];if(l.isInterstitial){let c=this.eventMap[o];c?c.setDateRange(l):(c=new vj(l,t),this.eventMap[o]=c,n===!1&&(c.appendInPlace=n)),i.push(c)}}return i}parseSchedule(e,t){const n=[],i=t.main.details,r=i.live?1/0:i.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((h,f)=>{const p=h.cue.pre,g=h.cue.post,y=e[f-1]||null,x=h.appendInPlace,E=g?r:h.startOffset,_=h.duration,b=h.timelineOccupancy===Eb.Range?_:0,C=h.resumptionOffset,I=y?.startTime===E,M=E+h.cumulativeDuration;let R=x?M+_:E+C;if(p||!g&&E<=0){const P=c;c+=b,h.timelineStart=M;const L=a;a+=_,n.push({event:h,start:M,end:R,playout:{start:L,end:a},integrated:{start:P,end:c}})}else if(E<=r){if(!I){const O=E-l;if(O>R2){const U=l,j=c;c+=O;const H=a;a+=O;const z={previousEvent:e[f-1]||null,nextEvent:h,start:U,end:U+O,playout:{start:H,end:a},integrated:{start:j,end:c}};n.push(z)}else O>0&&y&&(y.cumulativeDuration+=O,n[n.length-1].end=E)}g&&(R=M),h.timelineStart=M;const P=c;c+=b;const L=a;a+=_,n.push({event:h,start:M,end:R,playout:{start:L,end:a},integrated:{start:P,end:c}})}else return;const D=h.resumeTime;g||D>r?l=r:l=D}),l<r){var o;const h=l,f=c,p=r-l;c+=p;const g=a;a+=p,n.push({previousEvent:((o=n[n.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:h+p,playout:{start:g,end:a},integrated:{start:f,end:c}})}this.setDurations(r,a,c)}else n.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,i=n.live?1/0:n.edge;let r=0,a=-1;e.forEach((o,l)=>{const c=o.cue.pre,h=o.cue.post,f=c?0:h?i:o.startTime;this.updateAssetDurations(o),a===f?o.cumulativeDuration=r:(r=0,a=f),!h&&o.snapOptions.in&&(o.resumeAnchor=um(null,n.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<R2&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const g=Ft(o.resumeOffset)?o.resumeOffset:o.duration;r+=g})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(n-i)>mA?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(n>=l)return this.log(`"${e.identifier}" resumption ${n} past ${a} playlist end ${l}`),!1;const c=um(null,o.fragments,n);if(!c)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const h=a==="audio"?.175:0;return Math.abs(c.start-n)<mA+h||Math.abs(c.end-n)<mA+h?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${a} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,i=!1,r=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],l=t+n;o.startOffset=n,o.timelineStart=l,i||(i=o.duration===null),r||(r=!!o.error);const c=o.error?0:o.duration||0;n+=c}i&&!r?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function $l(s){return`[${s.event?'"'+s.event.identifier+'"':"primary"}: ${s.start.toFixed(2)}-${s.end.toFixed(2)}]`}class Sj{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let i;try{i=S3(n,this.hls.sessionId,e.baseUrl)}catch(p){const g=this.assignAssetListError(e,He.ASSET_LIST_LOAD_ERROR,p,n);this.hls.trigger(Y.ERROR,g);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,a=r.loader,o=new a(r),l={responseType:"json",url:i.href},c=r.interstitialAssetListLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(p,g,y,x)=>{const E=p.data,_=E?.ASSETS;if(!Array.isArray(_)){const b=this.assignAssetListError(e,He.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),y.url,g,x);this.hls.trigger(Y.ERROR,b);return}e.assetListResponse=E,this.hls.trigger(Y.ASSET_LIST_LOADED,{event:e,assetListResponse:E,networkDetails:x})},onError:(p,g,y,x)=>{const E=this.assignAssetListError(e,He.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${p.code} ${p.text} (${g.url})`),g.url,x,y);this.hls.trigger(Y.ERROR,E)},onTimeout:(p,g,y)=>{const x=this.assignAssetListError(e,He.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${g.url})`),g.url,p,y);this.hls.trigger(Y.ERROR,x)}};return o.load(l,h,f),this.hls.trigger(Y.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,n,i,r,a){return e.error=n,{type:Wt.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:n,networkDetails:a,stats:r}}}function B2(s){s?.play().catch(()=>{})}function __(s,e){return`[${s}] Advancing timeline position to ${e}`}class bj extends Sl{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const i=n-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const a=i<=-.01;this.timelinePos=n,this.bufferedPos=n;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(n,n-i)&&this.updateSchedule(!0),this.checkBuffer(),a&&n<o.start||n>=o.end){var l;const g=this.findItemIndex(o);let y=this.schedule.findItemIndexAtTime(n);if(y===-1&&(y=g+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${n} (resolving from ${g} to ${y})`)),!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a&&y>g){const x=this.schedule.findJumpRestrictedIndex(g+1,y);if(x>g){this.setSchedulePosition(x);return}}this.setSchedulePosition(y);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(o)){const g=o.event.assetList[0];g&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,g))}return}const h=c.timelineStart,f=c.duration||0;if(a&&n<h||n>=h+f){var p;(p=o.event)!=null&&p.appendInPlace&&(this.clearInterstitial(o.event,o),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,c)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(n>=i.end){this.timelinePos=i.end;const o=this.findItemIndex(i);this.setSchedulePosition(o+1)}const r=this.playingAsset;if(!r)return;const a=r.timelineStart+(r.duration||0);n>=a&&this.setScheduleToAssetAtTime(n,r)},this.onScheduleUpdate=(n,i)=>{const r=this.schedule;if(!r)return;const a=this.playingItem,o=r.events||[],l=r.items||[],c=r.durations,h=n.map(x=>x.identifier),f=!!(o.length||h.length);(f||i)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(x=>$l(x))} pos: ${this.timelinePos}`),h.length&&this.log(`Removed events ${h}`);let p=null,g=null;a&&(p=this.updateItem(a,this.timelinePos),this.itemsMatch(a,p)?this.playingItem=p:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const y=this.bufferingItem;if(y&&(g=this.updateItem(y,this.bufferedPos),this.itemsMatch(y,g)?this.bufferingItem=g:y.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(y.event,null))),n.forEach(x=>{x.assetList.forEach(E=>{this.clearAssetPlayer(E.identifier,null)})}),this.playerQueue.forEach(x=>{if(x.interstitial.appendInPlace){const E=x.assetItem.timelineStart,_=x.timelineOffset-E;if(_)try{x.timelineOffset=E}catch(b){Math.abs(_)>mA&&this.warn(`${b} ("${x.assetId}" ${x.timelineOffset}->${E})`)}}}),f||i){if(this.hls.trigger(Y.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:c,removedIds:h}),this.isInterstitial(a)&&h.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(p,a),y&&g!==p&&this.trimInPlace(g,y),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new Sj(e),this.schedule=new _j(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(Y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(Y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(Y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(Y.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Y.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(Y.MEDIA_ENDED,this.onMediaEnded,this),e.on(Y.ERROR,this.onError,this),e.on(Y.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(Y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(Y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(Y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(Y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Y.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Y.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(Y.MEDIA_ENDED,this.onMediaEnded,this),e.off(Y.ERROR,this.onError,this),e.off(Y.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){no(e,"play",this.onPlay),no(e,"pause",this.onPause),no(e,"seeking",this.onSeeking),no(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;Ma(n,"seeking",this.onSeeking),Ma(n,"timeupdate",this.onTimeupdate),Ma(n,"play",this.onPlay),Ma(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!i){this.clearScheduleState();const r=this.findItemIndex(n);this.setSchedulePosition(r)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(this.media=null,!n&&(i&&this.removeMediaListeners(i),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.log(`Removing schedule state for detachedData and ${r}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=f=>f&&e.getAssetPlayer(f.identifier),i=(f,p,g,y,x)=>{if(f){let E=f[p].start;const _=f.event;if(_){if(p==="playout"||_.timelineOccupancy!==Eb.Point){const b=n(g);b?.interstitial===_&&(E+=b.assetItem.startOffset+b[x])}}else{const b=y==="bufferedPos"?a():e[y];E+=b-f.start}return E}return 0},r=(f,p)=>{var g;if(f!==0&&p!=="primary"&&(g=e.schedule)!=null&&g.length){var y;const x=e.schedule.findItemIndexAtTime(f),E=(y=e.schedule.items)==null?void 0:y[x];if(E){const _=E[p].start-E.start;return f+_}}return f},a=()=>{const f=e.bufferedPos;return f===Number.MAX_VALUE?o("primary"):Math.max(f,0)},o=f=>{var p,g;return(p=e.primaryDetails)!=null&&p.live?e.primaryDetails.edge:((g=e.schedule)==null?void 0:g.durations[f])||0},l=(f,p)=>{var g,y;const x=e.effectivePlayingItem;if(x!=null&&(g=x.event)!=null&&g.restrictions.skip||!e.schedule)return;e.log(`seek to ${f} "${p}"`);const E=e.effectivePlayingItem,_=e.schedule.findItemIndexAtTime(f,p),b=(y=e.schedule.items)==null?void 0:y[_],C=e.getBufferingPlayer(),I=C?.interstitial,M=I?.appendInPlace,R=E&&e.itemsMatch(E,b);if(E&&(M||R)){const D=n(e.playingAsset),P=D?.media||e.primaryMedia;if(P){const L=p==="primary"?P.currentTime:i(E,p,e.playingAsset,"timelinePos","currentTime"),O=f-L,U=(M?L:P.currentTime)+O;if(U>=0&&(!D||M||U<=D.duration)){P.currentTime=U;return}}}if(b){let D=f;if(p!=="primary"){const L=b[p].start,O=f-L;D=b.start+O}const P=!e.isInterstitial(b);if((!e.isInterstitial(E)||E.event.appendInPlace)&&(P||b.event.appendInPlace)){const L=e.media||(M?C?.media:null);L&&(L.currentTime=D)}else if(E){const L=e.findItemIndex(E);if(_>L){const U=e.schedule.findJumpRestrictedIndex(L+1,_);if(U>L){e.setSchedulePosition(U);return}}let O=0;if(P)e.timelinePos=D,e.checkBuffer();else{const U=b.event.assetList,j=f-(b[p]||b).start;for(let H=U.length;H--;){const z=U[H];if(z.duration&&j>=z.startOffset&&j<z.startOffset+z.duration){O=H;break}}}e.setSchedulePosition(_,O)}}},c=()=>{const f=e.effectivePlayingItem;if(e.isInterstitial(f))return f;const p=t();return e.isInterstitial(p)?p:null},h={get bufferedEnd(){const f=t(),p=e.bufferingItem;if(p&&p===f){var g;return i(p,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-p.playout.start||((g=e.bufferingAsset)==null?void 0:g.startOffset)||0}return 0},get currentTime(){const f=c(),p=e.effectivePlayingItem;return p&&p===f?i(p,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-p.playout.start:0},set currentTime(f){const p=c(),g=e.effectivePlayingItem;g&&g===p&&l(f+g.playout.start,"playout")},get duration(){const f=c();return f?f.playout.end-f.playout.start:0},get assetPlayers(){var f;const p=(f=c())==null?void 0:f.event.assetList;return p?p.map(g=>e.getAssetPlayer(g.identifier)):[]},get playingIndex(){var f;const p=(f=c())==null?void 0:f.event;return p&&e.effectivePlayingAsset?p.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var f;return((f=e.schedule)==null||(f=f.events)==null?void 0:f.slice(0))||[]},get schedule(){var f;return((f=e.schedule)==null||(f=f.items)==null?void 0:f.slice(0))||[]},get interstitialPlayer(){return c()?h:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const f=t();return e.findItemIndex(f)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const f=e.effectivePlayingItem;return e.findItemIndex(f)},primary:{get bufferedEnd(){return a()},get currentTime(){const f=e.timelinePos;return f>0?f:0},set currentTime(f){l(f,"primary")},get duration(){return o("primary")},get seekableStart(){var f;return((f=e.primaryDetails)==null?void 0:f.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(f){l(f,"integrated")},get duration(){return o("integrated")},get seekableStart(){var f;return r(((f=e.primaryDetails)==null?void 0:f.fragmentStart)||0,"integrated")}},skip:()=>{const f=e.effectivePlayingItem,p=f?.event;if(p&&!p.restrictions.skip){const g=e.findItemIndex(f);if(p.appendInPlace){const y=f.playout.start+f.event.duration;l(y+.001,"playout")}else e.advanceAfterAssetEnded(p,g,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const r=(t=i)==null?void 0:t.currentTime;if(!(r===void 0||!Ft(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,i=e.media;if(n&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Wi(r)}`),this.detachedData=r}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var n,i;if(e.media===t)return;let r=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,c=(n=this.detachedData)==null?void 0:n.mediaSource;let h;if(a.media)l&&(r=a.transferMedia(),this.detachedData=r),h="Primary";else if(c){const y=this.getBufferingPlayer();y?(r=y.transferMedia(),h=`${y}`):h="detached MediaSource"}else h="detached media";if(!r){if(c)r=this.detachedData,this.log(`using detachedData: MediaSource ${Wi(r)}`);else if(!this.detachedData||a.media===t){const y=this.playerQueue;y.length>1&&y.forEach(x=>{if(o&&x.interstitial.appendInPlace!==l){const E=x.interstitial;this.clearInterstitial(x.interstitial,null),E.appendInPlace=!1,E.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${E}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const f=r&&"mediaSource"in r&&((i=r.mediaSource)==null?void 0:i.readyState)!=="closed",p=f&&r?r:t;this.log(`${f?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${h} (media.currentTime: ${t.currentTime})`);const g=this.schedule;if(p===r&&g){const y=o&&e.assetId===g.assetIdAtEnd;p.overrides={duration:g.duration,endOfStream:!o||y,cueRemoval:!o}}e.attachMedia(p)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,i=this.effectivePlayingItem;if(n===-1){const r=this.hls.startPosition;if(this.log(__("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(r>=0||!this.primaryLive){const a=this.timelinePos=r>0?r:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(i&&!this.playingItem){const r=e.findItemIndex(i);this.setSchedulePosition(r)}}advanceAssetBuffering(e,t){const n=e.event,i=n.findAssetIndex(t),r=M1(n,i);if(!n.isAssetPastPlayoutLimit(r))this.bufferedToEvent(e,r);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,n){const i=M1(e,n);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const r=this.schedule.items;if(r){const a=t+1,o=r.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(__("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const r=e.assetList[i];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const i=t.parentIdentifier,r=n.getEvent(i);if(r){const a=n.findEventIndex(i),o=n.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,a,o-1)}}setSchedulePosition(e,t){var n;const i=(n=this.schedule)==null?void 0:n.items;if(!i||this.playbackDisabled)return;const r=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${r&&$l(r)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const h=a.event,f=this.playingAsset,p=f?.identifier,g=p?this.getAssetPlayer(p):null;if(g&&p&&(!this.eventItemsMatch(a,r)||t!==void 0&&p!==h.assetList[t].identifier)){var l;const y=h.findAssetIndex(f);if(this.log(`INTERSTITIAL_ASSET_ENDED ${y+1}/${h.assetList.length} ${nA(f)}`),this.endedAsset=f,this.playingAsset=null,this.hls.trigger(Y.INTERSTITIAL_ASSET_ENDED,{asset:f,assetListIndex:y,event:h,schedule:i.slice(0),scheduleIndex:e,player:g}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(h,this.findItemIndex(this.playingItem),y);return}this.retreiveMediaSource(p,r),g.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&g.detachMedia()}if(!this.eventItemsMatch(a,r)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${$l(a)}`),h.hasPlayed=!0,this.hls.trigger(Y.INTERSTITIAL_ENDED,{event:h,schedule:i.slice(0),scheduleIndex:e}),h.cue.once)){var c;this.updateSchedule();const y=(c=this.schedule)==null?void 0:c.items;if(r&&y){const x=this.findItemIndex(r);this.advanceSchedule(x,y,t,a,o)}return}}this.advanceSchedule(e,i,t,a,o)}advanceSchedule(e,t,n,i,r){const a=this.schedule;if(!a)return;const o=t[e]||null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(h=>{const f=h.interstitial,p=a.findEventIndex(f.identifier);(p<e||p>e+1)&&this.clearInterstitial(f,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const h=o.event;if(n===void 0){n=a.findAssetIndex(h,this.timelinePos);const y=M1(h,n-1);if(h.isAssetPastPlayoutLimit(y)||h.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(h,e,n);return}n=y}const f=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);let p=this.preloadAssets(h,n);if(this.eventItemsMatch(o,f||i)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${$l(o)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(Y.INTERSTITIAL_STARTED,{event:h,schedule:t.slice(0),scheduleIndex:e})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const g=h.assetList[n];if(!g){this.advanceAfterAssetEnded(h,e,n||0);return}if(p||(p=this.getAssetPlayer(g.identifier)),p===null||p.destroyed){const y=h.assetList.length;this.warn(`asset ${n+1}/${y} player destroyed ${h}`),p=this.createAssetPlayer(h,g,n),p.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(g))return;this.startAssetPlayer(p,n,t,e,l),this.shouldPlay&&B2(p.media)}else o?(this.resumePrimary(o,e,i),this.shouldPlay&&B2(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var i,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${$l(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(__("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!n)return;const a=(r=this.schedule)==null?void 0:r.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${$l(e)}`),this.hls.trigger(Y.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(n<i.fragmentStart||n>i.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:xn.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(__("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((n=i.mainForwardBufferInfo)==null?void 0:n.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(Y.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(Y.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level],i=Di(Di({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Di(Di({},this.altSelection),{},{audio:n});return}const r=Di(Di({},i),{},{audio:n});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Di(Di({},this.altSelection),{},{subtitles:n});return}const r=Di(Di({},i),{},{subtitles:n});this.mediaSelection=r}onAudioTrackSwitching(e,t){const n=zL(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(t)||i.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=zL(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(t)||t.id!==-1&&i.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const r=t[i];if(r.cue.post){var n;const a=this.schedule.findEventIndex(r.identifier),o=(n=this.schedule.items)==null?void 0:n[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const i=(n=this.schedule)==null?void 0:n.items;if(e&&i){const r=this.findItemIndex(e,t);return i[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(r.identifier,null)});const n=e.end+.25,i=xn.bufferInfo(this.primaryMedia,n,0);(i.end>n||(i.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${$l(e)} (was ${$l(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const i=xn.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,n,e)}updateBufferedPos(e,t,n){const i=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const h=this.findItemIndex(r),f=Math.min(h+1,t.length-1),p=t[f];if((l===-1&&r&&e>=r.end||(c=p.event)!=null&&c.appendInPlace&&e+.01>=p.start)&&(l=f),this.isInterstitial(r)){const g=r.event;if(f-o>1&&g.appendInPlace===!1||g.assetList.length===0&&g.assetListLoader)return}if(this.bufferedPos=e,l>h&&l>o)this.bufferedToItem(p);else{const g=this.primaryDetails;this.primaryLive&&g&&e>g.edge-g.targetduration&&p.start<g.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(p)&&this.preloadAssets(p.event,0)}}else n&&a&&!this.itemsMatch(a,r)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const r=this.getAssetPlayer(i.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:i,events:r}=n;if(!i||!r)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${$l(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const c=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((h,f)=>{const p=this.getAssetPlayer(h.identifier);p&&(f===c&&p.loadSource(),p.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(Y.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,i=n.assetList.length===0&&!n.assetListLoader,r=n.cue.once;if(i||!r){const a=this.preloadAssets(n,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const n=e.assetUrl,i=e.assetList.length,r=i===0&&!e.assetListLoader,a=e.cue.once;if(r){const l=e.timelineStart;if(e.appendInPlace){var o;const p=this.playingItem;!this.isInterstitial(p)&&(p==null||(o=p.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,h=0;if(!this.playingItem&&this.primaryLive&&(h=this.hls.startPosition,h===-1&&(h=this.hls.liveSyncPosition||0)),h&&!(e.cue.pre||e.cue.post)){const p=h-l;p>0&&(c=Math.round(p*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:i} ${e}${c?` live-start: ${h} start-offset: ${c}`:""}`),n)return this.createAsset(e,0,0,l,e.duration,n);const f=this.assetListLoader.loadAssetList(e,c);f&&(e.assetListLoader=f)}else if(!a&&i){for(let c=t;c<i;c++){const h=e.assetList[c],f=this.getAssetPlayerQueueIndex(h.identifier);(f===-1||this.playerQueue[f].destroyed)&&!h.error&&this.createAssetPlayer(e,h,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(Y.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,i,r,a){const o={parentIdentifier:e.identifier,identifier:yj(e,a,t),duration:r,startOffset:n,timelineStart:i,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,n){const i=this.hls,r=i.userConfig;let a=r.videoPreference;const o=i.loadLevelObj||i.levels[i.currentLevel];(a||o)&&(a=Li({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=i.audioTracks[i.audioTrack],c=i.subtitleTracks[i.subtitleTrack];let h=0;if(this.primaryLive||e.appendInPlace){const I=this.timelinePos-t.timelineStart;if(I>1){const M=t.duration;M&&I<M&&(h=I)}}const f=t.identifier,p=Di(Di({},r),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:f,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:h,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||r.audioPreference,subtitlePreference:c||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(p.timelineOffset=t.timelineStart));const g=p.cmcd;g!=null&&g.sessionId&&g.contentId&&(p.cmcd=Li({},g,{contentId:uv(t.uri)})),this.getAssetPlayer(f)&&this.warn(`Duplicate date range identifier ${e} and asset ${f}`);const y=new xj(this.HlsPlayerClass,p,e,t);this.playerQueue.push(y),e.assetList[n]=t;let x=!0;const E=I=>{if(I.live){var M;const P=new Error(`Interstitials MUST be VOD assets ${e}`),L={fatal:!0,type:Wt.OTHER_ERROR,details:He.INTERSTITIAL_ASSET_ITEM_ERROR,error:P},O=((M=this.schedule)==null?void 0:M.findEventIndex(e.identifier))||-1;this.handleAssetItemError(L,e,O,n,P.message);return}const R=I.edge-I.fragmentStart,D=t.duration;(x||D===null||R>D)&&(x=!1,this.log(`Interstitial asset "${f}" duration change ${D} > ${R}`),t.duration=R,this.updateSchedule())};y.on(Y.LEVEL_UPDATED,(I,{details:M})=>E(M)),y.on(Y.LEVEL_PTS_UPDATED,(I,{details:M})=>E(M)),y.on(Y.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const _=(I,M)=>{const R=this.getAssetPlayer(f);if(R&&M.tracks){R.off(Y.BUFFER_CODECS,_),R.tracks=M.tracks;const D=this.primaryMedia;this.bufferingAsset===R.assetItem&&D&&!R.media&&this.bufferAssetPlayer(R,D)}};y.on(Y.BUFFER_CODECS,_);const b=()=>{var I;const M=this.getAssetPlayer(f);if(this.log(`buffered to end of asset ${M}`),!M||!this.schedule)return;const R=this.schedule.findEventIndex(e.identifier),D=(I=this.schedule.items)==null?void 0:I[R];this.isInterstitial(D)&&this.advanceAssetBuffering(D,t)};y.on(Y.BUFFERED_TO_END,b);const C=I=>()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;this.shouldPlay=!0;const R=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,R,I)};return y.once(Y.MEDIA_ENDED,C(n)),y.once(Y.PLAYOUT_LIMIT_REACHED,C(1/0)),y.on(Y.ERROR,(I,M)=>{if(!this.schedule)return;const R=this.getAssetPlayer(f);if(M.details===He.BUFFER_STALLED_ERROR){if(R!=null&&R.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(M,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${M.error} ${e}`)}),y.on(Y.DESTROYING,()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;const M=new Error(`Asset player destroyed unexpectedly ${f}`),R={fatal:!0,type:Wt.OTHER_ERROR,details:He.INTERSTITIAL_ASSET_ITEM_ERROR,error:M};this.handleAssetItemError(R,e,this.schedule.findEventIndex(e.identifier),n,M.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${nA(t)}`),this.hls.trigger(Y.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:y}),y}clearInterstitial(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const i=this.playerQueue[n];this.log(`clear ${i} toSegment: ${t&&$l(t)}`),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(n,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,i,r){const{interstitial:a,assetItem:o,assetId:l}=e,c=a.assetList.length,h=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!h||h.identifier!==l)&&(h&&(this.clearAssetPlayer(h.identifier,n[i]),delete h.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${nA(o)}`),this.hls.trigger(Y.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:n.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var n,i;if(!this.schedule)return;const{interstitial:r,assetItem:a}=e,o=this.schedule.findEventIndex(r.identifier),l=(n=this.schedule.items)==null?void 0:n[o];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=a;const c=this.getBufferingPlayer();if(c===e)return;const h=r.appendInPlace;if(h&&c?.interstitial.appendInPlace===!1)return;const f=c?.tracks||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(h&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(f&&!uU(f,e.tracks)){const p=new Error(`Asset ${nA(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(f)}')`),g={fatal:!0,type:Wt.OTHER_ERROR,details:He.INTERSTITIAL_ASSET_ITEM_ERROR,error:p},y=r.findAssetIndex(a);this.handleAssetItemError(g,r,o,y,p.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const i=n.currentTime,r=t.findAssetIndex(e,i),a=e.assetList[r];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const l=o.currentTime||i-a.timelineStart,c=o.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${o} ${e} (media.currentTime: ${i})`),l&&(c/n.playbackRate<.5||o.bufferedInPlaceToEnd(n))&&o.hls){const h=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,h,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,i,r){if(e.details===He.BUFFER_STALLED_ERROR)return;const a=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&nA(a)} ${e.error}`),!this.schedule)return;const o=a?.identifier||"",l=this.getAssetPlayerQueueIndex(o),c=this.playerQueue[l]||null,h=this.schedule.items,f=Li({},e,{fatal:!1,errorAction:fA(!0),asset:a,assetListIndex:i,event:t,schedule:h,scheduleIndex:n,player:c});if(this.hls.trigger(Y.INTERSTITIAL_ASSET_ERROR,f),!e.fatal)return;const p=this.playingAsset,g=this.bufferingAsset,y=new Error(r);if(a&&(this.clearAssetPlayer(o,null),a.error=y),!t.assetList.some(x=>!x.error))t.error=y;else for(let x=i;x<t.assetList.length;x++)this.resetAssetPlayer(t.assetList[x].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):p&&p.identifier===o?this.advanceAfterAssetEnded(t,n,i):g&&g.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,g)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${$l(n)} error: ${e.error}`);let i=this.timelinePos;i===-1&&(i=this.hls.startPosition);const r=this.updateItem(n,i);if(this.itemsMatch(n,r)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const a=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var n,i;const r=t.event,a=r.identifier,o=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(a)))return;const l=r.timelineStart,c=r.duration;let h=0;o.forEach((x,E)=>{const _=parseFloat(x.DURATION);this.createAsset(r,E,h,l+h,_,x.URI),h+=_}),r.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${c}) ${r}`);const f=this.waitingItem,p=f?.event.identifier===a;this.updateSchedule();const g=(i=this.bufferingItem)==null?void 0:i.event;if(p){var y;const x=this.schedule.findEventIndex(a),E=(y=this.schedule.items)==null?void 0:y[x];if(E){if(!this.playingItem&&this.timelinePos>E.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==x){r.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${r}`),this.updateSchedule(!0),this.primaryFallback(r);return}this.setBufferingItem(E)}this.setSchedulePosition(x)}else if(g?.identifier===a){const x=r.assetList[0];if(x){const E=this.getAssetPlayer(x.identifier);if(g.appendInPlace){const _=this.primaryMedia;E&&_&&this.bufferAssetPlayer(E,_)}else E&&E.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case He.ASSET_LIST_PARSING_ERROR:case He.ASSET_LIST_LOAD_ERROR:case He.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case He.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const D2=500;class Tj extends VR{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",jt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(Y.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(Y.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ut.IDLE,this.setInterval(D2),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:i}=t;if(this.fragContextChanged(n)||(Ks(n)&&(this.fragPrevious=n),this.state=ut.IDLE),!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let a;const o=n.start;for(let c=0;c<r.length;c++)if(o>=r[c].start&&o<=r[c].end){a=r[c];break}const l=n.start+n.duration;a?a.end=l:(a={start:o,end:l},r.push(a)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:i}=t;if(n===0&&i!==Number.POSITIVE_INFINITY){const r=i-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=r){a.shift();continue}else if(a[o].start<r)a[o].start=r;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(n,r,jt.SUBTITLE)}}onError(e,t){const n=t.frag;n?.type===jt.SUBTITLE&&(t.details===He.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ut.STOPPED&&(this.state=ut.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&l3(this.levels,t)){this.levels=t.map(n=>new Mv(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const i=new Mv(n);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,jt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==ut.STOPPED&&this.setInterval(D2)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:i,levels:r}=this,{details:a,id:o}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=r[o];if(o>=r.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(a.live||(n=l.details)!=null&&n.live){if(a.deltaUpdateFailed)return;const f=this.mainDetails;if(!f){this.startFragRequested=!1;return}const p=f.fragments[0];if(!l.details)a.hasProgramDateTime&&f.hasProgramDateTime?(yb(a,f),c=a.fragmentStart):p&&(c=p.start,uw(a,c));else{var h;c=this.alignPlaylists(a,l.details,(h=this.levelLastLoaded)==null?void 0:h.details),c===0&&p&&(c=p.start,uw(a,c))}f&&!this.startFragRequested&&this.setStartPosition(f,c)}l.details=a,this.levelLastLoaded=l,o===i&&(this.hls.trigger(Y.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===ut.IDLE&&(um(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&i!=null&&i.key&&i.iv&&dA(i.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,zR(i.method)).catch(o=>{throw r.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();r.trigger(Y.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=ut.IDLE})}}doTick(){if(!this.media){this.state=ut.IDLE;return}if(this.state===ut.IDLE){const{currentTrackId:e,levels:t}=this,n=t?.[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:i}=this,r=this.getLoadPosition(),a=xn.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:o,len:l}=a,c=n.details,h=this.hls.maxBufferLength+c.levelTargetDuration;if(l>h)return;const f=c.fragments,p=f.length,g=c.edge;let y=null;const x=this.fragPrevious;if(o<g){const b=i.maxFragLookUpTolerance,C=o>g-b?0:b;y=um(x,f,Math.max(f[0].start,o),C),!y&&x&&x.start<f[0].start&&(y=f[0])}else y=f[p-1];if(y=this.filterReplacedPrimary(y,n.details),!y)return;const E=y.sn-c.startSN,_=f[E-1];if(_&&_.cc===y.cc&&this.fragmentTracker.getState(_)===ur.NOT_LOADED&&(y=_),this.fragmentTracker.getState(y)===ur.NOT_LOADED){const b=this.mapToInitFragWhenRequired(y);b&&this.loadFragment(b,n,o)}}}loadFragment(e,t,n){Ks(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Cj(this.tracksBuffered[this.currentTrackId]||[])}}class Cj{constructor(e){this.buffered=void 0;const t=(n,i,r)=>{if(i=i>>>0,i>r-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${r})`);return e[i][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const Ij={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},b3=s=>String.fromCharCode(Ij[s]||s),oc=15,ih=100,Mj={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},wj={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Rj={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Bj={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Dj=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Lj{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;_i.log(`${this.time} [${e}] ${n}`)}}}const Ap=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class T3{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Oj{constructor(){this.uchar=" ",this.penState=new T3}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Pj{constructor(e){this.chars=[],this.pos=0,this.currPenState=new T3,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<ih;t++)this.chars.push(new Oj);this.logger=e}equals(e){for(let t=0;t<ih;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<ih;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<ih;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ih&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ih)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=b3(e);if(this.pos>=ih){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<ih;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<ih;n++){const i=this.chars[n].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class w1{constructor(e){this.rows=[],this.currRow=oc-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<oc;t++)this.rows.push(new Pj(e));this.logger=e}reset(){for(let e=0;e<oc;e++)this.rows[e].clear();this.currRow=oc-1}equals(e){let t=!0;for(let n=0;n<oc;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<oc;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<oc;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Wi(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<oc;o++)this.rows[o].clear();const r=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[r].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[r+c])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,a=Math.max(r-1,0);n.setCursor(e.indent),e.color=n.chars[a].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Wi(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",i=-1;for(let r=0;r<oc;r++){const a=this.rows[r].getTextString();a&&(i=r+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class L2{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new w1(n),this.nonDisplayedMemory=new w1(n),this.lastOutputScreen=new w1(n),this.currRollUpRow=this.displayedMemory.rows[oc-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[oc-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+Wi(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class O2{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Fj(),this.logger=void 0;const i=this.logger=new Lj;this.channels=[null,new L2(e,t,i),new L2(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const i=t[n]&127,r=t[n+1]&127;let a=!1,o=null;if(i===0&&r===0)continue;this.logger.log(3,()=>"["+Ap([t[n],t[n+1]])+"] -> ("+Ap([i,r])+")");const l=this.cmdHistory;if(i>=16&&i<=31){if(Nj(i,r,l)){S_(null,null,l),this.logger.log(3,()=>"Repeated command ("+Ap([i,r])+") is dropped");continue}S_(i,r,this.cmdHistory),a=this.parseCmd(i,r),a||(a=this.parseMidrow(i,r)),a||(a=this.parsePAC(i,r)),a||(a=this.parseBackgroundAttributes(i,r))}else S_(null,null,l);if(!a&&(o=this.parseChars(i,r),o)){const h=this.currentChannel;h&&h>0?this.channels[h].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ap([i,r])+" orig: "+Ap([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(n||i))return!1;const r=e===20||e===21||e===23?1:2,a=this.channels[r];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ap([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(i||r))return!1;const a=e<=23?1:2;t>=64&&t<=95?n=a===1?Mj[e]:Rj[e]:n=a===1?wj[e]:Bj[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(n,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,i.underline=(n&1)===1,n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((n-16)/2)*4,i}parseChars(e,t){let n,i=null,r=null;if(e>=25?(n=2,r=e-8):(n=1,r=e),r>=17&&r<=19){let a;r===17?a=t+80:r===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+b3(a)+"' in channel "+n),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Ap(i).join(",")),i}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(n||i))return!1;let r;const a={};e===16||e===24?(r=Math.floor((t-32)/2),a.background=Dj[r],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}S_(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function S_(s,e,t){t.a=s,t.b=e}function Nj(s,e,t){return t.a===s&&t.b===e}function Fj(){return{a:null,b:null}}var nB=(function(){if(Ab!=null&&Ab.VTTCue)return self.VTTCue;const s=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const c=l.toLowerCase();return~o.indexOf(c)?c:!1}function n(o){return t(s,o)}function i(o){return t(e,o)}function r(o,...l){let c=1;for(;c<arguments.length;c++){const h=arguments[c];for(const f in h)o[f]=h[f]}return o}function a(o,l,c){const h=this,f={enumerable:!0};h.hasBeenReset=!1;let p="",g=!1,y=o,x=l,E=c,_=null,b="",C=!0,I="auto",M="start",R=50,D="middle",P=50,L="middle";Object.defineProperty(h,"id",r({},f,{get:function(){return p},set:function(O){p=""+O}})),Object.defineProperty(h,"pauseOnExit",r({},f,{get:function(){return g},set:function(O){g=!!O}})),Object.defineProperty(h,"startTime",r({},f,{get:function(){return y},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");y=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",r({},f,{get:function(){return x},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");x=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",r({},f,{get:function(){return E},set:function(O){E=""+O,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",r({},f,{get:function(){return _},set:function(O){_=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",r({},f,{get:function(){return b},set:function(O){const U=n(O);if(U===!1)throw new SyntaxError("An invalid or illegal string was specified.");b=U,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",r({},f,{get:function(){return C},set:function(O){C=!!O,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",r({},f,{get:function(){return I},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");I=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",r({},f,{get:function(){return M},set:function(O){const U=i(O);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");M=U,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",r({},f,{get:function(){return R},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");R=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",r({},f,{get:function(){return D},set:function(O){const U=i(O);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");D=U,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",r({},f,{get:function(){return P},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");P=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",r({},f,{get:function(){return L},set:function(O){const U=i(O);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");L=U,this.hasBeenReset=!0}})),h.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class Uj{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function C3(s){function e(n,i,r,a){return(n|0)*3600+(i|0)*60+(r|0)+parseFloat(a||0)}const t=s.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class kj{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function I3(s,e,t,n){const i=n?s.split(n):[s];for(const r in i){if(typeof i[r]!="string")continue;const a=i[r].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const yw=new nB(0,0,""),b_=yw.align==="middle"?"middle":"center";function Gj(s,e,t){const n=s;function i(){const o=C3(s);if(o===null)throw new Error("Malformed timestamp: "+n);return s=s.replace(/^[^\sa-zA-Z-]+/,""),o}function r(o,l){const c=new kj;I3(o,function(p,g){let y;switch(p){case"region":for(let x=t.length-1;x>=0;x--)if(t[x].id===g){c.set(p,t[x].region);break}break;case"vertical":c.alt(p,g,["rl","lr"]);break;case"line":y=g.split(","),c.integer(p,y[0]),c.percent(p,y[0])&&c.set("snapToLines",!1),c.alt(p,y[0],["auto"]),y.length===2&&c.alt("lineAlign",y[1],["start",b_,"end"]);break;case"position":y=g.split(","),c.percent(p,y[0]),y.length===2&&c.alt("positionAlign",y[1],["start",b_,"end","line-left","line-right","auto"]);break;case"size":c.percent(p,g);break;case"align":c.alt(p,g,["start",b_,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let h=c.get("line","auto");h==="auto"&&yw.line===-1&&(h=-1),l.line=h,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",b_);let f=c.get("position","auto");f==="auto"&&yw.position===50&&(f=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=f}function a(){s=s.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),s.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);s=s.slice(3),a(),e.endTime=i(),a(),r(s,e)}function M3(s){return s.replace(/<br(?: \/)?>/gi,`
`)}class Hj{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Uj,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let r=t.buffer,a=0;for(r=M3(r);a<r.length&&r[a]!=="\r"&&r[a]!==`
`;)++a;const o=r.slice(0,a);return r[a]==="\r"&&++a,r[a]===`
`&&++a,t.buffer=r.slice(a),o}function i(r){I3(r,function(a,o){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=n();const o=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:r=n(),t.state){case"HEADER":/:/.test(r)?i(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new nB(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Gj(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=r.indexOf("-->")!==-1;if(!r||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const zj=/\r\n|\n\r|\n|\r/g,R1=function(e,t,n=0){return e.slice(n,n+t.length)===t},Qj=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ft(t)||!Ft(n)||!Ft(i)||!Ft(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*i,t+=3600*1e3*r,t};function iB(s,e,t){return uv(s.toString())+uv(e.toString())+uv(t)}const Vj=function(e,t,n){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=r)!=null&&a.new;){var a;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=n};function jj(s,e,t,n,i,r,a){const o=new Hj,l=Fo(new Uint8Array(s)).trim().replace(zj,`
`).split(`
`),c=[],h=e?J6(e.baseTime,e.timescale):0;let f="00:00.000",p=0,g=0,y,x=!0;o.oncue=function(E){const _=t[n];let b=t.ccOffset;const C=(p-h)/9e4;if(_!=null&&_.new&&(g!==void 0?b=t.ccOffset=_.start:Vj(t,n,C)),C){if(!e){y=new Error("Missing initPTS for VTT MPEGTS");return}b=C-t.presentationOffset}const I=E.endTime-E.startTime,M=pl((E.startTime+b-g)*9e4,i*9e4)/9e4;E.startTime=Math.max(M,0),E.endTime=Math.max(M+I,0);const R=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(R)),E.id||(E.id=iB(E.startTime,E.endTime,R)),E.endTime>0&&c.push(E)},o.onparsingerror=function(E){y=E},o.onflush=function(){if(y){a(y);return}r(c)},l.forEach(E=>{if(x)if(R1(E,"X-TIMESTAMP-MAP=")){x=!1,E.slice(16).split(",").forEach(_=>{R1(_,"LOCAL:")?f=_.slice(6):R1(_,"MPEGTS:")&&(p=parseInt(_.slice(7)))});try{g=Qj(f)/1e3}catch(_){y=_}return}else E===""&&(x=!1);o.parse(E+`
`)}),o.flush()}const B1="stpp.ttml.im1t",w3=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,R3=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,qj={left:"start",center:"center",right:"end",start:"start",end:"end"};function P2(s,e,t,n){const i=Fn(new Uint8Array(s),["mdat"]);if(i.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const r=i.map(o=>Fo(o)),a=$6(e.baseTime,1,e.timescale);try{r.forEach(o=>t(Kj(o,a)))}catch(o){n(o)}}function Kj(s,e){const i=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(r).reduce((f,p)=>(f[p]=i.getAttribute(`ttp:${p}`)||r[p],f),{}),o=i.getAttribute("xml:space")!=="preserve",l=N2(D1(i,"styling","style")),c=N2(D1(i,"layout","region")),h=D1(i,"body","[begin]");return[].map.call(h,f=>{const p=B3(f,o);if(!p||!f.hasAttribute("begin"))return null;const g=O1(f.getAttribute("begin"),a),y=O1(f.getAttribute("dur"),a);let x=O1(f.getAttribute("end"),a);if(g===null)throw F2(f);if(x===null){if(y===null)throw F2(f);x=g+y}const E=new nB(g-e,x-e,p);E.id=iB(E.startTime,E.endTime,E.text);const _=c[f.getAttribute("region")],b=l[f.getAttribute("style")],C=Yj(_,b,l),{textAlign:I}=C;if(I){const M=qj[I];M&&(E.lineAlign=M),E.align=I}return Li(E,C),E}).filter(f=>f!==null)}function D1(s,e,t){const n=s.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function N2(s){return s.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function B3(s,e){return[].slice.call(s.childNodes).reduce((t,n,i)=>{var r;return n.nodeName==="br"&&i?t+`
`:(r=n.childNodes)!=null&&r.length?B3(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function Yj(s,e,t){const n="http://www.w3.org/ns/ttml#styling";let i=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=s!=null&&s.hasAttribute("style")?s.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),r.reduce((o,l)=>{const c=L1(e,n,l)||L1(s,n,l)||L1(i,n,l);return c&&(o[l]=c),o},{})}function L1(s,e,t){return s&&s.hasAttributeNS(e,t)?s.getAttributeNS(e,t):null}function F2(s){return new Error(`Could not parse ttml timestamp ${s}`)}function O1(s,e){if(!s)return null;let t=C3(s);return t===null&&(w3.test(s)?t=Xj(s,e):R3.test(s)&&(t=Wj(s,e))),t}function Xj(s,e){const t=w3.exec(s),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function Wj(s,e){const t=R3.exec(s),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class T_{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class $j{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=k2(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Y.FRAG_LOADING,this.onFragLoading,this),e.on(Y.FRAG_LOADED,this.onFragLoaded,this),e.on(Y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(Y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(Y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(Y.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Y.FRAG_LOADING,this.onFragLoading,this),e.off(Y.FRAG_LOADED,this.onFragLoaded,this),e.off(Y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(Y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(Y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(Y.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new T_(this,"textTrack1"),t=new T_(this,"textTrack2"),n=new T_(this,"textTrack3"),i=new T_(this,"textTrack4");this.cea608Parser1=new O2(1,e,t),this.cea608Parser2=new O2(3,n,i)}addCues(e,t,n,i,r){let a=!1;for(let o=r.length;o--;){const l=r[o],c=Jj(l[0],l[1],t,n);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],n),a=!0,c/(n-t)>.5))return}if(a||r.push([t,n]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,n,i)}else{const o=this.Cues.newCue(null,t,n,i);this.hls.trigger(Y.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:r,trackId:a}){const{unparsedVttFrags:o}=this;n===jt.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:r,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(Y.FRAG_LOADED,l):this.hls.trigger(Y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const r=n.textTracks[i];if(U2(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:i}=this,{label:r,languageCode:a}=t[e],o=this.getExistingTrack(r,a);if(o)n[e]=o,rA(n[e]),x3(n[e],i);else{const l=this.createTextTrack("captions",r,a);l&&(l[e]=!0,n[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,i={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(Y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,n){const i=this.media;if(i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:i}=this;Object.keys(i).forEach(r=>{rA(i[r]),delete i[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=k2(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)rA(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],i=n.some(r=>r.textCodec===B1);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(l3(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const a=this.media,o=a?VS(a.textTracks):null;if(this.tracks.forEach((l,c)=>{let h;if(o){let f=null;for(let p=0;p<o.length;p++)if(o[p]&&U2(o[p],l)){f=o[p],o[p]=null;break}f&&(h=f)}if(h)rA(h);else{const f=D3(l);h=this.createTextTrack(f,l.name,l.lang),h&&(h.mode="disabled")}h&&this.textTracks.push(h)}),o!=null&&o.length){const l=o.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(Y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const i=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!i)return;const r=`textTrack${i[1]}`,a=this.captionsProperties[r];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===jt.MAIN){var n,i;const{cea608Parser1:r,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:c}=t.frag,h=(n=(i=t.part)==null?void 0:i.index)!=null?n:-1;r&&a&&(c!==o+1||c===o&&h!==this.lastPartIndex+1||l!==this.lastCc)&&(r.reset(),a.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=h}}onFragLoaded(e,t){const{frag:n,payload:i}=t;if(n.type===jt.SUBTITLE)if(i.byteLength){const r=n.decryptdata,a="stats"in t;if(r==null||!r.encrypted||a){const o=this.tracks[n.level],l=this.vttCCs;l[n.cc]||(l[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),o&&o.textCodec===B1?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger(Y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;P2(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),n.trigger(Y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{n.logger.log(`Failed to parse IMSC1: ${i}`),n.trigger(Y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:n,payload:i}=e,{initPTS:r,unparsedVttFrags:a}=this,o=r.length-1;if(!r[n.cc]&&o===-1){a.push(e);return}const l=this.hls,c=(t=n.initSegment)!=null&&t.data?xl(n.initSegment.data,new Uint8Array(i)).buffer:i;jj(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,h=>{this._appendCues(h,n.level),l.trigger(Y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},h=>{const f=h.message==="Missing initPTS for VTT MPEGTS";f?a.push(e):this._fallbackToIMSC1(n,i),l.logger.log(`Failed to parse VTT cue: ${h}`),!(f&&o>n.cc)&&l.trigger(Y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:h})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||P2(t,this.initPTS[e.cc],()=>{n.textCodec=B1,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(r=>_3(i,r))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;n.trigger(Y.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===jt.SUBTITLE&&this.onFragLoaded(Y.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:i}=t;if(!(n.type===jt.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let r=0;r<i.length;r++){const a=i[r].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(i[r].pts,o[0]),this.cea608Parser2.addData(i[r].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:i,type:r}){const{media:a}=this;if(!(!a||a.currentTime<n)){if(!r||r==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>Aw(o[l],t,n))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>Aw(o[l],t,i))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let i=2;for(let r=0;r<n;r++){const a=e[i++],o=127&e[i++],l=127&e[i++];if(o===0&&l===0)continue;if((4&a)!==0){const h=3&a;(h===0||h===1)&&(t[h].push(o),t[h].push(l))}}return t}}function D3(s){return s.characteristics&&/transcribes-spoken-dialog/gi.test(s.characteristics)&&/describes-music-and-sound/gi.test(s.characteristics)?"captions":"subtitles"}function U2(s,e){return!!s&&s.kind===D3(e)&&dw(e,s)}function Jj(s,e,t,n){return Math.min(e,n)-Math.max(s,t)}function k2(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const Zj=/\s/,eq={newCue(s,e,t,n){const i=[];let r,a,o,l,c;const h=self.VTTCue||self.TextTrackCue;for(let p=0;p<n.rows.length;p++)if(r=n.rows[p],o=!0,l=0,c="",!r.isEmpty()){var f;for(let x=0;x<r.chars.length;x++)Zj.test(r.chars[x].uchar)&&o?l++:(c+=r.chars[x].uchar,o=!1);r.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const g=M3(c.trim()),y=iB(e,t,g);s!=null&&(f=s.cues)!=null&&f.getCueById(y)||(a=new h(e,t,g),a.id=y,a.line=p+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),i.push(a))}return s&&i.length&&(i.sort((p,g)=>p.line==="auto"||g.line==="auto"?0:p.line>8&&g.line>8?g.line-p.line:p.line-g.line),i.forEach(p=>_3(s,p))),i}};function tq(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const nq=/(\d+)-(\d+)\/(\d+)/;class G2{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||aq,this.controller=new self.AbortController,this.stats=new PR}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=iq(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=l&&Ft(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(Bv(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(f=>{var p;this.response=this.loader=f;const g=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},c-(g-i.loading.start)),!f.ok){const{status:x,statusText:E}=f;throw new oq(E||"fetch, bad network response",x,f)}i.loading.first=g,i.total=rq(f.headers)||i.total;const y=(p=this.callbacks)==null?void 0:p.onProgress;return y&&Ft(t.highWaterMark)?this.loadProgressively(f,i,e,t.highWaterMark,y):a?f.arrayBuffer():e.responseType==="json"?f.json():f.text()}).then(f=>{var p,g;const y=this.response;if(!y)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const x=f[o];x&&(i.loaded=i.total=x);const E={url:y.url,data:f,code:y.status},_=(p=this.callbacks)==null?void 0:p.onProgress;_&&!Ft(t.highWaterMark)&&_(i,e,f,y),(g=this.callbacks)==null||g.onSuccess(E,i,e,y)}).catch(f=>{var p;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const g=f&&f.code||0,y=f?f.message:null;(p=this.callbacks)==null||p.onError({code:g,text:y},e,f?f.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,i=0,r){const a=new zU,o=e.body.getReader(),l=()=>o.read().then(c=>{if(c.done)return a.dataLength&&r(t,n,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const h=c.value,f=h.length;return t.loaded+=f,f<i||a.dataLength?(a.push(h),a.dataLength>=i&&r(t,n,a.flush().buffer,e)):r(t,n,h.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function iq(s,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Li({},s.headers))};return s.rangeEnd&&t.headers.set("Range","bytes="+s.rangeStart+"-"+String(s.rangeEnd-1)),t}function sq(s){const e=nq.exec(s);if(e)return parseInt(e[2])-parseInt(e[1])+1}function rq(s){const e=s.get("Content-Range");if(e){const n=sq(e);if(Ft(n))return n}const t=s.get("Content-Length");if(t)return parseInt(t)}function aq(s,e){return new self.Request(s.url,e)}class oq extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const lq=/^age:\s*[\d.]+\s*$/im;class L3{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new PR,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return r(n,t.url)}).catch(a=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),r(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:n.status,text:a.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:a}=n.loadPolicy;if(i)for(const o in i)e.setRequestHeader(o,i[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=r&&Ft(r)?r:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!n.aborted&&i>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,h=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const y=h??t.response;if(y!=null){var a,o;n.loading.end=Math.max(self.performance.now(),n.loading.first);const x=t.responseType==="arraybuffer"?y.byteLength:y.length;n.loaded=n.total=x,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const E=(a=this.callbacks)==null?void 0:a.onProgress;E&&E(n,e,y,t);const _={url:t.responseURL,data:y,code:c};(o=this.callbacks)==null||o.onSuccess(_,n,e,t);return}}const f=r.loadPolicy.errorRetry,p=n.retry,g={url:e.url,data:void 0,code:c};if(gb(f,p,!1,g))this.retry(f);else{var l;_i.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(gb(e,t,!0))this.retry(e);else{var n;_i.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=kR(e,n.retry),n.retry++,_i.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&lq.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const cq={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},uq=Di(Di({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:L3,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:xV,bufferController:d9,capLevelController:ZR,errorController:CV,fpsController:dj,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:DU,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:cq},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},hq()),{},{subtitleStreamController:Tj,subtitleTrackController:gj,timelineController:$j,audioStreamController:c9,audioTrackController:u9,emeController:pA,cmcdController:uj,contentSteeringController:fj,interstitialsController:bj});function hq(){return{cueHandler:eq,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function fq(s,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=vw(s),i=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,c=[];r.forEach(h=>{const f=`${a}Loading${h}`,p=e[f];if(p!==void 0&&l){c.push(f);const g=n[o].default;switch(e[o]={default:g},h){case"TimeOut":g.maxLoadTimeMs=p,g.maxTimeToFirstByteMs=p;break;case"MaxRetry":g.errorRetry.maxNumRetry=p,g.timeoutRetry.maxNumRetry=p;break;case"RetryDelay":g.errorRetry.retryDelayMs=p,g.timeoutRetry.retryDelayMs=p;break;case"MaxRetryTimeout":g.errorRetry.maxRetryDelayMs=p,g.timeoutRetry.maxRetryDelayMs=p;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${o}": ${Wi(e[o])}`)}),Di(Di({},n),e)}function vw(s){return s&&typeof s=="object"?Array.isArray(s)?s.map(vw):Object.keys(s).reduce((e,t)=>(e[t]=vw(s[t]),e),{}):s}function dq(s,e){const t=s.loader;t!==G2&&t!==L3?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1):tq()&&(s.loader=G2,s.progressive=!0,s.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const jS=2,pq=.1,mq=.05,gq=100;class Aq extends MU{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(Y.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Y.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Y.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(gq),this.mediaSource=t.mediaSource;const n=this.media=t.media;Ma(n,"playing",this.onMediaPlaying),Ma(n,"waiting",this.onMediaWaiting),Ma(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(no(n,"playing",this.onMediaPlaying),no(n,"waiting",this.onMediaWaiting),no(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,i;const r=(n=this.hls)==null?void 0:n.config;if(!r)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,c=!this.seeking&&o,h=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!h&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(h){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(Y.MEDIA_ENDED,{stalled:!1}));return}if(!xn.getBuffered(a).length){this.nudgeRetry=0;return}const f=xn.bufferInfo(a,e,0),p=f.nextStart||0,g=this.fragmentTracker;if(o&&g&&this.hls){const R=H2(this.hls.inFlightFragments,e),D=f.len>jS,P=!p||R||p-e>jS&&!g.getPartialFragment(e);if(D||P)return;this.moved=!1}const y=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&g){if(!(f.len>0)&&!p)return;const D=Math.max(p,f.start||0)-e,L=!!(y!=null&&y.live)?y.targetduration*2:jS,O=C_(e,g);if(D>0&&(D<=L||O)){a.paused||this._trySkipBufferHole(O);return}}const x=r.detectStallWithCurrentTimeMs,E=self.performance.now(),_=this.waiting;let b=this.stalled;if(b===null)if(_>0&&E-_<x)b=this.stalled=_;else{this.stalled=E;return}const C=E-b;if(!o&&(C>=x||_)&&this.hls){var I;if(((I=this.mediaSource)==null?void 0:I.readyState)==="ended"&&!(y!=null&&y.live)&&Math.abs(e-(y?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(Y.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(f),!this.media||!this.hls)return}const M=xn.bufferInfo(a,e,r.maxBufferHole);this._tryFixBufferStall(M,C,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(Y.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&i&&i.length>1&&e>i.end(0)){const r=xn.bufferedInfo(xn.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const a=xn.timeRangesToArray(i),o=xn.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=xn.bufferedInfo(a,e,0).bufferedIndex,c=a[o].end,h=a[o+1].start;if((l===-1||l>o)&&h-c<1&&e-c<2){const f=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${h} buffered index: ${l}`);this.warn(f.message),this.media.currentTime+=1e-6;let p=C_(e,this.fragmentTracker);p&&"fragment"in p?p=p.fragment:p||(p=void 0);const g=xn.bufferInfo(this.media,e,0);this.hls.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:p,buffer:g.len,bufferInfo:g})}}}}}_tryFixBufferStall(e,t,n){var i,r;const{fragmentTracker:a,media:o}=this,l=(i=this.hls)==null?void 0:i.config;if(!o||!a||!l)return;const c=(r=this.hls)==null?void 0:r.latestLevelDetails,h=C_(n,a);if((h||c!=null&&c.live&&n<c.fragmentStart)&&(this._trySkipBufferHole(h)||!this.media))return;const f=e.buffered,p=this.adjacentTraversal(e,n);(f&&f.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-n<l.maxBufferHole||p))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,i=e.nextStart;if(n&&i){const r=n.getFragAtPos(t,jt.MAIN),a=n.getFragAtPos(i,jt.MAIN);if(r&&a)return a.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:i,stalled:r}=this;if(!i&&r!==null&&n&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${Wi(e)})`);this.warn(a.message),t.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:i}=this,r=(t=this.hls)==null?void 0:t.config;if(!i||!n||!r)return 0;const a=i.currentTime,o=xn.bufferInfo(i,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const h=o.len<=r.maxBufferHole,f=o.len>0&&o.len<1&&i.readyState<3,p=l-a;if(p>0&&(h||f)){if(p>r.maxBufferHole){let y=!1;if(a===0){const x=n.getAppendedFrag(0,jt.MAIN);x&&l<x.end&&(y=!0)}if(!y&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||H2(this.hls.inFlightFragments,l))return 0;let E=!1,_=e.end;for(;_<l;){const b=C_(_,n);if(b)_+=b.duration;else{E=!0;break}}if(E)return 0}}const g=Math.max(l+mq,a+pq);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${g}`),this.moved=!0,i.currentTime=g,!(e!=null&&e.gap)){const y=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${g}`),x={type:Wt.MEDIA_ERROR,details:He.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?x.part=e:x.frag=e),this.hls.trigger(Y.ERROR,x)}return g}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:i}=this,r=t?.config;if(!n||!r)return 0;const a=n.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){const o=a+(i+1)*r.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),n.currentTime=o,t.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${r.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function H2(s,e){const t=z2(s.main);if(t&&t.start<=e)return t;const n=z2(s.audio);return n&&n.start<=e?n:null}function z2(s){if(!s)return null;switch(s.state){case ut.IDLE:case ut.STOPPED:case ut.ENDED:case ut.ERROR:return null}return s.frag}function C_(s,e){return e.getAppendedFrag(s,jt.MAIN)||e.getPartialFragment(s)}const yq=.25;function Ew(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function P1(s,e,t,n,i){let r=new s(e,t,"");try{r.value=n,i&&(r.type=i)}catch{r=new s(e,t,Wi(i?Di({type:i},n):n))}return r}const I_=(()=>{const s=Ew();try{s&&new s(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class vq{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(Y.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(Y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(Y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(Y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&rA(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return x3(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:i}=this.hls.config;if(!n&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Ew();if(a)for(let o=0;o<r.length;o++){const l=r[o].type;if(l===Bo.emsg&&!n||!i)continue;const c=XU(r[o].data),h=r[o].pts;let f=h+r[o].duration;f>I_&&(f=I_),f-h<=0&&(f=h+yq);for(let g=0;g<c.length;g++){const y=c[g];if(!WU(y)){this.updateId3CueEnds(h,l);const x=P1(a,h,f,y,l);x&&this.id3Track.addCue(x)}}}}updateId3CueEnds(e,t){var n;const i=(n=this.id3Track)==null?void 0:n.cues;if(i)for(let r=i.length;r--;){const a=i[r];a.type===t&&a.startTime<e&&a.endTime===I_&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:i}){const{id3Track:r,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(r&&(o||l)){let c;i==="audio"?c=h=>h.type===Bo.audioId3&&l:i==="video"?c=h=>h.type===Bo.emsg&&o:c=h=>h.type===Bo.audioId3&&l||h.type===Bo.emsg&&o,Aw(r,t,n,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:i,enableDateRangeMetadataCues:r,interstitialsController:a}=this.hls.config;if(!r)return;const o=Ew();if(n&&i&&!a){const{fragmentStart:x,fragmentEnd:E}=e;let _=this.assetCue;_?(_.startTime=x,_.endTime=E):o&&(_=this.assetCue=P1(o,x,E,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),_&&(_.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(_),_.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,h=Object.keys(c);let f=this.dateRangeCuesAppended;if(l&&t){var p;if((p=l.cues)!=null&&p.length){const x=Object.keys(f).filter(E=>!h.includes(E));for(let E=x.length;E--;){var g;const _=x[E],b=(g=f[_])==null?void 0:g.cues;delete f[_],b&&Object.keys(b).forEach(C=>{const I=b[C];if(I){I.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(I)}catch{}}})}}else f=this.dateRangeCuesAppended={}}const y=e.fragments[e.fragments.length-1];if(!(h.length===0||!Ft(y?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let x=0;x<h.length;x++){const E=h[x],_=c[E],b=_.startTime,C=f[E],I=C?.cues||{};let M=C?.durationKnown||!1,R=I_;const{duration:D,endDate:P}=_;if(P&&D!==null)R=b+D,M=!0;else if(_.endOnNext&&!M){const O=h.reduce((U,j)=>{if(j!==_.id){const H=c[j];if(H.class===_.class&&H.startDate>_.startDate&&(!U||_.startDate<U.startDate))return H}return U},null);O&&(R=O.startTime,M=!0)}const L=Object.keys(_.attr);for(let O=0;O<L.length;O++){const U=L[O];if(!kV(U))continue;const j=I[U];if(j)M&&!(C!=null&&C.durationKnown)?j.endTime=R:Math.abs(j.startTime-b)>.01&&(j.startTime=b,j.endTime=R);else if(o){let H=_.attr[U];GV(U)&&(H=hU(H));const q=P1(o,b,R,{key:U,data:H},Bo.dateRange);q&&(q.id=E,this.id3Track.addCue(q),I[U]=q,a&&(U==="X-ASSET-LIST"||U==="X-ASSET-URL")&&q.addEventListener("enter",this.onEventCueEnter))}}f[E]={cues:I,dateRange:_,durationKnown:M}}}}}class Eq{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:a}=this.config;if(!r||a===1||!n.live)return;const o=this.targetLatency;if(o===null)return;const l=i-o,c=Math.min(this.maxLatency,o+n.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const f=Math.min(2,Math.max(1,a)),p=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,g=Math.min(f,Math.max(1,p));this.changeMediaPlaybackRate(t,g)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let c=o&&n||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=r!==void 0?r:a*i);const h=i;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,h)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const i=n.edge,r=e-t-this.edgeStalled,a=i-n.totalduration,o=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,r),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Y.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Y.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===He.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,i;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class xq extends JR{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Y.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Y.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,i=[],r={},a={};let o=!1,l=!1,c=!1;t.levels.forEach(h=>{const f=h.attrs;let{audioCodec:p,videoCodec:g}=h;p&&(h.audioCodec=p=fb(p,n)||void 0),g&&(g=h.videoCodec=nV(g));const{width:y,height:x,unknownCodecs:E}=h;let _=E?E.length:0;if(E)for(let O=_;O--;){const U=E[O];this.isAudioSupported(U)?(h.audioCodec=p=p?`${p},${U}`:U,_--,BA.audio[p.substring(0,4)]=2):this.isVideoSupported(U)&&(h.videoCodec=g=g?`${g},${U}`:U,_--,BA.video[g.substring(0,4)]=2)}if(o||(o=!!(y&&x)),l||(l=!!g),c||(c=!!p),_||p&&!this.isAudioSupported(p)||g&&!this.isVideoSupported(g)){this.log(`Some or all CODECS not supported "${f.CODECS}"`);return}const{CODECS:b,"FRAME-RATE":C,"HDCP-LEVEL":I,"PATHWAY-ID":M,RESOLUTION:R,"VIDEO-RANGE":D}=f,L=`${`${M||"."}-`}${h.bitrate}-${R}-${C}-${b}-${D}-${I}`;if(r[L])if(r[L].uri!==h.url&&!h.attrs["PATHWAY-ID"]){const O=a[L]+=1;h.attrs["PATHWAY-ID"]=new Array(O+1).join(".");const U=this.createLevel(h);r[L]=U,i.push(U)}else r[L].addGroupId("audio",f.AUDIO),r[L].addGroupId("text",f.SUBTITLES);else{const O=this.createLevel(h);r[L]=O,a[L]=1,i.push(O)}}),this.filterAndSortMediaOptions(i,t,o,l,c)}createLevel(e){const t=new Mv(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(i.message),t.supportedResult=_U(i,[])}return t}isAudioSupported(e){return iw(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return iw(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,i,r){let a=[],o=[],l=e;if((n||i)&&r&&(l=l.filter(({videoCodec:E,videoRange:_,width:b,height:C})=>(!!E||!!(b&&C))&&fV(_))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let E="no level with compatible codecs found in manifest",_=E;t.levels.length&&(_=`one or more CODECS in variant not supported: ${Wi(t.levels.map(C=>C.attrs.CODECS).filter((C,I,M)=>M.indexOf(C)===I))}`,this.warn(_),E+=` (${_})`);const b=new Error(E);this.hls.trigger(Y.ERROR,{type:Wt.MEDIA_ERROR,details:He.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:b,reason:_})}});return}t.audioTracks&&(a=t.audioTracks.filter(E=>!E.audioCodec||this.isAudioSupported(E.audioCodec)),Q2(a)),t.subtitles&&(o=t.subtitles,Q2(o));const c=l.slice(0);l.sort((E,_)=>{if(E.attrs["HDCP-LEVEL"]!==_.attrs["HDCP-LEVEL"])return(E.attrs["HDCP-LEVEL"]||"")>(_.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&E.height!==_.height)return E.height-_.height;if(E.frameRate!==_.frameRate)return E.frameRate-_.frameRate;if(E.videoRange!==_.videoRange)return db.indexOf(E.videoRange)-db.indexOf(_.videoRange);if(E.videoCodec!==_.videoCodec){const b=NL(E.videoCodec),C=NL(_.videoCodec);if(b!==C)return C-b}if(E.uri===_.uri&&E.codecSet!==_.codecSet){const b=hb(E.codecSet),C=hb(_.codecSet);if(b!==C)return C-b}return E.averageBitrate!==_.averageBitrate?E.averageBitrate-_.averageBitrate:0});let h=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length)){for(let E=0;E<c.length;E++)if(c[E].pathwayId===l[0].pathwayId){h=c[E];break}}this._levels=l;for(let E=0;E<l.length;E++)if(l[E]===h){var f;this._firstLevel=E;const _=h.bitrate,b=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${_}`),((f=this.hls.userConfig)==null?void 0:f.abrEwmaDefaultEstimate)===void 0){const C=Math.min(_,this.hls.config.abrEwmaDefaultEstimateMax);C>b&&b===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=C)}break}const p=r&&!i,g=this.hls.config,y=!!(g.audioStreamController&&g.audioTrackController),x={levels:l,audioTracks:a,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:y&&!p&&a.some(E=>!!E.url)};this.hls.trigger(Y.MANIFEST_PARSED,x)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const h=new Error("invalid level idx"),f=e<0;if(this.hls.trigger(Y.ERROR,{type:Wt.OTHER_ERROR,details:He.LEVEL_SWITCH_ERROR,level:e,fatal:f,error:h,reason:h.message}),f)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&i&&r===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${n}${r?" with Pathway "+r:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(Y.LEVEL_SWITCHING,l);const c=a.details;if(!c||c.live){const h=this.switchParams(a.uri,i?.details,c);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===Hn.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===jt.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(r=>!!n[r]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var n;const{level:i,details:r}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${i}`),(o=t.deliveryDirectives)!=null&&o.skip&&(r.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(i,t,l)}else(n=t.deliveryDirectives)!=null&&n.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],a=e.details,o=a?.age;this.log(`Loading level index ${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(Y.LEVEL_LOADING,{url:n,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((r,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(o=>o.level=-1)),!1));kU(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=n.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(Y.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(Y.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function Q2(s){const e={};s.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function O3(){return self.SourceBuffer||self.WebKitSourceBuffer}function P3(){if(!od())return!1;const e=O3();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function _q(){if(!P3())return!1;const s=od();return typeof s?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>s.isTypeSupported(Iv(e,"video")))||["mp4a.40.2","fLaC"].some(e=>s.isTypeSupported(Iv(e,"audio"))))}function Sq(){var s;const e=O3();return typeof(e==null||(s=e.prototype)==null?void 0:s.changeType)=="function"}const bq=100;class Tq extends VR{constructor(e,t,n){super(e,t,n,"stream-controller",jt.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,r=i?i.currentTime:null;if(r===null||!Ft(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const a=this.getFwdBufferInfoAtPos(i,r,jt.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Y.LEVEL_LOADING,this.onLevelLoading,this),e.on(Y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(Y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(Y.BUFFER_CREATED,this.onBufferCreated,this),e.on(Y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Y.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(Y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(Y.BUFFER_CREATED,this.onBufferCreated,this),e.off(Y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Y.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:i}=this;if(this.stopLoad(),this.setInterval(bq),this.level=-1,!this.startFragRequested){let r=i.startLevel;r===-1&&(i.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=i.firstAutoLevel),i.nextLoadLevel=r,this.level=i.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=ut.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ut.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ut.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e?.[t],i=n?.details;if(i&&(!i.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(i))break;this.state=ut.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ut.IDLE;break}break}case ut.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ut.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[r]))return;const a=n[r],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const x={};this.altAudio===2&&(x.type="video"),this.hls.trigger(Y.BUFFER_EOS,x),this.state=ut.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const c=a.details;if(!c||this.state===ut.WAITING_LEVEL||this.waitForLive(a)){this.level=r,this.state=ut.WAITING_LEVEL,this.startFragRequested=!1;return}const h=o.len,f=this.getMaxBufferLength(a.maxBitrate);if(h>=f)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const p=this.backtrackFragment?this.backtrackFragment.start:o.end;let g=this.getNextFragment(p,c);if(this.couldBacktrack&&!this.fragPrevious&&g&&Ks(g)&&this.fragmentTracker.getState(g)!==ur.OK){var y;const E=((y=this.backtrackFragment)!=null?y:g).sn-c.startSN,_=c.fragments[E-1];_&&g.cc===_.cc&&(g=_,this.fragmentTracker.removeFragment(_))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(g&&this.isLoopLoading(g,p)){if(!g.gap){const E=this.audioOnly&&!this.altAudio?Gi.AUDIO:Gi.VIDEO,_=(E===Gi.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;_&&this.afterBufferFlushed(_,E,jt.MAIN)}g=this.getNextFragmentLoopLoading(g,c,o,jt.MAIN,f)}g&&(g.initSegment&&!g.initSegment.data&&!this.bitrateTest&&(g=g.initSegment),this.loadFragment(g,a,p))}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);i===ur.NOT_LOADED||i===ur.PARTIAL?Ks(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,jt.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<r.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:n=0}else n=0;const a=this.getBufferedFrag(t.currentTime+n);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,h=Math.max(a.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ut.KEY_LOADING:case ut.FRAG_LOADING:case ut.FRAG_LOADING_WAITING_RETRY:case ut.PARSING:case ut.PARSED:this.state=ut.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;Ma(n,"playing",this.onMediaPlaying),Ma(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(no(n,"playing",this.onMediaPlaying),no(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(Y.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,i=!1;for(let r=0;r<t.levels.length;r++){const a=t.levels[r].audioCodec;a&&(n=n||a.indexOf("mp4a.40.2")!==-1,i=i||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&i&&!Sq(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==ut.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=ut.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:i,startFragRequested:r}=this,a=t.level,o=t.details,l=o.totalduration;if(!i){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const c=t.levelInfo,h=this.fragCurrent;h&&(this.state===ut.FRAG_LOADING||this.state===ut.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let f=0;if(o.live||(n=c.details)!=null&&n.live){var p;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;f=this.alignPlaylists(o,c.details,(p=this.levelLastLoaded)==null?void 0:p.details)}if(c.details=o,this.levelLastLoaded=c,r||this.setStartPosition(o,f),this.hls.trigger(Y.LEVEL_UPDATED,{details:o,level:a}),this.state===ut.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=ut.IDLE}r&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,r=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=r>=a-t.maxFragLookUpTolerance&&r<=o;if(i!==null&&n.duration>i&&(r<i||!l)){const h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&n.readyState<4||r<o-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),n.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const f=xn.bufferInfo(n,i,0);if(!((c=f.buffered)!=null&&c.length)){n.currentTime=i;return}if(f.start<=r){n.currentTime=i;return}const{nextStart:g}=xn.bufferedInfo(f.buffered,r,0);g&&(n.currentTime=g)}else n.currentTime=i}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:r}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const o=a[n.level];if(!o){this.warn(`Level ${n.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=o.videoCodec,h=l.PTSKnown||!l.live,f=(t=n.initSegment)==null?void 0:t.data,p=this._getAudioCodec(o),g=this.transmuxer=this.transmuxer||new o3(this.hls,jt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=i?i.index:-1,x=y!==-1,E=new HR(n.level,n.sn,n.stats.chunkCount,r.byteLength,y,x),_=this.initPTS[n.cc];g.push(r,f,p,c,n,i,l.totalduration,h,E,_)}onAudioTrackSwitching(e,t){const n=this.hls,i=this.altAudio===2;if(pb(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.fragmentTracker.removeAllFragments(),n.once(Y.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(Y.AUDIO_TRACK_SWITCHED,t)}),n.trigger(Y.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(Y.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=pb(t.url,this.hls);if(n){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let i,r,a=!1;for(const o in n){const l=n[o];if(l.id==="main"){if(r=o,i=l,o==="video"){const c=n[o];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:i}=t,r=n.type===jt.MAIN;if(r){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ut.PARSED&&(this.state=ut.IDLE);return}const o=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),Ks(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}const a=this.media;a&&(!this._hasEnoughToStart&&xn.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=ut.ERROR;return}switch(t.details){case He.FRAG_GAP:case He.FRAG_PARSING_ERROR:case He.FRAG_DECRYPT_ERROR:case He.FRAG_LOAD_ERROR:case He.FRAG_LOAD_TIMEOUT:case He.KEY_LOAD_ERROR:case He.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(jt.MAIN,t);break;case He.LEVEL_LOAD_ERROR:case He.LEVEL_LOAD_TIMEOUT:case He.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ut.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===Hn.LEVEL&&(this.state=ut.IDLE);break;case He.BUFFER_ADD_CODEC_ERROR:case He.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case He.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case He.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ut.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Gi.AUDIO||!this.altAudio){const n=(t===Gi.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,jt.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&n&&(n+=i);const r=this.getLevelDetails(),a=xn.getBuffered(e),o=a.length?a.start(0):0,l=o-n,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*(r?.partTarget||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),n+=l,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${o}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:i}=this,r=n?.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=ut.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=r.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(Y.FRAG_LOADED,n),r.bitrateTest=!1}).catch(n=>{this.state===ut.STOPPED||this.state===ut.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:i,chunkMeta:r}=e,a=this.getCurrentContext(r);if(!a){this.resetWhenMissingContext(r);return}const{frag:o,part:l,level:c}=a,{video:h,text:f,id3:p,initSegment:g}=i,{details:y}=c,x=this.altAudio?void 0:i.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=ut.PARSING,g){const E=g.tracks;if(E){const I=o.initSegment||o;if(this.unhandledEncryptionError(g,o))return;this._bufferInitSegment(c,E,I,r),n.trigger(Y.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:t,tracks:E})}const _=g.initPTS,b=g.timescale,C=this.initPTS[o.cc];if(Ft(_)&&(!C||C.baseTime!==_||C.timescale!==b)){const I=g.trackId;this.initPTS[o.cc]={baseTime:_,timescale:b,trackId:I},n.trigger(Y.INIT_PTS_FOUND,{frag:o,id:t,initPTS:_,timescale:b,trackId:I})}}if(h&&y){x&&h.type==="audiovideo"&&this.logMuxedErr(o);const E=y.fragments[o.sn-1-y.startSN],_=o.sn===y.startSN,b=!E||o.cc>E.cc;if(i.independent!==!1){const{startPTS:C,endPTS:I,startDTS:M,endDTS:R}=h;if(l)l.elementaryStreams[h.type]={startPTS:C,endPTS:I,startDTS:M,endDTS:R};else if(h.firstKeyFrame&&h.independent&&r.id===1&&!b&&(this.couldBacktrack=!0),h.dropped&&h.independent){const D=this.getMainFwdBufferInfo(),P=(D?D.end:this.getLoadPosition())+this.config.maxBufferHole,L=h.firstKeyFramePTS?h.firstKeyFramePTS:C;if(!_&&P<L-this.config.maxBufferHole&&!b){this.backtrack(o);return}else b&&(o.gap=!0);o.setElementaryStreamInfo(h.type,o.start,I,o.start,R,!0)}else _&&C-(y.appliedTimelineOffset||0)>jS&&(o.gap=!0);o.setElementaryStreamInfo(h.type,C,I,M,R),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(h,o,l,r,_||b)}else if(_||b)o.gap=!0;else{this.backtrack(o);return}}if(x){const{startPTS:E,endPTS:_,startDTS:b,endDTS:C}=x;l&&(l.elementaryStreams[Gi.AUDIO]={startPTS:E,endPTS:_,startDTS:b,endDTS:C}),o.setElementaryStreamInfo(Gi.AUDIO,E,_,b,C),this.bufferFragmentData(x,o,l,r)}if(y&&p!=null&&p.samples.length){const E={id:t,frag:o,details:y,samples:p.samples};n.trigger(Y.FRAG_PARSING_METADATA,E)}if(y&&f){const E={id:t,frag:o,details:y,samples:f.samples};n.trigger(Y.FRAG_PARSING_USERDATA,E)}}logMuxedErr(e){this.warn(`${Ks(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,i){if(this.state!==ut.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:r,video:a,audiovideo:o}=t;if(r){const c=e.audioCodec;let h=US(r.codec,c);h==="mp4a"&&(h="mp4a.40.5");const f=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");const p=r.metadata;p&&"channelCount"in p&&(p.channelCount||1)!==1&&f.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&f.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log(`Android: force audio codec to ${h}`)),c&&c!==h&&this.log(`Swapping manifest audio codec "${c}" for "${h}"`),r.levelCodec=h,r.id=jt.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${h||""}/${c||""}/${r.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=jt.MAIN;const c=a.codec;if(c?.length===4)switch(c){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${a.codec!==c?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(Y.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const f=t[c].initSegment;f!=null&&f.byteLength&&this.hls.trigger(Y.BUFFER_APPENDING,{type:c,data:f,frag:n,part:null,chunkMeta:i,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,jt.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e?.[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ut.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(xn.isBuffered(e,n)?t=this.getAppendedFrag(n):xn.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,r=t.level;(!i||t.sn!==i.sn||i.level!==r)&&(this.fragPlaying=t,this.hls.trigger(Y.FRAG_CHANGED,{frag:t}),(!i||i.level!==r)&&this.hls.trigger(Y.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ft(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ft(t)){const n=this.getLevelDetails(),i=this.currentFrag||(n?um(null,n.fragments,t):null);if(i){const r=i.programDateTime;if(r!==null){const a=r+(t-i.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Cq extends Sl{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[n].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=He.KEY_LOAD_ERROR,n,i,r){return new gh({type:Wt.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:n,networkDetails:i})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,r=t.length;i<r;i++){const a=t[i];if(e.cc<=a.cc&&(!Ks(e)||!Ks(a)||e.sn<a.sn)||!n&&i==r-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const l=GS(o);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const i=nv(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const h=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,He.KEY_LOAD_ERROR,h))}const a=r.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,He.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=N1(r);let l=this.keyIdToKeyInfo[o];if((n=l)!=null&&n.decryptdata.key)return r.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if((i=l)!=null&&i.keyLoadPromise){var c;switch((c=l.mediaKeySessionContext)==null?void 0:c.keyStatus){case"usable":case"usable-in-future":return l.keyLoadPromise.then(f=>{const{keyInfo:p}=f;return r.key=p.decryptdata.key,{frag:e,keyInfo:p}})}}switch(this.log(`Loading key ${wo(r.keyId||[])} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[o]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,He.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(n);return(e.keyLoadPromise=i.then(r=>(e.mediaKeySessionContext=r,n))).catch(r=>{throw e.keyLoadPromise=null,r.data&&(r.data.frag=t),r})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,i=n.loader,r=new i(n);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(p,g,y,x)=>{const{frag:E,keyInfo:_,url:b}=y,C=N1(_.decryptdata)||b;if(!E.decryptdata||_!==this.keyIdToKeyInfo[C])return o(this.createKeyLoadError(E,He.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),x));_.decryptdata.key=E.decryptdata.key=new Uint8Array(p.data),E.keyLoader=null,_.loader=null,a({frag:E,keyInfo:_})},onError:(p,g,y,x)=>{this.resetLoader(g),o(this.createKeyLoadError(t,He.KEY_LOAD_ERROR,new Error(`HTTP Error ${p.code} loading key ${p.text}`),y,Di({url:l.url,data:void 0},p)))},onTimeout:(p,g,y)=>{this.resetLoader(g),o(this.createKeyLoadError(t,He.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),y))},onAbort:(p,g,y)=>{this.resetLoader(g),o(this.createKeyLoadError(t,He.INTERNAL_ABORTED,new Error("key loading aborted"),y))}};r.load(l,h,f)})}resetLoader(e){const{frag:t,keyInfo:n,url:i}=e,r=n.loader;t.keyLoader===r&&(t.keyLoader=null,n.loader=null);const a=N1(n.decryptdata)||i;delete this.keyIdToKeyInfo[a],r&&r.destroy()}}function N1(s){const e=s.keyId;return e?wo(e):s.uri}function V2(s){const{type:e}=s;switch(e){case Hn.AUDIO_TRACK:return jt.AUDIO;case Hn.SUBTITLE_TRACK:return jt.SUBTITLE;default:return jt.MAIN}}function F1(s,e){let t=s.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class Iq{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Y.LEVEL_LOADING,this.onLevelLoading,this),e.on(Y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(Y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(Y.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(Y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Y.LEVEL_LOADING,this.onLevelLoading,this),e.off(Y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(Y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(Y.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,i=t.loader,r=n||i,a=new r(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Hn.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:i,pathwayId:r,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:n,level:i,pathwayId:r,responseType:"text",type:Hn.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:n,groupId:i,url:r,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:Hn.AUDIO_TRACK,url:r,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:n,groupId:i,url:r,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:Hn.SUBTITLE_TRACK,url:r,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const n=this.loaders[Hn.LEVEL];if(n){const i=n.context;i&&!t.levels.some(r=>r===i.levelOrTrack)&&(n.abort(),delete this.loaders[Hn.LEVEL])}}load(e){var t;const n=this.hls.config;let i=this.getInternalLoader(e);if(i){const c=this.hls.logger,h=i.context;if(h&&h.levelOrTrack===e.levelOrTrack&&(h.url===e.url||h.deliveryDirectives&&!e.deliveryDirectives)){h.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${h.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let r;if(e.type===Hn.MANIFEST?r=n.manifestLoadPolicy.default:r=Li({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),Ft((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===Hn.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===Hn.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===Hn.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const h=c.partTarget,f=c.targetduration;if(h&&f){const p=Math.max(h*3,f*.8)*1e3;r=Li({},r,{maxTimeToFirstByteMs:Math.min(p,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(p,r.maxTimeToFirstByteMs)})}}}const a=r.errorRetry||r.timeoutRetry||{},o={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(c,h,f,p)=>{const g=this.getInternalLoader(f);this.resetInternalLoader(f.type);const y=c.data;if(y.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,f,new Error("no EXTM3U delimiter"),p||null,h);return}h.parsing.start=performance.now(),mu.isMediaPlaylist(y)||f.type!==Hn.MANIFEST?this.handleTrackOrLevelPlaylist(c,h,f,p||null,g):this.handleMasterPlaylist(c,h,f,p)},onError:(c,h,f,p)=>{this.handleNetworkError(h,f,!1,c,p)},onTimeout:(c,h,f)=>{this.handleNetworkError(h,f,!0,void 0,c)}};i.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,i){const r=this.hls,a=e.data,o=F1(e,n),l=mu.parseMasterPlaylist(a,o);if(l.playlistParsingError){this.handleManifestParsingError(e,n,l.playlistParsingError,i,t);return}const{contentSteering:c,levels:h,sessionData:f,sessionKeys:p,startTimeOffset:g,variableList:y}=l;this.variableList=y;const{AUDIO:x=[],SUBTITLES:E,"CLOSED-CAPTIONS":_}=mu.parseMasterPlaylistMedia(a,o,l);x.length&&!x.some(C=>!C.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),x.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new hs({}),bitrate:0,url:""})),r.trigger(Y.MANIFEST_LOADED,{levels:h,audioTracks:x,subtitles:E,captions:_,contentSteering:c,url:o,stats:t,networkDetails:i,sessionData:f,sessionKeys:p,startTimeOffset:g,variableList:y})}handleTrackOrLevelPlaylist(e,t,n,i,r){const a=this.hls,{id:o,level:l,type:c}=n,h=F1(e,n),f=Ft(l)?l:Ft(o)?o:0,p=V2(n),g=mu.parseLevelPlaylist(e.data,h,f,p,0,this.variableList);if(c===Hn.MANIFEST){const y={attrs:new hs({}),bitrate:0,details:g,name:"",url:h};g.requestScheduled=t.loading.start+NU(g,0),a.trigger(Y.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:h,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=g,this.handlePlaylistLoaded(g,e,t,n,i,r)}handleManifestParsingError(e,t,n,i,r){this.hls.trigger(Y.ERROR,{type:Wt.NETWORK_ERROR,details:He.MANIFEST_PARSING_ERROR,fatal:t.type===Hn.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t,n=!1,i,r){let a=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Hn.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Hn.AUDIO_TRACK||e.type===Hn.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=He.UNKNOWN,c=!1;const h=this.getInternalLoader(e);switch(e.type){case Hn.MANIFEST:l=n?He.MANIFEST_LOAD_TIMEOUT:He.MANIFEST_LOAD_ERROR,c=!0;break;case Hn.LEVEL:l=n?He.LEVEL_LOAD_TIMEOUT:He.LEVEL_LOAD_ERROR,c=!1;break;case Hn.AUDIO_TRACK:l=n?He.AUDIO_TRACK_LOAD_TIMEOUT:He.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case Hn.SUBTITLE_TRACK:l=n?He.SUBTITLE_TRACK_LOAD_TIMEOUT:He.SUBTITLE_LOAD_ERROR,c=!1;break}h&&this.resetInternalLoader(e.type);const f={type:Wt.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:h,context:e,error:o,networkDetails:t,stats:r};if(i){const p=t?.url||e.url;f.response=Di({url:p,data:void 0},i)}this.hls.trigger(Y.ERROR,f)}handlePlaylistLoaded(e,t,n,i,r,a){const o=this.hls,{type:l,level:c,id:h,groupId:f,deliveryDirectives:p}=i,g=F1(t,i),y=V2(i),x=typeof i.level=="number"&&y===jt.MAIN?c:void 0;if(!e.fragments.length){const _=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(Y.ERROR,{type:Wt.NETWORK_ERROR,details:He.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:_,reason:_.message,response:t,context:i,level:x,parent:y,networkDetails:r,stats:n});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const E=e.playlistParsingError;if(E){if(this.hls.logger.warn(`${E} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(Y.ERROR,{type:Wt.NETWORK_ERROR,details:He.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:E,reason:E.message,response:t,context:i,level:x,parent:y,networkDetails:r,stats:n});return}e.playlistParsingError=null}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case Hn.MANIFEST:case Hn.LEVEL:o.trigger(Y.LEVEL_LOADED,{details:e,levelInfo:i.levelOrTrack||o.levels[0],level:x||0,id:h||0,stats:n,networkDetails:r,deliveryDirectives:p,withoutMultiVariant:l===Hn.MANIFEST});break;case Hn.AUDIO_TRACK:o.trigger(Y.AUDIO_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:h||0,groupId:f||"",stats:n,networkDetails:r,deliveryDirectives:p});break;case Hn.SUBTITLE_TRACK:o.trigger(Y.SUBTITLE_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:h||0,groupId:f||"",stats:n,networkDetails:r,deliveryDirectives:p});break}}}class eo{static get version(){return wv}static isMSESupported(){return P3()}static isSupported(){return _q()}static getMediaSource(){return od()}static get Events(){return Y}static get MetadataSchema(){return Bo}static get ErrorTypes(){return Wt}static get ErrorDetails(){return He}static get DefaultConfig(){return eo.defaultConfig?eo.defaultConfig:uq}static set DefaultConfig(e){eo.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new jR,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=P5(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=fq(eo.DefaultConfig,e,t);this.userConfig=e,n.progressive&&dq(n,t);const{abrController:i,bufferController:r,capLevelController:a,errorController:o,fpsController:l}=n,c=new o(this),h=this.abrController=new i(this),f=new IV(this),p=n.interstitialsController,g=p?this.interstitialsController=new p(this,eo):null,y=this.bufferController=new r(this,f),x=this.capLevelController=new a(this),E=new l(this),_=new Iq(this),b=n.contentSteeringController,C=b?new b(this):null,I=this.levelController=new xq(this,C),M=new vq(this),R=new Cq(this.config,this.logger),D=this.streamController=new Tq(this,f,R),P=this.gapController=new Aq(this,f);x.setStreamController(D),E.setStreamController(D);const L=[_,I,D];g&&L.splice(1,0,g),C&&L.splice(1,0,C),this.networkControllers=L;const O=[h,y,P,x,E,M,f];this.audioTrackController=this.createController(n.audioTrackController,L);const U=n.audioStreamController;U&&L.push(this.audioStreamController=new U(this,f,R)),this.subtitleTrackController=this.createController(n.subtitleTrackController,L);const j=n.subtitleStreamController;j&&L.push(this.subtititleStreamController=new j(this,f,R)),this.createController(n.timelineController,O),R.emeController=this.emeController=this.createController(n.emeController,O),this.cmcdController=this.createController(n.cmcdController,O),this.latencyController=this.createController(Eq,O),this.coreComponents=O,L.push(c);const H=c.onErrorOut;typeof H=="function"&&this.on(Y.ERROR,H,c),this.on(Y.MANIFEST_LOADED,_.onManifestLoaded,_)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,i){this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const i=e===Y.ERROR;this.trigger(Y.ERROR,{type:Wt.OTHER_ERROR,details:He.INTERNAL_EXCEPTION,fatal:i,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(Y.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(Y.ERROR,{type:Wt.OTHER_ERROR,details:He.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,i=t?e:{media:n};this._media=n,this.trigger(Y.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(Y.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(Y.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,i=this._url=OR.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(Y.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[jt.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[jt.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[jt.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=Aj()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){hV(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,n)for(let r=i;r--;){const a=e[r].attrs["HDCP-LEVEL"];if(a&&a<=n)return r}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=TU(t);return SU(e,n,navigator.mediaCapabilities)}}eo.defaultConfig=void 0;class Qp{static instance=null;activeVideos;currentlyPlaying;constructor(){this.activeVideos=new Map,this.currentlyPlaying=null}static getInstance(){return Qp.instance||(Qp.instance=new Qp),Qp.instance}registerVideo(e,t){return this.activeVideos.set(e,t),e}unregisterVideo(e){this.currentlyPlaying===e&&(this.currentlyPlaying=null),this.activeVideos.delete(e)}playVideo(e){this.activeVideos.forEach((t,n)=>{n!==e&&t()}),this.currentlyPlaying=e}}function Mq(s){const e=s.src||s.hlsUrl||"",[t,n]=ee.useState(!1),[i,r]=ee.useState(0),[a,o]=ee.useState(0),[l,c]=ee.useState(s.muted?0:1),[h,f]=ee.useState(!0),[p,g]=ee.useState(!1),[y,x]=ee.useState(!0),[E,_]=ee.useState(null),[b,C]=ee.useState(0),I=ee.useRef(null),M=ee.useRef(null),R=ee.useRef(null),D=ee.useRef(`hls_video_${Date.now()}_${Math.random()}`);ee.useEffect(()=>{const V=Qp.getInstance(),X=()=>{I.current&&(I.current.pause(),n(!1))};return V.registerVideo(D.current,X),()=>{V.unregisterVideo(D.current)}},[]);const P=ee.useCallback(()=>{I.current&&(t?(I.current.pause(),n(!1)):(Qp.getInstance().playVideo(D.current),I.current.play(),n(!0)))},[t]),L=ee.useCallback(()=>{I.current&&r(I.current.currentTime)},[]),O=ee.useCallback(()=>{I.current&&(o(I.current.duration),x(!1))},[]),U=ee.useCallback(V=>{if(!I.current)return;const X=V.currentTarget.getBoundingClientRect(),te=(V.clientX-X.left)/X.width*a;I.current.currentTime=te,r(te)},[a]),j=ee.useCallback(V=>{I.current&&(I.current.volume=V,I.current.muted=V===0,c(V))},[]),H=ee.useCallback(()=>{M.current&&(p?document.exitFullscreen?.():M.current.requestFullscreen?.())},[p]),z=ee.useCallback(()=>{R.current&&clearTimeout(R.current),f(!0),t&&!s.alwaysShowControls&&(R.current=window.setTimeout(()=>{f(!1)},3e3))},[t,s.alwaysShowControls]),q=ee.useCallback(()=>{s.hideControls||z()},[z,s.hideControls]);ee.useEffect(()=>{const V=new ResizeObserver(X=>{const{width:K}=X[0].contentRect,te=s.aspectRatio||16/9,oe=K/te;C(oe)});return M.current&&V.observe(M.current),()=>V.disconnect()},[s.aspectRatio]),ee.useEffect(()=>{const V=I.current;if(!V)return;let X=null;const K=()=>n(!0),te=()=>n(!1),oe=()=>{_("Video error: Unable to play stream"),x(!1)},Ee=()=>x(!0),Ce=()=>x(!1);return V.addEventListener("play",K),V.addEventListener("pause",te),V.addEventListener("timeupdate",L),V.addEventListener("loadedmetadata",O),V.addEventListener("error",oe),V.addEventListener("loadstart",Ee),V.addEventListener("canplay",Ce),e.endsWith(".m3u8")?V.canPlayType("application/vnd.apple.mpegurl")?V.src=e:eo.isSupported()?(X=new eo({enableWorker:!0}),X.loadSource(e),X.attachMedia(V),X.on(eo.Events.ERROR,()=>{_("Video error: Unable to play stream"),x(!1)}),X.on(eo.Events.MANIFEST_PARSED,()=>x(!1))):(_("HLS not supported in this browser"),x(!1)):V.src=e,()=>{V.removeEventListener("play",K),V.removeEventListener("pause",te),V.removeEventListener("timeupdate",L),V.removeEventListener("loadedmetadata",O),V.removeEventListener("error",oe),V.removeEventListener("loadstart",Ee),V.removeEventListener("canplay",Ce),X&&X.destroy()}},[L,O,e]),ee.useEffect(()=>{const V=()=>{g(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",V),()=>document.removeEventListener("fullscreenchange",V)},[]);const k=V=>{const X=Math.floor(V/60),K=Math.floor(V%60);return`${X}:${K.toString().padStart(2,"0")}`},W=ee.useMemo(()=>a>0?i/a*100:0,[i,a]);return G.jsxs("div",{ref:M,style:{position:"relative",width:"100%",height:s.fillParent?"100%":b||"200px",backgroundColor:"#000",borderRadius:s.borderRadius||"12px",overflow:"hidden",cursor:h?"default":"none"},onMouseMove:q,onMouseEnter:z,children:[G.jsx("video",{ref:I,style:{width:"100%",height:"100%",objectFit:"cover"},muted:s.muted,loop:s.loop,autoPlay:s.autoplay,playsInline:!0,onClick:P}),y&&G.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:10},children:G.jsx("div",{style:{width:"40px",height:"40px",border:"3px solid rgba(255,255,255,0.3)",borderTop:"3px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}})}),E&&G.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(0,0,0,0.8)",color:"white",padding:"16px",borderRadius:"8px",textAlign:"center",zIndex:10},children:[G.jsx("div",{style:{fontSize:"16px",marginBottom:"8px"},children:""}),G.jsx("div",{style:{fontSize:"12px"},children:E})]}),!s.hideControls&&h&&G.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(transparent, rgba(0,0,0,0.8))",padding:"20px 16px 16px",zIndex:20,transition:"opacity 0.3s ease"},children:[G.jsx("div",{style:{width:"100%",height:"4px",backgroundColor:"rgba(255,255,255,0.3)",borderRadius:"2px",marginBottom:"12px",cursor:"pointer"},onClick:U,children:G.jsx("div",{style:{width:`${W}%`,height:"100%",backgroundColor:s.accentColor||"#ff6b6b",borderRadius:"2px",transition:"width 0.1s ease"}})}),G.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:[G.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[G.jsx("button",{onClick:P,style:{background:"none",border:"none",color:"white",cursor:"pointer",padding:"8px",borderRadius:"4px",display:"flex",alignItems:"center"},children:G.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:t?G.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"}):G.jsx("path",{d:"M8 5v14l11-7z"})})}),G.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[G.jsx("button",{onClick:()=>j(l===0?1:0),style:{background:"none",border:"none",color:"white",cursor:"pointer",padding:"4px"},children:G.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:l===0?G.jsx("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"}):G.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})})}),G.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:l,onChange:V=>j(parseFloat(V.target.value)),style:{width:"60px",height:"4px",background:`linear-gradient(to right, ${s.accentColor||"#ff6b6b"} 0%, ${s.accentColor||"#ff6b6b"} ${l*100}%, rgba(255,255,255,0.3) ${l*100}%, rgba(255,255,255,0.3) 100%)`,outline:"none",cursor:"pointer"}})]}),G.jsxs("div",{style:{fontSize:"14px",fontFamily:"monospace"},children:[k(i)," / ",k(a)]})]}),G.jsx("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:G.jsx("button",{onClick:H,style:{background:"none",border:"none",color:"white",cursor:"pointer",padding:"4px"},children:G.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:p?G.jsx("path",{d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"}):G.jsx("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})})})})]})]}),G.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]})}function wq(){return G.jsxs("section",{className:"hero","aria-labelledby":"hero-title",children:[G.jsx("p",{className:"kicker",children:"Alexander Popovic  Klagenfurt, AT"}),G.jsx("h1",{id:"hero-title",className:"title",children:"Creative Technologist & AR Storyteller"}),G.jsxs("p",{className:"subtitle",children:["I design and build immersive experiences that braid ",G.jsx("strong",{children:"nature"}),", ",G.jsx("strong",{children:"3D/AR"}),", and ",G.jsx("strong",{children:"film"}),". Maker of Tscheppa-AR, Starburst Designer, SensePresenter."]}),G.jsxs("div",{className:"hero-actions",children:[G.jsx("a",{className:"pill primary",href:"#projects",children:"See Projects"}),G.jsx("a",{className:"pill",href:"#work",children:"Case Studies"}),G.jsx("a",{className:"pill",href:"#contact",children:"Book a call"})]}),G.jsxs("div",{className:"stack",children:[G.jsx("div",{className:"phone-wrap","aria-hidden":"true",children:G.jsx("div",{className:"phone",id:"parallax-phone",children:G.jsx("div",{className:"screen",children:G.jsxs("div",{className:"screen-inner",children:[G.jsx("iframe",{className:"video-bg",src:"https://www.youtube.com/embed/rUcYMDtTrsw?autoplay=1&mute=1&loop=1&playlist=rUcYMDtTrsw&controls=0&showinfo=0&rel=0&iv_load_policy=3&modestbranding=1&playsinline=1&enablejsapi=1",frameBorder:0,allow:"autoplay; encrypted-media; accelerometer; gyroscope; picture-in-picture",allowFullScreen:!0,title:"TSCH-AR teaser"}),G.jsxs("div",{className:"content-overlay",children:[G.jsxs("div",{className:"phone-top",children:[G.jsx("span",{children:"alex.pop"}),G.jsx("span",{children:"TSCH-AR"})]}),G.jsx("div",{className:"brand-big",children:"Wunderwelten"}),G.jsx("p",{className:"desc",children:"Field-aware UI & AR scenes over real landscapes. Nature first, tech in service."})]})]})})})}),G.jsx("div",{className:"phone-wrap",children:G.jsx("div",{className:"phone",children:G.jsx("div",{className:"screen",children:G.jsx("div",{className:"screen-inner",children:G.jsx("div",{className:"content-overlay",style:{background:"transparent",padding:0},children:G.jsx(Mq,{hlsUrl:"https://vod.arkturian.com/media/u2_20250829_171448_6fa93837/master.m3u8",muted:!0,autoplay:!0,loop:!0,aspectRatio:9/19.5,borderRadius:"24px",hideControls:!0,fillParent:!0})})})})})})]})]})}function Rq(){return G.jsx("section",{className:"section","aria-labelledby":"bigtext-title",children:G.jsxs("div",{className:"card",style:{textAlign:"center"},children:[G.jsx("h2",{id:"bigtext-title",className:"h2",style:{fontSize:"clamp(28px,6vw,56px)"},children:"Built by designers, for you."}),G.jsxs("p",{className:"muted",style:{fontSize:"clamp(16px,3.6vw,24px)",maxWidth:800,margin:"0 auto"},children:["I promote your online initiatives in the most visually engaging way ",G.jsx("span",{style:{color:"#99a"},children:"possible, to help you stand out online."})]})]})})}const Bq=[{title:"linkkit",subtitle:"For design conscious people"},{title:"Tscheppa-AR Signage",subtitle:"26 stations, QR flows, map UX"},{title:"Morph Fields",subtitle:"Resonance-based color and fields"},{title:"Arcturian UI",subtitle:"Radial menus, property controls"}];function Dq(){return G.jsxs("section",{className:"section","aria-labelledby":"flatgrid-title",children:[G.jsx("h2",{id:"flatgrid-title",className:"h2",children:"Featured Layouts"}),G.jsx("div",{className:"flat-grid",children:Bq.map((s,e)=>G.jsx("article",{className:"flat-card","aria-label":s.title,children:G.jsxs("div",{className:"flat-card-inner",children:[G.jsx("div",{className:"flat-card-title",children:s.title}),G.jsx("div",{className:"flat-card-sub",children:s.subtitle})]})},e))})]})}function Lq(){return G.jsx("section",{className:"faq","aria-labelledby":"faq-title",children:G.jsxs("div",{className:"faq-inner",children:[G.jsx("h2",{id:"faq-title",children:"FAQ"}),G.jsxs("details",{children:[G.jsxs("summary",{children:["What's your ideal project? ",G.jsx("span",{className:"plus",children:"+"})]}),G.jsx("p",{children:"Anything where nature or real places are augmented with meaning: AR trails, cultural heritage, science exhibits, or experiential product launches."})]}),G.jsxs("details",{children:[G.jsxs("summary",{children:["Do you handle end-to-end? ",G.jsx("span",{className:"plus",children:"+"})]}),G.jsx("p",{children:"Yesconcept, UX, 3D, AR build, and film assets. I also collaborate with specialists if the scope demands it."})]}),G.jsxs("details",{children:[G.jsxs("summary",{children:["Can you prototype fast? ",G.jsx("span",{className:"plus",children:"+"})]}),G.jsx("p",{children:"Rapidly. I use a modular toolchain (Unity/Three/Blender) and reusable architectures (InterpolatedProperty, Field-Aware Layout)."})]})]})})}function Oq(){return G.jsxs("main",{role:"main",children:[G.jsx(wq,{}),G.jsxs("section",{id:"work",className:"section","aria-labelledby":"work-title",children:[G.jsx("h2",{id:"work-title",className:"h2",children:"Selected Work"}),G.jsx("p",{className:"muted",children:"A few deep dives into recent builds and experiments."})]}),G.jsx(Rq,{}),G.jsx(Dq,{}),G.jsx(Lq,{})]})}var U1={exports:{}},sh={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j2;function Pq(){return j2||(j2=1,sh.ConcurrentRoot=1,sh.ContinuousEventPriority=8,sh.DefaultEventPriority=32,sh.DiscreteEventPriority=2,sh.IdleEventPriority=268435456,sh.LegacyRoot=0,sh.NoEventPriority=0),sh}var q2;function Nq(){return q2||(q2=1,U1.exports=Pq()),U1.exports}var qS=Nq();/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const fE="179",Fq={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Uq={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},N3=0,xw=1,F3=2,kq=3,U3=0,CT=1,hv=2,lc=3,bu=0,wa=1,cc=2,Eu=0,nm=1,_w=2,Sw=3,bw=4,k3=5,qf=100,G3=101,H3=102,z3=103,Q3=104,V3=200,j3=201,q3=202,K3=203,xb=204,_b=205,Y3=206,X3=207,W3=208,$3=209,J3=210,Z3=211,ek=212,tk=213,nk=214,Sb=0,bb=1,Tb=2,hm=3,Cb=4,Ib=5,Mb=6,wb=7,dE=0,ik=1,sk=2,hc=0,rk=1,ak=2,ok=3,sB=4,lk=5,ck=6,uk=7,Tw="attached",hk="detached",IT=300,Tu=301,cd=302,LA=303,Lv=304,r0=306,Cu=1e3,Ur=1001,OA=1002,Ws=1003,MT=1004,Gq=1004,Vp=1005,Hq=1005,Si=1006,gA=1007,zq=1007,Oo=1008,Qq=1008,ds=1009,rB=1010,aB=1011,PA=1012,wT=1013,Rh=1014,ss=1015,hr=1016,RT=1017,BT=1018,NA=1020,oB=35902,lB=1021,cB=1022,rs=1023,FA=1026,UA=1027,gu=1028,pE=1029,Xf=1030,DT=1031,Vq=1032,LT=1033,AA=33776,fv=33777,dv=33778,yA=33779,Ov=35840,Rb=35841,Pv=35842,Bb=35843,Nv=36196,Fv=37492,Uv=37496,kv=37808,Db=37809,Lb=37810,Ob=37811,kA=37812,Pb=37813,Nb=37814,Fb=37815,Ub=37816,kb=37817,Gb=37818,Hb=37819,zb=37820,Qb=37821,vA=36492,Vb=36494,jb=36495,uB=36283,qb=36284,Kb=36285,Yb=36286,fk=2200,dk=2201,pk=2202,GA=2300,HA=2301,KS=2302,jp=2400,qp=2401,Gv=2402,OT=2500,hB=2501,mk=0,fB=1,Xb=2,gk=3200,dB=3201,jq=3202,qq=3203,yd=0,Ak=1,Sh="",sa="srgb",ud="srgb-linear",Hv="linear",Ei="srgb",Kq=0,Up=7680,Yq=7681,Xq=7682,Wq=7683,$q=34055,Jq=34056,Zq=5386,eK=512,tK=513,nK=514,iK=515,sK=516,rK=517,aK=518,Cw=519,yk=512,vk=513,Ek=514,pB=515,xk=516,_k=517,Sk=518,bk=519,zv=35044,oK=35048,lK=35040,cK=35045,uK=35049,hK=35041,fK=35046,dK=35050,pK=35042,mK="100",Iw="300 es",Po=2e3,zA=2001,gK={COMPUTE:"compute",RENDER:"render"},AK={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},yK={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};let Bu=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const i=n[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let r=0,a=i.length;r<a;r++)i[r].call(this,e);e.target=null}}};const $r=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let K2=1234567;const im=Math.PI/180,QA=180/Math.PI;function Uo(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return($r[s&255]+$r[s>>8&255]+$r[s>>16&255]+$r[s>>24&255]+"-"+$r[e&255]+$r[e>>8&255]+"-"+$r[e>>16&15|64]+$r[e>>24&255]+"-"+$r[t&63|128]+$r[t>>8&255]+"-"+$r[t>>16&255]+$r[t>>24&255]+$r[n&255]+$r[n>>8&255]+$r[n>>16&255]+$r[n>>24&255]).toLowerCase()}function pn(s,e,t){return Math.max(e,Math.min(t,s))}function mB(s,e){return(s%e+e)%e}function vK(s,e,t,n,i){return n+(s-e)*(i-n)/(t-e)}function EK(s,e,t){return s!==e?(t-s)/(e-s):0}function pv(s,e,t){return(1-t)*s+t*e}function xK(s,e,t,n){return pv(s,e,1-Math.exp(-t*n))}function _K(s,e=1){return e-Math.abs(mB(s,e*2)-e)}function SK(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function bK(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function TK(s,e){return s+Math.floor(Math.random()*(e-s+1))}function CK(s,e){return s+Math.random()*(e-s)}function IK(s){return s*(.5-Math.random())}function MK(s){s!==void 0&&(K2=s);let e=K2+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function wK(s){return s*im}function RK(s){return s*QA}function BK(s){return(s&s-1)===0&&s!==0}function DK(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function LK(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function OK(s,e,t,n,i){const r=Math.cos,a=Math.sin,o=r(t/2),l=a(t/2),c=r((e+n)/2),h=a((e+n)/2),f=r((e-n)/2),p=a((e-n)/2),g=r((n-e)/2),y=a((n-e)/2);switch(i){case"XYX":s.set(o*h,l*f,l*p,o*c);break;case"YZY":s.set(l*p,o*h,l*f,o*c);break;case"ZXZ":s.set(l*f,l*p,o*h,o*c);break;case"XZX":s.set(o*h,l*y,l*g,o*c);break;case"YXY":s.set(l*g,o*h,l*y,o*c);break;case"ZYZ":s.set(l*y,l*g,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Ca(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function wn(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const Fr={DEG2RAD:im,RAD2DEG:QA,generateUUID:Uo,clamp:pn,euclideanModulo:mB,mapLinear:vK,inverseLerp:EK,lerp:pv,damp:xK,pingpong:_K,smoothstep:SK,smootherstep:bK,randInt:TK,randFloat:CK,randFloatSpread:IK,seededRandom:MK,degToRad:wK,radToDeg:RK,isPowerOfTwo:BK,ceilPowerOfTwo:DK,floorPowerOfTwo:LK,setQuaternionFromProperEuler:OK,normalize:wn,denormalize:Ca};let We=class Tk{constructor(e=0,t=0){Tk.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=pn(this.x,e.x,t.x),this.y=pn(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=pn(this.x,e,t),this.y=pn(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(pn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(pn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Xs=class{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,a,o){let l=n[i+0],c=n[i+1],h=n[i+2],f=n[i+3];const p=r[a+0],g=r[a+1],y=r[a+2],x=r[a+3];if(o===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=f;return}if(o===1){e[t+0]=p,e[t+1]=g,e[t+2]=y,e[t+3]=x;return}if(f!==x||l!==p||c!==g||h!==y){let E=1-o;const _=l*p+c*g+h*y+f*x,b=_>=0?1:-1,C=1-_*_;if(C>Number.EPSILON){const M=Math.sqrt(C),R=Math.atan2(M,_*b);E=Math.sin(E*R)/M,o=Math.sin(o*R)/M}const I=o*b;if(l=l*E+p*I,c=c*E+g*I,h=h*E+y*I,f=f*E+x*I,E===1-o){const M=1/Math.sqrt(l*l+c*c+h*h+f*f);l*=M,c*=M,h*=M,f*=M}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=f}static multiplyQuaternionsFlat(e,t,n,i,r,a){const o=n[i],l=n[i+1],c=n[i+2],h=n[i+3],f=r[a],p=r[a+1],g=r[a+2],y=r[a+3];return e[t]=o*y+h*f+l*g-c*p,e[t+1]=l*y+h*p+c*f-o*g,e[t+2]=c*y+h*g+o*p-l*f,e[t+3]=h*y-o*f-l*p-c*g,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,r=e._z,a=e._order,o=Math.cos,l=Math.sin,c=o(n/2),h=o(i/2),f=o(r/2),p=l(n/2),g=l(i/2),y=l(r/2);switch(a){case"XYZ":this._x=p*h*f+c*g*y,this._y=c*g*f-p*h*y,this._z=c*h*y+p*g*f,this._w=c*h*f-p*g*y;break;case"YXZ":this._x=p*h*f+c*g*y,this._y=c*g*f-p*h*y,this._z=c*h*y-p*g*f,this._w=c*h*f+p*g*y;break;case"ZXY":this._x=p*h*f-c*g*y,this._y=c*g*f+p*h*y,this._z=c*h*y+p*g*f,this._w=c*h*f-p*g*y;break;case"ZYX":this._x=p*h*f-c*g*y,this._y=c*g*f+p*h*y,this._z=c*h*y-p*g*f,this._w=c*h*f+p*g*y;break;case"YZX":this._x=p*h*f+c*g*y,this._y=c*g*f+p*h*y,this._z=c*h*y-p*g*f,this._w=c*h*f-p*g*y;break;case"XZY":this._x=p*h*f-c*g*y,this._y=c*g*f-p*h*y,this._z=c*h*y+p*g*f,this._w=c*h*f+p*g*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],o=t[5],l=t[9],c=t[2],h=t[6],f=t[10],p=n+o+f;if(p>0){const g=.5/Math.sqrt(p+1);this._w=.25/g,this._x=(h-l)*g,this._y=(r-c)*g,this._z=(a-i)*g}else if(n>o&&n>f){const g=2*Math.sqrt(1+n-o-f);this._w=(h-l)/g,this._x=.25*g,this._y=(i+a)/g,this._z=(r+c)/g}else if(o>f){const g=2*Math.sqrt(1+o-n-f);this._w=(r-c)/g,this._x=(i+a)/g,this._y=.25*g,this._z=(l+h)/g}else{const g=2*Math.sqrt(1+f-n-o);this._w=(a-i)/g,this._x=(r+c)/g,this._y=(l+h)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(pn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,l=t._y,c=t._z,h=t._w;return this._x=n*h+a*o+i*c-r*l,this._y=i*h+a*l+r*o-n*c,this._z=r*h+a*c+n*l-i*o,this._w=a*h-n*o-i*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,r=this._z,a=this._w;let o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;const l=1-o*o;if(l<=Number.EPSILON){const g=1-t;return this._w=g*a+t*this._w,this._x=g*n+t*this._x,this._y=g*i+t*this._y,this._z=g*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,o),f=Math.sin((1-t)*h)/c,p=Math.sin(t*h)/c;return this._w=a*f+this._w*p,this._x=n*f+this._x*p,this._y=i*f+this._y*p,this._z=r*f+this._z*p,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class de{constructor(e=0,t=0,n=0){de.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Y2.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Y2.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,l=e.w,c=2*(a*i-o*n),h=2*(o*t-r*i),f=2*(r*n-a*t);return this.x=t+l*c+a*f-o*h,this.y=n+l*h+o*c-r*f,this.z=i+l*f+r*h-a*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=pn(this.x,e.x,t.x),this.y=pn(this.y,e.y,t.y),this.z=pn(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=pn(this.x,e,t),this.y=pn(this.y,e,t),this.z=pn(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(pn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,l=t.z;return this.x=i*l-r*o,this.y=r*a-n*l,this.z=n*o-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return k1.copy(this).projectOnVector(e),this.sub(k1)}reflect(e){return this.sub(k1.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(pn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const k1=new de,Y2=new Xs;class un{constructor(e,t,n,i,r,a,o,l,c){un.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,r,a,o,l,c)}set(e,t,n,i,r,a,o,l,c){const h=this.elements;return h[0]=e,h[1]=i,h[2]=o,h[3]=t,h[4]=r,h[5]=l,h[6]=n,h[7]=a,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],l=n[6],c=n[1],h=n[4],f=n[7],p=n[2],g=n[5],y=n[8],x=i[0],E=i[3],_=i[6],b=i[1],C=i[4],I=i[7],M=i[2],R=i[5],D=i[8];return r[0]=a*x+o*b+l*M,r[3]=a*E+o*C+l*R,r[6]=a*_+o*I+l*D,r[1]=c*x+h*b+f*M,r[4]=c*E+h*C+f*R,r[7]=c*_+h*I+f*D,r[2]=p*x+g*b+y*M,r[5]=p*E+g*C+y*R,r[8]=p*_+g*I+y*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8];return t*a*h-t*o*c-n*r*h+n*o*l+i*r*c-i*a*l}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],f=h*a-o*c,p=o*l-h*r,g=c*r-a*l,y=t*f+n*p+i*g;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/y;return e[0]=f*x,e[1]=(i*c-h*n)*x,e[2]=(o*n-i*a)*x,e[3]=p*x,e[4]=(h*t-i*l)*x,e[5]=(i*r-o*t)*x,e[6]=g*x,e[7]=(n*l-c*t)*x,e[8]=(a*t-n*r)*x,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,a,o){const l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*a+c*o)+a+e,-i*c,i*l,-i*(-c*a+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(G1.makeScale(e,t)),this}rotate(e){return this.premultiply(G1.makeRotation(-e)),this}translate(e,t){return this.premultiply(G1.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const G1=new un;function Ck(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}const PK={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function aA(s,e){return new PK[s](e)}function Qv(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}function Ik(){const s=Qv("canvas");return s.style.display="block",s}const X2={};function EA(s){s in X2||(X2[s]=!0,console.warn(s))}function NK(s,e,t){return new Promise(function(n,i){function r(){switch(s.clientWaitSync(e,s.SYNC_FLUSH_COMMANDS_BIT,0)){case s.WAIT_FAILED:i();break;case s.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:n()}}setTimeout(r,t)})}const W2=new un().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),$2=new un().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function FK(){const s={enabled:!0,workingColorSpace:ud,spaces:{},convert:function(i,r,a){return this.enabled===!1||r===a||!r||!a||(this.spaces[r].transfer===Ei&&(i.r=Ch(i.r),i.g=Ch(i.g),i.b=Ch(i.b)),this.spaces[r].primaries!==this.spaces[a].primaries&&(i.applyMatrix3(this.spaces[r].toXYZ),i.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Ei&&(i.r=xA(i.r),i.g=xA(i.g),i.b=xA(i.b))),i},workingToColorSpace:function(i,r){return this.convert(i,this.workingColorSpace,r)},colorSpaceToWorking:function(i,r){return this.convert(i,r,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===Sh?Hv:this.spaces[i].transfer},getLuminanceCoefficients:function(i,r=this.workingColorSpace){return i.fromArray(this.spaces[r].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,r,a){return i.copy(this.spaces[r].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,r){return EA("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),s.workingToColorSpace(i,r)},toWorkingColorSpace:function(i,r){return EA("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),s.colorSpaceToWorking(i,r)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return s.define({[ud]:{primaries:e,whitePoint:n,transfer:Hv,toXYZ:W2,fromXYZ:$2,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:sa},outputColorSpaceConfig:{drawingBufferColorSpace:sa}},[sa]:{primaries:e,whitePoint:n,transfer:Ei,toXYZ:W2,fromXYZ:$2,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:sa}}}),s}const Jn=FK();function Ch(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function xA(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}let Mg;class Mk{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{Mg===void 0&&(Mg=Qv("canvas")),Mg.width=e.width,Mg.height=e.height;const i=Mg.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=Mg}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Qv("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let a=0;a<r.length;a++)r[a]=Ch(r[a]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Ch(t[n]/255)*255):t[n]=Ch(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let UK=0;class Wf{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:UK++}),this.uuid=Uo(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let r;if(Array.isArray(i)){r=[];for(let a=0,o=i.length;a<o;a++)i[a].isDataTexture?r.push(H1(i[a].image)):r.push(H1(i[a]))}else r=H1(i);n.url=r}return t||(e.images[this.uuid]=n),n}}function H1(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?Mk.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let kK=0;const z1=new de;class Hi extends Bu{constructor(e=Hi.DEFAULT_IMAGE,t=Hi.DEFAULT_MAPPING,n=Ur,i=Ur,r=Si,a=Oo,o=rs,l=ds,c=Hi.DEFAULT_ANISOTROPY,h=Sh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:kK++}),this.uuid=Uo(),this.name="",this.source=new Wf(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new We(0,0),this.repeat=new We(1,1),this.center=new We(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new un,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(z1).x}get height(){return this.source.getSize(z1).y}get depth(){return this.source.getSize(z1).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==IT)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Cu:e.x=e.x-Math.floor(e.x);break;case Ur:e.x=e.x<0?0:1;break;case OA:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Cu:e.y=e.y-Math.floor(e.y);break;case Ur:e.y=e.y<0?0:1;break;case OA:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Hi.DEFAULT_IMAGE=null;Hi.DEFAULT_MAPPING=IT;Hi.DEFAULT_ANISOTROPY=1;class Tn{constructor(e=0,t=0,n=0,i=1){Tn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const l=e.elements,c=l[0],h=l[4],f=l[8],p=l[1],g=l[5],y=l[9],x=l[2],E=l[6],_=l[10];if(Math.abs(h-p)<.01&&Math.abs(f-x)<.01&&Math.abs(y-E)<.01){if(Math.abs(h+p)<.1&&Math.abs(f+x)<.1&&Math.abs(y+E)<.1&&Math.abs(c+g+_-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const C=(c+1)/2,I=(g+1)/2,M=(_+1)/2,R=(h+p)/4,D=(f+x)/4,P=(y+E)/4;return C>I&&C>M?C<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(C),i=R/n,r=D/n):I>M?I<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(I),n=R/i,r=P/i):M<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(M),n=D/r,i=P/r),this.set(n,i,r,t),this}let b=Math.sqrt((E-y)*(E-y)+(f-x)*(f-x)+(p-h)*(p-h));return Math.abs(b)<.001&&(b=1),this.x=(E-y)/b,this.y=(f-x)/b,this.z=(p-h)/b,this.w=Math.acos((c+g+_-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=pn(this.x,e.x,t.x),this.y=pn(this.y,e.y,t.y),this.z=pn(this.z,e.z,t.z),this.w=pn(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=pn(this.x,e,t),this.y=pn(this.y,e,t),this.z=pn(this.z,e,t),this.w=pn(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(pn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class gB extends Bu{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Si,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new Tn(0,0,e,t),this.scissorTest=!1,this.viewport=new Tn(0,0,e,t);const i={width:e,height:t,depth:n.depth},r=new Hi(i);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=r.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:Si,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new Wf(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class _l extends gB{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class PT extends Hi{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Ws,this.minFilter=Ws,this.wrapR=Ur,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class GK extends _l{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new PT(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}let NT=class extends Hi{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Ws,this.minFilter=Ws,this.wrapR=Ur,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class HK extends _l{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new NT(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class kr{constructor(e=new de(1/0,1/0,1/0),t=new de(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Jl.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Jl.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Jl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const r=n.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=r.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,Jl):Jl.fromBufferAttribute(r,a),Jl.applyMatrix4(e.matrixWorld),this.expandByPoint(Jl);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),M_.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),M_.copy(n.boundingBox)),M_.applyMatrix4(e.matrixWorld),this.union(M_)}const i=e.children;for(let r=0,a=i.length;r<a;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Jl),Jl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(By),w_.subVectors(this.max,By),wg.subVectors(e.a,By),Rg.subVectors(e.b,By),Bg.subVectors(e.c,By),Df.subVectors(Rg,wg),Lf.subVectors(Bg,Rg),yp.subVectors(wg,Bg);let t=[0,-Df.z,Df.y,0,-Lf.z,Lf.y,0,-yp.z,yp.y,Df.z,0,-Df.x,Lf.z,0,-Lf.x,yp.z,0,-yp.x,-Df.y,Df.x,0,-Lf.y,Lf.x,0,-yp.y,yp.x,0];return!Q1(t,wg,Rg,Bg,w_)||(t=[1,0,0,0,1,0,0,0,1],!Q1(t,wg,Rg,Bg,w_))?!1:(R_.crossVectors(Df,Lf),t=[R_.x,R_.y,R_.z],Q1(t,wg,Rg,Bg,w_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Jl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Jl).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(rh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),rh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),rh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),rh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),rh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),rh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),rh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),rh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(rh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const rh=[new de,new de,new de,new de,new de,new de,new de,new de],Jl=new de,M_=new kr,wg=new de,Rg=new de,Bg=new de,Df=new de,Lf=new de,yp=new de,By=new de,w_=new de,R_=new de,vp=new de;function Q1(s,e,t,n,i){for(let r=0,a=s.length-3;r<=a;r+=3){vp.fromArray(s,r);const o=i.x*Math.abs(vp.x)+i.y*Math.abs(vp.y)+i.z*Math.abs(vp.z),l=e.dot(vp),c=t.dot(vp),h=n.dot(vp);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>o)return!1}return!0}const zK=new kr,Dy=new de,V1=new de;class Sr{constructor(e=new de,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):zK.setFromPoints(e).getCenter(n);let i=0;for(let r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Dy.subVectors(e,this.center);const t=Dy.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(Dy,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(V1.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Dy.copy(e.center).add(V1)),this.expandByPoint(Dy.copy(e.center).sub(V1))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const ah=new de,j1=new de,B_=new de,Of=new de,q1=new de,D_=new de,K1=new de;let a0=class{constructor(e=new de,t=new de(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ah)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ah.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ah.copy(this.origin).addScaledVector(this.direction,t),ah.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){j1.copy(e).add(t).multiplyScalar(.5),B_.copy(t).sub(e).normalize(),Of.copy(this.origin).sub(j1);const r=e.distanceTo(t)*.5,a=-this.direction.dot(B_),o=Of.dot(this.direction),l=-Of.dot(B_),c=Of.lengthSq(),h=Math.abs(1-a*a);let f,p,g,y;if(h>0)if(f=a*l-o,p=a*o-l,y=r*h,f>=0)if(p>=-y)if(p<=y){const x=1/h;f*=x,p*=x,g=f*(f+a*p+2*o)+p*(a*f+p+2*l)+c}else p=r,f=Math.max(0,-(a*p+o)),g=-f*f+p*(p+2*l)+c;else p=-r,f=Math.max(0,-(a*p+o)),g=-f*f+p*(p+2*l)+c;else p<=-y?(f=Math.max(0,-(-a*r+o)),p=f>0?-r:Math.min(Math.max(-r,-l),r),g=-f*f+p*(p+2*l)+c):p<=y?(f=0,p=Math.min(Math.max(-r,-l),r),g=p*(p+2*l)+c):(f=Math.max(0,-(a*r+o)),p=f>0?r:Math.min(Math.max(-r,-l),r),g=-f*f+p*(p+2*l)+c);else p=a>0?-r:r,f=Math.max(0,-(a*p+o)),g=-f*f+p*(p+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,f),i&&i.copy(j1).addScaledVector(B_,p),g}intersectSphere(e,t){ah.subVectors(e.center,this.origin);const n=ah.dot(this.direction),i=ah.dot(ah)-n*n,r=e.radius*e.radius;if(i>r)return null;const a=Math.sqrt(r-i),o=n-a,l=n+a;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,a,o,l;const c=1/this.direction.x,h=1/this.direction.y,f=1/this.direction.z,p=this.origin;return c>=0?(n=(e.min.x-p.x)*c,i=(e.max.x-p.x)*c):(n=(e.max.x-p.x)*c,i=(e.min.x-p.x)*c),h>=0?(r=(e.min.y-p.y)*h,a=(e.max.y-p.y)*h):(r=(e.max.y-p.y)*h,a=(e.min.y-p.y)*h),n>a||r>i||((r>n||isNaN(n))&&(n=r),(a<i||isNaN(i))&&(i=a),f>=0?(o=(e.min.z-p.z)*f,l=(e.max.z-p.z)*f):(o=(e.max.z-p.z)*f,l=(e.min.z-p.z)*f),n>l||o>i)||((o>n||n!==n)&&(n=o),(l<i||i!==i)&&(i=l),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,ah)!==null}intersectTriangle(e,t,n,i,r){q1.subVectors(t,e),D_.subVectors(n,e),K1.crossVectors(q1,D_);let a=this.direction.dot(K1),o;if(a>0){if(i)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Of.subVectors(this.origin,e);const l=o*this.direction.dot(D_.crossVectors(Of,D_));if(l<0)return null;const c=o*this.direction.dot(q1.cross(Of));if(c<0||l+c>a)return null;const h=-o*Of.dot(K1);return h<0?null:this.at(h/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Pt{constructor(e,t,n,i,r,a,o,l,c,h,f,p,g,y,x,E){Pt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,r,a,o,l,c,h,f,p,g,y,x,E)}set(e,t,n,i,r,a,o,l,c,h,f,p,g,y,x,E){const _=this.elements;return _[0]=e,_[4]=t,_[8]=n,_[12]=i,_[1]=r,_[5]=a,_[9]=o,_[13]=l,_[2]=c,_[6]=h,_[10]=f,_[14]=p,_[3]=g,_[7]=y,_[11]=x,_[15]=E,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Pt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Dg.setFromMatrixColumn(e,0).length(),r=1/Dg.setFromMatrixColumn(e,1).length(),a=1/Dg.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),l=Math.cos(i),c=Math.sin(i),h=Math.cos(r),f=Math.sin(r);if(e.order==="XYZ"){const p=a*h,g=a*f,y=o*h,x=o*f;t[0]=l*h,t[4]=-l*f,t[8]=c,t[1]=g+y*c,t[5]=p-x*c,t[9]=-o*l,t[2]=x-p*c,t[6]=y+g*c,t[10]=a*l}else if(e.order==="YXZ"){const p=l*h,g=l*f,y=c*h,x=c*f;t[0]=p+x*o,t[4]=y*o-g,t[8]=a*c,t[1]=a*f,t[5]=a*h,t[9]=-o,t[2]=g*o-y,t[6]=x+p*o,t[10]=a*l}else if(e.order==="ZXY"){const p=l*h,g=l*f,y=c*h,x=c*f;t[0]=p-x*o,t[4]=-a*f,t[8]=y+g*o,t[1]=g+y*o,t[5]=a*h,t[9]=x-p*o,t[2]=-a*c,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const p=a*h,g=a*f,y=o*h,x=o*f;t[0]=l*h,t[4]=y*c-g,t[8]=p*c+x,t[1]=l*f,t[5]=x*c+p,t[9]=g*c-y,t[2]=-c,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const p=a*l,g=a*c,y=o*l,x=o*c;t[0]=l*h,t[4]=x-p*f,t[8]=y*f+g,t[1]=f,t[5]=a*h,t[9]=-o*h,t[2]=-c*h,t[6]=g*f+y,t[10]=p-x*f}else if(e.order==="XZY"){const p=a*l,g=a*c,y=o*l,x=o*c;t[0]=l*h,t[4]=-f,t[8]=c*h,t[1]=p*f+x,t[5]=a*h,t[9]=g*f-y,t[2]=y*f-g,t[6]=o*h,t[10]=x*f+p}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(QK,e,VK)}lookAt(e,t,n){const i=this.elements;return Co.subVectors(e,t),Co.lengthSq()===0&&(Co.z=1),Co.normalize(),Pf.crossVectors(n,Co),Pf.lengthSq()===0&&(Math.abs(n.z)===1?Co.x+=1e-4:Co.z+=1e-4,Co.normalize(),Pf.crossVectors(n,Co)),Pf.normalize(),L_.crossVectors(Co,Pf),i[0]=Pf.x,i[4]=L_.x,i[8]=Co.x,i[1]=Pf.y,i[5]=L_.y,i[9]=Co.y,i[2]=Pf.z,i[6]=L_.z,i[10]=Co.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],l=n[8],c=n[12],h=n[1],f=n[5],p=n[9],g=n[13],y=n[2],x=n[6],E=n[10],_=n[14],b=n[3],C=n[7],I=n[11],M=n[15],R=i[0],D=i[4],P=i[8],L=i[12],O=i[1],U=i[5],j=i[9],H=i[13],z=i[2],q=i[6],k=i[10],W=i[14],V=i[3],X=i[7],K=i[11],te=i[15];return r[0]=a*R+o*O+l*z+c*V,r[4]=a*D+o*U+l*q+c*X,r[8]=a*P+o*j+l*k+c*K,r[12]=a*L+o*H+l*W+c*te,r[1]=h*R+f*O+p*z+g*V,r[5]=h*D+f*U+p*q+g*X,r[9]=h*P+f*j+p*k+g*K,r[13]=h*L+f*H+p*W+g*te,r[2]=y*R+x*O+E*z+_*V,r[6]=y*D+x*U+E*q+_*X,r[10]=y*P+x*j+E*k+_*K,r[14]=y*L+x*H+E*W+_*te,r[3]=b*R+C*O+I*z+M*V,r[7]=b*D+C*U+I*q+M*X,r[11]=b*P+C*j+I*k+M*K,r[15]=b*L+C*H+I*W+M*te,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],l=e[9],c=e[13],h=e[2],f=e[6],p=e[10],g=e[14],y=e[3],x=e[7],E=e[11],_=e[15];return y*(+r*l*f-i*c*f-r*o*p+n*c*p+i*o*g-n*l*g)+x*(+t*l*g-t*c*p+r*a*p-i*a*g+i*c*h-r*l*h)+E*(+t*c*f-t*o*g-r*a*f+n*a*g+r*o*h-n*c*h)+_*(-i*o*h-t*l*f+t*o*p+i*a*f-n*a*p+n*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],f=e[9],p=e[10],g=e[11],y=e[12],x=e[13],E=e[14],_=e[15],b=f*E*c-x*p*c+x*l*g-o*E*g-f*l*_+o*p*_,C=y*p*c-h*E*c-y*l*g+a*E*g+h*l*_-a*p*_,I=h*x*c-y*f*c+y*o*g-a*x*g-h*o*_+a*f*_,M=y*f*l-h*x*l-y*o*p+a*x*p+h*o*E-a*f*E,R=t*b+n*C+i*I+r*M;if(R===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const D=1/R;return e[0]=b*D,e[1]=(x*p*r-f*E*r-x*i*g+n*E*g+f*i*_-n*p*_)*D,e[2]=(o*E*r-x*l*r+x*i*c-n*E*c-o*i*_+n*l*_)*D,e[3]=(f*l*r-o*p*r-f*i*c+n*p*c+o*i*g-n*l*g)*D,e[4]=C*D,e[5]=(h*E*r-y*p*r+y*i*g-t*E*g-h*i*_+t*p*_)*D,e[6]=(y*l*r-a*E*r-y*i*c+t*E*c+a*i*_-t*l*_)*D,e[7]=(a*p*r-h*l*r+h*i*c-t*p*c-a*i*g+t*l*g)*D,e[8]=I*D,e[9]=(y*f*r-h*x*r-y*n*g+t*x*g+h*n*_-t*f*_)*D,e[10]=(a*x*r-y*o*r+y*n*c-t*x*c-a*n*_+t*o*_)*D,e[11]=(h*o*r-a*f*r-h*n*c+t*f*c+a*n*g-t*o*g)*D,e[12]=M*D,e[13]=(h*x*i-y*f*i+y*n*p-t*x*p-h*n*E+t*f*E)*D,e[14]=(y*o*i-a*x*i-y*n*l+t*x*l+a*n*E-t*o*E)*D,e[15]=(a*f*i-h*o*i+h*n*l-t*f*l-a*n*p+t*o*p)*D,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,l=e.z,c=r*a,h=r*o;return this.set(c*a+n,c*o-i*l,c*l+i*o,0,c*o+i*l,h*o+n,h*l-i*a,0,c*l-i*o,h*l+i*a,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,a=t._y,o=t._z,l=t._w,c=r+r,h=a+a,f=o+o,p=r*c,g=r*h,y=r*f,x=a*h,E=a*f,_=o*f,b=l*c,C=l*h,I=l*f,M=n.x,R=n.y,D=n.z;return i[0]=(1-(x+_))*M,i[1]=(g+I)*M,i[2]=(y-C)*M,i[3]=0,i[4]=(g-I)*R,i[5]=(1-(p+_))*R,i[6]=(E+b)*R,i[7]=0,i[8]=(y+C)*D,i[9]=(E-b)*D,i[10]=(1-(p+x))*D,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=Dg.set(i[0],i[1],i[2]).length();const a=Dg.set(i[4],i[5],i[6]).length(),o=Dg.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Zl.copy(this);const c=1/r,h=1/a,f=1/o;return Zl.elements[0]*=c,Zl.elements[1]*=c,Zl.elements[2]*=c,Zl.elements[4]*=h,Zl.elements[5]*=h,Zl.elements[6]*=h,Zl.elements[8]*=f,Zl.elements[9]*=f,Zl.elements[10]*=f,t.setFromRotationMatrix(Zl),n.x=r,n.y=a,n.z=o,this}makePerspective(e,t,n,i,r,a,o=Po,l=!1){const c=this.elements,h=2*r/(t-e),f=2*r/(n-i),p=(t+e)/(t-e),g=(n+i)/(n-i);let y,x;if(l)y=r/(a-r),x=a*r/(a-r);else if(o===Po)y=-(a+r)/(a-r),x=-2*a*r/(a-r);else if(o===zA)y=-a/(a-r),x=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return c[0]=h,c[4]=0,c[8]=p,c[12]=0,c[1]=0,c[5]=f,c[9]=g,c[13]=0,c[2]=0,c[6]=0,c[10]=y,c[14]=x,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,i,r,a,o=Po,l=!1){const c=this.elements,h=2/(t-e),f=2/(n-i),p=-(t+e)/(t-e),g=-(n+i)/(n-i);let y,x;if(l)y=1/(a-r),x=a/(a-r);else if(o===Po)y=-2/(a-r),x=-(a+r)/(a-r);else if(o===zA)y=-1/(a-r),x=-r/(a-r);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return c[0]=h,c[4]=0,c[8]=0,c[12]=p,c[1]=0,c[5]=f,c[9]=0,c[13]=g,c[2]=0,c[6]=0,c[10]=y,c[14]=x,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Dg=new de,Zl=new Pt,QK=new de(0,0,0),VK=new de(1,1,1),Pf=new de,L_=new de,Co=new de,J2=new Pt,Z2=new Xs;class Os{constructor(e=0,t=0,n=0,i=Os.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],a=i[4],o=i[8],l=i[1],c=i[5],h=i[9],f=i[2],p=i[6],g=i[10];switch(t){case"XYZ":this._y=Math.asin(pn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,g),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-pn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,g),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-f,r),this._z=0);break;case"ZXY":this._x=Math.asin(pn(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-f,g),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-pn(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(p,g),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(pn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-f,r)):(this._x=0,this._y=Math.atan2(o,g));break;case"XZY":this._z=Math.asin(-pn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-h,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return J2.makeRotationFromQuaternion(e),this.setFromRotationMatrix(J2,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Z2.setFromEuler(this),this.setFromQuaternion(Z2,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Os.DEFAULT_ORDER="XYZ";class VA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let jK=0;const eO=new de,Lg=new Xs,oh=new Pt,O_=new de,Ly=new de,qK=new de,KK=new Xs,tO=new de(1,0,0),nO=new de(0,1,0),iO=new de(0,0,1),sO={type:"added"},YK={type:"removed"},Og={type:"childadded",child:null},Y1={type:"childremoved",child:null};class Qn extends Bu{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:jK++}),this.uuid=Uo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Qn.DEFAULT_UP.clone();const e=new de,t=new Os,n=new Xs,i=new de(1,1,1);function r(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Pt},normalMatrix:{value:new un}}),this.matrix=new Pt,this.matrixWorld=new Pt,this.matrixAutoUpdate=Qn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Qn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new VA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Lg.setFromAxisAngle(e,t),this.quaternion.multiply(Lg),this}rotateOnWorldAxis(e,t){return Lg.setFromAxisAngle(e,t),this.quaternion.premultiply(Lg),this}rotateX(e){return this.rotateOnAxis(tO,e)}rotateY(e){return this.rotateOnAxis(nO,e)}rotateZ(e){return this.rotateOnAxis(iO,e)}translateOnAxis(e,t){return eO.copy(e).applyQuaternion(this.quaternion),this.position.add(eO.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(tO,e)}translateY(e){return this.translateOnAxis(nO,e)}translateZ(e){return this.translateOnAxis(iO,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(oh.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?O_.copy(e):O_.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Ly.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?oh.lookAt(Ly,O_,this.up):oh.lookAt(O_,Ly,this.up),this.quaternion.setFromRotationMatrix(oh),i&&(oh.extractRotation(i.matrixWorld),Lg.setFromRotationMatrix(oh),this.quaternion.premultiply(Lg.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(sO),Og.child=e,this.dispatchEvent(Og),Og.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(YK),Y1.child=e,this.dispatchEvent(Y1),Y1.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),oh.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),oh.multiply(e.parent.matrixWorld)),e.applyMatrix4(oh),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(sO),Og.child=e,this.dispatchEvent(Og),Og.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let r=0,a=i.length;r<a;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ly,e,qK),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ly,KK,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let r=0,a=i.length;r<a;r++)i[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(o=>({...o})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function r(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const f=l[c];r(e.shapes,f)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(r(e.materials,this.material[l]));i.material=o}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];i.animations.push(r(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),c=a(e.textures),h=a(e.images),f=a(e.shapes),p=a(e.skeletons),g=a(e.animations),y=a(e.nodes);o.length>0&&(n.geometries=o),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),h.length>0&&(n.images=h),f.length>0&&(n.shapes=f),p.length>0&&(n.skeletons=p),g.length>0&&(n.animations=g),y.length>0&&(n.nodes=y)}return n.object=i,n;function a(o){const l=[];for(const c in o){const h=o[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Qn.DEFAULT_UP=new de(0,1,0);Qn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Qn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ec=new de,lh=new de,X1=new de,ch=new de,Pg=new de,Ng=new de,rO=new de,W1=new de,$1=new de,J1=new de,Z1=new Tn,eI=new Tn,tI=new Tn;class to{constructor(e=new de,t=new de,n=new de){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),ec.subVectors(e,t),i.cross(ec);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){ec.subVectors(i,t),lh.subVectors(n,t),X1.subVectors(e,t);const a=ec.dot(ec),o=ec.dot(lh),l=ec.dot(X1),c=lh.dot(lh),h=lh.dot(X1),f=a*c-o*o;if(f===0)return r.set(0,0,0),null;const p=1/f,g=(c*l-o*h)*p,y=(a*h-o*l)*p;return r.set(1-g-y,y,g)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,ch)===null?!1:ch.x>=0&&ch.y>=0&&ch.x+ch.y<=1}static getInterpolation(e,t,n,i,r,a,o,l){return this.getBarycoord(e,t,n,i,ch)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,ch.x),l.addScaledVector(a,ch.y),l.addScaledVector(o,ch.z),l)}static getInterpolatedAttribute(e,t,n,i,r,a){return Z1.setScalar(0),eI.setScalar(0),tI.setScalar(0),Z1.fromBufferAttribute(e,t),eI.fromBufferAttribute(e,n),tI.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(Z1,r.x),a.addScaledVector(eI,r.y),a.addScaledVector(tI,r.z),a}static isFrontFacing(e,t,n,i){return ec.subVectors(n,t),lh.subVectors(e,t),ec.cross(lh).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ec.subVectors(this.c,this.b),lh.subVectors(this.a,this.b),ec.cross(lh).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return to.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return to.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return to.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return to.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return to.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let a,o;Pg.subVectors(i,n),Ng.subVectors(r,n),W1.subVectors(e,n);const l=Pg.dot(W1),c=Ng.dot(W1);if(l<=0&&c<=0)return t.copy(n);$1.subVectors(e,i);const h=Pg.dot($1),f=Ng.dot($1);if(h>=0&&f<=h)return t.copy(i);const p=l*f-h*c;if(p<=0&&l>=0&&h<=0)return a=l/(l-h),t.copy(n).addScaledVector(Pg,a);J1.subVectors(e,r);const g=Pg.dot(J1),y=Ng.dot(J1);if(y>=0&&g<=y)return t.copy(r);const x=g*c-l*y;if(x<=0&&c>=0&&y<=0)return o=c/(c-y),t.copy(n).addScaledVector(Ng,o);const E=h*y-g*f;if(E<=0&&f-h>=0&&g-y>=0)return rO.subVectors(r,i),o=(f-h)/(f-h+(g-y)),t.copy(i).addScaledVector(rO,o);const _=1/(E+x+p);return a=x*_,o=p*_,t.copy(n).addScaledVector(Pg,a).addScaledVector(Ng,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const wk={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Nf={h:0,s:0,l:0},P_={h:0,s:0,l:0};function nI(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}let Tt=class{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=sa){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Jn.colorSpaceToWorking(this,t),this}setRGB(e,t,n,i=Jn.workingColorSpace){return this.r=e,this.g=t,this.b=n,Jn.colorSpaceToWorking(this,i),this}setHSL(e,t,n,i=Jn.workingColorSpace){if(e=mB(e,1),t=pn(t,0,1),n=pn(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=nI(a,r,e+1/3),this.g=nI(a,r,e),this.b=nI(a,r,e-1/3)}return Jn.colorSpaceToWorking(this,i),this}setStyle(e,t=sa){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const a=i[1],o=i[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=i[1],a=r.length;if(a===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=sa){const n=wk[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ch(e.r),this.g=Ch(e.g),this.b=Ch(e.b),this}copyLinearToSRGB(e){return this.r=xA(e.r),this.g=xA(e.g),this.b=xA(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=sa){return Jn.workingToColorSpace(Jr.copy(this),e),Math.round(pn(Jr.r*255,0,255))*65536+Math.round(pn(Jr.g*255,0,255))*256+Math.round(pn(Jr.b*255,0,255))}getHexString(e=sa){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Jn.workingColorSpace){Jn.workingToColorSpace(Jr.copy(this),t);const n=Jr.r,i=Jr.g,r=Jr.b,a=Math.max(n,i,r),o=Math.min(n,i,r);let l,c;const h=(o+a)/2;if(o===a)l=0,c=0;else{const f=a-o;switch(c=h<=.5?f/(a+o):f/(2-a-o),a){case n:l=(i-r)/f+(i<r?6:0);break;case i:l=(r-n)/f+2;break;case r:l=(n-i)/f+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=Jn.workingColorSpace){return Jn.workingToColorSpace(Jr.copy(this),t),e.r=Jr.r,e.g=Jr.g,e.b=Jr.b,e}getStyle(e=sa){Jn.workingToColorSpace(Jr.copy(this),e);const t=Jr.r,n=Jr.g,i=Jr.b;return e!==sa?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(Nf),this.setHSL(Nf.h+e,Nf.s+t,Nf.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Nf),e.getHSL(P_);const n=pv(Nf.h,P_.h,t),i=pv(Nf.s,P_.s,t),r=pv(Nf.l,P_.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Jr=new Tt;Tt.NAMES=wk;let XK=0,Ps=class extends Bu{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:XK++}),this.uuid=Uo(),this.name="",this.type="Material",this.blending=nm,this.side=bu,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=xb,this.blendDst=_b,this.blendEquation=qf,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Tt(0,0,0),this.blendAlpha=0,this.depthFunc=hm,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Cw,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Up,this.stencilZFail=Up,this.stencilZPass=Up,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==nm&&(n.blending=this.blending),this.side!==bu&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==xb&&(n.blendSrc=this.blendSrc),this.blendDst!==_b&&(n.blendDst=this.blendDst),this.blendEquation!==qf&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==hm&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Cw&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Up&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Up&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Up&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(r){const a=[];for(const o in r){const l=r[o];delete l.metadata,a.push(l)}return a}if(t){const r=i(e.textures),a=i(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};class io extends Ps{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Tt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Os,this.combine=dE,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const bh=WK();function WK(){const s=new ArrayBuffer(4),e=new Float32Array(s),t=new Uint32Array(s),n=new Uint32Array(512),i=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(n[l]=0,n[l|256]=32768,i[l]=24,i[l|256]=24):c<-14?(n[l]=1024>>-c-14,n[l|256]=1024>>-c-14|32768,i[l]=-c-1,i[l|256]=-c-1):c<=15?(n[l]=c+15<<10,n[l|256]=c+15<<10|32768,i[l]=13,i[l|256]=13):c<128?(n[l]=31744,n[l|256]=64512,i[l]=24,i[l|256]=24):(n[l]=31744,n[l|256]=64512,i[l]=13,i[l|256]=13)}const r=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;(c&8388608)===0;)c<<=1,h-=8388608;c&=-8388609,h+=947912704,r[l]=c|h}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:r,exponentTable:a,offsetTable:o}}function Wa(s){Math.abs(s)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),s=pn(s,-65504,65504),bh.floatView[0]=s;const e=bh.uint32View[0],t=e>>23&511;return bh.baseTable[t]+((e&8388607)>>bh.shiftTable[t])}function iv(s){const e=s>>10;return bh.uint32View[0]=bh.mantissaTable[bh.offsetTable[e]+(s&1023)]+bh.exponentTable[e],bh.floatView[0]}class Kp{static toHalfFloat(e){return Wa(e)}static fromHalfFloat(e){return iv(e)}}const Qs=new de,N_=new We;let $K=0;class ei{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:$K++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=zv,this.updateRanges=[],this.gpuType=ss,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)N_.fromBufferAttribute(this,t),N_.applyMatrix3(e),this.setXY(t,N_.x,N_.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Qs.fromBufferAttribute(this,t),Qs.applyMatrix3(e),this.setXYZ(t,Qs.x,Qs.y,Qs.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Qs.fromBufferAttribute(this,t),Qs.applyMatrix4(e),this.setXYZ(t,Qs.x,Qs.y,Qs.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Qs.fromBufferAttribute(this,t),Qs.applyNormalMatrix(e),this.setXYZ(t,Qs.x,Qs.y,Qs.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Qs.fromBufferAttribute(this,t),Qs.transformDirection(e),this.setXYZ(t,Qs.x,Qs.y,Qs.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Ca(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=wn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Ca(t,this.array)),t}setX(e,t){return this.normalized&&(t=wn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Ca(t,this.array)),t}setY(e,t){return this.normalized&&(t=wn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Ca(t,this.array)),t}setZ(e,t){return this.normalized&&(t=wn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Ca(t,this.array)),t}setW(e,t){return this.normalized&&(t=wn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=wn(t,this.array),n=wn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=wn(t,this.array),n=wn(n,this.array),i=wn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=wn(t,this.array),n=wn(n,this.array),i=wn(i,this.array),r=wn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==zv&&(e.usage=this.usage),e}}class JK extends ei{constructor(e,t,n){super(new Int8Array(e),t,n)}}class ZK extends ei{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class eY extends ei{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class tY extends ei{constructor(e,t,n){super(new Int16Array(e),t,n)}}class FT extends ei{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class nY extends ei{constructor(e,t,n){super(new Int32Array(e),t,n)}}class AB extends ei{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class iY extends ei{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=iv(this.array[e*this.itemSize]);return this.normalized&&(t=Ca(t,this.array)),t}setX(e,t){return this.normalized&&(t=wn(t,this.array)),this.array[e*this.itemSize]=Wa(t),this}getY(e){let t=iv(this.array[e*this.itemSize+1]);return this.normalized&&(t=Ca(t,this.array)),t}setY(e,t){return this.normalized&&(t=wn(t,this.array)),this.array[e*this.itemSize+1]=Wa(t),this}getZ(e){let t=iv(this.array[e*this.itemSize+2]);return this.normalized&&(t=Ca(t,this.array)),t}setZ(e,t){return this.normalized&&(t=wn(t,this.array)),this.array[e*this.itemSize+2]=Wa(t),this}getW(e){let t=iv(this.array[e*this.itemSize+3]);return this.normalized&&(t=Ca(t,this.array)),t}setW(e,t){return this.normalized&&(t=wn(t,this.array)),this.array[e*this.itemSize+3]=Wa(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=wn(t,this.array),n=wn(n,this.array)),this.array[e+0]=Wa(t),this.array[e+1]=Wa(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=wn(t,this.array),n=wn(n,this.array),i=wn(i,this.array)),this.array[e+0]=Wa(t),this.array[e+1]=Wa(n),this.array[e+2]=Wa(i),this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=wn(t,this.array),n=wn(n,this.array),i=wn(i,this.array),r=wn(r,this.array)),this.array[e+0]=Wa(t),this.array[e+1]=Wa(n),this.array[e+2]=Wa(i),this.array[e+3]=Wa(r),this}}class Bt extends ei{constructor(e,t,n){super(new Float32Array(e),t,n)}}let sY=0;const ll=new Pt,iI=new Qn,Fg=new de,Io=new kr,Oy=new kr,_r=new de;class hn extends Bu{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:sY++}),this.uuid=Uo(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ck(e)?AB:FT)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new un().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ll.makeRotationFromQuaternion(e),this.applyMatrix4(ll),this}rotateX(e){return ll.makeRotationX(e),this.applyMatrix4(ll),this}rotateY(e){return ll.makeRotationY(e),this.applyMatrix4(ll),this}rotateZ(e){return ll.makeRotationZ(e),this.applyMatrix4(ll),this}translate(e,t,n){return ll.makeTranslation(e,t,n),this.applyMatrix4(ll),this}scale(e,t,n){return ll.makeScale(e,t,n),this.applyMatrix4(ll),this}lookAt(e){return iI.lookAt(e),iI.updateMatrix(),this.applyMatrix4(iI.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Fg).negate(),this.translate(Fg.x,Fg.y,Fg.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let i=0,r=e.length;i<r;i++){const a=e[i];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Bt(n,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const r=e[i];t.setXYZ(i,r.x,r.y,r.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new kr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new de(-1/0,-1/0,-1/0),new de(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const r=t[n];Io.setFromBufferAttribute(r),this.morphTargetsRelative?(_r.addVectors(this.boundingBox.min,Io.min),this.boundingBox.expandByPoint(_r),_r.addVectors(this.boundingBox.max,Io.max),this.boundingBox.expandByPoint(_r)):(this.boundingBox.expandByPoint(Io.min),this.boundingBox.expandByPoint(Io.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new de,1/0);return}if(e){const n=this.boundingSphere.center;if(Io.setFromBufferAttribute(e),t)for(let r=0,a=t.length;r<a;r++){const o=t[r];Oy.setFromBufferAttribute(o),this.morphTargetsRelative?(_r.addVectors(Io.min,Oy.min),Io.expandByPoint(_r),_r.addVectors(Io.max,Oy.max),Io.expandByPoint(_r)):(Io.expandByPoint(Oy.min),Io.expandByPoint(Oy.max))}Io.getCenter(n);let i=0;for(let r=0,a=e.count;r<a;r++)_r.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(_r));if(t)for(let r=0,a=t.length;r<a;r++){const o=t[r],l=this.morphTargetsRelative;for(let c=0,h=o.count;c<h;c++)_r.fromBufferAttribute(o,c),l&&(Fg.fromBufferAttribute(e,c),_r.add(Fg)),i=Math.max(i,n.distanceToSquared(_r))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,i=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ei(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let P=0;P<n.count;P++)o[P]=new de,l[P]=new de;const c=new de,h=new de,f=new de,p=new We,g=new We,y=new We,x=new de,E=new de;function _(P,L,O){c.fromBufferAttribute(n,P),h.fromBufferAttribute(n,L),f.fromBufferAttribute(n,O),p.fromBufferAttribute(r,P),g.fromBufferAttribute(r,L),y.fromBufferAttribute(r,O),h.sub(c),f.sub(c),g.sub(p),y.sub(p);const U=1/(g.x*y.y-y.x*g.y);isFinite(U)&&(x.copy(h).multiplyScalar(y.y).addScaledVector(f,-g.y).multiplyScalar(U),E.copy(f).multiplyScalar(g.x).addScaledVector(h,-y.x).multiplyScalar(U),o[P].add(x),o[L].add(x),o[O].add(x),l[P].add(E),l[L].add(E),l[O].add(E))}let b=this.groups;b.length===0&&(b=[{start:0,count:e.count}]);for(let P=0,L=b.length;P<L;++P){const O=b[P],U=O.start,j=O.count;for(let H=U,z=U+j;H<z;H+=3)_(e.getX(H+0),e.getX(H+1),e.getX(H+2))}const C=new de,I=new de,M=new de,R=new de;function D(P){M.fromBufferAttribute(i,P),R.copy(M);const L=o[P];C.copy(L),C.sub(M.multiplyScalar(M.dot(L))).normalize(),I.crossVectors(R,L);const U=I.dot(l[P])<0?-1:1;a.setXYZW(P,C.x,C.y,C.z,U)}for(let P=0,L=b.length;P<L;++P){const O=b[P],U=O.start,j=O.count;for(let H=U,z=U+j;H<z;H+=3)D(e.getX(H+0)),D(e.getX(H+1)),D(e.getX(H+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new ei(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let p=0,g=n.count;p<g;p++)n.setXYZ(p,0,0,0);const i=new de,r=new de,a=new de,o=new de,l=new de,c=new de,h=new de,f=new de;if(e)for(let p=0,g=e.count;p<g;p+=3){const y=e.getX(p+0),x=e.getX(p+1),E=e.getX(p+2);i.fromBufferAttribute(t,y),r.fromBufferAttribute(t,x),a.fromBufferAttribute(t,E),h.subVectors(a,r),f.subVectors(i,r),h.cross(f),o.fromBufferAttribute(n,y),l.fromBufferAttribute(n,x),c.fromBufferAttribute(n,E),o.add(h),l.add(h),c.add(h),n.setXYZ(y,o.x,o.y,o.z),n.setXYZ(x,l.x,l.y,l.z),n.setXYZ(E,c.x,c.y,c.z)}else for(let p=0,g=t.count;p<g;p+=3)i.fromBufferAttribute(t,p+0),r.fromBufferAttribute(t,p+1),a.fromBufferAttribute(t,p+2),h.subVectors(a,r),f.subVectors(i,r),h.cross(f),n.setXYZ(p+0,h.x,h.y,h.z),n.setXYZ(p+1,h.x,h.y,h.z),n.setXYZ(p+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)_r.fromBufferAttribute(e,t),_r.normalize(),e.setXYZ(t,_r.x,_r.y,_r.z)}toNonIndexed(){function e(o,l){const c=o.array,h=o.itemSize,f=o.normalized,p=new c.constructor(l.length*h);let g=0,y=0;for(let x=0,E=l.length;x<E;x++){o.isInterleavedBufferAttribute?g=l[x]*o.data.stride+o.offset:g=l[x]*h;for(let _=0;_<h;_++)p[y++]=c[g++]}return new ei(p,h,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new hn,n=this.index.array,i=this.attributes;for(const o in i){const l=i[o],c=e(l,n);t.setAttribute(o,c)}const r=this.morphAttributes;for(const o in r){const l=[],c=r[o];for(let h=0,f=c.length;h<f;h++){const p=c[h],g=e(p,n);l.push(g)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const i={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let f=0,p=c.length;f<p;f++){const g=c[f];h.push(g.toJSON(e.data))}h.length>0&&(i[l]=h,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const i=e.attributes;for(const c in i){const h=i[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],f=r[c];for(let p=0,g=f.length;p<g;p++)h.push(f[p].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,h=a.length;c<h;c++){const f=a[c];this.addGroup(f.start,f.count,f.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const aO=new Pt,Ep=new a0,F_=new Sr,oO=new de,U_=new de,k_=new de,G_=new de,sI=new de,H_=new de,lO=new de,z_=new de;class bi extends Qn{constructor(e=new hn,t=new io){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=i.length;r<a;r++){const o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(r&&o){H_.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=o[l],f=r[l];h!==0&&(sI.fromBufferAttribute(f,e),a?H_.addScaledVector(sI,h):H_.addScaledVector(sI.sub(t),h))}t.add(H_)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),F_.copy(n.boundingSphere),F_.applyMatrix4(r),Ep.copy(e.ray).recast(e.near),!(F_.containsPoint(Ep.origin)===!1&&(Ep.intersectSphere(F_,oO)===null||Ep.origin.distanceToSquared(oO)>(e.far-e.near)**2))&&(aO.copy(r).invert(),Ep.copy(e.ray).applyMatrix4(aO),!(n.boundingBox!==null&&Ep.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Ep)))}_computeIntersections(e,t,n){let i;const r=this.geometry,a=this.material,o=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,f=r.attributes.normal,p=r.groups,g=r.drawRange;if(o!==null)if(Array.isArray(a))for(let y=0,x=p.length;y<x;y++){const E=p[y],_=a[E.materialIndex],b=Math.max(E.start,g.start),C=Math.min(o.count,Math.min(E.start+E.count,g.start+g.count));for(let I=b,M=C;I<M;I+=3){const R=o.getX(I),D=o.getX(I+1),P=o.getX(I+2);i=Q_(this,_,e,n,c,h,f,R,D,P),i&&(i.faceIndex=Math.floor(I/3),i.face.materialIndex=E.materialIndex,t.push(i))}}else{const y=Math.max(0,g.start),x=Math.min(o.count,g.start+g.count);for(let E=y,_=x;E<_;E+=3){const b=o.getX(E),C=o.getX(E+1),I=o.getX(E+2);i=Q_(this,a,e,n,c,h,f,b,C,I),i&&(i.faceIndex=Math.floor(E/3),t.push(i))}}else if(l!==void 0)if(Array.isArray(a))for(let y=0,x=p.length;y<x;y++){const E=p[y],_=a[E.materialIndex],b=Math.max(E.start,g.start),C=Math.min(l.count,Math.min(E.start+E.count,g.start+g.count));for(let I=b,M=C;I<M;I+=3){const R=I,D=I+1,P=I+2;i=Q_(this,_,e,n,c,h,f,R,D,P),i&&(i.faceIndex=Math.floor(I/3),i.face.materialIndex=E.materialIndex,t.push(i))}}else{const y=Math.max(0,g.start),x=Math.min(l.count,g.start+g.count);for(let E=y,_=x;E<_;E+=3){const b=E,C=E+1,I=E+2;i=Q_(this,a,e,n,c,h,f,b,C,I),i&&(i.faceIndex=Math.floor(E/3),t.push(i))}}}}function rY(s,e,t,n,i,r,a,o){let l;if(e.side===wa?l=n.intersectTriangle(a,r,i,!0,o):l=n.intersectTriangle(i,r,a,e.side===bu,o),l===null)return null;z_.copy(o),z_.applyMatrix4(s.matrixWorld);const c=t.ray.origin.distanceTo(z_);return c<t.near||c>t.far?null:{distance:c,point:z_.clone(),object:s}}function Q_(s,e,t,n,i,r,a,o,l,c){s.getVertexPosition(o,U_),s.getVertexPosition(l,k_),s.getVertexPosition(c,G_);const h=rY(s,e,t,n,U_,k_,G_,lO);if(h){const f=new de;to.getBarycoord(lO,U_,k_,G_,f),i&&(h.uv=to.getInterpolatedAttribute(i,o,l,c,f,new We)),r&&(h.uv1=to.getInterpolatedAttribute(r,o,l,c,f,new We)),a&&(h.normal=to.getInterpolatedAttribute(a,o,l,c,f,new de),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const p={a:o,b:l,c,normal:new de,materialIndex:0};to.getNormal(U_,k_,G_,p.normal),h.face=p,h.barycoord=f}return h}class ym extends hn{constructor(e=1,t=1,n=1,i=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};const o=this;i=Math.floor(i),r=Math.floor(r),a=Math.floor(a);const l=[],c=[],h=[],f=[];let p=0,g=0;y("z","y","x",-1,-1,n,t,e,a,r,0),y("z","y","x",1,-1,n,t,-e,a,r,1),y("x","z","y",1,1,e,n,t,i,a,2),y("x","z","y",1,-1,e,n,-t,i,a,3),y("x","y","z",1,-1,e,t,n,i,r,4),y("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(l),this.setAttribute("position",new Bt(c,3)),this.setAttribute("normal",new Bt(h,3)),this.setAttribute("uv",new Bt(f,2));function y(x,E,_,b,C,I,M,R,D,P,L){const O=I/D,U=M/P,j=I/2,H=M/2,z=R/2,q=D+1,k=P+1;let W=0,V=0;const X=new de;for(let K=0;K<k;K++){const te=K*U-H;for(let oe=0;oe<q;oe++){const Ee=oe*O-j;X[x]=Ee*b,X[E]=te*C,X[_]=z,c.push(X.x,X.y,X.z),X[x]=0,X[E]=0,X[_]=R>0?1:-1,h.push(X.x,X.y,X.z),f.push(oe/D),f.push(1-K/P),W+=1}}for(let K=0;K<P;K++)for(let te=0;te<D;te++){const oe=p+te+q*K,Ee=p+te+q*(K+1),Ce=p+(te+1)+q*(K+1),se=p+(te+1)+q*K;l.push(oe,Ee,se),l.push(Ee,Ce,se),V+=6}o.addGroup(g,V,L),g+=V,p+=W}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ym(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function jA(s){const e={};for(const t in s){e[t]={};for(const n in s[t]){const i=s[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function Ta(s){const e={};for(let t=0;t<s.length;t++){const n=jA(s[t]);for(const i in n)e[i]=n[i]}return e}function aY(s){const e=[];for(let t=0;t<s.length;t++)e.push(s[t].clone());return e}function Rk(s){const e=s.getRenderTarget();return e===null?s.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Jn.workingColorSpace}const UT={clone:jA,merge:Ta};var oY=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,lY=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;let Ra=class extends Ps{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=oY,this.fragmentShader=lY,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=jA(e.uniforms),this.uniformsGroups=aY(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?t.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[i]={type:"m4",value:a.toArray()}:t.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}};class kT extends Qn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Pt,this.projectionMatrix=new Pt,this.projectionMatrixInverse=new Pt,this.coordinateSystem=Po,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Ff=new de,cO=new We,uO=new We;class Ki extends kT{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=QA*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(im*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return QA*2*Math.atan(Math.tan(im*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Ff.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Ff.x,Ff.y).multiplyScalar(-e/Ff.z),Ff.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Ff.x,Ff.y).multiplyScalar(-e/Ff.z)}getViewSize(e,t){return this.getViewBounds(e,cO,uO),t.subVectors(uO,cO)}setViewOffset(e,t,n,i,r,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(im*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;r+=a.offsetX*i/l,t-=a.offsetY*n/c,i*=a.width/l,n*=a.height/c}const o=this.filmOffset;o!==0&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Ug=-90,kg=1;class Bk extends Qn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Ki(Ug,kg,e,t);i.layers=this.layers,this.add(i);const r=new Ki(Ug,kg,e,t);r.layers=this.layers,this.add(r);const a=new Ki(Ug,kg,e,t);a.layers=this.layers,this.add(a);const o=new Ki(Ug,kg,e,t);o.layers=this.layers,this.add(o);const l=new Ki(Ug,kg,e,t);l.layers=this.layers,this.add(l);const c=new Ki(Ug,kg,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,a,o,l]=t;for(const c of t)this.remove(c);if(e===Po)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===zA)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,a,o,l,c,h]=this.children,f=e.getRenderTarget(),p=e.getActiveCubeFace(),g=e.getActiveMipmapLevel(),y=e.xr.enabled;e.xr.enabled=!1;const x=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,a),e.setRenderTarget(n,2,i),e.render(t,o),e.setRenderTarget(n,3,i),e.render(t,l),e.setRenderTarget(n,4,i),e.render(t,c),n.texture.generateMipmaps=x,e.setRenderTarget(n,5,i),e.render(t,h),e.setRenderTarget(f,p,g),e.xr.enabled=y,n.texture.needsPMREMUpdate=!0}}class mE extends Hi{constructor(e=[],t=Tu,n,i,r,a,o,l,c,h){super(e,t,n,i,r,a,o,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Dk extends _l{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new mE(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new ym(5,5,5),r=new Ra({name:"CubemapFromEquirect",uniforms:jA(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:wa,blending:Eu});r.uniforms.tEquirect.value=t;const a=new bi(i,r),o=t.minFilter;return t.minFilter===Oo&&(t.minFilter=Si),new Bk(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,n=!0,i=!0){const r=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(r)}}class so extends Qn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const cY={type:"move"};class YS{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new so,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new so,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new de,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new de),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new so,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new de,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new de),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const x of e.hand.values()){const E=t.getJointPose(x,n),_=this._getHandJoint(c,x);E!==null&&(_.matrix.fromArray(E.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.matrixWorldNeedsUpdate=!0,_.jointRadius=E.radius),_.visible=E!==null}const h=c.joints["index-finger-tip"],f=c.joints["thumb-tip"],p=h.position.distanceTo(f.position),g=.02,y=.005;c.inputState.pinching&&p>g+y?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&p<=g-y&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&r!==null&&(i=r),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(cY)))}return o!==null&&(o.visible=i!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new so;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class GT{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Tt(e),this.density=t}clone(){return new GT(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class HT{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Tt(e),this.near=t,this.far=n}clone(){return new HT(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class zT extends Qn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Os,this.environmentIntensity=1,this.environmentRotation=new Os,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class gE{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=zv,this.updateRanges=[],this.version=0,this.uuid=Uo()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Uo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Uo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Sa=new de;class hd{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Sa.fromBufferAttribute(this,t),Sa.applyMatrix4(e),this.setXYZ(t,Sa.x,Sa.y,Sa.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Sa.fromBufferAttribute(this,t),Sa.applyNormalMatrix(e),this.setXYZ(t,Sa.x,Sa.y,Sa.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Sa.fromBufferAttribute(this,t),Sa.transformDirection(e),this.setXYZ(t,Sa.x,Sa.y,Sa.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Ca(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=wn(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=wn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=wn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=wn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=wn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Ca(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Ca(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Ca(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Ca(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=wn(t,this.array),n=wn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=wn(t,this.array),n=wn(n,this.array),i=wn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=wn(t,this.array),n=wn(n,this.array),i=wn(i,this.array),r=wn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new ei(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new hd(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class yB extends Ps{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Tt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Gg;const Py=new de,Hg=new de,zg=new de,Qg=new We,Ny=new We,Lk=new Pt,V_=new de,Fy=new de,j_=new de,hO=new We,rI=new We,fO=new We;class Ok extends Qn{constructor(e=new yB){if(super(),this.isSprite=!0,this.type="Sprite",Gg===void 0){Gg=new hn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new gE(t,5);Gg.setIndex([0,1,2,0,2,3]),Gg.setAttribute("position",new hd(n,3,0,!1)),Gg.setAttribute("uv",new hd(n,2,3,!1))}this.geometry=Gg,this.material=e,this.center=new We(.5,.5),this.count=1}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Hg.setFromMatrixScale(this.matrixWorld),Lk.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),zg.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Hg.multiplyScalar(-zg.z);const n=this.material.rotation;let i,r;n!==0&&(r=Math.cos(n),i=Math.sin(n));const a=this.center;q_(V_.set(-.5,-.5,0),zg,a,Hg,i,r),q_(Fy.set(.5,-.5,0),zg,a,Hg,i,r),q_(j_.set(.5,.5,0),zg,a,Hg,i,r),hO.set(0,0),rI.set(1,0),fO.set(1,1);let o=e.ray.intersectTriangle(V_,Fy,j_,!1,Py);if(o===null&&(q_(Fy.set(-.5,.5,0),zg,a,Hg,i,r),rI.set(0,1),o=e.ray.intersectTriangle(V_,j_,Fy,!1,Py),o===null))return;const l=e.ray.origin.distanceTo(Py);l<e.near||l>e.far||t.push({distance:l,point:Py.clone(),uv:to.getInterpolation(Py,V_,Fy,j_,hO,rI,fO,new We),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function q_(s,e,t,n,i,r){Qg.subVectors(s,t).addScalar(.5).multiply(n),i!==void 0?(Ny.x=r*Qg.x-i*Qg.y,Ny.y=i*Qg.x+r*Qg.y):Ny.copy(Qg),s.copy(e),s.x+=Ny.x,s.y+=Ny.y,s.applyMatrix4(Lk)}const K_=new de,dO=new de;class Pk extends Qn{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const r=t[n];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const i=this.levels;let r;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const i=t.splice(n,1);return this.remove(i[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){K_.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(K_);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){K_.setFromMatrixPosition(e.matrixWorld),dO.setFromMatrixPosition(this.matrixWorld);const n=K_.distanceTo(dO)/e.zoom;t[0].object.visible=!0;let i,r;for(i=1,r=t.length;i<r;i++){let a=t[i].distance;if(t[i].object.visible&&(a-=a*t[i].hysteresis),n>=a)t[i-1].object.visible=!1,t[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const a=n[i];t.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return t}}const pO=new de,mO=new Tn,gO=new Tn,uY=new de,AO=new Pt,Y_=new de,aI=new Sr,yO=new Pt,oI=new a0;class AE extends bi{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Tw,this.bindMatrix=new Pt,this.bindMatrixInverse=new Pt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new kr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Y_),this.boundingBox.expandByPoint(Y_)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sr),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Y_),this.boundingSphere.expandByPoint(Y_)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),aI.copy(this.boundingSphere),aI.applyMatrix4(i),e.ray.intersectsSphere(aI)!==!1&&(yO.copy(i).invert(),oI.copy(e.ray).applyMatrix4(yO),!(this.boundingBox!==null&&oI.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,oI)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Tn,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Tw?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===hk?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;mO.fromBufferAttribute(i.attributes.skinIndex,e),gO.fromBufferAttribute(i.attributes.skinWeight,e),pO.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const a=gO.getComponent(r);if(a!==0){const o=mO.getComponent(r);AO.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(uY.copy(pO).applyMatrix4(AO),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class qA extends Qn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class fc extends Hi{constructor(e=null,t=1,n=1,i,r,a,o,l,c=Ws,h=Ws,f,p){super(null,a,o,l,c,h,i,r,f,p),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const vO=new Pt,hY=new Pt;class o0{constructor(e=[],t=[]){this.uuid=Uo(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new Pt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Pt;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,a=e.length;r<a;r++){const o=e[r]?e[r].matrixWorld:hY;vO.multiplyMatrices(o,t[r]),vO.toArray(n,r*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new o0(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new fc(t,e,e,rs,ss);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const r=e.bones[n];let a=t[r];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),a=new qA),this.bones.push(a),this.boneInverses.push(new Pt().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const a=t[i];e.bones.push(a.uuid);const o=n[i];e.boneInverses.push(o.toArray())}return e}}class fm extends ei{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Vg=new Pt,EO=new Pt,X_=[],xO=new kr,fY=new Pt,Uy=new bi,ky=new Sr;class vB extends bi{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new fm(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,fY)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new kr),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Vg),xO.copy(e.boundingBox).applyMatrix4(Vg),this.boundingBox.union(xO)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sr),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Vg),ky.copy(e.boundingSphere).applyMatrix4(Vg),this.boundingSphere.union(ky)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,r=n.length+1,a=e*r+1;for(let o=0;o<n.length;o++)n[o]=i[a+o]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Uy.geometry=this.geometry,Uy.material=this.material,Uy.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ky.copy(this.boundingSphere),ky.applyMatrix4(n),e.ray.intersectsSphere(ky)!==!1))for(let r=0;r<i;r++){this.getMatrixAt(r,Vg),EO.multiplyMatrices(n,Vg),Uy.matrixWorld=EO,Uy.raycast(e,X_);for(let a=0,o=X_.length;a<o;a++){const l=X_[a];l.instanceId=r,l.object=this,t.push(l)}X_.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new fm(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;this.morphTexture===null&&(this.morphTexture=new fc(new Float32Array(i*this.count),i,this.count,gu,ss));const r=this.morphTexture.source.data.data;let a=0;for(let c=0;c<n.length;c++)a+=n[c];const o=this.geometry.morphTargetsRelative?1:1-a,l=i*e;r[l]=o,r.set(n,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const lI=new de,dY=new de,pY=new un;class xh{constructor(e=new de(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=lI.subVectors(n,t).cross(dY.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(lI),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||pY.getNormalMatrix(e),i=this.coplanarPoint(lI).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const xp=new Sr,mY=new We(.5,.5),W_=new de;class l0{constructor(e=new xh,t=new xh,n=new xh,i=new xh,r=new xh,a=new xh){this.planes=[e,t,n,i,r,a]}set(e,t,n,i,r,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Po,n=!1){const i=this.planes,r=e.elements,a=r[0],o=r[1],l=r[2],c=r[3],h=r[4],f=r[5],p=r[6],g=r[7],y=r[8],x=r[9],E=r[10],_=r[11],b=r[12],C=r[13],I=r[14],M=r[15];if(i[0].setComponents(c-a,g-h,_-y,M-b).normalize(),i[1].setComponents(c+a,g+h,_+y,M+b).normalize(),i[2].setComponents(c+o,g+f,_+x,M+C).normalize(),i[3].setComponents(c-o,g-f,_-x,M-C).normalize(),n)i[4].setComponents(l,p,E,I).normalize(),i[5].setComponents(c-l,g-p,_-E,M-I).normalize();else if(i[4].setComponents(c-l,g-p,_-E,M-I).normalize(),t===Po)i[5].setComponents(c+l,g+p,_+E,M+I).normalize();else if(t===zA)i[5].setComponents(l,p,E,I).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),xp.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),xp.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(xp)}intersectsSprite(e){xp.center.set(0,0,0);const t=mY.distanceTo(e.center);return xp.radius=.7071067811865476+t,xp.applyMatrix4(e.matrixWorld),this.intersectsSphere(xp)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(W_.x=i.normal.x>0?e.max.x:e.min.x,W_.y=i.normal.y>0?e.max.y:e.min.y,W_.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(W_)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const $c=new Pt,Jc=new l0;class QT{constructor(){this.coordinateSystem=Po}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if($c.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Jc.setFromProjectionMatrix($c,i.coordinateSystem,i.reversedDepth),Jc.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if($c.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Jc.setFromProjectionMatrix($c,i.coordinateSystem,i.reversedDepth),Jc.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if($c.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Jc.setFromProjectionMatrix($c,i.coordinateSystem,i.reversedDepth),Jc.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if($c.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Jc.setFromProjectionMatrix($c,i.coordinateSystem,i.reversedDepth),Jc.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if($c.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Jc.setFromProjectionMatrix($c,i.coordinateSystem,i.reversedDepth),Jc.containsPoint(e))return!0}return!1}clone(){return new QT}}function cI(s,e){return s-e}function gY(s,e){return s.z-e.z}function AY(s,e){return e.z-s.z}class yY{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,i){const r=this.pool,a=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const o=r[this.index];a.push(o),this.index++,o.start=e,o.count=t,o.z=n,o.index=i}reset(){this.list.length=0,this.index=0}}const ja=new Pt,vY=new Tt(1,1,1),_O=new l0,EY=new QT,$_=new kr,_p=new Sr,Gy=new de,SO=new de,xY=new de,uI=new yY,Zr=new bi,J_=[];function _Y(s,e,t=0){const n=e.itemSize;if(s.isInterleavedBufferAttribute||s.array.constructor!==e.array.constructor){const i=s.count;for(let r=0;r<i;r++)for(let a=0;a<n;a++)e.setComponent(r+t,a,s.getComponent(r,a))}else e.array.set(s.array,t*n);e.needsUpdate=!0}function Sp(s,e){if(s.constructor!==e.constructor){const t=Math.min(s.length,e.length);for(let n=0;n<t;n++)e[n]=s[n]}else{const t=Math.min(s.length,e.length);e.set(new s.constructor(s.buffer,0,t))}}class Nk extends bi{constructor(e,t,n=t*2,i){super(new hn,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new fc(t,e,e,rs,ss);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new fc(t,e,e,pE,Rh);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new fc(t,e,e,rs,ss);n.colorSpace=Jn.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const r in e.attributes){const a=e.getAttribute(r),{array:o,itemSize:l,normalized:c}=a,h=new o.constructor(n*l),f=new ei(h,l,c);t.setAttribute(r,f)}if(e.getIndex()!==null){const r=n>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new ei(r,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=e.getAttribute(n),r=t.getAttribute(n);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new kr);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,ja),this.getBoundingBoxAt(r,$_).applyMatrix4(ja),e.union($_)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sr);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,ja),this.getBoundingSphereAt(r,_p).applyMatrix4(ja),e.union(_p)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:e};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(cI),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=n):(i=this._instanceInfo.length,this._instanceInfo.push(n));const r=this._matricesTexture;ja.identity().toArray(r.image.data,i*16),r.needsUpdate=!0;const a=this._colorsTexture;return a&&(vY.toArray(a.image.data,i*4),a.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},r=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const a=e.getIndex();if(a!==null&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=n===-1?a.count:n),i.indexStart!==-1&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(cI),l=this._availableGeometryIds.shift(),r[l]=i):(l=this._geometryCount,this._geometryCount++,r.push(i)),this.setGeometryAt(l,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,l}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,i=n.getIndex()!==null,r=n.getIndex(),a=t.getIndex(),o=this._geometryInfo[e];if(i&&a.count>o.reservedIndexCount||t.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.reservedVertexCount;o.vertexCount=t.getAttribute("position").count;for(const h in n.attributes){const f=t.getAttribute(h),p=n.getAttribute(h);_Y(f,p,l);const g=f.itemSize;for(let y=f.count,x=c;y<x;y++){const E=l+y;for(let _=0;_<g;_++)p.setComponent(E,_,0)}p.needsUpdate=!0,p.addUpdateRange(l*g,c*g)}if(i){const h=o.indexStart,f=o.reservedIndexCount;o.indexCount=t.getIndex().count;for(let p=0;p<a.count;p++)r.setX(h+p,l+a.getX(p));for(let p=a.count,g=f;p<g;p++)r.setX(h+p,l);r.needsUpdate=!0,r.addUpdateRange(h,o.reservedIndexCount)}return o.start=i?o.indexStart:o.vertexStart,o.count=i?o.indexCount:o.vertexCount,o.boundingBox=null,t.boundingBox!==null&&(o.boundingBox=t.boundingBox.clone()),o.boundingSphere=null,t.boundingSphere!==null&&(o.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const n=this._instanceInfo;for(let i=0,r=n.length;i<r;i++)n[i].active&&n[i].geometryIndex===e&&this.deleteInstance(i);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,i=n.map((a,o)=>o).sort((a,o)=>n[a].vertexStart-n[o].vertexStart),r=this.geometry;for(let a=0,o=n.length;a<o;a++){const l=i[a],c=n[l];if(c.active!==!1){if(r.index!==null){if(c.indexStart!==t){const{indexStart:h,vertexStart:f,reservedIndexCount:p}=c,g=r.index,y=g.array,x=e-f;for(let E=h;E<h+p;E++)y[E]=y[E]+x;g.array.copyWithin(t,h,h+p),g.addUpdateRange(t,p),c.indexStart=t}t+=c.reservedIndexCount}if(c.vertexStart!==e){const{vertexStart:h,reservedVertexCount:f}=c,p=r.attributes;for(const g in p){const y=p[g],{array:x,itemSize:E}=y;x.copyWithin(e*E,h*E,(h+f)*E),y.addUpdateRange(e*E,f*E)}c.vertexStart=e}e+=c.reservedVertexCount,c.start=r.index?c.indexStart:c.vertexStart,this._nextIndexStart=r.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingBox===null){const r=new kr,a=n.index,o=n.attributes.position;for(let l=i.start,c=i.start+i.count;l<c;l++){let h=l;a&&(h=a.getX(h)),r.expandByPoint(Gy.fromBufferAttribute(o,h))}i.boundingBox=r}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingSphere===null){const r=new Sr;this.getBoundingBoxAt(e,$_),$_.getCenter(r.center);const a=n.index,o=n.attributes.position;let l=0;for(let c=i.start,h=i.start+i.count;c<h;c++){let f=c;a&&(f=a.getX(f)),Gy.fromBufferAttribute(o,f),l=Math.max(l,r.center.distanceToSquared(Gy))}r.radius=Math.sqrt(l),i.boundingSphere=r}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,e*16),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(cI);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),r=new Int32Array(e);Sp(this._multiDrawCounts,i),Sp(this._multiDrawStarts,r),this._multiDrawCounts=i,this._multiDrawStarts=r,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,l=this._colorsTexture;a.dispose(),this._initIndirectTexture(),Sp(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Sp(o.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),Sp(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...n.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(l=>l.indexStart+l.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const r=this.geometry;r.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new hn,this._initializeGeometry(r));const a=this.geometry;r.index&&Sp(r.index.array,a.index.array);for(const o in r.attributes)Sp(r.attributes[o].array,a.attributes[o].array)}raycast(e,t){const n=this._instanceInfo,i=this._geometryInfo,r=this.matrixWorld,a=this.geometry;Zr.material=this.material,Zr.geometry.index=a.index,Zr.geometry.attributes=a.attributes,Zr.geometry.boundingBox===null&&(Zr.geometry.boundingBox=new kr),Zr.geometry.boundingSphere===null&&(Zr.geometry.boundingSphere=new Sr);for(let o=0,l=n.length;o<l;o++){if(!n[o].visible||!n[o].active)continue;const c=n[o].geometryIndex,h=i[c];Zr.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(o,Zr.matrixWorld).premultiply(r),this.getBoundingBoxAt(c,Zr.geometry.boundingBox),this.getBoundingSphereAt(c,Zr.geometry.boundingSphere),Zr.raycast(e,J_);for(let f=0,p=J_.length;f<p;f++){const g=J_[f];g.object=this,g.batchId=o,t.push(g)}J_.length=0}Zr.material=null,Zr.geometry.index=null,Zr.geometry.attributes={},Zr.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=i.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._instanceInfo,c=this._multiDrawStarts,h=this._multiDrawCounts,f=this._geometryInfo,p=this.perObjectFrustumCulled,g=this._indirectTexture,y=g.image.data,x=n.isArrayCamera?EY:_O;p&&!n.isArrayCamera&&(ja.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),_O.setFromProjectionMatrix(ja,n.coordinateSystem,n.reversedDepth));let E=0;if(this.sortObjects){ja.copy(this.matrixWorld).invert(),Gy.setFromMatrixPosition(n.matrixWorld).applyMatrix4(ja),SO.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(ja);for(let C=0,I=l.length;C<I;C++)if(l[C].visible&&l[C].active){const M=l[C].geometryIndex;this.getMatrixAt(C,ja),this.getBoundingSphereAt(M,_p).applyMatrix4(ja);let R=!1;if(p&&(R=!x.intersectsSphere(_p,n)),!R){const D=f[M],P=xY.subVectors(_p.center,Gy).dot(SO);uI.push(D.start,D.count,P,C)}}const _=uI.list,b=this.customSort;b===null?_.sort(r.transparent?AY:gY):b.call(this,_,n);for(let C=0,I=_.length;C<I;C++){const M=_[C];c[E]=M.start*o,h[E]=M.count,y[E]=M.index,E++}uI.reset()}else for(let _=0,b=l.length;_<b;_++)if(l[_].visible&&l[_].active){const C=l[_].geometryIndex;let I=!1;if(p&&(this.getMatrixAt(_,ja),this.getBoundingSphereAt(C,_p).applyMatrix4(ja),I=!x.intersectsSphere(_p,n)),!I){const M=f[C];c[E]=M.start*o,h[E]=M.count,y[E]=_,E++}}g.needsUpdate=!0,this._multiDrawCount=E,this._visibilityChanged=!1}onBeforeShadow(e,t,n,i,r,a){this.onBeforeRender(e,null,i,r,a)}}class $s extends Ps{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Tt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Wb=new de,$b=new de,bO=new Pt,Hy=new a0,Z_=new Sr,hI=new de,TO=new de;class Iu extends Qn{constructor(e=new hn,t=new $s){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,r=t.count;i<r;i++)Wb.fromBufferAttribute(t,i-1),$b.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=Wb.distanceTo($b);e.setAttribute("lineDistance",new Bt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Z_.copy(n.boundingSphere),Z_.applyMatrix4(i),Z_.radius+=r,e.ray.intersectsSphere(Z_)===!1)return;bO.copy(i).invert(),Hy.copy(e.ray).applyMatrix4(bO);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,h=n.index,p=n.attributes.position;if(h!==null){const g=Math.max(0,a.start),y=Math.min(h.count,a.start+a.count);for(let x=g,E=y-1;x<E;x+=c){const _=h.getX(x),b=h.getX(x+1),C=eS(this,e,Hy,l,_,b,x);C&&t.push(C)}if(this.isLineLoop){const x=h.getX(y-1),E=h.getX(g),_=eS(this,e,Hy,l,x,E,y-1);_&&t.push(_)}}else{const g=Math.max(0,a.start),y=Math.min(p.count,a.start+a.count);for(let x=g,E=y-1;x<E;x+=c){const _=eS(this,e,Hy,l,x,x+1,x);_&&t.push(_)}if(this.isLineLoop){const x=eS(this,e,Hy,l,y-1,g,y-1);x&&t.push(x)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=i.length;r<a;r++){const o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}}function eS(s,e,t,n,i,r,a){const o=s.geometry.attributes.position;if(Wb.fromBufferAttribute(o,i),$b.fromBufferAttribute(o,r),t.distanceSqToSegment(Wb,$b,hI,TO)>n)return;hI.applyMatrix4(s.matrixWorld);const c=e.ray.origin.distanceTo(hI);if(!(c<e.near||c>e.far))return{distance:c,point:TO.clone().applyMatrix4(s.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:s}}const CO=new de,IO=new de;class Go extends Iu{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,r=t.count;i<r;i+=2)CO.fromBufferAttribute(t,i),IO.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+CO.distanceTo(IO);e.setAttribute("lineDistance",new Bt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class EB extends Iu{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class $f extends Ps{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Tt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const MO=new Pt,Mw=new a0,tS=new Sr,nS=new de;class _A extends Qn{constructor(e=new hn,t=new $f){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),tS.copy(n.boundingSphere),tS.applyMatrix4(i),tS.radius+=r,e.ray.intersectsSphere(tS)===!1)return;MO.copy(i).invert(),Mw.copy(e.ray).applyMatrix4(MO);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=n.index,f=n.attributes.position;if(c!==null){const p=Math.max(0,a.start),g=Math.min(c.count,a.start+a.count);for(let y=p,x=g;y<x;y++){const E=c.getX(y);nS.fromBufferAttribute(f,E),wO(nS,E,l,i,e,t,this)}}else{const p=Math.max(0,a.start),g=Math.min(f.count,a.start+a.count);for(let y=p,x=g;y<x;y++)nS.fromBufferAttribute(f,y),wO(nS,y,l,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=i.length;r<a;r++){const o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}}function wO(s,e,t,n,i,r,a){const o=Mw.distanceSqToPoint(s);if(o<t){const l=new de;Mw.closestPointToPoint(s,l),l.applyMatrix4(n);const c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;r.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class xB extends Hi{constructor(e,t,n,i,r=Si,a=Si,o,l,c){super(e,t,n,i,r,a,o,l,c),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const h=this;function f(){h.needsUpdate=!0,h._requestVideoFrameCallbackId=e.requestVideoFrameCallback(f)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(f))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),super.dispose()}}class SY extends xB{constructor(e,t,n,i,r,a,o,l){super({},e,t,n,i,r,a,o,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class bY extends Hi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Ws,this.minFilter=Ws,this.generateMipmaps=!1,this.needsUpdate=!0}}class vd extends Hi{constructor(e,t,n,i,r,a,o,l,c,h,f,p){super(null,a,o,l,c,h,i,r,f,p),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}let TY=class extends vd{constructor(e,t,n,i,r,a){super(e,t,n,r,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=Ur,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}},CY=class extends vd{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,Tu),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}};class IY extends Hi{constructor(e,t,n,i,r,a,o,l,c){super(e,t,n,i,r,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class _B extends Hi{constructor(e,t,n=Rh,i,r,a,o=Ws,l=Ws,c,h=FA,f=1){if(h!==FA&&h!==UA)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const p={width:e,height:t,depth:f};super(p,i,r,a,o,l,h,n,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Wf(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class VT extends hn{constructor(e=1,t=1,n=4,i=8,r=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i,heightSegments:r},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),i=Math.max(3,Math.floor(i)),r=Math.max(1,Math.floor(r));const a=[],o=[],l=[],c=[],h=t/2,f=Math.PI/2*e,p=t,g=2*f+p,y=n*2+r,x=i+1,E=new de,_=new de;for(let b=0;b<=y;b++){let C=0,I=0,M=0,R=0;if(b<=n){const L=b/n,O=L*Math.PI/2;I=-h-e*Math.cos(O),M=e*Math.sin(O),R=-e*Math.cos(O),C=L*f}else if(b<=n+r){const L=(b-n)/r;I=-h+L*t,M=e,R=0,C=f+L*p}else{const L=(b-n-r)/n,O=L*Math.PI/2;I=h+e*Math.sin(O),M=e*Math.cos(O),R=e*Math.sin(O),C=f+p+L*f}const D=Math.max(0,Math.min(1,C/g));let P=0;b===0?P=.5/i:b===y&&(P=-.5/i);for(let L=0;L<=i;L++){const O=L/i,U=O*Math.PI*2,j=Math.sin(U),H=Math.cos(U);_.x=-M*H,_.y=I,_.z=M*j,o.push(_.x,_.y,_.z),E.set(-M*H,R,M*j),E.normalize(),l.push(E.x,E.y,E.z),c.push(O+P,D)}if(b>0){const L=(b-1)*x;for(let O=0;O<i;O++){const U=L+O,j=L+O+1,H=b*x+O,z=b*x+O+1;a.push(U,j,H),a.push(j,z,H)}}}this.setIndex(a),this.setAttribute("position",new Bt(o,3)),this.setAttribute("normal",new Bt(l,3)),this.setAttribute("uv",new Bt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new VT(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class jT extends hn{constructor(e=1,t=32,n=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],a=[],o=[],l=[],c=new de,h=new We;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let f=0,p=3;f<=t;f++,p+=3){const g=n+f/t*i;c.x=e*Math.cos(g),c.y=e*Math.sin(g),a.push(c.x,c.y,c.z),o.push(0,0,1),h.x=(a[p]/e+1)/2,h.y=(a[p+1]/e+1)/2,l.push(h.x,h.y)}for(let f=1;f<=t;f++)r.push(f,f+1,0);this.setIndex(r),this.setAttribute("position",new Bt(a,3)),this.setAttribute("normal",new Bt(o,3)),this.setAttribute("uv",new Bt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jT(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class yE extends hn{constructor(e=1,t=1,n=1,i=32,r=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:l};const c=this;i=Math.floor(i),r=Math.floor(r);const h=[],f=[],p=[],g=[];let y=0;const x=[],E=n/2;let _=0;b(),a===!1&&(e>0&&C(!0),t>0&&C(!1)),this.setIndex(h),this.setAttribute("position",new Bt(f,3)),this.setAttribute("normal",new Bt(p,3)),this.setAttribute("uv",new Bt(g,2));function b(){const I=new de,M=new de;let R=0;const D=(t-e)/n;for(let P=0;P<=r;P++){const L=[],O=P/r,U=O*(t-e)+e;for(let j=0;j<=i;j++){const H=j/i,z=H*l+o,q=Math.sin(z),k=Math.cos(z);M.x=U*q,M.y=-O*n+E,M.z=U*k,f.push(M.x,M.y,M.z),I.set(q,D,k).normalize(),p.push(I.x,I.y,I.z),g.push(H,1-O),L.push(y++)}x.push(L)}for(let P=0;P<i;P++)for(let L=0;L<r;L++){const O=x[L][P],U=x[L+1][P],j=x[L+1][P+1],H=x[L][P+1];(e>0||L!==0)&&(h.push(O,U,H),R+=3),(t>0||L!==r-1)&&(h.push(U,j,H),R+=3)}c.addGroup(_,R,0),_+=R}function C(I){const M=y,R=new We,D=new de;let P=0;const L=I===!0?e:t,O=I===!0?1:-1;for(let j=1;j<=i;j++)f.push(0,E*O,0),p.push(0,O,0),g.push(.5,.5),y++;const U=y;for(let j=0;j<=i;j++){const z=j/i*l+o,q=Math.cos(z),k=Math.sin(z);D.x=L*k,D.y=E*O,D.z=L*q,f.push(D.x,D.y,D.z),p.push(0,O,0),R.x=q*.5+.5,R.y=k*.5*O+.5,g.push(R.x,R.y),y++}for(let j=0;j<i;j++){const H=M+j,z=U+j;I===!0?h.push(z,z+1,H):h.push(z+1,z,H),P+=3}c.addGroup(_,P,I===!0?1:2),_+=P}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yE(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class vE extends yE{constructor(e=1,t=1,n=32,i=1,r=!1,a=0,o=Math.PI*2){super(0,e,t,n,i,r,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:a,thetaLength:o}}static fromJSON(e){return new vE(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ed extends hn{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],a=[];o(i),c(n),h(),this.setAttribute("position",new Bt(r,3)),this.setAttribute("normal",new Bt(r.slice(),3)),this.setAttribute("uv",new Bt(a,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function o(b){const C=new de,I=new de,M=new de;for(let R=0;R<t.length;R+=3)g(t[R+0],C),g(t[R+1],I),g(t[R+2],M),l(C,I,M,b)}function l(b,C,I,M){const R=M+1,D=[];for(let P=0;P<=R;P++){D[P]=[];const L=b.clone().lerp(I,P/R),O=C.clone().lerp(I,P/R),U=R-P;for(let j=0;j<=U;j++)j===0&&P===R?D[P][j]=L:D[P][j]=L.clone().lerp(O,j/U)}for(let P=0;P<R;P++)for(let L=0;L<2*(R-P)-1;L++){const O=Math.floor(L/2);L%2===0?(p(D[P][O+1]),p(D[P+1][O]),p(D[P][O])):(p(D[P][O+1]),p(D[P+1][O+1]),p(D[P+1][O]))}}function c(b){const C=new de;for(let I=0;I<r.length;I+=3)C.x=r[I+0],C.y=r[I+1],C.z=r[I+2],C.normalize().multiplyScalar(b),r[I+0]=C.x,r[I+1]=C.y,r[I+2]=C.z}function h(){const b=new de;for(let C=0;C<r.length;C+=3){b.x=r[C+0],b.y=r[C+1],b.z=r[C+2];const I=E(b)/2/Math.PI+.5,M=_(b)/Math.PI+.5;a.push(I,1-M)}y(),f()}function f(){for(let b=0;b<a.length;b+=6){const C=a[b+0],I=a[b+2],M=a[b+4],R=Math.max(C,I,M),D=Math.min(C,I,M);R>.9&&D<.1&&(C<.2&&(a[b+0]+=1),I<.2&&(a[b+2]+=1),M<.2&&(a[b+4]+=1))}}function p(b){r.push(b.x,b.y,b.z)}function g(b,C){const I=b*3;C.x=e[I+0],C.y=e[I+1],C.z=e[I+2]}function y(){const b=new de,C=new de,I=new de,M=new de,R=new We,D=new We,P=new We;for(let L=0,O=0;L<r.length;L+=9,O+=6){b.set(r[L+0],r[L+1],r[L+2]),C.set(r[L+3],r[L+4],r[L+5]),I.set(r[L+6],r[L+7],r[L+8]),R.set(a[O+0],a[O+1]),D.set(a[O+2],a[O+3]),P.set(a[O+4],a[O+5]),M.copy(b).add(C).add(I).divideScalar(3);const U=E(M);x(R,O+0,b,U),x(D,O+2,C,U),x(P,O+4,I,U)}}function x(b,C,I,M){M<0&&b.x===1&&(a[C]=b.x-1),I.x===0&&I.z===0&&(a[C]=M/2/Math.PI+.5)}function E(b){return Math.atan2(b.z,-b.x)}function _(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ed(e.vertices,e.indices,e.radius,e.details)}}class qT extends Ed{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new qT(e.radius,e.detail)}}const iS=new de,sS=new de,fI=new de,rS=new to;class Fk extends hn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),r=Math.cos(im*t),a=e.getIndex(),o=e.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],h=["a","b","c"],f=new Array(3),p={},g=[];for(let y=0;y<l;y+=3){a?(c[0]=a.getX(y),c[1]=a.getX(y+1),c[2]=a.getX(y+2)):(c[0]=y,c[1]=y+1,c[2]=y+2);const{a:x,b:E,c:_}=rS;if(x.fromBufferAttribute(o,c[0]),E.fromBufferAttribute(o,c[1]),_.fromBufferAttribute(o,c[2]),rS.getNormal(fI),f[0]=`${Math.round(x.x*i)},${Math.round(x.y*i)},${Math.round(x.z*i)}`,f[1]=`${Math.round(E.x*i)},${Math.round(E.y*i)},${Math.round(E.z*i)}`,f[2]=`${Math.round(_.x*i)},${Math.round(_.y*i)},${Math.round(_.z*i)}`,!(f[0]===f[1]||f[1]===f[2]||f[2]===f[0]))for(let b=0;b<3;b++){const C=(b+1)%3,I=f[b],M=f[C],R=rS[h[b]],D=rS[h[C]],P=`${I}_${M}`,L=`${M}_${I}`;L in p&&p[L]?(fI.dot(p[L].normal)<=r&&(g.push(R.x,R.y,R.z),g.push(D.x,D.y,D.z)),p[L]=null):P in p||(p[P]={index0:c[b],index1:c[C],normal:fI.clone()})}}for(const y in p)if(p[y]){const{index0:x,index1:E}=p[y];iS.fromBufferAttribute(o,x),sS.fromBufferAttribute(o,E),g.push(iS.x,iS.y,iS.z),g.push(sS.x,sS.y,sS.z)}this.setAttribute("position",new Bt(g,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class bl{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let i=0;const r=n.length;let a;t?a=t:a=e*n[r-1];let o=0,l=r-1,c;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),c=n[i]-a,c<0)o=i+1;else if(c>0)l=i-1;else{l=i;break}if(i=l,n[i]===a)return i/(r-1);const h=n[i],p=n[i+1]-h,g=(a-h)/p;return(i+g)/(r-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);const a=this.getPoint(i),o=this.getPoint(r),l=t||(a.isVector2?new We:new de);return l.copy(o).sub(a).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new de,i=[],r=[],a=[],o=new de,l=new Pt;for(let g=0;g<=e;g++){const y=g/e;i[g]=this.getTangentAt(y,new de)}r[0]=new de,a[0]=new de;let c=Number.MAX_VALUE;const h=Math.abs(i[0].x),f=Math.abs(i[0].y),p=Math.abs(i[0].z);h<=c&&(c=h,n.set(1,0,0)),f<=c&&(c=f,n.set(0,1,0)),p<=c&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(let g=1;g<=e;g++){if(r[g]=r[g-1].clone(),a[g]=a[g-1].clone(),o.crossVectors(i[g-1],i[g]),o.length()>Number.EPSILON){o.normalize();const y=Math.acos(pn(i[g-1].dot(i[g]),-1,1));r[g].applyMatrix4(l.makeRotationAxis(o,y))}a[g].crossVectors(i[g],r[g])}if(t===!0){let g=Math.acos(pn(r[0].dot(r[e]),-1,1));g/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(g=-g);for(let y=1;y<=e;y++)r[y].applyMatrix4(l.makeRotationAxis(i[y],g*y)),a[y].crossVectors(i[y],r[y])}return{tangents:i,normals:r,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class KT extends bl{constructor(e=0,t=0,n=1,i=1,r=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,t=new We){const n=t,i=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(a?r=0:r=i),this.aClockwise===!0&&!a&&(r===i?r=-i:r=r-i);const o=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const h=Math.cos(this.aRotation),f=Math.sin(this.aRotation),p=l-this.aX,g=c-this.aY;l=p*h-g*f+this.aX,c=p*f+g*h+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Uk extends KT{constructor(e,t,n,i,r,a){super(e,t,n,n,i,r,a),this.isArcCurve=!0,this.type="ArcCurve"}}function SB(){let s=0,e=0,t=0,n=0;function i(r,a,o,l){s=r,e=o,t=-3*r+3*a-2*o-l,n=2*r-2*a+o+l}return{initCatmullRom:function(r,a,o,l,c){i(a,o,c*(o-r),c*(l-a))},initNonuniformCatmullRom:function(r,a,o,l,c,h,f){let p=(a-r)/c-(o-r)/(c+h)+(o-a)/h,g=(o-a)/h-(l-a)/(h+f)+(l-o)/f;p*=h,g*=h,i(a,o,p,g)},calc:function(r){const a=r*r,o=a*r;return s+e*r+t*a+n*o}}}const aS=new de,dI=new SB,pI=new SB,mI=new SB;class bB extends bl{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new de){const n=t,i=this.points,r=i.length,a=(r-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/r)+1)*r:l===0&&o===r-1&&(o=r-2,l=1);let c,h;this.closed||o>0?c=i[(o-1)%r]:(aS.subVectors(i[0],i[1]).add(i[0]),c=aS);const f=i[o%r],p=i[(o+1)%r];if(this.closed||o+2<r?h=i[(o+2)%r]:(aS.subVectors(i[r-1],i[r-2]).add(i[r-1]),h=aS),this.curveType==="centripetal"||this.curveType==="chordal"){const g=this.curveType==="chordal"?.5:.25;let y=Math.pow(c.distanceToSquared(f),g),x=Math.pow(f.distanceToSquared(p),g),E=Math.pow(p.distanceToSquared(h),g);x<1e-4&&(x=1),y<1e-4&&(y=x),E<1e-4&&(E=x),dI.initNonuniformCatmullRom(c.x,f.x,p.x,h.x,y,x,E),pI.initNonuniformCatmullRom(c.y,f.y,p.y,h.y,y,x,E),mI.initNonuniformCatmullRom(c.z,f.z,p.z,h.z,y,x,E)}else this.curveType==="catmullrom"&&(dI.initCatmullRom(c.x,f.x,p.x,h.x,this.tension),pI.initCatmullRom(c.y,f.y,p.y,h.y,this.tension),mI.initCatmullRom(c.z,f.z,p.z,h.z,this.tension));return n.set(dI.calc(l),pI.calc(l),mI.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new de().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function RO(s,e,t,n,i){const r=(n-e)*.5,a=(i-t)*.5,o=s*s,l=s*o;return(2*t-2*n+r+a)*l+(-3*t+3*n-2*r-a)*o+r*s+t}function MY(s,e){const t=1-s;return t*t*e}function wY(s,e){return 2*(1-s)*s*e}function RY(s,e){return s*s*e}function mv(s,e,t,n){return MY(s,e)+wY(s,t)+RY(s,n)}function BY(s,e){const t=1-s;return t*t*t*e}function DY(s,e){const t=1-s;return 3*t*t*s*e}function LY(s,e){return 3*(1-s)*s*s*e}function OY(s,e){return s*s*s*e}function gv(s,e,t,n,i){return BY(s,e)+DY(s,t)+LY(s,n)+OY(s,i)}class TB extends bl{constructor(e=new We,t=new We,n=new We,i=new We){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new We){const n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(gv(e,i.x,r.x,a.x,o.x),gv(e,i.y,r.y,a.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class kk extends bl{constructor(e=new de,t=new de,n=new de,i=new de){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new de){const n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(gv(e,i.x,r.x,a.x,o.x),gv(e,i.y,r.y,a.y,o.y),gv(e,i.z,r.z,a.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class CB extends bl{constructor(e=new We,t=new We){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new We){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new We){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Gk extends bl{constructor(e=new de,t=new de){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new de){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new de){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class IB extends bl{constructor(e=new We,t=new We,n=new We){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new We){const n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(mv(e,i.x,r.x,a.x),mv(e,i.y,r.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class MB extends bl{constructor(e=new de,t=new de,n=new de){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new de){const n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(mv(e,i.x,r.x,a.x),mv(e,i.y,r.y,a.y),mv(e,i.z,r.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class wB extends bl{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new We){const n=t,i=this.points,r=(i.length-1)*e,a=Math.floor(r),o=r-a,l=i[a===0?a:a-1],c=i[a],h=i[a>i.length-2?i.length-1:a+1],f=i[a>i.length-3?i.length-1:a+2];return n.set(RO(o,l.x,c.x,h.x,f.x),RO(o,l.y,c.y,h.y,f.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new We().fromArray(i))}return this}}var Jb=Object.freeze({__proto__:null,ArcCurve:Uk,CatmullRomCurve3:bB,CubicBezierCurve:TB,CubicBezierCurve3:kk,EllipseCurve:KT,LineCurve:CB,LineCurve3:Gk,QuadraticBezierCurve:IB,QuadraticBezierCurve3:MB,SplineCurve:wB});class Hk extends bl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Jb[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const a=i[r]-n,o=this.curves[r],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const a=r[i],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let c=0;c<l.length;c++){const h=l[c];n&&n.equals(h)||(t.push(h),n=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(new Jb[i.type]().fromJSON(i))}return this}}class sm extends Hk{constructor(e){super(),this.type="Path",this.currentPoint=new We,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new CB(this.currentPoint.clone(),new We(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new IB(this.currentPoint.clone(),new We(e,t),new We(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,a){const o=new TB(this.currentPoint.clone(),new We(e,t),new We(n,i),new We(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new wB(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,n,i,r,a),this}absarc(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this}ellipse(e,t,n,i,r,a,o,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,n,i,r,a,o,l),this}absellipse(e,t,n,i,r,a,o,l){const c=new KT(e,t,n,i,r,a,o,l);if(this.curves.length>0){const f=c.getPoint(0);f.equals(this.currentPoint)||this.lineTo(f.x,f.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}let id=class extends sm{constructor(e){super(e),this.uuid=Uo(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(new sm().fromJSON(i))}return this}};function PY(s,e,t=2){const n=e&&e.length,i=n?e[0]*t:s.length;let r=zk(s,0,i,t,!0);const a=[];if(!r||r.next===r.prev)return a;let o,l,c;if(n&&(r=GY(s,e,r,t)),s.length>80*t){o=1/0,l=1/0;let h=-1/0,f=-1/0;for(let p=t;p<i;p+=t){const g=s[p],y=s[p+1];g<o&&(o=g),y<l&&(l=y),g>h&&(h=g),y>f&&(f=y)}c=Math.max(h-o,f-l),c=c!==0?32767/c:0}return Vv(r,a,t,o,l,c,0),a}function zk(s,e,t,n,i){let r;if(i===$Y(s,e,t,n)>0)for(let a=e;a<t;a+=n)r=BO(a/n|0,s[a],s[a+1],r);else for(let a=t-n;a>=e;a-=n)r=BO(a/n|0,s[a],s[a+1],r);return r&&KA(r,r.next)&&(qv(r),r=r.next),r}function dm(s,e){if(!s)return s;e||(e=s);let t=s,n;do if(n=!1,!t.steiner&&(KA(t,t.next)||ms(t.prev,t,t.next)===0)){if(qv(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Vv(s,e,t,n,i,r,a){if(!s)return;!a&&r&&jY(s,n,i,r);let o=s;for(;s.prev!==s.next;){const l=s.prev,c=s.next;if(r?FY(s,n,i,r):NY(s)){e.push(l.i,s.i,c.i),qv(s),s=c.next,o=c.next;continue}if(s=c,s===o){a?a===1?(s=UY(dm(s),e),Vv(s,e,t,n,i,r,2)):a===2&&kY(s,e,t,n,i,r):Vv(dm(s),e,t,n,i,r,1);break}}}function NY(s){const e=s.prev,t=s,n=s.next;if(ms(e,t,n)>=0)return!1;const i=e.x,r=t.x,a=n.x,o=e.y,l=t.y,c=n.y,h=Math.min(i,r,a),f=Math.min(o,l,c),p=Math.max(i,r,a),g=Math.max(o,l,c);let y=n.next;for(;y!==e;){if(y.x>=h&&y.x<=p&&y.y>=f&&y.y<=g&&sv(i,o,r,l,a,c,y.x,y.y)&&ms(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function FY(s,e,t,n){const i=s.prev,r=s,a=s.next;if(ms(i,r,a)>=0)return!1;const o=i.x,l=r.x,c=a.x,h=i.y,f=r.y,p=a.y,g=Math.min(o,l,c),y=Math.min(h,f,p),x=Math.max(o,l,c),E=Math.max(h,f,p),_=ww(g,y,e,t,n),b=ww(x,E,e,t,n);let C=s.prevZ,I=s.nextZ;for(;C&&C.z>=_&&I&&I.z<=b;){if(C.x>=g&&C.x<=x&&C.y>=y&&C.y<=E&&C!==i&&C!==a&&sv(o,h,l,f,c,p,C.x,C.y)&&ms(C.prev,C,C.next)>=0||(C=C.prevZ,I.x>=g&&I.x<=x&&I.y>=y&&I.y<=E&&I!==i&&I!==a&&sv(o,h,l,f,c,p,I.x,I.y)&&ms(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;C&&C.z>=_;){if(C.x>=g&&C.x<=x&&C.y>=y&&C.y<=E&&C!==i&&C!==a&&sv(o,h,l,f,c,p,C.x,C.y)&&ms(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;I&&I.z<=b;){if(I.x>=g&&I.x<=x&&I.y>=y&&I.y<=E&&I!==i&&I!==a&&sv(o,h,l,f,c,p,I.x,I.y)&&ms(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function UY(s,e){let t=s;do{const n=t.prev,i=t.next.next;!KA(n,i)&&Vk(n,t,t.next,i)&&jv(n,i)&&jv(i,n)&&(e.push(n.i,t.i,i.i),qv(t),qv(t.next),t=s=i),t=t.next}while(t!==s);return dm(t)}function kY(s,e,t,n,i,r){let a=s;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&YY(a,o)){let l=jk(a,o);a=dm(a,a.next),l=dm(l,l.next),Vv(a,e,t,n,i,r,0),Vv(l,e,t,n,i,r,0);return}o=o.next}a=a.next}while(a!==s)}function GY(s,e,t,n){const i=[];for(let r=0,a=e.length;r<a;r++){const o=e[r]*n,l=r<a-1?e[r+1]*n:s.length,c=zk(s,o,l,n,!1);c===c.next&&(c.steiner=!0),i.push(KY(c))}i.sort(HY);for(let r=0;r<i.length;r++)t=zY(i[r],t);return t}function HY(s,e){let t=s.x-e.x;if(t===0&&(t=s.y-e.y,t===0)){const n=(s.next.y-s.y)/(s.next.x-s.x),i=(e.next.y-e.y)/(e.next.x-e.x);t=n-i}return t}function zY(s,e){const t=QY(s,e);if(!t)return e;const n=jk(t,s);return dm(n,n.next),dm(t,t.next)}function QY(s,e){let t=e;const n=s.x,i=s.y;let r=-1/0,a;if(KA(s,t))return t;do{if(KA(s,t.next))return t.next;if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const f=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=n&&f>r&&(r=f,a=t.x<t.next.x?t:t.next,f===n))return a}t=t.next}while(t!==e);if(!a)return null;const o=a,l=a.x,c=a.y;let h=1/0;t=a;do{if(n>=t.x&&t.x>=l&&n!==t.x&&Qk(i<c?n:r,i,l,c,i<c?r:n,i,t.x,t.y)){const f=Math.abs(i-t.y)/(n-t.x);jv(t,s)&&(f<h||f===h&&(t.x>a.x||t.x===a.x&&VY(a,t)))&&(a=t,h=f)}t=t.next}while(t!==o);return a}function VY(s,e){return ms(s.prev,s,e.prev)<0&&ms(e.next,s,s.next)<0}function jY(s,e,t,n){let i=s;do i.z===0&&(i.z=ww(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==s);i.prevZ.nextZ=null,i.prevZ=null,qY(i)}function qY(s){let e,t=1;do{let n=s,i;s=null;let r=null;for(e=0;n;){e++;let a=n,o=0;for(let c=0;c<t&&(o++,a=a.nextZ,!!a);c++);let l=t;for(;o>0||l>0&&a;)o!==0&&(l===0||!a||n.z<=a.z)?(i=n,n=n.nextZ,o--):(i=a,a=a.nextZ,l--),r?r.nextZ=i:s=i,i.prevZ=r,r=i;n=a}r.nextZ=null,t*=2}while(e>1);return s}function ww(s,e,t,n,i){return s=(s-t)*i|0,e=(e-n)*i|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function KY(s){let e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function Qk(s,e,t,n,i,r,a,o){return(i-a)*(e-o)>=(s-a)*(r-o)&&(s-a)*(n-o)>=(t-a)*(e-o)&&(t-a)*(r-o)>=(i-a)*(n-o)}function sv(s,e,t,n,i,r,a,o){return!(s===a&&e===o)&&Qk(s,e,t,n,i,r,a,o)}function YY(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!XY(s,e)&&(jv(s,e)&&jv(e,s)&&WY(s,e)&&(ms(s.prev,s,e.prev)||ms(s,e.prev,e))||KA(s,e)&&ms(s.prev,s,s.next)>0&&ms(e.prev,e,e.next)>0)}function ms(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function KA(s,e){return s.x===e.x&&s.y===e.y}function Vk(s,e,t,n){const i=lS(ms(s,e,t)),r=lS(ms(s,e,n)),a=lS(ms(t,n,s)),o=lS(ms(t,n,e));return!!(i!==r&&a!==o||i===0&&oS(s,t,e)||r===0&&oS(s,n,e)||a===0&&oS(t,s,n)||o===0&&oS(t,e,n))}function oS(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function lS(s){return s>0?1:s<0?-1:0}function XY(s,e){let t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&Vk(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function jv(s,e){return ms(s.prev,s,s.next)<0?ms(s,e,s.next)>=0&&ms(s,s.prev,e)>=0:ms(s,e,s.prev)<0||ms(s,s.next,e)<0}function WY(s,e){let t=s,n=!1;const i=(s.x+e.x)/2,r=(s.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==s);return n}function jk(s,e){const t=Rw(s.i,s.x,s.y),n=Rw(e.i,e.x,e.y),i=s.next,r=e.prev;return s.next=e,e.prev=s,t.next=i,i.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function BO(s,e,t,n){const i=Rw(s,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function qv(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Rw(s,e,t){return{i:s,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function $Y(s,e,t,n){let i=0;for(let r=e,a=t-n;r<t;r+=n)i+=(s[a]-s[r])*(s[r+1]+s[a+1]),a=r;return i}class JY{static triangulate(e,t,n=2){return PY(e,t,n)}}class Al{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return n*.5}static isClockWise(e){return Al.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];DO(e),LO(n,e);let a=e.length;t.forEach(DO);for(let l=0;l<t.length;l++)i.push(a),a+=t[l].length,LO(n,t[l]);const o=JY.triangulate(n,i);for(let l=0;l<o.length;l+=3)r.push(o.slice(l,l+3));return r}}function DO(s){const e=s.length;e>2&&s[e-1].equals(s[0])&&s.pop()}function LO(s,e){for(let t=0;t<e.length;t++)s.push(e[t].x),s.push(e[t].y)}class EE extends hn{constructor(e=new id([new We(.5,.5),new We(-.5,.5),new We(-.5,-.5),new We(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let o=0,l=e.length;o<l;o++){const c=e[o];a(c)}this.setAttribute("position",new Bt(i,3)),this.setAttribute("uv",new Bt(r,2)),this.computeVertexNormals();function a(o){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,f=t.depth!==void 0?t.depth:1;let p=t.bevelEnabled!==void 0?t.bevelEnabled:!0,g=t.bevelThickness!==void 0?t.bevelThickness:.2,y=t.bevelSize!==void 0?t.bevelSize:g-.1,x=t.bevelOffset!==void 0?t.bevelOffset:0,E=t.bevelSegments!==void 0?t.bevelSegments:3;const _=t.extrudePath,b=t.UVGenerator!==void 0?t.UVGenerator:ZY;let C,I=!1,M,R,D,P;_&&(C=_.getSpacedPoints(h),I=!0,p=!1,M=_.computeFrenetFrames(h,!1),R=new de,D=new de,P=new de),p||(E=0,g=0,y=0,x=0);const L=o.extractPoints(c);let O=L.shape;const U=L.holes;if(!Al.isClockWise(O)){O=O.reverse();for(let ve=0,Ae=U.length;ve<Ae;ve++){const Se=U[ve];Al.isClockWise(Se)&&(U[ve]=Se.reverse())}}function H(ve){const Se=10000000000000001e-36;let be=ve[0];for(let Re=1;Re<=ve.length;Re++){const me=Re%ve.length,ue=ve[me],$e=ue.x-be.x,gt=ue.y-be.y,ge=$e*$e+gt*gt,ae=Math.max(Math.abs(ue.x),Math.abs(ue.y),Math.abs(be.x),Math.abs(be.y)),Pe=Se*ae*ae;if(ge<=Pe){ve.splice(me,1),Re--;continue}be=ue}}H(O),U.forEach(H);const z=U.length,q=O;for(let ve=0;ve<z;ve++){const Ae=U[ve];O=O.concat(Ae)}function k(ve,Ae,Se){return Ae||console.error("THREE.ExtrudeGeometry: vec does not exist"),ve.clone().addScaledVector(Ae,Se)}const W=O.length;function V(ve,Ae,Se){let be,Re,me;const ue=ve.x-Ae.x,$e=ve.y-Ae.y,gt=Se.x-ve.x,ge=Se.y-ve.y,ae=ue*ue+$e*$e,Pe=ue*ge-$e*gt;if(Math.abs(Pe)>Number.EPSILON){const Ve=Math.sqrt(ae),rt=Math.sqrt(gt*gt+ge*ge),et=Ae.x-$e/Ve,Mt=Ae.y+ue/Ve,Et=Se.x-ge/rt,Rt=Se.y+gt/rt,Gt=((Et-et)*ge-(Rt-Mt)*gt)/(ue*ge-$e*gt);be=et+ue*Gt-ve.x,Re=Mt+$e*Gt-ve.y;const pt=be*be+Re*Re;if(pt<=2)return new We(be,Re);me=Math.sqrt(pt/2)}else{let Ve=!1;ue>Number.EPSILON?gt>Number.EPSILON&&(Ve=!0):ue<-Number.EPSILON?gt<-Number.EPSILON&&(Ve=!0):Math.sign($e)===Math.sign(ge)&&(Ve=!0),Ve?(be=-$e,Re=ue,me=Math.sqrt(ae)):(be=ue,Re=$e,me=Math.sqrt(ae/2))}return new We(be/me,Re/me)}const X=[];for(let ve=0,Ae=q.length,Se=Ae-1,be=ve+1;ve<Ae;ve++,Se++,be++)Se===Ae&&(Se=0),be===Ae&&(be=0),X[ve]=V(q[ve],q[Se],q[be]);const K=[];let te,oe=X.concat();for(let ve=0,Ae=z;ve<Ae;ve++){const Se=U[ve];te=[];for(let be=0,Re=Se.length,me=Re-1,ue=be+1;be<Re;be++,me++,ue++)me===Re&&(me=0),ue===Re&&(ue=0),te[be]=V(Se[be],Se[me],Se[ue]);K.push(te),oe=oe.concat(te)}let Ee;if(E===0)Ee=Al.triangulateShape(q,U);else{const ve=[],Ae=[];for(let Se=0;Se<E;Se++){const be=Se/E,Re=g*Math.cos(be*Math.PI/2),me=y*Math.sin(be*Math.PI/2)+x;for(let ue=0,$e=q.length;ue<$e;ue++){const gt=k(q[ue],X[ue],me);Be(gt.x,gt.y,-Re),be===0&&ve.push(gt)}for(let ue=0,$e=z;ue<$e;ue++){const gt=U[ue];te=K[ue];const ge=[];for(let ae=0,Pe=gt.length;ae<Pe;ae++){const Ve=k(gt[ae],te[ae],me);Be(Ve.x,Ve.y,-Re),be===0&&ge.push(Ve)}be===0&&Ae.push(ge)}}Ee=Al.triangulateShape(ve,Ae)}const Ce=Ee.length,se=y+x;for(let ve=0;ve<W;ve++){const Ae=p?k(O[ve],oe[ve],se):O[ve];I?(D.copy(M.normals[0]).multiplyScalar(Ae.x),R.copy(M.binormals[0]).multiplyScalar(Ae.y),P.copy(C[0]).add(D).add(R),Be(P.x,P.y,P.z)):Be(Ae.x,Ae.y,0)}for(let ve=1;ve<=h;ve++)for(let Ae=0;Ae<W;Ae++){const Se=p?k(O[Ae],oe[Ae],se):O[Ae];I?(D.copy(M.normals[ve]).multiplyScalar(Se.x),R.copy(M.binormals[ve]).multiplyScalar(Se.y),P.copy(C[ve]).add(D).add(R),Be(P.x,P.y,P.z)):Be(Se.x,Se.y,f/h*ve)}for(let ve=E-1;ve>=0;ve--){const Ae=ve/E,Se=g*Math.cos(Ae*Math.PI/2),be=y*Math.sin(Ae*Math.PI/2)+x;for(let Re=0,me=q.length;Re<me;Re++){const ue=k(q[Re],X[Re],be);Be(ue.x,ue.y,f+Se)}for(let Re=0,me=U.length;Re<me;Re++){const ue=U[Re];te=K[Re];for(let $e=0,gt=ue.length;$e<gt;$e++){const ge=k(ue[$e],te[$e],be);I?Be(ge.x,ge.y+C[h-1].y,C[h-1].x+Se):Be(ge.x,ge.y,f+Se)}}}ie(),ne();function ie(){const ve=i.length/3;if(p){let Ae=0,Se=W*Ae;for(let be=0;be<Ce;be++){const Re=Ee[be];Ge(Re[2]+Se,Re[1]+Se,Re[0]+Se)}Ae=h+E*2,Se=W*Ae;for(let be=0;be<Ce;be++){const Re=Ee[be];Ge(Re[0]+Se,Re[1]+Se,Re[2]+Se)}}else{for(let Ae=0;Ae<Ce;Ae++){const Se=Ee[Ae];Ge(Se[2],Se[1],Se[0])}for(let Ae=0;Ae<Ce;Ae++){const Se=Ee[Ae];Ge(Se[0]+W*h,Se[1]+W*h,Se[2]+W*h)}}n.addGroup(ve,i.length/3-ve,0)}function ne(){const ve=i.length/3;let Ae=0;re(q,Ae),Ae+=q.length;for(let Se=0,be=U.length;Se<be;Se++){const Re=U[Se];re(Re,Ae),Ae+=Re.length}n.addGroup(ve,i.length/3-ve,1)}function re(ve,Ae){let Se=ve.length;for(;--Se>=0;){const be=Se;let Re=Se-1;Re<0&&(Re=ve.length-1);for(let me=0,ue=h+E*2;me<ue;me++){const $e=W*me,gt=W*(me+1),ge=Ae+be+$e,ae=Ae+Re+$e,Pe=Ae+Re+gt,Ve=Ae+be+gt;Ue(ge,ae,Pe,Ve)}}}function Be(ve,Ae,Se){l.push(ve),l.push(Ae),l.push(Se)}function Ge(ve,Ae,Se){nt(ve),nt(Ae),nt(Se);const be=i.length/3,Re=b.generateTopUV(n,i,be-3,be-2,be-1);pe(Re[0]),pe(Re[1]),pe(Re[2])}function Ue(ve,Ae,Se,be){nt(ve),nt(Ae),nt(be),nt(Ae),nt(Se),nt(be);const Re=i.length/3,me=b.generateSideWallUV(n,i,Re-6,Re-3,Re-2,Re-1);pe(me[0]),pe(me[1]),pe(me[3]),pe(me[1]),pe(me[2]),pe(me[3])}function nt(ve){i.push(l[ve*3+0]),i.push(l[ve*3+1]),i.push(l[ve*3+2])}function pe(ve){r.push(ve.x),r.push(ve.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return eX(t,n,e)}static fromJSON(e,t){const n=[];for(let r=0,a=e.shapes.length;r<a;r++){const o=t[e.shapes[r]];n.push(o)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new Jb[i.type]().fromJSON(i)),new EE(n,e.options)}}const ZY={generateTopUV:function(s,e,t,n,i){const r=e[t*3],a=e[t*3+1],o=e[n*3],l=e[n*3+1],c=e[i*3],h=e[i*3+1];return[new We(r,a),new We(o,l),new We(c,h)]},generateSideWallUV:function(s,e,t,n,i,r){const a=e[t*3],o=e[t*3+1],l=e[t*3+2],c=e[n*3],h=e[n*3+1],f=e[n*3+2],p=e[i*3],g=e[i*3+1],y=e[i*3+2],x=e[r*3],E=e[r*3+1],_=e[r*3+2];return Math.abs(o-h)<Math.abs(a-c)?[new We(a,1-l),new We(c,1-f),new We(p,1-y),new We(x,1-_)]:[new We(o,1-l),new We(h,1-f),new We(g,1-y),new We(E,1-_)]}};function eX(s,e,t){if(t.shapes=[],Array.isArray(s))for(let n=0,i=s.length;n<i;n++){const r=s[n];t.shapes.push(r.uuid)}else t.shapes.push(s.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class YT extends Ed{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new YT(e.radius,e.detail)}}class XT extends hn{constructor(e=[new We(0,-.5),new We(.5,0),new We(0,.5)],t=12,n=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=pn(i,0,Math.PI*2);const r=[],a=[],o=[],l=[],c=[],h=1/t,f=new de,p=new We,g=new de,y=new de,x=new de;let E=0,_=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:E=e[b+1].x-e[b].x,_=e[b+1].y-e[b].y,g.x=_*1,g.y=-E,g.z=_*0,x.copy(g),g.normalize(),l.push(g.x,g.y,g.z);break;case e.length-1:l.push(x.x,x.y,x.z);break;default:E=e[b+1].x-e[b].x,_=e[b+1].y-e[b].y,g.x=_*1,g.y=-E,g.z=_*0,y.copy(g),g.x+=x.x,g.y+=x.y,g.z+=x.z,g.normalize(),l.push(g.x,g.y,g.z),x.copy(y)}for(let b=0;b<=t;b++){const C=n+b*h*i,I=Math.sin(C),M=Math.cos(C);for(let R=0;R<=e.length-1;R++){f.x=e[R].x*I,f.y=e[R].y,f.z=e[R].x*M,a.push(f.x,f.y,f.z),p.x=b/t,p.y=R/(e.length-1),o.push(p.x,p.y);const D=l[3*R+0]*I,P=l[3*R+1],L=l[3*R+0]*M;c.push(D,P,L)}}for(let b=0;b<t;b++)for(let C=0;C<e.length-1;C++){const I=C+b*e.length,M=I,R=I+e.length,D=I+e.length+1,P=I+1;r.push(M,R,P),r.push(D,P,R)}this.setIndex(r),this.setAttribute("position",new Bt(a,3)),this.setAttribute("uv",new Bt(o,2)),this.setAttribute("normal",new Bt(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new XT(e.points,e.segments,e.phiStart,e.phiLength)}}class xE extends Ed{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new xE(e.radius,e.detail)}}class xd extends hn{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,a=t/2,o=Math.floor(n),l=Math.floor(i),c=o+1,h=l+1,f=e/o,p=t/l,g=[],y=[],x=[],E=[];for(let _=0;_<h;_++){const b=_*p-a;for(let C=0;C<c;C++){const I=C*f-r;y.push(I,-b,0),x.push(0,0,1),E.push(C/o),E.push(1-_/l)}}for(let _=0;_<l;_++)for(let b=0;b<o;b++){const C=b+c*_,I=b+c*(_+1),M=b+1+c*(_+1),R=b+1+c*_;g.push(C,I,R),g.push(I,M,R)}this.setIndex(g),this.setAttribute("position",new Bt(y,3)),this.setAttribute("normal",new Bt(x,3)),this.setAttribute("uv",new Bt(E,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xd(e.width,e.height,e.widthSegments,e.heightSegments)}}class WT extends hn{constructor(e=.5,t=1,n=32,i=1,r=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:a},n=Math.max(3,n),i=Math.max(1,i);const o=[],l=[],c=[],h=[];let f=e;const p=(t-e)/i,g=new de,y=new We;for(let x=0;x<=i;x++){for(let E=0;E<=n;E++){const _=r+E/n*a;g.x=f*Math.cos(_),g.y=f*Math.sin(_),l.push(g.x,g.y,g.z),c.push(0,0,1),y.x=(g.x/t+1)/2,y.y=(g.y/t+1)/2,h.push(y.x,y.y)}f+=p}for(let x=0;x<i;x++){const E=x*(n+1);for(let _=0;_<n;_++){const b=_+E,C=b,I=b+n+1,M=b+n+2,R=b+1;o.push(C,I,R),o.push(I,M,R)}}this.setIndex(o),this.setAttribute("position",new Bt(l,3)),this.setAttribute("normal",new Bt(c,3)),this.setAttribute("uv",new Bt(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new WT(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class $T extends hn{constructor(e=new id([new We(0,.5),new We(-.5,-.5),new We(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],a=[];let o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(o,l,h),o+=l,l=0;this.setIndex(n),this.setAttribute("position",new Bt(i,3)),this.setAttribute("normal",new Bt(r,3)),this.setAttribute("uv",new Bt(a,2));function c(h){const f=i.length/3,p=h.extractPoints(t);let g=p.shape;const y=p.holes;Al.isClockWise(g)===!1&&(g=g.reverse());for(let E=0,_=y.length;E<_;E++){const b=y[E];Al.isClockWise(b)===!0&&(y[E]=b.reverse())}const x=Al.triangulateShape(g,y);for(let E=0,_=y.length;E<_;E++){const b=y[E];g=g.concat(b)}for(let E=0,_=g.length;E<_;E++){const b=g[E];i.push(b.x,b.y,0),r.push(0,0,1),a.push(b.x,b.y)}for(let E=0,_=x.length;E<_;E++){const b=x[E],C=b[0]+f,I=b[1]+f,M=b[2]+f;n.push(C,I,M),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return tX(t,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const a=t[e.shapes[i]];n.push(a)}return new $T(n,e.curveSegments)}}function tX(s,e){if(e.shapes=[],Array.isArray(s))for(let t=0,n=s.length;t<n;t++){const i=s[t];e.shapes.push(i.uuid)}else e.shapes.push(s.uuid);return e}class _E extends hn{constructor(e=1,t=32,n=16,i=0,r=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(a+o,Math.PI);let c=0;const h=[],f=new de,p=new de,g=[],y=[],x=[],E=[];for(let _=0;_<=n;_++){const b=[],C=_/n;let I=0;_===0&&a===0?I=.5/t:_===n&&l===Math.PI&&(I=-.5/t);for(let M=0;M<=t;M++){const R=M/t;f.x=-e*Math.cos(i+R*r)*Math.sin(a+C*o),f.y=e*Math.cos(a+C*o),f.z=e*Math.sin(i+R*r)*Math.sin(a+C*o),y.push(f.x,f.y,f.z),p.copy(f).normalize(),x.push(p.x,p.y,p.z),E.push(R+I,1-C),b.push(c++)}h.push(b)}for(let _=0;_<n;_++)for(let b=0;b<t;b++){const C=h[_][b+1],I=h[_][b],M=h[_+1][b],R=h[_+1][b+1];(_!==0||a>0)&&g.push(C,I,R),(_!==n-1||l<Math.PI)&&g.push(I,M,R)}this.setIndex(g),this.setAttribute("position",new Bt(y,3)),this.setAttribute("normal",new Bt(x,3)),this.setAttribute("uv",new Bt(E,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _E(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class JT extends Ed{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new JT(e.radius,e.detail)}}class ZT extends hn{constructor(e=1,t=.4,n=12,i=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],l=[],c=[],h=new de,f=new de,p=new de;for(let g=0;g<=n;g++)for(let y=0;y<=i;y++){const x=y/i*r,E=g/n*Math.PI*2;f.x=(e+t*Math.cos(E))*Math.cos(x),f.y=(e+t*Math.cos(E))*Math.sin(x),f.z=t*Math.sin(E),o.push(f.x,f.y,f.z),h.x=e*Math.cos(x),h.y=e*Math.sin(x),p.subVectors(f,h).normalize(),l.push(p.x,p.y,p.z),c.push(y/i),c.push(g/n)}for(let g=1;g<=n;g++)for(let y=1;y<=i;y++){const x=(i+1)*g+y-1,E=(i+1)*(g-1)+y-1,_=(i+1)*(g-1)+y,b=(i+1)*g+y;a.push(x,E,b),a.push(E,_,b)}this.setIndex(a),this.setAttribute("position",new Bt(o,3)),this.setAttribute("normal",new Bt(l,3)),this.setAttribute("uv",new Bt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ZT(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class eC extends hn{constructor(e=1,t=.4,n=64,i=8,r=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:a},n=Math.floor(n),i=Math.floor(i);const o=[],l=[],c=[],h=[],f=new de,p=new de,g=new de,y=new de,x=new de,E=new de,_=new de;for(let C=0;C<=n;++C){const I=C/n*r*Math.PI*2;b(I,r,a,e,g),b(I+.01,r,a,e,y),E.subVectors(y,g),_.addVectors(y,g),x.crossVectors(E,_),_.crossVectors(x,E),x.normalize(),_.normalize();for(let M=0;M<=i;++M){const R=M/i*Math.PI*2,D=-t*Math.cos(R),P=t*Math.sin(R);f.x=g.x+(D*_.x+P*x.x),f.y=g.y+(D*_.y+P*x.y),f.z=g.z+(D*_.z+P*x.z),l.push(f.x,f.y,f.z),p.subVectors(f,g).normalize(),c.push(p.x,p.y,p.z),h.push(C/n),h.push(M/i)}}for(let C=1;C<=n;C++)for(let I=1;I<=i;I++){const M=(i+1)*(C-1)+(I-1),R=(i+1)*C+(I-1),D=(i+1)*C+I,P=(i+1)*(C-1)+I;o.push(M,R,P),o.push(R,D,P)}this.setIndex(o),this.setAttribute("position",new Bt(l,3)),this.setAttribute("normal",new Bt(c,3)),this.setAttribute("uv",new Bt(h,2));function b(C,I,M,R,D){const P=Math.cos(C),L=Math.sin(C),O=M/I*C,U=Math.cos(O);D.x=R*(2+U)*.5*P,D.y=R*(2+U)*L*.5,D.z=R*Math.sin(O)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new eC(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class tC extends hn{constructor(e=new MB(new de(-1,-1,0),new de(-1,1,0),new de(1,1,0)),t=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const a=e.computeFrenetFrames(t,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new de,l=new de,c=new We;let h=new de;const f=[],p=[],g=[],y=[];x(),this.setIndex(y),this.setAttribute("position",new Bt(f,3)),this.setAttribute("normal",new Bt(p,3)),this.setAttribute("uv",new Bt(g,2));function x(){for(let C=0;C<t;C++)E(C);E(r===!1?t:0),b(),_()}function E(C){h=e.getPointAt(C/t,h);const I=a.normals[C],M=a.binormals[C];for(let R=0;R<=i;R++){const D=R/i*Math.PI*2,P=Math.sin(D),L=-Math.cos(D);l.x=L*I.x+P*M.x,l.y=L*I.y+P*M.y,l.z=L*I.z+P*M.z,l.normalize(),p.push(l.x,l.y,l.z),o.x=h.x+n*l.x,o.y=h.y+n*l.y,o.z=h.z+n*l.z,f.push(o.x,o.y,o.z)}}function _(){for(let C=1;C<=t;C++)for(let I=1;I<=i;I++){const M=(i+1)*(C-1)+(I-1),R=(i+1)*C+(I-1),D=(i+1)*C+I,P=(i+1)*(C-1)+I;y.push(M,R,P),y.push(R,D,P)}}function b(){for(let C=0;C<=t;C++)for(let I=0;I<=i;I++)c.x=C/t,c.y=I/i,g.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new tC(new Jb[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class qk extends hn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,i=new de,r=new de;if(e.index!==null){const a=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,h=l.length;c<h;++c){const f=l[c],p=f.start,g=f.count;for(let y=p,x=p+g;y<x;y+=3)for(let E=0;E<3;E++){const _=o.getX(y+E),b=o.getX(y+(E+1)%3);i.fromBufferAttribute(a,_),r.fromBufferAttribute(a,b),OO(i,r,n)===!0&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const a=e.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const h=3*o+c,f=3*o+(c+1)%3;i.fromBufferAttribute(a,h),r.fromBufferAttribute(a,f),OO(i,r,n)===!0&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new Bt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function OO(s,e,t){const n=`${s.x},${s.y},${s.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${s.x},${s.y},${s.z}`;return t.has(n)===!0||t.has(i)===!0?!1:(t.add(n),t.add(i),!0)}var PO=Object.freeze({__proto__:null,BoxGeometry:ym,CapsuleGeometry:VT,CircleGeometry:jT,ConeGeometry:vE,CylinderGeometry:yE,DodecahedronGeometry:qT,EdgesGeometry:Fk,ExtrudeGeometry:EE,IcosahedronGeometry:YT,LatheGeometry:XT,OctahedronGeometry:xE,PlaneGeometry:xd,PolyhedronGeometry:Ed,RingGeometry:WT,ShapeGeometry:$T,SphereGeometry:_E,TetrahedronGeometry:JT,TorusGeometry:ZT,TorusKnotGeometry:eC,TubeGeometry:tC,WireframeGeometry:qk});class Kk extends Ps{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Tt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}let Yk=class extends Ra{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};class SE extends Ps{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Tt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yd,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Os,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Tl extends SE{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new We(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return pn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Tt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Tt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Tt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class SA extends Ps{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Tt(16777215),this.specular=new Tt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yd,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Os,this.combine=dE,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Xk extends Ps{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Tt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yd,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Wk extends Ps{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yd,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class RB extends Ps{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Tt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yd,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Os,this.combine=dE,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nC extends Ps{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=gk,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class BB extends Ps{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class $k extends Ps{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Tt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yd,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Jk extends $s{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Yp(s,e){return!s||s.constructor===e?s:typeof e.BYTES_PER_ELEMENT=="number"?new e(s):Array.prototype.slice.call(s)}function Zk(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function eG(s){function e(i,r){return s[i]-s[r]}const t=s.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n}function Bw(s,e,t){const n=s.length,i=new s.constructor(n);for(let r=0,a=0;a!==n;++r){const o=t[r]*e;for(let l=0;l!==e;++l)i[a++]=s[o+l]}return i}function DB(s,e,t,n){let i=1,r=s[0];for(;r!==void 0&&r[n]===void 0;)r=s[i++];if(r===void 0)return;let a=r[n];if(a!==void 0)if(Array.isArray(a))do a=r[n],a!==void 0&&(e.push(r.time),t.push(...a)),r=s[i++];while(r!==void 0);else if(a.toArray!==void 0)do a=r[n],a!==void 0&&(e.push(r.time),a.toArray(t,t.length)),r=s[i++];while(r!==void 0);else do a=r[n],a!==void 0&&(e.push(r.time),t.push(a)),r=s[i++];while(r!==void 0)}function nX(s,e,t,n,i=30){const r=s.clone();r.name=e;const a=[];for(let l=0;l<r.tracks.length;++l){const c=r.tracks[l],h=c.getValueSize(),f=[],p=[];for(let g=0;g<c.times.length;++g){const y=c.times[g]*i;if(!(y<t||y>=n)){f.push(c.times[g]);for(let x=0;x<h;++x)p.push(c.values[g*h+x])}}f.length!==0&&(c.times=Yp(f,c.times.constructor),c.values=Yp(p,c.values.constructor),a.push(c))}r.tracks=a;let o=1/0;for(let l=0;l<r.tracks.length;++l)o>r.tracks[l].times[0]&&(o=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*o);return r.resetDuration(),r}function iX(s,e=0,t=s,n=30){n<=0&&(n=30);const i=t.tracks.length,r=e/n;for(let a=0;a<i;++a){const o=t.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=s.tracks.find(function(_){return _.name===o.name&&_.ValueTypeName===l});if(c===void 0)continue;let h=0;const f=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=f/3);let p=0;const g=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=g/3);const y=o.times.length-1;let x;if(r<=o.times[0]){const _=h,b=f-h;x=o.values.slice(_,b)}else if(r>=o.times[y]){const _=y*f+h,b=_+f-h;x=o.values.slice(_,b)}else{const _=o.createInterpolant(),b=h,C=f-h;_.evaluate(r),x=_.resultBuffer.slice(b,C)}l==="quaternion"&&new Xs().fromArray(x).normalize().conjugate().toArray(x);const E=c.times.length;for(let _=0;_<E;++_){const b=_*g+p;if(l==="quaternion")Xs.multiplyQuaternionsFlat(c.values,b,x,0,c.values,b);else{const C=g-p*2;for(let I=0;I<C;++I)c.values[b+I]-=x[I]}}}return s.blendMode=hB,s}class sX{static convertArray(e,t){return Yp(e,t)}static isTypedArray(e){return Zk(e)}static getKeyframeOrder(e){return eG(e)}static sortedArray(e,t,n){return Bw(e,t,n)}static flattenJSON(e,t,n,i){DB(e,t,n,i)}static subclip(e,t,n,i,r=30){return nX(e,t,n,i,r)}static makeClipAdditive(e,t=0,n=e,i=30){return iX(e,t,n,i)}}class c0{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let a;n:{i:if(!(e<i)){for(let o=n+2;;){if(i===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}a=t.length;break n}if(!(e>=r)){const o=t[1];e<o&&(n=2,r=o);for(let l=n-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(i=r,r=t[--n-1],e>=r)break t}a=n,n=0;break n}break e}for(;n<a;){const o=n+a>>>1;e<t[o]?a=o:n=o+1}if(i=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let a=0;a!==i;++a)t[a]=n[r+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class tG extends c0{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:jp,endingEnd:jp}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,a=e+1,o=i[r],l=i[a];if(o===void 0)switch(this.getSettings_().endingStart){case qp:r=e,o=2*t-n;break;case Gv:r=i.length-2,o=t+i[r]-i[r+1];break;default:r=e,o=n}if(l===void 0)switch(this.getSettings_().endingEnd){case qp:a=e,l=2*n-t;break;case Gv:a=1,l=n+i[1]-i[0];break;default:a=e-1,l=t}const c=(n-t)*.5,h=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(l-n),this._offsetPrev=r*h,this._offsetNext=a*h}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,h=this._offsetPrev,f=this._offsetNext,p=this._weightPrev,g=this._weightNext,y=(n-t)/(i-t),x=y*y,E=x*y,_=-p*E+2*p*x-p*y,b=(1+p)*E+(-1.5-2*p)*x+(-.5+p)*y+1,C=(-1-g)*E+(1.5+g)*x+.5*y,I=g*E-g*x;for(let M=0;M!==o;++M)r[M]=_*a[h+M]+b*a[c+M]+C*a[l+M]+I*a[f+M];return r}}class LB extends c0{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,h=(n-t)/(i-t),f=1-h;for(let p=0;p!==o;++p)r[p]=a[c+p]*f+a[l+p]*h;return r}}class nG extends c0{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Cl{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Yp(t,this.TimeBufferType),this.values=Yp(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Yp(e.times,Array),values:Yp(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new nG(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new LB(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new tG(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case GA:t=this.InterpolantFactoryMethodDiscrete;break;case HA:t=this.InterpolantFactoryMethodLinear;break;case KS:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return GA;case this.InterpolantFactoryMethodLinear:return HA;case this.InterpolantFactoryMethodSmooth:return KS}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,a=i-1;for(;r!==i&&n[r]<e;)++r;for(;a!==-1&&n[a]>t;)--a;if(++a,r!==0||a!==i){r>=a&&(a=Math.max(a,1),r=a-1);const o=this.getValueSize();this.times=n.slice(r,a),this.values=this.values.slice(r*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==r;o++){const l=n[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),e=!1;break}a=l}if(i!==void 0&&Zk(i))for(let o=0,l=i.length;o!==l;++o){const c=i[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===KS,r=e.length-1;let a=1;for(let o=1;o<r;++o){let l=!1;const c=e[o],h=e[o+1];if(c!==h&&(o!==1||c!==e[0]))if(i)l=!0;else{const f=o*n,p=f-n,g=f+n;for(let y=0;y!==n;++y){const x=t[f+y];if(x!==t[p+y]||x!==t[g+y]){l=!0;break}}}if(l){if(o!==a){e[a]=e[o];const f=o*n,p=a*n;for(let g=0;g!==n;++g)t[p+g]=t[f+g]}++a}}if(r>0){e[a]=e[r];for(let o=r*n,l=a*n,c=0;c!==n;++c)t[l+c]=t[o+c];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Cl.prototype.ValueTypeName="";Cl.prototype.TimeBufferType=Float32Array;Cl.prototype.ValueBufferType=Float32Array;Cl.prototype.DefaultInterpolation=HA;class vm extends Cl{constructor(e,t,n){super(e,t,n)}}vm.prototype.ValueTypeName="bool";vm.prototype.ValueBufferType=Array;vm.prototype.DefaultInterpolation=GA;vm.prototype.InterpolantFactoryMethodLinear=void 0;vm.prototype.InterpolantFactoryMethodSmooth=void 0;class OB extends Cl{constructor(e,t,n,i){super(e,t,n,i)}}OB.prototype.ValueTypeName="color";class fd extends Cl{constructor(e,t,n,i){super(e,t,n,i)}}fd.prototype.ValueTypeName="number";class iG extends c0{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(n-t)/(i-t);let c=e*o;for(let h=c+o;c!==h;c+=4)Xs.slerpFlat(r,0,a,c-o,a,c,l);return r}}class dd extends Cl{constructor(e,t,n,i){super(e,t,n,i)}InterpolantFactoryMethodLinear(e){return new iG(this.times,this.values,this.getValueSize(),e)}}dd.prototype.ValueTypeName="quaternion";dd.prototype.InterpolantFactoryMethodSmooth=void 0;class Em extends Cl{constructor(e,t,n){super(e,t,n)}}Em.prototype.ValueTypeName="string";Em.prototype.ValueBufferType=Array;Em.prototype.DefaultInterpolation=GA;Em.prototype.InterpolantFactoryMethodLinear=void 0;Em.prototype.InterpolantFactoryMethodSmooth=void 0;class pd extends Cl{constructor(e,t,n,i){super(e,t,n,i)}}pd.prototype.ValueTypeName="vector";class pm{constructor(e="",t=-1,n=[],i=OT){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Uo(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let a=0,o=n.length;a!==o;++a)t.push(aX(n[a]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,a=n.length;r!==a;++r)t.push(Cl.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,a=[];for(let o=0;o<r;o++){let l=[],c=[];l.push((o+r-1)%r,o,(o+1)%r),c.push(0,1,0);const h=eG(l);l=Bw(l,1,h),c=Bw(c,1,h),!i&&l[0]===0&&(l.push(r),c.push(c[0])),a.push(new fd(".morphTargetInfluences["+t[o].name+"]",l,c).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],h=c.name.match(r);if(h&&h.length>1){const f=h[1];let p=i[f];p||(i[f]=p=[]),p.push(c)}}const a=[];for(const o in i)a.push(this.CreateFromMorphTargetSequence(o,i[o],t,n));return a}static parseAnimation(e,t){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(f,p,g,y,x){if(g.length!==0){const E=[],_=[];DB(g,E,_,y),E.length!==0&&x.push(new f(p,E,_))}},i=[],r=e.name||"default",a=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let f=0;f<c.length;f++){const p=c[f].keys;if(!(!p||p.length===0))if(p[0].morphTargets){const g={};let y;for(y=0;y<p.length;y++)if(p[y].morphTargets)for(let x=0;x<p[y].morphTargets.length;x++)g[p[y].morphTargets[x]]=-1;for(const x in g){const E=[],_=[];for(let b=0;b!==p[y].morphTargets.length;++b){const C=p[y];E.push(C.time),_.push(C.morphTarget===x?1:0)}i.push(new fd(".morphTargetInfluence["+x+"]",E,_))}l=g.length*a}else{const g=".bones["+t[f].name+"]";n(pd,g+".position",p,"pos",i),n(dd,g+".quaternion",p,"rot",i),n(pd,g+".scale",p,"scl",i)}}return i.length===0?null:new this(r,l,i,o)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function rX(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return fd;case"vector":case"vector2":case"vector3":case"vector4":return pd;case"color":return OB;case"quaternion":return dd;case"bool":case"boolean":return vm;case"string":return Em}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}function aX(s){if(s.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=rX(s.type);if(s.times===void 0){const t=[],n=[];DB(s.keys,t,n,"value"),s.times=t,s.values=n}return e.parse!==void 0?e.parse(s):new e(s.name,s.times,s.values,s.interpolation)}const Au={enabled:!1,files:{},add:function(s,e){this.enabled!==!1&&(this.files[s]=e)},get:function(s){if(this.enabled!==!1)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};class PB{constructor(e,t,n){const i=this;let r=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.abortController=new AbortController,this.itemStart=function(h){o++,r===!1&&i.onStart!==void 0&&i.onStart(h,a,o),r=!0},this.itemEnd=function(h){a++,i.onProgress!==void 0&&i.onProgress(h,a,o),a===o&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(h){i.onError!==void 0&&i.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,f){return c.push(h,f),this},this.removeHandler=function(h){const f=c.indexOf(h);return f!==-1&&c.splice(f,2),this},this.getHandler=function(h){for(let f=0,p=c.length;f<p;f+=2){const g=c[f],y=c[f+1];if(g.global&&(g.lastIndex=0),g.test(h))return y}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const sG=new PB;class Fs{constructor(e){this.manager=e!==void 0?e:sG,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Fs.DEFAULT_MATERIAL_NAME="__DEFAULT";const uh={};class oX extends Error{constructor(e,t){super(e),this.response=t}}class Js extends Fs{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Au.get(`file:${e}`);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(uh[e]!==void 0){uh[e].push({onLoad:t,onProgress:n,onError:i});return}uh[e]=[],uh[e].push({onLoad:t,onProgress:n,onError:i});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=uh[e],f=c.body.getReader(),p=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),g=p?parseInt(p):0,y=g!==0;let x=0;const E=new ReadableStream({start(_){b();function b(){f.read().then(({done:C,value:I})=>{if(C)_.close();else{x+=I.byteLength;const M=new ProgressEvent("progress",{lengthComputable:y,loaded:x,total:g});for(let R=0,D=h.length;R<D;R++){const P=h[R];P.onProgress&&P.onProgress(M)}_.enqueue(I),b()}},C=>{_.error(C)})}}});return new Response(E)}else throw new oX(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,o));case"json":return c.json();default:if(o==="")return c.text();{const f=/charset="?([^;"\s]*)"?/i.exec(o),p=f&&f[1]?f[1].toLowerCase():void 0,g=new TextDecoder(p);return c.arrayBuffer().then(y=>g.decode(y))}}}).then(c=>{Au.add(`file:${e}`,c);const h=uh[e];delete uh[e];for(let f=0,p=h.length;f<p;f++){const g=h[f];g.onLoad&&g.onLoad(c)}}).catch(c=>{const h=uh[e];if(h===void 0)throw this.manager.itemError(e),c;delete uh[e];for(let f=0,p=h.length;f<p;f++){const g=h[f];g.onError&&g.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class lX extends Fs{constructor(e){super(e)}load(e,t,n,i){const r=this,a=new Js(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=pm.parse(e[n]);t.push(i)}return t}}class cX extends Fs{constructor(e){super(e)}load(e,t,n,i){const r=this,a=[],o=new vd,l=new Js(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let c=0;function h(f){l.load(e[f],function(p){const g=r.parse(p,!0);a[f]={width:g.width,height:g.height,format:g.format,mipmaps:g.mipmaps},c+=1,c===6&&(g.mipmapCount===1&&(o.minFilter=Si),o.image=a,o.format=g.format,o.needsUpdate=!0,t&&t(o))},n,i)}if(Array.isArray(e))for(let f=0,p=e.length;f<p;++f)h(f);else l.load(e,function(f){const p=r.parse(f,!0);if(p.isCubemap){const g=p.mipmaps.length/p.mipmapCount;for(let y=0;y<g;y++){a[y]={mipmaps:[]};for(let x=0;x<p.mipmapCount;x++)a[y].mipmaps.push(p.mipmaps[y*p.mipmapCount+x]),a[y].format=p.format,a[y].width=p.width,a[y].height=p.height}o.image=a}else o.image.width=p.width,o.image.height=p.height,o.mipmaps=p.mipmaps;p.mipmapCount===1&&(o.minFilter=Si),o.format=p.format,o.needsUpdate=!0,t&&t(o)},n,i);return o}}const jg=new WeakMap;class Kv extends Fs{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Au.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0);else{let f=jg.get(a);f===void 0&&(f=[],jg.set(a,f)),f.push({onLoad:t,onError:i})}return a}const o=Qv("img");function l(){h(),t&&t(this);const f=jg.get(this)||[];for(let p=0;p<f.length;p++){const g=f[p];g.onLoad&&g.onLoad(this)}jg.delete(this),r.manager.itemEnd(e)}function c(f){h(),i&&i(f),Au.remove(`image:${e}`);const p=jg.get(this)||[];for(let g=0;g<p.length;g++){const y=p[g];y.onError&&y.onError(f)}jg.delete(this),r.manager.itemError(e),r.manager.itemEnd(e)}function h(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),Au.add(`image:${e}`,o),r.manager.itemStart(e),o.src=e,o}}class rG extends Fs{constructor(e){super(e)}load(e,t,n,i){const r=new mE;r.colorSpace=sa;const a=new Kv(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(e[c],function(h){r.images[c]=h,o++,o===6&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let c=0;c<e.length;++c)l(c);return r}}class NB extends Fs{constructor(e){super(e)}load(e,t,n,i){const r=this,a=new fc,o=new Js(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,function(l){let c;try{c=r.parse(l)}catch(h){if(i!==void 0)i(h);else{console.error(h);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:Ur,a.wrapT=c.wrapT!==void 0?c.wrapT:Ur,a.magFilter=c.magFilter!==void 0?c.magFilter:Si,a.minFilter=c.minFilter!==void 0?c.minFilter:Si,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=Oo),c.mipmapCount===1&&(a.minFilter=Si),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,t&&t(a,c)},n,i),a}}class bE extends Fs{constructor(e){super(e)}load(e,t,n,i){const r=new Hi,a=new Kv(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){r.image=o,r.needsUpdate=!0,t!==void 0&&t(r)},n,i),r}}class _d extends Qn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Tt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class aG extends _d{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Qn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Tt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const gI=new Pt,NO=new de,FO=new de;class FB{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new We(512,512),this.mapType=ds,this.map=null,this.mapPass=null,this.matrix=new Pt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new l0,this._frameExtents=new We(1,1),this._viewportCount=1,this._viewports=[new Tn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;NO.setFromMatrixPosition(e.matrixWorld),t.position.copy(NO),FO.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(FO),t.updateMatrixWorld(),gI.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gI,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(gI)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class uX extends FB{constructor(){super(new Ki(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=QA*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class iC extends _d{constructor(e,t,n=0,i=Math.PI/3,r=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Qn.DEFAULT_UP),this.updateMatrix(),this.target=new Qn,this.distance=n,this.angle=i,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new uX}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const UO=new Pt,zy=new de,AI=new de;class hX extends FB{constructor(){super(new Ki(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new We(4,2),this._viewportCount=6,this._viewports=[new Tn(2,1,1,1),new Tn(0,1,1,1),new Tn(3,1,1,1),new Tn(1,1,1,1),new Tn(3,0,1,1),new Tn(1,0,1,1)],this._cubeDirections=[new de(1,0,0),new de(-1,0,0),new de(0,0,1),new de(0,0,-1),new de(0,1,0),new de(0,-1,0)],this._cubeUps=[new de(0,1,0),new de(0,1,0),new de(0,1,0),new de(0,1,0),new de(0,0,1),new de(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),zy.setFromMatrixPosition(e.matrixWorld),n.position.copy(zy),AI.copy(n.position),AI.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(AI),n.updateMatrixWorld(),i.makeTranslation(-zy.x,-zy.y,-zy.z),UO.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(UO,n.coordinateSystem,n.reversedDepth)}}class Yv extends _d{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new hX}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}let Nh=class extends kT{constructor(e=-1,t=1,n=1,i=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,a=n+e,o=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,a=r+c*this.view.width,o-=h*this.view.offsetY,l=o-h*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};class fX extends FB{constructor(){super(new Nh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class sC extends _d{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Qn.DEFAULT_UP),this.updateMatrix(),this.target=new Qn,this.shadow=new fX}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class UB extends _d{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class oG extends _d{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class lG{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new de)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*r),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],1.092548*(n*i)),t.addScaledVector(a[5],1.092548*(i*r)),t.addScaledVector(a[6],.315392*(3*r*r-1)),t.addScaledVector(a[7],1.092548*(n*r)),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*i),t.addScaledVector(a[2],2*.511664*r),t.addScaledVector(a[3],2*.511664*n),t.addScaledVector(a[4],2*.429043*n*i),t.addScaledVector(a[5],2*.429043*i*r),t.addScaledVector(a[6],.743125*r*r-.247708),t.addScaledVector(a[7],2*.429043*n*r),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class cG extends _d{constructor(e=new lG,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class rC extends Fs{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,a=new Js(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const i=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new Tt().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(i.dispersion=e.dispersion),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(i.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(i.blendSrc=e.blendSrc),e.blendDst!==void 0&&(i.blendDst=e.blendDst),e.blendEquation!==void 0&&(i.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(i.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(i.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==void 0&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const a=e.uniforms[r];switch(i.uniforms[r]={},a.type){case"t":i.uniforms[r].value=n(a.value);break;case"c":i.uniforms[r].value=new Tt().setHex(a.value);break;case"v2":i.uniforms[r].value=new We().fromArray(a.value);break;case"v3":i.uniforms[r].value=new de().fromArray(a.value);break;case"v4":i.uniforms[r].value=new Tn().fromArray(a.value);break;case"m3":i.uniforms[r].value=new un().fromArray(a.value);break;case"m4":i.uniforms[r].value=new Pt().fromArray(a.value);break;default:i.uniforms[r].value=a.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)i.extensions[r]=e.extensions[r];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),i.normalScale=new We().fromArray(r)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapRotation!==void 0&&i.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new We().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return rC.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:Kk,SpriteMaterial:yB,RawShaderMaterial:Yk,ShaderMaterial:Ra,PointsMaterial:$f,MeshPhysicalMaterial:Tl,MeshStandardMaterial:SE,MeshPhongMaterial:SA,MeshToonMaterial:Xk,MeshNormalMaterial:Wk,MeshLambertMaterial:RB,MeshDepthMaterial:nC,MeshDistanceMaterial:BB,MeshBasicMaterial:io,MeshMatcapMaterial:$k,LineDashedMaterial:Jk,LineBasicMaterial:$s,Material:Ps};return new t[e]}}class Ih{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class uG extends hn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class hG extends Fs{constructor(e){super(e)}load(e,t,n,i){const r=this,a=new Js(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(g,y){if(t[y]!==void 0)return t[y];const E=g.interleavedBuffers[y],_=r(g,E.buffer),b=aA(E.type,_),C=new gE(b,E.stride);return C.uuid=E.uuid,t[y]=C,C}function r(g,y){if(n[y]!==void 0)return n[y];const E=g.arrayBuffers[y],_=new Uint32Array(E).buffer;return n[y]=_,_}const a=e.isInstancedBufferGeometry?new uG:new hn,o=e.data.index;if(o!==void 0){const g=aA(o.type,o.array);a.setIndex(new ei(g,1))}const l=e.data.attributes;for(const g in l){const y=l[g];let x;if(y.isInterleavedBufferAttribute){const E=i(e.data,y.data);x=new hd(E,y.itemSize,y.offset,y.normalized)}else{const E=aA(y.type,y.array),_=y.isInstancedBufferAttribute?fm:ei;x=new _(E,y.itemSize,y.normalized)}y.name!==void 0&&(x.name=y.name),y.usage!==void 0&&x.setUsage(y.usage),a.setAttribute(g,x)}const c=e.data.morphAttributes;if(c)for(const g in c){const y=c[g],x=[];for(let E=0,_=y.length;E<_;E++){const b=y[E];let C;if(b.isInterleavedBufferAttribute){const I=i(e.data,b.data);C=new hd(I,b.itemSize,b.offset,b.normalized)}else{const I=aA(b.type,b.array);C=new ei(I,b.itemSize,b.normalized)}b.name!==void 0&&(C.name=b.name),x.push(C)}a.morphAttributes[g]=x}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const f=e.data.groups||e.data.drawcalls||e.data.offsets;if(f!==void 0)for(let g=0,y=f.length;g!==y;++g){const x=f[g];a.addGroup(x.start,x.count,x.materialIndex)}const p=e.data.boundingSphere;return p!==void 0&&(a.boundingSphere=new Sr().fromJSON(p)),e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class dX extends Fs{constructor(e){super(e)}load(e,t,n,i){const r=this,a=this.path===""?Ih.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new Js(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(f){i!==void 0&&i(f),console.error("THREE:ObjectLoader: Can't parse "+e+".",f.message);return}const h=c.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(c,t)},n,i)}async loadAsync(e,t){const n=this,i=this.path===""?Ih.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const r=new Js(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const a=await r.loadAsync(e,t),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,function(){t!==void 0&&t(c)}),o=this.parseTextures(e.textures,a),l=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,r,l,o,n),h=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,h),this.bindLightTargets(c),t!==void 0){let f=!1;for(const p in a)if(a[p].data instanceof HTMLImageElement){f=!0;break}f===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,i,o,a,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(e){const t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){const r=new id().fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(r){r.isBone&&(i[r.uuid]=r)}),e!==void 0)for(let r=0,a=e.length;r<a;r++){const o=new o0().fromJSON(e[r],i);n[o.uuid]=o}return n}parseGeometries(e,t){const n={};if(e!==void 0){const i=new hG;for(let r=0,a=e.length;r<a;r++){let o;const l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(l);break;default:l.type in PO?o=PO[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),n[l.uuid]=o}}return n}parseMaterials(e,t){const n={},i={};if(e!==void 0){const r=new rC;r.setTextures(t);for(let a=0,o=e.length;a<o;a++){const l=e[a];n[l.uuid]===void 0&&(n[l.uuid]=r.parse(l)),i[l.uuid]=n[l.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const i=e[n],r=pm.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function a(l){return n.manager.itemStart(l),r.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return a(h)}else return l.data?{data:aA(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new PB(t);r=new Kv(l),r.setCrossOrigin(this.crossOrigin);for(let c=0,h=e.length;c<h;c++){const f=e[c],p=f.url;if(Array.isArray(p)){const g=[];for(let y=0,x=p.length;y<x;y++){const E=p[y],_=o(E);_!==null&&(_ instanceof HTMLImageElement?g.push(_):g.push(new fc(_.data,_.width,_.height)))}i[f.uuid]=new Wf(g)}else{const g=o(f.url);i[f.uuid]=new Wf(g)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o;return await i.loadAsync(l)}else return a.data?{data:aA(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){i=new Kv(this.manager),i.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const l=e[a],c=l.url;if(Array.isArray(c)){const h=[];for(let f=0,p=c.length;f<p;f++){const g=c[f],y=await r(g);y!==null&&(y instanceof HTMLImageElement?h.push(y):h.push(new fc(y.data,y.width,y.height)))}n[l.uuid]=new Wf(h)}else{const h=await r(l.url);n[l.uuid]=new Wf(h)}}}return n}parseTextures(e,t){function n(r,a){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),a[r])}const i={};if(e!==void 0)for(let r=0,a=e.length;r<a;r++){const o=e[r];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),t[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=t[o.image],c=l.data;let h;Array.isArray(c)?(h=new mE,c.length===6&&(h.needsUpdate=!0)):(c&&c.data?h=new fc:h=new Hi,c&&(h.needsUpdate=!0)),h.source=l,h.uuid=o.uuid,o.name!==void 0&&(h.name=o.name),o.mapping!==void 0&&(h.mapping=n(o.mapping,pX)),o.channel!==void 0&&(h.channel=o.channel),o.offset!==void 0&&h.offset.fromArray(o.offset),o.repeat!==void 0&&h.repeat.fromArray(o.repeat),o.center!==void 0&&h.center.fromArray(o.center),o.rotation!==void 0&&(h.rotation=o.rotation),o.wrap!==void 0&&(h.wrapS=n(o.wrap[0],kO),h.wrapT=n(o.wrap[1],kO)),o.format!==void 0&&(h.format=o.format),o.internalFormat!==void 0&&(h.internalFormat=o.internalFormat),o.type!==void 0&&(h.type=o.type),o.colorSpace!==void 0&&(h.colorSpace=o.colorSpace),o.minFilter!==void 0&&(h.minFilter=n(o.minFilter,GO)),o.magFilter!==void 0&&(h.magFilter=n(o.magFilter,GO)),o.anisotropy!==void 0&&(h.anisotropy=o.anisotropy),o.flipY!==void 0&&(h.flipY=o.flipY),o.generateMipmaps!==void 0&&(h.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(h.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(h.compareFunction=o.compareFunction),o.userData!==void 0&&(h.userData=o.userData),i[o.uuid]=h}return i}parseObject(e,t,n,i,r){let a;function o(p){return t[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",p),t[p]}function l(p){if(p!==void 0){if(Array.isArray(p)){const g=[];for(let y=0,x=p.length;y<x;y++){const E=p[y];n[E]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",E),g.push(n[E])}return g}return n[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",p),n[p]}}function c(p){return i[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",p),i[p]}let h,f;switch(e.type){case"Scene":a=new zT,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new Tt(e.background):a.background=c(e.background)),e.environment!==void 0&&(a.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new HT(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new GT(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new Ki(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Nh(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new UB(e.color,e.intensity);break;case"DirectionalLight":a=new sC(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new Yv(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new oG(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new iC(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new aG(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new cG().fromJSON(e);break;case"SkinnedMesh":h=o(e.geometry),f=l(e.material),a=new AE(h,f),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":h=o(e.geometry),f=l(e.material),a=new bi(h,f);break;case"InstancedMesh":h=o(e.geometry),f=l(e.material);const p=e.count,g=e.instanceMatrix,y=e.instanceColor;a=new vB(h,f,p),a.instanceMatrix=new fm(new Float32Array(g.array),16),y!==void 0&&(a.instanceColor=new fm(new Float32Array(y.array),y.itemSize));break;case"BatchedMesh":h=o(e.geometry),f=l(e.material),a=new Nk(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,f),a.geometry=h,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(x=>{let E=null,_=null;return x.boundingBox!==void 0&&(E=new kr().fromJSON(x.boundingBox)),x.boundingSphere!==void 0&&(_=new Sr().fromJSON(x.boundingSphere)),{...x,boundingBox:E,boundingSphere:_}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=c(e.matricesTexture.uuid),a._indirectTexture=c(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=c(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(a.boundingSphere=new Sr().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(a.boundingBox=new kr().fromJSON(e.boundingBox));break;case"LOD":a=new Pk;break;case"Line":a=new Iu(o(e.geometry),l(e.material));break;case"LineLoop":a=new EB(o(e.geometry),l(e.material));break;case"LineSegments":a=new Go(o(e.geometry),l(e.material));break;case"PointCloud":case"Points":a=new _A(o(e.geometry),l(e.material));break;case"Sprite":a=new Ok(l(e.material));break;case"Group":a=new so;break;case"Bone":a=new qA;break;default:a=new Qn}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const p=e.children;for(let g=0;g<p.length;g++)a.add(this.parseObject(p[g],t,n,i,r))}if(e.animations!==void 0){const p=e.animations;for(let g=0;g<p.length;g++){const y=p[g];a.animations.push(r[y])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const p=e.levels;for(let g=0;g<p.length;g++){const y=p[g],x=a.getObjectByProperty("uuid",y.object);x!==void 0&&a.addLevel(x,y.distance,y.hysteresis)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const i=t[n.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,i=e.getObjectByProperty("uuid",n);i!==void 0?t.target=i:t.target=new Qn}})}}const pX={UVMapping:IT,CubeReflectionMapping:Tu,CubeRefractionMapping:cd,EquirectangularReflectionMapping:LA,EquirectangularRefractionMapping:Lv,CubeUVReflectionMapping:r0},kO={RepeatWrapping:Cu,ClampToEdgeWrapping:Ur,MirroredRepeatWrapping:OA},GO={NearestFilter:Ws,NearestMipmapNearestFilter:MT,NearestMipmapLinearFilter:Vp,LinearFilter:Si,LinearMipmapNearestFilter:gA,LinearMipmapLinearFilter:Oo},yI=new WeakMap;class fG extends Fs{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Au.get(`image-bitmap:${e}`);if(a!==void 0){if(r.manager.itemStart(e),a.then){a.then(c=>{if(yI.has(a)===!0)i&&i(yI.get(a)),r.manager.itemError(e),r.manager.itemEnd(e);else return t&&t(c),r.manager.itemEnd(e),c});return}return setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const l=fetch(e,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return Au.add(`image-bitmap:${e}`,c),t&&t(c),r.manager.itemEnd(e),c}).catch(function(c){i&&i(c),yI.set(l,c),Au.remove(`image-bitmap:${e}`),r.manager.itemError(e),r.manager.itemEnd(e)});Au.add(`image-bitmap:${e}`,l),r.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let cS;class kB{static getContext(){return cS===void 0&&(cS=new(window.AudioContext||window.webkitAudioContext)),cS}static setContext(e){cS=e}}class dG extends Fs{constructor(e){super(e)}load(e,t,n,i){const r=this,a=new Js(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{const c=l.slice(0);kB.getContext().decodeAudioData(c,function(f){t(f)}).catch(o)}catch(c){o(c)}},n,i);function o(l){i?i(l):console.error(l),r.manager.itemError(e)}}}const HO=new Pt,zO=new Pt,bp=new Pt;class mX{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ki,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ki,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,bp.copy(e.projectionMatrix);const i=t.eyeSep/2,r=i*t.near/t.focus,a=t.near*Math.tan(im*t.fov*.5)/t.zoom;let o,l;zO.elements[12]=-i,HO.elements[12]=i,o=-a*t.aspect+r,l=a*t.aspect+r,bp.elements[0]=2*t.near/(l-o),bp.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(bp),o=-a*t.aspect-r,l=a*t.aspect-r,bp.elements[0]=2*t.near/(l-o),bp.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(bp)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(zO),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(HO)}}class pG extends Ki{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}let TE=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};const Tp=new de,vI=new Xs,gX=new de,Cp=new de,Ip=new de;class AX extends Qn{constructor(){super(),this.type="AudioListener",this.context=kB.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new TE}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Tp,vI,gX),Cp.set(0,0,-1).applyQuaternion(vI),Ip.set(0,1,0).applyQuaternion(vI),t.positionX){const n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Tp.x,n),t.positionY.linearRampToValueAtTime(Tp.y,n),t.positionZ.linearRampToValueAtTime(Tp.z,n),t.forwardX.linearRampToValueAtTime(Cp.x,n),t.forwardY.linearRampToValueAtTime(Cp.y,n),t.forwardZ.linearRampToValueAtTime(Cp.z,n),t.upX.linearRampToValueAtTime(Ip.x,n),t.upY.linearRampToValueAtTime(Ip.y,n),t.upZ.linearRampToValueAtTime(Ip.z,n)}else t.setPosition(Tp.x,Tp.y,Tp.z),t.setOrientation(Cp.x,Cp.y,Cp.z,Ip.x,Ip.y,Ip.z)}}class mG extends Qn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Mp=new de,QO=new Xs,yX=new de,wp=new de;class vX extends mG{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Mp,QO,yX),wp.set(0,0,1).applyQuaternion(QO);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Mp.x,n),t.positionY.linearRampToValueAtTime(Mp.y,n),t.positionZ.linearRampToValueAtTime(Mp.z,n),t.orientationX.linearRampToValueAtTime(wp.x,n),t.orientationY.linearRampToValueAtTime(wp.y,n),t.orientationZ.linearRampToValueAtTime(wp.z,n)}else t.setPosition(Mp.x,Mp.y,Mp.z),t.setOrientation(wp.x,wp.y,wp.z)}}class EX{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class gG{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,r,a;switch(t){case"quaternion":i=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==i;++o)n[r+o]=n[o];a=t}else{a+=t;const o=t/a;this._mixBufferRegion(n,r,0,o,i)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=t*this._origIndex;this._mixBufferRegion(n,i,l,1-r,t)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){o.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,a=i;r!==a;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let a=0;a!==r;++a)e[t+a]=e[n+a]}_slerp(e,t,n,i){Xs.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const a=this._workIndex*r;Xs.multiplyQuaternionsFlat(e,a,e,t,e,n),Xs.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,n,i,r){const a=1-i;for(let o=0;o!==r;++o){const l=t+o;e[l]=e[l]*a+e[n+o]*i}}_lerpAdditive(e,t,n,i,r){for(let a=0;a!==r;++a){const o=t+a;e[o]=e[o]+e[n+a]*i}}}const GB="\\[\\]\\.:\\/",xX=new RegExp("["+GB+"]","g"),HB="[^"+GB+"]",_X="[^"+GB.replace("\\.","")+"]",SX=/((?:WC+[\/:])*)/.source.replace("WC",HB),bX=/(WCOD+)?/.source.replace("WCOD",_X),TX=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",HB),CX=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",HB),IX=new RegExp("^"+SX+bX+TX+CX+"$"),MX=["material","materials","bones","map"];class wX{constructor(e,t,n){const i=n||zn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class zn{constructor(e,t,n){this.path=t,this.parsedPath=n||zn.parseTrackName(t),this.node=zn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new zn.Composite(e,t,n):new zn(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(xX,"")}static parseTrackName(e){const t=IX.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const r=n.nodeName.substring(i+1);MX.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(r){for(let a=0;a<r.length;a++){const o=r[a];if(o.name===t||o.uuid===t)return o;const l=n(o.children);if(l)return l}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=zn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[i];if(a===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}zn.Composite=wX;zn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};zn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};zn.prototype.GetterByBindingType=[zn.prototype._getValue_direct,zn.prototype._getValue_array,zn.prototype._getValue_arrayElement,zn.prototype._getValue_toArray];zn.prototype.SetterByBindingTypeAndVersioning=[[zn.prototype._setValue_direct,zn.prototype._setValue_direct_setNeedsUpdate,zn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[zn.prototype._setValue_array,zn.prototype._setValue_array_setNeedsUpdate,zn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[zn.prototype._setValue_arrayElement,zn.prototype._setValue_arrayElement_setNeedsUpdate,zn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[zn.prototype._setValue_fromArray,zn.prototype._setValue_fromArray_setNeedsUpdate,zn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class RX{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Uo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,a=r.length;let o,l=e.length,c=this.nCachedObjects_;for(let h=0,f=arguments.length;h!==f;++h){const p=arguments[h],g=p.uuid;let y=t[g];if(y===void 0){y=l++,t[g]=y,e.push(p);for(let x=0,E=a;x!==E;++x)r[x].push(new zn(p,n[x],i[x]))}else if(y<c){o=e[y];const x=--c,E=e[x];t[E.uuid]=y,e[y]=E,t[g]=x,e[x]=p;for(let _=0,b=a;_!==b;++_){const C=r[_],I=C[x];let M=C[y];C[y]=I,M===void 0&&(M=new zn(p,n[_],i[_])),C[x]=M}}else e[y]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,h=t[c];if(h!==void 0&&h>=r){const f=r++,p=e[f];t[p.uuid]=h,e[h]=p,t[c]=f,e[f]=l;for(let g=0,y=i;g!==y;++g){const x=n[g],E=x[f],_=x[h];x[h]=E,x[f]=_}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,a=e.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],h=c.uuid,f=t[h];if(f!==void 0)if(delete t[h],f<r){const p=--r,g=e[p],y=--a,x=e[y];t[g.uuid]=f,e[f]=g,t[x.uuid]=p,e[p]=x,e.pop();for(let E=0,_=i;E!==_;++E){const b=n[E],C=b[p],I=b[y];b[f]=C,b[p]=I,b.pop()}}else{const p=--a,g=e[p];p>0&&(t[g.uuid]=f),e[f]=g,e.pop();for(let y=0,x=i;y!==x;++y){const E=n[y];E[f]=E[p],E.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(i!==void 0)return r[i];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,h=this.nCachedObjects_,f=new Array(c);i=r.length,n[e]=i,a.push(e),o.push(t),r.push(f);for(let p=h,g=l.length;p!==g;++p){const y=l[p];f[p]=new zn(y,e,t)}return f}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const i=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=e[o];t[c]=n,a[n]=l,a.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}class AG{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,a=r.length,o=new Array(a),l={endingStart:jp,endingEnd:jp};for(let c=0;c!==a;++c){const h=r[c].createInterpolant(null);o[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=dk,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),n===!0){const i=this._clip.duration,r=e._clip.duration,a=r/i,o=i/r;e.warp(1,a,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=r,l[1]=r+n,c[0]=e/a,c[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*n;l<0||n===0?t=0:(this._startTime=null,t=n*l)}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case hB:for(let h=0,f=l.length;h!==f;++h)l[h].evaluate(a),c[h].accumulateAdditive(o);break;case OT:default:for(let h=0,f=l.length;h!==f;++h)l[h].evaluate(a),c[h].accumulate(i,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const a=n===pk;if(e===0)return r===-1?i:a&&(r&1)===1?t-i:i;if(n===fk){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),i>=t||i<0){const o=Math.floor(i/t);i-=t*o,r+=Math.abs(o);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&(r&1)===1)return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=qp,i.endingEnd=qp):(e?i.endingStart=this.zeroSlopeAtStart?qp:jp:i.endingStart=Gv,t?i.endingEnd=this.zeroSlopeAtEnd?qp:jp:i.endingEnd=Gv)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let a=this._weightInterpolant;a===null&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,l[0]=t,o[1]=r+e,l[1]=n,this}}const BX=new Float32Array(1);class DX extends Bu{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,o=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let f=0;f!==r;++f){const p=i[f],g=p.name;let y=h[g];if(y!==void 0)++y.referenceCount,a[f]=y;else{if(y=a[f],y!==void 0){y._cacheIndex===null&&(++y.referenceCount,this._addInactiveBinding(y,l,g));continue}const x=t&&t._propertyBindings[f].binding.parsedPath;y=new gG(zn.create(n,g,x),p.ValueTypeName,p.getValueSize()),++y.referenceCount,this._addInactiveBinding(y,l,g),a[f]=y}o[f].resultBuffer=y.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let a=r[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,a=this._actionsByClip,o=a[r],l=o.knownActions,c=l[l.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),e._byClipCacheIndex=null;const f=o.actionByRoot,p=(e._localRoot||this._root).uuid;delete f[p],l.length===0&&delete a[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let a=i[t];a===void 0&&(a={},i[t]=a),a[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete o[r],Object.keys(o).length===0&&delete a[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new LB(new Float32Array(2),new Float32Array(2),1,BX),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let a=typeof e=="string"?pm.findByName(i,e):e;const o=a!==null?a.uuid:e,l=this._actionsByClip[o];let c=null;if(n===void 0&&(a!==null?n=a.blendMode:n=OT),l!==void 0){const f=l.actionByRoot[r];if(f!==void 0&&f.blendMode===n)return f;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const h=new AG(this,a,t,n);return this._bindAction(h,c),this._addInactiveAction(h,o,r),h}existingAction(e,t){const n=t||this._root,i=n.uuid,r=typeof e=="string"?pm.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(i,e,r,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(r!==void 0){const a=r.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const h=c._cacheIndex,f=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,f._cacheIndex=h,t[h]=f,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const a in n){const o=n[a].actionByRoot,l=o[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const i=this._bindingsByRootAndName,r=i[t];if(r!==void 0)for(const a in r){const o=r[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class LX extends gB{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isRenderTarget3D=!0,this.depth=n,this.texture=new NT(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class zB{constructor(e){this.value=e}clone(){return new zB(this.value.clone===void 0?this.value:this.value.clone())}}let OX=0;class PX extends Bu{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:OX++}),this.name="",this.usage=zv,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++){const r=Array.isArray(t[n])?t[n]:[t[n]];for(let a=0;a<r.length;a++)this.uniforms.push(r[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class NX extends gE{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class FX{constructor(e,t,n,i,r,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.normalized=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const VO=new Pt;class QB{constructor(e,t,n=0,i=1/0){this.ray=new a0(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new VA,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return VO.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(VO),this}intersectObject(e,t=!0,n=[]){return Dw(e,this,n,t),n.sort(jO),n}intersectObjects(e,t=!0,n=[]){for(let i=0,r=e.length;i<r;i++)Dw(e[i],this,n,t);return n.sort(jO),n}}function jO(s,e){return s.distance-e.distance}function Dw(s,e,t,n){let i=!0;if(s.layers.test(e.layers)&&s.raycast(e,t)===!1&&(i=!1),i===!0&&n===!0){const r=s.children;for(let a=0,o=r.length;a<o;a++)Dw(r[a],e,t,!0)}}class UX{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=kX.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function kX(){this._document.hidden===!1&&this.reset()}class GX{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=pn(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(pn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class HX{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}class VB{constructor(e,t,n,i){VB.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const r=this.elements;return r[0]=e,r[2]=t,r[1]=n,r[3]=i,this}}const qO=new We;class yG{constructor(e=new We(1/0,1/0),t=new We(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=qO.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,qO).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const KO=new de,uS=new de,qg=new de,Kg=new de,EI=new de,zX=new de,QX=new de;class VX{constructor(e=new de,t=new de){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){KO.subVectors(e,this.start),uS.subVectors(this.end,this.start);const n=uS.dot(uS);let r=uS.dot(KO)/n;return t&&(r=pn(r,0,1)),r}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}distanceSqToLine3(e,t=zX,n=QX){const i=10000000000000001e-32;let r,a;const o=this.start,l=e.start,c=this.end,h=e.end;qg.subVectors(c,o),Kg.subVectors(h,l),EI.subVectors(o,l);const f=qg.dot(qg),p=Kg.dot(Kg),g=Kg.dot(EI);if(f<=i&&p<=i)return t.copy(o),n.copy(l),t.sub(n),t.dot(t);if(f<=i)r=0,a=g/p,a=pn(a,0,1);else{const y=qg.dot(EI);if(p<=i)a=0,r=pn(-y/f,0,1);else{const x=qg.dot(Kg),E=f*p-x*x;E!==0?r=pn((x*g-y*p)/E,0,1):r=0,a=(x*r+g)/p,a<0?(a=0,r=pn(-y/f,0,1)):a>1&&(a=1,r=pn((x-y)/f,0,1))}}return t.copy(o).add(qg.multiplyScalar(r)),n.copy(l).add(Kg.multiplyScalar(a)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const YO=new de;class jX extends Qn{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new hn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,h=o/l*Math.PI*2;i.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}n.setAttribute("position",new Bt(i,3));const r=new $s({fog:!1,toneMapped:!1});this.cone=new Go(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),YO.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(YO),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Uf=new de,hS=new Pt,xI=new Pt;class qX extends Go{constructor(e){const t=vG(e),n=new hn,i=[],r=[];for(let c=0;c<t.length;c++){const h=t[c];h.parent&&h.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(0,0,0),r.push(0,0,0))}n.setAttribute("position",new Bt(i,3)),n.setAttribute("color",new Bt(r,3));const a=new $s({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,a),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const o=new Tt(255),l=new Tt(65280);this.setColors(o,l)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");xI.copy(this.root.matrixWorld).invert();for(let r=0,a=0;r<t.length;r++){const o=t[r];o.parent&&o.parent.isBone&&(hS.multiplyMatrices(xI,o.matrixWorld),Uf.setFromMatrixPosition(hS),i.setXYZ(a,Uf.x,Uf.y,Uf.z),hS.multiplyMatrices(xI,o.parent.matrixWorld),Uf.setFromMatrixPosition(hS),i.setXYZ(a+1,Uf.x,Uf.y,Uf.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const i=this.geometry.getAttribute("color");for(let r=0;r<i.count;r+=2)i.setXYZ(r,e.r,e.g,e.b),i.setXYZ(r+1,t.r,t.g,t.b);return i.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function vG(s){const e=[];s.isBone===!0&&e.push(s);for(let t=0;t<s.children.length;t++)e.push(...vG(s.children[t]));return e}class KX extends bi{constructor(e,t,n){const i=new _E(t,4,2),r=new io({wireframe:!0,fog:!1,toneMapped:!1});super(i,r),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const YX=new de,XO=new Tt,WO=new Tt;class XX extends Qn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new xE(t);i.rotateY(Math.PI*.5),this.material=new io({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),a=new Float32Array(r.count*3);i.setAttribute("color",new ei(a,3)),this.add(new bi(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");XO.copy(this.light.color),WO.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const r=n<i/2?XO:WO;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(YX.setFromMatrixPosition(this.light.matrixWorld).negate())}}class WX extends Go{constructor(e=10,t=10,n=4473924,i=8947848){n=new Tt(n),i=new Tt(i);const r=t/2,a=e/t,o=e/2,l=[],c=[];for(let p=0,g=0,y=-o;p<=t;p++,y+=a){l.push(-o,0,y,o,0,y),l.push(y,0,-o,y,0,o);const x=p===r?n:i;x.toArray(c,g),g+=3,x.toArray(c,g),g+=3,x.toArray(c,g),g+=3,x.toArray(c,g),g+=3}const h=new hn;h.setAttribute("position",new Bt(l,3)),h.setAttribute("color",new Bt(c,3));const f=new $s({vertexColors:!0,toneMapped:!1});super(h,f),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class $X extends Go{constructor(e=10,t=16,n=8,i=64,r=4473924,a=8947848){r=new Tt(r),a=new Tt(a);const o=[],l=[];if(t>1)for(let f=0;f<t;f++){const p=f/t*(Math.PI*2),g=Math.sin(p)*e,y=Math.cos(p)*e;o.push(0,0,0),o.push(g,0,y);const x=f&1?r:a;l.push(x.r,x.g,x.b),l.push(x.r,x.g,x.b)}for(let f=0;f<n;f++){const p=f&1?r:a,g=e-e/n*f;for(let y=0;y<i;y++){let x=y/i*(Math.PI*2),E=Math.sin(x)*g,_=Math.cos(x)*g;o.push(E,0,_),l.push(p.r,p.g,p.b),x=(y+1)/i*(Math.PI*2),E=Math.sin(x)*g,_=Math.cos(x)*g,o.push(E,0,_),l.push(p.r,p.g,p.b)}}const c=new hn;c.setAttribute("position",new Bt(o,3)),c.setAttribute("color",new Bt(l,3));const h=new $s({vertexColors:!0,toneMapped:!1});super(c,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const $O=new de,fS=new de,JO=new de;class JX extends Qn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let i=new hn;i.setAttribute("position",new Bt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new $s({fog:!1,toneMapped:!1});this.lightPlane=new Iu(i,r),this.add(this.lightPlane),i=new hn,i.setAttribute("position",new Bt([0,0,0,0,0,1],3)),this.targetLine=new Iu(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),$O.setFromMatrixPosition(this.light.matrixWorld),fS.setFromMatrixPosition(this.light.target.matrixWorld),JO.subVectors(fS,$O),this.lightPlane.lookAt(fS),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(fS),this.targetLine.scale.z=JO.length()}}const dS=new de,xs=new kT;class ZX extends Go{constructor(e){const t=new hn,n=new $s({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(y,x){l(y),l(x)}function l(y){i.push(0,0,0),r.push(0,0,0),a[y]===void 0&&(a[y]=[]),a[y].push(i.length/3-1)}t.setAttribute("position",new Bt(i,3)),t.setAttribute("color",new Bt(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new Tt(16755200),h=new Tt(16711680),f=new Tt(43775),p=new Tt(16777215),g=new Tt(3355443);this.setColors(c,h,f,p,g)}setColors(e,t,n,i,r){const o=this.geometry.getAttribute("color");return o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,n.r,n.g,n.b),o.setXYZ(33,n.r,n.g,n.b),o.setXYZ(34,n.r,n.g,n.b),o.setXYZ(35,n.r,n.g,n.b),o.setXYZ(36,n.r,n.g,n.b),o.setXYZ(37,n.r,n.g,n.b),o.setXYZ(38,i.r,i.g,i.b),o.setXYZ(39,i.r,i.g,i.b),o.setXYZ(40,r.r,r.g,r.b),o.setXYZ(41,r.r,r.g,r.b),o.setXYZ(42,r.r,r.g,r.b),o.setXYZ(43,r.r,r.g,r.b),o.setXYZ(44,r.r,r.g,r.b),o.setXYZ(45,r.r,r.g,r.b),o.setXYZ(46,r.r,r.g,r.b),o.setXYZ(47,r.r,r.g,r.b),o.setXYZ(48,r.r,r.g,r.b),o.setXYZ(49,r.r,r.g,r.b),o.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap,n=1,i=1;let r,a;if(xs.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)r=1,a=0;else if(this.camera.coordinateSystem===Po)r=-1,a=1;else if(this.camera.coordinateSystem===zA)r=0,a=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);Bs("c",t,e,xs,0,0,r),Bs("t",t,e,xs,0,0,a),Bs("n1",t,e,xs,-n,-i,r),Bs("n2",t,e,xs,n,-i,r),Bs("n3",t,e,xs,-n,i,r),Bs("n4",t,e,xs,n,i,r),Bs("f1",t,e,xs,-n,-i,a),Bs("f2",t,e,xs,n,-i,a),Bs("f3",t,e,xs,-n,i,a),Bs("f4",t,e,xs,n,i,a),Bs("u1",t,e,xs,n*.7,i*1.1,r),Bs("u2",t,e,xs,-n*.7,i*1.1,r),Bs("u3",t,e,xs,0,i*2,r),Bs("cf1",t,e,xs,-n,0,a),Bs("cf2",t,e,xs,n,0,a),Bs("cf3",t,e,xs,0,-i,a),Bs("cf4",t,e,xs,0,i,a),Bs("cn1",t,e,xs,-n,0,r),Bs("cn2",t,e,xs,n,0,r),Bs("cn3",t,e,xs,0,-i,r),Bs("cn4",t,e,xs,0,i,r),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Bs(s,e,t,n,i,r,a){dS.set(i,r,a).unproject(n);const o=e[s];if(o!==void 0){const l=t.getAttribute("position");for(let c=0,h=o.length;c<h;c++)l.setXYZ(o[c],dS.x,dS.y,dS.z)}}const pS=new kr;class eW extends Go{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new hn;r.setIndex(new ei(n,1)),r.setAttribute("position",new ei(i,3)),super(r,new $s({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&pS.setFromObject(this.object),pS.isEmpty())return;const e=pS.min,t=pS.max,n=this.geometry.attributes.position,i=n.array;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class tW extends Go{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new hn;r.setIndex(new ei(n,1)),r.setAttribute("position",new Bt(i,3)),super(r,new $s({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class nW extends Iu{constructor(e,t=1,n=16776960){const i=n,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new hn;a.setAttribute("position",new Bt(r,3)),a.computeBoundingSphere(),super(a,new $s({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new hn;l.setAttribute("position",new Bt(o,3)),l.computeBoundingSphere(),this.add(new bi(l,new io({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const ZO=new de;let mS,_I;class iW extends Qn{constructor(e=new de(0,0,1),t=new de(0,0,0),n=1,i=16776960,r=n*.2,a=r*.2){super(),this.type="ArrowHelper",mS===void 0&&(mS=new hn,mS.setAttribute("position",new Bt([0,0,0,0,1,0],3)),_I=new vE(.5,1,5,1),_I.translate(0,-.5,0)),this.position.copy(t),this.line=new Iu(mS,new $s({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new bi(_I,new io({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{ZO.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(ZO,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class sW extends Go{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new hn;i.setAttribute("position",new Bt(t,3)),i.setAttribute("color",new Bt(n,3));const r=new $s({vertexColors:!0,toneMapped:!1});super(i,r),this.type="AxesHelper"}setColors(e,t,n){const i=new Tt,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class yh{constructor(){this.type="ShapePath",this.color=new Tt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new sm,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,a){return this.currentPath.bezierCurveTo(e,t,n,i,r,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(_){const b=[];for(let C=0,I=_.length;C<I;C++){const M=_[C],R=new id;R.curves=M.curves,b.push(R)}return b}function n(_,b){const C=b.length;let I=!1;for(let M=C-1,R=0;R<C;M=R++){let D=b[M],P=b[R],L=P.x-D.x,O=P.y-D.y;if(Math.abs(O)>Number.EPSILON){if(O<0&&(D=b[R],L=-L,P=b[M],O=-O),_.y<D.y||_.y>P.y)continue;if(_.y===D.y){if(_.x===D.x)return!0}else{const U=O*(_.x-D.x)-L*(_.y-D.y);if(U===0)return!0;if(U<0)continue;I=!I}}else{if(_.y!==D.y)continue;if(P.x<=_.x&&_.x<=D.x||D.x<=_.x&&_.x<=P.x)return!0}}return I}const i=Al.isClockWise,r=this.subPaths;if(r.length===0)return[];let a,o,l;const c=[];if(r.length===1)return o=r[0],l=new id,l.curves=o.curves,c.push(l),c;let h=!i(r[0].getPoints());h=e?!h:h;const f=[],p=[];let g=[],y=0,x;p[y]=void 0,g[y]=[];for(let _=0,b=r.length;_<b;_++)o=r[_],x=o.getPoints(),a=i(x),a=e?!a:a,a?(!h&&p[y]&&y++,p[y]={s:new id,p:x},p[y].s.curves=o.curves,h&&y++,g[y]=[]):g[y].push({h:o,p:x[0]});if(!p[0])return t(r);if(p.length>1){let _=!1,b=0;for(let C=0,I=p.length;C<I;C++)f[C]=[];for(let C=0,I=p.length;C<I;C++){const M=g[C];for(let R=0;R<M.length;R++){const D=M[R];let P=!0;for(let L=0;L<p.length;L++)n(D.p,p[L].p)&&(C!==L&&b++,P?(P=!1,f[L].push(D)):_=!0);P&&f[C].push(D)}}b>0&&_===!1&&(g=f)}let E;for(let _=0,b=p.length;_<b;_++){l=p[_].s,c.push(l),E=g[_];for(let C=0,I=E.length;C<I;C++)l.holes.push(E[C].h)}return c}}class rW extends Bu{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function aW(s,e){const t=s.image&&s.image.width?s.image.width/s.image.height:1;return t>e?(s.repeat.x=1,s.repeat.y=t/e,s.offset.x=0,s.offset.y=(1-s.repeat.y)/2):(s.repeat.x=e/t,s.repeat.y=1,s.offset.x=(1-s.repeat.x)/2,s.offset.y=0),s}function oW(s,e){const t=s.image&&s.image.width?s.image.width/s.image.height:1;return t>e?(s.repeat.x=e/t,s.repeat.y=1,s.offset.x=(1-s.repeat.x)/2,s.offset.y=0):(s.repeat.x=1,s.repeat.y=t/e,s.offset.x=0,s.offset.y=(1-s.repeat.y)/2),s}function lW(s){return s.repeat.x=1,s.repeat.y=1,s.offset.x=0,s.offset.y=0,s}function Lw(s,e,t,n){const i=cW(n);switch(t){case lB:return s*e;case gu:return s*e/i.components*i.byteLength;case pE:return s*e/i.components*i.byteLength;case Xf:return s*e*2/i.components*i.byteLength;case DT:return s*e*2/i.components*i.byteLength;case cB:return s*e*3/i.components*i.byteLength;case rs:return s*e*4/i.components*i.byteLength;case LT:return s*e*4/i.components*i.byteLength;case AA:case fv:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case dv:case yA:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case Rb:case Bb:return Math.max(s,16)*Math.max(e,8)/4;case Ov:case Pv:return Math.max(s,8)*Math.max(e,8)/2;case Nv:case Fv:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case Uv:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case kv:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case Db:return Math.floor((s+4)/5)*Math.floor((e+3)/4)*16;case Lb:return Math.floor((s+4)/5)*Math.floor((e+4)/5)*16;case Ob:return Math.floor((s+5)/6)*Math.floor((e+4)/5)*16;case kA:return Math.floor((s+5)/6)*Math.floor((e+5)/6)*16;case Pb:return Math.floor((s+7)/8)*Math.floor((e+4)/5)*16;case Nb:return Math.floor((s+7)/8)*Math.floor((e+5)/6)*16;case Fb:return Math.floor((s+7)/8)*Math.floor((e+7)/8)*16;case Ub:return Math.floor((s+9)/10)*Math.floor((e+4)/5)*16;case kb:return Math.floor((s+9)/10)*Math.floor((e+5)/6)*16;case Gb:return Math.floor((s+9)/10)*Math.floor((e+7)/8)*16;case Hb:return Math.floor((s+9)/10)*Math.floor((e+9)/10)*16;case zb:return Math.floor((s+11)/12)*Math.floor((e+9)/10)*16;case Qb:return Math.floor((s+11)/12)*Math.floor((e+11)/12)*16;case vA:case Vb:case jb:return Math.ceil(s/4)*Math.ceil(e/4)*16;case uB:case qb:return Math.ceil(s/4)*Math.ceil(e/4)*8;case Kb:case Yb:return Math.ceil(s/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function cW(s){switch(s){case ds:case rB:return{byteLength:1,components:1};case PA:case aB:case hr:return{byteLength:2,components:1};case RT:case BT:return{byteLength:2,components:4};case Rh:case wT:case ss:return{byteLength:4,components:1};case oB:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${s}.`)}class uW{static contain(e,t){return aW(e,t)}static cover(e,t){return oW(e,t)}static fill(e){return lW(e)}static getByteLength(e,t,n,i){return Lw(e,t,n,i)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:fE}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=fE);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function EG(){let s=null,e=!1,t=null,n=null;function i(r,a){t(r,a),n=s.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=s.requestAnimationFrame(i),e=!0)},stop:function(){s.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){s=r}}}function hW(s){const e=new WeakMap;function t(o,l){const c=o.array,h=o.usage,f=c.byteLength,p=s.createBuffer();s.bindBuffer(l,p),s.bufferData(l,c,h),o.onUploadCallback();let g;if(c instanceof Float32Array)g=s.FLOAT;else if(typeof Float16Array<"u"&&c instanceof Float16Array)g=s.HALF_FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?g=s.HALF_FLOAT:g=s.UNSIGNED_SHORT;else if(c instanceof Int16Array)g=s.SHORT;else if(c instanceof Uint32Array)g=s.UNSIGNED_INT;else if(c instanceof Int32Array)g=s.INT;else if(c instanceof Int8Array)g=s.BYTE;else if(c instanceof Uint8Array)g=s.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)g=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:p,type:g,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:f}}function n(o,l,c){const h=l.array,f=l.updateRanges;if(s.bindBuffer(c,o),f.length===0)s.bufferSubData(c,0,h);else{f.sort((g,y)=>g.start-y.start);let p=0;for(let g=1;g<f.length;g++){const y=f[p],x=f[g];x.start<=y.start+y.count+1?y.count=Math.max(y.count,x.start+x.count-y.start):(++p,f[p]=x)}f.length=p+1;for(let g=0,y=f.length;g<y;g++){const x=f[g];s.bufferSubData(c,x.start*h.BYTES_PER_ELEMENT,h,x.start,x.count)}l.clearUpdateRanges()}l.onUploadCallback()}function i(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function r(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(s.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const h=e.get(o);(!h||h.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=e.get(o);if(c===void 0)e.set(o,t(o,l));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(c.buffer,o,l),c.version=o.version}}return{get:i,remove:r,update:a}}var fW=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,dW=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,pW=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,mW=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,gW=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,AW=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,yW=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,vW=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,EW=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,xW=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,_W=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,SW=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bW=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,TW=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,CW=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,IW=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,MW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,wW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,RW=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,BW=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,DW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,LW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,OW=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,PW=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,NW=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,FW=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,UW=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,kW=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,GW=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,HW=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,zW="gl_FragColor = linearToOutputTexel( gl_FragColor );",QW=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,VW=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,jW=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,qW=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,KW=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,YW=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,XW=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,WW=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,$W=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,JW=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,ZW=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,e7=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,t7=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,n7=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,i7=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,s7=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,r7=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,a7=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,o7=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,l7=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,c7=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,u7=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,h7=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,f7=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,d7=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,p7=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,m7=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,g7=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,A7=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,y7=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,v7=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,E7=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,x7=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,_7=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,S7=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,b7=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,T7=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,C7=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,I7=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,M7=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,w7=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,R7=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,B7=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,D7=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,L7=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,O7=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,P7=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,N7=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,F7=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,U7=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,k7=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,G7=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,H7=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,z7=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Q7=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,V7=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,j7=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,q7=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,K7=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSEDEPTHBUF
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSEDEPTHBUF
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare , distribution.x );
		#endif
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Y7=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,X7=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,W7=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,$7=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,J7=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Z7=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,e$=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,t$=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,n$=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,i$=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,s$=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,r$=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,a$=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,o$=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,l$=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,c$=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,u$=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const h$=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,f$=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,d$=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,p$=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,m$=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,g$=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,A$=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,y$=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSEDEPTHBUF
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,v$=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,E$=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,x$=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,_$=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,S$=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,b$=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,T$=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,C$=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,I$=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,M$=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,w$=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,R$=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,B$=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,D$=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,L$=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,O$=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,P$=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,N$=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,F$=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,U$=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,k$=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,G$=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,H$=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,z$=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Q$=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,V$=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Dn={alphahash_fragment:fW,alphahash_pars_fragment:dW,alphamap_fragment:pW,alphamap_pars_fragment:mW,alphatest_fragment:gW,alphatest_pars_fragment:AW,aomap_fragment:yW,aomap_pars_fragment:vW,batching_pars_vertex:EW,batching_vertex:xW,begin_vertex:_W,beginnormal_vertex:SW,bsdfs:bW,iridescence_fragment:TW,bumpmap_pars_fragment:CW,clipping_planes_fragment:IW,clipping_planes_pars_fragment:MW,clipping_planes_pars_vertex:wW,clipping_planes_vertex:RW,color_fragment:BW,color_pars_fragment:DW,color_pars_vertex:LW,color_vertex:OW,common:PW,cube_uv_reflection_fragment:NW,defaultnormal_vertex:FW,displacementmap_pars_vertex:UW,displacementmap_vertex:kW,emissivemap_fragment:GW,emissivemap_pars_fragment:HW,colorspace_fragment:zW,colorspace_pars_fragment:QW,envmap_fragment:VW,envmap_common_pars_fragment:jW,envmap_pars_fragment:qW,envmap_pars_vertex:KW,envmap_physical_pars_fragment:s7,envmap_vertex:YW,fog_vertex:XW,fog_pars_vertex:WW,fog_fragment:$W,fog_pars_fragment:JW,gradientmap_pars_fragment:ZW,lightmap_pars_fragment:e7,lights_lambert_fragment:t7,lights_lambert_pars_fragment:n7,lights_pars_begin:i7,lights_toon_fragment:r7,lights_toon_pars_fragment:a7,lights_phong_fragment:o7,lights_phong_pars_fragment:l7,lights_physical_fragment:c7,lights_physical_pars_fragment:u7,lights_fragment_begin:h7,lights_fragment_maps:f7,lights_fragment_end:d7,logdepthbuf_fragment:p7,logdepthbuf_pars_fragment:m7,logdepthbuf_pars_vertex:g7,logdepthbuf_vertex:A7,map_fragment:y7,map_pars_fragment:v7,map_particle_fragment:E7,map_particle_pars_fragment:x7,metalnessmap_fragment:_7,metalnessmap_pars_fragment:S7,morphinstance_vertex:b7,morphcolor_vertex:T7,morphnormal_vertex:C7,morphtarget_pars_vertex:I7,morphtarget_vertex:M7,normal_fragment_begin:w7,normal_fragment_maps:R7,normal_pars_fragment:B7,normal_pars_vertex:D7,normal_vertex:L7,normalmap_pars_fragment:O7,clearcoat_normal_fragment_begin:P7,clearcoat_normal_fragment_maps:N7,clearcoat_pars_fragment:F7,iridescence_pars_fragment:U7,opaque_fragment:k7,packing:G7,premultiplied_alpha_fragment:H7,project_vertex:z7,dithering_fragment:Q7,dithering_pars_fragment:V7,roughnessmap_fragment:j7,roughnessmap_pars_fragment:q7,shadowmap_pars_fragment:K7,shadowmap_pars_vertex:Y7,shadowmap_vertex:X7,shadowmask_pars_fragment:W7,skinbase_vertex:$7,skinning_pars_vertex:J7,skinning_vertex:Z7,skinnormal_vertex:e$,specularmap_fragment:t$,specularmap_pars_fragment:n$,tonemapping_fragment:i$,tonemapping_pars_fragment:s$,transmission_fragment:r$,transmission_pars_fragment:a$,uv_pars_fragment:o$,uv_pars_vertex:l$,uv_vertex:c$,worldpos_vertex:u$,background_vert:h$,background_frag:f$,backgroundCube_vert:d$,backgroundCube_frag:p$,cube_vert:m$,cube_frag:g$,depth_vert:A$,depth_frag:y$,distanceRGBA_vert:v$,distanceRGBA_frag:E$,equirect_vert:x$,equirect_frag:_$,linedashed_vert:S$,linedashed_frag:b$,meshbasic_vert:T$,meshbasic_frag:C$,meshlambert_vert:I$,meshlambert_frag:M$,meshmatcap_vert:w$,meshmatcap_frag:R$,meshnormal_vert:B$,meshnormal_frag:D$,meshphong_vert:L$,meshphong_frag:O$,meshphysical_vert:P$,meshphysical_frag:N$,meshtoon_vert:F$,meshtoon_frag:U$,points_vert:k$,points_frag:G$,shadow_vert:H$,shadow_frag:z$,sprite_vert:Q$,sprite_frag:V$},Ot={common:{diffuse:{value:new Tt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new un},alphaMap:{value:null},alphaMapTransform:{value:new un},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new un}},envmap:{envMap:{value:null},envMapRotation:{value:new un},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new un}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new un}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new un},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new un},normalScale:{value:new We(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new un},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new un}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new un}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new un}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Tt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Tt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new un},alphaTest:{value:0},uvTransform:{value:new un}},sprite:{diffuse:{value:new Tt(16777215)},opacity:{value:1},center:{value:new We(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new un},alphaMap:{value:null},alphaMapTransform:{value:new un},alphaTest:{value:0}}},Do={basic:{uniforms:Ta([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.fog]),vertexShader:Dn.meshbasic_vert,fragmentShader:Dn.meshbasic_frag},lambert:{uniforms:Ta([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,Ot.lights,{emissive:{value:new Tt(0)}}]),vertexShader:Dn.meshlambert_vert,fragmentShader:Dn.meshlambert_frag},phong:{uniforms:Ta([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,Ot.lights,{emissive:{value:new Tt(0)},specular:{value:new Tt(1118481)},shininess:{value:30}}]),vertexShader:Dn.meshphong_vert,fragmentShader:Dn.meshphong_frag},standard:{uniforms:Ta([Ot.common,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.roughnessmap,Ot.metalnessmap,Ot.fog,Ot.lights,{emissive:{value:new Tt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Dn.meshphysical_vert,fragmentShader:Dn.meshphysical_frag},toon:{uniforms:Ta([Ot.common,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.gradientmap,Ot.fog,Ot.lights,{emissive:{value:new Tt(0)}}]),vertexShader:Dn.meshtoon_vert,fragmentShader:Dn.meshtoon_frag},matcap:{uniforms:Ta([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,{matcap:{value:null}}]),vertexShader:Dn.meshmatcap_vert,fragmentShader:Dn.meshmatcap_frag},points:{uniforms:Ta([Ot.points,Ot.fog]),vertexShader:Dn.points_vert,fragmentShader:Dn.points_frag},dashed:{uniforms:Ta([Ot.common,Ot.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Dn.linedashed_vert,fragmentShader:Dn.linedashed_frag},depth:{uniforms:Ta([Ot.common,Ot.displacementmap]),vertexShader:Dn.depth_vert,fragmentShader:Dn.depth_frag},normal:{uniforms:Ta([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,{opacity:{value:1}}]),vertexShader:Dn.meshnormal_vert,fragmentShader:Dn.meshnormal_frag},sprite:{uniforms:Ta([Ot.sprite,Ot.fog]),vertexShader:Dn.sprite_vert,fragmentShader:Dn.sprite_frag},background:{uniforms:{uvTransform:{value:new un},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Dn.background_vert,fragmentShader:Dn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new un}},vertexShader:Dn.backgroundCube_vert,fragmentShader:Dn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Dn.cube_vert,fragmentShader:Dn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Dn.equirect_vert,fragmentShader:Dn.equirect_frag},distanceRGBA:{uniforms:Ta([Ot.common,Ot.displacementmap,{referencePosition:{value:new de},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Dn.distanceRGBA_vert,fragmentShader:Dn.distanceRGBA_frag},shadow:{uniforms:Ta([Ot.lights,Ot.fog,{color:{value:new Tt(0)},opacity:{value:1}}]),vertexShader:Dn.shadow_vert,fragmentShader:Dn.shadow_frag}};Do.physical={uniforms:Ta([Do.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new un},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new un},clearcoatNormalScale:{value:new We(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new un},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new un},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new un},sheen:{value:0},sheenColor:{value:new Tt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new un},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new un},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new un},transmissionSamplerSize:{value:new We},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new un},attenuationDistance:{value:0},attenuationColor:{value:new Tt(0)},specularColor:{value:new Tt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new un},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new un},anisotropyVector:{value:new We},anisotropyMap:{value:null},anisotropyMapTransform:{value:new un}}]),vertexShader:Dn.meshphysical_vert,fragmentShader:Dn.meshphysical_frag};const gS={r:0,b:0,g:0},Rp=new Os,j$=new Pt;function q$(s,e,t,n,i,r,a){const o=new Tt(0);let l=r===!0?0:1,c,h,f=null,p=0,g=null;function y(C){let I=C.isScene===!0?C.background:null;return I&&I.isTexture&&(I=(C.backgroundBlurriness>0?t:e).get(I)),I}function x(C){let I=!1;const M=y(C);M===null?_(o,l):M&&M.isColor&&(_(M,1),I=!0);const R=s.xr.getEnvironmentBlendMode();R==="additive"?n.buffers.color.setClear(0,0,0,1,a):R==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(s.autoClear||I)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil))}function E(C,I){const M=y(I);M&&(M.isCubeTexture||M.mapping===r0)?(h===void 0&&(h=new bi(new ym(1,1,1),new Ra({name:"BackgroundCubeMaterial",uniforms:jA(Do.backgroundCube.uniforms),vertexShader:Do.backgroundCube.vertexShader,fragmentShader:Do.backgroundCube.fragmentShader,side:wa,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(R,D,P){this.matrixWorld.copyPosition(P.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(h)),Rp.copy(I.backgroundRotation),Rp.x*=-1,Rp.y*=-1,Rp.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(Rp.y*=-1,Rp.z*=-1),h.material.uniforms.envMap.value=M,h.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=I.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=I.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(j$.makeRotationFromEuler(Rp)),h.material.toneMapped=Jn.getTransfer(M.colorSpace)!==Ei,(f!==M||p!==M.version||g!==s.toneMapping)&&(h.material.needsUpdate=!0,f=M,p=M.version,g=s.toneMapping),h.layers.enableAll(),C.unshift(h,h.geometry,h.material,0,0,null)):M&&M.isTexture&&(c===void 0&&(c=new bi(new xd(2,2),new Ra({name:"BackgroundMaterial",uniforms:jA(Do.background.uniforms),vertexShader:Do.background.vertexShader,fragmentShader:Do.background.fragmentShader,side:bu,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(c)),c.material.uniforms.t2D.value=M,c.material.uniforms.backgroundIntensity.value=I.backgroundIntensity,c.material.toneMapped=Jn.getTransfer(M.colorSpace)!==Ei,M.matrixAutoUpdate===!0&&M.updateMatrix(),c.material.uniforms.uvTransform.value.copy(M.matrix),(f!==M||p!==M.version||g!==s.toneMapping)&&(c.material.needsUpdate=!0,f=M,p=M.version,g=s.toneMapping),c.layers.enableAll(),C.unshift(c,c.geometry,c.material,0,0,null))}function _(C,I){C.getRGB(gS,Rk(s)),n.buffers.color.setClear(gS.r,gS.g,gS.b,I,a)}function b(){h!==void 0&&(h.geometry.dispose(),h.material.dispose(),h=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return o},setClearColor:function(C,I=1){o.set(C),l=I,_(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(C){l=C,_(o,l)},render:x,addToRenderList:E,dispose:b}}function K$(s,e){const t=s.getParameter(s.MAX_VERTEX_ATTRIBS),n={},i=p(null);let r=i,a=!1;function o(O,U,j,H,z){let q=!1;const k=f(H,j,U);r!==k&&(r=k,c(r.object)),q=g(O,H,j,z),q&&y(O,H,j,z),z!==null&&e.update(z,s.ELEMENT_ARRAY_BUFFER),(q||a)&&(a=!1,I(O,U,j,H),z!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.get(z).buffer))}function l(){return s.createVertexArray()}function c(O){return s.bindVertexArray(O)}function h(O){return s.deleteVertexArray(O)}function f(O,U,j){const H=j.wireframe===!0;let z=n[O.id];z===void 0&&(z={},n[O.id]=z);let q=z[U.id];q===void 0&&(q={},z[U.id]=q);let k=q[H];return k===void 0&&(k=p(l()),q[H]=k),k}function p(O){const U=[],j=[],H=[];for(let z=0;z<t;z++)U[z]=0,j[z]=0,H[z]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:j,attributeDivisors:H,object:O,attributes:{},index:null}}function g(O,U,j,H){const z=r.attributes,q=U.attributes;let k=0;const W=j.getAttributes();for(const V in W)if(W[V].location>=0){const K=z[V];let te=q[V];if(te===void 0&&(V==="instanceMatrix"&&O.instanceMatrix&&(te=O.instanceMatrix),V==="instanceColor"&&O.instanceColor&&(te=O.instanceColor)),K===void 0||K.attribute!==te||te&&K.data!==te.data)return!0;k++}return r.attributesNum!==k||r.index!==H}function y(O,U,j,H){const z={},q=U.attributes;let k=0;const W=j.getAttributes();for(const V in W)if(W[V].location>=0){let K=q[V];K===void 0&&(V==="instanceMatrix"&&O.instanceMatrix&&(K=O.instanceMatrix),V==="instanceColor"&&O.instanceColor&&(K=O.instanceColor));const te={};te.attribute=K,K&&K.data&&(te.data=K.data),z[V]=te,k++}r.attributes=z,r.attributesNum=k,r.index=H}function x(){const O=r.newAttributes;for(let U=0,j=O.length;U<j;U++)O[U]=0}function E(O){_(O,0)}function _(O,U){const j=r.newAttributes,H=r.enabledAttributes,z=r.attributeDivisors;j[O]=1,H[O]===0&&(s.enableVertexAttribArray(O),H[O]=1),z[O]!==U&&(s.vertexAttribDivisor(O,U),z[O]=U)}function b(){const O=r.newAttributes,U=r.enabledAttributes;for(let j=0,H=U.length;j<H;j++)U[j]!==O[j]&&(s.disableVertexAttribArray(j),U[j]=0)}function C(O,U,j,H,z,q,k){k===!0?s.vertexAttribIPointer(O,U,j,z,q):s.vertexAttribPointer(O,U,j,H,z,q)}function I(O,U,j,H){x();const z=H.attributes,q=j.getAttributes(),k=U.defaultAttributeValues;for(const W in q){const V=q[W];if(V.location>=0){let X=z[W];if(X===void 0&&(W==="instanceMatrix"&&O.instanceMatrix&&(X=O.instanceMatrix),W==="instanceColor"&&O.instanceColor&&(X=O.instanceColor)),X!==void 0){const K=X.normalized,te=X.itemSize,oe=e.get(X);if(oe===void 0)continue;const Ee=oe.buffer,Ce=oe.type,se=oe.bytesPerElement,ie=Ce===s.INT||Ce===s.UNSIGNED_INT||X.gpuType===wT;if(X.isInterleavedBufferAttribute){const ne=X.data,re=ne.stride,Be=X.offset;if(ne.isInstancedInterleavedBuffer){for(let Ge=0;Ge<V.locationSize;Ge++)_(V.location+Ge,ne.meshPerAttribute);O.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=ne.meshPerAttribute*ne.count)}else for(let Ge=0;Ge<V.locationSize;Ge++)E(V.location+Ge);s.bindBuffer(s.ARRAY_BUFFER,Ee);for(let Ge=0;Ge<V.locationSize;Ge++)C(V.location+Ge,te/V.locationSize,Ce,K,re*se,(Be+te/V.locationSize*Ge)*se,ie)}else{if(X.isInstancedBufferAttribute){for(let ne=0;ne<V.locationSize;ne++)_(V.location+ne,X.meshPerAttribute);O.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=X.meshPerAttribute*X.count)}else for(let ne=0;ne<V.locationSize;ne++)E(V.location+ne);s.bindBuffer(s.ARRAY_BUFFER,Ee);for(let ne=0;ne<V.locationSize;ne++)C(V.location+ne,te/V.locationSize,Ce,K,te*se,te/V.locationSize*ne*se,ie)}}else if(k!==void 0){const K=k[W];if(K!==void 0)switch(K.length){case 2:s.vertexAttrib2fv(V.location,K);break;case 3:s.vertexAttrib3fv(V.location,K);break;case 4:s.vertexAttrib4fv(V.location,K);break;default:s.vertexAttrib1fv(V.location,K)}}}}b()}function M(){P();for(const O in n){const U=n[O];for(const j in U){const H=U[j];for(const z in H)h(H[z].object),delete H[z];delete U[j]}delete n[O]}}function R(O){if(n[O.id]===void 0)return;const U=n[O.id];for(const j in U){const H=U[j];for(const z in H)h(H[z].object),delete H[z];delete U[j]}delete n[O.id]}function D(O){for(const U in n){const j=n[U];if(j[O.id]===void 0)continue;const H=j[O.id];for(const z in H)h(H[z].object),delete H[z];delete j[O.id]}}function P(){L(),a=!0,r!==i&&(r=i,c(r.object))}function L(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:o,reset:P,resetDefaultState:L,dispose:M,releaseStatesOfGeometry:R,releaseStatesOfProgram:D,initAttributes:x,enableAttribute:E,disableUnusedAttributes:b}}function Y$(s,e,t){let n;function i(c){n=c}function r(c,h){s.drawArrays(n,c,h),t.update(h,n,1)}function a(c,h,f){f!==0&&(s.drawArraysInstanced(n,c,h,f),t.update(h,n,f))}function o(c,h,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,c,0,h,0,f);let g=0;for(let y=0;y<f;y++)g+=h[y];t.update(g,n,1)}function l(c,h,f,p){if(f===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let y=0;y<c.length;y++)a(c[y],h[y],p[y]);else{g.multiDrawArraysInstancedWEBGL(n,c,0,h,0,p,0,f);let y=0;for(let x=0;x<f;x++)y+=h[x]*p[x];t.update(y,n,1)}}this.setMode=i,this.render=r,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function X$(s,e,t,n){let i;function r(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const D=e.get("EXT_texture_filter_anisotropic");i=s.getParameter(D.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(D){return!(D!==rs&&n.convert(D)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(D){const P=D===hr&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(D!==ds&&n.convert(D)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_TYPE)&&D!==ss&&!P)}function l(D){if(D==="highp"){if(s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0)return"highp";D="mediump"}return D==="mediump"&&s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const h=l(c);h!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",h,"instead."),c=h);const f=t.logarithmicDepthBuffer===!0,p=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),g=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),y=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS),x=s.getParameter(s.MAX_TEXTURE_SIZE),E=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),_=s.getParameter(s.MAX_VERTEX_ATTRIBS),b=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),C=s.getParameter(s.MAX_VARYING_VECTORS),I=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS),M=y>0,R=s.getParameter(s.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:f,reversedDepthBuffer:p,maxTextures:g,maxVertexTextures:y,maxTextureSize:x,maxCubemapSize:E,maxAttributes:_,maxVertexUniforms:b,maxVaryings:C,maxFragmentUniforms:I,vertexTextures:M,maxSamples:R}}function W$(s){const e=this;let t=null,n=0,i=!1,r=!1;const a=new xh,o=new un,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(f,p){const g=f.length!==0||p||n!==0||i;return i=p,n=f.length,g},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(f,p){t=h(f,p,0)},this.setState=function(f,p,g){const y=f.clippingPlanes,x=f.clipIntersection,E=f.clipShadows,_=s.get(f);if(!i||y===null||y.length===0||r&&!E)r?h(null):c();else{const b=r?0:n,C=b*4;let I=_.clippingState||null;l.value=I,I=h(y,p,C,g);for(let M=0;M!==C;++M)I[M]=t[M];_.clippingState=I,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(f,p,g,y){const x=f!==null?f.length:0;let E=null;if(x!==0){if(E=l.value,y!==!0||E===null){const _=g+x*4,b=p.matrixWorldInverse;o.getNormalMatrix(b),(E===null||E.length<_)&&(E=new Float32Array(_));for(let C=0,I=g;C!==x;++C,I+=4)a.copy(f[C]).applyMatrix4(b,o),a.normal.toArray(E,I),E[I+3]=a.constant}l.value=E,l.needsUpdate=!0}return e.numPlanes=x,e.numIntersection=0,E}}function $$(s){let e=new WeakMap;function t(a,o){return o===LA?a.mapping=Tu:o===Lv&&(a.mapping=cd),a}function n(a){if(a&&a.isTexture){const o=a.mapping;if(o===LA||o===Lv)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new Dk(l.height);return c.fromEquirectangularTexture(s,a),e.set(a,c),a.addEventListener("dispose",i),t(c.texture,a.mapping)}else return null}}return a}function i(a){const o=a.target;o.removeEventListener("dispose",i);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}const oA=4,eP=[.125,.215,.35,.446,.526,.582],Hp=20,SI=new Nh,tP=new Tt;let bI=null,TI=0,CI=0,II=!1;const kp=(1+Math.sqrt(5))/2,Yg=1/kp,nP=[new de(-kp,Yg,0),new de(kp,Yg,0),new de(-Yg,0,kp),new de(Yg,0,kp),new de(0,kp,-Yg),new de(0,kp,Yg),new de(-1,1,-1),new de(1,1,-1),new de(-1,1,1),new de(1,1,1)],J$=new de;class Ow{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100,r={}){const{size:a=256,position:o=J$}=r;bI=this._renderer.getRenderTarget(),TI=this._renderer.getActiveCubeFace(),CI=this._renderer.getActiveMipmapLevel(),II=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,n,i,l,o),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=rP(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=sP(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(bI,TI,CI),this._renderer.xr.enabled=II,e.scissorTest=!1,AS(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Tu||e.mapping===cd?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),bI=this._renderer.getRenderTarget(),TI=this._renderer.getActiveCubeFace(),CI=this._renderer.getActiveMipmapLevel(),II=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Si,minFilter:Si,generateMipmaps:!1,type:hr,format:rs,colorSpace:ud,depthBuffer:!1},i=iP(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=iP(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Z$(r)),this._blurMaterial=eJ(r,e,t)}return i}_compileMaterial(e){const t=new bi(this._lodPlanes[0],e);this._renderer.compile(t,SI)}_sceneToCubeUV(e,t,n,i,r){const l=new Ki(90,1,t,n),c=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],f=this._renderer,p=f.autoClear,g=f.toneMapping;f.getClearColor(tP),f.toneMapping=hc,f.autoClear=!1,f.state.buffers.depth.getReversed()&&(f.setRenderTarget(i),f.clearDepth(),f.setRenderTarget(null));const x=new io({name:"PMREM.Background",side:wa,depthWrite:!1,depthTest:!1}),E=new bi(new ym,x);let _=!1;const b=e.background;b?b.isColor&&(x.color.copy(b),e.background=null,_=!0):(x.color.copy(tP),_=!0);for(let C=0;C<6;C++){const I=C%3;I===0?(l.up.set(0,c[C],0),l.position.set(r.x,r.y,r.z),l.lookAt(r.x+h[C],r.y,r.z)):I===1?(l.up.set(0,0,c[C]),l.position.set(r.x,r.y,r.z),l.lookAt(r.x,r.y+h[C],r.z)):(l.up.set(0,c[C],0),l.position.set(r.x,r.y,r.z),l.lookAt(r.x,r.y,r.z+h[C]));const M=this._cubeSize;AS(i,I*M,C>2?M:0,M,M),f.setRenderTarget(i),_&&f.render(E,l),f.render(e,l)}E.geometry.dispose(),E.material.dispose(),f.toneMapping=g,f.autoClear=p,e.background=b}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===Tu||e.mapping===cd;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=rP()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=sP());const r=i?this._cubemapMaterial:this._equirectMaterial,a=new bi(this._lodPlanes[0],r),o=r.uniforms;o.envMap.value=e;const l=this._cubeSize;AS(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(a,SI)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let r=1;r<i;r++){const a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=nP[(i-r-1)%nP.length];this._blur(e,r-1,r,a,o)}t.autoClear=n}_blur(e,t,n,i,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,f=new bi(this._lodPlanes[i],c),p=c.uniforms,g=this._sizeLods[n]-1,y=isFinite(r)?Math.PI/(2*g):2*Math.PI/(2*Hp-1),x=r/y,E=isFinite(r)?1+Math.floor(h*x):Hp;E>Hp&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${E} samples when the maximum is set to ${Hp}`);const _=[];let b=0;for(let D=0;D<Hp;++D){const P=D/x,L=Math.exp(-P*P/2);_.push(L),D===0?b+=L:D<E&&(b+=2*L)}for(let D=0;D<_.length;D++)_[D]=_[D]/b;p.envMap.value=e.texture,p.samples.value=E,p.weights.value=_,p.latitudinal.value=a==="latitudinal",o&&(p.poleAxis.value=o);const{_lodMax:C}=this;p.dTheta.value=y,p.mipInt.value=C-n;const I=this._sizeLods[i],M=3*I*(i>C-oA?i-C+oA:0),R=4*(this._cubeSize-I);AS(t,M,R,3*I,2*I),l.setRenderTarget(t),l.render(f,SI)}}function Z$(s){const e=[],t=[],n=[];let i=s;const r=s-oA+1+eP.length;for(let a=0;a<r;a++){const o=Math.pow(2,i);t.push(o);let l=1/o;a>s-oA?l=eP[a-s+oA-1]:a===0&&(l=0),n.push(l);const c=1/(o-2),h=-c,f=1+c,p=[h,h,f,h,f,f,h,h,f,f,h,f],g=6,y=6,x=3,E=2,_=1,b=new Float32Array(x*y*g),C=new Float32Array(E*y*g),I=new Float32Array(_*y*g);for(let R=0;R<g;R++){const D=R%3*2/3-1,P=R>2?0:-1,L=[D,P,0,D+2/3,P,0,D+2/3,P+1,0,D,P,0,D+2/3,P+1,0,D,P+1,0];b.set(L,x*y*R),C.set(p,E*y*R);const O=[R,R,R,R,R,R];I.set(O,_*y*R)}const M=new hn;M.setAttribute("position",new ei(b,x)),M.setAttribute("uv",new ei(C,E)),M.setAttribute("faceIndex",new ei(I,_)),e.push(M),i>oA&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function iP(s,e,t){const n=new _l(s,e,t);return n.texture.mapping=r0,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function AS(s,e,t,n,i){s.viewport.set(e,t,n,i),s.scissor.set(e,t,n,i)}function eJ(s,e,t){const n=new Float32Array(Hp),i=new de(0,1,0);return new Ra({name:"SphericalGaussianBlur",defines:{n:Hp,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:jB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Eu,depthTest:!1,depthWrite:!1})}function sP(){return new Ra({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:jB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Eu,depthTest:!1,depthWrite:!1})}function rP(){return new Ra({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:jB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Eu,depthTest:!1,depthWrite:!1})}function jB(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function tJ(s){let e=new WeakMap,t=null;function n(o){if(o&&o.isTexture){const l=o.mapping,c=l===LA||l===Lv,h=l===Tu||l===cd;if(c||h){let f=e.get(o);const p=f!==void 0?f.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==p)return t===null&&(t=new Ow(s)),f=c?t.fromEquirectangular(o,f):t.fromCubemap(o,f),f.texture.pmremVersion=o.pmremVersion,e.set(o,f),f.texture;if(f!==void 0)return f.texture;{const g=o.image;return c&&g&&g.height>0||h&&g&&i(g)?(t===null&&(t=new Ow(s)),f=c?t.fromEquirectangular(o):t.fromCubemap(o),f.texture.pmremVersion=o.pmremVersion,e.set(o,f),o.addEventListener("dispose",r),f.texture):null}}}return o}function i(o){let l=0;const c=6;for(let h=0;h<c;h++)o[h]!==void 0&&l++;return l===c}function r(o){const l=o.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function nJ(s){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=s.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const i=t(n);return i===null&&EA("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function iJ(s,e,t,n){const i={},r=new WeakMap;function a(f){const p=f.target;p.index!==null&&e.remove(p.index);for(const y in p.attributes)e.remove(p.attributes[y]);p.removeEventListener("dispose",a),delete i[p.id];const g=r.get(p);g&&(e.remove(g),r.delete(p)),n.releaseStatesOfGeometry(p),p.isInstancedBufferGeometry===!0&&delete p._maxInstanceCount,t.memory.geometries--}function o(f,p){return i[p.id]===!0||(p.addEventListener("dispose",a),i[p.id]=!0,t.memory.geometries++),p}function l(f){const p=f.attributes;for(const g in p)e.update(p[g],s.ARRAY_BUFFER)}function c(f){const p=[],g=f.index,y=f.attributes.position;let x=0;if(g!==null){const b=g.array;x=g.version;for(let C=0,I=b.length;C<I;C+=3){const M=b[C+0],R=b[C+1],D=b[C+2];p.push(M,R,R,D,D,M)}}else if(y!==void 0){const b=y.array;x=y.version;for(let C=0,I=b.length/3-1;C<I;C+=3){const M=C+0,R=C+1,D=C+2;p.push(M,R,R,D,D,M)}}else return;const E=new(Ck(p)?AB:FT)(p,1);E.version=x;const _=r.get(f);_&&e.remove(_),r.set(f,E)}function h(f){const p=r.get(f);if(p){const g=f.index;g!==null&&p.version<g.version&&c(f)}else c(f);return r.get(f)}return{get:o,update:l,getWireframeAttribute:h}}function sJ(s,e,t){let n;function i(p){n=p}let r,a;function o(p){r=p.type,a=p.bytesPerElement}function l(p,g){s.drawElements(n,g,r,p*a),t.update(g,n,1)}function c(p,g,y){y!==0&&(s.drawElementsInstanced(n,g,r,p*a,y),t.update(g,n,y))}function h(p,g,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,g,0,r,p,0,y);let E=0;for(let _=0;_<y;_++)E+=g[_];t.update(E,n,1)}function f(p,g,y,x){if(y===0)return;const E=e.get("WEBGL_multi_draw");if(E===null)for(let _=0;_<p.length;_++)c(p[_]/a,g[_],x[_]);else{E.multiDrawElementsInstancedWEBGL(n,g,0,r,p,0,x,0,y);let _=0;for(let b=0;b<y;b++)_+=g[b]*x[b];t.update(_,n,1)}}this.setMode=i,this.setIndex=o,this.render=l,this.renderInstances=c,this.renderMultiDraw=h,this.renderMultiDrawInstances=f}function rJ(s){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,a,o){switch(t.calls++,a){case s.TRIANGLES:t.triangles+=o*(r/3);break;case s.LINES:t.lines+=o*(r/2);break;case s.LINE_STRIP:t.lines+=o*(r-1);break;case s.LINE_LOOP:t.lines+=o*r;break;case s.POINTS:t.points+=o*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function aJ(s,e,t){const n=new WeakMap,i=new Tn;function r(a,o,l){const c=a.morphTargetInfluences,h=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,f=h!==void 0?h.length:0;let p=n.get(o);if(p===void 0||p.count!==f){let O=function(){P.dispose(),n.delete(o),o.removeEventListener("dispose",O)};var g=O;p!==void 0&&p.texture.dispose();const y=o.morphAttributes.position!==void 0,x=o.morphAttributes.normal!==void 0,E=o.morphAttributes.color!==void 0,_=o.morphAttributes.position||[],b=o.morphAttributes.normal||[],C=o.morphAttributes.color||[];let I=0;y===!0&&(I=1),x===!0&&(I=2),E===!0&&(I=3);let M=o.attributes.position.count*I,R=1;M>e.maxTextureSize&&(R=Math.ceil(M/e.maxTextureSize),M=e.maxTextureSize);const D=new Float32Array(M*R*4*f),P=new PT(D,M,R,f);P.type=ss,P.needsUpdate=!0;const L=I*4;for(let U=0;U<f;U++){const j=_[U],H=b[U],z=C[U],q=M*R*4*U;for(let k=0;k<j.count;k++){const W=k*L;y===!0&&(i.fromBufferAttribute(j,k),D[q+W+0]=i.x,D[q+W+1]=i.y,D[q+W+2]=i.z,D[q+W+3]=0),x===!0&&(i.fromBufferAttribute(H,k),D[q+W+4]=i.x,D[q+W+5]=i.y,D[q+W+6]=i.z,D[q+W+7]=0),E===!0&&(i.fromBufferAttribute(z,k),D[q+W+8]=i.x,D[q+W+9]=i.y,D[q+W+10]=i.z,D[q+W+11]=z.itemSize===4?i.w:1)}}p={count:f,texture:P,size:new We(M,R)},n.set(o,p),o.addEventListener("dispose",O)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(s,"morphTexture",a.morphTexture,t);else{let y=0;for(let E=0;E<c.length;E++)y+=c[E];const x=o.morphTargetsRelative?1:1-y;l.getUniforms().setValue(s,"morphTargetBaseInfluence",x),l.getUniforms().setValue(s,"morphTargetInfluences",c)}l.getUniforms().setValue(s,"morphTargetsTexture",p.texture,t),l.getUniforms().setValue(s,"morphTargetsTextureSize",p.size)}return{update:r}}function oJ(s,e,t,n){let i=new WeakMap;function r(l){const c=n.render.frame,h=l.geometry,f=e.get(l,h);if(i.get(f)!==c&&(e.update(f),i.set(f,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.get(l)!==c&&(t.update(l.instanceMatrix,s.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,s.ARRAY_BUFFER),i.set(l,c))),l.isSkinnedMesh){const p=l.skeleton;i.get(p)!==c&&(p.update(),i.set(p,c))}return f}function a(){i=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:a}}const xG=new Hi,aP=new _B(1,1),_G=new PT,SG=new NT,bG=new mE,oP=[],lP=[],cP=new Float32Array(16),uP=new Float32Array(9),hP=new Float32Array(4);function u0(s,e,t){const n=s[0];if(n<=0||n>0)return s;const i=e*t;let r=oP[i];if(r===void 0&&(r=new Float32Array(i),oP[i]=r),e!==0){n.toArray(r,0);for(let a=1,o=0;a!==e;++a)o+=t,s[a].toArray(r,o)}return r}function fr(s,e){if(s.length!==e.length)return!1;for(let t=0,n=s.length;t<n;t++)if(s[t]!==e[t])return!1;return!0}function dr(s,e){for(let t=0,n=e.length;t<n;t++)s[t]=e[t]}function aC(s,e){let t=lP[e];t===void 0&&(t=new Int32Array(e),lP[e]=t);for(let n=0;n!==e;++n)t[n]=s.allocateTextureUnit();return t}function lJ(s,e){const t=this.cache;t[0]!==e&&(s.uniform1f(this.addr,e),t[0]=e)}function cJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(fr(t,e))return;s.uniform2fv(this.addr,e),dr(t,e)}}function uJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(s.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(fr(t,e))return;s.uniform3fv(this.addr,e),dr(t,e)}}function hJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(fr(t,e))return;s.uniform4fv(this.addr,e),dr(t,e)}}function fJ(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(fr(t,e))return;s.uniformMatrix2fv(this.addr,!1,e),dr(t,e)}else{if(fr(t,n))return;hP.set(n),s.uniformMatrix2fv(this.addr,!1,hP),dr(t,n)}}function dJ(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(fr(t,e))return;s.uniformMatrix3fv(this.addr,!1,e),dr(t,e)}else{if(fr(t,n))return;uP.set(n),s.uniformMatrix3fv(this.addr,!1,uP),dr(t,n)}}function pJ(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(fr(t,e))return;s.uniformMatrix4fv(this.addr,!1,e),dr(t,e)}else{if(fr(t,n))return;cP.set(n),s.uniformMatrix4fv(this.addr,!1,cP),dr(t,n)}}function mJ(s,e){const t=this.cache;t[0]!==e&&(s.uniform1i(this.addr,e),t[0]=e)}function gJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(fr(t,e))return;s.uniform2iv(this.addr,e),dr(t,e)}}function AJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(fr(t,e))return;s.uniform3iv(this.addr,e),dr(t,e)}}function yJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(fr(t,e))return;s.uniform4iv(this.addr,e),dr(t,e)}}function vJ(s,e){const t=this.cache;t[0]!==e&&(s.uniform1ui(this.addr,e),t[0]=e)}function EJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(fr(t,e))return;s.uniform2uiv(this.addr,e),dr(t,e)}}function xJ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(fr(t,e))return;s.uniform3uiv(this.addr,e),dr(t,e)}}function _J(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(fr(t,e))return;s.uniform4uiv(this.addr,e),dr(t,e)}}function SJ(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i);let r;this.type===s.SAMPLER_2D_SHADOW?(aP.compareFunction=pB,r=aP):r=xG,t.setTexture2D(e||r,i)}function bJ(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||SG,i)}function TJ(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||bG,i)}function CJ(s,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||_G,i)}function IJ(s){switch(s){case 5126:return lJ;case 35664:return cJ;case 35665:return uJ;case 35666:return hJ;case 35674:return fJ;case 35675:return dJ;case 35676:return pJ;case 5124:case 35670:return mJ;case 35667:case 35671:return gJ;case 35668:case 35672:return AJ;case 35669:case 35673:return yJ;case 5125:return vJ;case 36294:return EJ;case 36295:return xJ;case 36296:return _J;case 35678:case 36198:case 36298:case 36306:case 35682:return SJ;case 35679:case 36299:case 36307:return bJ;case 35680:case 36300:case 36308:case 36293:return TJ;case 36289:case 36303:case 36311:case 36292:return CJ}}function MJ(s,e){s.uniform1fv(this.addr,e)}function wJ(s,e){const t=u0(e,this.size,2);s.uniform2fv(this.addr,t)}function RJ(s,e){const t=u0(e,this.size,3);s.uniform3fv(this.addr,t)}function BJ(s,e){const t=u0(e,this.size,4);s.uniform4fv(this.addr,t)}function DJ(s,e){const t=u0(e,this.size,4);s.uniformMatrix2fv(this.addr,!1,t)}function LJ(s,e){const t=u0(e,this.size,9);s.uniformMatrix3fv(this.addr,!1,t)}function OJ(s,e){const t=u0(e,this.size,16);s.uniformMatrix4fv(this.addr,!1,t)}function PJ(s,e){s.uniform1iv(this.addr,e)}function NJ(s,e){s.uniform2iv(this.addr,e)}function FJ(s,e){s.uniform3iv(this.addr,e)}function UJ(s,e){s.uniform4iv(this.addr,e)}function kJ(s,e){s.uniform1uiv(this.addr,e)}function GJ(s,e){s.uniform2uiv(this.addr,e)}function HJ(s,e){s.uniform3uiv(this.addr,e)}function zJ(s,e){s.uniform4uiv(this.addr,e)}function QJ(s,e,t){const n=this.cache,i=e.length,r=aC(t,i);fr(n,r)||(s.uniform1iv(this.addr,r),dr(n,r));for(let a=0;a!==i;++a)t.setTexture2D(e[a]||xG,r[a])}function VJ(s,e,t){const n=this.cache,i=e.length,r=aC(t,i);fr(n,r)||(s.uniform1iv(this.addr,r),dr(n,r));for(let a=0;a!==i;++a)t.setTexture3D(e[a]||SG,r[a])}function jJ(s,e,t){const n=this.cache,i=e.length,r=aC(t,i);fr(n,r)||(s.uniform1iv(this.addr,r),dr(n,r));for(let a=0;a!==i;++a)t.setTextureCube(e[a]||bG,r[a])}function qJ(s,e,t){const n=this.cache,i=e.length,r=aC(t,i);fr(n,r)||(s.uniform1iv(this.addr,r),dr(n,r));for(let a=0;a!==i;++a)t.setTexture2DArray(e[a]||_G,r[a])}function KJ(s){switch(s){case 5126:return MJ;case 35664:return wJ;case 35665:return RJ;case 35666:return BJ;case 35674:return DJ;case 35675:return LJ;case 35676:return OJ;case 5124:case 35670:return PJ;case 35667:case 35671:return NJ;case 35668:case 35672:return FJ;case 35669:case 35673:return UJ;case 5125:return kJ;case 36294:return GJ;case 36295:return HJ;case 36296:return zJ;case 35678:case 36198:case 36298:case 36306:case 35682:return QJ;case 35679:case 36299:case 36307:return VJ;case 35680:case 36300:case 36308:case 36293:return jJ;case 36289:case 36303:case 36311:case 36292:return qJ}}class YJ{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=IJ(t.type)}}class XJ{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=KJ(t.type)}}class WJ{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,a=i.length;r!==a;++r){const o=i[r];o.setValue(e,t[o.id],n)}}}const MI=/(\w+)(\])?(\[|\.)?/g;function fP(s,e){s.seq.push(e),s.map[e.id]=e}function $J(s,e,t){const n=s.name,i=n.length;for(MI.lastIndex=0;;){const r=MI.exec(n),a=MI.lastIndex;let o=r[1];const l=r[2]==="]",c=r[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===i){fP(t,c===void 0?new YJ(o,s,e):new XJ(o,s,e));break}else{let f=t.map[o];f===void 0&&(f=new WJ(o),fP(t,f)),t=f}}}class XS{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const r=e.getActiveUniform(t,i),a=e.getUniformLocation(t,r.name);$J(r,a,this)}}setValue(e,t,n,i){const r=this.map[t];r!==void 0&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,a=t.length;r!==a;++r){const o=t[r],l=n[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const a=e[i];a.id in t&&n.push(a)}return n}}function dP(s,e,t){const n=s.createShader(e);return s.shaderSource(n,t),s.compileShader(n),n}const JJ=37297;let ZJ=0;function eZ(s,e){const t=s.split(`
`),n=[],i=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let a=i;a<r;a++){const o=a+1;n.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return n.join(`
`)}const pP=new un;function tZ(s){Jn._getMatrix(pP,Jn.workingColorSpace,s);const e=`mat3( ${pP.elements.map(t=>t.toFixed(4))} )`;switch(Jn.getTransfer(s)){case Hv:return[e,"LinearTransferOETF"];case Ei:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",s),[e,"LinearTransferOETF"]}}function mP(s,e,t){const n=s.getShaderParameter(e,s.COMPILE_STATUS),r=(s.getShaderInfoLog(e)||"").trim();if(n&&r==="")return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const o=parseInt(a[1]);return t.toUpperCase()+`

`+r+`

`+eZ(s.getShaderSource(e),o)}else return r}function nZ(s,e){const t=tZ(e);return[`vec4 ${s}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function iZ(s,e){let t;switch(e){case rk:t="Linear";break;case ak:t="Reinhard";break;case ok:t="Cineon";break;case sB:t="ACESFilmic";break;case ck:t="AgX";break;case uk:t="Neutral";break;case lk:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+s+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const yS=new de;function sZ(){Jn.getLuminanceCoefficients(yS);const s=yS.x.toFixed(4),e=yS.y.toFixed(4),t=yS.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${s}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function rZ(s){return[s.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",s.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(rv).join(`
`)}function aZ(s){const e=[];for(const t in s){const n=s[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function oZ(s,e){const t={},n=s.getProgramParameter(e,s.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const r=s.getActiveAttrib(e,i),a=r.name;let o=1;r.type===s.FLOAT_MAT2&&(o=2),r.type===s.FLOAT_MAT3&&(o=3),r.type===s.FLOAT_MAT4&&(o=4),t[a]={type:r.type,location:s.getAttribLocation(e,a),locationSize:o}}return t}function rv(s){return s!==""}function gP(s,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return s.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function AP(s,e){return s.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const lZ=/^[ \t]*#include +<([\w\d./]+)>/gm;function Pw(s){return s.replace(lZ,uZ)}const cZ=new Map;function uZ(s,e){let t=Dn[e];if(t===void 0){const n=cZ.get(e);if(n!==void 0)t=Dn[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return Pw(t)}const hZ=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function yP(s){return s.replace(hZ,fZ)}function fZ(s,e,t,n){let i="";for(let r=parseInt(e);r<parseInt(t);r++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return i}function vP(s){let e=`precision ${s.precision} float;
	precision ${s.precision} int;
	precision ${s.precision} sampler2D;
	precision ${s.precision} samplerCube;
	precision ${s.precision} sampler3D;
	precision ${s.precision} sampler2DArray;
	precision ${s.precision} sampler2DShadow;
	precision ${s.precision} samplerCubeShadow;
	precision ${s.precision} sampler2DArrayShadow;
	precision ${s.precision} isampler2D;
	precision ${s.precision} isampler3D;
	precision ${s.precision} isamplerCube;
	precision ${s.precision} isampler2DArray;
	precision ${s.precision} usampler2D;
	precision ${s.precision} usampler3D;
	precision ${s.precision} usamplerCube;
	precision ${s.precision} usampler2DArray;
	`;return s.precision==="highp"?e+=`
#define HIGH_PRECISION`:s.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:s.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function dZ(s){let e="SHADOWMAP_TYPE_BASIC";return s.shadowMapType===CT?e="SHADOWMAP_TYPE_PCF":s.shadowMapType===hv?e="SHADOWMAP_TYPE_PCF_SOFT":s.shadowMapType===lc&&(e="SHADOWMAP_TYPE_VSM"),e}function pZ(s){let e="ENVMAP_TYPE_CUBE";if(s.envMap)switch(s.envMapMode){case Tu:case cd:e="ENVMAP_TYPE_CUBE";break;case r0:e="ENVMAP_TYPE_CUBE_UV";break}return e}function mZ(s){let e="ENVMAP_MODE_REFLECTION";if(s.envMap)switch(s.envMapMode){case cd:e="ENVMAP_MODE_REFRACTION";break}return e}function gZ(s){let e="ENVMAP_BLENDING_NONE";if(s.envMap)switch(s.combine){case dE:e="ENVMAP_BLENDING_MULTIPLY";break;case ik:e="ENVMAP_BLENDING_MIX";break;case sk:e="ENVMAP_BLENDING_ADD";break}return e}function AZ(s){const e=s.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function yZ(s,e,t,n){const i=s.getContext(),r=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=dZ(t),c=pZ(t),h=mZ(t),f=gZ(t),p=AZ(t),g=rZ(t),y=aZ(r),x=i.createProgram();let E,_,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(E=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(rv).join(`
`),E.length>0&&(E+=`
`),_=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(rv).join(`
`),_.length>0&&(_+=`
`)):(E=[vP(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reversedDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(rv).join(`
`),_=[vP(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+f:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reversedDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==hc?"#define TONE_MAPPING":"",t.toneMapping!==hc?Dn.tonemapping_pars_fragment:"",t.toneMapping!==hc?iZ("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Dn.colorspace_pars_fragment,nZ("linearToOutputTexel",t.outputColorSpace),sZ(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(rv).join(`
`)),a=Pw(a),a=gP(a,t),a=AP(a,t),o=Pw(o),o=gP(o,t),o=AP(o,t),a=yP(a),o=yP(o),t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,E=[g,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+E,_=["#define varying in",t.glslVersion===Iw?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Iw?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);const C=b+E+a,I=b+_+o,M=dP(i,i.VERTEX_SHADER,C),R=dP(i,i.FRAGMENT_SHADER,I);i.attachShader(x,M),i.attachShader(x,R),t.index0AttributeName!==void 0?i.bindAttribLocation(x,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(x,0,"position"),i.linkProgram(x);function D(U){if(s.debug.checkShaderErrors){const j=i.getProgramInfoLog(x)||"",H=i.getShaderInfoLog(M)||"",z=i.getShaderInfoLog(R)||"",q=j.trim(),k=H.trim(),W=z.trim();let V=!0,X=!0;if(i.getProgramParameter(x,i.LINK_STATUS)===!1)if(V=!1,typeof s.debug.onShaderError=="function")s.debug.onShaderError(i,x,M,R);else{const K=mP(i,M,"vertex"),te=mP(i,R,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(x,i.VALIDATE_STATUS)+`

Material Name: `+U.name+`
Material Type: `+U.type+`

Program Info Log: `+q+`
`+K+`
`+te)}else q!==""?console.warn("THREE.WebGLProgram: Program Info Log:",q):(k===""||W==="")&&(X=!1);X&&(U.diagnostics={runnable:V,programLog:q,vertexShader:{log:k,prefix:E},fragmentShader:{log:W,prefix:_}})}i.deleteShader(M),i.deleteShader(R),P=new XS(i,x),L=oZ(i,x)}let P;this.getUniforms=function(){return P===void 0&&D(this),P};let L;this.getAttributes=function(){return L===void 0&&D(this),L};let O=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return O===!1&&(O=i.getProgramParameter(x,JJ)),O},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(x),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=ZJ++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=M,this.fragmentShader=R,this}let vZ=0;class EZ{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(r)===!1&&(a.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new xZ(e),t.set(e,n)),n}}class xZ{constructor(e){this.id=vZ++,this.code=e,this.usedTimes=0}}function _Z(s,e,t,n,i,r,a){const o=new VA,l=new EZ,c=new Set,h=[],f=i.logarithmicDepthBuffer,p=i.vertexTextures;let g=i.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function x(L){return c.add(L),L===0?"uv":`uv${L}`}function E(L,O,U,j,H){const z=j.fog,q=H.geometry,k=L.isMeshStandardMaterial?j.environment:null,W=(L.isMeshStandardMaterial?t:e).get(L.envMap||k),V=W&&W.mapping===r0?W.image.height:null,X=y[L.type];L.precision!==null&&(g=i.getMaxPrecision(L.precision),g!==L.precision&&console.warn("THREE.WebGLProgram.getParameters:",L.precision,"not supported, using",g,"instead."));const K=q.morphAttributes.position||q.morphAttributes.normal||q.morphAttributes.color,te=K!==void 0?K.length:0;let oe=0;q.morphAttributes.position!==void 0&&(oe=1),q.morphAttributes.normal!==void 0&&(oe=2),q.morphAttributes.color!==void 0&&(oe=3);let Ee,Ce,se,ie;if(X){const Ln=Do[X];Ee=Ln.vertexShader,Ce=Ln.fragmentShader}else Ee=L.vertexShader,Ce=L.fragmentShader,l.update(L),se=l.getVertexShaderID(L),ie=l.getFragmentShaderID(L);const ne=s.getRenderTarget(),re=s.state.buffers.depth.getReversed(),Be=H.isInstancedMesh===!0,Ge=H.isBatchedMesh===!0,Ue=!!L.map,nt=!!L.matcap,pe=!!W,ve=!!L.aoMap,Ae=!!L.lightMap,Se=!!L.bumpMap,be=!!L.normalMap,Re=!!L.displacementMap,me=!!L.emissiveMap,ue=!!L.metalnessMap,$e=!!L.roughnessMap,gt=L.anisotropy>0,ge=L.clearcoat>0,ae=L.dispersion>0,Pe=L.iridescence>0,Ve=L.sheen>0,rt=L.transmission>0,et=gt&&!!L.anisotropyMap,Mt=ge&&!!L.clearcoatMap,Et=ge&&!!L.clearcoatNormalMap,Rt=ge&&!!L.clearcoatRoughnessMap,Gt=Pe&&!!L.iridescenceMap,pt=Pe&&!!L.iridescenceThicknessMap,At=Ve&&!!L.sheenColorMap,Qt=Ve&&!!L.sheenRoughnessMap,Ut=!!L.specularMap,vt=!!L.specularColorMap,Vt=!!L.specularIntensityMap,Oe=rt&&!!L.transmissionMap,Qe=rt&&!!L.thicknessMap,St=!!L.gradientMap,Nt=!!L.alphaMap,yt=L.alphaTest>0,dt=!!L.alphaHash,zt=!!L.extensions;let tn=hc;L.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(tn=s.toneMapping);const Un={shaderID:X,shaderType:L.type,shaderName:L.name,vertexShader:Ee,fragmentShader:Ce,defines:L.defines,customVertexShaderID:se,customFragmentShaderID:ie,isRawShaderMaterial:L.isRawShaderMaterial===!0,glslVersion:L.glslVersion,precision:g,batching:Ge,batchingColor:Ge&&H._colorsTexture!==null,instancing:Be,instancingColor:Be&&H.instanceColor!==null,instancingMorph:Be&&H.morphTexture!==null,supportsVertexTextures:p,outputColorSpace:ne===null?s.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:ud,alphaToCoverage:!!L.alphaToCoverage,map:Ue,matcap:nt,envMap:pe,envMapMode:pe&&W.mapping,envMapCubeUVHeight:V,aoMap:ve,lightMap:Ae,bumpMap:Se,normalMap:be,displacementMap:p&&Re,emissiveMap:me,normalMapObjectSpace:be&&L.normalMapType===Ak,normalMapTangentSpace:be&&L.normalMapType===yd,metalnessMap:ue,roughnessMap:$e,anisotropy:gt,anisotropyMap:et,clearcoat:ge,clearcoatMap:Mt,clearcoatNormalMap:Et,clearcoatRoughnessMap:Rt,dispersion:ae,iridescence:Pe,iridescenceMap:Gt,iridescenceThicknessMap:pt,sheen:Ve,sheenColorMap:At,sheenRoughnessMap:Qt,specularMap:Ut,specularColorMap:vt,specularIntensityMap:Vt,transmission:rt,transmissionMap:Oe,thicknessMap:Qe,gradientMap:St,opaque:L.transparent===!1&&L.blending===nm&&L.alphaToCoverage===!1,alphaMap:Nt,alphaTest:yt,alphaHash:dt,combine:L.combine,mapUv:Ue&&x(L.map.channel),aoMapUv:ve&&x(L.aoMap.channel),lightMapUv:Ae&&x(L.lightMap.channel),bumpMapUv:Se&&x(L.bumpMap.channel),normalMapUv:be&&x(L.normalMap.channel),displacementMapUv:Re&&x(L.displacementMap.channel),emissiveMapUv:me&&x(L.emissiveMap.channel),metalnessMapUv:ue&&x(L.metalnessMap.channel),roughnessMapUv:$e&&x(L.roughnessMap.channel),anisotropyMapUv:et&&x(L.anisotropyMap.channel),clearcoatMapUv:Mt&&x(L.clearcoatMap.channel),clearcoatNormalMapUv:Et&&x(L.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Rt&&x(L.clearcoatRoughnessMap.channel),iridescenceMapUv:Gt&&x(L.iridescenceMap.channel),iridescenceThicknessMapUv:pt&&x(L.iridescenceThicknessMap.channel),sheenColorMapUv:At&&x(L.sheenColorMap.channel),sheenRoughnessMapUv:Qt&&x(L.sheenRoughnessMap.channel),specularMapUv:Ut&&x(L.specularMap.channel),specularColorMapUv:vt&&x(L.specularColorMap.channel),specularIntensityMapUv:Vt&&x(L.specularIntensityMap.channel),transmissionMapUv:Oe&&x(L.transmissionMap.channel),thicknessMapUv:Qe&&x(L.thicknessMap.channel),alphaMapUv:Nt&&x(L.alphaMap.channel),vertexTangents:!!q.attributes.tangent&&(be||gt),vertexColors:L.vertexColors,vertexAlphas:L.vertexColors===!0&&!!q.attributes.color&&q.attributes.color.itemSize===4,pointsUvs:H.isPoints===!0&&!!q.attributes.uv&&(Ue||Nt),fog:!!z,useFog:L.fog===!0,fogExp2:!!z&&z.isFogExp2,flatShading:L.flatShading===!0&&L.wireframe===!1,sizeAttenuation:L.sizeAttenuation===!0,logarithmicDepthBuffer:f,reversedDepthBuffer:re,skinning:H.isSkinnedMesh===!0,morphTargets:q.morphAttributes.position!==void 0,morphNormals:q.morphAttributes.normal!==void 0,morphColors:q.morphAttributes.color!==void 0,morphTargetsCount:te,morphTextureStride:oe,numDirLights:O.directional.length,numPointLights:O.point.length,numSpotLights:O.spot.length,numSpotLightMaps:O.spotLightMap.length,numRectAreaLights:O.rectArea.length,numHemiLights:O.hemi.length,numDirLightShadows:O.directionalShadowMap.length,numPointLightShadows:O.pointShadowMap.length,numSpotLightShadows:O.spotShadowMap.length,numSpotLightShadowsWithMaps:O.numSpotLightShadowsWithMaps,numLightProbes:O.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:L.dithering,shadowMapEnabled:s.shadowMap.enabled&&U.length>0,shadowMapType:s.shadowMap.type,toneMapping:tn,decodeVideoTexture:Ue&&L.map.isVideoTexture===!0&&Jn.getTransfer(L.map.colorSpace)===Ei,decodeVideoTextureEmissive:me&&L.emissiveMap.isVideoTexture===!0&&Jn.getTransfer(L.emissiveMap.colorSpace)===Ei,premultipliedAlpha:L.premultipliedAlpha,doubleSided:L.side===cc,flipSided:L.side===wa,useDepthPacking:L.depthPacking>=0,depthPacking:L.depthPacking||0,index0AttributeName:L.index0AttributeName,extensionClipCullDistance:zt&&L.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(zt&&L.extensions.multiDraw===!0||Ge)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:L.customProgramCacheKey()};return Un.vertexUv1s=c.has(1),Un.vertexUv2s=c.has(2),Un.vertexUv3s=c.has(3),c.clear(),Un}function _(L){const O=[];if(L.shaderID?O.push(L.shaderID):(O.push(L.customVertexShaderID),O.push(L.customFragmentShaderID)),L.defines!==void 0)for(const U in L.defines)O.push(U),O.push(L.defines[U]);return L.isRawShaderMaterial===!1&&(b(O,L),C(O,L),O.push(s.outputColorSpace)),O.push(L.customProgramCacheKey),O.join()}function b(L,O){L.push(O.precision),L.push(O.outputColorSpace),L.push(O.envMapMode),L.push(O.envMapCubeUVHeight),L.push(O.mapUv),L.push(O.alphaMapUv),L.push(O.lightMapUv),L.push(O.aoMapUv),L.push(O.bumpMapUv),L.push(O.normalMapUv),L.push(O.displacementMapUv),L.push(O.emissiveMapUv),L.push(O.metalnessMapUv),L.push(O.roughnessMapUv),L.push(O.anisotropyMapUv),L.push(O.clearcoatMapUv),L.push(O.clearcoatNormalMapUv),L.push(O.clearcoatRoughnessMapUv),L.push(O.iridescenceMapUv),L.push(O.iridescenceThicknessMapUv),L.push(O.sheenColorMapUv),L.push(O.sheenRoughnessMapUv),L.push(O.specularMapUv),L.push(O.specularColorMapUv),L.push(O.specularIntensityMapUv),L.push(O.transmissionMapUv),L.push(O.thicknessMapUv),L.push(O.combine),L.push(O.fogExp2),L.push(O.sizeAttenuation),L.push(O.morphTargetsCount),L.push(O.morphAttributeCount),L.push(O.numDirLights),L.push(O.numPointLights),L.push(O.numSpotLights),L.push(O.numSpotLightMaps),L.push(O.numHemiLights),L.push(O.numRectAreaLights),L.push(O.numDirLightShadows),L.push(O.numPointLightShadows),L.push(O.numSpotLightShadows),L.push(O.numSpotLightShadowsWithMaps),L.push(O.numLightProbes),L.push(O.shadowMapType),L.push(O.toneMapping),L.push(O.numClippingPlanes),L.push(O.numClipIntersection),L.push(O.depthPacking)}function C(L,O){o.disableAll(),O.supportsVertexTextures&&o.enable(0),O.instancing&&o.enable(1),O.instancingColor&&o.enable(2),O.instancingMorph&&o.enable(3),O.matcap&&o.enable(4),O.envMap&&o.enable(5),O.normalMapObjectSpace&&o.enable(6),O.normalMapTangentSpace&&o.enable(7),O.clearcoat&&o.enable(8),O.iridescence&&o.enable(9),O.alphaTest&&o.enable(10),O.vertexColors&&o.enable(11),O.vertexAlphas&&o.enable(12),O.vertexUv1s&&o.enable(13),O.vertexUv2s&&o.enable(14),O.vertexUv3s&&o.enable(15),O.vertexTangents&&o.enable(16),O.anisotropy&&o.enable(17),O.alphaHash&&o.enable(18),O.batching&&o.enable(19),O.dispersion&&o.enable(20),O.batchingColor&&o.enable(21),O.gradientMap&&o.enable(22),L.push(o.mask),o.disableAll(),O.fog&&o.enable(0),O.useFog&&o.enable(1),O.flatShading&&o.enable(2),O.logarithmicDepthBuffer&&o.enable(3),O.reversedDepthBuffer&&o.enable(4),O.skinning&&o.enable(5),O.morphTargets&&o.enable(6),O.morphNormals&&o.enable(7),O.morphColors&&o.enable(8),O.premultipliedAlpha&&o.enable(9),O.shadowMapEnabled&&o.enable(10),O.doubleSided&&o.enable(11),O.flipSided&&o.enable(12),O.useDepthPacking&&o.enable(13),O.dithering&&o.enable(14),O.transmission&&o.enable(15),O.sheen&&o.enable(16),O.opaque&&o.enable(17),O.pointsUvs&&o.enable(18),O.decodeVideoTexture&&o.enable(19),O.decodeVideoTextureEmissive&&o.enable(20),O.alphaToCoverage&&o.enable(21),L.push(o.mask)}function I(L){const O=y[L.type];let U;if(O){const j=Do[O];U=UT.clone(j.uniforms)}else U=L.uniforms;return U}function M(L,O){let U;for(let j=0,H=h.length;j<H;j++){const z=h[j];if(z.cacheKey===O){U=z,++U.usedTimes;break}}return U===void 0&&(U=new yZ(s,O,L,r),h.push(U)),U}function R(L){if(--L.usedTimes===0){const O=h.indexOf(L);h[O]=h[h.length-1],h.pop(),L.destroy()}}function D(L){l.remove(L)}function P(){l.dispose()}return{getParameters:E,getProgramCacheKey:_,getUniforms:I,acquireProgram:M,releaseProgram:R,releaseShaderCache:D,programs:h,dispose:P}}function SZ(){let s=new WeakMap;function e(a){return s.has(a)}function t(a){let o=s.get(a);return o===void 0&&(o={},s.set(a,o)),o}function n(a){s.delete(a)}function i(a,o,l){s.get(a)[o]=l}function r(){s=new WeakMap}return{has:e,get:t,remove:n,update:i,dispose:r}}function bZ(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.material.id!==e.material.id?s.material.id-e.material.id:s.z!==e.z?s.z-e.z:s.id-e.id}function EP(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function xP(){const s=[];let e=0;const t=[],n=[],i=[];function r(){e=0,t.length=0,n.length=0,i.length=0}function a(f,p,g,y,x,E){let _=s[e];return _===void 0?(_={id:f.id,object:f,geometry:p,material:g,groupOrder:y,renderOrder:f.renderOrder,z:x,group:E},s[e]=_):(_.id=f.id,_.object=f,_.geometry=p,_.material=g,_.groupOrder=y,_.renderOrder=f.renderOrder,_.z=x,_.group=E),e++,_}function o(f,p,g,y,x,E){const _=a(f,p,g,y,x,E);g.transmission>0?n.push(_):g.transparent===!0?i.push(_):t.push(_)}function l(f,p,g,y,x,E){const _=a(f,p,g,y,x,E);g.transmission>0?n.unshift(_):g.transparent===!0?i.unshift(_):t.unshift(_)}function c(f,p){t.length>1&&t.sort(f||bZ),n.length>1&&n.sort(p||EP),i.length>1&&i.sort(p||EP)}function h(){for(let f=e,p=s.length;f<p;f++){const g=s[f];if(g.id===null)break;g.id=null,g.object=null,g.geometry=null,g.material=null,g.group=null}}return{opaque:t,transmissive:n,transparent:i,init:r,push:o,unshift:l,finish:h,sort:c}}function TZ(){let s=new WeakMap;function e(n,i){const r=s.get(n);let a;return r===void 0?(a=new xP,s.set(n,[a])):i>=r.length?(a=new xP,r.push(a)):a=r[i],a}function t(){s=new WeakMap}return{get:e,dispose:t}}function CZ(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new de,color:new Tt};break;case"SpotLight":t={position:new de,direction:new de,color:new Tt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new de,color:new Tt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new de,skyColor:new Tt,groundColor:new Tt};break;case"RectAreaLight":t={color:new Tt,position:new de,halfWidth:new de,halfHeight:new de};break}return s[e.id]=t,t}}}function IZ(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new We};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new We};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new We,shadowCameraNear:1,shadowCameraFar:1e3};break}return s[e.id]=t,t}}}let MZ=0;function wZ(s,e){return(e.castShadow?2:0)-(s.castShadow?2:0)+(e.map?1:0)-(s.map?1:0)}function RZ(s){const e=new CZ,t=IZ(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)n.probe.push(new de);const i=new de,r=new Pt,a=new Pt;function o(c){let h=0,f=0,p=0;for(let L=0;L<9;L++)n.probe[L].set(0,0,0);let g=0,y=0,x=0,E=0,_=0,b=0,C=0,I=0,M=0,R=0,D=0;c.sort(wZ);for(let L=0,O=c.length;L<O;L++){const U=c[L],j=U.color,H=U.intensity,z=U.distance,q=U.shadow&&U.shadow.map?U.shadow.map.texture:null;if(U.isAmbientLight)h+=j.r*H,f+=j.g*H,p+=j.b*H;else if(U.isLightProbe){for(let k=0;k<9;k++)n.probe[k].addScaledVector(U.sh.coefficients[k],H);D++}else if(U.isDirectionalLight){const k=e.get(U);if(k.color.copy(U.color).multiplyScalar(U.intensity),U.castShadow){const W=U.shadow,V=t.get(U);V.shadowIntensity=W.intensity,V.shadowBias=W.bias,V.shadowNormalBias=W.normalBias,V.shadowRadius=W.radius,V.shadowMapSize=W.mapSize,n.directionalShadow[g]=V,n.directionalShadowMap[g]=q,n.directionalShadowMatrix[g]=U.shadow.matrix,b++}n.directional[g]=k,g++}else if(U.isSpotLight){const k=e.get(U);k.position.setFromMatrixPosition(U.matrixWorld),k.color.copy(j).multiplyScalar(H),k.distance=z,k.coneCos=Math.cos(U.angle),k.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),k.decay=U.decay,n.spot[x]=k;const W=U.shadow;if(U.map&&(n.spotLightMap[M]=U.map,M++,W.updateMatrices(U),U.castShadow&&R++),n.spotLightMatrix[x]=W.matrix,U.castShadow){const V=t.get(U);V.shadowIntensity=W.intensity,V.shadowBias=W.bias,V.shadowNormalBias=W.normalBias,V.shadowRadius=W.radius,V.shadowMapSize=W.mapSize,n.spotShadow[x]=V,n.spotShadowMap[x]=q,I++}x++}else if(U.isRectAreaLight){const k=e.get(U);k.color.copy(j).multiplyScalar(H),k.halfWidth.set(U.width*.5,0,0),k.halfHeight.set(0,U.height*.5,0),n.rectArea[E]=k,E++}else if(U.isPointLight){const k=e.get(U);if(k.color.copy(U.color).multiplyScalar(U.intensity),k.distance=U.distance,k.decay=U.decay,U.castShadow){const W=U.shadow,V=t.get(U);V.shadowIntensity=W.intensity,V.shadowBias=W.bias,V.shadowNormalBias=W.normalBias,V.shadowRadius=W.radius,V.shadowMapSize=W.mapSize,V.shadowCameraNear=W.camera.near,V.shadowCameraFar=W.camera.far,n.pointShadow[y]=V,n.pointShadowMap[y]=q,n.pointShadowMatrix[y]=U.shadow.matrix,C++}n.point[y]=k,y++}else if(U.isHemisphereLight){const k=e.get(U);k.skyColor.copy(U.color).multiplyScalar(H),k.groundColor.copy(U.groundColor).multiplyScalar(H),n.hemi[_]=k,_++}}E>0&&(s.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Ot.LTC_FLOAT_1,n.rectAreaLTC2=Ot.LTC_FLOAT_2):(n.rectAreaLTC1=Ot.LTC_HALF_1,n.rectAreaLTC2=Ot.LTC_HALF_2)),n.ambient[0]=h,n.ambient[1]=f,n.ambient[2]=p;const P=n.hash;(P.directionalLength!==g||P.pointLength!==y||P.spotLength!==x||P.rectAreaLength!==E||P.hemiLength!==_||P.numDirectionalShadows!==b||P.numPointShadows!==C||P.numSpotShadows!==I||P.numSpotMaps!==M||P.numLightProbes!==D)&&(n.directional.length=g,n.spot.length=x,n.rectArea.length=E,n.point.length=y,n.hemi.length=_,n.directionalShadow.length=b,n.directionalShadowMap.length=b,n.pointShadow.length=C,n.pointShadowMap.length=C,n.spotShadow.length=I,n.spotShadowMap.length=I,n.directionalShadowMatrix.length=b,n.pointShadowMatrix.length=C,n.spotLightMatrix.length=I+M-R,n.spotLightMap.length=M,n.numSpotLightShadowsWithMaps=R,n.numLightProbes=D,P.directionalLength=g,P.pointLength=y,P.spotLength=x,P.rectAreaLength=E,P.hemiLength=_,P.numDirectionalShadows=b,P.numPointShadows=C,P.numSpotShadows=I,P.numSpotMaps=M,P.numLightProbes=D,n.version=MZ++)}function l(c,h){let f=0,p=0,g=0,y=0,x=0;const E=h.matrixWorldInverse;for(let _=0,b=c.length;_<b;_++){const C=c[_];if(C.isDirectionalLight){const I=n.directional[f];I.direction.setFromMatrixPosition(C.matrixWorld),i.setFromMatrixPosition(C.target.matrixWorld),I.direction.sub(i),I.direction.transformDirection(E),f++}else if(C.isSpotLight){const I=n.spot[g];I.position.setFromMatrixPosition(C.matrixWorld),I.position.applyMatrix4(E),I.direction.setFromMatrixPosition(C.matrixWorld),i.setFromMatrixPosition(C.target.matrixWorld),I.direction.sub(i),I.direction.transformDirection(E),g++}else if(C.isRectAreaLight){const I=n.rectArea[y];I.position.setFromMatrixPosition(C.matrixWorld),I.position.applyMatrix4(E),a.identity(),r.copy(C.matrixWorld),r.premultiply(E),a.extractRotation(r),I.halfWidth.set(C.width*.5,0,0),I.halfHeight.set(0,C.height*.5,0),I.halfWidth.applyMatrix4(a),I.halfHeight.applyMatrix4(a),y++}else if(C.isPointLight){const I=n.point[p];I.position.setFromMatrixPosition(C.matrixWorld),I.position.applyMatrix4(E),p++}else if(C.isHemisphereLight){const I=n.hemi[x];I.direction.setFromMatrixPosition(C.matrixWorld),I.direction.transformDirection(E),x++}}}return{setup:o,setupView:l,state:n}}function _P(s){const e=new RZ(s),t=[],n=[];function i(h){c.camera=h,t.length=0,n.length=0}function r(h){t.push(h)}function a(h){n.push(h)}function o(){e.setup(t)}function l(h){e.setupView(t,h)}const c={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:c,setupLights:o,setupLightsView:l,pushLight:r,pushShadow:a}}function BZ(s){let e=new WeakMap;function t(i,r=0){const a=e.get(i);let o;return a===void 0?(o=new _P(s),e.set(i,[o])):r>=a.length?(o=new _P(s),a.push(o)):o=a[r],o}function n(){e=new WeakMap}return{get:t,dispose:n}}const DZ=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,LZ=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function OZ(s,e,t){let n=new l0;const i=new We,r=new We,a=new Tn,o=new nC({depthPacking:dB}),l=new BB,c={},h=t.maxTextureSize,f={[bu]:wa,[wa]:bu,[cc]:cc},p=new Ra({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new We},radius:{value:4}},vertexShader:DZ,fragmentShader:LZ}),g=p.clone();g.defines.HORIZONTAL_PASS=1;const y=new hn;y.setAttribute("position",new ei(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new bi(y,p),E=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=CT;let _=this.type;this.render=function(R,D,P){if(E.enabled===!1||E.autoUpdate===!1&&E.needsUpdate===!1||R.length===0)return;const L=s.getRenderTarget(),O=s.getActiveCubeFace(),U=s.getActiveMipmapLevel(),j=s.state;j.setBlending(Eu),j.buffers.depth.getReversed()?j.buffers.color.setClear(0,0,0,0):j.buffers.color.setClear(1,1,1,1),j.buffers.depth.setTest(!0),j.setScissorTest(!1);const H=_!==lc&&this.type===lc,z=_===lc&&this.type!==lc;for(let q=0,k=R.length;q<k;q++){const W=R[q],V=W.shadow;if(V===void 0){console.warn("THREE.WebGLShadowMap:",W,"has no shadow.");continue}if(V.autoUpdate===!1&&V.needsUpdate===!1)continue;i.copy(V.mapSize);const X=V.getFrameExtents();if(i.multiply(X),r.copy(V.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(r.x=Math.floor(h/X.x),i.x=r.x*X.x,V.mapSize.x=r.x),i.y>h&&(r.y=Math.floor(h/X.y),i.y=r.y*X.y,V.mapSize.y=r.y)),V.map===null||H===!0||z===!0){const te=this.type!==lc?{minFilter:Ws,magFilter:Ws}:{};V.map!==null&&V.map.dispose(),V.map=new _l(i.x,i.y,te),V.map.texture.name=W.name+".shadowMap",V.camera.updateProjectionMatrix()}s.setRenderTarget(V.map),s.clear();const K=V.getViewportCount();for(let te=0;te<K;te++){const oe=V.getViewport(te);a.set(r.x*oe.x,r.y*oe.y,r.x*oe.z,r.y*oe.w),j.viewport(a),V.updateMatrices(W,te),n=V.getFrustum(),I(D,P,V.camera,W,this.type)}V.isPointLightShadow!==!0&&this.type===lc&&b(V,P),V.needsUpdate=!1}_=this.type,E.needsUpdate=!1,s.setRenderTarget(L,O,U)};function b(R,D){const P=e.update(x);p.defines.VSM_SAMPLES!==R.blurSamples&&(p.defines.VSM_SAMPLES=R.blurSamples,g.defines.VSM_SAMPLES=R.blurSamples,p.needsUpdate=!0,g.needsUpdate=!0),R.mapPass===null&&(R.mapPass=new _l(i.x,i.y)),p.uniforms.shadow_pass.value=R.map.texture,p.uniforms.resolution.value=R.mapSize,p.uniforms.radius.value=R.radius,s.setRenderTarget(R.mapPass),s.clear(),s.renderBufferDirect(D,null,P,p,x,null),g.uniforms.shadow_pass.value=R.mapPass.texture,g.uniforms.resolution.value=R.mapSize,g.uniforms.radius.value=R.radius,s.setRenderTarget(R.map),s.clear(),s.renderBufferDirect(D,null,P,g,x,null)}function C(R,D,P,L){let O=null;const U=P.isPointLight===!0?R.customDistanceMaterial:R.customDepthMaterial;if(U!==void 0)O=U;else if(O=P.isPointLight===!0?l:o,s.localClippingEnabled&&D.clipShadows===!0&&Array.isArray(D.clippingPlanes)&&D.clippingPlanes.length!==0||D.displacementMap&&D.displacementScale!==0||D.alphaMap&&D.alphaTest>0||D.map&&D.alphaTest>0||D.alphaToCoverage===!0){const j=O.uuid,H=D.uuid;let z=c[j];z===void 0&&(z={},c[j]=z);let q=z[H];q===void 0&&(q=O.clone(),z[H]=q,D.addEventListener("dispose",M)),O=q}if(O.visible=D.visible,O.wireframe=D.wireframe,L===lc?O.side=D.shadowSide!==null?D.shadowSide:D.side:O.side=D.shadowSide!==null?D.shadowSide:f[D.side],O.alphaMap=D.alphaMap,O.alphaTest=D.alphaToCoverage===!0?.5:D.alphaTest,O.map=D.map,O.clipShadows=D.clipShadows,O.clippingPlanes=D.clippingPlanes,O.clipIntersection=D.clipIntersection,O.displacementMap=D.displacementMap,O.displacementScale=D.displacementScale,O.displacementBias=D.displacementBias,O.wireframeLinewidth=D.wireframeLinewidth,O.linewidth=D.linewidth,P.isPointLight===!0&&O.isMeshDistanceMaterial===!0){const j=s.properties.get(O);j.light=P}return O}function I(R,D,P,L,O){if(R.visible===!1)return;if(R.layers.test(D.layers)&&(R.isMesh||R.isLine||R.isPoints)&&(R.castShadow||R.receiveShadow&&O===lc)&&(!R.frustumCulled||n.intersectsObject(R))){R.modelViewMatrix.multiplyMatrices(P.matrixWorldInverse,R.matrixWorld);const H=e.update(R),z=R.material;if(Array.isArray(z)){const q=H.groups;for(let k=0,W=q.length;k<W;k++){const V=q[k],X=z[V.materialIndex];if(X&&X.visible){const K=C(R,X,L,O);R.onBeforeShadow(s,R,D,P,H,K,V),s.renderBufferDirect(P,null,H,K,R,V),R.onAfterShadow(s,R,D,P,H,K,V)}}}else if(z.visible){const q=C(R,z,L,O);R.onBeforeShadow(s,R,D,P,H,q,null),s.renderBufferDirect(P,null,H,q,R,null),R.onAfterShadow(s,R,D,P,H,q,null)}}const j=R.children;for(let H=0,z=j.length;H<z;H++)I(j[H],D,P,L,O)}function M(R){R.target.removeEventListener("dispose",M);for(const P in c){const L=c[P],O=R.target.uuid;O in L&&(L[O].dispose(),delete L[O])}}}const PZ={[Sb]:bb,[Tb]:Mb,[Cb]:wb,[hm]:Ib,[bb]:Sb,[Mb]:Tb,[wb]:Cb,[Ib]:hm};function NZ(s,e){function t(){let Oe=!1;const Qe=new Tn;let St=null;const Nt=new Tn(0,0,0,0);return{setMask:function(yt){St!==yt&&!Oe&&(s.colorMask(yt,yt,yt,yt),St=yt)},setLocked:function(yt){Oe=yt},setClear:function(yt,dt,zt,tn,Un){Un===!0&&(yt*=tn,dt*=tn,zt*=tn),Qe.set(yt,dt,zt,tn),Nt.equals(Qe)===!1&&(s.clearColor(yt,dt,zt,tn),Nt.copy(Qe))},reset:function(){Oe=!1,St=null,Nt.set(-1,0,0,0)}}}function n(){let Oe=!1,Qe=!1,St=null,Nt=null,yt=null;return{setReversed:function(dt){if(Qe!==dt){const zt=e.get("EXT_clip_control");dt?zt.clipControlEXT(zt.LOWER_LEFT_EXT,zt.ZERO_TO_ONE_EXT):zt.clipControlEXT(zt.LOWER_LEFT_EXT,zt.NEGATIVE_ONE_TO_ONE_EXT),Qe=dt;const tn=yt;yt=null,this.setClear(tn)}},getReversed:function(){return Qe},setTest:function(dt){dt?ne(s.DEPTH_TEST):re(s.DEPTH_TEST)},setMask:function(dt){St!==dt&&!Oe&&(s.depthMask(dt),St=dt)},setFunc:function(dt){if(Qe&&(dt=PZ[dt]),Nt!==dt){switch(dt){case Sb:s.depthFunc(s.NEVER);break;case bb:s.depthFunc(s.ALWAYS);break;case Tb:s.depthFunc(s.LESS);break;case hm:s.depthFunc(s.LEQUAL);break;case Cb:s.depthFunc(s.EQUAL);break;case Ib:s.depthFunc(s.GEQUAL);break;case Mb:s.depthFunc(s.GREATER);break;case wb:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}Nt=dt}},setLocked:function(dt){Oe=dt},setClear:function(dt){yt!==dt&&(Qe&&(dt=1-dt),s.clearDepth(dt),yt=dt)},reset:function(){Oe=!1,St=null,Nt=null,yt=null,Qe=!1}}}function i(){let Oe=!1,Qe=null,St=null,Nt=null,yt=null,dt=null,zt=null,tn=null,Un=null;return{setTest:function(Ln){Oe||(Ln?ne(s.STENCIL_TEST):re(s.STENCIL_TEST))},setMask:function(Ln){Qe!==Ln&&!Oe&&(s.stencilMask(Ln),Qe=Ln)},setFunc:function(Ln,Hr,$i){(St!==Ln||Nt!==Hr||yt!==$i)&&(s.stencilFunc(Ln,Hr,$i),St=Ln,Nt=Hr,yt=$i)},setOp:function(Ln,Hr,$i){(dt!==Ln||zt!==Hr||tn!==$i)&&(s.stencilOp(Ln,Hr,$i),dt=Ln,zt=Hr,tn=$i)},setLocked:function(Ln){Oe=Ln},setClear:function(Ln){Un!==Ln&&(s.clearStencil(Ln),Un=Ln)},reset:function(){Oe=!1,Qe=null,St=null,Nt=null,yt=null,dt=null,zt=null,tn=null,Un=null}}}const r=new t,a=new n,o=new i,l=new WeakMap,c=new WeakMap;let h={},f={},p=new WeakMap,g=[],y=null,x=!1,E=null,_=null,b=null,C=null,I=null,M=null,R=null,D=new Tt(0,0,0),P=0,L=!1,O=null,U=null,j=null,H=null,z=null;const q=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let k=!1,W=0;const V=s.getParameter(s.VERSION);V.indexOf("WebGL")!==-1?(W=parseFloat(/^WebGL (\d)/.exec(V)[1]),k=W>=1):V.indexOf("OpenGL ES")!==-1&&(W=parseFloat(/^OpenGL ES (\d)/.exec(V)[1]),k=W>=2);let X=null,K={};const te=s.getParameter(s.SCISSOR_BOX),oe=s.getParameter(s.VIEWPORT),Ee=new Tn().fromArray(te),Ce=new Tn().fromArray(oe);function se(Oe,Qe,St,Nt){const yt=new Uint8Array(4),dt=s.createTexture();s.bindTexture(Oe,dt),s.texParameteri(Oe,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(Oe,s.TEXTURE_MAG_FILTER,s.NEAREST);for(let zt=0;zt<St;zt++)Oe===s.TEXTURE_3D||Oe===s.TEXTURE_2D_ARRAY?s.texImage3D(Qe,0,s.RGBA,1,1,Nt,0,s.RGBA,s.UNSIGNED_BYTE,yt):s.texImage2D(Qe+zt,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,yt);return dt}const ie={};ie[s.TEXTURE_2D]=se(s.TEXTURE_2D,s.TEXTURE_2D,1),ie[s.TEXTURE_CUBE_MAP]=se(s.TEXTURE_CUBE_MAP,s.TEXTURE_CUBE_MAP_POSITIVE_X,6),ie[s.TEXTURE_2D_ARRAY]=se(s.TEXTURE_2D_ARRAY,s.TEXTURE_2D_ARRAY,1,1),ie[s.TEXTURE_3D]=se(s.TEXTURE_3D,s.TEXTURE_3D,1,1),r.setClear(0,0,0,1),a.setClear(1),o.setClear(0),ne(s.DEPTH_TEST),a.setFunc(hm),Se(!1),be(xw),ne(s.CULL_FACE),ve(Eu);function ne(Oe){h[Oe]!==!0&&(s.enable(Oe),h[Oe]=!0)}function re(Oe){h[Oe]!==!1&&(s.disable(Oe),h[Oe]=!1)}function Be(Oe,Qe){return f[Oe]!==Qe?(s.bindFramebuffer(Oe,Qe),f[Oe]=Qe,Oe===s.DRAW_FRAMEBUFFER&&(f[s.FRAMEBUFFER]=Qe),Oe===s.FRAMEBUFFER&&(f[s.DRAW_FRAMEBUFFER]=Qe),!0):!1}function Ge(Oe,Qe){let St=g,Nt=!1;if(Oe){St=p.get(Qe),St===void 0&&(St=[],p.set(Qe,St));const yt=Oe.textures;if(St.length!==yt.length||St[0]!==s.COLOR_ATTACHMENT0){for(let dt=0,zt=yt.length;dt<zt;dt++)St[dt]=s.COLOR_ATTACHMENT0+dt;St.length=yt.length,Nt=!0}}else St[0]!==s.BACK&&(St[0]=s.BACK,Nt=!0);Nt&&s.drawBuffers(St)}function Ue(Oe){return y!==Oe?(s.useProgram(Oe),y=Oe,!0):!1}const nt={[qf]:s.FUNC_ADD,[G3]:s.FUNC_SUBTRACT,[H3]:s.FUNC_REVERSE_SUBTRACT};nt[z3]=s.MIN,nt[Q3]=s.MAX;const pe={[V3]:s.ZERO,[j3]:s.ONE,[q3]:s.SRC_COLOR,[xb]:s.SRC_ALPHA,[J3]:s.SRC_ALPHA_SATURATE,[W3]:s.DST_COLOR,[Y3]:s.DST_ALPHA,[K3]:s.ONE_MINUS_SRC_COLOR,[_b]:s.ONE_MINUS_SRC_ALPHA,[$3]:s.ONE_MINUS_DST_COLOR,[X3]:s.ONE_MINUS_DST_ALPHA,[Z3]:s.CONSTANT_COLOR,[ek]:s.ONE_MINUS_CONSTANT_COLOR,[tk]:s.CONSTANT_ALPHA,[nk]:s.ONE_MINUS_CONSTANT_ALPHA};function ve(Oe,Qe,St,Nt,yt,dt,zt,tn,Un,Ln){if(Oe===Eu){x===!0&&(re(s.BLEND),x=!1);return}if(x===!1&&(ne(s.BLEND),x=!0),Oe!==k3){if(Oe!==E||Ln!==L){if((_!==qf||I!==qf)&&(s.blendEquation(s.FUNC_ADD),_=qf,I=qf),Ln)switch(Oe){case nm:s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case _w:s.blendFunc(s.ONE,s.ONE);break;case Sw:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case bw:s.blendFuncSeparate(s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ZERO,s.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",Oe);break}else switch(Oe){case nm:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case _w:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE,s.ONE,s.ONE);break;case Sw:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case bw:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",Oe);break}b=null,C=null,M=null,R=null,D.set(0,0,0),P=0,E=Oe,L=Ln}return}yt=yt||Qe,dt=dt||St,zt=zt||Nt,(Qe!==_||yt!==I)&&(s.blendEquationSeparate(nt[Qe],nt[yt]),_=Qe,I=yt),(St!==b||Nt!==C||dt!==M||zt!==R)&&(s.blendFuncSeparate(pe[St],pe[Nt],pe[dt],pe[zt]),b=St,C=Nt,M=dt,R=zt),(tn.equals(D)===!1||Un!==P)&&(s.blendColor(tn.r,tn.g,tn.b,Un),D.copy(tn),P=Un),E=Oe,L=!1}function Ae(Oe,Qe){Oe.side===cc?re(s.CULL_FACE):ne(s.CULL_FACE);let St=Oe.side===wa;Qe&&(St=!St),Se(St),Oe.blending===nm&&Oe.transparent===!1?ve(Eu):ve(Oe.blending,Oe.blendEquation,Oe.blendSrc,Oe.blendDst,Oe.blendEquationAlpha,Oe.blendSrcAlpha,Oe.blendDstAlpha,Oe.blendColor,Oe.blendAlpha,Oe.premultipliedAlpha),a.setFunc(Oe.depthFunc),a.setTest(Oe.depthTest),a.setMask(Oe.depthWrite),r.setMask(Oe.colorWrite);const Nt=Oe.stencilWrite;o.setTest(Nt),Nt&&(o.setMask(Oe.stencilWriteMask),o.setFunc(Oe.stencilFunc,Oe.stencilRef,Oe.stencilFuncMask),o.setOp(Oe.stencilFail,Oe.stencilZFail,Oe.stencilZPass)),me(Oe.polygonOffset,Oe.polygonOffsetFactor,Oe.polygonOffsetUnits),Oe.alphaToCoverage===!0?ne(s.SAMPLE_ALPHA_TO_COVERAGE):re(s.SAMPLE_ALPHA_TO_COVERAGE)}function Se(Oe){O!==Oe&&(Oe?s.frontFace(s.CW):s.frontFace(s.CCW),O=Oe)}function be(Oe){Oe!==N3?(ne(s.CULL_FACE),Oe!==U&&(Oe===xw?s.cullFace(s.BACK):Oe===F3?s.cullFace(s.FRONT):s.cullFace(s.FRONT_AND_BACK))):re(s.CULL_FACE),U=Oe}function Re(Oe){Oe!==j&&(k&&s.lineWidth(Oe),j=Oe)}function me(Oe,Qe,St){Oe?(ne(s.POLYGON_OFFSET_FILL),(H!==Qe||z!==St)&&(s.polygonOffset(Qe,St),H=Qe,z=St)):re(s.POLYGON_OFFSET_FILL)}function ue(Oe){Oe?ne(s.SCISSOR_TEST):re(s.SCISSOR_TEST)}function $e(Oe){Oe===void 0&&(Oe=s.TEXTURE0+q-1),X!==Oe&&(s.activeTexture(Oe),X=Oe)}function gt(Oe,Qe,St){St===void 0&&(X===null?St=s.TEXTURE0+q-1:St=X);let Nt=K[St];Nt===void 0&&(Nt={type:void 0,texture:void 0},K[St]=Nt),(Nt.type!==Oe||Nt.texture!==Qe)&&(X!==St&&(s.activeTexture(St),X=St),s.bindTexture(Oe,Qe||ie[Oe]),Nt.type=Oe,Nt.texture=Qe)}function ge(){const Oe=K[X];Oe!==void 0&&Oe.type!==void 0&&(s.bindTexture(Oe.type,null),Oe.type=void 0,Oe.texture=void 0)}function ae(){try{s.compressedTexImage2D(...arguments)}catch(Oe){console.error("THREE.WebGLState:",Oe)}}function Pe(){try{s.compressedTexImage3D(...arguments)}catch(Oe){console.error("THREE.WebGLState:",Oe)}}function Ve(){try{s.texSubImage2D(...arguments)}catch(Oe){console.error("THREE.WebGLState:",Oe)}}function rt(){try{s.texSubImage3D(...arguments)}catch(Oe){console.error("THREE.WebGLState:",Oe)}}function et(){try{s.compressedTexSubImage2D(...arguments)}catch(Oe){console.error("THREE.WebGLState:",Oe)}}function Mt(){try{s.compressedTexSubImage3D(...arguments)}catch(Oe){console.error("THREE.WebGLState:",Oe)}}function Et(){try{s.texStorage2D(...arguments)}catch(Oe){console.error("THREE.WebGLState:",Oe)}}function Rt(){try{s.texStorage3D(...arguments)}catch(Oe){console.error("THREE.WebGLState:",Oe)}}function Gt(){try{s.texImage2D(...arguments)}catch(Oe){console.error("THREE.WebGLState:",Oe)}}function pt(){try{s.texImage3D(...arguments)}catch(Oe){console.error("THREE.WebGLState:",Oe)}}function At(Oe){Ee.equals(Oe)===!1&&(s.scissor(Oe.x,Oe.y,Oe.z,Oe.w),Ee.copy(Oe))}function Qt(Oe){Ce.equals(Oe)===!1&&(s.viewport(Oe.x,Oe.y,Oe.z,Oe.w),Ce.copy(Oe))}function Ut(Oe,Qe){let St=c.get(Qe);St===void 0&&(St=new WeakMap,c.set(Qe,St));let Nt=St.get(Oe);Nt===void 0&&(Nt=s.getUniformBlockIndex(Qe,Oe.name),St.set(Oe,Nt))}function vt(Oe,Qe){const Nt=c.get(Qe).get(Oe);l.get(Qe)!==Nt&&(s.uniformBlockBinding(Qe,Nt,Oe.__bindingPointIndex),l.set(Qe,Nt))}function Vt(){s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.POLYGON_OFFSET_FILL),s.disable(s.SCISSOR_TEST),s.disable(s.STENCIL_TEST),s.disable(s.SAMPLE_ALPHA_TO_COVERAGE),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.blendFuncSeparate(s.ONE,s.ZERO,s.ONE,s.ZERO),s.blendColor(0,0,0,0),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(s.LESS),a.setReversed(!1),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.clearStencil(0),s.cullFace(s.BACK),s.frontFace(s.CCW),s.polygonOffset(0,0),s.activeTexture(s.TEXTURE0),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),h={},X=null,K={},f={},p=new WeakMap,g=[],y=null,x=!1,E=null,_=null,b=null,C=null,I=null,M=null,R=null,D=new Tt(0,0,0),P=0,L=!1,O=null,U=null,j=null,H=null,z=null,Ee.set(0,0,s.canvas.width,s.canvas.height),Ce.set(0,0,s.canvas.width,s.canvas.height),r.reset(),a.reset(),o.reset()}return{buffers:{color:r,depth:a,stencil:o},enable:ne,disable:re,bindFramebuffer:Be,drawBuffers:Ge,useProgram:Ue,setBlending:ve,setMaterial:Ae,setFlipSided:Se,setCullFace:be,setLineWidth:Re,setPolygonOffset:me,setScissorTest:ue,activeTexture:$e,bindTexture:gt,unbindTexture:ge,compressedTexImage2D:ae,compressedTexImage3D:Pe,texImage2D:Gt,texImage3D:pt,updateUBOMapping:Ut,uniformBlockBinding:vt,texStorage2D:Et,texStorage3D:Rt,texSubImage2D:Ve,texSubImage3D:rt,compressedTexSubImage2D:et,compressedTexSubImage3D:Mt,scissor:At,viewport:Qt,reset:Vt}}function FZ(s,e,t,n,i,r,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new We,h=new WeakMap;let f;const p=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(ge,ae){return g?new OffscreenCanvas(ge,ae):Qv("canvas")}function x(ge,ae,Pe){let Ve=1;const rt=gt(ge);if((rt.width>Pe||rt.height>Pe)&&(Ve=Pe/Math.max(rt.width,rt.height)),Ve<1)if(typeof HTMLImageElement<"u"&&ge instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ge instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ge instanceof ImageBitmap||typeof VideoFrame<"u"&&ge instanceof VideoFrame){const et=Math.floor(Ve*rt.width),Mt=Math.floor(Ve*rt.height);f===void 0&&(f=y(et,Mt));const Et=ae?y(et,Mt):f;return Et.width=et,Et.height=Mt,Et.getContext("2d").drawImage(ge,0,0,et,Mt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+rt.width+"x"+rt.height+") to ("+et+"x"+Mt+")."),Et}else return"data"in ge&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+rt.width+"x"+rt.height+")."),ge;return ge}function E(ge){return ge.generateMipmaps}function _(ge){s.generateMipmap(ge)}function b(ge){return ge.isWebGLCubeRenderTarget?s.TEXTURE_CUBE_MAP:ge.isWebGL3DRenderTarget?s.TEXTURE_3D:ge.isWebGLArrayRenderTarget||ge.isCompressedArrayTexture?s.TEXTURE_2D_ARRAY:s.TEXTURE_2D}function C(ge,ae,Pe,Ve,rt=!1){if(ge!==null){if(s[ge]!==void 0)return s[ge];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ge+"'")}let et=ae;if(ae===s.RED&&(Pe===s.FLOAT&&(et=s.R32F),Pe===s.HALF_FLOAT&&(et=s.R16F),Pe===s.UNSIGNED_BYTE&&(et=s.R8)),ae===s.RED_INTEGER&&(Pe===s.UNSIGNED_BYTE&&(et=s.R8UI),Pe===s.UNSIGNED_SHORT&&(et=s.R16UI),Pe===s.UNSIGNED_INT&&(et=s.R32UI),Pe===s.BYTE&&(et=s.R8I),Pe===s.SHORT&&(et=s.R16I),Pe===s.INT&&(et=s.R32I)),ae===s.RG&&(Pe===s.FLOAT&&(et=s.RG32F),Pe===s.HALF_FLOAT&&(et=s.RG16F),Pe===s.UNSIGNED_BYTE&&(et=s.RG8)),ae===s.RG_INTEGER&&(Pe===s.UNSIGNED_BYTE&&(et=s.RG8UI),Pe===s.UNSIGNED_SHORT&&(et=s.RG16UI),Pe===s.UNSIGNED_INT&&(et=s.RG32UI),Pe===s.BYTE&&(et=s.RG8I),Pe===s.SHORT&&(et=s.RG16I),Pe===s.INT&&(et=s.RG32I)),ae===s.RGB_INTEGER&&(Pe===s.UNSIGNED_BYTE&&(et=s.RGB8UI),Pe===s.UNSIGNED_SHORT&&(et=s.RGB16UI),Pe===s.UNSIGNED_INT&&(et=s.RGB32UI),Pe===s.BYTE&&(et=s.RGB8I),Pe===s.SHORT&&(et=s.RGB16I),Pe===s.INT&&(et=s.RGB32I)),ae===s.RGBA_INTEGER&&(Pe===s.UNSIGNED_BYTE&&(et=s.RGBA8UI),Pe===s.UNSIGNED_SHORT&&(et=s.RGBA16UI),Pe===s.UNSIGNED_INT&&(et=s.RGBA32UI),Pe===s.BYTE&&(et=s.RGBA8I),Pe===s.SHORT&&(et=s.RGBA16I),Pe===s.INT&&(et=s.RGBA32I)),ae===s.RGB&&Pe===s.UNSIGNED_INT_5_9_9_9_REV&&(et=s.RGB9_E5),ae===s.RGBA){const Mt=rt?Hv:Jn.getTransfer(Ve);Pe===s.FLOAT&&(et=s.RGBA32F),Pe===s.HALF_FLOAT&&(et=s.RGBA16F),Pe===s.UNSIGNED_BYTE&&(et=Mt===Ei?s.SRGB8_ALPHA8:s.RGBA8),Pe===s.UNSIGNED_SHORT_4_4_4_4&&(et=s.RGBA4),Pe===s.UNSIGNED_SHORT_5_5_5_1&&(et=s.RGB5_A1)}return(et===s.R16F||et===s.R32F||et===s.RG16F||et===s.RG32F||et===s.RGBA16F||et===s.RGBA32F)&&e.get("EXT_color_buffer_float"),et}function I(ge,ae){let Pe;return ge?ae===null||ae===Rh||ae===NA?Pe=s.DEPTH24_STENCIL8:ae===ss?Pe=s.DEPTH32F_STENCIL8:ae===PA&&(Pe=s.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):ae===null||ae===Rh||ae===NA?Pe=s.DEPTH_COMPONENT24:ae===ss?Pe=s.DEPTH_COMPONENT32F:ae===PA&&(Pe=s.DEPTH_COMPONENT16),Pe}function M(ge,ae){return E(ge)===!0||ge.isFramebufferTexture&&ge.minFilter!==Ws&&ge.minFilter!==Si?Math.log2(Math.max(ae.width,ae.height))+1:ge.mipmaps!==void 0&&ge.mipmaps.length>0?ge.mipmaps.length:ge.isCompressedTexture&&Array.isArray(ge.image)?ae.mipmaps.length:1}function R(ge){const ae=ge.target;ae.removeEventListener("dispose",R),P(ae),ae.isVideoTexture&&h.delete(ae)}function D(ge){const ae=ge.target;ae.removeEventListener("dispose",D),O(ae)}function P(ge){const ae=n.get(ge);if(ae.__webglInit===void 0)return;const Pe=ge.source,Ve=p.get(Pe);if(Ve){const rt=Ve[ae.__cacheKey];rt.usedTimes--,rt.usedTimes===0&&L(ge),Object.keys(Ve).length===0&&p.delete(Pe)}n.remove(ge)}function L(ge){const ae=n.get(ge);s.deleteTexture(ae.__webglTexture);const Pe=ge.source,Ve=p.get(Pe);delete Ve[ae.__cacheKey],a.memory.textures--}function O(ge){const ae=n.get(ge);if(ge.depthTexture&&(ge.depthTexture.dispose(),n.remove(ge.depthTexture)),ge.isWebGLCubeRenderTarget)for(let Ve=0;Ve<6;Ve++){if(Array.isArray(ae.__webglFramebuffer[Ve]))for(let rt=0;rt<ae.__webglFramebuffer[Ve].length;rt++)s.deleteFramebuffer(ae.__webglFramebuffer[Ve][rt]);else s.deleteFramebuffer(ae.__webglFramebuffer[Ve]);ae.__webglDepthbuffer&&s.deleteRenderbuffer(ae.__webglDepthbuffer[Ve])}else{if(Array.isArray(ae.__webglFramebuffer))for(let Ve=0;Ve<ae.__webglFramebuffer.length;Ve++)s.deleteFramebuffer(ae.__webglFramebuffer[Ve]);else s.deleteFramebuffer(ae.__webglFramebuffer);if(ae.__webglDepthbuffer&&s.deleteRenderbuffer(ae.__webglDepthbuffer),ae.__webglMultisampledFramebuffer&&s.deleteFramebuffer(ae.__webglMultisampledFramebuffer),ae.__webglColorRenderbuffer)for(let Ve=0;Ve<ae.__webglColorRenderbuffer.length;Ve++)ae.__webglColorRenderbuffer[Ve]&&s.deleteRenderbuffer(ae.__webglColorRenderbuffer[Ve]);ae.__webglDepthRenderbuffer&&s.deleteRenderbuffer(ae.__webglDepthRenderbuffer)}const Pe=ge.textures;for(let Ve=0,rt=Pe.length;Ve<rt;Ve++){const et=n.get(Pe[Ve]);et.__webglTexture&&(s.deleteTexture(et.__webglTexture),a.memory.textures--),n.remove(Pe[Ve])}n.remove(ge)}let U=0;function j(){U=0}function H(){const ge=U;return ge>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+ge+" texture units while this GPU supports only "+i.maxTextures),U+=1,ge}function z(ge){const ae=[];return ae.push(ge.wrapS),ae.push(ge.wrapT),ae.push(ge.wrapR||0),ae.push(ge.magFilter),ae.push(ge.minFilter),ae.push(ge.anisotropy),ae.push(ge.internalFormat),ae.push(ge.format),ae.push(ge.type),ae.push(ge.generateMipmaps),ae.push(ge.premultiplyAlpha),ae.push(ge.flipY),ae.push(ge.unpackAlignment),ae.push(ge.colorSpace),ae.join()}function q(ge,ae){const Pe=n.get(ge);if(ge.isVideoTexture&&ue(ge),ge.isRenderTargetTexture===!1&&ge.isExternalTexture!==!0&&ge.version>0&&Pe.__version!==ge.version){const Ve=ge.image;if(Ve===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ve.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ie(Pe,ge,ae);return}}else ge.isExternalTexture&&(Pe.__webglTexture=ge.sourceTexture?ge.sourceTexture:null);t.bindTexture(s.TEXTURE_2D,Pe.__webglTexture,s.TEXTURE0+ae)}function k(ge,ae){const Pe=n.get(ge);if(ge.isRenderTargetTexture===!1&&ge.version>0&&Pe.__version!==ge.version){ie(Pe,ge,ae);return}t.bindTexture(s.TEXTURE_2D_ARRAY,Pe.__webglTexture,s.TEXTURE0+ae)}function W(ge,ae){const Pe=n.get(ge);if(ge.isRenderTargetTexture===!1&&ge.version>0&&Pe.__version!==ge.version){ie(Pe,ge,ae);return}t.bindTexture(s.TEXTURE_3D,Pe.__webglTexture,s.TEXTURE0+ae)}function V(ge,ae){const Pe=n.get(ge);if(ge.version>0&&Pe.__version!==ge.version){ne(Pe,ge,ae);return}t.bindTexture(s.TEXTURE_CUBE_MAP,Pe.__webglTexture,s.TEXTURE0+ae)}const X={[Cu]:s.REPEAT,[Ur]:s.CLAMP_TO_EDGE,[OA]:s.MIRRORED_REPEAT},K={[Ws]:s.NEAREST,[MT]:s.NEAREST_MIPMAP_NEAREST,[Vp]:s.NEAREST_MIPMAP_LINEAR,[Si]:s.LINEAR,[gA]:s.LINEAR_MIPMAP_NEAREST,[Oo]:s.LINEAR_MIPMAP_LINEAR},te={[yk]:s.NEVER,[bk]:s.ALWAYS,[vk]:s.LESS,[pB]:s.LEQUAL,[Ek]:s.EQUAL,[Sk]:s.GEQUAL,[xk]:s.GREATER,[_k]:s.NOTEQUAL};function oe(ge,ae){if(ae.type===ss&&e.has("OES_texture_float_linear")===!1&&(ae.magFilter===Si||ae.magFilter===gA||ae.magFilter===Vp||ae.magFilter===Oo||ae.minFilter===Si||ae.minFilter===gA||ae.minFilter===Vp||ae.minFilter===Oo)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),s.texParameteri(ge,s.TEXTURE_WRAP_S,X[ae.wrapS]),s.texParameteri(ge,s.TEXTURE_WRAP_T,X[ae.wrapT]),(ge===s.TEXTURE_3D||ge===s.TEXTURE_2D_ARRAY)&&s.texParameteri(ge,s.TEXTURE_WRAP_R,X[ae.wrapR]),s.texParameteri(ge,s.TEXTURE_MAG_FILTER,K[ae.magFilter]),s.texParameteri(ge,s.TEXTURE_MIN_FILTER,K[ae.minFilter]),ae.compareFunction&&(s.texParameteri(ge,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(ge,s.TEXTURE_COMPARE_FUNC,te[ae.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(ae.magFilter===Ws||ae.minFilter!==Vp&&ae.minFilter!==Oo||ae.type===ss&&e.has("OES_texture_float_linear")===!1)return;if(ae.anisotropy>1||n.get(ae).__currentAnisotropy){const Pe=e.get("EXT_texture_filter_anisotropic");s.texParameterf(ge,Pe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ae.anisotropy,i.getMaxAnisotropy())),n.get(ae).__currentAnisotropy=ae.anisotropy}}}function Ee(ge,ae){let Pe=!1;ge.__webglInit===void 0&&(ge.__webglInit=!0,ae.addEventListener("dispose",R));const Ve=ae.source;let rt=p.get(Ve);rt===void 0&&(rt={},p.set(Ve,rt));const et=z(ae);if(et!==ge.__cacheKey){rt[et]===void 0&&(rt[et]={texture:s.createTexture(),usedTimes:0},a.memory.textures++,Pe=!0),rt[et].usedTimes++;const Mt=rt[ge.__cacheKey];Mt!==void 0&&(rt[ge.__cacheKey].usedTimes--,Mt.usedTimes===0&&L(ae)),ge.__cacheKey=et,ge.__webglTexture=rt[et].texture}return Pe}function Ce(ge,ae,Pe){return Math.floor(Math.floor(ge/Pe)/ae)}function se(ge,ae,Pe,Ve){const et=ge.updateRanges;if(et.length===0)t.texSubImage2D(s.TEXTURE_2D,0,0,0,ae.width,ae.height,Pe,Ve,ae.data);else{et.sort((pt,At)=>pt.start-At.start);let Mt=0;for(let pt=1;pt<et.length;pt++){const At=et[Mt],Qt=et[pt],Ut=At.start+At.count,vt=Ce(Qt.start,ae.width,4),Vt=Ce(At.start,ae.width,4);Qt.start<=Ut+1&&vt===Vt&&Ce(Qt.start+Qt.count-1,ae.width,4)===vt?At.count=Math.max(At.count,Qt.start+Qt.count-At.start):(++Mt,et[Mt]=Qt)}et.length=Mt+1;const Et=s.getParameter(s.UNPACK_ROW_LENGTH),Rt=s.getParameter(s.UNPACK_SKIP_PIXELS),Gt=s.getParameter(s.UNPACK_SKIP_ROWS);s.pixelStorei(s.UNPACK_ROW_LENGTH,ae.width);for(let pt=0,At=et.length;pt<At;pt++){const Qt=et[pt],Ut=Math.floor(Qt.start/4),vt=Math.ceil(Qt.count/4),Vt=Ut%ae.width,Oe=Math.floor(Ut/ae.width),Qe=vt,St=1;s.pixelStorei(s.UNPACK_SKIP_PIXELS,Vt),s.pixelStorei(s.UNPACK_SKIP_ROWS,Oe),t.texSubImage2D(s.TEXTURE_2D,0,Vt,Oe,Qe,St,Pe,Ve,ae.data)}ge.clearUpdateRanges(),s.pixelStorei(s.UNPACK_ROW_LENGTH,Et),s.pixelStorei(s.UNPACK_SKIP_PIXELS,Rt),s.pixelStorei(s.UNPACK_SKIP_ROWS,Gt)}}function ie(ge,ae,Pe){let Ve=s.TEXTURE_2D;(ae.isDataArrayTexture||ae.isCompressedArrayTexture)&&(Ve=s.TEXTURE_2D_ARRAY),ae.isData3DTexture&&(Ve=s.TEXTURE_3D);const rt=Ee(ge,ae),et=ae.source;t.bindTexture(Ve,ge.__webglTexture,s.TEXTURE0+Pe);const Mt=n.get(et);if(et.version!==Mt.__version||rt===!0){t.activeTexture(s.TEXTURE0+Pe);const Et=Jn.getPrimaries(Jn.workingColorSpace),Rt=ae.colorSpace===Sh?null:Jn.getPrimaries(ae.colorSpace),Gt=ae.colorSpace===Sh||Et===Rt?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,ae.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ae.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,ae.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,Gt);let pt=x(ae.image,!1,i.maxTextureSize);pt=$e(ae,pt);const At=r.convert(ae.format,ae.colorSpace),Qt=r.convert(ae.type);let Ut=C(ae.internalFormat,At,Qt,ae.colorSpace,ae.isVideoTexture);oe(Ve,ae);let vt;const Vt=ae.mipmaps,Oe=ae.isVideoTexture!==!0,Qe=Mt.__version===void 0||rt===!0,St=et.dataReady,Nt=M(ae,pt);if(ae.isDepthTexture)Ut=I(ae.format===UA,ae.type),Qe&&(Oe?t.texStorage2D(s.TEXTURE_2D,1,Ut,pt.width,pt.height):t.texImage2D(s.TEXTURE_2D,0,Ut,pt.width,pt.height,0,At,Qt,null));else if(ae.isDataTexture)if(Vt.length>0){Oe&&Qe&&t.texStorage2D(s.TEXTURE_2D,Nt,Ut,Vt[0].width,Vt[0].height);for(let yt=0,dt=Vt.length;yt<dt;yt++)vt=Vt[yt],Oe?St&&t.texSubImage2D(s.TEXTURE_2D,yt,0,0,vt.width,vt.height,At,Qt,vt.data):t.texImage2D(s.TEXTURE_2D,yt,Ut,vt.width,vt.height,0,At,Qt,vt.data);ae.generateMipmaps=!1}else Oe?(Qe&&t.texStorage2D(s.TEXTURE_2D,Nt,Ut,pt.width,pt.height),St&&se(ae,pt,At,Qt)):t.texImage2D(s.TEXTURE_2D,0,Ut,pt.width,pt.height,0,At,Qt,pt.data);else if(ae.isCompressedTexture)if(ae.isCompressedArrayTexture){Oe&&Qe&&t.texStorage3D(s.TEXTURE_2D_ARRAY,Nt,Ut,Vt[0].width,Vt[0].height,pt.depth);for(let yt=0,dt=Vt.length;yt<dt;yt++)if(vt=Vt[yt],ae.format!==rs)if(At!==null)if(Oe){if(St)if(ae.layerUpdates.size>0){const zt=Lw(vt.width,vt.height,ae.format,ae.type);for(const tn of ae.layerUpdates){const Un=vt.data.subarray(tn*zt/vt.data.BYTES_PER_ELEMENT,(tn+1)*zt/vt.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,yt,0,0,tn,vt.width,vt.height,1,At,Un)}ae.clearLayerUpdates()}else t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,yt,0,0,0,vt.width,vt.height,pt.depth,At,vt.data)}else t.compressedTexImage3D(s.TEXTURE_2D_ARRAY,yt,Ut,vt.width,vt.height,pt.depth,0,vt.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Oe?St&&t.texSubImage3D(s.TEXTURE_2D_ARRAY,yt,0,0,0,vt.width,vt.height,pt.depth,At,Qt,vt.data):t.texImage3D(s.TEXTURE_2D_ARRAY,yt,Ut,vt.width,vt.height,pt.depth,0,At,Qt,vt.data)}else{Oe&&Qe&&t.texStorage2D(s.TEXTURE_2D,Nt,Ut,Vt[0].width,Vt[0].height);for(let yt=0,dt=Vt.length;yt<dt;yt++)vt=Vt[yt],ae.format!==rs?At!==null?Oe?St&&t.compressedTexSubImage2D(s.TEXTURE_2D,yt,0,0,vt.width,vt.height,At,vt.data):t.compressedTexImage2D(s.TEXTURE_2D,yt,Ut,vt.width,vt.height,0,vt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Oe?St&&t.texSubImage2D(s.TEXTURE_2D,yt,0,0,vt.width,vt.height,At,Qt,vt.data):t.texImage2D(s.TEXTURE_2D,yt,Ut,vt.width,vt.height,0,At,Qt,vt.data)}else if(ae.isDataArrayTexture)if(Oe){if(Qe&&t.texStorage3D(s.TEXTURE_2D_ARRAY,Nt,Ut,pt.width,pt.height,pt.depth),St)if(ae.layerUpdates.size>0){const yt=Lw(pt.width,pt.height,ae.format,ae.type);for(const dt of ae.layerUpdates){const zt=pt.data.subarray(dt*yt/pt.data.BYTES_PER_ELEMENT,(dt+1)*yt/pt.data.BYTES_PER_ELEMENT);t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,dt,pt.width,pt.height,1,At,Qt,zt)}ae.clearLayerUpdates()}else t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,pt.width,pt.height,pt.depth,At,Qt,pt.data)}else t.texImage3D(s.TEXTURE_2D_ARRAY,0,Ut,pt.width,pt.height,pt.depth,0,At,Qt,pt.data);else if(ae.isData3DTexture)Oe?(Qe&&t.texStorage3D(s.TEXTURE_3D,Nt,Ut,pt.width,pt.height,pt.depth),St&&t.texSubImage3D(s.TEXTURE_3D,0,0,0,0,pt.width,pt.height,pt.depth,At,Qt,pt.data)):t.texImage3D(s.TEXTURE_3D,0,Ut,pt.width,pt.height,pt.depth,0,At,Qt,pt.data);else if(ae.isFramebufferTexture){if(Qe)if(Oe)t.texStorage2D(s.TEXTURE_2D,Nt,Ut,pt.width,pt.height);else{let yt=pt.width,dt=pt.height;for(let zt=0;zt<Nt;zt++)t.texImage2D(s.TEXTURE_2D,zt,Ut,yt,dt,0,At,Qt,null),yt>>=1,dt>>=1}}else if(Vt.length>0){if(Oe&&Qe){const yt=gt(Vt[0]);t.texStorage2D(s.TEXTURE_2D,Nt,Ut,yt.width,yt.height)}for(let yt=0,dt=Vt.length;yt<dt;yt++)vt=Vt[yt],Oe?St&&t.texSubImage2D(s.TEXTURE_2D,yt,0,0,At,Qt,vt):t.texImage2D(s.TEXTURE_2D,yt,Ut,At,Qt,vt);ae.generateMipmaps=!1}else if(Oe){if(Qe){const yt=gt(pt);t.texStorage2D(s.TEXTURE_2D,Nt,Ut,yt.width,yt.height)}St&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,At,Qt,pt)}else t.texImage2D(s.TEXTURE_2D,0,Ut,At,Qt,pt);E(ae)&&_(Ve),Mt.__version=et.version,ae.onUpdate&&ae.onUpdate(ae)}ge.__version=ae.version}function ne(ge,ae,Pe){if(ae.image.length!==6)return;const Ve=Ee(ge,ae),rt=ae.source;t.bindTexture(s.TEXTURE_CUBE_MAP,ge.__webglTexture,s.TEXTURE0+Pe);const et=n.get(rt);if(rt.version!==et.__version||Ve===!0){t.activeTexture(s.TEXTURE0+Pe);const Mt=Jn.getPrimaries(Jn.workingColorSpace),Et=ae.colorSpace===Sh?null:Jn.getPrimaries(ae.colorSpace),Rt=ae.colorSpace===Sh||Mt===Et?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,ae.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ae.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,ae.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,Rt);const Gt=ae.isCompressedTexture||ae.image[0].isCompressedTexture,pt=ae.image[0]&&ae.image[0].isDataTexture,At=[];for(let dt=0;dt<6;dt++)!Gt&&!pt?At[dt]=x(ae.image[dt],!0,i.maxCubemapSize):At[dt]=pt?ae.image[dt].image:ae.image[dt],At[dt]=$e(ae,At[dt]);const Qt=At[0],Ut=r.convert(ae.format,ae.colorSpace),vt=r.convert(ae.type),Vt=C(ae.internalFormat,Ut,vt,ae.colorSpace),Oe=ae.isVideoTexture!==!0,Qe=et.__version===void 0||Ve===!0,St=rt.dataReady;let Nt=M(ae,Qt);oe(s.TEXTURE_CUBE_MAP,ae);let yt;if(Gt){Oe&&Qe&&t.texStorage2D(s.TEXTURE_CUBE_MAP,Nt,Vt,Qt.width,Qt.height);for(let dt=0;dt<6;dt++){yt=At[dt].mipmaps;for(let zt=0;zt<yt.length;zt++){const tn=yt[zt];ae.format!==rs?Ut!==null?Oe?St&&t.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,zt,0,0,tn.width,tn.height,Ut,tn.data):t.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,zt,Vt,tn.width,tn.height,0,tn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Oe?St&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,zt,0,0,tn.width,tn.height,Ut,vt,tn.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,zt,Vt,tn.width,tn.height,0,Ut,vt,tn.data)}}}else{if(yt=ae.mipmaps,Oe&&Qe){yt.length>0&&Nt++;const dt=gt(At[0]);t.texStorage2D(s.TEXTURE_CUBE_MAP,Nt,Vt,dt.width,dt.height)}for(let dt=0;dt<6;dt++)if(pt){Oe?St&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,0,0,0,At[dt].width,At[dt].height,Ut,vt,At[dt].data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,0,Vt,At[dt].width,At[dt].height,0,Ut,vt,At[dt].data);for(let zt=0;zt<yt.length;zt++){const Un=yt[zt].image[dt].image;Oe?St&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,zt+1,0,0,Un.width,Un.height,Ut,vt,Un.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,zt+1,Vt,Un.width,Un.height,0,Ut,vt,Un.data)}}else{Oe?St&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,0,0,0,Ut,vt,At[dt]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,0,Vt,Ut,vt,At[dt]);for(let zt=0;zt<yt.length;zt++){const tn=yt[zt];Oe?St&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,zt+1,0,0,Ut,vt,tn.image[dt]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+dt,zt+1,Vt,Ut,vt,tn.image[dt])}}}E(ae)&&_(s.TEXTURE_CUBE_MAP),et.__version=rt.version,ae.onUpdate&&ae.onUpdate(ae)}ge.__version=ae.version}function re(ge,ae,Pe,Ve,rt,et){const Mt=r.convert(Pe.format,Pe.colorSpace),Et=r.convert(Pe.type),Rt=C(Pe.internalFormat,Mt,Et,Pe.colorSpace),Gt=n.get(ae),pt=n.get(Pe);if(pt.__renderTarget=ae,!Gt.__hasExternalTextures){const At=Math.max(1,ae.width>>et),Qt=Math.max(1,ae.height>>et);rt===s.TEXTURE_3D||rt===s.TEXTURE_2D_ARRAY?t.texImage3D(rt,et,Rt,At,Qt,ae.depth,0,Mt,Et,null):t.texImage2D(rt,et,Rt,At,Qt,0,Mt,Et,null)}t.bindFramebuffer(s.FRAMEBUFFER,ge),me(ae)?o.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,Ve,rt,pt.__webglTexture,0,Re(ae)):(rt===s.TEXTURE_2D||rt>=s.TEXTURE_CUBE_MAP_POSITIVE_X&&rt<=s.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&s.framebufferTexture2D(s.FRAMEBUFFER,Ve,rt,pt.__webglTexture,et),t.bindFramebuffer(s.FRAMEBUFFER,null)}function Be(ge,ae,Pe){if(s.bindRenderbuffer(s.RENDERBUFFER,ge),ae.depthBuffer){const Ve=ae.depthTexture,rt=Ve&&Ve.isDepthTexture?Ve.type:null,et=I(ae.stencilBuffer,rt),Mt=ae.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,Et=Re(ae);me(ae)?o.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Et,et,ae.width,ae.height):Pe?s.renderbufferStorageMultisample(s.RENDERBUFFER,Et,et,ae.width,ae.height):s.renderbufferStorage(s.RENDERBUFFER,et,ae.width,ae.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,Mt,s.RENDERBUFFER,ge)}else{const Ve=ae.textures;for(let rt=0;rt<Ve.length;rt++){const et=Ve[rt],Mt=r.convert(et.format,et.colorSpace),Et=r.convert(et.type),Rt=C(et.internalFormat,Mt,Et,et.colorSpace),Gt=Re(ae);Pe&&me(ae)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,Gt,Rt,ae.width,ae.height):me(ae)?o.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Gt,Rt,ae.width,ae.height):s.renderbufferStorage(s.RENDERBUFFER,Rt,ae.width,ae.height)}}s.bindRenderbuffer(s.RENDERBUFFER,null)}function Ge(ge,ae){if(ae&&ae.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(s.FRAMEBUFFER,ge),!(ae.depthTexture&&ae.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Ve=n.get(ae.depthTexture);Ve.__renderTarget=ae,(!Ve.__webglTexture||ae.depthTexture.image.width!==ae.width||ae.depthTexture.image.height!==ae.height)&&(ae.depthTexture.image.width=ae.width,ae.depthTexture.image.height=ae.height,ae.depthTexture.needsUpdate=!0),q(ae.depthTexture,0);const rt=Ve.__webglTexture,et=Re(ae);if(ae.depthTexture.format===FA)me(ae)?o.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,rt,0,et):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,rt,0);else if(ae.depthTexture.format===UA)me(ae)?o.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,rt,0,et):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,rt,0);else throw new Error("Unknown depthTexture format")}function Ue(ge){const ae=n.get(ge),Pe=ge.isWebGLCubeRenderTarget===!0;if(ae.__boundDepthTexture!==ge.depthTexture){const Ve=ge.depthTexture;if(ae.__depthDisposeCallback&&ae.__depthDisposeCallback(),Ve){const rt=()=>{delete ae.__boundDepthTexture,delete ae.__depthDisposeCallback,Ve.removeEventListener("dispose",rt)};Ve.addEventListener("dispose",rt),ae.__depthDisposeCallback=rt}ae.__boundDepthTexture=Ve}if(ge.depthTexture&&!ae.__autoAllocateDepthBuffer){if(Pe)throw new Error("target.depthTexture not supported in Cube render targets");const Ve=ge.texture.mipmaps;Ve&&Ve.length>0?Ge(ae.__webglFramebuffer[0],ge):Ge(ae.__webglFramebuffer,ge)}else if(Pe){ae.__webglDepthbuffer=[];for(let Ve=0;Ve<6;Ve++)if(t.bindFramebuffer(s.FRAMEBUFFER,ae.__webglFramebuffer[Ve]),ae.__webglDepthbuffer[Ve]===void 0)ae.__webglDepthbuffer[Ve]=s.createRenderbuffer(),Be(ae.__webglDepthbuffer[Ve],ge,!1);else{const rt=ge.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,et=ae.__webglDepthbuffer[Ve];s.bindRenderbuffer(s.RENDERBUFFER,et),s.framebufferRenderbuffer(s.FRAMEBUFFER,rt,s.RENDERBUFFER,et)}}else{const Ve=ge.texture.mipmaps;if(Ve&&Ve.length>0?t.bindFramebuffer(s.FRAMEBUFFER,ae.__webglFramebuffer[0]):t.bindFramebuffer(s.FRAMEBUFFER,ae.__webglFramebuffer),ae.__webglDepthbuffer===void 0)ae.__webglDepthbuffer=s.createRenderbuffer(),Be(ae.__webglDepthbuffer,ge,!1);else{const rt=ge.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,et=ae.__webglDepthbuffer;s.bindRenderbuffer(s.RENDERBUFFER,et),s.framebufferRenderbuffer(s.FRAMEBUFFER,rt,s.RENDERBUFFER,et)}}t.bindFramebuffer(s.FRAMEBUFFER,null)}function nt(ge,ae,Pe){const Ve=n.get(ge);ae!==void 0&&re(Ve.__webglFramebuffer,ge,ge.texture,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,0),Pe!==void 0&&Ue(ge)}function pe(ge){const ae=ge.texture,Pe=n.get(ge),Ve=n.get(ae);ge.addEventListener("dispose",D);const rt=ge.textures,et=ge.isWebGLCubeRenderTarget===!0,Mt=rt.length>1;if(Mt||(Ve.__webglTexture===void 0&&(Ve.__webglTexture=s.createTexture()),Ve.__version=ae.version,a.memory.textures++),et){Pe.__webglFramebuffer=[];for(let Et=0;Et<6;Et++)if(ae.mipmaps&&ae.mipmaps.length>0){Pe.__webglFramebuffer[Et]=[];for(let Rt=0;Rt<ae.mipmaps.length;Rt++)Pe.__webglFramebuffer[Et][Rt]=s.createFramebuffer()}else Pe.__webglFramebuffer[Et]=s.createFramebuffer()}else{if(ae.mipmaps&&ae.mipmaps.length>0){Pe.__webglFramebuffer=[];for(let Et=0;Et<ae.mipmaps.length;Et++)Pe.__webglFramebuffer[Et]=s.createFramebuffer()}else Pe.__webglFramebuffer=s.createFramebuffer();if(Mt)for(let Et=0,Rt=rt.length;Et<Rt;Et++){const Gt=n.get(rt[Et]);Gt.__webglTexture===void 0&&(Gt.__webglTexture=s.createTexture(),a.memory.textures++)}if(ge.samples>0&&me(ge)===!1){Pe.__webglMultisampledFramebuffer=s.createFramebuffer(),Pe.__webglColorRenderbuffer=[],t.bindFramebuffer(s.FRAMEBUFFER,Pe.__webglMultisampledFramebuffer);for(let Et=0;Et<rt.length;Et++){const Rt=rt[Et];Pe.__webglColorRenderbuffer[Et]=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,Pe.__webglColorRenderbuffer[Et]);const Gt=r.convert(Rt.format,Rt.colorSpace),pt=r.convert(Rt.type),At=C(Rt.internalFormat,Gt,pt,Rt.colorSpace,ge.isXRRenderTarget===!0),Qt=Re(ge);s.renderbufferStorageMultisample(s.RENDERBUFFER,Qt,At,ge.width,ge.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Et,s.RENDERBUFFER,Pe.__webglColorRenderbuffer[Et])}s.bindRenderbuffer(s.RENDERBUFFER,null),ge.depthBuffer&&(Pe.__webglDepthRenderbuffer=s.createRenderbuffer(),Be(Pe.__webglDepthRenderbuffer,ge,!0)),t.bindFramebuffer(s.FRAMEBUFFER,null)}}if(et){t.bindTexture(s.TEXTURE_CUBE_MAP,Ve.__webglTexture),oe(s.TEXTURE_CUBE_MAP,ae);for(let Et=0;Et<6;Et++)if(ae.mipmaps&&ae.mipmaps.length>0)for(let Rt=0;Rt<ae.mipmaps.length;Rt++)re(Pe.__webglFramebuffer[Et][Rt],ge,ae,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+Et,Rt);else re(Pe.__webglFramebuffer[Et],ge,ae,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+Et,0);E(ae)&&_(s.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Mt){for(let Et=0,Rt=rt.length;Et<Rt;Et++){const Gt=rt[Et],pt=n.get(Gt);let At=s.TEXTURE_2D;(ge.isWebGL3DRenderTarget||ge.isWebGLArrayRenderTarget)&&(At=ge.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY),t.bindTexture(At,pt.__webglTexture),oe(At,Gt),re(Pe.__webglFramebuffer,ge,Gt,s.COLOR_ATTACHMENT0+Et,At,0),E(Gt)&&_(At)}t.unbindTexture()}else{let Et=s.TEXTURE_2D;if((ge.isWebGL3DRenderTarget||ge.isWebGLArrayRenderTarget)&&(Et=ge.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY),t.bindTexture(Et,Ve.__webglTexture),oe(Et,ae),ae.mipmaps&&ae.mipmaps.length>0)for(let Rt=0;Rt<ae.mipmaps.length;Rt++)re(Pe.__webglFramebuffer[Rt],ge,ae,s.COLOR_ATTACHMENT0,Et,Rt);else re(Pe.__webglFramebuffer,ge,ae,s.COLOR_ATTACHMENT0,Et,0);E(ae)&&_(Et),t.unbindTexture()}ge.depthBuffer&&Ue(ge)}function ve(ge){const ae=ge.textures;for(let Pe=0,Ve=ae.length;Pe<Ve;Pe++){const rt=ae[Pe];if(E(rt)){const et=b(ge),Mt=n.get(rt).__webglTexture;t.bindTexture(et,Mt),_(et),t.unbindTexture()}}}const Ae=[],Se=[];function be(ge){if(ge.samples>0){if(me(ge)===!1){const ae=ge.textures,Pe=ge.width,Ve=ge.height;let rt=s.COLOR_BUFFER_BIT;const et=ge.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,Mt=n.get(ge),Et=ae.length>1;if(Et)for(let Gt=0;Gt<ae.length;Gt++)t.bindFramebuffer(s.FRAMEBUFFER,Mt.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Gt,s.RENDERBUFFER,null),t.bindFramebuffer(s.FRAMEBUFFER,Mt.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Gt,s.TEXTURE_2D,null,0);t.bindFramebuffer(s.READ_FRAMEBUFFER,Mt.__webglMultisampledFramebuffer);const Rt=ge.texture.mipmaps;Rt&&Rt.length>0?t.bindFramebuffer(s.DRAW_FRAMEBUFFER,Mt.__webglFramebuffer[0]):t.bindFramebuffer(s.DRAW_FRAMEBUFFER,Mt.__webglFramebuffer);for(let Gt=0;Gt<ae.length;Gt++){if(ge.resolveDepthBuffer&&(ge.depthBuffer&&(rt|=s.DEPTH_BUFFER_BIT),ge.stencilBuffer&&ge.resolveStencilBuffer&&(rt|=s.STENCIL_BUFFER_BIT)),Et){s.framebufferRenderbuffer(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,Mt.__webglColorRenderbuffer[Gt]);const pt=n.get(ae[Gt]).__webglTexture;s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,pt,0)}s.blitFramebuffer(0,0,Pe,Ve,0,0,Pe,Ve,rt,s.NEAREST),l===!0&&(Ae.length=0,Se.length=0,Ae.push(s.COLOR_ATTACHMENT0+Gt),ge.depthBuffer&&ge.resolveDepthBuffer===!1&&(Ae.push(et),Se.push(et),s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,Se)),s.invalidateFramebuffer(s.READ_FRAMEBUFFER,Ae))}if(t.bindFramebuffer(s.READ_FRAMEBUFFER,null),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),Et)for(let Gt=0;Gt<ae.length;Gt++){t.bindFramebuffer(s.FRAMEBUFFER,Mt.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Gt,s.RENDERBUFFER,Mt.__webglColorRenderbuffer[Gt]);const pt=n.get(ae[Gt]).__webglTexture;t.bindFramebuffer(s.FRAMEBUFFER,Mt.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Gt,s.TEXTURE_2D,pt,0)}t.bindFramebuffer(s.DRAW_FRAMEBUFFER,Mt.__webglMultisampledFramebuffer)}else if(ge.depthBuffer&&ge.resolveDepthBuffer===!1&&l){const ae=ge.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT;s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,[ae])}}}function Re(ge){return Math.min(i.maxSamples,ge.samples)}function me(ge){const ae=n.get(ge);return ge.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&ae.__useRenderToTexture!==!1}function ue(ge){const ae=a.render.frame;h.get(ge)!==ae&&(h.set(ge,ae),ge.update())}function $e(ge,ae){const Pe=ge.colorSpace,Ve=ge.format,rt=ge.type;return ge.isCompressedTexture===!0||ge.isVideoTexture===!0||Pe!==ud&&Pe!==Sh&&(Jn.getTransfer(Pe)===Ei?(Ve!==rs||rt!==ds)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Pe)),ae}function gt(ge){return typeof HTMLImageElement<"u"&&ge instanceof HTMLImageElement?(c.width=ge.naturalWidth||ge.width,c.height=ge.naturalHeight||ge.height):typeof VideoFrame<"u"&&ge instanceof VideoFrame?(c.width=ge.displayWidth,c.height=ge.displayHeight):(c.width=ge.width,c.height=ge.height),c}this.allocateTextureUnit=H,this.resetTextureUnits=j,this.setTexture2D=q,this.setTexture2DArray=k,this.setTexture3D=W,this.setTextureCube=V,this.rebindTextures=nt,this.setupRenderTarget=pe,this.updateRenderTargetMipmap=ve,this.updateMultisampleRenderTarget=be,this.setupDepthRenderbuffer=Ue,this.setupFrameBufferTexture=re,this.useMultisampledRTT=me}function TG(s,e){function t(n,i=Sh){let r;const a=Jn.getTransfer(i);if(n===ds)return s.UNSIGNED_BYTE;if(n===RT)return s.UNSIGNED_SHORT_4_4_4_4;if(n===BT)return s.UNSIGNED_SHORT_5_5_5_1;if(n===oB)return s.UNSIGNED_INT_5_9_9_9_REV;if(n===rB)return s.BYTE;if(n===aB)return s.SHORT;if(n===PA)return s.UNSIGNED_SHORT;if(n===wT)return s.INT;if(n===Rh)return s.UNSIGNED_INT;if(n===ss)return s.FLOAT;if(n===hr)return s.HALF_FLOAT;if(n===lB)return s.ALPHA;if(n===cB)return s.RGB;if(n===rs)return s.RGBA;if(n===FA)return s.DEPTH_COMPONENT;if(n===UA)return s.DEPTH_STENCIL;if(n===gu)return s.RED;if(n===pE)return s.RED_INTEGER;if(n===Xf)return s.RG;if(n===DT)return s.RG_INTEGER;if(n===LT)return s.RGBA_INTEGER;if(n===AA||n===fv||n===dv||n===yA)if(a===Ei)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(n===AA)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===fv)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===dv)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===yA)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(n===AA)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===fv)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===dv)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===yA)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===Ov||n===Rb||n===Pv||n===Bb)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(n===Ov)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Rb)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Pv)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Bb)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===Nv||n===Fv||n===Uv)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(n===Nv||n===Fv)return a===Ei?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===Uv)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===kv||n===Db||n===Lb||n===Ob||n===kA||n===Pb||n===Nb||n===Fb||n===Ub||n===kb||n===Gb||n===Hb||n===zb||n===Qb)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(n===kv)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Db)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Lb)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Ob)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===kA)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Pb)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Nb)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Fb)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Ub)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===kb)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Gb)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Hb)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===zb)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Qb)return a===Ei?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===vA||n===Vb||n===jb)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(n===vA)return a===Ei?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Vb)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===jb)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===uB||n===qb||n===Kb||n===Yb)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(n===vA)return r.COMPRESSED_RED_RGTC1_EXT;if(n===qb)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Kb)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Yb)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===NA?s.UNSIGNED_INT_24_8:s[n]!==void 0?s[n]:null}return{convert:t}}class CG extends Hi{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}}const UZ=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,kZ=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class GZ{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const n=new CG(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new Ra({vertexShader:UZ,fragmentShader:kZ,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new bi(new xd(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class HZ extends Bu{constructor(e,t){super();const n=this;let i=null,r=1,a=null,o="local-floor",l=1,c=null,h=null,f=null,p=null,g=null,y=null;const x=new GZ,E={},_=t.getContextAttributes();let b=null,C=null;const I=[],M=[],R=new We;let D=null;const P=new Ki;P.viewport=new Tn;const L=new Ki;L.viewport=new Tn;const O=[P,L],U=new pG;let j=null,H=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(se){let ie=I[se];return ie===void 0&&(ie=new YS,I[se]=ie),ie.getTargetRaySpace()},this.getControllerGrip=function(se){let ie=I[se];return ie===void 0&&(ie=new YS,I[se]=ie),ie.getGripSpace()},this.getHand=function(se){let ie=I[se];return ie===void 0&&(ie=new YS,I[se]=ie),ie.getHandSpace()};function z(se){const ie=M.indexOf(se.inputSource);if(ie===-1)return;const ne=I[ie];ne!==void 0&&(ne.update(se.inputSource,se.frame,c||a),ne.dispatchEvent({type:se.type,data:se.inputSource}))}function q(){i.removeEventListener("select",z),i.removeEventListener("selectstart",z),i.removeEventListener("selectend",z),i.removeEventListener("squeeze",z),i.removeEventListener("squeezestart",z),i.removeEventListener("squeezeend",z),i.removeEventListener("end",q),i.removeEventListener("inputsourceschange",k);for(let se=0;se<I.length;se++){const ie=M[se];ie!==null&&(M[se]=null,I[se].disconnect(ie))}j=null,H=null,x.reset();for(const se in E)delete E[se];e.setRenderTarget(b),g=null,p=null,f=null,i=null,C=null,Ce.stop(),n.isPresenting=!1,e.setPixelRatio(D),e.setSize(R.width,R.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(se){r=se,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(se){o=se,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(se){c=se},this.getBaseLayer=function(){return p!==null?p:g},this.getBinding=function(){return f},this.getFrame=function(){return y},this.getSession=function(){return i},this.setSession=async function(se){if(i=se,i!==null){if(b=e.getRenderTarget(),i.addEventListener("select",z),i.addEventListener("selectstart",z),i.addEventListener("selectend",z),i.addEventListener("squeeze",z),i.addEventListener("squeezestart",z),i.addEventListener("squeezeend",z),i.addEventListener("end",q),i.addEventListener("inputsourceschange",k),_.xrCompatible!==!0&&await t.makeXRCompatible(),D=e.getPixelRatio(),e.getSize(R),typeof XRWebGLBinding<"u"&&(f=new XRWebGLBinding(i,t)),f!==null&&"createProjectionLayer"in XRWebGLBinding.prototype){let ne=null,re=null,Be=null;_.depth&&(Be=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ne=_.stencil?UA:FA,re=_.stencil?NA:Rh);const Ge={colorFormat:t.RGBA8,depthFormat:Be,scaleFactor:r};p=f.createProjectionLayer(Ge),i.updateRenderState({layers:[p]}),e.setPixelRatio(1),e.setSize(p.textureWidth,p.textureHeight,!1),C=new _l(p.textureWidth,p.textureHeight,{format:rs,type:ds,depthTexture:new _B(p.textureWidth,p.textureHeight,re,void 0,void 0,void 0,void 0,void 0,void 0,ne),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1})}else{const ne={antialias:_.antialias,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:r};g=new XRWebGLLayer(i,t,ne),i.updateRenderState({baseLayer:g}),e.setPixelRatio(1),e.setSize(g.framebufferWidth,g.framebufferHeight,!1),C=new _l(g.framebufferWidth,g.framebufferHeight,{format:rs,type:ds,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil,resolveDepthBuffer:g.ignoreDepthValues===!1,resolveStencilBuffer:g.ignoreDepthValues===!1})}C.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await i.requestReferenceSpace(o),Ce.setContext(i),Ce.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return x.getDepthTexture()};function k(se){for(let ie=0;ie<se.removed.length;ie++){const ne=se.removed[ie],re=M.indexOf(ne);re>=0&&(M[re]=null,I[re].disconnect(ne))}for(let ie=0;ie<se.added.length;ie++){const ne=se.added[ie];let re=M.indexOf(ne);if(re===-1){for(let Ge=0;Ge<I.length;Ge++)if(Ge>=M.length){M.push(ne),re=Ge;break}else if(M[Ge]===null){M[Ge]=ne,re=Ge;break}if(re===-1)break}const Be=I[re];Be&&Be.connect(ne)}}const W=new de,V=new de;function X(se,ie,ne){W.setFromMatrixPosition(ie.matrixWorld),V.setFromMatrixPosition(ne.matrixWorld);const re=W.distanceTo(V),Be=ie.projectionMatrix.elements,Ge=ne.projectionMatrix.elements,Ue=Be[14]/(Be[10]-1),nt=Be[14]/(Be[10]+1),pe=(Be[9]+1)/Be[5],ve=(Be[9]-1)/Be[5],Ae=(Be[8]-1)/Be[0],Se=(Ge[8]+1)/Ge[0],be=Ue*Ae,Re=Ue*Se,me=re/(-Ae+Se),ue=me*-Ae;if(ie.matrixWorld.decompose(se.position,se.quaternion,se.scale),se.translateX(ue),se.translateZ(me),se.matrixWorld.compose(se.position,se.quaternion,se.scale),se.matrixWorldInverse.copy(se.matrixWorld).invert(),Be[10]===-1)se.projectionMatrix.copy(ie.projectionMatrix),se.projectionMatrixInverse.copy(ie.projectionMatrixInverse);else{const $e=Ue+me,gt=nt+me,ge=be-ue,ae=Re+(re-ue),Pe=pe*nt/gt*$e,Ve=ve*nt/gt*$e;se.projectionMatrix.makePerspective(ge,ae,Pe,Ve,$e,gt),se.projectionMatrixInverse.copy(se.projectionMatrix).invert()}}function K(se,ie){ie===null?se.matrixWorld.copy(se.matrix):se.matrixWorld.multiplyMatrices(ie.matrixWorld,se.matrix),se.matrixWorldInverse.copy(se.matrixWorld).invert()}this.updateCamera=function(se){if(i===null)return;let ie=se.near,ne=se.far;x.texture!==null&&(x.depthNear>0&&(ie=x.depthNear),x.depthFar>0&&(ne=x.depthFar)),U.near=L.near=P.near=ie,U.far=L.far=P.far=ne,(j!==U.near||H!==U.far)&&(i.updateRenderState({depthNear:U.near,depthFar:U.far}),j=U.near,H=U.far),U.layers.mask=se.layers.mask|6,P.layers.mask=U.layers.mask&3,L.layers.mask=U.layers.mask&5;const re=se.parent,Be=U.cameras;K(U,re);for(let Ge=0;Ge<Be.length;Ge++)K(Be[Ge],re);Be.length===2?X(U,P,L):U.projectionMatrix.copy(P.projectionMatrix),te(se,U,re)};function te(se,ie,ne){ne===null?se.matrix.copy(ie.matrixWorld):(se.matrix.copy(ne.matrixWorld),se.matrix.invert(),se.matrix.multiply(ie.matrixWorld)),se.matrix.decompose(se.position,se.quaternion,se.scale),se.updateMatrixWorld(!0),se.projectionMatrix.copy(ie.projectionMatrix),se.projectionMatrixInverse.copy(ie.projectionMatrixInverse),se.isPerspectiveCamera&&(se.fov=QA*2*Math.atan(1/se.projectionMatrix.elements[5]),se.zoom=1)}this.getCamera=function(){return U},this.getFoveation=function(){if(!(p===null&&g===null))return l},this.setFoveation=function(se){l=se,p!==null&&(p.fixedFoveation=se),g!==null&&g.fixedFoveation!==void 0&&(g.fixedFoveation=se)},this.hasDepthSensing=function(){return x.texture!==null},this.getDepthSensingMesh=function(){return x.getMesh(U)},this.getCameraTexture=function(se){return E[se]};let oe=null;function Ee(se,ie){if(h=ie.getViewerPose(c||a),y=ie,h!==null){const ne=h.views;g!==null&&(e.setRenderTargetFramebuffer(C,g.framebuffer),e.setRenderTarget(C));let re=!1;ne.length!==U.cameras.length&&(U.cameras.length=0,re=!0);for(let nt=0;nt<ne.length;nt++){const pe=ne[nt];let ve=null;if(g!==null)ve=g.getViewport(pe);else{const Se=f.getViewSubImage(p,pe);ve=Se.viewport,nt===0&&(e.setRenderTargetTextures(C,Se.colorTexture,Se.depthStencilTexture),e.setRenderTarget(C))}let Ae=O[nt];Ae===void 0&&(Ae=new Ki,Ae.layers.enable(nt),Ae.viewport=new Tn,O[nt]=Ae),Ae.matrix.fromArray(pe.transform.matrix),Ae.matrix.decompose(Ae.position,Ae.quaternion,Ae.scale),Ae.projectionMatrix.fromArray(pe.projectionMatrix),Ae.projectionMatrixInverse.copy(Ae.projectionMatrix).invert(),Ae.viewport.set(ve.x,ve.y,ve.width,ve.height),nt===0&&(U.matrix.copy(Ae.matrix),U.matrix.decompose(U.position,U.quaternion,U.scale)),re===!0&&U.cameras.push(Ae)}const Be=i.enabledFeatures;if(Be&&Be.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&f){const nt=f.getDepthInformation(ne[0]);nt&&nt.isValid&&nt.texture&&x.init(nt,i.renderState)}if(Be&&Be.includes("camera-access")&&(e.state.unbindTexture(),f))for(let nt=0;nt<ne.length;nt++){const pe=ne[nt].camera;if(pe){let ve=E[pe];ve||(ve=new CG,E[pe]=ve);const Ae=f.getCameraImage(pe);ve.sourceTexture=Ae}}}for(let ne=0;ne<I.length;ne++){const re=M[ne],Be=I[ne];re!==null&&Be!==void 0&&Be.update(re,ie,c||a)}oe&&oe(se,ie),ie.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:ie}),y=null}const Ce=new EG;Ce.setAnimationLoop(Ee),this.setAnimationLoop=function(se){oe=se},this.dispose=function(){}}}const Bp=new Os,zZ=new Pt;function QZ(s,e){function t(E,_){E.matrixAutoUpdate===!0&&E.updateMatrix(),_.value.copy(E.matrix)}function n(E,_){_.color.getRGB(E.fogColor.value,Rk(s)),_.isFog?(E.fogNear.value=_.near,E.fogFar.value=_.far):_.isFogExp2&&(E.fogDensity.value=_.density)}function i(E,_,b,C,I){_.isMeshBasicMaterial||_.isMeshLambertMaterial?r(E,_):_.isMeshToonMaterial?(r(E,_),f(E,_)):_.isMeshPhongMaterial?(r(E,_),h(E,_)):_.isMeshStandardMaterial?(r(E,_),p(E,_),_.isMeshPhysicalMaterial&&g(E,_,I)):_.isMeshMatcapMaterial?(r(E,_),y(E,_)):_.isMeshDepthMaterial?r(E,_):_.isMeshDistanceMaterial?(r(E,_),x(E,_)):_.isMeshNormalMaterial?r(E,_):_.isLineBasicMaterial?(a(E,_),_.isLineDashedMaterial&&o(E,_)):_.isPointsMaterial?l(E,_,b,C):_.isSpriteMaterial?c(E,_):_.isShadowMaterial?(E.color.value.copy(_.color),E.opacity.value=_.opacity):_.isShaderMaterial&&(_.uniformsNeedUpdate=!1)}function r(E,_){E.opacity.value=_.opacity,_.color&&E.diffuse.value.copy(_.color),_.emissive&&E.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),_.map&&(E.map.value=_.map,t(_.map,E.mapTransform)),_.alphaMap&&(E.alphaMap.value=_.alphaMap,t(_.alphaMap,E.alphaMapTransform)),_.bumpMap&&(E.bumpMap.value=_.bumpMap,t(_.bumpMap,E.bumpMapTransform),E.bumpScale.value=_.bumpScale,_.side===wa&&(E.bumpScale.value*=-1)),_.normalMap&&(E.normalMap.value=_.normalMap,t(_.normalMap,E.normalMapTransform),E.normalScale.value.copy(_.normalScale),_.side===wa&&E.normalScale.value.negate()),_.displacementMap&&(E.displacementMap.value=_.displacementMap,t(_.displacementMap,E.displacementMapTransform),E.displacementScale.value=_.displacementScale,E.displacementBias.value=_.displacementBias),_.emissiveMap&&(E.emissiveMap.value=_.emissiveMap,t(_.emissiveMap,E.emissiveMapTransform)),_.specularMap&&(E.specularMap.value=_.specularMap,t(_.specularMap,E.specularMapTransform)),_.alphaTest>0&&(E.alphaTest.value=_.alphaTest);const b=e.get(_),C=b.envMap,I=b.envMapRotation;C&&(E.envMap.value=C,Bp.copy(I),Bp.x*=-1,Bp.y*=-1,Bp.z*=-1,C.isCubeTexture&&C.isRenderTargetTexture===!1&&(Bp.y*=-1,Bp.z*=-1),E.envMapRotation.value.setFromMatrix4(zZ.makeRotationFromEuler(Bp)),E.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,E.reflectivity.value=_.reflectivity,E.ior.value=_.ior,E.refractionRatio.value=_.refractionRatio),_.lightMap&&(E.lightMap.value=_.lightMap,E.lightMapIntensity.value=_.lightMapIntensity,t(_.lightMap,E.lightMapTransform)),_.aoMap&&(E.aoMap.value=_.aoMap,E.aoMapIntensity.value=_.aoMapIntensity,t(_.aoMap,E.aoMapTransform))}function a(E,_){E.diffuse.value.copy(_.color),E.opacity.value=_.opacity,_.map&&(E.map.value=_.map,t(_.map,E.mapTransform))}function o(E,_){E.dashSize.value=_.dashSize,E.totalSize.value=_.dashSize+_.gapSize,E.scale.value=_.scale}function l(E,_,b,C){E.diffuse.value.copy(_.color),E.opacity.value=_.opacity,E.size.value=_.size*b,E.scale.value=C*.5,_.map&&(E.map.value=_.map,t(_.map,E.uvTransform)),_.alphaMap&&(E.alphaMap.value=_.alphaMap,t(_.alphaMap,E.alphaMapTransform)),_.alphaTest>0&&(E.alphaTest.value=_.alphaTest)}function c(E,_){E.diffuse.value.copy(_.color),E.opacity.value=_.opacity,E.rotation.value=_.rotation,_.map&&(E.map.value=_.map,t(_.map,E.mapTransform)),_.alphaMap&&(E.alphaMap.value=_.alphaMap,t(_.alphaMap,E.alphaMapTransform)),_.alphaTest>0&&(E.alphaTest.value=_.alphaTest)}function h(E,_){E.specular.value.copy(_.specular),E.shininess.value=Math.max(_.shininess,1e-4)}function f(E,_){_.gradientMap&&(E.gradientMap.value=_.gradientMap)}function p(E,_){E.metalness.value=_.metalness,_.metalnessMap&&(E.metalnessMap.value=_.metalnessMap,t(_.metalnessMap,E.metalnessMapTransform)),E.roughness.value=_.roughness,_.roughnessMap&&(E.roughnessMap.value=_.roughnessMap,t(_.roughnessMap,E.roughnessMapTransform)),_.envMap&&(E.envMapIntensity.value=_.envMapIntensity)}function g(E,_,b){E.ior.value=_.ior,_.sheen>0&&(E.sheenColor.value.copy(_.sheenColor).multiplyScalar(_.sheen),E.sheenRoughness.value=_.sheenRoughness,_.sheenColorMap&&(E.sheenColorMap.value=_.sheenColorMap,t(_.sheenColorMap,E.sheenColorMapTransform)),_.sheenRoughnessMap&&(E.sheenRoughnessMap.value=_.sheenRoughnessMap,t(_.sheenRoughnessMap,E.sheenRoughnessMapTransform))),_.clearcoat>0&&(E.clearcoat.value=_.clearcoat,E.clearcoatRoughness.value=_.clearcoatRoughness,_.clearcoatMap&&(E.clearcoatMap.value=_.clearcoatMap,t(_.clearcoatMap,E.clearcoatMapTransform)),_.clearcoatRoughnessMap&&(E.clearcoatRoughnessMap.value=_.clearcoatRoughnessMap,t(_.clearcoatRoughnessMap,E.clearcoatRoughnessMapTransform)),_.clearcoatNormalMap&&(E.clearcoatNormalMap.value=_.clearcoatNormalMap,t(_.clearcoatNormalMap,E.clearcoatNormalMapTransform),E.clearcoatNormalScale.value.copy(_.clearcoatNormalScale),_.side===wa&&E.clearcoatNormalScale.value.negate())),_.dispersion>0&&(E.dispersion.value=_.dispersion),_.iridescence>0&&(E.iridescence.value=_.iridescence,E.iridescenceIOR.value=_.iridescenceIOR,E.iridescenceThicknessMinimum.value=_.iridescenceThicknessRange[0],E.iridescenceThicknessMaximum.value=_.iridescenceThicknessRange[1],_.iridescenceMap&&(E.iridescenceMap.value=_.iridescenceMap,t(_.iridescenceMap,E.iridescenceMapTransform)),_.iridescenceThicknessMap&&(E.iridescenceThicknessMap.value=_.iridescenceThicknessMap,t(_.iridescenceThicknessMap,E.iridescenceThicknessMapTransform))),_.transmission>0&&(E.transmission.value=_.transmission,E.transmissionSamplerMap.value=b.texture,E.transmissionSamplerSize.value.set(b.width,b.height),_.transmissionMap&&(E.transmissionMap.value=_.transmissionMap,t(_.transmissionMap,E.transmissionMapTransform)),E.thickness.value=_.thickness,_.thicknessMap&&(E.thicknessMap.value=_.thicknessMap,t(_.thicknessMap,E.thicknessMapTransform)),E.attenuationDistance.value=_.attenuationDistance,E.attenuationColor.value.copy(_.attenuationColor)),_.anisotropy>0&&(E.anisotropyVector.value.set(_.anisotropy*Math.cos(_.anisotropyRotation),_.anisotropy*Math.sin(_.anisotropyRotation)),_.anisotropyMap&&(E.anisotropyMap.value=_.anisotropyMap,t(_.anisotropyMap,E.anisotropyMapTransform))),E.specularIntensity.value=_.specularIntensity,E.specularColor.value.copy(_.specularColor),_.specularColorMap&&(E.specularColorMap.value=_.specularColorMap,t(_.specularColorMap,E.specularColorMapTransform)),_.specularIntensityMap&&(E.specularIntensityMap.value=_.specularIntensityMap,t(_.specularIntensityMap,E.specularIntensityMapTransform))}function y(E,_){_.matcap&&(E.matcap.value=_.matcap)}function x(E,_){const b=e.get(_).light;E.referencePosition.value.setFromMatrixPosition(b.matrixWorld),E.nearDistance.value=b.shadow.camera.near,E.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function VZ(s,e,t,n){let i={},r={},a=[];const o=s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS);function l(b,C){const I=C.program;n.uniformBlockBinding(b,I)}function c(b,C){let I=i[b.id];I===void 0&&(y(b),I=h(b),i[b.id]=I,b.addEventListener("dispose",E));const M=C.program;n.updateUBOMapping(b,M);const R=e.render.frame;r[b.id]!==R&&(p(b),r[b.id]=R)}function h(b){const C=f();b.__bindingPointIndex=C;const I=s.createBuffer(),M=b.__size,R=b.usage;return s.bindBuffer(s.UNIFORM_BUFFER,I),s.bufferData(s.UNIFORM_BUFFER,M,R),s.bindBuffer(s.UNIFORM_BUFFER,null),s.bindBufferBase(s.UNIFORM_BUFFER,C,I),I}function f(){for(let b=0;b<o;b++)if(a.indexOf(b)===-1)return a.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function p(b){const C=i[b.id],I=b.uniforms,M=b.__cache;s.bindBuffer(s.UNIFORM_BUFFER,C);for(let R=0,D=I.length;R<D;R++){const P=Array.isArray(I[R])?I[R]:[I[R]];for(let L=0,O=P.length;L<O;L++){const U=P[L];if(g(U,R,L,M)===!0){const j=U.__offset,H=Array.isArray(U.value)?U.value:[U.value];let z=0;for(let q=0;q<H.length;q++){const k=H[q],W=x(k);typeof k=="number"||typeof k=="boolean"?(U.__data[0]=k,s.bufferSubData(s.UNIFORM_BUFFER,j+z,U.__data)):k.isMatrix3?(U.__data[0]=k.elements[0],U.__data[1]=k.elements[1],U.__data[2]=k.elements[2],U.__data[3]=0,U.__data[4]=k.elements[3],U.__data[5]=k.elements[4],U.__data[6]=k.elements[5],U.__data[7]=0,U.__data[8]=k.elements[6],U.__data[9]=k.elements[7],U.__data[10]=k.elements[8],U.__data[11]=0):(k.toArray(U.__data,z),z+=W.storage/Float32Array.BYTES_PER_ELEMENT)}s.bufferSubData(s.UNIFORM_BUFFER,j,U.__data)}}}s.bindBuffer(s.UNIFORM_BUFFER,null)}function g(b,C,I,M){const R=b.value,D=C+"_"+I;if(M[D]===void 0)return typeof R=="number"||typeof R=="boolean"?M[D]=R:M[D]=R.clone(),!0;{const P=M[D];if(typeof R=="number"||typeof R=="boolean"){if(P!==R)return M[D]=R,!0}else if(P.equals(R)===!1)return P.copy(R),!0}return!1}function y(b){const C=b.uniforms;let I=0;const M=16;for(let D=0,P=C.length;D<P;D++){const L=Array.isArray(C[D])?C[D]:[C[D]];for(let O=0,U=L.length;O<U;O++){const j=L[O],H=Array.isArray(j.value)?j.value:[j.value];for(let z=0,q=H.length;z<q;z++){const k=H[z],W=x(k),V=I%M,X=V%W.boundary,K=V+X;I+=X,K!==0&&M-K<W.storage&&(I+=M-K),j.__data=new Float32Array(W.storage/Float32Array.BYTES_PER_ELEMENT),j.__offset=I,I+=W.storage}}}const R=I%M;return R>0&&(I+=M-R),b.__size=I,b.__cache={},this}function x(b){const C={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(C.boundary=4,C.storage=4):b.isVector2?(C.boundary=8,C.storage=8):b.isVector3||b.isColor?(C.boundary=16,C.storage=12):b.isVector4?(C.boundary=16,C.storage=16):b.isMatrix3?(C.boundary=48,C.storage=48):b.isMatrix4?(C.boundary=64,C.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),C}function E(b){const C=b.target;C.removeEventListener("dispose",E);const I=a.indexOf(C.__bindingPointIndex);a.splice(I,1),s.deleteBuffer(i[C.id]),delete i[C.id],delete r[C.id]}function _(){for(const b in i)s.deleteBuffer(i[b]);a=[],i={},r={}}return{bind:l,update:c,dispose:_}}class qB{constructor(e={}){const{canvas:t=Ik(),context:n=null,depth:i=!0,stencil:r=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:f=!1,reversedDepthBuffer:p=!1}=e;this.isWebGLRenderer=!0;let g;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");g=n.getContextAttributes().alpha}else g=a;const y=new Uint32Array(4),x=new Int32Array(4);let E=null,_=null;const b=[],C=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=hc,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const I=this;let M=!1;this._outputColorSpace=sa;let R=0,D=0,P=null,L=-1,O=null;const U=new Tn,j=new Tn;let H=null;const z=new Tt(0);let q=0,k=t.width,W=t.height,V=1,X=null,K=null;const te=new Tn(0,0,k,W),oe=new Tn(0,0,k,W);let Ee=!1;const Ce=new l0;let se=!1,ie=!1;const ne=new Pt,re=new de,Be=new Tn,Ge={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ue=!1;function nt(){return P===null?V:1}let pe=n;function ve(J,ye){return t.getContext(J,ye)}try{const J={alpha:!0,depth:i,stencil:r,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:f};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${fE}`),t.addEventListener("webglcontextlost",St,!1),t.addEventListener("webglcontextrestored",Nt,!1),t.addEventListener("webglcontextcreationerror",yt,!1),pe===null){const ye="webgl2";if(pe=ve(ye,J),pe===null)throw ve(ye)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(J){throw console.error("THREE.WebGLRenderer: "+J.message),J}let Ae,Se,be,Re,me,ue,$e,gt,ge,ae,Pe,Ve,rt,et,Mt,Et,Rt,Gt,pt,At,Qt,Ut,vt,Vt;function Oe(){Ae=new nJ(pe),Ae.init(),Ut=new TG(pe,Ae),Se=new X$(pe,Ae,e,Ut),be=new NZ(pe,Ae),Se.reversedDepthBuffer&&p&&be.buffers.depth.setReversed(!0),Re=new rJ(pe),me=new SZ,ue=new FZ(pe,Ae,be,me,Se,Ut,Re),$e=new $$(I),gt=new tJ(I),ge=new hW(pe),vt=new K$(pe,ge),ae=new iJ(pe,ge,Re,vt),Pe=new oJ(pe,ae,ge,Re),pt=new aJ(pe,Se,ue),Et=new W$(me),Ve=new _Z(I,$e,gt,Ae,Se,vt,Et),rt=new QZ(I,me),et=new TZ,Mt=new BZ(Ae),Gt=new q$(I,$e,gt,be,Pe,g,l),Rt=new OZ(I,Pe,Se),Vt=new VZ(pe,Re,Se,be),At=new Y$(pe,Ae,Re),Qt=new sJ(pe,Ae,Re),Re.programs=Ve.programs,I.capabilities=Se,I.extensions=Ae,I.properties=me,I.renderLists=et,I.shadowMap=Rt,I.state=be,I.info=Re}Oe();const Qe=new HZ(I,pe);this.xr=Qe,this.getContext=function(){return pe},this.getContextAttributes=function(){return pe.getContextAttributes()},this.forceContextLoss=function(){const J=Ae.get("WEBGL_lose_context");J&&J.loseContext()},this.forceContextRestore=function(){const J=Ae.get("WEBGL_lose_context");J&&J.restoreContext()},this.getPixelRatio=function(){return V},this.setPixelRatio=function(J){J!==void 0&&(V=J,this.setSize(k,W,!1))},this.getSize=function(J){return J.set(k,W)},this.setSize=function(J,ye,_e=!0){if(Qe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}k=J,W=ye,t.width=Math.floor(J*V),t.height=Math.floor(ye*V),_e===!0&&(t.style.width=J+"px",t.style.height=ye+"px"),this.setViewport(0,0,J,ye)},this.getDrawingBufferSize=function(J){return J.set(k*V,W*V).floor()},this.setDrawingBufferSize=function(J,ye,_e){k=J,W=ye,V=_e,t.width=Math.floor(J*_e),t.height=Math.floor(ye*_e),this.setViewport(0,0,J,ye)},this.getCurrentViewport=function(J){return J.copy(U)},this.getViewport=function(J){return J.copy(te)},this.setViewport=function(J,ye,_e,Me){J.isVector4?te.set(J.x,J.y,J.z,J.w):te.set(J,ye,_e,Me),be.viewport(U.copy(te).multiplyScalar(V).round())},this.getScissor=function(J){return J.copy(oe)},this.setScissor=function(J,ye,_e,Me){J.isVector4?oe.set(J.x,J.y,J.z,J.w):oe.set(J,ye,_e,Me),be.scissor(j.copy(oe).multiplyScalar(V).round())},this.getScissorTest=function(){return Ee},this.setScissorTest=function(J){be.setScissorTest(Ee=J)},this.setOpaqueSort=function(J){X=J},this.setTransparentSort=function(J){K=J},this.getClearColor=function(J){return J.copy(Gt.getClearColor())},this.setClearColor=function(){Gt.setClearColor(...arguments)},this.getClearAlpha=function(){return Gt.getClearAlpha()},this.setClearAlpha=function(){Gt.setClearAlpha(...arguments)},this.clear=function(J=!0,ye=!0,_e=!0){let Me=0;if(J){let xe=!1;if(P!==null){const ht=P.texture.format;xe=ht===LT||ht===DT||ht===pE}if(xe){const ht=P.texture.type,tt=ht===ds||ht===Rh||ht===PA||ht===NA||ht===RT||ht===BT,at=Gt.getClearColor(),ot=Gt.getClearAlpha(),_t=at.r,wt=at.g,It=at.b;tt?(y[0]=_t,y[1]=wt,y[2]=It,y[3]=ot,pe.clearBufferuiv(pe.COLOR,0,y)):(x[0]=_t,x[1]=wt,x[2]=It,x[3]=ot,pe.clearBufferiv(pe.COLOR,0,x))}else Me|=pe.COLOR_BUFFER_BIT}ye&&(Me|=pe.DEPTH_BUFFER_BIT),_e&&(Me|=pe.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),pe.clear(Me)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",St,!1),t.removeEventListener("webglcontextrestored",Nt,!1),t.removeEventListener("webglcontextcreationerror",yt,!1),Gt.dispose(),et.dispose(),Mt.dispose(),me.dispose(),$e.dispose(),gt.dispose(),Pe.dispose(),vt.dispose(),Vt.dispose(),Ve.dispose(),Qe.dispose(),Qe.removeEventListener("sessionstart",$i),Qe.removeEventListener("sessionend",Ji),Ti.stop()};function St(J){J.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function Nt(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1;const J=Re.autoReset,ye=Rt.enabled,_e=Rt.autoUpdate,Me=Rt.needsUpdate,xe=Rt.type;Oe(),Re.autoReset=J,Rt.enabled=ye,Rt.autoUpdate=_e,Rt.needsUpdate=Me,Rt.type=xe}function yt(J){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",J.statusMessage)}function dt(J){const ye=J.target;ye.removeEventListener("dispose",dt),zt(ye)}function zt(J){tn(J),me.remove(J)}function tn(J){const ye=me.get(J).programs;ye!==void 0&&(ye.forEach(function(_e){Ve.releaseProgram(_e)}),J.isShaderMaterial&&Ve.releaseShaderCache(J))}this.renderBufferDirect=function(J,ye,_e,Me,xe,ht){ye===null&&(ye=Ge);const tt=xe.isMesh&&xe.matrixWorld.determinant()<0,at=fe(J,ye,_e,Me,xe);be.setMaterial(Me,tt);let ot=_e.index,_t=1;if(Me.wireframe===!0){if(ot=ae.getWireframeAttribute(_e),ot===void 0)return;_t=2}const wt=_e.drawRange,It=_e.attributes.position;let Kt=wt.start*_t,on=(wt.start+wt.count)*_t;ht!==null&&(Kt=Math.max(Kt,ht.start*_t),on=Math.min(on,(ht.start+ht.count)*_t)),ot!==null?(Kt=Math.max(Kt,0),on=Math.min(on,ot.count)):It!=null&&(Kt=Math.max(Kt,0),on=Math.min(on,It.count));const nn=on-Kt;if(nn<0||nn===1/0)return;vt.setup(xe,Me,at,_e,ot);let Cn,Ht=At;if(ot!==null&&(Cn=ge.get(ot),Ht=Qt,Ht.setIndex(Cn)),xe.isMesh)Me.wireframe===!0?(be.setLineWidth(Me.wireframeLinewidth*nt()),Ht.setMode(pe.LINES)):Ht.setMode(pe.TRIANGLES);else if(xe.isLine){let Dt=Me.linewidth;Dt===void 0&&(Dt=1),be.setLineWidth(Dt*nt()),xe.isLineSegments?Ht.setMode(pe.LINES):xe.isLineLoop?Ht.setMode(pe.LINE_LOOP):Ht.setMode(pe.LINE_STRIP)}else xe.isPoints?Ht.setMode(pe.POINTS):xe.isSprite&&Ht.setMode(pe.TRIANGLES);if(xe.isBatchedMesh)if(xe._multiDrawInstances!==null)EA("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Ht.renderMultiDrawInstances(xe._multiDrawStarts,xe._multiDrawCounts,xe._multiDrawCount,xe._multiDrawInstances);else if(Ae.get("WEBGL_multi_draw"))Ht.renderMultiDraw(xe._multiDrawStarts,xe._multiDrawCounts,xe._multiDrawCount);else{const Dt=xe._multiDrawStarts,Vn=xe._multiDrawCounts,An=xe._multiDrawCount,ii=ot?ge.get(ot).bytesPerElement:1,In=me.get(Me).currentProgram.getUniforms();for(let Yn=0;Yn<An;Yn++)In.setValue(pe,"_gl_DrawID",Yn),Ht.render(Dt[Yn]/ii,Vn[Yn])}else if(xe.isInstancedMesh)Ht.renderInstances(Kt,nn,xe.count);else if(_e.isInstancedBufferGeometry){const Dt=_e._maxInstanceCount!==void 0?_e._maxInstanceCount:1/0,Vn=Math.min(_e.instanceCount,Dt);Ht.renderInstances(Kt,nn,Vn)}else Ht.render(Kt,nn)};function Un(J,ye,_e){J.transparent===!0&&J.side===cc&&J.forceSinglePass===!1?(J.side=wa,J.needsUpdate=!0,mr(J,ye,_e),J.side=bu,J.needsUpdate=!0,mr(J,ye,_e),J.side=cc):mr(J,ye,_e)}this.compile=function(J,ye,_e=null){_e===null&&(_e=J),_=Mt.get(_e),_.init(ye),C.push(_),_e.traverseVisible(function(xe){xe.isLight&&xe.layers.test(ye.layers)&&(_.pushLight(xe),xe.castShadow&&_.pushShadow(xe))}),J!==_e&&J.traverseVisible(function(xe){xe.isLight&&xe.layers.test(ye.layers)&&(_.pushLight(xe),xe.castShadow&&_.pushShadow(xe))}),_.setupLights();const Me=new Set;return J.traverse(function(xe){if(!(xe.isMesh||xe.isPoints||xe.isLine||xe.isSprite))return;const ht=xe.material;if(ht)if(Array.isArray(ht))for(let tt=0;tt<ht.length;tt++){const at=ht[tt];Un(at,_e,xe),Me.add(at)}else Un(ht,_e,xe),Me.add(ht)}),_=C.pop(),Me},this.compileAsync=function(J,ye,_e=null){const Me=this.compile(J,ye,_e);return new Promise(xe=>{function ht(){if(Me.forEach(function(tt){me.get(tt).currentProgram.isReady()&&Me.delete(tt)}),Me.size===0){xe(J);return}setTimeout(ht,10)}Ae.get("KHR_parallel_shader_compile")!==null?ht():setTimeout(ht,10)})};let Ln=null;function Hr(J){Ln&&Ln(J)}function $i(){Ti.stop()}function Ji(){Ti.start()}const Ti=new EG;Ti.setAnimationLoop(Hr),typeof self<"u"&&Ti.setContext(self),this.setAnimationLoop=function(J){Ln=J,Qe.setAnimationLoop(J),J===null?Ti.stop():Ti.start()},Qe.addEventListener("sessionstart",$i),Qe.addEventListener("sessionend",Ji),this.render=function(J,ye){if(ye!==void 0&&ye.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(M===!0)return;if(J.matrixWorldAutoUpdate===!0&&J.updateMatrixWorld(),ye.parent===null&&ye.matrixWorldAutoUpdate===!0&&ye.updateMatrixWorld(),Qe.enabled===!0&&Qe.isPresenting===!0&&(Qe.cameraAutoUpdate===!0&&Qe.updateCamera(ye),ye=Qe.getCamera()),J.isScene===!0&&J.onBeforeRender(I,J,ye,P),_=Mt.get(J,C.length),_.init(ye),C.push(_),ne.multiplyMatrices(ye.projectionMatrix,ye.matrixWorldInverse),Ce.setFromProjectionMatrix(ne,Po,ye.reversedDepth),ie=this.localClippingEnabled,se=Et.init(this.clippingPlanes,ie),E=et.get(J,b.length),E.init(),b.push(E),Qe.enabled===!0&&Qe.isPresenting===!0){const ht=I.xr.getDepthSensingMesh();ht!==null&&Zs(ht,ye,-1/0,I.sortObjects)}Zs(J,ye,0,I.sortObjects),E.finish(),I.sortObjects===!0&&E.sort(X,K),Ue=Qe.enabled===!1||Qe.isPresenting===!1||Qe.hasDepthSensing()===!1,Ue&&Gt.addToRenderList(E,J),this.info.render.frame++,se===!0&&Et.beginShadows();const _e=_.state.shadowsArray;Rt.render(_e,J,ye),se===!0&&Et.endShadows(),this.info.autoReset===!0&&this.info.reset();const Me=E.opaque,xe=E.transmissive;if(_.setupLights(),ye.isArrayCamera){const ht=ye.cameras;if(xe.length>0)for(let tt=0,at=ht.length;tt<at;tt++){const ot=ht[tt];fo(Me,xe,J,ot)}Ue&&Gt.render(J);for(let tt=0,at=ht.length;tt<at;tt++){const ot=ht[tt];Cr(E,J,ot,ot.viewport)}}else xe.length>0&&fo(Me,xe,J,ye),Ue&&Gt.render(J),Cr(E,J,ye);P!==null&&D===0&&(ue.updateMultisampleRenderTarget(P),ue.updateRenderTargetMipmap(P)),J.isScene===!0&&J.onAfterRender(I,J,ye),vt.resetDefaultState(),L=-1,O=null,C.pop(),C.length>0?(_=C[C.length-1],se===!0&&Et.setGlobalState(I.clippingPlanes,_.state.camera)):_=null,b.pop(),b.length>0?E=b[b.length-1]:E=null};function Zs(J,ye,_e,Me){if(J.visible===!1)return;if(J.layers.test(ye.layers)){if(J.isGroup)_e=J.renderOrder;else if(J.isLOD)J.autoUpdate===!0&&J.update(ye);else if(J.isLight)_.pushLight(J),J.castShadow&&_.pushShadow(J);else if(J.isSprite){if(!J.frustumCulled||Ce.intersectsSprite(J)){Me&&Be.setFromMatrixPosition(J.matrixWorld).applyMatrix4(ne);const tt=Pe.update(J),at=J.material;at.visible&&E.push(J,tt,at,_e,Be.z,null)}}else if((J.isMesh||J.isLine||J.isPoints)&&(!J.frustumCulled||Ce.intersectsObject(J))){const tt=Pe.update(J),at=J.material;if(Me&&(J.boundingSphere!==void 0?(J.boundingSphere===null&&J.computeBoundingSphere(),Be.copy(J.boundingSphere.center)):(tt.boundingSphere===null&&tt.computeBoundingSphere(),Be.copy(tt.boundingSphere.center)),Be.applyMatrix4(J.matrixWorld).applyMatrix4(ne)),Array.isArray(at)){const ot=tt.groups;for(let _t=0,wt=ot.length;_t<wt;_t++){const It=ot[_t],Kt=at[It.materialIndex];Kt&&Kt.visible&&E.push(J,tt,Kt,_e,Be.z,It)}}else at.visible&&E.push(J,tt,at,_e,Be.z,null)}}const ht=J.children;for(let tt=0,at=ht.length;tt<at;tt++)Zs(ht[tt],ye,_e,Me)}function Cr(J,ye,_e,Me){const xe=J.opaque,ht=J.transmissive,tt=J.transparent;_.setupLightsView(_e),se===!0&&Et.setGlobalState(I.clippingPlanes,_e),Me&&be.viewport(U.copy(Me)),xe.length>0&&Ts(xe,ye,_e),ht.length>0&&Ts(ht,ye,_e),tt.length>0&&Ts(tt,ye,_e),be.buffers.depth.setTest(!0),be.buffers.depth.setMask(!0),be.buffers.color.setMask(!0),be.setPolygonOffset(!1)}function fo(J,ye,_e,Me){if((_e.isScene===!0?_e.overrideMaterial:null)!==null)return;_.state.transmissionRenderTarget[Me.id]===void 0&&(_.state.transmissionRenderTarget[Me.id]=new _l(1,1,{generateMipmaps:!0,type:Ae.has("EXT_color_buffer_half_float")||Ae.has("EXT_color_buffer_float")?hr:ds,minFilter:Oo,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Jn.workingColorSpace}));const ht=_.state.transmissionRenderTarget[Me.id],tt=Me.viewport||U;ht.setSize(tt.z*I.transmissionResolutionScale,tt.w*I.transmissionResolutionScale);const at=I.getRenderTarget(),ot=I.getActiveCubeFace(),_t=I.getActiveMipmapLevel();I.setRenderTarget(ht),I.getClearColor(z),q=I.getClearAlpha(),q<1&&I.setClearColor(16777215,.5),I.clear(),Ue&&Gt.render(_e);const wt=I.toneMapping;I.toneMapping=hc;const It=Me.viewport;if(Me.viewport!==void 0&&(Me.viewport=void 0),_.setupLightsView(Me),se===!0&&Et.setGlobalState(I.clippingPlanes,Me),Ts(J,_e,Me),ue.updateMultisampleRenderTarget(ht),ue.updateRenderTargetMipmap(ht),Ae.has("WEBGL_multisampled_render_to_texture")===!1){let Kt=!1;for(let on=0,nn=ye.length;on<nn;on++){const Cn=ye[on],Ht=Cn.object,Dt=Cn.geometry,Vn=Cn.material,An=Cn.group;if(Vn.side===cc&&Ht.layers.test(Me.layers)){const ii=Vn.side;Vn.side=wa,Vn.needsUpdate=!0,an(Ht,_e,Me,Dt,Vn,An),Vn.side=ii,Vn.needsUpdate=!0,Kt=!0}}Kt===!0&&(ue.updateMultisampleRenderTarget(ht),ue.updateRenderTargetMipmap(ht))}I.setRenderTarget(at,ot,_t),I.setClearColor(z,q),It!==void 0&&(Me.viewport=It),I.toneMapping=wt}function Ts(J,ye,_e){const Me=ye.isScene===!0?ye.overrideMaterial:null;for(let xe=0,ht=J.length;xe<ht;xe++){const tt=J[xe],at=tt.object,ot=tt.geometry,_t=tt.group;let wt=tt.material;wt.allowOverride===!0&&Me!==null&&(wt=Me),at.layers.test(_e.layers)&&an(at,ye,_e,ot,wt,_t)}}function an(J,ye,_e,Me,xe,ht){J.onBeforeRender(I,ye,_e,Me,xe,ht),J.modelViewMatrix.multiplyMatrices(_e.matrixWorldInverse,J.matrixWorld),J.normalMatrix.getNormalMatrix(J.modelViewMatrix),xe.onBeforeRender(I,ye,_e,Me,J,ht),xe.transparent===!0&&xe.side===cc&&xe.forceSinglePass===!1?(xe.side=wa,xe.needsUpdate=!0,I.renderBufferDirect(_e,ye,Me,xe,J,ht),xe.side=bu,xe.needsUpdate=!0,I.renderBufferDirect(_e,ye,Me,xe,J,ht),xe.side=cc):I.renderBufferDirect(_e,ye,Me,xe,J,ht),J.onAfterRender(I,ye,_e,Me,xe,ht)}function mr(J,ye,_e){ye.isScene!==!0&&(ye=Ge);const Me=me.get(J),xe=_.state.lights,ht=_.state.shadowsArray,tt=xe.state.version,at=Ve.getParameters(J,xe.state,ht,ye,_e),ot=Ve.getProgramCacheKey(at);let _t=Me.programs;Me.environment=J.isMeshStandardMaterial?ye.environment:null,Me.fog=ye.fog,Me.envMap=(J.isMeshStandardMaterial?gt:$e).get(J.envMap||Me.environment),Me.envMapRotation=Me.environment!==null&&J.envMap===null?ye.environmentRotation:J.envMapRotation,_t===void 0&&(J.addEventListener("dispose",dt),_t=new Map,Me.programs=_t);let wt=_t.get(ot);if(wt!==void 0){if(Me.currentProgram===wt&&Me.lightsStateVersion===tt)return Z(J,at),wt}else at.uniforms=Ve.getUniforms(J),J.onBeforeCompile(at,I),wt=Ve.acquireProgram(at,ot),_t.set(ot,wt),Me.uniforms=at.uniforms;const It=Me.uniforms;return(!J.isShaderMaterial&&!J.isRawShaderMaterial||J.clipping===!0)&&(It.clippingPlanes=Et.uniform),Z(J,at),Me.needsLights=qe(J),Me.lightsStateVersion=tt,Me.needsLights&&(It.ambientLightColor.value=xe.state.ambient,It.lightProbe.value=xe.state.probe,It.directionalLights.value=xe.state.directional,It.directionalLightShadows.value=xe.state.directionalShadow,It.spotLights.value=xe.state.spot,It.spotLightShadows.value=xe.state.spotShadow,It.rectAreaLights.value=xe.state.rectArea,It.ltc_1.value=xe.state.rectAreaLTC1,It.ltc_2.value=xe.state.rectAreaLTC2,It.pointLights.value=xe.state.point,It.pointLightShadows.value=xe.state.pointShadow,It.hemisphereLights.value=xe.state.hemi,It.directionalShadowMap.value=xe.state.directionalShadowMap,It.directionalShadowMatrix.value=xe.state.directionalShadowMatrix,It.spotShadowMap.value=xe.state.spotShadowMap,It.spotLightMatrix.value=xe.state.spotLightMatrix,It.spotLightMap.value=xe.state.spotLightMap,It.pointShadowMap.value=xe.state.pointShadowMap,It.pointShadowMatrix.value=xe.state.pointShadowMatrix),Me.currentProgram=wt,Me.uniformsList=null,wt}function pi(J){if(J.uniformsList===null){const ye=J.currentProgram.getUniforms();J.uniformsList=XS.seqWithValue(ye.seq,J.uniforms)}return J.uniformsList}function Z(J,ye){const _e=me.get(J);_e.outputColorSpace=ye.outputColorSpace,_e.batching=ye.batching,_e.batchingColor=ye.batchingColor,_e.instancing=ye.instancing,_e.instancingColor=ye.instancingColor,_e.instancingMorph=ye.instancingMorph,_e.skinning=ye.skinning,_e.morphTargets=ye.morphTargets,_e.morphNormals=ye.morphNormals,_e.morphColors=ye.morphColors,_e.morphTargetsCount=ye.morphTargetsCount,_e.numClippingPlanes=ye.numClippingPlanes,_e.numIntersection=ye.numClipIntersection,_e.vertexAlphas=ye.vertexAlphas,_e.vertexTangents=ye.vertexTangents,_e.toneMapping=ye.toneMapping}function fe(J,ye,_e,Me,xe){ye.isScene!==!0&&(ye=Ge),ue.resetTextureUnits();const ht=ye.fog,tt=Me.isMeshStandardMaterial?ye.environment:null,at=P===null?I.outputColorSpace:P.isXRRenderTarget===!0?P.texture.colorSpace:ud,ot=(Me.isMeshStandardMaterial?gt:$e).get(Me.envMap||tt),_t=Me.vertexColors===!0&&!!_e.attributes.color&&_e.attributes.color.itemSize===4,wt=!!_e.attributes.tangent&&(!!Me.normalMap||Me.anisotropy>0),It=!!_e.morphAttributes.position,Kt=!!_e.morphAttributes.normal,on=!!_e.morphAttributes.color;let nn=hc;Me.toneMapped&&(P===null||P.isXRRenderTarget===!0)&&(nn=I.toneMapping);const Cn=_e.morphAttributes.position||_e.morphAttributes.normal||_e.morphAttributes.color,Ht=Cn!==void 0?Cn.length:0,Dt=me.get(Me),Vn=_.state.lights;if(se===!0&&(ie===!0||J!==O)){const Pn=J===O&&Me.id===L;Et.setState(Me,J,Pn)}let An=!1;Me.version===Dt.__version?(Dt.needsLights&&Dt.lightsStateVersion!==Vn.state.version||Dt.outputColorSpace!==at||xe.isBatchedMesh&&Dt.batching===!1||!xe.isBatchedMesh&&Dt.batching===!0||xe.isBatchedMesh&&Dt.batchingColor===!0&&xe.colorTexture===null||xe.isBatchedMesh&&Dt.batchingColor===!1&&xe.colorTexture!==null||xe.isInstancedMesh&&Dt.instancing===!1||!xe.isInstancedMesh&&Dt.instancing===!0||xe.isSkinnedMesh&&Dt.skinning===!1||!xe.isSkinnedMesh&&Dt.skinning===!0||xe.isInstancedMesh&&Dt.instancingColor===!0&&xe.instanceColor===null||xe.isInstancedMesh&&Dt.instancingColor===!1&&xe.instanceColor!==null||xe.isInstancedMesh&&Dt.instancingMorph===!0&&xe.morphTexture===null||xe.isInstancedMesh&&Dt.instancingMorph===!1&&xe.morphTexture!==null||Dt.envMap!==ot||Me.fog===!0&&Dt.fog!==ht||Dt.numClippingPlanes!==void 0&&(Dt.numClippingPlanes!==Et.numPlanes||Dt.numIntersection!==Et.numIntersection)||Dt.vertexAlphas!==_t||Dt.vertexTangents!==wt||Dt.morphTargets!==It||Dt.morphNormals!==Kt||Dt.morphColors!==on||Dt.toneMapping!==nn||Dt.morphTargetsCount!==Ht)&&(An=!0):(An=!0,Dt.__version=Me.version);let ii=Dt.currentProgram;An===!0&&(ii=mr(Me,ye,xe));let In=!1,Yn=!1,yn=!1;const $t=ii.getUniforms(),li=Dt.uniforms;if(be.useProgram(ii.program)&&(In=!0,Yn=!0,yn=!0),Me.id!==L&&(L=Me.id,Yn=!0),In||O!==J){be.buffers.depth.getReversed()&&J.reversedDepth!==!0&&(J._reversedDepth=!0,J.updateProjectionMatrix()),$t.setValue(pe,"projectionMatrix",J.projectionMatrix),$t.setValue(pe,"viewMatrix",J.matrixWorldInverse);const Ci=$t.map.cameraPosition;Ci!==void 0&&Ci.setValue(pe,re.setFromMatrixPosition(J.matrixWorld)),Se.logarithmicDepthBuffer&&$t.setValue(pe,"logDepthBufFC",2/(Math.log(J.far+1)/Math.LN2)),(Me.isMeshPhongMaterial||Me.isMeshToonMaterial||Me.isMeshLambertMaterial||Me.isMeshBasicMaterial||Me.isMeshStandardMaterial||Me.isShaderMaterial)&&$t.setValue(pe,"isOrthographic",J.isOrthographicCamera===!0),O!==J&&(O=J,Yn=!0,yn=!0)}if(xe.isSkinnedMesh){$t.setOptional(pe,xe,"bindMatrix"),$t.setOptional(pe,xe,"bindMatrixInverse");const Pn=xe.skeleton;Pn&&(Pn.boneTexture===null&&Pn.computeBoneTexture(),$t.setValue(pe,"boneTexture",Pn.boneTexture,ue))}xe.isBatchedMesh&&($t.setOptional(pe,xe,"batchingTexture"),$t.setValue(pe,"batchingTexture",xe._matricesTexture,ue),$t.setOptional(pe,xe,"batchingIdTexture"),$t.setValue(pe,"batchingIdTexture",xe._indirectTexture,ue),$t.setOptional(pe,xe,"batchingColorTexture"),xe._colorsTexture!==null&&$t.setValue(pe,"batchingColorTexture",xe._colorsTexture,ue));const Oi=_e.morphAttributes;if((Oi.position!==void 0||Oi.normal!==void 0||Oi.color!==void 0)&&pt.update(xe,_e,ii),(Yn||Dt.receiveShadow!==xe.receiveShadow)&&(Dt.receiveShadow=xe.receiveShadow,$t.setValue(pe,"receiveShadow",xe.receiveShadow)),Me.isMeshGouraudMaterial&&Me.envMap!==null&&(li.envMap.value=ot,li.flipEnvMap.value=ot.isCubeTexture&&ot.isRenderTargetTexture===!1?-1:1),Me.isMeshStandardMaterial&&Me.envMap===null&&ye.environment!==null&&(li.envMapIntensity.value=ye.environmentIntensity),Yn&&($t.setValue(pe,"toneMappingExposure",I.toneMappingExposure),Dt.needsLights&&we(li,yn),ht&&Me.fog===!0&&rt.refreshFogUniforms(li,ht),rt.refreshMaterialUniforms(li,Me,V,W,_.state.transmissionRenderTarget[J.id]),XS.upload(pe,pi(Dt),li,ue)),Me.isShaderMaterial&&Me.uniformsNeedUpdate===!0&&(XS.upload(pe,pi(Dt),li,ue),Me.uniformsNeedUpdate=!1),Me.isSpriteMaterial&&$t.setValue(pe,"center",xe.center),$t.setValue(pe,"modelViewMatrix",xe.modelViewMatrix),$t.setValue(pe,"normalMatrix",xe.normalMatrix),$t.setValue(pe,"modelMatrix",xe.matrixWorld),Me.isShaderMaterial||Me.isRawShaderMaterial){const Pn=Me.uniformsGroups;for(let Ci=0,Du=Pn.length;Ci<Du;Ci++){const Cs=Pn[Ci];Vt.update(Cs,ii),Vt.bind(Cs,ii)}}return ii}function we(J,ye){J.ambientLightColor.needsUpdate=ye,J.lightProbe.needsUpdate=ye,J.directionalLights.needsUpdate=ye,J.directionalLightShadows.needsUpdate=ye,J.pointLights.needsUpdate=ye,J.pointLightShadows.needsUpdate=ye,J.spotLights.needsUpdate=ye,J.spotLightShadows.needsUpdate=ye,J.rectAreaLights.needsUpdate=ye,J.hemisphereLights.needsUpdate=ye}function qe(J){return J.isMeshLambertMaterial||J.isMeshToonMaterial||J.isMeshPhongMaterial||J.isMeshStandardMaterial||J.isShadowMaterial||J.isShaderMaterial&&J.lights===!0}this.getActiveCubeFace=function(){return R},this.getActiveMipmapLevel=function(){return D},this.getRenderTarget=function(){return P},this.setRenderTargetTextures=function(J,ye,_e){const Me=me.get(J);Me.__autoAllocateDepthBuffer=J.resolveDepthBuffer===!1,Me.__autoAllocateDepthBuffer===!1&&(Me.__useRenderToTexture=!1),me.get(J.texture).__webglTexture=ye,me.get(J.depthTexture).__webglTexture=Me.__autoAllocateDepthBuffer?void 0:_e,Me.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(J,ye){const _e=me.get(J);_e.__webglFramebuffer=ye,_e.__useDefaultFramebuffer=ye===void 0};const Ye=pe.createFramebuffer();this.setRenderTarget=function(J,ye=0,_e=0){P=J,R=ye,D=_e;let Me=!0,xe=null,ht=!1,tt=!1;if(J){const ot=me.get(J);if(ot.__useDefaultFramebuffer!==void 0)be.bindFramebuffer(pe.FRAMEBUFFER,null),Me=!1;else if(ot.__webglFramebuffer===void 0)ue.setupRenderTarget(J);else if(ot.__hasExternalTextures)ue.rebindTextures(J,me.get(J.texture).__webglTexture,me.get(J.depthTexture).__webglTexture);else if(J.depthBuffer){const It=J.depthTexture;if(ot.__boundDepthTexture!==It){if(It!==null&&me.has(It)&&(J.width!==It.image.width||J.height!==It.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ue.setupDepthRenderbuffer(J)}}const _t=J.texture;(_t.isData3DTexture||_t.isDataArrayTexture||_t.isCompressedArrayTexture)&&(tt=!0);const wt=me.get(J).__webglFramebuffer;J.isWebGLCubeRenderTarget?(Array.isArray(wt[ye])?xe=wt[ye][_e]:xe=wt[ye],ht=!0):J.samples>0&&ue.useMultisampledRTT(J)===!1?xe=me.get(J).__webglMultisampledFramebuffer:Array.isArray(wt)?xe=wt[_e]:xe=wt,U.copy(J.viewport),j.copy(J.scissor),H=J.scissorTest}else U.copy(te).multiplyScalar(V).floor(),j.copy(oe).multiplyScalar(V).floor(),H=Ee;if(_e!==0&&(xe=Ye),be.bindFramebuffer(pe.FRAMEBUFFER,xe)&&Me&&be.drawBuffers(J,xe),be.viewport(U),be.scissor(j),be.setScissorTest(H),ht){const ot=me.get(J.texture);pe.framebufferTexture2D(pe.FRAMEBUFFER,pe.COLOR_ATTACHMENT0,pe.TEXTURE_CUBE_MAP_POSITIVE_X+ye,ot.__webglTexture,_e)}else if(tt){const ot=ye;for(let _t=0;_t<J.textures.length;_t++){const wt=me.get(J.textures[_t]);pe.framebufferTextureLayer(pe.FRAMEBUFFER,pe.COLOR_ATTACHMENT0+_t,wt.__webglTexture,_e,ot)}}else if(J!==null&&_e!==0){const ot=me.get(J.texture);pe.framebufferTexture2D(pe.FRAMEBUFFER,pe.COLOR_ATTACHMENT0,pe.TEXTURE_2D,ot.__webglTexture,_e)}L=-1},this.readRenderTargetPixels=function(J,ye,_e,Me,xe,ht,tt,at=0){if(!(J&&J.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ot=me.get(J).__webglFramebuffer;if(J.isWebGLCubeRenderTarget&&tt!==void 0&&(ot=ot[tt]),ot){be.bindFramebuffer(pe.FRAMEBUFFER,ot);try{const _t=J.textures[at],wt=_t.format,It=_t.type;if(!Se.textureFormatReadable(wt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Se.textureTypeReadable(It)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ye>=0&&ye<=J.width-Me&&_e>=0&&_e<=J.height-xe&&(J.textures.length>1&&pe.readBuffer(pe.COLOR_ATTACHMENT0+at),pe.readPixels(ye,_e,Me,xe,Ut.convert(wt),Ut.convert(It),ht))}finally{const _t=P!==null?me.get(P).__webglFramebuffer:null;be.bindFramebuffer(pe.FRAMEBUFFER,_t)}}},this.readRenderTargetPixelsAsync=async function(J,ye,_e,Me,xe,ht,tt,at=0){if(!(J&&J.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ot=me.get(J).__webglFramebuffer;if(J.isWebGLCubeRenderTarget&&tt!==void 0&&(ot=ot[tt]),ot)if(ye>=0&&ye<=J.width-Me&&_e>=0&&_e<=J.height-xe){be.bindFramebuffer(pe.FRAMEBUFFER,ot);const _t=J.textures[at],wt=_t.format,It=_t.type;if(!Se.textureFormatReadable(wt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Se.textureTypeReadable(It))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Kt=pe.createBuffer();pe.bindBuffer(pe.PIXEL_PACK_BUFFER,Kt),pe.bufferData(pe.PIXEL_PACK_BUFFER,ht.byteLength,pe.STREAM_READ),J.textures.length>1&&pe.readBuffer(pe.COLOR_ATTACHMENT0+at),pe.readPixels(ye,_e,Me,xe,Ut.convert(wt),Ut.convert(It),0);const on=P!==null?me.get(P).__webglFramebuffer:null;be.bindFramebuffer(pe.FRAMEBUFFER,on);const nn=pe.fenceSync(pe.SYNC_GPU_COMMANDS_COMPLETE,0);return pe.flush(),await NK(pe,nn,4),pe.bindBuffer(pe.PIXEL_PACK_BUFFER,Kt),pe.getBufferSubData(pe.PIXEL_PACK_BUFFER,0,ht),pe.deleteBuffer(Kt),pe.deleteSync(nn),ht}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(J,ye=null,_e=0){const Me=Math.pow(2,-_e),xe=Math.floor(J.image.width*Me),ht=Math.floor(J.image.height*Me),tt=ye!==null?ye.x:0,at=ye!==null?ye.y:0;ue.setTexture2D(J,0),pe.copyTexSubImage2D(pe.TEXTURE_2D,_e,0,0,tt,at,xe,ht),be.unbindTexture()};const it=pe.createFramebuffer(),xt=pe.createFramebuffer();this.copyTextureToTexture=function(J,ye,_e=null,Me=null,xe=0,ht=null){ht===null&&(xe!==0?(EA("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ht=xe,xe=0):ht=0);let tt,at,ot,_t,wt,It,Kt,on,nn;const Cn=J.isCompressedTexture?J.mipmaps[ht]:J.image;if(_e!==null)tt=_e.max.x-_e.min.x,at=_e.max.y-_e.min.y,ot=_e.isBox3?_e.max.z-_e.min.z:1,_t=_e.min.x,wt=_e.min.y,It=_e.isBox3?_e.min.z:0;else{const Oi=Math.pow(2,-xe);tt=Math.floor(Cn.width*Oi),at=Math.floor(Cn.height*Oi),J.isDataArrayTexture?ot=Cn.depth:J.isData3DTexture?ot=Math.floor(Cn.depth*Oi):ot=1,_t=0,wt=0,It=0}Me!==null?(Kt=Me.x,on=Me.y,nn=Me.z):(Kt=0,on=0,nn=0);const Ht=Ut.convert(ye.format),Dt=Ut.convert(ye.type);let Vn;ye.isData3DTexture?(ue.setTexture3D(ye,0),Vn=pe.TEXTURE_3D):ye.isDataArrayTexture||ye.isCompressedArrayTexture?(ue.setTexture2DArray(ye,0),Vn=pe.TEXTURE_2D_ARRAY):(ue.setTexture2D(ye,0),Vn=pe.TEXTURE_2D),pe.pixelStorei(pe.UNPACK_FLIP_Y_WEBGL,ye.flipY),pe.pixelStorei(pe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ye.premultiplyAlpha),pe.pixelStorei(pe.UNPACK_ALIGNMENT,ye.unpackAlignment);const An=pe.getParameter(pe.UNPACK_ROW_LENGTH),ii=pe.getParameter(pe.UNPACK_IMAGE_HEIGHT),In=pe.getParameter(pe.UNPACK_SKIP_PIXELS),Yn=pe.getParameter(pe.UNPACK_SKIP_ROWS),yn=pe.getParameter(pe.UNPACK_SKIP_IMAGES);pe.pixelStorei(pe.UNPACK_ROW_LENGTH,Cn.width),pe.pixelStorei(pe.UNPACK_IMAGE_HEIGHT,Cn.height),pe.pixelStorei(pe.UNPACK_SKIP_PIXELS,_t),pe.pixelStorei(pe.UNPACK_SKIP_ROWS,wt),pe.pixelStorei(pe.UNPACK_SKIP_IMAGES,It);const $t=J.isDataArrayTexture||J.isData3DTexture,li=ye.isDataArrayTexture||ye.isData3DTexture;if(J.isDepthTexture){const Oi=me.get(J),Pn=me.get(ye),Ci=me.get(Oi.__renderTarget),Du=me.get(Pn.__renderTarget);be.bindFramebuffer(pe.READ_FRAMEBUFFER,Ci.__webglFramebuffer),be.bindFramebuffer(pe.DRAW_FRAMEBUFFER,Du.__webglFramebuffer);for(let Cs=0;Cs<ot;Cs++)$t&&(pe.framebufferTextureLayer(pe.READ_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,me.get(J).__webglTexture,xe,It+Cs),pe.framebufferTextureLayer(pe.DRAW_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,me.get(ye).__webglTexture,ht,nn+Cs)),pe.blitFramebuffer(_t,wt,tt,at,Kt,on,tt,at,pe.DEPTH_BUFFER_BIT,pe.NEAREST);be.bindFramebuffer(pe.READ_FRAMEBUFFER,null),be.bindFramebuffer(pe.DRAW_FRAMEBUFFER,null)}else if(xe!==0||J.isRenderTargetTexture||me.has(J)){const Oi=me.get(J),Pn=me.get(ye);be.bindFramebuffer(pe.READ_FRAMEBUFFER,it),be.bindFramebuffer(pe.DRAW_FRAMEBUFFER,xt);for(let Ci=0;Ci<ot;Ci++)$t?pe.framebufferTextureLayer(pe.READ_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,Oi.__webglTexture,xe,It+Ci):pe.framebufferTexture2D(pe.READ_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,pe.TEXTURE_2D,Oi.__webglTexture,xe),li?pe.framebufferTextureLayer(pe.DRAW_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,Pn.__webglTexture,ht,nn+Ci):pe.framebufferTexture2D(pe.DRAW_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,pe.TEXTURE_2D,Pn.__webglTexture,ht),xe!==0?pe.blitFramebuffer(_t,wt,tt,at,Kt,on,tt,at,pe.COLOR_BUFFER_BIT,pe.NEAREST):li?pe.copyTexSubImage3D(Vn,ht,Kt,on,nn+Ci,_t,wt,tt,at):pe.copyTexSubImage2D(Vn,ht,Kt,on,_t,wt,tt,at);be.bindFramebuffer(pe.READ_FRAMEBUFFER,null),be.bindFramebuffer(pe.DRAW_FRAMEBUFFER,null)}else li?J.isDataTexture||J.isData3DTexture?pe.texSubImage3D(Vn,ht,Kt,on,nn,tt,at,ot,Ht,Dt,Cn.data):ye.isCompressedArrayTexture?pe.compressedTexSubImage3D(Vn,ht,Kt,on,nn,tt,at,ot,Ht,Cn.data):pe.texSubImage3D(Vn,ht,Kt,on,nn,tt,at,ot,Ht,Dt,Cn):J.isDataTexture?pe.texSubImage2D(pe.TEXTURE_2D,ht,Kt,on,tt,at,Ht,Dt,Cn.data):J.isCompressedTexture?pe.compressedTexSubImage2D(pe.TEXTURE_2D,ht,Kt,on,Cn.width,Cn.height,Ht,Cn.data):pe.texSubImage2D(pe.TEXTURE_2D,ht,Kt,on,tt,at,Ht,Dt,Cn);pe.pixelStorei(pe.UNPACK_ROW_LENGTH,An),pe.pixelStorei(pe.UNPACK_IMAGE_HEIGHT,ii),pe.pixelStorei(pe.UNPACK_SKIP_PIXELS,In),pe.pixelStorei(pe.UNPACK_SKIP_ROWS,Yn),pe.pixelStorei(pe.UNPACK_SKIP_IMAGES,yn),ht===0&&ye.generateMipmaps&&pe.generateMipmap(Vn),be.unbindTexture()},this.copyTextureToTexture3D=function(J,ye,_e=null,Me=null,xe=0){return EA('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(J,ye,_e,Me,xe)},this.initRenderTarget=function(J){me.get(J).__webglFramebuffer===void 0&&ue.setupRenderTarget(J)},this.initTexture=function(J){J.isCubeTexture?ue.setTextureCube(J,0):J.isData3DTexture?ue.setTexture3D(J,0):J.isDataArrayTexture||J.isCompressedArrayTexture?ue.setTexture2DArray(J,0):ue.setTexture2D(J,0),be.unbindTexture()},this.resetState=function(){R=0,D=0,P=null,be.reset(),vt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Po}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Jn._getDrawingBufferColorSpace(e),t.unpackColorSpace=Jn._getUnpackColorSpace()}}const Zb=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:sB,AddEquation:qf,AddOperation:sk,AdditiveAnimationBlendMode:hB,AdditiveBlending:_w,AgXToneMapping:ck,AlphaFormat:lB,AlwaysCompare:bk,AlwaysDepth:bb,AlwaysStencilFunc:Cw,AmbientLight:UB,AnimationAction:AG,AnimationClip:pm,AnimationLoader:lX,AnimationMixer:DX,AnimationObjectGroup:RX,AnimationUtils:sX,ArcCurve:Uk,ArrayCamera:pG,ArrowHelper:iW,AttachedBindMode:Tw,Audio:mG,AudioAnalyser:EX,AudioContext:kB,AudioListener:AX,AudioLoader:dG,AxesHelper:sW,BackSide:wa,BasicDepthPacking:gk,BasicShadowMap:U3,BatchedMesh:Nk,Bone:qA,BooleanKeyframeTrack:vm,Box2:yG,Box3:kr,Box3Helper:tW,BoxGeometry:ym,BoxHelper:eW,BufferAttribute:ei,BufferGeometry:hn,BufferGeometryLoader:hG,ByteType:rB,Cache:Au,Camera:kT,CameraHelper:ZX,CanvasTexture:IY,CapsuleGeometry:VT,CatmullRomCurve3:bB,CineonToneMapping:ok,CircleGeometry:jT,ClampToEdgeWrapping:Ur,Clock:TE,Color:Tt,ColorKeyframeTrack:OB,ColorManagement:Jn,CompressedArrayTexture:TY,CompressedCubeTexture:CY,CompressedTexture:vd,CompressedTextureLoader:cX,ConeGeometry:vE,ConstantAlphaFactor:tk,ConstantColorFactor:Z3,Controls:rW,CubeCamera:Bk,CubeReflectionMapping:Tu,CubeRefractionMapping:cd,CubeTexture:mE,CubeTextureLoader:rG,CubeUVReflectionMapping:r0,CubicBezierCurve:TB,CubicBezierCurve3:kk,CubicInterpolant:tG,CullFaceBack:xw,CullFaceFront:F3,CullFaceFrontBack:kq,CullFaceNone:N3,Curve:bl,CurvePath:Hk,CustomBlending:k3,CustomToneMapping:lk,CylinderGeometry:yE,Cylindrical:HX,Data3DTexture:NT,DataArrayTexture:PT,DataTexture:fc,DataTextureLoader:NB,DataUtils:Kp,DecrementStencilOp:Wq,DecrementWrapStencilOp:Jq,DefaultLoadingManager:sG,DepthFormat:FA,DepthStencilFormat:UA,DepthTexture:_B,DetachedBindMode:hk,DirectionalLight:sC,DirectionalLightHelper:JX,DiscreteInterpolant:nG,DodecahedronGeometry:qT,DoubleSide:cc,DstAlphaFactor:Y3,DstColorFactor:W3,DynamicCopyUsage:dK,DynamicDrawUsage:oK,DynamicReadUsage:uK,EdgesGeometry:Fk,EllipseCurve:KT,EqualCompare:Ek,EqualDepth:Cb,EqualStencilFunc:nK,EquirectangularReflectionMapping:LA,EquirectangularRefractionMapping:Lv,Euler:Os,EventDispatcher:Bu,ExtrudeGeometry:EE,FileLoader:Js,Float16BufferAttribute:iY,Float32BufferAttribute:Bt,FloatType:ss,Fog:HT,FogExp2:GT,FramebufferTexture:bY,FrontSide:bu,Frustum:l0,FrustumArray:QT,GLBufferAttribute:FX,GLSL1:mK,GLSL3:Iw,GreaterCompare:xk,GreaterDepth:Mb,GreaterEqualCompare:Sk,GreaterEqualDepth:Ib,GreaterEqualStencilFunc:aK,GreaterStencilFunc:sK,GridHelper:WX,Group:so,HalfFloatType:hr,HemisphereLight:aG,HemisphereLightHelper:XX,IcosahedronGeometry:YT,ImageBitmapLoader:fG,ImageLoader:Kv,ImageUtils:Mk,IncrementStencilOp:Xq,IncrementWrapStencilOp:$q,InstancedBufferAttribute:fm,InstancedBufferGeometry:uG,InstancedInterleavedBuffer:NX,InstancedMesh:vB,Int16BufferAttribute:tY,Int32BufferAttribute:nY,Int8BufferAttribute:JK,IntType:wT,InterleavedBuffer:gE,InterleavedBufferAttribute:hd,Interpolant:c0,InterpolateDiscrete:GA,InterpolateLinear:HA,InterpolateSmooth:KS,InterpolationSamplingMode:yK,InterpolationSamplingType:AK,InvertStencilOp:Zq,KeepStencilOp:Up,KeyframeTrack:Cl,LOD:Pk,LatheGeometry:XT,Layers:VA,LessCompare:vk,LessDepth:Tb,LessEqualCompare:pB,LessEqualDepth:hm,LessEqualStencilFunc:iK,LessStencilFunc:tK,Light:_d,LightProbe:cG,Line:Iu,Line3:VX,LineBasicMaterial:$s,LineCurve:CB,LineCurve3:Gk,LineDashedMaterial:Jk,LineLoop:EB,LineSegments:Go,LinearFilter:Si,LinearInterpolant:LB,LinearMipMapLinearFilter:Qq,LinearMipMapNearestFilter:zq,LinearMipmapLinearFilter:Oo,LinearMipmapNearestFilter:gA,LinearSRGBColorSpace:ud,LinearToneMapping:rk,LinearTransfer:Hv,Loader:Fs,LoaderUtils:Ih,LoadingManager:PB,LoopOnce:fk,LoopPingPong:pk,LoopRepeat:dk,MOUSE:Fq,Material:Ps,MaterialLoader:rC,MathUtils:Fr,Matrix2:VB,Matrix3:un,Matrix4:Pt,MaxEquation:Q3,Mesh:bi,MeshBasicMaterial:io,MeshDepthMaterial:nC,MeshDistanceMaterial:BB,MeshLambertMaterial:RB,MeshMatcapMaterial:$k,MeshNormalMaterial:Wk,MeshPhongMaterial:SA,MeshPhysicalMaterial:Tl,MeshStandardMaterial:SE,MeshToonMaterial:Xk,MinEquation:z3,MirroredRepeatWrapping:OA,MixOperation:ik,MultiplyBlending:bw,MultiplyOperation:dE,NearestFilter:Ws,NearestMipMapLinearFilter:Hq,NearestMipMapNearestFilter:Gq,NearestMipmapLinearFilter:Vp,NearestMipmapNearestFilter:MT,NeutralToneMapping:uk,NeverCompare:yk,NeverDepth:Sb,NeverStencilFunc:eK,NoBlending:Eu,NoColorSpace:Sh,NoToneMapping:hc,NormalAnimationBlendMode:OT,NormalBlending:nm,NotEqualCompare:_k,NotEqualDepth:wb,NotEqualStencilFunc:rK,NumberKeyframeTrack:fd,Object3D:Qn,ObjectLoader:dX,ObjectSpaceNormalMap:Ak,OctahedronGeometry:xE,OneFactor:j3,OneMinusConstantAlphaFactor:nk,OneMinusConstantColorFactor:ek,OneMinusDstAlphaFactor:X3,OneMinusDstColorFactor:$3,OneMinusSrcAlphaFactor:_b,OneMinusSrcColorFactor:K3,OrthographicCamera:Nh,PCFShadowMap:CT,PCFSoftShadowMap:hv,PMREMGenerator:Ow,Path:sm,PerspectiveCamera:Ki,Plane:xh,PlaneGeometry:xd,PlaneHelper:nW,PointLight:Yv,PointLightHelper:KX,Points:_A,PointsMaterial:$f,PolarGridHelper:$X,PolyhedronGeometry:Ed,PositionalAudio:vX,PropertyBinding:zn,PropertyMixer:gG,QuadraticBezierCurve:IB,QuadraticBezierCurve3:MB,Quaternion:Xs,QuaternionKeyframeTrack:dd,QuaternionLinearInterpolant:iG,RED_GREEN_RGTC2_Format:Kb,RED_RGTC1_Format:uB,REVISION:fE,RGBADepthPacking:dB,RGBAFormat:rs,RGBAIntegerFormat:LT,RGBA_ASTC_10x10_Format:Hb,RGBA_ASTC_10x5_Format:Ub,RGBA_ASTC_10x6_Format:kb,RGBA_ASTC_10x8_Format:Gb,RGBA_ASTC_12x10_Format:zb,RGBA_ASTC_12x12_Format:Qb,RGBA_ASTC_4x4_Format:kv,RGBA_ASTC_5x4_Format:Db,RGBA_ASTC_5x5_Format:Lb,RGBA_ASTC_6x5_Format:Ob,RGBA_ASTC_6x6_Format:kA,RGBA_ASTC_8x5_Format:Pb,RGBA_ASTC_8x6_Format:Nb,RGBA_ASTC_8x8_Format:Fb,RGBA_BPTC_Format:vA,RGBA_ETC2_EAC_Format:Uv,RGBA_PVRTC_2BPPV1_Format:Bb,RGBA_PVRTC_4BPPV1_Format:Pv,RGBA_S3TC_DXT1_Format:fv,RGBA_S3TC_DXT3_Format:dv,RGBA_S3TC_DXT5_Format:yA,RGBDepthPacking:jq,RGBFormat:cB,RGBIntegerFormat:Vq,RGB_BPTC_SIGNED_Format:Vb,RGB_BPTC_UNSIGNED_Format:jb,RGB_ETC1_Format:Nv,RGB_ETC2_Format:Fv,RGB_PVRTC_2BPPV1_Format:Rb,RGB_PVRTC_4BPPV1_Format:Ov,RGB_S3TC_DXT1_Format:AA,RGDepthPacking:qq,RGFormat:Xf,RGIntegerFormat:DT,RawShaderMaterial:Yk,Ray:a0,Raycaster:QB,RectAreaLight:oG,RedFormat:gu,RedIntegerFormat:pE,ReinhardToneMapping:ak,RenderTarget:gB,RenderTarget3D:LX,RepeatWrapping:Cu,ReplaceStencilOp:Yq,ReverseSubtractEquation:H3,RingGeometry:WT,SIGNED_RED_GREEN_RGTC2_Format:Yb,SIGNED_RED_RGTC1_Format:qb,SRGBColorSpace:sa,SRGBTransfer:Ei,Scene:zT,ShaderChunk:Dn,ShaderLib:Do,ShaderMaterial:Ra,ShadowMaterial:Kk,Shape:id,ShapeGeometry:$T,ShapePath:yh,ShapeUtils:Al,ShortType:aB,Skeleton:o0,SkeletonHelper:qX,SkinnedMesh:AE,Source:Wf,Sphere:Sr,SphereGeometry:_E,Spherical:GX,SphericalHarmonics3:lG,SplineCurve:wB,SpotLight:iC,SpotLightHelper:jX,Sprite:Ok,SpriteMaterial:yB,SrcAlphaFactor:xb,SrcAlphaSaturateFactor:J3,SrcColorFactor:q3,StaticCopyUsage:fK,StaticDrawUsage:zv,StaticReadUsage:cK,StereoCamera:mX,StreamCopyUsage:pK,StreamDrawUsage:lK,StreamReadUsage:hK,StringKeyframeTrack:Em,SubtractEquation:G3,SubtractiveBlending:Sw,TOUCH:Uq,TangentSpaceNormalMap:yd,TetrahedronGeometry:JT,Texture:Hi,TextureLoader:bE,TextureUtils:uW,Timer:UX,TimestampQuery:gK,TorusGeometry:ZT,TorusKnotGeometry:eC,Triangle:to,TriangleFanDrawMode:Xb,TriangleStripDrawMode:fB,TrianglesDrawMode:mk,TubeGeometry:tC,UVMapping:IT,Uint16BufferAttribute:FT,Uint32BufferAttribute:AB,Uint8BufferAttribute:ZK,Uint8ClampedBufferAttribute:eY,Uniform:zB,UniformsGroup:PX,UniformsLib:Ot,UniformsUtils:UT,UnsignedByteType:ds,UnsignedInt248Type:NA,UnsignedInt5999Type:oB,UnsignedIntType:Rh,UnsignedShort4444Type:RT,UnsignedShort5551Type:BT,UnsignedShortType:PA,VSMShadowMap:lc,Vector2:We,Vector3:de,Vector4:Tn,VectorKeyframeTrack:pd,VideoFrameTexture:SY,VideoTexture:xB,WebGL3DRenderTarget:HK,WebGLArrayRenderTarget:GK,WebGLCoordinateSystem:Po,WebGLCubeRenderTarget:Dk,WebGLRenderTarget:_l,WebGLRenderer:qB,WebGLUtils:TG,WebGPUCoordinateSystem:zA,WebXRController:YS,WireframeGeometry:qk,WrapAroundEnding:Gv,ZeroCurvatureEnding:jp,ZeroFactor:V3,ZeroSlopeEnding:qp,ZeroStencilOp:Kq,createCanvasElement:Ik},Symbol.toStringTag,{value:"Module"}));var wI={exports:{}},RI={},BI={exports:{}},DI={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SP;function jZ(){if(SP)return DI;SP=1;var s=t0();function e(f,p){return f===p&&(f!==0||1/f===1/p)||f!==f&&p!==p}var t=typeof Object.is=="function"?Object.is:e,n=s.useState,i=s.useEffect,r=s.useLayoutEffect,a=s.useDebugValue;function o(f,p){var g=p(),y=n({inst:{value:g,getSnapshot:p}}),x=y[0].inst,E=y[1];return r(function(){x.value=g,x.getSnapshot=p,l(x)&&E({inst:x})},[f,g,p]),i(function(){return l(x)&&E({inst:x}),f(function(){l(x)&&E({inst:x})})},[f]),a(g),g}function l(f){var p=f.getSnapshot;f=f.value;try{var g=p();return!t(f,g)}catch{return!0}}function c(f,p){return p()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:o;return DI.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:h,DI}var bP;function qZ(){return bP||(bP=1,BI.exports=jZ()),BI.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TP;function KZ(){if(TP)return RI;TP=1;var s=t0(),e=qZ();function t(c,h){return c===h&&(c!==0||1/c===1/h)||c!==c&&h!==h}var n=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,r=s.useRef,a=s.useEffect,o=s.useMemo,l=s.useDebugValue;return RI.useSyncExternalStoreWithSelector=function(c,h,f,p,g){var y=r(null);if(y.current===null){var x={hasValue:!1,value:null};y.current=x}else x=y.current;y=o(function(){function _(R){if(!b){if(b=!0,C=R,R=p(R),g!==void 0&&x.hasValue){var D=x.value;if(g(D,R))return I=D}return I=R}if(D=I,n(C,R))return D;var P=p(R);return g!==void 0&&g(D,P)?(C=R,D):(C=R,I=P)}var b=!1,C,I,M=f===void 0?null:f;return[function(){return _(h())},M===null?void 0:function(){return _(M())}]},[h,f,p,g]);var E=i(c,y[0],y[1]);return a(function(){x.hasValue=!0,x.value=E},[E]),l(E),E},RI}var CP;function YZ(){return CP||(CP=1,wI.exports=KZ()),wI.exports}var XZ=YZ();const WZ=IR(XZ),IP=s=>{let e;const t=new Set,n=(c,h)=>{const f=typeof c=="function"?c(e):c;if(!Object.is(f,e)){const p=e;e=h??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(g=>g(e,p))}},i=()=>e,o={setState:n,getState:i,getInitialState:()=>l,subscribe:c=>(t.add(c),()=>t.delete(c))},l=e=s(n,i,o);return o},IG=(s=>s?IP(s):IP),{useSyncExternalStoreWithSelector:$Z}=WZ,JZ=s=>s;function ZZ(s,e=JZ,t){const n=$Z(s.subscribe,s.getState,s.getInitialState,e,t);return sA.useDebugValue(n),n}const MP=(s,e)=>{const t=IG(s),n=(i,r=e)=>ZZ(t,i,r);return Object.assign(n,t),n},eee=((s,e)=>s?MP(s,e):MP),tee=s=>typeof s=="object"&&typeof s.then=="function",Xp=[];function MG(s,e,t=(n,i)=>n===i){if(s===e)return!0;if(!s||!e)return!1;const n=s.length;if(e.length!==n)return!1;for(let i=0;i<n;i++)if(!t(s[i],e[i]))return!1;return!0}function wG(s,e=null,t=!1,n={}){e===null&&(e=[s]);for(const r of Xp)if(MG(e,r.keys,r.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(r,"error"))throw r.error;if(Object.prototype.hasOwnProperty.call(r,"response"))return n.lifespan&&n.lifespan>0&&(r.timeout&&clearTimeout(r.timeout),r.timeout=setTimeout(r.remove,n.lifespan)),r.response;if(!t)throw r.promise}const i={keys:e,equal:n.equal,remove:()=>{const r=Xp.indexOf(i);r!==-1&&Xp.splice(r,1)},promise:(tee(s)?s:s(...e)).then(r=>{i.response=r,n.lifespan&&n.lifespan>0&&(i.timeout=setTimeout(i.remove,n.lifespan))}).catch(r=>i.error=r)};if(Xp.push(i),!t)throw i.promise}const nee=(s,e,t)=>wG(s,e,!1,t),iee=(s,e,t)=>void wG(s,e,!0,t),see=s=>{if(s===void 0||s.length===0)Xp.splice(0,Xp.length);else{const e=Xp.find(t=>MG(s,t.keys,t.equal));e&&e.remove()}};var LI={exports:{}},OI={exports:{}},PI={exports:{}},NI={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wP;function ree(){return wP||(wP=1,(function(s){function e(k,W){var V=k.length;k.push(W);e:for(;0<V;){var X=V-1>>>1,K=k[X];if(0<i(K,W))k[X]=W,k[V]=K,V=X;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var W=k[0],V=k.pop();if(V!==W){k[0]=V;e:for(var X=0,K=k.length,te=K>>>1;X<te;){var oe=2*(X+1)-1,Ee=k[oe],Ce=oe+1,se=k[Ce];if(0>i(Ee,V))Ce<K&&0>i(se,Ee)?(k[X]=se,k[Ce]=V,X=Ce):(k[X]=Ee,k[oe]=V,X=oe);else if(Ce<K&&0>i(se,V))k[X]=se,k[Ce]=V,X=Ce;else break e}}return W}function i(k,W){var V=k.sortIndex-W.sortIndex;return V!==0?V:k.id-W.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;s.unstable_now=function(){return r.now()}}else{var a=Date,o=a.now();s.unstable_now=function(){return a.now()-o}}var l=[],c=[],h=1,f=null,p=3,g=!1,y=!1,x=!1,E=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function C(k){for(var W=t(c);W!==null;){if(W.callback===null)n(c);else if(W.startTime<=k)n(c),W.sortIndex=W.expirationTime,e(l,W);else break;W=t(c)}}function I(k){if(x=!1,C(k),!y)if(t(l)!==null)y=!0,z();else{var W=t(c);W!==null&&q(I,W.startTime-k)}}var M=!1,R=-1,D=5,P=-1;function L(){return!(s.unstable_now()-P<D)}function O(){if(M){var k=s.unstable_now();P=k;var W=!0;try{e:{y=!1,x&&(x=!1,_(R),R=-1),g=!0;var V=p;try{t:{for(C(k),f=t(l);f!==null&&!(f.expirationTime>k&&L());){var X=f.callback;if(typeof X=="function"){f.callback=null,p=f.priorityLevel;var K=X(f.expirationTime<=k);if(k=s.unstable_now(),typeof K=="function"){f.callback=K,C(k),W=!0;break t}f===t(l)&&n(l),C(k)}else n(l);f=t(l)}if(f!==null)W=!0;else{var te=t(c);te!==null&&q(I,te.startTime-k),W=!1}}break e}finally{f=null,p=V,g=!1}W=void 0}}finally{W?U():M=!1}}}var U;if(typeof b=="function")U=function(){b(O)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,H=j.port2;j.port1.onmessage=O,U=function(){H.postMessage(null)}}else U=function(){E(O,0)};function z(){M||(M=!0,U())}function q(k,W){R=E(function(){k(s.unstable_now())},W)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(k){k.callback=null},s.unstable_continueExecution=function(){y||g||(y=!0,z())},s.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<k?Math.floor(1e3/k):5},s.unstable_getCurrentPriorityLevel=function(){return p},s.unstable_getFirstCallbackNode=function(){return t(l)},s.unstable_next=function(k){switch(p){case 1:case 2:case 3:var W=3;break;default:W=p}var V=p;p=W;try{return k()}finally{p=V}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(k,W){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var V=p;p=k;try{return W()}finally{p=V}},s.unstable_scheduleCallback=function(k,W,V){var X=s.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?X+V:X):V=X,k){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=V+K,k={id:h++,callback:W,priorityLevel:k,startTime:V,expirationTime:K,sortIndex:-1},V>X?(k.sortIndex=V,e(c,k),t(l)===null&&k===t(c)&&(x?(_(R),R=-1):x=!0,q(I,V-X))):(k.sortIndex=K,e(l,k),y||g||(y=!0,z())),k},s.unstable_shouldYield=L,s.unstable_wrapCallback=function(k){var W=p;return function(){var V=p;p=W;try{return k.apply(this,arguments)}finally{p=V}}}})(NI)),NI}var RP;function aee(){return RP||(RP=1,PI.exports=ree()),PI.exports}/**
 * @license React
 * react-reconciler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BP;function oee(){return BP||(BP=1,(function(s){s.exports=function(e){function t(m,A,T,B){return new z0(m,A,T,B)}function n(){}function i(m){var A="https://react.dev/errors/"+m;if(1<arguments.length){A+="?args[]="+encodeURIComponent(arguments[1]);for(var T=2;T<arguments.length;T++)A+="&args[]="+encodeURIComponent(arguments[T])}return"Minified React error #"+m+"; visit "+A+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(m){return m===null||typeof m!="object"?null:(m=kl&&m[kl]||m["@@iterator"],typeof m=="function"?m:null)}function a(m){if(m==null)return null;if(typeof m=="function")return m.$$typeof===q0?null:m.displayName||m.name||null;if(typeof m=="string")return m;switch(m){case Rc:return"Fragment";case Oa:return"Portal";case qm:return"Profiler";case Jd:return"StrictMode";case Km:return"Suspense";case sf:return"SuspenseList"}if(typeof m=="object")switch(m.$$typeof){case go:return(m.displayName||"Context")+".Provider";case V0:return(m._context.displayName||"Context")+".Consumer";case ep:var A=m.render;return m=m.displayName,m||(m=A.displayName||A.name||"",m=m!==""?"ForwardRef("+m+")":"ForwardRef"),m;case Ym:return A=m.displayName||null,A!==null?A:a(m.type)||"Memo";case Pa:A=m._payload,m=m._init;try{return a(m(A))}catch{}}return null}function o(m){if(Yo===void 0)try{throw Error()}catch(T){var A=T.stack.trim().match(/\n( *(at )?)/);Yo=A&&A[1]||"",Gl=-1<T.stack.indexOf(`
    at`)?" (<anonymous>)":-1<T.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Yo+m+Gl}function l(m,A){if(!m||Fu)return"";Fu=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var B={DetermineComponentFrameRoot:function(){try{if(A){var Lt=function(){throw Error()};if(Object.defineProperty(Lt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Lt,[])}catch(En){var kt=En}Reflect.construct(m,[],Lt)}else{try{Lt.call()}catch(En){kt=En}m.call(Lt.prototype)}}else{try{throw Error()}catch(En){kt=En}(Lt=m())&&typeof Lt.catch=="function"&&Lt.catch(function(){})}}catch(En){if(En&&kt&&typeof En.stack=="string")return[En.stack,kt.stack]}return[null,null]}};B.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var F=Object.getOwnPropertyDescriptor(B.DetermineComponentFrameRoot,"name");F&&F.configurable&&Object.defineProperty(B.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var Q=B.DetermineComponentFrameRoot(),he=Q[0],Ie=Q[1];if(he&&Ie){var Fe=he.split(`
`),lt=Ie.split(`
`);for(F=B=0;B<Fe.length&&!Fe[B].includes("DetermineComponentFrameRoot");)B++;for(;F<lt.length&&!lt[F].includes("DetermineComponentFrameRoot");)F++;if(B===Fe.length||F===lt.length)for(B=Fe.length-1,F=lt.length-1;1<=B&&0<=F&&Fe[B]!==lt[F];)F--;for(;1<=B&&0<=F;B--,F--)if(Fe[B]!==lt[F]){if(B!==1||F!==1)do if(B--,F--,0>F||Fe[B]!==lt[F]){var Ct=`
`+Fe[B].replace(" at new "," at ");return m.displayName&&Ct.includes("<anonymous>")&&(Ct=Ct.replace("<anonymous>",m.displayName)),Ct}while(1<=B&&0<=F);break}}}finally{Fu=!1,Error.prepareStackTrace=T}return(T=m?m.displayName||m.name:"")?o(T):""}function c(m){switch(m.tag){case 26:case 27:case 5:return o(m.type);case 16:return o("Lazy");case 13:return o("Suspense");case 19:return o("SuspenseList");case 0:case 15:return m=l(m.type,!1),m;case 11:return m=l(m.type.render,!1),m;case 1:return m=l(m.type,!0),m;default:return""}}function h(m){try{var A="";do A+=c(m),m=m.return;while(m);return A}catch(T){return`
Error generating stack: `+T.message+`
`+T.stack}}function f(m){var A=m,T=m;if(m.alternate)for(;A.return;)A=A.return;else{m=A;do A=m,(A.flags&4098)!==0&&(T=A.return),m=A.return;while(m)}return A.tag===3?T:null}function p(m){if(f(m)!==m)throw Error(i(188))}function g(m){var A=m.alternate;if(!A){if(A=f(m),A===null)throw Error(i(188));return A!==m?null:m}for(var T=m,B=A;;){var F=T.return;if(F===null)break;var Q=F.alternate;if(Q===null){if(B=F.return,B!==null){T=B;continue}break}if(F.child===Q.child){for(Q=F.child;Q;){if(Q===T)return p(F),m;if(Q===B)return p(F),A;Q=Q.sibling}throw Error(i(188))}if(T.return!==B.return)T=F,B=Q;else{for(var he=!1,Ie=F.child;Ie;){if(Ie===T){he=!0,T=F,B=Q;break}if(Ie===B){he=!0,B=F,T=Q;break}Ie=Ie.sibling}if(!he){for(Ie=Q.child;Ie;){if(Ie===T){he=!0,T=Q,B=F;break}if(Ie===B){he=!0,B=Q,T=F;break}Ie=Ie.sibling}if(!he)throw Error(i(189))}}if(T.alternate!==B)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?m:A}function y(m){var A=m.tag;if(A===5||A===26||A===27||A===6)return m;for(m=m.child;m!==null;){if(A=y(m),A!==null)return A;m=m.sibling}return null}function x(m){var A=m.tag;if(A===5||A===26||A===27||A===6)return m;for(m=m.child;m!==null;){if(m.tag!==4&&(A=x(m),A!==null))return A;m=m.sibling}return null}function E(m){return{current:m}}function _(m){0>Vl||(m.current=ls[Vl],ls[Vl]=null,Vl--)}function b(m,A){Vl++,ls[Vl]=m.current,m.current=A}function C(m){return m>>>=0,m===0?32:31-(Qx(m)/Vx|0)|0}function I(m){var A=m&42;if(A!==0)return A;switch(m&-m){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return m&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return m}}function M(m,A){var T=m.pendingLanes;if(T===0)return 0;var B=0,F=m.suspendedLanes,Q=m.pingedLanes,he=m.warmLanes;m=m.finishedLanes!==0;var Ie=T&134217727;return Ie!==0?(T=Ie&~F,T!==0?B=I(T):(Q&=Ie,Q!==0?B=I(Q):m||(he=Ie&~he,he!==0&&(B=I(he))))):(Ie=T&~F,Ie!==0?B=I(Ie):Q!==0?B=I(Q):m||(he=T&~he,he!==0&&(B=I(he)))),B===0?0:A!==0&&A!==B&&(A&F)===0&&(F=B&-B,he=A&-A,F>=he||F===32&&(he&4194176)!==0)?A:B}function R(m,A){return(m.pendingLanes&~(m.suspendedLanes&~m.pingedLanes)&A)===0}function D(m,A){switch(m){case 1:case 2:case 4:case 8:return A+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return A+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function P(){var m=Wo;return Wo<<=1,(Wo&4194176)===0&&(Wo=128),m}function L(){var m=Gu;return Gu<<=1,(Gu&62914560)===0&&(Gu=4194304),m}function O(m){for(var A=[],T=0;31>T;T++)A.push(m);return A}function U(m,A){m.pendingLanes|=A,A!==268435456&&(m.suspendedLanes=0,m.pingedLanes=0,m.warmLanes=0)}function j(m,A,T,B,F,Q){var he=m.pendingLanes;m.pendingLanes=T,m.suspendedLanes=0,m.pingedLanes=0,m.warmLanes=0,m.expiredLanes&=T,m.entangledLanes&=T,m.errorRecoveryDisabledLanes&=T,m.shellSuspendCounter=0;var Ie=m.entanglements,Fe=m.expirationTimes,lt=m.hiddenUpdates;for(T=he&~T;0<T;){var Ct=31-Dr(T),Lt=1<<Ct;Ie[Ct]=0,Fe[Ct]=-1;var kt=lt[Ct];if(kt!==null)for(lt[Ct]=null,Ct=0;Ct<kt.length;Ct++){var En=kt[Ct];En!==null&&(En.lane&=-536870913)}T&=~Lt}B!==0&&H(m,B,0),Q!==0&&F===0&&m.tag!==0&&(m.suspendedLanes|=Q&~(he&~A))}function H(m,A,T){m.pendingLanes|=A,m.suspendedLanes&=~A;var B=31-Dr(A);m.entangledLanes|=A,m.entanglements[B]=m.entanglements[B]|1073741824|T&4194218}function z(m,A){var T=m.entangledLanes|=A;for(m=m.entanglements;T;){var B=31-Dr(T),F=1<<B;F&A|m[B]&A&&(m[B]|=A),T&=~F}}function q(m){return m&=-m,2<m?8<m?(m&134217727)!==0?32:268435456:8:2}function k(m){if(Yr&&typeof Yr.onCommitFiberRoot=="function")try{Yr.onCommitFiberRoot(cs,m,void 0,(m.current.flags&128)===128)}catch{}}function W(m){if(typeof Kx=="function"&&Gs(m),Yr&&typeof Yr.setStrictMode=="function")try{Yr.setStrictMode(cs,m)}catch{}}function V(m,A){return m===A&&(m!==0||1/m===1/A)||m!==m&&A!==A}function X(m,A){if(typeof m=="object"&&m!==null){var T=hy.get(m);return T!==void 0?T:(A={value:m,source:A,stack:h(A)},hy.set(m,A),A)}return{value:m,source:A,stack:h(A)}}function K(m,A){Hu[zu++]=df,Hu[zu++]=Qu,Qu=m,df=A}function te(m,A,T){fa[da++]=vo,fa[da++]=Eo,fa[da++]=Fc,Fc=m;var B=vo;m=Eo;var F=32-Dr(B)-1;B&=~(1<<F),T+=1;var Q=32-Dr(A)+F;if(30<Q){var he=F-F%5;Q=(B&(1<<he)-1).toString(32),B>>=he,F-=he,vo=1<<32-Dr(A)+F|T<<F|B,Eo=Q+m}else vo=1<<Q|T<<F|B,Eo=m}function oe(m){m.return!==null&&(K(m,1),te(m,1,0))}function Ee(m){for(;m===Qu;)Qu=Hu[--zu],Hu[zu]=null,df=Hu[--zu],Hu[zu]=null;for(;m===Fc;)Fc=fa[--da],fa[da]=null,Eo=fa[--da],fa[da]=null,vo=fa[--da],fa[da]=null}function Ce(m,A){b($o,A),b(pf,m),b(Ms,null),m=lx(A),_(Ms),b(Ms,m)}function se(){_(Ms),_(pf),_($o)}function ie(m){m.memoizedState!==null&&b(Vu,m);var A=Ms.current,T=lf(A,m.type);A!==T&&(b(pf,m),b(Ms,T))}function ne(m){pf.current===m&&(_(Ms),_(pf)),Vu.current===m&&(_(Vu),Rr?Ao._currentValue=Dc:Ao._currentValue2=Dc)}function re(m){var A=Error(i(418,""));throw pe(X(A,m)),cp}function Be(m,A){if(!rr)throw Error(i(175));Lx(m.stateNode,m.type,m.memoizedProps,A,m)||re(m)}function Ge(m){for(ar=m.return;ar;)switch(ar.tag){case 3:case 27:Hs=!0;return;case 5:case 13:Hs=!1;return;default:ar=ar.return}}function Ue(m){if(!rr||m!==ar)return!1;if(!Xn)return Ge(m),Xn=!0,!1;var A=!1;if(gi?m.tag!==3&&m.tag!==27&&(m.tag!==5||ig(m.type)&&!Sn(m.type,m.memoizedProps))&&(A=!0):m.tag!==3&&(m.tag!==5||ig(m.type)&&!Sn(m.type,m.memoizedProps))&&(A=!0),A&&or&&re(m),Ge(m),m.tag===13){if(!rr)throw Error(i(316));if(m=m.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(i(317));or=Px(m)}else or=ar?oy(m.stateNode):null;return!0}function nt(){rr&&(or=ar=null,Xn=!1)}function pe(m){Ua===null?Ua=[m]:Ua.push(m)}function ve(){for(var m=ju,A=xo=ju=0;A<m;){var T=ka[A];ka[A++]=null;var B=ka[A];ka[A++]=null;var F=ka[A];ka[A++]=null;var Q=ka[A];if(ka[A++]=null,B!==null&&F!==null){var he=B.pending;he===null?F.next=F:(F.next=he.next,he.next=F),B.pending=F}Q!==0&&Re(T,F,Q)}}function Ae(m,A,T,B){ka[ju++]=m,ka[ju++]=A,ka[ju++]=T,ka[ju++]=B,xo|=B,m.lanes|=B,m=m.alternate,m!==null&&(m.lanes|=B)}function Se(m,A,T,B){return Ae(m,A,T,B),me(m)}function be(m,A){return Ae(m,null,null,A),me(m)}function Re(m,A,T){m.lanes|=T;var B=m.alternate;B!==null&&(B.lanes|=T);for(var F=!1,Q=m.return;Q!==null;)Q.childLanes|=T,B=Q.alternate,B!==null&&(B.childLanes|=T),Q.tag===22&&(m=Q.stateNode,m===null||m._visibility&1||(F=!0)),m=Q,Q=Q.return;F&&A!==null&&m.tag===3&&(Q=m.stateNode,F=31-Dr(T),Q=Q.hiddenUpdates,m=Q[F],m===null?Q[F]=[A]:m.push(A),A.lane=T|536870912)}function me(m){if(50<Sf)throw Sf=0,yg=null,Error(i(185));for(var A=m.return;A!==null;)m=A,A=m.return;return m.tag===3?m.stateNode:null}function ue(m){m!==jl&&m.next===null&&(jl===null?up=jl=m:jl=jl.next=m),Ii=!0,qu||(qu=!0,Ve(gt))}function $e(m,A){if(!fy&&Ii){fy=!0;do for(var T=!1,B=up;B!==null;){if(m!==0){var F=B.pendingLanes;if(F===0)var Q=0;else{var he=B.suspendedLanes,Ie=B.pingedLanes;Q=(1<<31-Dr(42|m)+1)-1,Q&=F&~(he&~Ie),Q=Q&201326677?Q&201326677|1:Q?Q|2:0}Q!==0&&(T=!0,Pe(B,Q))}else Q=kn,Q=M(B,B===ai?Q:0),(Q&3)===0||R(B,Q)||(T=!0,Pe(B,Q));B=B.next}while(T);fy=!1}}function gt(){Ii=qu=!1;var m=0;mf!==0&&(fx()&&(m=mf),mf=0);for(var A=Fa(),T=null,B=up;B!==null;){var F=B.next,Q=ge(B,A);Q===0?(B.next=null,T===null?up=F:T.next=F,F===null&&(jl=T)):(T=B,(m!==0||(Q&3)!==0)&&(Ii=!0)),B=F}$e(m)}function ge(m,A){for(var T=m.suspendedLanes,B=m.pingedLanes,F=m.expirationTimes,Q=m.pendingLanes&-62914561;0<Q;){var he=31-Dr(Q),Ie=1<<he,Fe=F[he];Fe===-1?((Ie&T)===0||(Ie&B)!==0)&&(F[he]=D(Ie,A)):Fe<=A&&(m.expiredLanes|=Ie),Q&=~Ie}if(A=ai,T=kn,T=M(m,m===A?T:0),B=m.callbackNode,T===0||m===A&&mi===2||m.cancelPendingCommit!==null)return B!==null&&B!==null&&og(B),m.callbackNode=null,m.callbackPriority=0;if((T&3)===0||R(m,T)){if(A=T&-T,A===m.callbackPriority)return A;switch(B!==null&&og(B),q(T)){case 2:case 8:T=qx;break;case 32:T=ug;break;case 268435456:T=PC;break;default:T=ug}return B=ae.bind(null,m),T=lp(T,B),m.callbackPriority=A,m.callbackNode=T,A}return B!==null&&B!==null&&og(B),m.callbackPriority=2,m.callbackNode=null,2}function ae(m,A){var T=m.callbackNode;if(mo()&&m.callbackNode!==T)return null;var B=kn;return B=M(m,m===ai?B:0),B===0?null:(Tc(m,B,A),ge(m,Fa()),m.callbackNode!=null&&m.callbackNode===T?ae.bind(null,m):null)}function Pe(m,A){if(mo())return null;Tc(m,A,!0)}function Ve(m){$0?Ql(function(){($n&6)!==0?lp(cg,m):m()}):lp(cg,m)}function rt(){return mf===0&&(mf=P()),mf}function et(m,A){if(gf===null){var T=gf=[];Ku=0,pa=rt(),Yu={status:"pending",value:void 0,then:function(B){T.push(B)}}}return Ku++,A.then(Mt,Mt),A}function Mt(){if(--Ku===0&&gf!==null){Yu!==null&&(Yu.status="fulfilled");var m=gf;gf=null,pa=0,Yu=null;for(var A=0;A<m.length;A++)(0,m[A])()}}function Et(m,A){var T=[],B={status:"pending",value:null,reason:null,then:function(F){T.push(F)}};return m.then(function(){B.status="fulfilled",B.value=A;for(var F=0;F<T.length;F++)(0,T[F])(A)},function(F){for(B.status="rejected",B.reason=F,F=0;F<T.length;F++)(0,T[F])(void 0)}),B}function Rt(m){m.updateQueue={baseState:m.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Gt(m,A){m=m.updateQueue,A.updateQueue===m&&(A.updateQueue={baseState:m.baseState,firstBaseUpdate:m.firstBaseUpdate,lastBaseUpdate:m.lastBaseUpdate,shared:m.shared,callbacks:null})}function pt(m){return{lane:m,tag:0,payload:null,callback:null,next:null}}function At(m,A,T){var B=m.updateQueue;if(B===null)return null;if(B=B.shared,($n&2)!==0){var F=B.pending;return F===null?A.next=A:(A.next=F.next,F.next=A),B.pending=A,A=me(m),Re(m,null,T),A}return Ae(m,B,A,T),me(m)}function Qt(m,A,T){if(A=A.updateQueue,A!==null&&(A=A.shared,(T&4194176)!==0)){var B=A.lanes;B&=m.pendingLanes,T|=B,A.lanes=T,z(m,T)}}function Ut(m,A){var T=m.updateQueue,B=m.alternate;if(B!==null&&(B=B.updateQueue,T===B)){var F=null,Q=null;if(T=T.firstBaseUpdate,T!==null){do{var he={lane:T.lane,tag:T.tag,payload:T.payload,callback:null,next:null};Q===null?F=Q=he:Q=Q.next=he,T=T.next}while(T!==null);Q===null?F=Q=A:Q=Q.next=A}else F=Q=A;T={baseState:B.baseState,firstBaseUpdate:F,lastBaseUpdate:Q,shared:B.shared,callbacks:B.callbacks},m.updateQueue=T;return}m=T.lastBaseUpdate,m===null?T.firstBaseUpdate=A:m.next=A,T.lastBaseUpdate=A}function vt(){if(Xu){var m=Yu;if(m!==null)throw m}}function Vt(m,A,T,B){Xu=!1;var F=m.updateQueue;ql=!1;var Q=F.firstBaseUpdate,he=F.lastBaseUpdate,Ie=F.shared.pending;if(Ie!==null){F.shared.pending=null;var Fe=Ie,lt=Fe.next;Fe.next=null,he===null?Q=lt:he.next=lt,he=Fe;var Ct=m.alternate;Ct!==null&&(Ct=Ct.updateQueue,Ie=Ct.lastBaseUpdate,Ie!==he&&(Ie===null?Ct.firstBaseUpdate=lt:Ie.next=lt,Ct.lastBaseUpdate=Fe))}if(Q!==null){var Lt=F.baseState;he=0,Ct=lt=Fe=null,Ie=Q;do{var kt=Ie.lane&-536870913,En=kt!==Ie.lane;if(En?(kn&kt)===kt:(B&kt)===kt){kt!==0&&kt===pa&&(Xu=!0),Ct!==null&&(Ct=Ct.next={lane:0,tag:Ie.tag,payload:Ie.payload,callback:null,next:null});e:{var _a=m,qc=Ie;kt=A;var Kc=T;switch(qc.tag){case 1:if(_a=qc.payload,typeof _a=="function"){Lt=_a.call(Kc,Lt,kt);break e}Lt=_a;break e;case 3:_a.flags=_a.flags&-65537|128;case 0:if(_a=qc.payload,kt=typeof _a=="function"?_a.call(Kc,Lt,kt):_a,kt==null)break e;Lt=jm({},Lt,kt);break e;case 2:ql=!0}}kt=Ie.callback,kt!==null&&(m.flags|=64,En&&(m.flags|=8192),En=F.callbacks,En===null?F.callbacks=[kt]:En.push(kt))}else En={lane:kt,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},Ct===null?(lt=Ct=En,Fe=Lt):Ct=Ct.next=En,he|=kt;if(Ie=Ie.next,Ie===null){if(Ie=F.shared.pending,Ie===null)break;En=Ie,Ie=En.next,En.next=null,F.lastBaseUpdate=En,F.shared.pending=null}}while(!0);Ct===null&&(Fe=Lt),F.baseState=Fe,F.firstBaseUpdate=lt,F.lastBaseUpdate=Ct,Q===null&&(F.shared.lanes=0),Ea|=he,m.lanes=he,m.memoizedState=Lt}}function Oe(m,A){if(typeof m!="function")throw Error(i(191,m));m.call(A)}function Qe(m,A){var T=m.callbacks;if(T!==null)for(m.callbacks=null,m=0;m<T.length;m++)Oe(T[m],A)}function St(m,A){if(Xr(m,A))return!0;if(typeof m!="object"||m===null||typeof A!="object"||A===null)return!1;var T=Object.keys(m),B=Object.keys(A);if(T.length!==B.length)return!1;for(B=0;B<T.length;B++){var F=T[B];if(!Jo.call(A,F)||!Xr(m[F],A[F]))return!1}return!0}function Nt(m){return m=m.status,m==="fulfilled"||m==="rejected"}function yt(){}function dt(m,A,T){switch(T=m[T],T===void 0?m.push(A):T!==A&&(A.then(yt,yt),A=T),A.status){case"fulfilled":return A.value;case"rejected":throw m=A.reason,m===Af?Error(i(483)):m;default:if(typeof A.status=="string")A.then(yt,yt);else{if(m=ai,m!==null&&100<m.shellSuspendCounter)throw Error(i(482));m=A,m.status="pending",m.then(function(B){if(A.status==="pending"){var F=A;F.status="fulfilled",F.value=B}},function(B){if(A.status==="pending"){var F=A;F.status="rejected",F.reason=B}})}switch(A.status){case"fulfilled":return A.value;case"rejected":throw m=A.reason,m===Af?Error(i(483)):m}throw Uc=A,Af}}function zt(){if(Uc===null)throw Error(i(459));var m=Uc;return Uc=null,m}function tn(m){var A=Gc;return Gc+=1,kc===null&&(kc=[]),dt(kc,m,A)}function Un(m,A){A=A.props.ref,m.ref=A!==void 0?A:null}function Ln(m,A){throw A.$$typeof===MC?Error(i(525)):(m=Object.prototype.toString.call(A),Error(i(31,m==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":m)))}function Hr(m){var A=m._init;return A(m._payload)}function $i(m){function A(Ke,De){if(m){var Ze=Ke.deletions;Ze===null?(Ke.deletions=[De],Ke.flags|=16):Ze.push(De)}}function T(Ke,De){if(!m)return null;for(;De!==null;)A(Ke,De),De=De.sibling;return null}function B(Ke){for(var De=new Map;Ke!==null;)Ke.key!==null?De.set(Ke.key,Ke):De.set(Ke.index,Ke),Ke=Ke.sibling;return De}function F(Ke,De){return Ke=La(Ke,De),Ke.index=0,Ke.sibling=null,Ke}function Q(Ke,De,Ze){return Ke.index=Ze,m?(Ze=Ke.alternate,Ze!==null?(Ze=Ze.index,Ze<De?(Ke.flags|=33554434,De):Ze):(Ke.flags|=33554434,De)):(Ke.flags|=1048576,De)}function he(Ke){return m&&Ke.alternate===null&&(Ke.flags|=33554434),Ke}function Ie(Ke,De,Ze,bt){return De===null||De.tag!==6?(De=Qm(Ze,Ke.mode,bt),De.return=Ke,De):(De=F(De,Ze),De.return=Ke,De)}function Fe(Ke,De,Ze,bt){var Jt=Ze.type;return Jt===Rc?Ct(Ke,De,Ze.props.children,bt,Ze.key):De!==null&&(De.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===Pa&&Hr(Jt)===De.type)?(De=F(De,Ze.props),Un(De,Ze),De.return=Ke,De):(De=Ko(Ze.type,Ze.key,Ze.props,null,Ke.mode,bt),Un(De,Ze),De.return=Ke,De)}function lt(Ke,De,Ze,bt){return De===null||De.tag!==4||De.stateNode.containerInfo!==Ze.containerInfo||De.stateNode.implementation!==Ze.implementation?(De=Q0(Ze,Ke.mode,bt),De.return=Ke,De):(De=F(De,Ze.children||[]),De.return=Ke,De)}function Ct(Ke,De,Ze,bt,Jt){return De===null||De.tag!==7?(De=Zi(Ze,Ke.mode,bt,Jt),De.return=Ke,De):(De=F(De,Ze),De.return=Ke,De)}function Lt(Ke,De,Ze){if(typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint")return De=Qm(""+De,Ke.mode,Ze),De.return=Ke,De;if(typeof De=="object"&&De!==null){switch(De.$$typeof){case $d:return Ze=Ko(De.type,De.key,De.props,null,Ke.mode,Ze),Un(Ze,De),Ze.return=Ke,Ze;case Oa:return De=Q0(De,Ke.mode,Ze),De.return=Ke,De;case Pa:var bt=De._init;return De=bt(De._payload),Lt(Ke,De,Ze)}if(rf(De)||r(De))return De=Zi(De,Ke.mode,Ze,null),De.return=Ke,De;if(typeof De.then=="function")return Lt(Ke,tn(De),Ze);if(De.$$typeof===go)return Lt(Ke,Nd(Ke,De),Ze);Ln(Ke,De)}return null}function kt(Ke,De,Ze,bt){var Jt=De!==null?De.key:null;if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number"||typeof Ze=="bigint")return Jt!==null?null:Ie(Ke,De,""+Ze,bt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case $d:return Ze.key===Jt?Fe(Ke,De,Ze,bt):null;case Oa:return Ze.key===Jt?lt(Ke,De,Ze,bt):null;case Pa:return Jt=Ze._init,Ze=Jt(Ze._payload),kt(Ke,De,Ze,bt)}if(rf(Ze)||r(Ze))return Jt!==null?null:Ct(Ke,De,Ze,bt,null);if(typeof Ze.then=="function")return kt(Ke,De,tn(Ze),bt);if(Ze.$$typeof===go)return kt(Ke,De,Nd(Ke,Ze),bt);Ln(Ke,Ze)}return null}function En(Ke,De,Ze,bt,Jt){if(typeof bt=="string"&&bt!==""||typeof bt=="number"||typeof bt=="bigint")return Ke=Ke.get(Ze)||null,Ie(De,Ke,""+bt,Jt);if(typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case $d:return Ke=Ke.get(bt.key===null?Ze:bt.key)||null,Fe(De,Ke,bt,Jt);case Oa:return Ke=Ke.get(bt.key===null?Ze:bt.key)||null,lt(De,Ke,bt,Jt);case Pa:var Ni=bt._init;return bt=Ni(bt._payload),En(Ke,De,Ze,bt,Jt)}if(rf(bt)||r(bt))return Ke=Ke.get(Ze)||null,Ct(De,Ke,bt,Jt,null);if(typeof bt.then=="function")return En(Ke,De,Ze,tn(bt),Jt);if(bt.$$typeof===go)return En(Ke,De,Ze,Nd(De,bt),Jt);Ln(De,bt)}return null}function _a(Ke,De,Ze,bt){for(var Jt=null,Ni=null,dn=De,ni=De=0,us=null;dn!==null&&ni<Ze.length;ni++){dn.index>ni?(us=dn,dn=null):us=dn.sibling;var Nn=kt(Ke,dn,Ze[ni],bt);if(Nn===null){dn===null&&(dn=us);break}m&&dn&&Nn.alternate===null&&A(Ke,dn),De=Q(Nn,De,ni),Ni===null?Jt=Nn:Ni.sibling=Nn,Ni=Nn,dn=us}if(ni===Ze.length)return T(Ke,dn),Xn&&K(Ke,ni),Jt;if(dn===null){for(;ni<Ze.length;ni++)dn=Lt(Ke,Ze[ni],bt),dn!==null&&(De=Q(dn,De,ni),Ni===null?Jt=dn:Ni.sibling=dn,Ni=dn);return Xn&&K(Ke,ni),Jt}for(dn=B(dn);ni<Ze.length;ni++)us=En(dn,Ke,ni,Ze[ni],bt),us!==null&&(m&&us.alternate!==null&&dn.delete(us.key===null?ni:us.key),De=Q(us,De,ni),Ni===null?Jt=us:Ni.sibling=us,Ni=us);return m&&dn.forEach(function(al){return A(Ke,al)}),Xn&&K(Ke,ni),Jt}function qc(Ke,De,Ze,bt){if(Ze==null)throw Error(i(151));for(var Jt=null,Ni=null,dn=De,ni=De=0,us=null,Nn=Ze.next();dn!==null&&!Nn.done;ni++,Nn=Ze.next()){dn.index>ni?(us=dn,dn=null):us=dn.sibling;var al=kt(Ke,dn,Nn.value,bt);if(al===null){dn===null&&(dn=us);break}m&&dn&&al.alternate===null&&A(Ke,dn),De=Q(al,De,ni),Ni===null?Jt=al:Ni.sibling=al,Ni=al,dn=us}if(Nn.done)return T(Ke,dn),Xn&&K(Ke,ni),Jt;if(dn===null){for(;!Nn.done;ni++,Nn=Ze.next())Nn=Lt(Ke,Nn.value,bt),Nn!==null&&(De=Q(Nn,De,ni),Ni===null?Jt=Nn:Ni.sibling=Nn,Ni=Nn);return Xn&&K(Ke,ni),Jt}for(dn=B(dn);!Nn.done;ni++,Nn=Ze.next())Nn=En(dn,Ke,ni,Nn.value,bt),Nn!==null&&(m&&Nn.alternate!==null&&dn.delete(Nn.key===null?ni:Nn.key),De=Q(Nn,De,ni),Ni===null?Jt=Nn:Ni.sibling=Nn,Ni=Nn);return m&&dn.forEach(function(vg){return A(Ke,vg)}),Xn&&K(Ke,ni),Jt}function Kc(Ke,De,Ze,bt){if(typeof Ze=="object"&&Ze!==null&&Ze.type===Rc&&Ze.key===null&&(Ze=Ze.props.children),typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case $d:e:{for(var Jt=Ze.key;De!==null;){if(De.key===Jt){if(Jt=Ze.type,Jt===Rc){if(De.tag===7){T(Ke,De.sibling),bt=F(De,Ze.props.children),bt.return=Ke,Ke=bt;break e}}else if(De.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===Pa&&Hr(Jt)===De.type){T(Ke,De.sibling),bt=F(De,Ze.props),Un(bt,Ze),bt.return=Ke,Ke=bt;break e}T(Ke,De);break}else A(Ke,De);De=De.sibling}Ze.type===Rc?(bt=Zi(Ze.props.children,Ke.mode,bt,Ze.key),bt.return=Ke,Ke=bt):(bt=Ko(Ze.type,Ze.key,Ze.props,null,Ke.mode,bt),Un(bt,Ze),bt.return=Ke,Ke=bt)}return he(Ke);case Oa:e:{for(Jt=Ze.key;De!==null;){if(De.key===Jt)if(De.tag===4&&De.stateNode.containerInfo===Ze.containerInfo&&De.stateNode.implementation===Ze.implementation){T(Ke,De.sibling),bt=F(De,Ze.children||[]),bt.return=Ke,Ke=bt;break e}else{T(Ke,De);break}else A(Ke,De);De=De.sibling}bt=Q0(Ze,Ke.mode,bt),bt.return=Ke,Ke=bt}return he(Ke);case Pa:return Jt=Ze._init,Ze=Jt(Ze._payload),Kc(Ke,De,Ze,bt)}if(rf(Ze))return _a(Ke,De,Ze,bt);if(r(Ze)){if(Jt=r(Ze),typeof Jt!="function")throw Error(i(150));return Ze=Jt.call(Ze),qc(Ke,De,Ze,bt)}if(typeof Ze.then=="function")return Kc(Ke,De,tn(Ze),bt);if(Ze.$$typeof===go)return Kc(Ke,De,Nd(Ke,Ze),bt);Ln(Ke,Ze)}return typeof Ze=="string"&&Ze!==""||typeof Ze=="number"||typeof Ze=="bigint"?(Ze=""+Ze,De!==null&&De.tag===6?(T(Ke,De.sibling),bt=F(De,Ze),bt.return=Ke,Ke=bt):(T(Ke,De),bt=Qm(Ze,Ke.mode,bt),bt.return=Ke,Ke=bt),he(Ke)):T(Ke,De)}return function(Ke,De,Ze,bt){try{Gc=0;var Jt=Kc(Ke,De,Ze,bt);return kc=null,Jt}catch(dn){if(dn===Af)throw dn;var Ni=t(29,dn,null,Ke.mode);return Ni.lanes=bt,Ni.return=Ke,Ni}finally{}}}function Ji(m,A){m=vr,b(yf,m),b(Mi,A),vr=m|A.baseLanes}function Ti(){b(yf,vr),b(Mi,Mi.current)}function Zs(){vr=yf.current,_(Mi),_(yf)}function Cr(m){var A=m.alternate;b(ws,ws.current&1),b(ma,m),Ai===null&&(A===null||Mi.current!==null||A.memoizedState!==null)&&(Ai=m)}function fo(m){if(m.tag===22){if(b(ws,ws.current),b(ma,m),Ai===null){var A=m.alternate;A!==null&&A.memoizedState!==null&&(Ai=m)}}else Ts()}function Ts(){b(ws,ws.current),b(ma,ma.current)}function an(m){_(ma),Ai===m&&(Ai=null),_(ws)}function mr(m){for(var A=m;A!==null;){if(A.tag===13){var T=A.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||eg(T)||tg(T)))return A}else if(A.tag===19&&A.memoizedProps.revealOrder!==void 0){if((A.flags&128)!==0)return A}else if(A.child!==null){A.child.return=A,A=A.child;continue}if(A===m)break;for(;A.sibling===null;){if(A.return===null||A.return===m)return null;A=A.return}A.sibling.return=A.return,A=A.sibling}return null}function pi(){throw Error(i(321))}function Z(m,A){if(A===null)return!1;for(var T=0;T<A.length&&T<m.length;T++)if(!Xr(m[T],A[T]))return!1;return!0}function fe(m,A,T,B,F,Q){return Kl=Q,Mn=A,A.memoizedState=null,A.updateQueue=null,A.lanes=0,fn.H=m===null||m.memoizedState===null?Qc:Lr,zc=!1,Q=T(B,F),zc=!1,Wu&&(Q=qe(A,T,B,F)),we(m),Q}function we(m){fn.H=es;var A=sn!==null&&sn.next!==null;if(Kl=0,Wn=sn=Mn=null,Ga=!1,$u=0,zs=null,A)throw Error(i(300));m===null||yi||(m=m.dependencies,m!==null&&Pd(m)&&(yi=!0))}function qe(m,A,T,B){Mn=m;var F=0;do{if(Wu&&(zs=null),$u=0,Wu=!1,25<=F)throw Error(i(301));if(F+=1,Wn=sn=null,m.updateQueue!=null){var Q=m.updateQueue;Q.lastEffect=null,Q.events=null,Q.stores=null,Q.memoCache!=null&&(Q.memoCache.index=0)}fn.H=ga,Q=A(T,B)}while(Wu);return Q}function Ye(){var m=fn.H,A=m.useState()[0];return A=typeof A.then=="function"?Me(A):A,m=m.useState()[0],(sn!==null?sn.memoizedState:null)!==m&&(Mn.flags|=1024),A}function it(){var m=hg!==0;return hg=0,m}function xt(m,A,T){A.updateQueue=m.updateQueue,A.flags&=-2053,m.lanes&=~T}function J(m){if(Ga){for(m=m.memoizedState;m!==null;){var A=m.queue;A!==null&&(A.pending=null),m=m.next}Ga=!1}Kl=0,Wn=sn=Mn=null,Wu=!1,$u=hg=0,zs=null}function ye(){var m={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wn===null?Mn.memoizedState=Wn=m:Wn=Wn.next=m,Wn}function _e(){if(sn===null){var m=Mn.alternate;m=m!==null?m.memoizedState:null}else m=sn.next;var A=Wn===null?Mn.memoizedState:Wn.next;if(A!==null)Wn=A,sn=m;else{if(m===null)throw Mn.alternate===null?Error(i(467)):Error(i(310));sn=m,m={memoizedState:sn.memoizedState,baseState:sn.baseState,baseQueue:sn.baseQueue,queue:sn.queue,next:null},Wn===null?Mn.memoizedState=Wn=m:Wn=Wn.next=m}return Wn}function Me(m){var A=$u;return $u+=1,zs===null&&(zs=[]),m=dt(zs,m,A),A=Mn,(Wn===null?A.memoizedState:Wn.next)===null&&(A=A.alternate,fn.H=A===null||A.memoizedState===null?Qc:Lr),m}function xe(m){if(m!==null&&typeof m=="object"){if(typeof m.then=="function")return Me(m);if(m.$$typeof===go)return tr(m)}throw Error(i(438,String(m)))}function ht(m){var A=null,T=Mn.updateQueue;if(T!==null&&(A=T.memoCache),A==null){var B=Mn.alternate;B!==null&&(B=B.updateQueue,B!==null&&(B=B.memoCache,B!=null&&(A={data:B.data.map(function(F){return F.slice()}),index:0})))}if(A==null&&(A={data:[],index:0}),T===null&&(T=fg(),Mn.updateQueue=T),T.memoCache=A,T=A.data[A.index],T===void 0)for(T=A.data[A.index]=Array(m),B=0;B<m;B++)T[B]=ox;return A.index++,T}function tt(m,A){return typeof A=="function"?A(m):A}function at(m){var A=_e();return ot(A,sn,m)}function ot(m,A,T){var B=m.queue;if(B===null)throw Error(i(311));B.lastRenderedReducer=T;var F=m.baseQueue,Q=B.pending;if(Q!==null){if(F!==null){var he=F.next;F.next=Q.next,Q.next=he}A.baseQueue=F=Q,B.pending=null}if(Q=m.baseState,F===null)m.memoizedState=Q;else{A=F.next;var Ie=he=null,Fe=null,lt=A,Ct=!1;do{var Lt=lt.lane&-536870913;if(Lt!==lt.lane?(kn&Lt)===Lt:(Kl&Lt)===Lt){var kt=lt.revertLane;if(kt===0)Fe!==null&&(Fe=Fe.next={lane:0,revertLane:0,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null}),Lt===pa&&(Ct=!0);else if((Kl&kt)===kt){lt=lt.next,kt===pa&&(Ct=!0);continue}else Lt={lane:0,revertLane:lt.revertLane,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null},Fe===null?(Ie=Fe=Lt,he=Q):Fe=Fe.next=Lt,Mn.lanes|=kt,Ea|=kt;Lt=lt.action,zc&&T(Q,Lt),Q=lt.hasEagerState?lt.eagerState:T(Q,Lt)}else kt={lane:Lt,revertLane:lt.revertLane,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null},Fe===null?(Ie=Fe=kt,he=Q):Fe=Fe.next=kt,Mn.lanes|=Lt,Ea|=Lt;lt=lt.next}while(lt!==null&&lt!==A);if(Fe===null?he=Q:Fe.next=Ie,!Xr(Q,m.memoizedState)&&(yi=!0,Ct&&(T=Yu,T!==null)))throw T;m.memoizedState=Q,m.baseState=he,m.baseQueue=Fe,B.lastRenderedState=Q}return F===null&&(B.lanes=0),[m.memoizedState,B.dispatch]}function _t(m){var A=_e(),T=A.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=m;var B=T.dispatch,F=T.pending,Q=A.memoizedState;if(F!==null){T.pending=null;var he=F=F.next;do Q=m(Q,he.action),he=he.next;while(he!==F);Xr(Q,A.memoizedState)||(yi=!0),A.memoizedState=Q,A.baseQueue===null&&(A.baseState=Q),T.lastRenderedState=Q}return[Q,B]}function wt(m,A,T){var B=Mn,F=_e(),Q=Xn;if(Q){if(T===void 0)throw Error(i(407));T=T()}else T=A();var he=!Xr((sn||F).memoizedState,T);if(he&&(F.memoizedState=T,yi=!0),F=F.queue,p0(on.bind(null,B,F,m),[m]),F.getSnapshot!==A||he||Wn!==null&&Wn.memoizedState.tag&1){if(B.flags|=2048,Cs(9,Kt.bind(null,B,F,T,A),{destroy:void 0},null),ai===null)throw Error(i(349));Q||(Kl&60)!==0||It(B,A,T)}return T}function It(m,A,T){m.flags|=16384,m={getSnapshot:A,value:T},A=Mn.updateQueue,A===null?(A=fg(),Mn.updateQueue=A,A.stores=[m]):(T=A.stores,T===null?A.stores=[m]:T.push(m))}function Kt(m,A,T,B){A.value=T,A.getSnapshot=B,nn(A)&&Cn(m)}function on(m,A,T){return T(function(){nn(A)&&Cn(m)})}function nn(m){var A=m.getSnapshot;m=m.value;try{var T=A();return!Xr(m,T)}catch{return!0}}function Cn(m){var A=be(m,2);A!==null&&ks(A,m,2)}function Ht(m){var A=ye();if(typeof m=="function"){var T=m;if(m=T(),zc){W(!0);try{T()}finally{W(!1)}}}return A.memoizedState=A.baseState=m,A.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:tt,lastRenderedState:m},A}function Dt(m,A,T,B){return m.baseState=T,ot(m,sn,typeof B=="function"?B:tt)}function Vn(m,A,T,B,F){if(Rd(m))throw Error(i(485));if(m=A.action,m!==null){var Q={payload:F,action:m,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(he){Q.listeners.push(he)}};fn.T!==null?T(!0):Q.isTransition=!1,B(Q),T=A.pending,T===null?(Q.next=A.pending=Q,An(A,Q)):(Q.next=T.next,A.pending=T.next=Q)}}function An(m,A){var T=A.action,B=A.payload,F=m.state;if(A.isTransition){var Q=fn.T,he={};fn.T=he;try{var Ie=T(F,B),Fe=fn.S;Fe!==null&&Fe(he,Ie),ii(m,A,Ie)}catch(lt){Yn(m,A,lt)}finally{fn.T=Q}}else try{Q=T(F,B),ii(m,A,Q)}catch(lt){Yn(m,A,lt)}}function ii(m,A,T){T!==null&&typeof T=="object"&&typeof T.then=="function"?T.then(function(B){In(m,A,B)},function(B){return Yn(m,A,B)}):In(m,A,T)}function In(m,A,T){A.status="fulfilled",A.value=T,yn(A),m.state=T,A=m.pending,A!==null&&(T=A.next,T===A?m.pending=null:(T=T.next,A.next=T,An(m,T)))}function Yn(m,A,T){var B=m.pending;if(m.pending=null,B!==null){B=B.next;do A.status="rejected",A.reason=T,yn(A),A=A.next;while(A!==B)}m.action=null}function yn(m){m=m.listeners;for(var A=0;A<m.length;A++)(0,m[A])()}function $t(m,A){return A}function li(m,A){if(Xn){var T=ai.formState;if(T!==null){e:{var B=Mn;if(Xn){if(or){var F=ay(or,Hs);if(F){or=oy(F),B=wx(F);break e}}re(B)}B=!1}B&&(A=T[0])}}T=ye(),T.memoizedState=T.baseState=A,B={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$t,lastRenderedState:A},T.queue=B,T=y0.bind(null,Mn,B),B.dispatch=T,B=Ht(!1);var Q=Gh.bind(null,Mn,!1,B.queue);return B=ye(),F={state:A,dispatch:null,action:m,pending:null},B.queue=F,T=Vn.bind(null,Mn,F,Q,T),F.dispatch=T,B.memoizedState=m,[A,T,!1]}function Oi(m){var A=_e();return Pn(A,sn,m)}function Pn(m,A,T){A=ot(m,A,$t)[0],m=at(tt)[0],A=typeof A=="object"&&A!==null&&typeof A.then=="function"?Me(A):A;var B=_e(),F=B.queue,Q=F.dispatch;return T!==B.memoizedState&&(Mn.flags|=2048,Cs(9,Ci.bind(null,F,T),{destroy:void 0},null)),[A,Q,m]}function Ci(m,A){m.action=A}function Du(m){var A=_e(),T=sn;if(T!==null)return Pn(A,T,m);_e(),A=A.memoizedState,T=_e();var B=T.queue.dispatch;return T.memoizedState=m,[A,B,!1]}function Cs(m,A,T,B){return m={tag:m,create:A,inst:T,deps:B,next:null},A=Mn.updateQueue,A===null&&(A=fg(),Mn.updateQueue=A),T=A.lastEffect,T===null?A.lastEffect=m.next=m:(B=T.next,T.next=m,m.next=B,A.lastEffect=m),m}function UE(){return _e().memoizedState}function Td(m,A,T,B){var F=ye();Mn.flags|=m,F.memoizedState=Cs(1|A,T,{destroy:void 0},B===void 0?null:B)}function Cd(m,A,T,B){var F=_e();B=B===void 0?null:B;var Q=F.memoizedState.inst;sn!==null&&B!==null&&Z(B,sn.memoizedState.deps)?F.memoizedState=Cs(A,T,Q,B):(Mn.flags|=m,F.memoizedState=Cs(1|A,T,Q,B))}function Sm(m,A){Td(8390656,8,m,A)}function p0(m,A){Cd(2048,8,m,A)}function kE(m,A){return Cd(4,2,m,A)}function Id(m,A){return Cd(4,4,m,A)}function bm(m,A){if(typeof A=="function"){m=m();var T=A(m);return function(){typeof T=="function"?T():A(null)}}if(A!=null)return m=m(),A.current=m,function(){A.current=null}}function Tm(m,A,T){T=T!=null?T.concat([m]):null,Cd(4,4,bm.bind(null,A,m),T)}function mc(){}function Lu(m,A){var T=_e();A=A===void 0?null:A;var B=T.memoizedState;return A!==null&&Z(A,B[1])?B[0]:(T.memoizedState=[m,A],m)}function m0(m,A){var T=_e();A=A===void 0?null:A;var B=T.memoizedState;if(A!==null&&Z(A,B[1]))return B[0];if(B=m(),zc){W(!0);try{m()}finally{W(!1)}}return T.memoizedState=[B,A],B}function Md(m,A,T){return T===void 0||(Kl&1073741824)!==0?m.memoizedState=A:(m.memoizedState=T,m=F0(),Mn.lanes|=m,Ea|=m,T)}function g0(m,A,T,B){return Xr(T,A)?T:Mi.current!==null?(m=Md(m,T,B),Xr(m,A)||(yi=!0),m):(Kl&42)===0?(yi=!0,m.memoizedState=T):(m=F0(),Mn.lanes|=m,Ea|=m,A)}function Uh(m,A,T,B,F){var Q=zl();Ar(Q!==0&&8>Q?Q:8);var he=fn.T,Ie={};fn.T=Ie,Gh(m,!1,A,T);try{var Fe=F(),lt=fn.S;if(lt!==null&&lt(Ie,Fe),Fe!==null&&typeof Fe=="object"&&typeof Fe.then=="function"){var Ct=Et(Fe,B);gc(m,A,Ct,as(m))}else gc(m,A,B,as(m))}catch(Lt){gc(m,A,{then:function(){},status:"rejected",reason:Lt},as())}finally{Ar(Q),fn.T=he}}function Vo(m){var A=m.memoizedState;if(A!==null)return A;A={memoizedState:Dc,baseState:Dc,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:tt,lastRenderedState:Dc},next:null};var T={};return A.next={memoizedState:T,baseState:T,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:tt,lastRenderedState:T},next:null},m.memoizedState=A,m=m.alternate,m!==null&&(m.memoizedState=A),A}function wd(){return tr(Ao)}function kh(){return _e().memoizedState}function Il(){return _e().memoizedState}function A0(m){for(var A=m.return;A!==null;){switch(A.tag){case 24:case 3:var T=as();m=pt(T);var B=At(A,m,T);B!==null&&(ks(B,A,T),Qt(B,A,T)),A={cache:Ec()},m.payload=A;return}A=A.return}}function Cm(m,A,T){var B=as();T={lane:B,revertLane:0,action:T,hasEagerState:!1,eagerState:null,next:null},Rd(m)?Ir(A,T):(T=Se(m,A,T,B),T!==null&&(ks(T,m,B),Ac(T,A,B)))}function y0(m,A,T){var B=as();gc(m,A,T,B)}function gc(m,A,T,B){var F={lane:B,revertLane:0,action:T,hasEagerState:!1,eagerState:null,next:null};if(Rd(m))Ir(A,F);else{var Q=m.alternate;if(m.lanes===0&&(Q===null||Q.lanes===0)&&(Q=A.lastRenderedReducer,Q!==null))try{var he=A.lastRenderedState,Ie=Q(he,T);if(F.hasEagerState=!0,F.eagerState=Ie,Xr(Ie,he))return Ae(m,A,F,0),ai===null&&ve(),!1}catch{}finally{}if(T=Se(m,A,F,B),T!==null)return ks(T,m,B),Ac(T,A,B),!0}return!1}function Gh(m,A,T,B){if(B={lane:2,revertLane:rt(),action:B,hasEagerState:!1,eagerState:null,next:null},Rd(m)){if(A)throw Error(i(479))}else A=Se(m,T,B,2),A!==null&&ks(A,m,2)}function Rd(m){var A=m.alternate;return m===Mn||A!==null&&A===Mn}function Ir(m,A){Wu=Ga=!0;var T=m.pending;T===null?A.next=A:(A.next=T.next,T.next=A),m.pending=A}function Ac(m,A,T){if((T&4194176)!==0){var B=A.lanes;B&=m.pendingLanes,T|=B,A.lanes=T,z(m,T)}}function Hh(m,A,T,B){A=m.memoizedState,T=T(B,A),T=T==null?A:jm({},A,T),m.memoizedState=T,m.lanes===0&&(m.updateQueue.baseState=T)}function zh(m,A,T,B,F,Q,he){return m=m.stateNode,typeof m.shouldComponentUpdate=="function"?m.shouldComponentUpdate(B,Q,he):A.prototype&&A.prototype.isPureReactComponent?!St(T,B)||!St(F,Q):!0}function GE(m,A,T,B){m=A.state,typeof A.componentWillReceiveProps=="function"&&A.componentWillReceiveProps(T,B),typeof A.UNSAFE_componentWillReceiveProps=="function"&&A.UNSAFE_componentWillReceiveProps(T,B),A.state!==m&&el.enqueueReplaceState(A,A.state,null)}function Ml(m,A){var T=A;if("ref"in A){T={};for(var B in A)B!=="ref"&&(T[B]=A[B])}if(m=m.defaultProps){T===A&&(T=jm({},T));for(var F in m)T[F]===void 0&&(T[F]=m[F])}return T}function Qh(m,A){try{var T=m.onUncaughtError;T(A.value,{componentStack:A.stack})}catch(B){setTimeout(function(){throw B})}}function Vh(m,A,T){try{var B=m.onCaughtError;B(T.value,{componentStack:T.stack,errorBoundary:A.tag===1?A.stateNode:null})}catch(F){setTimeout(function(){throw F})}}function jh(m,A,T){return T=pt(T),T.tag=3,T.payload={element:null},T.callback=function(){Qh(m,A)},T}function v0(m){return m=pt(m),m.tag=3,m}function HE(m,A,T,B){var F=T.type.getDerivedStateFromError;if(typeof F=="function"){var Q=B.value;m.payload=function(){return F(Q)},m.callback=function(){Vh(A,T,B)}}var he=T.stateNode;he!==null&&typeof he.componentDidCatch=="function"&&(m.callback=function(){Vh(A,T,B),typeof F!="function"&&(Vc===null?Vc=new Set([this]):Vc.add(this));var Ie=B.stack;this.componentDidCatch(B.value,{componentStack:Ie!==null?Ie:""})})}function bC(m,A,T,B,F){if(T.flags|=32768,B!==null&&typeof B=="object"&&typeof B.then=="function"){if(A=T.alternate,A!==null&&Od(A,T,F,!0),T=ma.current,T!==null){switch(T.tag){case 13:return Ai===null?Nl():T.alternate===null&&vi===0&&(vi=3),T.flags&=-257,T.flags|=65536,T.lanes=F,B===fp?T.flags|=16384:(A=T.updateQueue,A===null?T.updateQueue=new Set([B]):A.add(B),Nu(m,B,F)),!1;case 22:return T.flags|=65536,B===fp?T.flags|=16384:(A=T.updateQueue,A===null?(A={transitions:null,markerInstances:null,retryQueue:new Set([B])},T.updateQueue=A):(T=A.retryQueue,T===null?A.retryQueue=new Set([B]):T.add(B)),Nu(m,B,F)),!1}throw Error(i(435,T.tag))}return Nu(m,B,F),Nl(),!1}if(Xn)return A=ma.current,A!==null?((A.flags&65536)===0&&(A.flags|=256),A.flags|=65536,A.lanes=F,B!==cp&&(m=Error(i(422),{cause:B}),pe(X(m,T)))):(B!==cp&&(A=Error(i(423),{cause:B}),pe(X(A,T))),m=m.current.alternate,m.flags|=65536,F&=-F,m.lanes|=F,B=X(B,T),F=jh(m.stateNode,B,F),Ut(m,F),vi!==4&&(vi=2)),!1;var Q=Error(i(520),{cause:B});if(Q=X(Q,T),Zu===null?Zu=[Q]:Zu.push(Q),vi!==4&&(vi=2),A===null)return!0;B=X(B,T),T=A;do{switch(T.tag){case 3:return T.flags|=65536,m=F&-F,T.lanes|=m,m=jh(T.stateNode,B,m),Ut(T,m),!1;case 1:if(A=T.type,Q=T.stateNode,(T.flags&128)===0&&(typeof A.getDerivedStateFromError=="function"||Q!==null&&typeof Q.componentDidCatch=="function"&&(Vc===null||!Vc.has(Q))))return T.flags|=65536,F&=-F,T.lanes|=F,F=v0(F),HE(F,m,T,B),Ut(T,F),!1}T=T.return}while(T!==null);return!1}function er(m,A,T,B){A.child=m===null?Zo(A,null,T,B):Hc(A,m.child,T,B)}function Im(m,A,T,B,F){T=T.render;var Q=A.ref;if("ref"in B){var he={};for(var Ie in B)Ie!=="ref"&&(he[Ie]=B[Ie])}else he=B;return vc(A),B=fe(m,A,T,he,Q,F),Ie=it(),m!==null&&!yi?(xt(m,A,F),wl(m,A,F)):(Xn&&Ie&&oe(A),A.flags|=1,er(m,A,B,F),A.child)}function zE(m,A,T,B,F){if(m===null){var Q=T.type;return typeof Q=="function"&&!Kd(Q)&&Q.defaultProps===void 0&&T.compare===null?(A.tag=15,A.type=Q,QE(m,A,Q,B,F)):(m=Ko(T.type,null,B,A,A.mode,F),m.ref=A.ref,m.return=A,A.child=m)}if(Q=m.child,!b0(m,F)){var he=Q.memoizedProps;if(T=T.compare,T=T!==null?T:St,T(he,B)&&m.ref===A.ref)return wl(m,A,F)}return A.flags|=1,m=La(Q,B),m.ref=A.ref,m.return=A,A.child=m}function QE(m,A,T,B,F){if(m!==null){var Q=m.memoizedProps;if(St(Q,B)&&m.ref===A.ref)if(yi=!1,A.pendingProps=B=Q,b0(m,F))(m.flags&131072)!==0&&(yi=!0);else return A.lanes=m.lanes,wl(m,A,F)}return Mm(m,A,T,B,F)}function VE(m,A,T){var B=A.pendingProps,F=B.children,Q=(A.stateNode._pendingVisibility&2)!==0,he=m!==null?m.memoizedState:null;if(Bd(m,A),B.mode==="hidden"||Q){if((A.flags&128)!==0){if(B=he!==null?he.baseLanes|T:T,m!==null){for(F=A.child=m.child,Q=0;F!==null;)Q=Q|F.lanes|F.childLanes,F=F.sibling;A.childLanes=Q&~B}else A.childLanes=0,A.child=null;return jE(m,A,B,T)}if((T&536870912)!==0)A.memoizedState={baseLanes:0,cachePool:null},m!==null&&Rm(A,he!==null?he.cachePool:null),he!==null?Ji(A,he):Ti(),fo(A);else return A.lanes=A.childLanes=536870912,jE(m,A,he!==null?he.baseLanes|T:T,T)}else he!==null?(Rm(A,he.cachePool),Ji(A,he),Ts(),A.memoizedState=null):(m!==null&&Rm(A,null),Ti(),Ts());return er(m,A,F,T),A.child}function jE(m,A,T,B){var F=C0();return F=F===null?null:{parent:Rr?wi._currentValue:wi._currentValue2,pool:F},A.memoizedState={baseLanes:T,cachePool:F},m!==null&&Rm(A,null),Ti(),fo(A),m!==null&&Od(m,A,B,!0),null}function Bd(m,A){var T=A.ref;if(T===null)m!==null&&m.ref!==null&&(A.flags|=2097664);else{if(typeof T!="function"&&typeof T!="object")throw Error(i(284));(m===null||m.ref!==T)&&(A.flags|=2097664)}}function Mm(m,A,T,B,F){return vc(A),T=fe(m,A,T,B,void 0,F),B=it(),m!==null&&!yi?(xt(m,A,F),wl(m,A,F)):(Xn&&B&&oe(A),A.flags|=1,er(m,A,T,F),A.child)}function qE(m,A,T,B,F,Q){return vc(A),A.updateQueue=null,T=qe(A,B,T,F),we(m),B=it(),m!==null&&!yi?(xt(m,A,Q),wl(m,A,Q)):(Xn&&B&&oe(A),A.flags|=1,er(m,A,T,Q),A.child)}function KE(m,A,T,B,F){if(vc(A),A.stateNode===null){var Q=Nc,he=T.contextType;typeof he=="object"&&he!==null&&(Q=tr(he)),Q=new T(B,Q),A.memoizedState=Q.state!==null&&Q.state!==void 0?Q.state:null,Q.updater=el,A.stateNode=Q,Q._reactInternals=A,Q=A.stateNode,Q.props=B,Q.state=A.memoizedState,Q.refs={},Rt(A),he=T.contextType,Q.context=typeof he=="object"&&he!==null?tr(he):Nc,Q.state=A.memoizedState,he=T.getDerivedStateFromProps,typeof he=="function"&&(Hh(A,T,he,B),Q.state=A.memoizedState),typeof T.getDerivedStateFromProps=="function"||typeof Q.getSnapshotBeforeUpdate=="function"||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(he=Q.state,typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount(),he!==Q.state&&el.enqueueReplaceState(Q,Q.state,null),Vt(A,B,Q,F),vt(),Q.state=A.memoizedState),typeof Q.componentDidMount=="function"&&(A.flags|=4194308),B=!0}else if(m===null){Q=A.stateNode;var Ie=A.memoizedProps,Fe=Ml(T,Ie);Q.props=Fe;var lt=Q.context,Ct=T.contextType;he=Nc,typeof Ct=="object"&&Ct!==null&&(he=tr(Ct));var Lt=T.getDerivedStateFromProps;Ct=typeof Lt=="function"||typeof Q.getSnapshotBeforeUpdate=="function",Ie=A.pendingProps!==Ie,Ct||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(Ie||lt!==he)&&GE(A,Q,B,he),ql=!1;var kt=A.memoizedState;Q.state=kt,Vt(A,B,Q,F),vt(),lt=A.memoizedState,Ie||kt!==lt||ql?(typeof Lt=="function"&&(Hh(A,T,Lt,B),lt=A.memoizedState),(Fe=ql||zh(A,T,Fe,B,kt,lt,he))?(Ct||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount()),typeof Q.componentDidMount=="function"&&(A.flags|=4194308)):(typeof Q.componentDidMount=="function"&&(A.flags|=4194308),A.memoizedProps=B,A.memoizedState=lt),Q.props=B,Q.state=lt,Q.context=he,B=Fe):(typeof Q.componentDidMount=="function"&&(A.flags|=4194308),B=!1)}else{Q=A.stateNode,Gt(m,A),he=A.memoizedProps,Ct=Ml(T,he),Q.props=Ct,Lt=A.pendingProps,kt=Q.context,lt=T.contextType,Fe=Nc,typeof lt=="object"&&lt!==null&&(Fe=tr(lt)),Ie=T.getDerivedStateFromProps,(lt=typeof Ie=="function"||typeof Q.getSnapshotBeforeUpdate=="function")||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(he!==Lt||kt!==Fe)&&GE(A,Q,B,Fe),ql=!1,kt=A.memoizedState,Q.state=kt,Vt(A,B,Q,F),vt();var En=A.memoizedState;he!==Lt||kt!==En||ql||m!==null&&m.dependencies!==null&&Pd(m.dependencies)?(typeof Ie=="function"&&(Hh(A,T,Ie,B),En=A.memoizedState),(Ct=ql||zh(A,T,Ct,B,kt,En,Fe)||m!==null&&m.dependencies!==null&&Pd(m.dependencies))?(lt||typeof Q.UNSAFE_componentWillUpdate!="function"&&typeof Q.componentWillUpdate!="function"||(typeof Q.componentWillUpdate=="function"&&Q.componentWillUpdate(B,En,Fe),typeof Q.UNSAFE_componentWillUpdate=="function"&&Q.UNSAFE_componentWillUpdate(B,En,Fe)),typeof Q.componentDidUpdate=="function"&&(A.flags|=4),typeof Q.getSnapshotBeforeUpdate=="function"&&(A.flags|=1024)):(typeof Q.componentDidUpdate!="function"||he===m.memoizedProps&&kt===m.memoizedState||(A.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||he===m.memoizedProps&&kt===m.memoizedState||(A.flags|=1024),A.memoizedProps=B,A.memoizedState=En),Q.props=B,Q.state=En,Q.context=Fe,B=Ct):(typeof Q.componentDidUpdate!="function"||he===m.memoizedProps&&kt===m.memoizedState||(A.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||he===m.memoizedProps&&kt===m.memoizedState||(A.flags|=1024),B=!1)}return Q=B,Bd(m,A),B=(A.flags&128)!==0,Q||B?(Q=A.stateNode,T=B&&typeof T.getDerivedStateFromError!="function"?null:Q.render(),A.flags|=1,m!==null&&B?(A.child=Hc(A,m.child,null,F),A.child=Hc(A,null,T,F)):er(m,A,T,F),A.memoizedState=Q.state,m=A.child):m=wl(m,A,F),m}function YE(m,A,T,B){return nt(),A.flags|=256,er(m,A,T,B),A.child}function E0(m){return{baseLanes:m,cachePool:I0()}}function Dd(m,A,T){return m=m!==null?m.childLanes&~T:0,A&&(m|=xa),m}function XE(m,A,T){var B=A.pendingProps,F=!1,Q=(A.flags&128)!==0,he;if((he=Q)||(he=m!==null&&m.memoizedState===null?!1:(ws.current&2)!==0),he&&(F=!0,A.flags&=-129),he=(A.flags&32)!==0,A.flags&=-33,m===null){if(Xn){if(F?Cr(A):Ts(),Xn){var Ie=or,Fe;(Fe=Ie)&&(Ie=Dx(Ie,Hs),Ie!==null?(A.memoizedState={dehydrated:Ie,treeContext:Fc!==null?{id:vo,overflow:Eo}:null,retryLane:536870912},Fe=t(18,null,null,0),Fe.stateNode=Ie,Fe.return=A,A.child=Fe,ar=A,or=null,Fe=!0):Fe=!1),Fe||re(A)}if(Ie=A.memoizedState,Ie!==null&&(Ie=Ie.dehydrated,Ie!==null))return tg(Ie)?A.lanes=16:A.lanes=536870912,null;an(A)}return Ie=B.children,B=B.fallback,F?(Ts(),F=A.mode,Ie=_0({mode:"hidden",children:Ie},F),B=Zi(B,F,T,null),Ie.return=A,B.return=A,Ie.sibling=B,A.child=Ie,F=A.child,F.memoizedState=E0(T),F.childLanes=Dd(m,he,T),A.memoizedState=mg,B):(Cr(A),x0(A,Ie))}if(Fe=m.memoizedState,Fe!==null&&(Ie=Fe.dehydrated,Ie!==null)){if(Q)A.flags&256?(Cr(A),A.flags&=-257,A=wm(m,A,T)):A.memoizedState!==null?(Ts(),A.child=m.child,A.flags|=128,A=null):(Ts(),F=B.fallback,Ie=A.mode,B=_0({mode:"visible",children:B.children},Ie),F=Zi(F,Ie,T,null),F.flags|=2,B.return=A,F.return=A,B.sibling=F,A.child=B,Hc(A,m.child,null,T),B=A.child,B.memoizedState=E0(T),B.childLanes=Dd(m,he,T),A.memoizedState=mg,A=F);else if(Cr(A),tg(Ie))he=Ix(Ie).digest,B=Error(i(419)),B.stack="",B.digest=he,pe({value:B,source:null,stack:null}),A=wm(m,A,T);else if(yi||Od(m,A,T,!1),he=(T&m.childLanes)!==0,yi||he){if(he=ai,he!==null){if(B=T&-T,(B&42)!==0)B=1;else switch(B){case 2:B=1;break;case 8:B=4;break;case 32:B=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:B=64;break;case 268435456:B=134217728;break;default:B=0}if(B=(B&(he.suspendedLanes|T))!==0?0:B,B!==0&&B!==Fe.retryLane)throw Fe.retryLane=B,be(m,B),ks(he,m,B),pg}eg(Ie)||Nl(),A=wm(m,A,T)}else eg(Ie)?(A.flags|=128,A.child=m.child,A=Fl.bind(null,m),Mx(Ie,A),A=null):(m=Fe.treeContext,rr&&(or=Bx(Ie),ar=A,Xn=!0,Ua=null,Hs=!1,m!==null&&(fa[da++]=vo,fa[da++]=Eo,fa[da++]=Fc,vo=m.id,Eo=m.overflow,Fc=A)),A=x0(A,B.children),A.flags|=4096);return A}return F?(Ts(),F=B.fallback,Ie=A.mode,Fe=m.child,Q=Fe.sibling,B=La(Fe,{mode:"hidden",children:B.children}),B.subtreeFlags=Fe.subtreeFlags&31457280,Q!==null?F=La(Q,F):(F=Zi(F,Ie,T,null),F.flags|=2),F.return=A,B.return=A,B.sibling=F,A.child=B,B=F,F=A.child,Ie=m.child.memoizedState,Ie===null?Ie=E0(T):(Fe=Ie.cachePool,Fe!==null?(Q=Rr?wi._currentValue:wi._currentValue2,Fe=Fe.parent!==Q?{parent:Q,pool:Q}:Fe):Fe=I0(),Ie={baseLanes:Ie.baseLanes|T,cachePool:Fe}),F.memoizedState=Ie,F.childLanes=Dd(m,he,T),A.memoizedState=mg,B):(Cr(A),T=m.child,m=T.sibling,T=La(T,{mode:"visible",children:B.children}),T.return=A,T.sibling=null,m!==null&&(he=A.deletions,he===null?(A.deletions=[m],A.flags|=16):he.push(m)),A.child=T,A.memoizedState=null,T)}function x0(m,A){return A=_0({mode:"visible",children:A},m.mode),A.return=m,m.child=A}function _0(m,A){return Xd(m,A,0,null)}function wm(m,A,T){return Hc(A,m.child,null,T),m=x0(A,A.pendingProps.children),m.flags|=2,A.memoizedState=null,m}function WE(m,A,T){m.lanes|=A;var B=m.alternate;B!==null&&(B.lanes|=A),Ld(m.return,A,T)}function S0(m,A,T,B,F){var Q=m.memoizedState;Q===null?m.memoizedState={isBackwards:A,rendering:null,renderingStartTime:0,last:B,tail:T,tailMode:F}:(Q.isBackwards=A,Q.rendering=null,Q.renderingStartTime=0,Q.last=B,Q.tail=T,Q.tailMode=F)}function $E(m,A,T){var B=A.pendingProps,F=B.revealOrder,Q=B.tail;if(er(m,A,B.children,T),B=ws.current,(B&2)!==0)B=B&1|2,A.flags|=128;else{if(m!==null&&(m.flags&128)!==0)e:for(m=A.child;m!==null;){if(m.tag===13)m.memoizedState!==null&&WE(m,T,A);else if(m.tag===19)WE(m,T,A);else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===A)break e;for(;m.sibling===null;){if(m.return===null||m.return===A)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}B&=1}switch(b(ws,B),F){case"forwards":for(T=A.child,F=null;T!==null;)m=T.alternate,m!==null&&mr(m)===null&&(F=T),T=T.sibling;T=F,T===null?(F=A.child,A.child=null):(F=T.sibling,T.sibling=null),S0(A,!1,F,T,Q);break;case"backwards":for(T=null,F=A.child,A.child=null;F!==null;){if(m=F.alternate,m!==null&&mr(m)===null){A.child=F;break}m=F.sibling,F.sibling=T,T=F,F=m}S0(A,!0,T,null,Q);break;case"together":S0(A,!1,null,null,void 0);break;default:A.memoizedState=null}return A.child}function wl(m,A,T){if(m!==null&&(A.dependencies=m.dependencies),Ea|=A.lanes,(T&A.childLanes)===0)if(m!==null){if(Od(m,A,T,!1),(T&A.childLanes)===0)return null}else return null;if(m!==null&&A.child!==m.child)throw Error(i(153));if(A.child!==null){for(m=A.child,T=La(m,m.pendingProps),A.child=T,T.return=A;m.sibling!==null;)m=m.sibling,T=T.sibling=La(m,m.pendingProps),T.return=A;T.sibling=null}return A.child}function b0(m,A){return(m.lanes&A)!==0?!0:(m=m.dependencies,!!(m!==null&&Pd(m)))}function TC(m,A,T){switch(A.tag){case 3:Ce(A,A.stateNode.containerInfo),yc(A,wi,m.memoizedState.cache),nt();break;case 27:case 5:ie(A);break;case 4:Ce(A,A.stateNode.containerInfo);break;case 10:yc(A,A.type,A.memoizedProps.value);break;case 13:var B=A.memoizedState;if(B!==null)return B.dehydrated!==null?(Cr(A),A.flags|=128,null):(T&A.child.childLanes)!==0?XE(m,A,T):(Cr(A),m=wl(m,A,T),m!==null?m.sibling:null);Cr(A);break;case 19:var F=(m.flags&128)!==0;if(B=(T&A.childLanes)!==0,B||(Od(m,A,T,!1),B=(T&A.childLanes)!==0),F){if(B)return $E(m,A,T);A.flags|=128}if(F=A.memoizedState,F!==null&&(F.rendering=null,F.tail=null,F.lastEffect=null),b(ws,ws.current),B)break;return null;case 22:case 23:return A.lanes=0,VE(m,A,T);case 24:yc(A,wi,m.memoizedState.cache)}return wl(m,A,T)}function JE(m,A,T){if(m!==null)if(m.memoizedProps!==A.pendingProps)yi=!0;else{if(!b0(m,T)&&(A.flags&128)===0)return yi=!1,TC(m,A,T);yi=(m.flags&131072)!==0}else yi=!1,Xn&&(A.flags&1048576)!==0&&te(A,df,A.index);switch(A.lanes=0,A.tag){case 16:e:{m=A.pendingProps;var B=A.elementType,F=B._init;if(B=F(B._payload),A.type=B,typeof B=="function")Kd(B)?(m=Ml(B,m),A.tag=1,A=KE(null,A,B,m,T)):(A.tag=0,A=Mm(null,A,B,m,T));else{if(B!=null){if(F=B.$$typeof,F===ep){A.tag=11,A=Im(null,A,B,m,T);break e}else if(F===Ym){A.tag=14,A=zE(null,A,B,m,T);break e}}throw A=a(B)||B,Error(i(306,A,""))}}return A;case 0:return Mm(m,A,A.type,A.pendingProps,T);case 1:return B=A.type,F=Ml(B,A.pendingProps),KE(m,A,B,F,T);case 3:e:{if(Ce(A,A.stateNode.containerInfo),m===null)throw Error(i(387));var Q=A.pendingProps;F=A.memoizedState,B=F.element,Gt(m,A),Vt(A,Q,null,T);var he=A.memoizedState;if(Q=he.cache,yc(A,wi,Q),Q!==F.cache&&Ou(A,[wi],T,!0),vt(),Q=he.element,rr&&F.isDehydrated)if(F={element:Q,isDehydrated:!1,cache:he.cache},A.updateQueue.baseState=F,A.memoizedState=F,A.flags&256){A=YE(m,A,Q,T);break e}else if(Q!==B){B=X(Error(i(424)),A),pe(B),A=YE(m,A,Q,T);break e}else for(rr&&(or=Rx(A.stateNode.containerInfo),ar=A,Xn=!0,Ua=null,Hs=!0),T=Zo(A,null,Q,T),A.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(nt(),Q===B){A=wl(m,A,T);break e}er(m,A,Q,T)}A=A.child}return A;case 26:if(ha)return Bd(m,A),m===null?(T=uy(A.type,null,A.pendingProps,null))?A.memoizedState=T:Xn||(A.stateNode=ag(A.type,A.pendingProps,$o.current,A)):A.memoizedState=uy(A.type,m.memoizedProps,A.pendingProps,m.memoizedState),null;case 27:if(gi)return ie(A),m===null&&gi&&Xn&&(B=A.stateNode=yo(A.type,A.pendingProps,$o.current,Ms.current,!1),ar=A,Hs=!0,or=ng(B)),B=A.pendingProps.children,m!==null||Xn?er(m,A,B,T):A.child=Hc(A,null,B,T),Bd(m,A),A.child;case 5:return m===null&&Xn&&(sg(A.type,A.pendingProps,Ms.current),(F=B=or)&&(B=DC(B,A.type,A.pendingProps,Hs),B!==null?(A.stateNode=B,ar=A,or=ng(B),Hs=!1,F=!0):F=!1),F||re(A)),ie(A),F=A.type,Q=A.pendingProps,he=m!==null?m.memoizedProps:null,B=Q.children,Sn(F,Q)?B=null:he!==null&&Sn(F,he)&&(A.flags|=32),A.memoizedState!==null&&(F=fe(m,A,Ye,null,null,T),Rr?Ao._currentValue=F:Ao._currentValue2=F),Bd(m,A),er(m,A,B,T),A.child;case 6:return m===null&&Xn&&(Fx(A.pendingProps,Ms.current),(m=T=or)&&(T=ly(T,A.pendingProps,Hs),T!==null?(A.stateNode=T,ar=A,or=null,m=!0):m=!1),m||re(A)),null;case 13:return XE(m,A,T);case 4:return Ce(A,A.stateNode.containerInfo),B=A.pendingProps,m===null?A.child=Hc(A,null,B,T):er(m,A,B,T),A.child;case 11:return Im(m,A,A.type,A.pendingProps,T);case 7:return er(m,A,A.pendingProps,T),A.child;case 8:return er(m,A,A.pendingProps.children,T),A.child;case 12:return er(m,A,A.pendingProps.children,T),A.child;case 10:return B=A.pendingProps,yc(A,A.type,B.value),er(m,A,B.children,T),A.child;case 9:return F=A.type._context,B=A.pendingProps.children,vc(A),F=tr(F),B=B(F),A.flags|=1,er(m,A,B,T),A.child;case 14:return zE(m,A,A.type,A.pendingProps,T);case 15:return QE(m,A,A.type,A.pendingProps,T);case 19:return $E(m,A,T);case 22:return VE(m,A,T);case 24:return vc(A),B=tr(wi),m===null?(F=C0(),F===null&&(F=ai,Q=Ec(),F.pooledCache=Q,Q.refCount++,Q!==null&&(F.pooledCacheLanes|=T),F=Q),A.memoizedState={parent:B,cache:F},Rt(A),yc(A,wi,F)):((m.lanes&T)!==0&&(Gt(m,A),Vt(A,null,null,T),vt()),F=m.memoizedState,Q=A.memoizedState,F.parent!==B?(F={parent:B,cache:B},A.memoizedState=F,A.lanes===0&&(A.memoizedState=A.updateQueue.baseState=F),yc(A,wi,B)):(B=Q.cache,yc(A,wi,B),B!==F.cache&&Ou(A,[wi],T,!0))),er(m,A,A.pendingProps.children,T),A.child;case 29:throw A.pendingProps}throw Error(i(156,A.tag))}function yc(m,A,T){Rr?(b(Yl,A._currentValue),A._currentValue=T):(b(Yl,A._currentValue2),A._currentValue2=T)}function Rl(m){var A=Yl.current;Rr?m._currentValue=A:m._currentValue2=A,_(Yl)}function Ld(m,A,T){for(;m!==null;){var B=m.alternate;if((m.childLanes&A)!==A?(m.childLanes|=A,B!==null&&(B.childLanes|=A)):B!==null&&(B.childLanes&A)!==A&&(B.childLanes|=A),m===T)break;m=m.return}}function Ou(m,A,T,B){var F=m.child;for(F!==null&&(F.return=m);F!==null;){var Q=F.dependencies;if(Q!==null){var he=F.child;Q=Q.firstContext;e:for(;Q!==null;){var Ie=Q;Q=F;for(var Fe=0;Fe<A.length;Fe++)if(Ie.context===A[Fe]){Q.lanes|=T,Ie=Q.alternate,Ie!==null&&(Ie.lanes|=T),Ld(Q.return,T,m),B||(he=null);break e}Q=Ie.next}}else if(F.tag===18){if(he=F.return,he===null)throw Error(i(341));he.lanes|=T,Q=he.alternate,Q!==null&&(Q.lanes|=T),Ld(he,T,m),he=null}else he=F.child;if(he!==null)he.return=F;else for(he=F;he!==null;){if(he===m){he=null;break}if(F=he.sibling,F!==null){F.return=he.return,he=F;break}he=he.return}F=he}}function Od(m,A,T,B){m=null;for(var F=A,Q=!1;F!==null;){if(!Q){if((F.flags&524288)!==0)Q=!0;else if((F.flags&262144)!==0)break}if(F.tag===10){var he=F.alternate;if(he===null)throw Error(i(387));if(he=he.memoizedProps,he!==null){var Ie=F.type;Xr(F.pendingProps.value,he.value)||(m!==null?m.push(Ie):m=[Ie])}}else if(F===Vu.current){if(he=F.alternate,he===null)throw Error(i(387));he.memoizedState.memoizedState!==F.memoizedState.memoizedState&&(m!==null?m.push(Ao):m=[Ao])}F=F.return}m!==null&&Ou(A,m,T,B),A.flags|=262144}function Pd(m){for(m=m.firstContext;m!==null;){var A=m.context;if(!Xr(Rr?A._currentValue:A._currentValue2,m.memoizedValue))return!0;m=m.next}return!1}function vc(m){So=m,Aa=null,m=m.dependencies,m!==null&&(m.firstContext=null)}function tr(m){return T0(So,m)}function Nd(m,A){return So===null&&vc(m),T0(m,A)}function T0(m,A){var T=Rr?A._currentValue:A._currentValue2;if(A={context:A,memoizedValue:T,next:null},Aa===null){if(m===null)throw Error(i(308));Aa=A,m.dependencies={lanes:0,firstContext:A},m.flags|=524288}else Aa=Aa.next=A;return T}function Ec(){return{controller:new vf,data:new Map,refCount:0}}function Fd(m){m.refCount--,m.refCount===0&&Yx(Xx,function(){m.controller.abort()})}function C0(){var m=tl.current;return m!==null?m:ai.pooledCache}function Rm(m,A){A===null?b(tl,tl.current):b(tl,A.pool)}function I0(){var m=C0();return m===null?null:{parent:Rr?wi._currentValue:wi._currentValue2,pool:m}}function zr(m){m.flags|=4}function qh(m,A){if(m!==null&&m.child===A.child)return!1;if((A.flags&16)!==0)return!0;for(m=A.child;m!==null;){if((m.flags&13878)!==0||(m.subtreeFlags&13878)!==0)return!0;m=m.sibling}return!1}function Pu(m,A,T,B){if(Is)for(T=A.child;T!==null;){if(T.tag===5||T.tag===6)np(m,T.stateNode);else if(!(T.tag===4||gi&&T.tag===27)&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===A)break;for(;T.sibling===null;){if(T.return===null||T.return===A)return;T=T.return}T.sibling.return=T.return,T=T.sibling}else if(Na)for(var F=A.child;F!==null;){if(F.tag===5){var Q=F.stateNode;T&&B&&(Q=sy(Q,F.type,F.memoizedProps)),np(m,Q)}else if(F.tag===6)Q=F.stateNode,T&&B&&(Q=ry(Q,F.memoizedProps)),np(m,Q);else if(F.tag!==4){if(F.tag===22&&F.memoizedState!==null)Q=F.child,Q!==null&&(Q.return=F),Pu(m,F,!0,!0);else if(F.child!==null){F.child.return=F,F=F.child;continue}}if(F===A)break;for(;F.sibling===null;){if(F.return===null||F.return===A)return;F=F.return}F.sibling.return=F.return,F=F.sibling}}function ZE(m,A,T,B){if(Na)for(var F=A.child;F!==null;){if(F.tag===5){var Q=F.stateNode;T&&B&&(Q=sy(Q,F.type,F.memoizedProps)),iy(m,Q)}else if(F.tag===6)Q=F.stateNode,T&&B&&(Q=ry(Q,F.memoizedProps)),iy(m,Q);else if(F.tag!==4){if(F.tag===22&&F.memoizedState!==null)Q=F.child,Q!==null&&(Q.return=F),ZE(m,F,!(F.memoizedProps!==null&&F.memoizedProps.mode==="manual"),!0);else if(F.child!==null){F.child.return=F,F=F.child;continue}}if(F===A)break;for(;F.sibling===null;){if(F.return===null||F.return===A)return;F=F.return}F.sibling.return=F.return,F=F.sibling}}function Ud(m,A){if(Na&&qh(m,A)){m=A.stateNode;var T=m.containerInfo,B=ip();ZE(B,A,!1,!1),m.pendingChildren=B,zr(A),Zm(T,B)}}function Bm(m,A,T,B){if(Is)m.memoizedProps!==B&&zr(A);else if(Na){var F=m.stateNode,Q=m.memoizedProps;if((m=qh(m,A))||Q!==B){var he=Ms.current;Q=uf(F,T,Q,B,!m,null),Q===F?A.stateNode=F:(Hl(Q,T,B,he)&&zr(A),A.stateNode=Q,m?Pu(Q,A,!1,!1):zr(A))}else A.stateNode=F}}function Dm(m,A,T){if(X0(A,T)){if(m.flags|=16777216,!$m(A,T))if(Cc())m.flags|=8192;else throw Uc=fp,hp}else m.flags&=-16777217}function Lm(m,A){if(Gx(A)){if(m.flags|=16777216,!ku(A))if(Cc())m.flags|=8192;else throw Uc=fp,hp}else m.flags&=-16777217}function Kh(m,A){A!==null&&(m.flags|=4),m.flags&16384&&(A=m.tag!==22?L():536870912,m.lanes|=A,sl|=A)}function Yh(m,A){if(!Xn)switch(m.tailMode){case"hidden":A=m.tail;for(var T=null;A!==null;)A.alternate!==null&&(T=A),A=A.sibling;T===null?m.tail=null:T.sibling=null;break;case"collapsed":T=m.tail;for(var B=null;T!==null;)T.alternate!==null&&(B=T),T=T.sibling;B===null?A||m.tail===null?m.tail=null:m.tail.sibling=null:B.sibling=null}}function zi(m){var A=m.alternate!==null&&m.alternate.child===m.child,T=0,B=0;if(A)for(var F=m.child;F!==null;)T|=F.lanes|F.childLanes,B|=F.subtreeFlags&31457280,B|=F.flags&31457280,F.return=m,F=F.sibling;else for(F=m.child;F!==null;)T|=F.lanes|F.childLanes,B|=F.subtreeFlags,B|=F.flags,F.return=m,F=F.sibling;return m.subtreeFlags|=B,m.childLanes=T,A}function ex(m,A,T){var B=A.pendingProps;switch(Ee(A),A.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zi(A),null;case 1:return zi(A),null;case 3:return T=A.stateNode,B=null,m!==null&&(B=m.memoizedState.cache),A.memoizedState.cache!==B&&(A.flags|=2048),Rl(wi),se(),T.pendingContext&&(T.context=T.pendingContext,T.pendingContext=null),(m===null||m.child===null)&&(Ue(A)?zr(A):m===null||m.memoizedState.isDehydrated&&(A.flags&256)===0||(A.flags|=1024,Ua!==null&&(jd(Ua),Ua=null))),Ud(m,A),zi(A),null;case 26:if(ha){T=A.type;var F=A.memoizedState;return m===null?(zr(A),F!==null?(zi(A),Lm(A,F)):(zi(A),Dm(A,T,B))):F?F!==m.memoizedState?(zr(A),zi(A),Lm(A,F)):(zi(A),A.flags&=-16777217):(Is?m.memoizedProps!==B&&zr(A):Bm(m,A,T,B),zi(A),Dm(A,T,B)),null}case 27:if(gi){if(ne(A),T=$o.current,F=A.type,m!==null&&A.stateNode!=null)Is?m.memoizedProps!==B&&zr(A):Bm(m,A,F,B);else{if(!B){if(A.stateNode===null)throw Error(i(166));return zi(A),null}m=Ms.current,Ue(A)?Be(A,m):(m=yo(F,B,T,m,!0),A.stateNode=m,zr(A))}return zi(A),null}case 5:if(ne(A),T=A.type,m!==null&&A.stateNode!=null)Bm(m,A,T,B);else{if(!B){if(A.stateNode===null)throw Error(i(166));return zi(A),null}m=Ms.current,Ue(A)?Be(A,m):(F=Y0(T,B,$o.current,m,A),Pu(F,A,!1,!1),A.stateNode=F,Hl(F,T,B,m)&&zr(A))}return zi(A),Dm(A,A.type,A.pendingProps),null;case 6:if(m&&A.stateNode!=null)T=m.memoizedProps,Is?T!==B&&zr(A):Na&&(T!==B?(A.stateNode=ci(B,$o.current,Ms.current,A),zr(A)):A.stateNode=m.stateNode);else{if(typeof B!="string"&&A.stateNode===null)throw Error(i(166));if(m=$o.current,T=Ms.current,Ue(A)){if(!rr)throw Error(i(176));if(m=A.stateNode,T=A.memoizedProps,B=null,F=ar,F!==null)switch(F.tag){case 27:case 5:B=F.memoizedProps}cy(m,T,A,B)||re(A)}else A.stateNode=ci(B,m,T,A)}return zi(A),null;case 13:if(B=A.memoizedState,m===null||m.memoizedState!==null&&m.memoizedState.dehydrated!==null){if(F=Ue(A),B!==null&&B.dehydrated!==null){if(m===null){if(!F)throw Error(i(318));if(!rr)throw Error(i(344));if(F=A.memoizedState,F=F!==null?F.dehydrated:null,!F)throw Error(i(317));Ox(F,A)}else nt(),(A.flags&128)===0&&(A.memoizedState=null),A.flags|=4;zi(A),F=!1}else Ua!==null&&(jd(Ua),Ua=null),F=!0;if(!F)return A.flags&256?(an(A),A):(an(A),null)}if(an(A),(A.flags&128)!==0)return A.lanes=T,A;if(T=B!==null,m=m!==null&&m.memoizedState!==null,T){B=A.child,F=null,B.alternate!==null&&B.alternate.memoizedState!==null&&B.alternate.memoizedState.cachePool!==null&&(F=B.alternate.memoizedState.cachePool.pool);var Q=null;B.memoizedState!==null&&B.memoizedState.cachePool!==null&&(Q=B.memoizedState.cachePool.pool),Q!==F&&(B.flags|=2048)}return T!==m&&T&&(A.child.flags|=8192),Kh(A,A.updateQueue),zi(A),null;case 4:return se(),Ud(m,A),m===null&&os(A.stateNode.containerInfo),zi(A),null;case 10:return Rl(A.type),zi(A),null;case 19:if(_(ws),F=A.memoizedState,F===null)return zi(A),null;if(B=(A.flags&128)!==0,Q=F.rendering,Q===null)if(B)Yh(F,!1);else{if(vi!==0||m!==null&&(m.flags&128)!==0)for(m=A.child;m!==null;){if(Q=mr(m),Q!==null){for(A.flags|=128,Yh(F,!1),m=Q.updateQueue,A.updateQueue=m,Kh(A,m),A.subtreeFlags=0,m=T,T=A.child;T!==null;)Yd(T,m),T=T.sibling;return b(ws,ws.current&1|2),A.child}m=m.sibling}F.tail!==null&&Fa()>_f&&(A.flags|=128,B=!0,Yh(F,!1),A.lanes=4194304)}else{if(!B)if(m=mr(Q),m!==null){if(A.flags|=128,B=!0,m=m.updateQueue,A.updateQueue=m,Kh(A,m),Yh(F,!0),F.tail===null&&F.tailMode==="hidden"&&!Q.alternate&&!Xn)return zi(A),null}else 2*Fa()-F.renderingStartTime>_f&&T!==536870912&&(A.flags|=128,B=!0,Yh(F,!1),A.lanes=4194304);F.isBackwards?(Q.sibling=A.child,A.child=Q):(m=F.last,m!==null?m.sibling=Q:A.child=Q,F.last=Q)}return F.tail!==null?(A=F.tail,F.rendering=A,F.tail=A.sibling,F.renderingStartTime=Fa(),A.sibling=null,m=ws.current,b(ws,B?m&1|2:m&1),A):(zi(A),null);case 22:case 23:return an(A),Zs(),B=A.memoizedState!==null,m!==null?m.memoizedState!==null!==B&&(A.flags|=8192):B&&(A.flags|=8192),B?(T&536870912)!==0&&(A.flags&128)===0&&(zi(A),A.subtreeFlags&6&&(A.flags|=8192)):zi(A),T=A.updateQueue,T!==null&&Kh(A,T.retryQueue),T=null,m!==null&&m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(T=m.memoizedState.cachePool.pool),B=null,A.memoizedState!==null&&A.memoizedState.cachePool!==null&&(B=A.memoizedState.cachePool.pool),B!==T&&(A.flags|=2048),m!==null&&_(tl),null;case 24:return T=null,m!==null&&(T=m.memoizedState.cache),A.memoizedState.cache!==T&&(A.flags|=2048),Rl(wi),zi(A),null;case 25:return null}throw Error(i(156,A.tag))}function CC(m,A){switch(Ee(A),A.tag){case 1:return m=A.flags,m&65536?(A.flags=m&-65537|128,A):null;case 3:return Rl(wi),se(),m=A.flags,(m&65536)!==0&&(m&128)===0?(A.flags=m&-65537|128,A):null;case 26:case 27:case 5:return ne(A),null;case 13:if(an(A),m=A.memoizedState,m!==null&&m.dehydrated!==null){if(A.alternate===null)throw Error(i(340));nt()}return m=A.flags,m&65536?(A.flags=m&-65537|128,A):null;case 19:return _(ws),null;case 4:return se(),null;case 10:return Rl(A.type),null;case 22:case 23:return an(A),Zs(),m!==null&&_(tl),m=A.flags,m&65536?(A.flags=m&-65537|128,A):null;case 24:return Rl(wi),null;case 25:return null;default:return null}}function tx(m,A){switch(Ee(A),A.tag){case 3:Rl(wi),se();break;case 26:case 27:case 5:ne(A);break;case 4:se();break;case 13:an(A);break;case 19:_(ws);break;case 10:Rl(A.type);break;case 22:case 23:an(A),Zs(),m!==null&&_(tl);break;case 24:Rl(wi)}}function kd(m,A){try{var T=A.updateQueue,B=T!==null?T.lastEffect:null;if(B!==null){var F=B.next;T=F;do{if((T.tag&m)===m){B=void 0;var Q=T.create,he=T.inst;B=Q(),he.destroy=B}T=T.next}while(T!==F)}}catch(Ie){si(A,A.return,Ie)}}function xc(m,A,T){try{var B=A.updateQueue,F=B!==null?B.lastEffect:null;if(F!==null){var Q=F.next;B=Q;do{if((B.tag&m)===m){var he=B.inst,Ie=he.destroy;if(Ie!==void 0){he.destroy=void 0,F=A;var Fe=T;try{Ie()}catch(lt){si(F,Fe,lt)}}}B=B.next}while(B!==Q)}}catch(lt){si(A,A.return,lt)}}function nx(m){var A=m.updateQueue;if(A!==null){var T=m.stateNode;try{Qe(A,T)}catch(B){si(m,m.return,B)}}}function Qr(m,A,T){T.props=Ml(m.type,m.memoizedProps),T.state=m.memoizedState;try{T.componentWillUnmount()}catch(B){si(m,A,B)}}function po(m,A){try{var T=m.ref;if(T!==null){var B=m.stateNode;switch(m.tag){case 26:case 27:case 5:var F=of(B);break;default:F=B}typeof T=="function"?m.refCleanup=T(F):T.current=F}}catch(Q){si(m,A,Q)}}function Vr(m,A){var T=m.ref,B=m.refCleanup;if(T!==null)if(typeof B=="function")try{B()}catch(F){si(m,A,F)}finally{m.refCleanup=null,m=m.alternate,m!=null&&(m.refCleanup=null)}else if(typeof T=="function")try{T(null)}catch(F){si(m,A,F)}else T.current=null}function M0(m){var A=m.type,T=m.memoizedProps,B=m.stateNode;try{RC(B,A,T,m)}catch(F){si(m,m.return,F)}}function w0(m,A,T){try{vx(m.stateNode,m.type,T,A,m)}catch(B){si(m,m.return,B)}}function R0(m){return m.tag===5||m.tag===3||(ha?m.tag===26:!1)||(gi?m.tag===27:!1)||m.tag===4}function Gd(m){e:for(;;){for(;m.sibling===null;){if(m.return===null||R0(m.return))return null;m=m.return}for(m.sibling.return=m.return,m=m.sibling;m.tag!==5&&m.tag!==6&&(!gi||m.tag!==27)&&m.tag!==18;){if(m.flags&2||m.child===null||m.tag===4)continue e;m.child.return=m,m=m.child}if(!(m.flags&2))return m.stateNode}}function B0(m,A,T){var B=m.tag;if(B===5||B===6)m=m.stateNode,A?xx(T,m,A):ey(T,m);else if(!(B===4||gi&&B===27)&&(m=m.child,m!==null))for(B0(m,A,T),m=m.sibling;m!==null;)B0(m,A,T),m=m.sibling}function Bl(m,A,T){var B=m.tag;if(B===5||B===6)m=m.stateNode,A?Ex(T,m,A):Ax(T,m);else if(!(B===4||gi&&B===27)&&(m=m.child,m!==null))for(Bl(m,A,T),m=m.sibling;m!==null;)Bl(m,A,T),m=m.sibling}function Om(m,A,T){m=m.containerInfo;try{hf(m,T)}catch(B){si(A,A.return,B)}}function Hd(m,A){for(Xm(m.containerInfo),vn=A;vn!==null;)if(m=vn,A=m.child,(m.subtreeFlags&1028)!==0&&A!==null)A.return=m,vn=A;else for(;vn!==null;){m=vn;var T=m.alternate;switch(A=m.flags,m.tag){case 0:break;case 11:case 15:break;case 1:if((A&1024)!==0&&T!==null){A=void 0;var B=m,F=T.memoizedProps;T=T.memoizedState;var Q=B.stateNode;try{var he=Ml(B.type,F,B.elementType===B.type);A=Q.getSnapshotBeforeUpdate(he,T),Q.__reactInternalSnapshotBeforeUpdate=A}catch(Ie){si(B,B.return,Ie)}}break;case 3:(A&1024)!==0&&Is&&Cx(m.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((A&1024)!==0)throw Error(i(163))}if(A=m.sibling,A!==null){A.return=m.return,vn=A;break}vn=m.return}return he=On,On=!1,he}function Pm(m,A,T){var B=T.flags;switch(T.tag){case 0:case 11:case 15:Ll(m,T),B&4&&kd(5,T);break;case 1:if(Ll(m,T),B&4)if(m=T.stateNode,A===null)try{m.componentDidMount()}catch(Ie){si(T,T.return,Ie)}else{var F=Ml(T.type,A.memoizedProps);A=A.memoizedState;try{m.componentDidUpdate(F,A,m.__reactInternalSnapshotBeforeUpdate)}catch(Ie){si(T,T.return,Ie)}}B&64&&nx(T),B&512&&po(T,T.return);break;case 3:if(Ll(m,T),B&64&&(B=T.updateQueue,B!==null)){if(m=null,T.child!==null)switch(T.child.tag){case 27:case 5:m=of(T.child.stateNode);break;case 1:m=T.child.stateNode}try{Qe(B,m)}catch(Ie){si(T,T.return,Ie)}}break;case 26:if(ha){Ll(m,T),B&512&&po(T,T.return);break}case 27:case 5:Ll(m,T),A===null&&B&4&&M0(T),B&512&&po(T,T.return);break;case 12:Ll(m,T);break;case 13:Ll(m,T),B&4&&Nm(m,T);break;case 22:if(F=T.memoizedState!==null||nl,!F){A=A!==null&&A.memoizedState!==null||ts;var Q=nl,he=ts;nl=F,(ts=A)&&!he?Ol(m,T,(T.subtreeFlags&8772)!==0):Ll(m,T),nl=Q,ts=he}B&512&&(T.memoizedProps.mode==="manual"?po(T,T.return):Vr(T,T.return));break;default:Ll(m,T)}}function D0(m){var A=m.alternate;A!==null&&(m.alternate=null,D0(A)),m.child=null,m.deletions=null,m.sibling=null,m.tag===5&&(A=m.stateNode,A!==null&&wC(A)),m.stateNode=null,m.return=null,m.dependencies=null,m.memoizedProps=null,m.memoizedState=null,m.pendingProps=null,m.stateNode=null,m.updateQueue=null}function nr(m,A,T){for(T=T.child;T!==null;)_c(m,A,T),T=T.sibling}function _c(m,A,T){if(Yr&&typeof Yr.onCommitFiberUnmount=="function")try{Yr.onCommitFiberUnmount(cs,T)}catch{}switch(T.tag){case 26:if(ha){ts||Vr(T,A),nr(m,A,T),T.memoizedState?Uu(T.memoizedState):T.stateNode&&ff(T.stateNode);break}case 27:if(gi){ts||Vr(T,A);var B=en,F=bn;en=T.stateNode,nr(m,A,T),Pc(T.stateNode),en=B,bn=F;break}case 5:ts||Vr(T,A);case 6:if(Is){if(B=en,F=bn,en=null,nr(m,A,T),en=B,bn=F,en!==null)if(bn)try{_x(en,T.stateNode)}catch(Q){si(T,A,Q)}else try{ty(en,T.stateNode)}catch(Q){si(T,A,Q)}}else nr(m,A,T);break;case 18:Is&&en!==null&&(bn?sp(en,T.stateNode):Nx(en,T.stateNode));break;case 4:Is?(B=en,F=bn,en=T.stateNode.containerInfo,bn=!0,nr(m,A,T),en=B,bn=F):(Na&&Om(T.stateNode,T,ip()),nr(m,A,T));break;case 0:case 11:case 14:case 15:ts||xc(2,T,A),ts||xc(4,T,A),nr(m,A,T);break;case 1:ts||(Vr(T,A),B=T.stateNode,typeof B.componentWillUnmount=="function"&&Qr(T,A,B)),nr(m,A,T);break;case 21:nr(m,A,T);break;case 22:ts||Vr(T,A),ts=(B=ts)||T.memoizedState!==null,nr(m,A,T),ts=B;break;default:nr(m,A,T)}}function Nm(m,A){if(rr&&A.memoizedState===null&&(m=A.alternate,m!==null&&(m=m.memoizedState,m!==null&&(m=m.dehydrated,m!==null))))try{OC(m)}catch(T){si(A,A.return,T)}}function ix(m){switch(m.tag){case 13:case 19:var A=m.stateNode;return A===null&&(A=m.stateNode=new ri),A;case 22:return m=m.stateNode,A=m._retryCache,A===null&&(A=m._retryCache=new ri),A;default:throw Error(i(435,m.tag))}}function Dl(m,A){var T=ix(m);A.forEach(function(B){var F=wc.bind(null,m,B);T.has(B)||(T.add(B),B.then(F,F))})}function Mr(m,A){var T=A.deletions;if(T!==null)for(var B=0;B<T.length;B++){var F=T[B],Q=m,he=A;if(Is){var Ie=he;e:for(;Ie!==null;){switch(Ie.tag){case 27:case 5:en=Ie.stateNode,bn=!1;break e;case 3:en=Ie.stateNode.containerInfo,bn=!0;break e;case 4:en=Ie.stateNode.containerInfo,bn=!0;break e}Ie=Ie.return}if(en===null)throw Error(i(160));_c(Q,he,F),en=null,bn=!1}else _c(Q,he,F);Q=F.alternate,Q!==null&&(Q.return=null),F.return=null}if(A.subtreeFlags&13878)for(A=A.child;A!==null;)L0(A,m),A=A.sibling}function L0(m,A){var T=m.alternate,B=m.flags;switch(m.tag){case 0:case 11:case 14:case 15:Mr(A,m),jr(m),B&4&&(xc(3,m,m.return),kd(3,m),xc(5,m,m.return));break;case 1:Mr(A,m),jr(m),B&512&&(ts||T===null||Vr(T,T.return)),B&64&&nl&&(m=m.updateQueue,m!==null&&(B=m.callbacks,B!==null&&(T=m.shared.hiddenCallbacks,m.shared.hiddenCallbacks=T===null?B:T.concat(B))));break;case 26:if(ha){var F=ji;Mr(A,m),jr(m),B&512&&(ts||T===null||Vr(T,T.return)),B&4&&(B=T!==null?T.memoizedState:null,A=m.memoizedState,T===null?A===null?m.stateNode===null?m.stateNode=ap(F,m.type,m.memoizedProps,m):op(F,m.type,m.stateNode):m.stateNode=Ux(F,A,m.memoizedProps):B!==A?(B===null?T.stateNode!==null&&ff(T.stateNode):Uu(B),A===null?op(F,m.type,m.stateNode):Ux(F,A,m.memoizedProps)):A===null&&m.stateNode!==null&&w0(m,m.memoizedProps,T.memoizedProps));break}case 27:if(gi&&B&4&&m.alternate===null){F=m.stateNode;var Q=m.memoizedProps;try{Oc(F),zx(m.type,Q,F,m)}catch(Ct){si(m,m.return,Ct)}}case 5:if(Mr(A,m),jr(m),B&512&&(ts||T===null||Vr(T,T.return)),Is){if(m.flags&32){A=m.stateNode;try{ny(A)}catch(Ct){si(m,m.return,Ct)}}B&4&&m.stateNode!=null&&(A=m.memoizedProps,w0(m,A,T!==null?T.memoizedProps:A)),B&1024&&(py=!0)}break;case 6:if(Mr(A,m),jr(m),B&4&&Is){if(m.stateNode===null)throw Error(i(162));B=m.memoizedProps,T=T!==null?T.memoizedProps:B,A=m.stateNode;try{yx(A,T,B)}catch(Ct){si(m,m.return,Ct)}}break;case 3:if(ha?(kx(),F=ji,ji=rg(A.containerInfo),Mr(A,m),ji=F):Mr(A,m),jr(m),B&4){if(Is&&rr&&T!==null&&T.memoizedState.isDehydrated)try{LC(A.containerInfo)}catch(Ct){si(m,m.return,Ct)}if(Na){B=A.containerInfo,T=A.pendingChildren;try{hf(B,T)}catch(Ct){si(m,m.return,Ct)}}}py&&(py=!1,sx(m));break;case 4:ha?(T=ji,ji=rg(m.stateNode.containerInfo),Mr(A,m),jr(m),ji=T):(Mr(A,m),jr(m)),B&4&&Na&&Om(m.stateNode,m,m.stateNode.pendingChildren);break;case 12:Mr(A,m),jr(m);break;case 13:Mr(A,m),jr(m),m.child.flags&8192&&m.memoizedState!==null!=(T!==null&&T.memoizedState!==null)&&(Or=Fa()),B&4&&(B=m.updateQueue,B!==null&&(m.updateQueue=null,Dl(m,B)));break;case 22:B&512&&(ts||T===null||Vr(T,T.return)),F=m.memoizedState!==null;var he=T!==null&&T.memoizedState!==null,Ie=nl,Fe=ts;if(nl=Ie||F,ts=Fe||he,Mr(A,m),ts=Fe,nl=Ie,jr(m),A=m.stateNode,A._current=m,A._visibility&=-3,A._visibility|=A._pendingVisibility&2,B&8192&&(A._visibility=F?A._visibility&-2:A._visibility|1,F&&(A=nl||ts,T===null||he||A||Xh(m)),Is&&(m.memoizedProps===null||m.memoizedProps.mode!=="manual"))){e:if(T=null,Is)for(A=m;;){if(A.tag===5||ha&&A.tag===26||gi&&A.tag===27){if(T===null){he=T=A;try{Q=he.stateNode,F?Sx(Q):Tx(he.stateNode,he.memoizedProps)}catch(Ct){si(he,he.return,Ct)}}}else if(A.tag===6){if(T===null){he=A;try{var lt=he.stateNode;F?bx(lt):BC(lt,he.memoizedProps)}catch(Ct){si(he,he.return,Ct)}}}else if((A.tag!==22&&A.tag!==23||A.memoizedState===null||A===m)&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===m)break e;for(;A.sibling===null;){if(A.return===null||A.return===m)break e;T===A&&(T=null),A=A.return}T===A&&(T=null),A.sibling.return=A.return,A=A.sibling}}B&4&&(B=m.updateQueue,B!==null&&(T=B.retryQueue,T!==null&&(B.retryQueue=null,Dl(m,T))));break;case 19:Mr(A,m),jr(m),B&4&&(B=m.updateQueue,B!==null&&(m.updateQueue=null,Dl(m,B)));break;case 21:break;default:Mr(A,m),jr(m)}}function jr(m){var A=m.flags;if(A&2){try{if(Is&&(!gi||m.tag!==27)){e:{for(var T=m.return;T!==null;){if(R0(T)){var B=T;break e}T=T.return}throw Error(i(160))}switch(B.tag){case 27:if(gi){var F=B.stateNode,Q=Gd(m);Bl(m,Q,F);break}case 5:var he=B.stateNode;B.flags&32&&(ny(he),B.flags&=-33);var Ie=Gd(m);Bl(m,Ie,he);break;case 3:case 4:var Fe=B.stateNode.containerInfo,lt=Gd(m);B0(m,lt,Fe);break;default:throw Error(i(161))}}}catch(Ct){si(m,m.return,Ct)}m.flags&=-3}A&4096&&(m.flags&=-4097)}function sx(m){if(m.subtreeFlags&1024)for(m=m.child;m!==null;){var A=m;sx(A),A.tag===5&&A.flags&1024&&Jm(A.stateNode),m=m.sibling}}function Ll(m,A){if(A.subtreeFlags&8772)for(A=A.child;A!==null;)Pm(m,A.alternate,A),A=A.sibling}function Xh(m){for(m=m.child;m!==null;){var A=m;switch(A.tag){case 0:case 11:case 14:case 15:xc(4,A,A.return),Xh(A);break;case 1:Vr(A,A.return);var T=A.stateNode;typeof T.componentWillUnmount=="function"&&Qr(A,A.return,T),Xh(A);break;case 26:case 27:case 5:Vr(A,A.return),Xh(A);break;case 22:Vr(A,A.return),A.memoizedState===null&&Xh(A);break;default:Xh(A)}m=m.sibling}}function Ol(m,A,T){for(T=T&&(A.subtreeFlags&8772)!==0,A=A.child;A!==null;){var B=A.alternate,F=m,Q=A,he=Q.flags;switch(Q.tag){case 0:case 11:case 15:Ol(F,Q,T),kd(4,Q);break;case 1:if(Ol(F,Q,T),B=Q,F=B.stateNode,typeof F.componentDidMount=="function")try{F.componentDidMount()}catch(lt){si(B,B.return,lt)}if(B=Q,F=B.updateQueue,F!==null){var Ie=B.stateNode;try{var Fe=F.shared.hiddenCallbacks;if(Fe!==null)for(F.shared.hiddenCallbacks=null,F=0;F<Fe.length;F++)Oe(Fe[F],Ie)}catch(lt){si(B,B.return,lt)}}T&&he&64&&nx(Q),po(Q,Q.return);break;case 26:case 27:case 5:Ol(F,Q,T),T&&B===null&&he&4&&M0(Q),po(Q,Q.return);break;case 12:Ol(F,Q,T);break;case 13:Ol(F,Q,T),T&&he&4&&Nm(F,Q);break;case 22:Q.memoizedState===null&&Ol(F,Q,T),po(Q,Q.return);break;default:Ol(F,Q,T)}A=A.sibling}}function Fm(m,A){var T=null;m!==null&&m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(T=m.memoizedState.cachePool.pool),m=null,A.memoizedState!==null&&A.memoizedState.cachePool!==null&&(m=A.memoizedState.cachePool.pool),m!==T&&(m!=null&&m.refCount++,T!=null&&Fd(T))}function zd(m,A){m=null,A.alternate!==null&&(m=A.alternate.memoizedState.cache),A=A.memoizedState.cache,A!==m&&(A.refCount++,m!=null&&Fd(m))}function Us(m,A,T,B){if(A.subtreeFlags&10256)for(A=A.child;A!==null;)O0(m,A,T,B),A=A.sibling}function O0(m,A,T,B){var F=A.flags;switch(A.tag){case 0:case 11:case 15:Us(m,A,T,B),F&2048&&kd(9,A);break;case 3:Us(m,A,T,B),F&2048&&(m=null,A.alternate!==null&&(m=A.alternate.memoizedState.cache),A=A.memoizedState.cache,A!==m&&(A.refCount++,m!=null&&Fd(m)));break;case 12:if(F&2048){Us(m,A,T,B),m=A.stateNode;try{var Q=A.memoizedProps,he=Q.id,Ie=Q.onPostCommit;typeof Ie=="function"&&Ie(he,A.alternate===null?"mount":"update",m.passiveEffectDuration,-0)}catch(Fe){si(A,A.return,Fe)}}else Us(m,A,T,B);break;case 23:break;case 22:Q=A.stateNode,A.memoizedState!==null?Q._visibility&4?Us(m,A,T,B):gr(m,A):Q._visibility&4?Us(m,A,T,B):(Q._visibility|=4,ir(m,A,T,B,(A.subtreeFlags&10256)!==0)),F&2048&&Fm(A.alternate,A);break;case 24:Us(m,A,T,B),F&2048&&zd(A.alternate,A);break;default:Us(m,A,T,B)}}function ir(m,A,T,B,F){for(F=F&&(A.subtreeFlags&10256)!==0,A=A.child;A!==null;){var Q=m,he=A,Ie=T,Fe=B,lt=he.flags;switch(he.tag){case 0:case 11:case 15:ir(Q,he,Ie,Fe,F),kd(8,he);break;case 23:break;case 22:var Ct=he.stateNode;he.memoizedState!==null?Ct._visibility&4?ir(Q,he,Ie,Fe,F):gr(Q,he):(Ct._visibility|=4,ir(Q,he,Ie,Fe,F)),F&&lt&2048&&Fm(he.alternate,he);break;case 24:ir(Q,he,Ie,Fe,F),F&&lt&2048&&zd(he.alternate,he);break;default:ir(Q,he,Ie,Fe,F)}A=A.sibling}}function gr(m,A){if(A.subtreeFlags&10256)for(A=A.child;A!==null;){var T=m,B=A,F=B.flags;switch(B.tag){case 22:gr(T,B),F&2048&&Fm(B.alternate,B);break;case 24:gr(T,B),F&2048&&zd(B.alternate,B);break;default:gr(T,B)}A=A.sibling}}function Ba(m){if(m.subtreeFlags&ya)for(m=m.child;m!==null;)Um(m),m=m.sibling}function Um(m){switch(m.tag){case 26:Ba(m),m.flags&ya&&(m.memoizedState!==null?Hx(ji,m.memoizedState,m.memoizedProps):Br(m.type,m.memoizedProps));break;case 5:Ba(m),m.flags&ya&&Br(m.type,m.memoizedProps);break;case 3:case 4:if(ha){var A=ji;ji=rg(m.stateNode.containerInfo),Ba(m),ji=A}else Ba(m);break;case 22:m.memoizedState===null&&(A=m.alternate,A!==null&&A.memoizedState!==null?(A=ya,ya=16777216,Ba(m),ya=A):Ba(m));break;default:Ba(m)}}function Qd(m){var A=m.alternate;if(A!==null&&(m=A.child,m!==null)){A.child=null;do A=m.sibling,m.sibling=null,m=A;while(m!==null)}}function Sc(m){var A=m.deletions;if((m.flags&16)!==0){if(A!==null)for(var T=0;T<A.length;T++){var B=A[T];vn=B,P0(B,m)}Qd(m)}if(m.subtreeFlags&10256)for(m=m.child;m!==null;)km(m),m=m.sibling}function km(m){switch(m.tag){case 0:case 11:case 15:Sc(m),m.flags&2048&&xc(9,m,m.return);break;case 3:Sc(m);break;case 12:Sc(m);break;case 22:var A=m.stateNode;m.memoizedState!==null&&A._visibility&4&&(m.return===null||m.return.tag!==13)?(A._visibility&=-5,Pl(m)):Sc(m);break;default:Sc(m)}}function Pl(m){var A=m.deletions;if((m.flags&16)!==0){if(A!==null)for(var T=0;T<A.length;T++){var B=A[T];vn=B,P0(B,m)}Qd(m)}for(m=m.child;m!==null;){switch(A=m,A.tag){case 0:case 11:case 15:xc(8,A,A.return),Pl(A);break;case 22:T=A.stateNode,T._visibility&4&&(T._visibility&=-5,Pl(A));break;default:Pl(A)}m=m.sibling}}function P0(m,A){for(;vn!==null;){var T=vn;switch(T.tag){case 0:case 11:case 15:xc(8,T,A);break;case 23:case 22:if(T.memoizedState!==null&&T.memoizedState.cachePool!==null){var B=T.memoizedState.cachePool.pool;B!=null&&B.refCount++}break;case 24:Fd(T.memoizedState.cache)}if(B=T.child,B!==null)B.return=T,vn=B;else e:for(T=m;vn!==null;){B=vn;var F=B.sibling,Q=B.return;if(D0(B),B===T){vn=null;break e}if(F!==null){F.return=Q,vn=F;break e}vn=Q}}}function Wh(m){var A=ux(m);if(A!=null){if(typeof A.memoizedProps["data-testname"]!="string")throw Error(i(364));return A}if(m=J0(m),m===null)throw Error(i(362));return m.stateNode.current}function bc(m,A){var T=m.tag;switch(A.$$typeof){case xf:if(m.type===A.value)return!0;break;case Ha:e:{for(A=A.value,m=[m,0],T=0;T<m.length;){var B=m[T++],F=B.tag,Q=m[T++],he=A[Q];if(F!==5&&F!==26&&F!==27||!cf(B)){for(;he!=null&&bc(B,he);)Q++,he=A[Q];if(Q===A.length){A=!0;break e}else for(B=B.child;B!==null;)m.push(B,Q),B=B.sibling}}A=!1}return A;case Pi:if((T===5||T===26||T===27)&&px(m.stateNode,A.value))return!0;break;case il:if((T===5||T===6||T===26||T===27)&&(m=dx(m),m!==null&&0<=m.indexOf(A.value)))return!0;break;case bo:if((T===5||T===26||T===27)&&(m=m.memoizedProps["data-testname"],typeof m=="string"&&m.toLowerCase()===A.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function N0(m){switch(m.$$typeof){case xf:return"<"+(a(m.value)||"Unknown")+">";case Ha:return":has("+(N0(m)||"")+")";case Pi:return'[role="'+m.value+'"]';case il:return'"'+m.value+'"';case bo:return'[data-testname="'+m.value+'"]';default:throw Error(i(365))}}function qr(m,A){var T=[];m=[m,0];for(var B=0;B<m.length;){var F=m[B++],Q=F.tag,he=m[B++],Ie=A[he];if(Q!==5&&Q!==26&&Q!==27||!cf(F)){for(;Ie!=null&&bc(F,Ie);)he++,Ie=A[he];if(he===A.length)T.push(F);else for(F=F.child;F!==null;)m.push(F,he),F=F.sibling}}return T}function Vd(m,A){if(!Lc)throw Error(i(363));m=Wh(m),m=qr(m,A),A=[],m=Array.from(m);for(var T=0;T<m.length;){var B=m[T++],F=B.tag;if(F===5||F===26||F===27)cf(B)||A.push(B.stateNode);else for(B=B.child;B!==null;)m.push(B),B=B.sibling}return A}function as(){if(($n&2)!==0&&kn!==0)return kn&-kn;if(fn.T!==null){var m=pa;return m!==0?m:rt()}return hx()}function F0(){xa===0&&(xa=(kn&536870912)===0||Xn?P():536870912);var m=ma.current;return m!==null&&(m.flags|=32),xa}function ks(m,A,T){(m===ai&&mi===2||m.cancelPendingCommit!==null)&&(sr(m,0),Kr(m,kn,xa,!1)),U(m,T),(($n&2)===0||m!==ai)&&(m===ai&&(($n&2)===0&&(Xl|=T),vi===4&&Kr(m,kn,xa,!1)),ue(m))}function Tc(m,A,T){if(($n&6)!==0)throw Error(i(327));var B=!T&&(A&60)===0&&(A&m.expiredLanes)===0||R(m,A),F=B?k0(m,A):Hm(m,A,!0),Q=B;do{if(F===0){va&&!B&&Kr(m,A,0,!1);break}else if(F===6)Kr(m,A,0,!Qa);else{if(T=m.current.alternate,Q&&!$h(T)){F=Hm(m,A,!1),Q=!1;continue}if(F===2){if(Q=A,m.errorRecoveryDisabledLanes&Q)var he=0;else he=m.pendingLanes&-536870913,he=he!==0?he:he&536870912?536870912:0;if(he!==0){A=he;e:{var Ie=m;F=Zu;var Fe=rr&&Ie.current.memoizedState.isDehydrated;if(Fe&&(sr(Ie,he).flags|=256),he=Hm(Ie,he,!1),he!==2){if(Rs&&!Fe){Ie.errorRecoveryDisabledLanes|=Q,Xl|=Q,F=4;break e}Q=ns,ns=F,Q!==null&&jd(Q)}F=he}if(Q=!1,F!==2)continue}}if(F===1){sr(m,0),Kr(m,A,0,!0);break}e:{switch(B=m,F){case 0:case 1:throw Error(i(345));case 4:if((A&4194176)===A){Kr(B,A,xa,!Qa);break e}break;case 2:ns=null;break;case 3:case 5:break;default:throw Error(i(329))}if(B.finishedWork=T,B.finishedLanes=A,(A&62914560)===A&&(Q=Or+300-Fa(),10<Q)){if(Kr(B,A,xa,!Qa),M(B,0)!==0)break e;B.timeoutHandle=vs(Gm.bind(null,B,T,ns,pp,gg,A,xa,Xl,sl,Qa,2,-0,0),Q);break e}Gm(B,T,ns,pp,gg,A,xa,Xl,sl,Qa,0,-0,0)}}break}while(!0);ue(m)}function jd(m){ns===null?ns=m:ns.push.apply(ns,m)}function Gm(m,A,T,B,F,Q,he,Ie,Fe,lt,Ct,Lt,kt){var En=A.subtreeFlags;if((En&8192||(En&16785408)===16785408)&&(W0(),Um(A),A=Es(),A!==null)){m.cancelPendingCommit=A(Ic.bind(null,m,T,B,F,he,Ie,Fe,1,Lt,kt)),Kr(m,Q,he,!lt);return}Ic(m,T,B,F,he,Ie,Fe,Ct,Lt,kt)}function $h(m){for(var A=m;;){var T=A.tag;if((T===0||T===11||T===15)&&A.flags&16384&&(T=A.updateQueue,T!==null&&(T=T.stores,T!==null)))for(var B=0;B<T.length;B++){var F=T[B],Q=F.getSnapshot;F=F.value;try{if(!Xr(Q(),F))return!1}catch{return!1}}if(T=A.child,A.subtreeFlags&16384&&T!==null)T.return=A,A=T;else{if(A===m)break;for(;A.sibling===null;){if(A.return===null||A.return===m)return!0;A=A.return}A.sibling.return=A.return,A=A.sibling}}return!0}function Kr(m,A,T,B){A&=~dp,A&=~Xl,m.suspendedLanes|=A,m.pingedLanes&=~A,B&&(m.warmLanes|=A),B=m.expirationTimes;for(var F=A;0<F;){var Q=31-Dr(F),he=1<<Q;B[Q]=-1,F&=~he}T!==0&&H(m,T,A)}function qd(){return($n&6)===0?($e(0),!1):!0}function Jh(){if(rn!==null){if(mi===0)var m=rn.return;else m=rn,Aa=So=null,J(m),kc=null,Gc=0,m=rn;for(;m!==null;)tx(m.alternate,m),m=m.return;rn=null}}function sr(m,A){m.finishedWork=null,m.finishedLanes=0;var T=m.timeoutHandle;T!==Bc&&(m.timeoutHandle=Bc,Wm(T)),T=m.cancelPendingCommit,T!==null&&(m.cancelPendingCommit=null,T()),Jh(),ai=m,rn=T=La(m.current,null),kn=A,mi=0,yr=null,Qa=!1,va=R(m,A),Rs=!1,sl=xa=dp=Xl=Ea=vi=0,ns=Zu=null,gg=!1,(A&8)!==0&&(A|=A&32);var B=m.entangledLanes;if(B!==0)for(m=m.entanglements,B&=A;0<B;){var F=31-Dr(B),Q=1<<F;A|=m[F],B&=~Q}return vr=A,ve(),T}function la(m,A){Mn=null,fn.H=es,A===Af?(A=zt(),mi=3):A===hp?(A=zt(),mi=4):mi=A===pg?8:A!==null&&typeof A=="object"&&typeof A.then=="function"?6:1,yr=A,rn===null&&(vi=1,Qh(m,X(A,m.current)))}function Cc(){var m=ma.current;return m===null?!0:(kn&4194176)===kn?Ai===null:(kn&62914560)===kn||(kn&536870912)!==0?m===Ai:!1}function jo(){var m=fn.H;return fn.H=es,m===null?es:m}function qo(){var m=fn.A;return fn.A=Ef,m}function Nl(){vi=4,Qa||(kn&4194176)!==kn&&ma.current!==null||(va=!0),(Ea&134217727)===0&&(Xl&134217727)===0||ai===null||Kr(ai,kn,xa,!1)}function Hm(m,A,T){var B=$n;$n|=2;var F=jo(),Q=qo();(ai!==m||kn!==A)&&(pp=null,sr(m,A)),A=!1;var he=vi;e:do try{if(mi!==0&&rn!==null){var Ie=rn,Fe=yr;switch(mi){case 8:Jh(),he=6;break e;case 3:case 2:case 6:ma.current===null&&(A=!0);var lt=mi;if(mi=0,yr=null,Da(m,Ie,Fe,lt),T&&va){he=0;break e}break;default:lt=mi,mi=0,yr=null,Da(m,Ie,Fe,lt)}}U0(),he=vi;break}catch(Ct){la(m,Ct)}while(!0);return A&&m.shellSuspendCounter++,Aa=So=null,$n=B,fn.H=F,fn.A=Q,rn===null&&(ai=null,kn=0,ve()),he}function U0(){for(;rn!==null;)Vi(rn)}function k0(m,A){var T=$n;$n|=2;var B=jo(),F=qo();ai!==m||kn!==A?(pp=null,_f=Fa()+500,sr(m,A)):va=R(m,A);e:do try{if(mi!==0&&rn!==null){A=rn;var Q=yr;t:switch(mi){case 1:mi=0,yr=null,Da(m,A,Q,1);break;case 2:if(Nt(Q)){mi=0,yr=null,ti(A);break}A=function(){mi===2&&ai===m&&(mi=7),ue(m)},Q.then(A,A);break e;case 3:mi=7;break e;case 4:mi=5;break e;case 7:Nt(Q)?(mi=0,yr=null,ti(A)):(mi=0,yr=null,Da(m,A,Q,7));break;case 5:var he=null;switch(rn.tag){case 26:he=rn.memoizedState;case 5:case 27:var Ie=rn,Fe=Ie.type,lt=Ie.pendingProps;if(he?ku(he):$m(Fe,lt)){mi=0,yr=null;var Ct=Ie.sibling;if(Ct!==null)rn=Ct;else{var Lt=Ie.return;Lt!==null?(rn=Lt,ca(Lt)):rn=null}break t}}mi=0,yr=null,Da(m,A,Q,5);break;case 6:mi=0,yr=null,Da(m,A,Q,6);break;case 8:Jh(),vi=6;break e;default:throw Error(i(462))}}wr();break}catch(kt){la(m,kt)}while(!0);return Aa=So=null,fn.H=B,fn.A=F,$n=T,rn!==null?0:(ai=null,kn=0,ve(),vi)}function wr(){for(;rn!==null&&!jx();)Vi(rn)}function Vi(m){var A=JE(m.alternate,m,vr);m.memoizedProps=m.pendingProps,A===null?ca(m):rn=A}function ti(m){var A=m,T=A.alternate;switch(A.tag){case 15:case 0:A=qE(T,A,A.pendingProps,A.type,void 0,kn);break;case 11:A=qE(T,A,A.pendingProps,A.type.render,A.ref,kn);break;case 5:J(A);default:tx(T,A),A=rn=Yd(A,vr),A=JE(T,A,vr)}m.memoizedProps=m.pendingProps,A===null?ca(m):rn=A}function Da(m,A,T,B){Aa=So=null,J(A),kc=null,Gc=0;var F=A.return;try{if(bC(m,F,A,T,kn)){vi=1,Qh(m,X(T,m.current)),rn=null;return}}catch(Q){if(F!==null)throw rn=F,Q;vi=1,Qh(m,X(T,m.current)),rn=null;return}A.flags&32768?(Xn||B===1?m=!0:va||(kn&536870912)!==0?m=!1:(Qa=m=!0,(B===2||B===3||B===6)&&(B=ma.current,B!==null&&B.tag===13&&(B.flags|=16384))),zm(A,m)):ca(A)}function ca(m){var A=m;do{if((A.flags&32768)!==0){zm(A,Qa);return}m=A.return;var T=ex(A.alternate,A,vr);if(T!==null){rn=T;return}if(A=A.sibling,A!==null){rn=A;return}rn=A=m}while(A!==null);vi===0&&(vi=5)}function zm(m,A){do{var T=CC(m.alternate,m);if(T!==null){T.flags&=32767,rn=T;return}if(T=m.return,T!==null&&(T.flags|=32768,T.subtreeFlags=0,T.deletions=null),!A&&(m=m.sibling,m!==null)){rn=m;return}rn=m=T}while(m!==null);vi=6,rn=null}function Ic(m,A,T,B,F,Q,he,Ie,Fe,lt){var Ct=fn.T,Lt=zl();try{Ar(2),fn.T=null,rx(m,A,T,B,Lt,F,Q,he,Ie,Fe,lt)}finally{fn.T=Ct,Ar(Lt)}}function rx(m,A,T,B,F,Q,he,Ie){do mo();while(rl!==null);if(($n&6)!==0)throw Error(i(327));var Fe=m.finishedWork;if(B=m.finishedLanes,Fe===null)return null;if(m.finishedWork=null,m.finishedLanes=0,Fe===m.current)throw Error(i(177));m.callbackNode=null,m.callbackPriority=0,m.cancelPendingCommit=null;var lt=Fe.lanes|Fe.childLanes;if(lt|=xo,j(m,B,lt,Q,he,Ie),m===ai&&(rn=ai=null,kn=0),(Fe.subtreeFlags&10256)===0&&(Fe.flags&10256)===0||To||(To=!0,jc=lt,Ag=T,Ul(ug,function(){return mo(),null})),T=(Fe.flags&15990)!==0,(Fe.subtreeFlags&15990)!==0||T?(T=fn.T,fn.T=null,Q=zl(),Ar(2),he=$n,$n|=4,Hd(m,Fe),L0(Fe,m),cx(m.containerInfo),m.current=Fe,Pm(m,Fe.alternate,Fe),lg(),$n=he,Ar(Q),fn.T=T):m.current=Fe,To?(To=!1,rl=m,eh=B):G0(m,lt),lt=m.pendingLanes,lt===0&&(Vc=null),k(Fe.stateNode),ue(m),A!==null)for(F=m.onRecoverableError,Fe=0;Fe<A.length;Fe++)lt=A[Fe],F(lt.value,{componentStack:lt.stack});return(eh&3)!==0&&mo(),lt=m.pendingLanes,(B&4194218)!==0&&(lt&42)!==0?m===yg?Sf++:(Sf=0,yg=m):Sf=0,$e(0),null}function G0(m,A){(m.pooledCacheLanes&=A)===0&&(A=m.pooledCache,A!=null&&(m.pooledCache=null,Fd(A)))}function mo(){if(rl!==null){var m=rl,A=jc;jc=0;var T=q(eh),B=32>T?32:T;T=fn.T;var F=zl();try{if(Ar(B),fn.T=null,rl===null)var Q=!1;else{B=Ag,Ag=null;var he=rl,Ie=eh;if(rl=null,eh=0,($n&6)!==0)throw Error(i(331));var Fe=$n;if($n|=4,km(he.current),O0(he,he.current,Ie,B),$n=Fe,$e(0,!1),Yr&&typeof Yr.onPostCommitFiberRoot=="function")try{Yr.onPostCommitFiberRoot(cs,he)}catch{}Q=!0}return Q}finally{Ar(F),fn.T=T,G0(m,A)}}return!1}function Zh(m,A,T){A=X(T,A),A=jh(m.stateNode,A,2),m=At(m,A,2),m!==null&&(U(m,2),ue(m))}function si(m,A,T){if(m.tag===3)Zh(m,m,T);else for(;A!==null;){if(A.tag===3){Zh(A,m,T);break}else if(A.tag===1){var B=A.stateNode;if(typeof A.type.getDerivedStateFromError=="function"||typeof B.componentDidCatch=="function"&&(Vc===null||!Vc.has(B))){m=X(T,m),T=v0(2),B=At(A,T,2),B!==null&&(HE(T,B,A,m),U(B,2),ue(B));break}}A=A.return}}function Nu(m,A,T){var B=m.pingCache;if(B===null){B=m.pingCache=new za;var F=new Set;B.set(A,F)}else F=B.get(A),F===void 0&&(F=new Set,B.set(A,F));F.has(T)||(Rs=!0,F.add(T),m=H0.bind(null,m,A,T),A.then(m,m))}function H0(m,A,T){var B=m.pingCache;B!==null&&B.delete(A),m.pingedLanes|=m.suspendedLanes&T,m.warmLanes&=~T,ai===m&&(kn&T)===T&&(vi===4||vi===3&&(kn&62914560)===kn&&300>Fa()-Or?($n&2)===0&&sr(m,0):dp|=T,sl===kn&&(sl=0)),ue(m)}function Mc(m,A){A===0&&(A=L()),m=be(m,A),m!==null&&(U(m,A),ue(m))}function Fl(m){var A=m.memoizedState,T=0;A!==null&&(T=A.retryLane),Mc(m,T)}function wc(m,A){var T=0;switch(m.tag){case 13:var B=m.stateNode,F=m.memoizedState;F!==null&&(T=F.retryLane);break;case 19:B=m.stateNode;break;case 22:B=m.stateNode._retryCache;break;default:throw Error(i(314))}B!==null&&B.delete(A),Mc(m,T)}function Ul(m,A){return lp(m,A)}function z0(m,A,T,B){this.tag=m,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=A,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=B,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kd(m){return m=m.prototype,!(!m||!m.isReactComponent)}function La(m,A){var T=m.alternate;return T===null?(T=t(m.tag,A,m.key,m.mode),T.elementType=m.elementType,T.type=m.type,T.stateNode=m.stateNode,T.alternate=m,m.alternate=T):(T.pendingProps=A,T.type=m.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=m.flags&31457280,T.childLanes=m.childLanes,T.lanes=m.lanes,T.child=m.child,T.memoizedProps=m.memoizedProps,T.memoizedState=m.memoizedState,T.updateQueue=m.updateQueue,A=m.dependencies,T.dependencies=A===null?null:{lanes:A.lanes,firstContext:A.firstContext},T.sibling=m.sibling,T.index=m.index,T.ref=m.ref,T.refCleanup=m.refCleanup,T}function Yd(m,A){m.flags&=31457282;var T=m.alternate;return T===null?(m.childLanes=0,m.lanes=A,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=T.childLanes,m.lanes=T.lanes,m.child=T.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=T.memoizedProps,m.memoizedState=T.memoizedState,m.updateQueue=T.updateQueue,m.type=T.type,A=T.dependencies,m.dependencies=A===null?null:{lanes:A.lanes,firstContext:A.firstContext}),m}function Ko(m,A,T,B,F,Q){var he=0;if(B=m,typeof m=="function")Kd(m)&&(he=1);else if(typeof m=="string")he=ha&&gi?rp(m,T,Ms.current)?26:Xo(m)?27:5:ha?rp(m,T,Ms.current)?26:5:gi&&Xo(m)?27:5;else e:switch(m){case Rc:return Zi(T.children,F,Q,A);case Jd:he=8,F|=24;break;case qm:return m=t(12,T,A,F|2),m.elementType=qm,m.lanes=Q,m;case Km:return m=t(13,T,A,F),m.elementType=Km,m.lanes=Q,m;case sf:return m=t(19,T,A,F),m.elementType=sf,m.lanes=Q,m;case j0:return Xd(T,F,Q,A);default:if(typeof m=="object"&&m!==null)switch(m.$$typeof){case Zd:case go:he=10;break e;case V0:he=9;break e;case ep:he=11;break e;case Ym:he=14;break e;case Pa:he=16,B=null;break e}he=29,T=Error(i(130,m===null?"null":typeof m,"")),B=null}return A=t(he,T,A,F),A.elementType=m,A.type=B,A.lanes=Q,A}function Zi(m,A,T,B){return m=t(7,m,B,A),m.lanes=T,m}function Xd(m,A,T,B){m=t(22,m,B,A),m.elementType=j0,m.lanes=T;var F={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var Q=F._current;if(Q===null)throw Error(i(456));if((F._pendingVisibility&2)===0){var he=be(Q,2);he!==null&&(F._pendingVisibility|=2,ks(he,Q,2))}},attach:function(){var Q=F._current;if(Q===null)throw Error(i(456));if((F._pendingVisibility&2)!==0){var he=be(Q,2);he!==null&&(F._pendingVisibility&=-3,ks(he,Q,2))}}};return m.stateNode=F,m}function Qm(m,A,T){return m=t(6,m,null,A),m.lanes=T,m}function Q0(m,A,T){return A=t(4,m.children!==null?m.children:[],m.key,A),A.lanes=T,A.stateNode={containerInfo:m.containerInfo,pendingChildren:null,implementation:m.implementation},A}function IC(m,A,T,B,F,Q,he,Ie){this.tag=1,this.containerInfo=m,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Bc,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=O(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=O(0),this.hiddenUpdates=O(null),this.identifierPrefix=B,this.onUncaughtError=F,this.onCaughtError=Q,this.onRecoverableError=he,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ie,this.incompleteTransitions=new Map}function ax(m,A,T,B,F,Q,he,Ie,Fe,lt,Ct,Lt){return m=new IC(m,A,T,he,Ie,Fe,lt,Lt),A=1,Q===!0&&(A|=24),Q=t(3,null,null,A),m.current=Q,Q.stateNode=m,A=Ec(),A.refCount++,m.pooledCache=A,A.refCount++,Q.memoizedState={element:B,isDehydrated:T,cache:A},Rt(Q),m}function ys(m){return m?(m=Nc,m):Nc}function Vm(m){var A=m._reactInternals;if(A===void 0)throw typeof m.render=="function"?Error(i(188)):(m=Object.keys(m).join(","),Error(i(268,m)));return m=g(A),m=m!==null?y(m):null,m===null?null:of(m.stateNode)}function ef(m,A,T,B,F,Q){F=ys(F),B.context===null?B.context=F:B.pendingContext=F,B=pt(A),B.payload={element:T},Q=Q===void 0?null:Q,Q!==null&&(B.callback=Q),T=At(m,B,A),T!==null&&(ks(T,m,A),Qt(T,m,A))}function tf(m,A){if(m=m.memoizedState,m!==null&&m.dehydrated!==null){var T=m.retryLane;m.retryLane=T!==0&&T<A?T:A}}function Wd(m,A){tf(m,A),(m=m.alternate)&&tf(m,A)}var _n={},nf=t0(),ua=aee(),jm=Object.assign,MC=Symbol.for("react.element"),$d=Symbol.for("react.transitional.element"),Oa=Symbol.for("react.portal"),Rc=Symbol.for("react.fragment"),Jd=Symbol.for("react.strict_mode"),qm=Symbol.for("react.profiler"),Zd=Symbol.for("react.provider"),V0=Symbol.for("react.consumer"),go=Symbol.for("react.context"),ep=Symbol.for("react.forward_ref"),Km=Symbol.for("react.suspense"),sf=Symbol.for("react.suspense_list"),Ym=Symbol.for("react.memo"),Pa=Symbol.for("react.lazy"),j0=Symbol.for("react.offscreen"),ox=Symbol.for("react.memo_cache_sentinel"),kl=Symbol.iterator,q0=Symbol.for("react.client.reference"),fn=nf.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Yo,Gl,Fu=!1,rf=Array.isArray,K0=e.rendererVersion,tp=e.rendererPackageName,af=e.extraDevToolsConfig,of=e.getPublicInstance,lx=e.getRootHostContext,lf=e.getChildHostContext,Xm=e.prepareForCommit,cx=e.resetAfterCommit,Y0=e.createInstance,np=e.appendInitialChild,Hl=e.finalizeInitialChildren,Sn=e.shouldSetTextContent,ci=e.createTextInstance,vs=e.scheduleTimeout,Wm=e.cancelTimeout,Bc=e.noTimeout,Rr=e.isPrimaryRenderer;e.warnsIfNotActing;var Is=e.supportsMutation,Na=e.supportsPersistence,rr=e.supportsHydration,ux=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var os=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var Ar=e.setCurrentUpdatePriority,zl=e.getCurrentUpdatePriority,hx=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var fx=e.shouldAttemptEagerTransition,wC=e.detachDeletedInstance;e.requestPostPaintCallback;var X0=e.maySuspendCommit,$m=e.preloadInstance,W0=e.startSuspendingCommit,Br=e.suspendInstance,Es=e.waitForCommitToBeReady,Dc=e.NotPendingTransition,Ao=e.HostTransitionContext,Jm=e.resetFormInstance;e.bindToConsole;var $0=e.supportsMicrotasks,Ql=e.scheduleMicrotask,Lc=e.supportsTestSelectors,J0=e.findFiberRoot,Z0=e.getBoundingRect,dx=e.getTextContent,cf=e.isHiddenSubtree,px=e.matchAccessibilityRole,mx=e.setFocusIfFocusable,gx=e.setupIntersectionObserver,Ax=e.appendChild,ey=e.appendChildToContainer,yx=e.commitTextUpdate,RC=e.commitMount,vx=e.commitUpdate,Ex=e.insertBefore,xx=e.insertInContainerBefore,ty=e.removeChild,_x=e.removeChildFromContainer,ny=e.resetTextContent,Sx=e.hideInstance,bx=e.hideTextInstance,Tx=e.unhideInstance,BC=e.unhideTextInstance,Cx=e.clearContainer,uf=e.cloneInstance,ip=e.createContainerChildSet,iy=e.appendChildToContainerChildSet,Zm=e.finalizeContainerChildren,hf=e.replaceContainerChildren,sy=e.cloneHiddenInstance,ry=e.cloneHiddenTextInstance,eg=e.isSuspenseInstancePending,tg=e.isSuspenseInstanceFallback,Ix=e.getSuspenseInstanceFallbackErrorDetails,Mx=e.registerSuspenseInstanceRetry,ay=e.canHydrateFormStateMarker,wx=e.isFormStateMarkerMatching,oy=e.getNextHydratableSibling,ng=e.getFirstHydratableChild,Rx=e.getFirstHydratableChildWithinContainer,Bx=e.getFirstHydratableChildWithinSuspenseInstance,DC=e.canHydrateInstance,ly=e.canHydrateTextInstance,Dx=e.canHydrateSuspenseInstance,Lx=e.hydrateInstance,cy=e.hydrateTextInstance,Ox=e.hydrateSuspenseInstance,Px=e.getNextHydratableInstanceAfterSuspenseInstance,LC=e.commitHydratedContainer,OC=e.commitHydratedSuspenseInstance,Nx=e.clearSuspenseBoundary,sp=e.clearSuspenseBoundaryFromContainer,ig=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var sg=e.validateHydratableInstance,Fx=e.validateHydratableTextInstance,ha=e.supportsResources,rp=e.isHostHoistableType,rg=e.getHoistableRoot,uy=e.getResource,Ux=e.acquireResource,Uu=e.releaseResource,ap=e.hydrateHoistable,op=e.mountHoistable,ff=e.unmountHoistable,ag=e.createHoistableInstance,kx=e.prepareToCommitHoistables,Gx=e.mayResourceSuspendCommit,ku=e.preloadResource,Hx=e.suspendResource,gi=e.supportsSingletons,yo=e.resolveSingletonInstance,Oc=e.clearSingleton,zx=e.acquireSingletonInstance,Pc=e.releaseSingletonInstance,Xo=e.isHostSingletonType,ls=[],Vl=-1,Nc={},Dr=Math.clz32?Math.clz32:C,Qx=Math.log,Vx=Math.LN2,Wo=128,Gu=4194304,lp=ua.unstable_scheduleCallback,og=ua.unstable_cancelCallback,jx=ua.unstable_shouldYield,lg=ua.unstable_requestPaint,Fa=ua.unstable_now,cg=ua.unstable_ImmediatePriority,qx=ua.unstable_UserBlockingPriority,ug=ua.unstable_NormalPriority,PC=ua.unstable_IdlePriority,Kx=ua.log,Gs=ua.unstable_setDisableYieldValue,cs=null,Yr=null,Xr=typeof Object.is=="function"?Object.is:V,hy=new WeakMap,Hu=[],zu=0,Qu=null,df=0,fa=[],da=0,Fc=null,vo=1,Eo="",Ms=E(null),pf=E(null),$o=E(null),Vu=E(null),ar=null,or=null,Xn=!1,Ua=null,Hs=!1,cp=Error(i(519)),ka=[],ju=0,xo=0,up=null,jl=null,qu=!1,Ii=!1,fy=!1,mf=0,gf=null,Ku=0,pa=0,Yu=null,ql=!1,Xu=!1,Jo=Object.prototype.hasOwnProperty,Af=Error(i(460)),hp=Error(i(474)),fp={then:function(){}},Uc=null,kc=null,Gc=0,Hc=$i(!0),Zo=$i(!1),Mi=E(null),yf=E(0),ma=E(null),Ai=null,ws=E(0),Kl=0,Mn=null,sn=null,Wn=null,Ga=!1,Wu=!1,zc=!1,hg=0,$u=0,zs=null,_o=0,fg=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},es={readContext:tr,use:xe,useCallback:pi,useContext:pi,useEffect:pi,useImperativeHandle:pi,useLayoutEffect:pi,useInsertionEffect:pi,useMemo:pi,useReducer:pi,useRef:pi,useState:pi,useDebugValue:pi,useDeferredValue:pi,useTransition:pi,useSyncExternalStore:pi,useId:pi};es.useCacheRefresh=pi,es.useMemoCache=pi,es.useHostTransitionStatus=pi,es.useFormState=pi,es.useActionState=pi,es.useOptimistic=pi;var Qc={readContext:tr,use:xe,useCallback:function(m,A){return ye().memoizedState=[m,A===void 0?null:A],m},useContext:tr,useEffect:Sm,useImperativeHandle:function(m,A,T){T=T!=null?T.concat([m]):null,Td(4194308,4,bm.bind(null,A,m),T)},useLayoutEffect:function(m,A){return Td(4194308,4,m,A)},useInsertionEffect:function(m,A){Td(4,2,m,A)},useMemo:function(m,A){var T=ye();A=A===void 0?null:A;var B=m();if(zc){W(!0);try{m()}finally{W(!1)}}return T.memoizedState=[B,A],B},useReducer:function(m,A,T){var B=ye();if(T!==void 0){var F=T(A);if(zc){W(!0);try{T(A)}finally{W(!1)}}}else F=A;return B.memoizedState=B.baseState=F,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:F},B.queue=m,m=m.dispatch=Cm.bind(null,Mn,m),[B.memoizedState,m]},useRef:function(m){var A=ye();return m={current:m},A.memoizedState=m},useState:function(m){m=Ht(m);var A=m.queue,T=y0.bind(null,Mn,A);return A.dispatch=T,[m.memoizedState,T]},useDebugValue:mc,useDeferredValue:function(m,A){var T=ye();return Md(T,m,A)},useTransition:function(){var m=Ht(!1);return m=Uh.bind(null,Mn,m.queue,!0,!1),ye().memoizedState=m,[!1,m]},useSyncExternalStore:function(m,A,T){var B=Mn,F=ye();if(Xn){if(T===void 0)throw Error(i(407));T=T()}else{if(T=A(),ai===null)throw Error(i(349));(kn&60)!==0||It(B,A,T)}F.memoizedState=T;var Q={value:T,getSnapshot:A};return F.queue=Q,Sm(on.bind(null,B,Q,m),[m]),B.flags|=2048,Cs(9,Kt.bind(null,B,Q,T,A),{destroy:void 0},null),T},useId:function(){var m=ye(),A=ai.identifierPrefix;if(Xn){var T=Eo,B=vo;T=(B&~(1<<32-Dr(B)-1)).toString(32)+T,A=":"+A+"R"+T,T=hg++,0<T&&(A+="H"+T.toString(32)),A+=":"}else T=_o++,A=":"+A+"r"+T.toString(32)+":";return m.memoizedState=A},useCacheRefresh:function(){return ye().memoizedState=A0.bind(null,Mn)}};Qc.useMemoCache=ht,Qc.useHostTransitionStatus=wd,Qc.useFormState=li,Qc.useActionState=li,Qc.useOptimistic=function(m){var A=ye();A.memoizedState=A.baseState=m;var T={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return A.queue=T,A=Gh.bind(null,Mn,!0,T),T.dispatch=A,[m,A]};var Lr={readContext:tr,use:xe,useCallback:Lu,useContext:tr,useEffect:p0,useImperativeHandle:Tm,useInsertionEffect:kE,useLayoutEffect:Id,useMemo:m0,useReducer:at,useRef:UE,useState:function(){return at(tt)},useDebugValue:mc,useDeferredValue:function(m,A){var T=_e();return g0(T,sn.memoizedState,m,A)},useTransition:function(){var m=at(tt)[0],A=_e().memoizedState;return[typeof m=="boolean"?m:Me(m),A]},useSyncExternalStore:wt,useId:kh};Lr.useCacheRefresh=Il,Lr.useMemoCache=ht,Lr.useHostTransitionStatus=wd,Lr.useFormState=Oi,Lr.useActionState=Oi,Lr.useOptimistic=function(m,A){var T=_e();return Dt(T,sn,m,A)};var ga={readContext:tr,use:xe,useCallback:Lu,useContext:tr,useEffect:p0,useImperativeHandle:Tm,useInsertionEffect:kE,useLayoutEffect:Id,useMemo:m0,useReducer:_t,useRef:UE,useState:function(){return _t(tt)},useDebugValue:mc,useDeferredValue:function(m,A){var T=_e();return sn===null?Md(T,m,A):g0(T,sn.memoizedState,m,A)},useTransition:function(){var m=_t(tt)[0],A=_e().memoizedState;return[typeof m=="boolean"?m:Me(m),A]},useSyncExternalStore:wt,useId:kh};ga.useCacheRefresh=Il,ga.useMemoCache=ht,ga.useHostTransitionStatus=wd,ga.useFormState=Du,ga.useActionState=Du,ga.useOptimistic=function(m,A){var T=_e();return sn!==null?Dt(T,sn,m,A):(T.baseState=m,[m,T.queue.dispatch])};var el={isMounted:function(m){return(m=m._reactInternals)?f(m)===m:!1},enqueueSetState:function(m,A,T){m=m._reactInternals;var B=as(),F=pt(B);F.payload=A,T!=null&&(F.callback=T),A=At(m,F,B),A!==null&&(ks(A,m,B),Qt(A,m,B))},enqueueReplaceState:function(m,A,T){m=m._reactInternals;var B=as(),F=pt(B);F.tag=1,F.payload=A,T!=null&&(F.callback=T),A=At(m,F,B),A!==null&&(ks(A,m,B),Qt(A,m,B))},enqueueForceUpdate:function(m,A){m=m._reactInternals;var T=as(),B=pt(T);B.tag=2,A!=null&&(B.callback=A),A=At(m,B,T),A!==null&&(ks(A,m,T),Qt(A,m,T))}},dg=typeof reportError=="function"?reportError:function(m){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var A=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof m=="object"&&m!==null&&typeof m.message=="string"?String(m.message):String(m),error:m});if(!window.dispatchEvent(A))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",m);return}console.error(m)},pg=Error(i(461)),yi=!1,mg={dehydrated:null,treeContext:null,retryLane:0},Yl=E(null),So=null,Aa=null,vf=typeof AbortController<"u"?AbortController:function(){var m=[],A=this.signal={aborted:!1,addEventListener:function(T,B){m.push(B)}};this.abort=function(){A.aborted=!0,m.forEach(function(T){return T()})}},Yx=ua.unstable_scheduleCallback,Xx=ua.unstable_NormalPriority,wi={$$typeof:go,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},dy=fn.S;fn.S=function(m,A){typeof A=="object"&&A!==null&&typeof A.then=="function"&&et(m,A),dy!==null&&dy(m,A)};var tl=E(null),nl=!1,ts=!1,py=!1,ri=typeof WeakSet=="function"?WeakSet:Set,vn=null,On=!1,en=null,bn=!1,ji=null,ya=8192,Ef={getCacheForType:function(m){var A=tr(wi),T=A.data.get(m);return T===void 0&&(T=m(),A.data.set(m,T)),T}},xf=0,Ha=1,Pi=2,bo=3,il=4;if(typeof Symbol=="function"&&Symbol.for){var Ju=Symbol.for;xf=Ju("selector.component"),Ha=Ju("selector.has_pseudo_class"),Pi=Ju("selector.role"),bo=Ju("selector.test_id"),il=Ju("selector.text")}var za=typeof WeakMap=="function"?WeakMap:Map,$n=0,ai=null,rn=null,kn=0,mi=0,yr=null,Qa=!1,va=!1,Rs=!1,vr=0,vi=0,Ea=0,Xl=0,dp=0,xa=0,sl=0,Zu=null,ns=null,gg=!1,Or=0,_f=1/0,pp=null,Vc=null,To=!1,rl=null,eh=0,jc=0,Ag=null,Sf=0,yg=null;return _n.attemptContinuousHydration=function(m){if(m.tag===13){var A=be(m,67108864);A!==null&&ks(A,m,67108864),Wd(m,67108864)}},_n.attemptHydrationAtCurrentPriority=function(m){if(m.tag===13){var A=as(),T=be(m,A);T!==null&&ks(T,m,A),Wd(m,A)}},_n.attemptSynchronousHydration=function(m){switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var A=I(m.pendingLanes);if(A!==0){for(m.pendingLanes|=2,m.entangledLanes|=2;A;){var T=1<<31-Dr(A);m.entanglements[1]|=T,A&=~T}ue(m),($n&6)===0&&(_f=Fa()+500,$e(0))}}break;case 13:A=be(m,2),A!==null&&ks(A,m,2),qd(),Wd(m,2)}},_n.batchedUpdates=function(m,A){return m(A)},_n.createComponentSelector=function(m){return{$$typeof:xf,value:m}},_n.createContainer=function(m,A,T,B,F,Q,he,Ie,Fe,lt){return ax(m,A,!1,null,T,B,Q,he,Ie,Fe,lt,null)},_n.createHasPseudoClassSelector=function(m){return{$$typeof:Ha,value:m}},_n.createHydrationContainer=function(m,A,T,B,F,Q,he,Ie,Fe,lt,Ct,Lt,kt){return m=ax(T,B,!0,m,F,Q,Ie,Fe,lt,Ct,Lt,kt),m.context=ys(null),T=m.current,B=as(),F=pt(B),F.callback=A??null,At(T,F,B),m.current.lanes=B,U(m,B),ue(m),m},_n.createPortal=function(m,A,T){var B=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Oa,key:B==null?null:""+B,children:m,containerInfo:A,implementation:T}},_n.createRoleSelector=function(m){return{$$typeof:Pi,value:m}},_n.createTestNameSelector=function(m){return{$$typeof:bo,value:m}},_n.createTextSelector=function(m){return{$$typeof:il,value:m}},_n.defaultOnCaughtError=function(m){console.error(m)},_n.defaultOnRecoverableError=function(m){dg(m)},_n.defaultOnUncaughtError=function(m){dg(m)},_n.deferredUpdates=function(m){var A=fn.T,T=zl();try{return Ar(32),fn.T=null,m()}finally{Ar(T),fn.T=A}},_n.discreteUpdates=function(m,A,T,B,F){var Q=fn.T,he=zl();try{return Ar(2),fn.T=null,m(A,T,B,F)}finally{Ar(he),fn.T=Q,$n===0&&(_f=Fa()+500)}},_n.findAllNodes=Vd,_n.findBoundingRects=function(m,A){if(!Lc)throw Error(i(363));A=Vd(m,A),m=[];for(var T=0;T<A.length;T++)m.push(Z0(A[T]));for(A=m.length-1;0<A;A--){T=m[A];for(var B=T.x,F=B+T.width,Q=T.y,he=Q+T.height,Ie=A-1;0<=Ie;Ie--)if(A!==Ie){var Fe=m[Ie],lt=Fe.x,Ct=lt+Fe.width,Lt=Fe.y,kt=Lt+Fe.height;if(B>=lt&&Q>=Lt&&F<=Ct&&he<=kt){m.splice(A,1);break}else if(B!==lt||T.width!==Fe.width||kt<Q||Lt>he){if(!(Q!==Lt||T.height!==Fe.height||Ct<B||lt>F)){lt>B&&(Fe.width+=lt-B,Fe.x=B),Ct<F&&(Fe.width=F-lt),m.splice(A,1);break}}else{Lt>Q&&(Fe.height+=Lt-Q,Fe.y=Q),kt<he&&(Fe.height=he-Lt),m.splice(A,1);break}}}return m},_n.findHostInstance=Vm,_n.findHostInstanceWithNoPortals=function(m){return m=g(m),m=m!==null?x(m):null,m===null?null:of(m.stateNode)},_n.findHostInstanceWithWarning=function(m){return Vm(m)},_n.flushPassiveEffects=mo,_n.flushSyncFromReconciler=function(m){var A=$n;$n|=1;var T=fn.T,B=zl();try{if(Ar(2),fn.T=null,m)return m()}finally{Ar(B),fn.T=T,$n=A,($n&6)===0&&$e(0)}},_n.flushSyncWork=qd,_n.focusWithin=function(m,A){if(!Lc)throw Error(i(363));for(m=Wh(m),A=qr(m,A),A=Array.from(A),m=0;m<A.length;){var T=A[m++],B=T.tag;if(!cf(T)){if((B===5||B===26||B===27)&&mx(T.stateNode))return!0;for(T=T.child;T!==null;)A.push(T),T=T.sibling}}return!1},_n.getFindAllNodesFailureDescription=function(m,A){if(!Lc)throw Error(i(363));var T=0,B=[];m=[Wh(m),0];for(var F=0;F<m.length;){var Q=m[F++],he=Q.tag,Ie=m[F++],Fe=A[Ie];if((he!==5&&he!==26&&he!==27||!cf(Q))&&(bc(Q,Fe)&&(B.push(N0(Fe)),Ie++,Ie>T&&(T=Ie)),Ie<A.length))for(Q=Q.child;Q!==null;)m.push(Q,Ie),Q=Q.sibling}if(T<A.length){for(m=[];T<A.length;T++)m.push(N0(A[T]));return`findAllNodes was able to match part of the selector:
  `+(B.join(" > ")+`

No matching component was found for:
  `)+m.join(" > ")}return null},_n.getPublicRootInstance=function(m){if(m=m.current,!m.child)return null;switch(m.child.tag){case 27:case 5:return of(m.child.stateNode);default:return m.child.stateNode}},_n.injectIntoDevTools=function(){var m={bundleType:0,version:K0,rendererPackageName:tp,currentDispatcherRef:fn,findFiberByHostInstance:ux,reconcilerVersion:"19.0.0"};if(af!==null&&(m.rendererConfig=af),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")m=!1;else{var A=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(A.isDisabled||!A.supportsFiber)m=!0;else{try{cs=A.inject(m),Yr=A}catch{}m=!!A.checkDCE}}return m},_n.isAlreadyRendering=function(){return!1},_n.observeVisibleRects=function(m,A,T,B){if(!Lc)throw Error(i(363));m=Vd(m,A);var F=gx(m,T,B).disconnect;return{disconnect:function(){F()}}},_n.shouldError=function(){return null},_n.shouldSuspend=function(){return!1},_n.startHostTransition=function(m,A,T,B){if(m.tag!==5)throw Error(i(476));var F=Vo(m).queue;Uh(m,F,A,Dc,T===null?n:function(){var Q=Vo(m).next.queue;return gc(m,Q,{},as()),T(B)})},_n.updateContainer=function(m,A,T,B){var F=A.current,Q=as();return ef(F,Q,m,A,T,B),Q},_n.updateContainerSync=function(m,A,T,B){return A.tag===0&&mo(),ef(A.current,2,m,A,T,B),2},_n},s.exports.default=s.exports,Object.defineProperty(s.exports,"__esModule",{value:!0})})(OI)),OI.exports}var DP;function lee(){return DP||(DP=1,LI.exports=oee()),LI.exports}var cee=lee();const uee=IR(cee);var FI={exports:{}},UI={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LP;function hee(){return LP||(LP=1,(function(s){function e(k,W){var V=k.length;k.push(W);e:for(;0<V;){var X=V-1>>>1,K=k[X];if(0<i(K,W))k[X]=W,k[V]=K,V=X;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var W=k[0],V=k.pop();if(V!==W){k[0]=V;e:for(var X=0,K=k.length,te=K>>>1;X<te;){var oe=2*(X+1)-1,Ee=k[oe],Ce=oe+1,se=k[Ce];if(0>i(Ee,V))Ce<K&&0>i(se,Ee)?(k[X]=se,k[Ce]=V,X=Ce):(k[X]=Ee,k[oe]=V,X=oe);else if(Ce<K&&0>i(se,V))k[X]=se,k[Ce]=V,X=Ce;else break e}}return W}function i(k,W){var V=k.sortIndex-W.sortIndex;return V!==0?V:k.id-W.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;s.unstable_now=function(){return r.now()}}else{var a=Date,o=a.now();s.unstable_now=function(){return a.now()-o}}var l=[],c=[],h=1,f=null,p=3,g=!1,y=!1,x=!1,E=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function C(k){for(var W=t(c);W!==null;){if(W.callback===null)n(c);else if(W.startTime<=k)n(c),W.sortIndex=W.expirationTime,e(l,W);else break;W=t(c)}}function I(k){if(x=!1,C(k),!y)if(t(l)!==null)y=!0,z();else{var W=t(c);W!==null&&q(I,W.startTime-k)}}var M=!1,R=-1,D=5,P=-1;function L(){return!(s.unstable_now()-P<D)}function O(){if(M){var k=s.unstable_now();P=k;var W=!0;try{e:{y=!1,x&&(x=!1,_(R),R=-1),g=!0;var V=p;try{t:{for(C(k),f=t(l);f!==null&&!(f.expirationTime>k&&L());){var X=f.callback;if(typeof X=="function"){f.callback=null,p=f.priorityLevel;var K=X(f.expirationTime<=k);if(k=s.unstable_now(),typeof K=="function"){f.callback=K,C(k),W=!0;break t}f===t(l)&&n(l),C(k)}else n(l);f=t(l)}if(f!==null)W=!0;else{var te=t(c);te!==null&&q(I,te.startTime-k),W=!1}}break e}finally{f=null,p=V,g=!1}W=void 0}}finally{W?U():M=!1}}}var U;if(typeof b=="function")U=function(){b(O)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,H=j.port2;j.port1.onmessage=O,U=function(){H.postMessage(null)}}else U=function(){E(O,0)};function z(){M||(M=!0,U())}function q(k,W){R=E(function(){k(s.unstable_now())},W)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(k){k.callback=null},s.unstable_continueExecution=function(){y||g||(y=!0,z())},s.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<k?Math.floor(1e3/k):5},s.unstable_getCurrentPriorityLevel=function(){return p},s.unstable_getFirstCallbackNode=function(){return t(l)},s.unstable_next=function(k){switch(p){case 1:case 2:case 3:var W=3;break;default:W=p}var V=p;p=W;try{return k()}finally{p=V}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(k,W){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var V=p;p=k;try{return W()}finally{p=V}},s.unstable_scheduleCallback=function(k,W,V){var X=s.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?X+V:X):V=X,k){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=V+K,k={id:h++,callback:W,priorityLevel:k,startTime:V,expirationTime:K,sortIndex:-1},V>X?(k.sortIndex=V,e(c,k),t(l)===null&&k===t(c)&&(x?(_(R),R=-1):x=!0,q(I,V-X))):(k.sortIndex=K,e(l,k),y||g||(y=!0,z())),k},s.unstable_shouldYield=L,s.unstable_wrapCallback=function(k){var W=p;return function(){var V=p;p=W;try{return k.apply(this,arguments)}finally{p=V}}}})(UI)),UI}var OP;function fee(){return OP||(OP=1,FI.exports=hee()),FI.exports}var PP=fee();function KB(s,e,t){if(!s)return;if(t(s)===!0)return s;let n=e?s.return:s.child;for(;n;){const i=KB(n,e,t);if(i)return i;n=e?null:n.sibling}}function RG(s){try{return Object.defineProperties(s,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return s}}const YB=RG(ee.createContext(null));class BG extends ee.Component{render(){return ee.createElement(YB.Provider,{value:this._reactInternals},this.props.children)}}function DG(){const s=ee.useContext(YB);if(s===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=ee.useId();return ee.useMemo(()=>{for(const t of[s,s?.alternate]){if(!t)continue;const n=KB(t,!1,i=>{let r=i.memoizedState;for(;r;){if(r.memoizedState===e)return!0;r=r.next}});if(n)return n}},[s,e])}const dee=Symbol.for("react.context"),pee=s=>s!==null&&typeof s=="object"&&"$$typeof"in s&&s.$$typeof===dee;function mee(){const s=DG(),[e]=ee.useState(()=>new Map);e.clear();let t=s;for(;t;){const n=t.type;pee(n)&&n!==YB&&!e.has(n)&&e.set(n,ee.use(RG(n))),t=t.return}return e}function gee(){const s=mee();return ee.useMemo(()=>Array.from(s.keys()).reduce((e,t)=>n=>ee.createElement(e,null,ee.createElement(t.Provider,{...n,value:s.get(t)})),e=>ee.createElement(BG,{...e})),[s])}function LG(s){let e=s.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const OG=s=>s&&s.isOrthographicCamera,Aee=s=>s&&s.hasOwnProperty("current"),yee=s=>s!=null&&(typeof s=="string"||typeof s=="number"||s.isColor),CE=((s,e)=>typeof window<"u"&&(((s=window.document)==null?void 0:s.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?ee.useLayoutEffect:ee.useEffect;function PG(s){const e=ee.useRef(s);return CE(()=>void(e.current=s),[s]),e}function vee(){const s=DG(),e=gee();return ee.useMemo(()=>({children:t})=>{const i=!!KB(s,!0,r=>r.type===ee.StrictMode)?ee.StrictMode:ee.Fragment;return G.jsx(i,{children:G.jsx(e,{children:t})})},[s,e])}function Eee({set:s}){return CE(()=>(s(new Promise(()=>null)),()=>s(!1)),[s]),null}const xee=(s=>(s=class extends ee.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}},s.getDerivedStateFromError=()=>({error:!0}),s))();function NG(s){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(s)?Math.min(Math.max(s[0],t),s[1]):s}function Xg(s){var e;return(e=s.__r3f)==null?void 0:e.root.getState()}const fs={obj:s=>s===Object(s)&&!fs.arr(s)&&typeof s!="function",fun:s=>typeof s=="function",str:s=>typeof s=="string",num:s=>typeof s=="number",boo:s=>typeof s=="boolean",und:s=>s===void 0,nul:s=>s===null,arr:s=>Array.isArray(s),equ(s,e,{arrays:t="shallow",objects:n="reference",strict:i=!0}={}){if(typeof s!=typeof e||!!s!=!!e)return!1;if(fs.str(s)||fs.num(s)||fs.boo(s))return s===e;const r=fs.obj(s);if(r&&n==="reference")return s===e;const a=fs.arr(s);if(a&&t==="reference")return s===e;if((a||r)&&s===e)return!0;let o;for(o in s)if(!(o in e))return!1;if(r&&t==="shallow"&&n==="shallow"){for(o in i?e:s)if(!fs.equ(s[o],e[o],{strict:i,objects:"reference"}))return!1}else for(o in i?e:s)if(s[o]!==e[o])return!1;if(fs.und(o)){if(a&&s.length===0&&e.length===0||r&&Object.keys(s).length===0&&Object.keys(e).length===0)return!0;if(s!==e)return!1}return!0}};function _ee(s){s.type!=="Scene"&&(s.dispose==null||s.dispose());for(const e in s){const t=s[e];t?.type!=="Scene"&&(t==null||t.dispose==null||t.dispose())}}const FG=["children","key","ref"];function See(s){const e={};for(const t in s)FG.includes(t)||(e[t]=s[t]);return e}function eT(s,e,t,n){const i=s;let r=i?.__r3f;return r||(r={root:e,type:t,parent:null,children:[],props:See(n),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=r)),r}function Xv(s,e){let t=s[e];if(!e.includes("-"))return{root:s,key:e,target:t};t=s;for(const i of e.split("-")){var n;e=i,s=t,t=(n=t)==null?void 0:n[e]}return{root:s,key:e,target:t}}const NP=/-\d+$/;function tT(s,e){if(fs.str(e.props.attach)){if(NP.test(e.props.attach)){const i=e.props.attach.replace(NP,""),{root:r,key:a}=Xv(s.object,i);Array.isArray(r[a])||(r[a]=[])}const{root:t,key:n}=Xv(s.object,e.props.attach);e.previousAttach=t[n],t[n]=e.object}else fs.fun(e.props.attach)&&(e.previousAttach=e.props.attach(s.object,e.object))}function nT(s,e){if(fs.str(e.props.attach)){const{root:t,key:n}=Xv(s.object,e.props.attach),i=e.previousAttach;i===void 0?delete t[n]:t[n]=i}else e.previousAttach==null||e.previousAttach(s.object,e.object);delete e.previousAttach}const Nw=[...FG,"args","dispose","attach","object","onUpdate","dispose"],FP=new Map;function bee(s){let e=FP.get(s.constructor);try{e||(e=new s.constructor,FP.set(s.constructor,e))}catch{}return e}function Tee(s,e){const t={};for(const n in e)if(!Nw.includes(n)&&!fs.equ(e[n],s.props[n])){t[n]=e[n];for(const i in e)i.startsWith(`${n}-`)&&(t[i]=e[i])}for(const n in s.props){if(Nw.includes(n)||e.hasOwnProperty(n))continue;const{root:i,key:r}=Xv(s.object,n);if(i.constructor&&i.constructor.length===0){const a=bee(i);fs.und(a)||(t[r]=a[r])}else t[r]=0}return t}const Cee=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],Iee=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function Kf(s,e){var t;const n=s.__r3f,i=n&&LG(n).getState(),r=n?.eventCount;for(const o in e){let l=e[o];if(Nw.includes(o))continue;if(n&&Iee.test(o)){typeof l=="function"?n.handlers[o]=l:delete n.handlers[o],n.eventCount=Object.keys(n.handlers).length;continue}if(l===void 0)continue;let{root:c,key:h,target:f}=Xv(s,o);if(f instanceof VA&&l instanceof VA)f.mask=l.mask;else if(f instanceof Tt&&yee(l))f.set(l);else if(f!==null&&typeof f=="object"&&typeof f.set=="function"&&typeof f.copy=="function"&&l!=null&&l.constructor&&f.constructor===l.constructor)f.copy(l);else if(f!==null&&typeof f=="object"&&typeof f.set=="function"&&Array.isArray(l))typeof f.fromArray=="function"?f.fromArray(l):f.set(...l);else if(f!==null&&typeof f=="object"&&typeof f.set=="function"&&typeof l=="number")typeof f.setScalar=="function"?f.setScalar(l):f.set(l);else{var a;c[h]=l,i&&!i.linear&&Cee.includes(h)&&(a=c[h])!=null&&a.isTexture&&c[h].format===rs&&c[h].type===ds&&(c[h].colorSpace=sa)}}if(n!=null&&n.parent&&i!=null&&i.internal&&(t=n.object)!=null&&t.isObject3D&&r!==n.eventCount){const o=n.object,l=i.internal.interaction.indexOf(o);l>-1&&i.internal.interaction.splice(l,1),n.eventCount&&o.raycast!==null&&i.internal.interaction.push(o)}return n&&n.props.attach===void 0&&(n.object.isBufferGeometry?n.props.attach="geometry":n.object.isMaterial&&(n.props.attach="material")),n&&h0(n),s}function h0(s){var e;if(!s.parent)return;s.props.onUpdate==null||s.props.onUpdate(s.object);const t=(e=s.root)==null||e.getState==null?void 0:e.getState();t&&t.internal.frames===0&&t.invalidate()}function Mee(s,e){s.manual||(OG(s)?(s.left=e.width/-2,s.right=e.width/2,s.top=e.height/2,s.bottom=e.height/-2):s.aspect=e.width/e.height,s.updateProjectionMatrix())}const Ja=s=>s?.isObject3D;function vS(s){return(s.eventObject||s.object).uuid+"/"+s.index+s.instanceId}function UG(s,e,t,n){const i=t.get(e);i&&(t.delete(e),t.size===0&&(s.delete(n),i.target.releasePointerCapture(n)))}function wee(s,e){const{internal:t}=s.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,i)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((n,i)=>{UG(t.capturedMap,e,n,i)})}function Ree(s){function e(l){const{internal:c}=s.getState(),h=l.offsetX-c.initialClick[0],f=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(h*h+f*f))}function t(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(h=>{var f;return(f=c.__r3f)==null?void 0:f.handlers["onPointer"+h]}))}function n(l,c){const h=s.getState(),f=new Set,p=[],g=c?c(h.internal.interaction):h.internal.interaction;for(let _=0;_<g.length;_++){const b=Xg(g[_]);b&&(b.raycaster.camera=void 0)}h.previousRoot||h.events.compute==null||h.events.compute(l,h);function y(_){const b=Xg(_);if(!b||!b.events.enabled||b.raycaster.camera===null)return[];if(b.raycaster.camera===void 0){var C;b.events.compute==null||b.events.compute(l,b,(C=b.previousRoot)==null?void 0:C.getState()),b.raycaster.camera===void 0&&(b.raycaster.camera=null)}return b.raycaster.camera?b.raycaster.intersectObject(_,!0):[]}let x=g.flatMap(y).sort((_,b)=>{const C=Xg(_.object),I=Xg(b.object);return!C||!I?_.distance-b.distance:I.events.priority-C.events.priority||_.distance-b.distance}).filter(_=>{const b=vS(_);return f.has(b)?!1:(f.add(b),!0)});h.events.filter&&(x=h.events.filter(x,h));for(const _ of x){let b=_.object;for(;b;){var E;(E=b.__r3f)!=null&&E.eventCount&&p.push({..._,eventObject:b}),b=b.parent}}if("pointerId"in l&&h.internal.capturedMap.has(l.pointerId))for(let _ of h.internal.capturedMap.get(l.pointerId).values())f.has(vS(_.intersection))||p.push(_.intersection);return p}function i(l,c,h,f){if(l.length){const p={stopped:!1};for(const g of l){let y=Xg(g.object);if(y||g.object.traverseAncestors(x=>{const E=Xg(x);if(E)return y=E,!1}),y){const{raycaster:x,pointer:E,camera:_,internal:b}=y,C=new de(E.x,E.y,0).unproject(_),I=L=>{var O,U;return(O=(U=b.capturedMap.get(L))==null?void 0:U.has(g.eventObject))!=null?O:!1},M=L=>{const O={intersection:g,target:c.target};b.capturedMap.has(L)?b.capturedMap.get(L).set(g.eventObject,O):b.capturedMap.set(L,new Map([[g.eventObject,O]])),c.target.setPointerCapture(L)},R=L=>{const O=b.capturedMap.get(L);O&&UG(b.capturedMap,g.eventObject,O,L)};let D={};for(let L in c){let O=c[L];typeof O!="function"&&(D[L]=O)}let P={...g,...D,pointer:E,intersections:l,stopped:p.stopped,delta:h,unprojectedPoint:C,ray:x.ray,camera:_,stopPropagation(){const L="pointerId"in c&&b.capturedMap.get(c.pointerId);if((!L||L.has(g.eventObject))&&(P.stopped=p.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(O=>O.eventObject===g.eventObject))){const O=l.slice(0,l.indexOf(g));r([...O,g])}},target:{hasPointerCapture:I,setPointerCapture:M,releasePointerCapture:R},currentTarget:{hasPointerCapture:I,setPointerCapture:M,releasePointerCapture:R},nativeEvent:c};if(f(P),p.stopped===!0)break}}}return l}function r(l){const{internal:c}=s.getState();for(const h of c.hovered.values())if(!l.length||!l.find(f=>f.object===h.object&&f.index===h.index&&f.instanceId===h.instanceId)){const p=h.eventObject.__r3f;if(c.hovered.delete(vS(h)),p!=null&&p.eventCount){const g=p.handlers,y={...h,intersections:l};g.onPointerOut==null||g.onPointerOut(y),g.onPointerLeave==null||g.onPointerLeave(y)}}}function a(l,c){for(let h=0;h<c.length;h++){const f=c[h].__r3f;f==null||f.handlers.onPointerMissed==null||f.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>r([]);case"onLostPointerCapture":return c=>{const{internal:h}=s.getState();"pointerId"in c&&h.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{h.capturedMap.has(c.pointerId)&&(h.capturedMap.delete(c.pointerId),r([]))})}}return function(h){const{onPointerMissed:f,internal:p}=s.getState();p.lastEvent.current=h;const g=l==="onPointerMove",y=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",E=n(h,g?t:void 0),_=y?e(h):0;l==="onPointerDown"&&(p.initialClick=[h.offsetX,h.offsetY],p.initialHits=E.map(C=>C.eventObject)),y&&!E.length&&_<=2&&(a(h,p.interaction),f&&f(h)),g&&r(E);function b(C){const I=C.eventObject,M=I.__r3f;if(!(M!=null&&M.eventCount))return;const R=M.handlers;if(g){if(R.onPointerOver||R.onPointerEnter||R.onPointerOut||R.onPointerLeave){const D=vS(C),P=p.hovered.get(D);P?P.stopped&&C.stopPropagation():(p.hovered.set(D,C),R.onPointerOver==null||R.onPointerOver(C),R.onPointerEnter==null||R.onPointerEnter(C))}R.onPointerMove==null||R.onPointerMove(C)}else{const D=R[l];D?(!y||p.initialHits.includes(I))&&(a(h,p.interaction.filter(P=>!p.initialHits.includes(P))),D(C)):y&&p.initialHits.includes(I)&&a(h,p.interaction.filter(P=>!p.initialHits.includes(P)))}}i(E,h,_,b)}}return{handlePointer:o}}const UP=s=>!!(s!=null&&s.render),kG=ee.createContext(null),Bee=(s,e)=>{const t=eee((o,l)=>{const c=new de,h=new de,f=new de;function p(_=l().camera,b=h,C=l().size){const{width:I,height:M,top:R,left:D}=C,P=I/M;b.isVector3?f.copy(b):f.set(...b);const L=_.getWorldPosition(c).distanceTo(f);if(OG(_))return{width:I/_.zoom,height:M/_.zoom,top:R,left:D,factor:1,distance:L,aspect:P};{const O=_.fov*Math.PI/180,U=2*Math.tan(O/2)*L,j=U*(I/M);return{width:j,height:U,top:R,left:D,factor:I/j,distance:L,aspect:P}}}let g;const y=_=>o(b=>({performance:{...b.performance,current:_}})),x=new We;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(_=1)=>s(l(),_),advance:(_,b)=>e(_,b,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new TE,pointer:x,mouse:x,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const _=l();g&&clearTimeout(g),_.performance.current!==_.performance.min&&y(_.performance.min),g=setTimeout(()=>y(l().performance.max),_.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:p},setEvents:_=>o(b=>({...b,events:{...b.events,..._}})),setSize:(_,b,C=0,I=0)=>{const M=l().camera,R={width:_,height:b,top:C,left:I};o(D=>({size:R,viewport:{...D.viewport,...p(M,h,R)}}))},setDpr:_=>o(b=>{const C=NG(_);return{viewport:{...b.viewport,dpr:C,initialDpr:b.viewport.initialDpr||C}}}),setFrameloop:(_="always")=>{const b=l().clock;b.stop(),b.elapsedTime=0,_!=="never"&&(b.start(),b.elapsedTime=0),o(()=>({frameloop:_}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:ee.createRef(),active:!1,frames:0,priority:0,subscribe:(_,b,C)=>{const I=l().internal;return I.priority=I.priority+(b>0?1:0),I.subscribers.push({ref:_,priority:b,store:C}),I.subscribers=I.subscribers.sort((M,R)=>M.priority-R.priority),()=>{const M=l().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(b>0?1:0),M.subscribers=M.subscribers.filter(R=>R.ref!==_))}}}}}),n=t.getState();let i=n.size,r=n.viewport.dpr,a=n.camera;return t.subscribe(()=>{const{camera:o,size:l,viewport:c,gl:h,set:f}=t.getState();if(l.width!==i.width||l.height!==i.height||c.dpr!==r){i=l,r=c.dpr,Mee(o,l),c.dpr>0&&h.setPixelRatio(c.dpr);const p=typeof HTMLCanvasElement<"u"&&h.domElement instanceof HTMLCanvasElement;h.setSize(l.width,l.height,p)}o!==a&&(a=o,f(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(o)}})))}),t.subscribe(o=>s(o)),t};function Dee(){const s=ee.useContext(kG);if(!s)throw new Error("R3F: Hooks can only be used within the Canvas component!");return s}function Lee(s,e=0){const t=Dee(),n=t.getState().internal.subscribe,i=PG(s);return CE(()=>n(i,e,t),[e,n,t]),null}function Oee(s){const e=uee(s);return e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:ee.version}),e}const GG=0,YA={},Pee=/^three(?=[A-Z])/,oC=s=>`${s[0].toUpperCase()}${s.slice(1)}`;let Nee=0;const Fee=s=>typeof s=="function";function HG(s){if(Fee(s)){const e=`${Nee++}`;return YA[e]=s,e}else Object.assign(YA,s)}function zG(s,e){const t=oC(s),n=YA[t];if(s!=="primitive"&&!n)throw new Error(`R3F: ${t} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(s==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function Uee(s,e,t){var n;return s=oC(s)in YA?s:s.replace(Pee,""),zG(s,e),s==="primitive"&&(n=e.object)!=null&&n.__r3f&&delete e.object.__r3f,eT(e.object,t,s,e)}function kee(s){if(!s.isHidden){var e;s.props.attach&&(e=s.parent)!=null&&e.object?nT(s.parent,s):Ja(s.object)&&(s.object.visible=!1),s.isHidden=!0,h0(s)}}function QG(s){if(s.isHidden){var e;s.props.attach&&(e=s.parent)!=null&&e.object?tT(s.parent,s):Ja(s.object)&&s.props.visible!==!1&&(s.object.visible=!0),s.isHidden=!1,h0(s)}}function XB(s,e,t){const n=e.root.getState();if(!(!s.parent&&s.object!==n.scene)){if(!e.object){var i,r;const a=YA[oC(e.type)];e.object=(i=e.props.object)!=null?i:new a(...(r=e.props.args)!=null?r:[]),e.object.__r3f=e}if(Kf(e.object,e.props),e.props.attach)tT(s,e);else if(Ja(e.object)&&Ja(s.object)){const a=s.object.children.indexOf(t?.object);if(t&&a!==-1){const o=s.object.children.indexOf(e.object);if(o!==-1){s.object.children.splice(o,1);const l=o<a?a-1:a;s.object.children.splice(l,0,e.object)}else e.object.parent=s.object,s.object.children.splice(a,0,e.object),e.object.dispatchEvent({type:"added"}),s.object.dispatchEvent({type:"childadded",child:e.object})}else s.object.add(e.object)}for(const a of e.children)XB(e,a);h0(e)}}function kI(s,e){e&&(e.parent=s,s.children.push(e),XB(s,e))}function kP(s,e,t){if(!e||!t)return;e.parent=s;const n=s.children.indexOf(t);n!==-1?s.children.splice(n,0,e):s.children.push(e),XB(s,e,t)}function VG(s){if(typeof s.dispose=="function"){const e=()=>{try{s.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():PP.unstable_scheduleCallback(PP.unstable_IdlePriority,e)}}function Fw(s,e,t){if(!e)return;e.parent=null;const n=s.children.indexOf(e);n!==-1&&s.children.splice(n,1),e.props.attach?nT(s,e):Ja(e.object)&&Ja(s.object)&&(s.object.remove(e.object),wee(LG(e),e.object));const i=e.props.dispose!==null&&t!==!1;for(let r=e.children.length-1;r>=0;r--){const a=e.children[r];Fw(e,a,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&VG(e.object),t===void 0&&h0(e)}function Gee(s,e){for(const t of[s,s.alternate])if(t!==null)if(typeof t.ref=="function"){t.refCleanup==null||t.refCleanup();const n=t.ref(e);typeof n=="function"&&(t.refCleanup=n)}else t.ref&&(t.ref.current=e)}const WS=[];function Hee(){for(const[t]of WS){const n=t.parent;if(n){t.props.attach?nT(n,t):Ja(t.object)&&Ja(n.object)&&n.object.remove(t.object);for(const i of t.children)i.props.attach?nT(t,i):Ja(i.object)&&Ja(t.object)&&t.object.remove(i.object)}t.isHidden&&QG(t),t.object.__r3f&&delete t.object.__r3f,t.type!=="primitive"&&VG(t.object)}for(const[t,n,i]of WS){t.props=n;const r=t.parent;if(r){var s,e;const a=YA[oC(t.type)];t.object=(s=t.props.object)!=null?s:new a(...(e=t.props.args)!=null?e:[]),t.object.__r3f=t,Gee(i,t.object),Kf(t.object,t.props),t.props.attach?tT(r,t):Ja(t.object)&&Ja(r.object)&&r.object.add(t.object);for(const o of t.children)o.props.attach?tT(t,o):Ja(o.object)&&Ja(t.object)&&t.object.add(o.object);h0(t)}}WS.length=0}const GI=()=>{},GP={};let ES=GG;const zee=0,Qee=4,Uw=Oee({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:Uee,removeChild:Fw,appendChild:kI,appendInitialChild:kI,insertBefore:kP,appendChildToContainer(s,e){const t=s.getState().scene.__r3f;!e||!t||kI(t,e)},removeChildFromContainer(s,e){const t=s.getState().scene.__r3f;!e||!t||Fw(t,e)},insertInContainerBefore(s,e,t){const n=s.getState().scene.__r3f;!e||!t||!n||kP(n,e,t)},getRootHostContext:()=>GP,getChildHostContext:()=>GP,commitUpdate(s,e,t,n,i){var r,a,o;zG(e,n);let l=!1;if((s.type==="primitive"&&t.object!==n.object||((r=n.args)==null?void 0:r.length)!==((a=t.args)==null?void 0:a.length)||(o=n.args)!=null&&o.some((h,f)=>{var p;return h!==((p=t.args)==null?void 0:p[f])}))&&(l=!0),l)WS.push([s,{...n},i]);else{const h=Tee(s,n);Object.keys(h).length&&(Object.assign(s.props,h),Kf(s.object,h))}(i.sibling===null||(i.flags&Qee)===zee)&&Hee()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:s=>s?.object,prepareForCommit:()=>null,preparePortalMount:s=>eT(s.getState().scene,s,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:kee,unhideInstance:QG,createTextInstance:GI,hideTextInstance:GI,unhideTextInstance:GI,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:ee.createContext(null),setCurrentUpdatePriority(s){ES=s},getCurrentUpdatePriority(){return ES},resolveUpdatePriority(){var s;if(ES!==GG)return ES;switch(typeof window<"u"&&((s=window.event)==null?void 0:s.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return qS.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return qS.ContinuousEventPriority;default:return qS.DefaultEventPriority}},resetFormInstance(){}}),mm=new Map,Wg={objects:"shallow",strict:!1};function Vee(s,e){if(!e&&typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement&&s.parentElement){const{width:t,height:n,top:i,left:r}=s.parentElement.getBoundingClientRect();return{width:t,height:n,top:i,left:r}}else if(!e&&typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas)return{width:s.width,height:s.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function jee(s){const e=mm.get(s),t=e?.fiber,n=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,r=n||Bee(Hw,zP),a=t||Uw.createContainer(r,qS.ConcurrentRoot,null,!1,null,"",i,i,i,null);e||mm.set(s,{fiber:a,store:r});let o,l,c=!1,h=null;return{async configure(f={}){let p;h=new Promise(te=>p=te);let{gl:g,size:y,scene:x,events:E,onCreated:_,shadows:b=!1,linear:C=!1,flat:I=!1,legacy:M=!1,orthographic:R=!1,frameloop:D="always",dpr:P=[1,2],performance:L,raycaster:O,camera:U,onPointerMissed:j}=f,H=r.getState(),z=H.gl;if(!H.gl){const te={canvas:s,powerPreference:"high-performance",antialias:!0,alpha:!0},oe=typeof g=="function"?await g(te):g;UP(oe)?z=oe:z=new qB({...te,...g}),H.set({gl:z})}let q=H.raycaster;q||H.set({raycaster:q=new QB});const{params:k,...W}=O||{};if(fs.equ(W,q,Wg)||Kf(q,{...W}),fs.equ(k,q.params,Wg)||Kf(q,{params:{...q.params,...k}}),!H.camera||H.camera===l&&!fs.equ(l,U,Wg)){l=U;const te=U?.isCamera,oe=te?U:R?new Nh(0,0,0,0,.1,1e3):new Ki(75,0,.1,1e3);te||(oe.position.z=5,U&&(Kf(oe,U),oe.manual||("aspect"in U||"left"in U||"right"in U||"bottom"in U||"top"in U)&&(oe.manual=!0,oe.updateProjectionMatrix())),!H.camera&&!(U!=null&&U.rotation)&&oe.lookAt(0,0,0)),H.set({camera:oe}),q.camera=oe}if(!H.scene){let te;x!=null&&x.isScene?(te=x,eT(te,r,"",{})):(te=new zT,eT(te,r,"",{}),x&&Kf(te,x)),H.set({scene:te})}E&&!H.events.handlers&&H.set({events:E(r)});const V=Vee(s,y);if(fs.equ(V,H.size,Wg)||H.setSize(V.width,V.height,V.top,V.left),P&&H.viewport.dpr!==NG(P)&&H.setDpr(P),H.frameloop!==D&&H.setFrameloop(D),H.onPointerMissed||H.set({onPointerMissed:j}),L&&!fs.equ(L,H.performance,Wg)&&H.set(te=>({performance:{...te.performance,...L}})),!H.xr){var X;const te=(Ce,se)=>{const ie=r.getState();ie.frameloop!=="never"&&zP(Ce,!0,ie,se)},oe=()=>{const Ce=r.getState();Ce.gl.xr.enabled=Ce.gl.xr.isPresenting,Ce.gl.xr.setAnimationLoop(Ce.gl.xr.isPresenting?te:null),Ce.gl.xr.isPresenting||Hw(Ce)},Ee={connect(){const Ce=r.getState().gl;Ce.xr.addEventListener("sessionstart",oe),Ce.xr.addEventListener("sessionend",oe)},disconnect(){const Ce=r.getState().gl;Ce.xr.removeEventListener("sessionstart",oe),Ce.xr.removeEventListener("sessionend",oe)}};typeof((X=z.xr)==null?void 0:X.addEventListener)=="function"&&Ee.connect(),H.set({xr:Ee})}if(z.shadowMap){const te=z.shadowMap.enabled,oe=z.shadowMap.type;if(z.shadowMap.enabled=!!b,fs.boo(b))z.shadowMap.type=hv;else if(fs.str(b)){var K;const Ee={basic:U3,percentage:CT,soft:hv,variance:lc};z.shadowMap.type=(K=Ee[b])!=null?K:hv}else fs.obj(b)&&Object.assign(z.shadowMap,b);(te!==z.shadowMap.enabled||oe!==z.shadowMap.type)&&(z.shadowMap.needsUpdate=!0)}return Jn.enabled=!M,c||(z.outputColorSpace=C?ud:sa,z.toneMapping=I?hc:sB),H.legacy!==M&&H.set(()=>({legacy:M})),H.linear!==C&&H.set(()=>({linear:C})),H.flat!==I&&H.set(()=>({flat:I})),g&&!fs.fun(g)&&!UP(g)&&!fs.equ(g,z,Wg)&&Kf(z,g),o=_,c=!0,p(),this},render(f){return!c&&!h&&this.configure(),h.then(()=>{Uw.updateContainer(G.jsx(qee,{store:r,children:f,onCreated:o,rootElement:s}),a,null,()=>{})}),r},unmount(){jG(s)}}}function qee({store:s,children:e,onCreated:t,rootElement:n}){return CE(()=>{const i=s.getState();i.set(r=>({internal:{...r.internal,active:!0}})),t&&t(i),s.getState().events.connected||i.events.connect==null||i.events.connect(n)},[]),G.jsx(kG.Provider,{value:s,children:e})}function jG(s,e){const t=mm.get(s),n=t?.fiber;if(n){const i=t?.store.getState();i&&(i.internal.active=!1),Uw.updateContainer(null,n,null,()=>{i&&setTimeout(()=>{try{var r,a,o,l;i.events.disconnect==null||i.events.disconnect(),(r=i.gl)==null||(a=r.renderLists)==null||a.dispose==null||a.dispose(),(o=i.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=i.gl)!=null&&l.xr&&i.xr.disconnect(),_ee(i.scene),mm.delete(s)}catch{}},500)})}}const Kee=new Set,Yee=new Set,Xee=new Set;function HI(s,e){if(s.size)for(const{callback:t}of s.values())t(e)}function Av(s,e){switch(s){case"before":return HI(Kee,e);case"after":return HI(Yee,e);case"tail":return HI(Xee,e)}}let zI,QI;function kw(s,e,t){let n=e.clock.getDelta();e.frameloop==="never"&&typeof s=="number"&&(n=s-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=s),zI=e.internal.subscribers;for(let i=0;i<zI.length;i++)QI=zI[i],QI.ref.current(QI.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let iT=!1,Gw=!1,VI,HP,$g;function qG(s){HP=requestAnimationFrame(qG),iT=!0,VI=0,Av("before",s),Gw=!0;for(const t of mm.values()){var e;$g=t.store.getState(),$g.internal.active&&($g.frameloop==="always"||$g.internal.frames>0)&&!((e=$g.gl.xr)!=null&&e.isPresenting)&&(VI+=kw(s,$g))}if(Gw=!1,Av("after",s),VI===0)return Av("tail",s),iT=!1,cancelAnimationFrame(HP)}function Hw(s,e=1){var t;if(!s)return mm.forEach(n=>Hw(n.store.getState(),e));(t=s.gl.xr)!=null&&t.isPresenting||!s.internal.active||s.frameloop==="never"||(e>1?s.internal.frames=Math.min(60,s.internal.frames+e):Gw?s.internal.frames=2:s.internal.frames=1,iT||(iT=!0,requestAnimationFrame(qG)))}function zP(s,e=!0,t,n){if(e&&Av("before",s),t)kw(s,t,n);else for(const i of mm.values())kw(s,i.store.getState());e&&Av("after",s)}const jI={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Wee(s){const{handlePointer:e}=Ree(s);return{priority:1,enabled:!0,compute(t,n,i){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(jI).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:i}=s.getState();(t=i.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{const{set:n,events:i}=s.getState();if(i.disconnect==null||i.disconnect(),n(r=>({events:{...r.events,connected:t}})),i.handlers)for(const r in i.handlers){const a=i.handlers[r],[o,l]=jI[r];t.addEventListener(o,a,{passive:l})}},disconnect:()=>{const{set:t,events:n}=s.getState();if(n.connected){if(n.handlers)for(const i in n.handlers){const r=n.handlers[i],[a]=jI[i];n.connected.removeEventListener(a,r)}t(i=>({events:{...i.events,connected:void 0}}))}}}}function QP(s,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>s(...n),e)}}function $ee({debounce:s,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const i=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[r,a]=ee.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=ee.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:r,orientationHandler:null}),l=s?typeof s=="number"?s:s.scroll:null,c=s?typeof s=="number"?s:s.resize:null,h=ee.useRef(!1);ee.useEffect(()=>(h.current=!0,()=>void(h.current=!1)));const[f,p,g]=ee.useMemo(()=>{const _=()=>{if(!o.current.element)return;const{left:b,top:C,width:I,height:M,bottom:R,right:D,x:P,y:L}=o.current.element.getBoundingClientRect(),O={left:b,top:C,width:I,height:M,bottom:R,right:D,x:P,y:L};o.current.element instanceof HTMLElement&&n&&(O.height=o.current.element.offsetHeight,O.width=o.current.element.offsetWidth),Object.freeze(O),h.current&&!tte(o.current.lastBounds,O)&&a(o.current.lastBounds=O)};return[_,c?QP(_,c):_,l?QP(_,l):_]},[a,n,l,c]);function y(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(_=>_.removeEventListener("scroll",g,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function x(){o.current.element&&(o.current.resizeObserver=new i(g),o.current.resizeObserver.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(_=>_.addEventListener("scroll",g,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{g()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const E=_=>{!_||_===o.current.element||(y(),o.current.element=_,o.current.scrollContainers=KG(_),x())};return Zee(g,!!e),Jee(p),ee.useEffect(()=>{y(),x()},[e,g,p]),ee.useEffect(()=>y,[]),[E,r,f]}function Jee(s){ee.useEffect(()=>{const e=s;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[s])}function Zee(s,e){ee.useEffect(()=>{if(e){const t=s;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[s,e])}function KG(s){const e=[];if(!s||s===document.body)return e;const{overflow:t,overflowX:n,overflowY:i}=window.getComputedStyle(s);return[t,n,i].some(r=>r==="auto"||r==="scroll")&&e.push(s),[...e,...KG(s.parentElement)]}const ete=["x","y","top","bottom","left","right","width","height"],tte=(s,e)=>ete.every(t=>s[t]===e[t]);function nte({ref:s,children:e,fallback:t,resize:n,style:i,gl:r,events:a=Wee,eventSource:o,eventPrefix:l,shadows:c,linear:h,flat:f,legacy:p,orthographic:g,frameloop:y,dpr:x,performance:E,raycaster:_,camera:b,scene:C,onPointerMissed:I,onCreated:M,...R}){ee.useMemo(()=>HG(Zb),[]);const D=vee(),[P,L]=$ee({scroll:!0,debounce:{scroll:50,resize:0},...n}),O=ee.useRef(null),U=ee.useRef(null);ee.useImperativeHandle(s,()=>O.current);const j=PG(I),[H,z]=ee.useState(!1),[q,k]=ee.useState(!1);if(H)throw H;if(q)throw q;const W=ee.useRef(null);CE(()=>{const X=O.current;if(L.width>0&&L.height>0&&X){W.current||(W.current=jee(X));async function K(){await W.current.configure({gl:r,scene:C,events:a,shadows:c,linear:h,flat:f,legacy:p,orthographic:g,frameloop:y,dpr:x,performance:E,raycaster:_,camera:b,size:L,onPointerMissed:(...te)=>j.current==null?void 0:j.current(...te),onCreated:te=>{te.events.connect==null||te.events.connect(o?Aee(o)?o.current:o:U.current),l&&te.setEvents({compute:(oe,Ee)=>{const Ce=oe[l+"X"],se=oe[l+"Y"];Ee.pointer.set(Ce/Ee.size.width*2-1,-(se/Ee.size.height)*2+1),Ee.raycaster.setFromCamera(Ee.pointer,Ee.camera)}}),M?.(te)}}),W.current.render(G.jsx(D,{children:G.jsx(xee,{set:k,children:G.jsx(ee.Suspense,{fallback:G.jsx(Eee,{set:z}),children:e??null})})}))}K()}}),ee.useEffect(()=>{const X=O.current;if(X)return()=>jG(X)},[]);const V=o?"none":"auto";return G.jsx("div",{ref:U,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:V,...i},...R,children:G.jsx("div",{ref:P,style:{width:"100%",height:"100%"},children:G.jsx("canvas",{ref:O,style:{display:"block"},children:t})})})}function ite(s){return G.jsx(BG,{children:G.jsx(nte,{...s})})}const ste=s=>s;function rte(s,e=ste){const t=sA.useSyncExternalStore(s.subscribe,sA.useCallback(()=>e(s.getState()),[s,e]),sA.useCallback(()=>e(s.getInitialState()),[s,e]));return sA.useDebugValue(t),t}const VP=s=>{const e=IG(s),t=n=>rte(e,n);return Object.assign(t,e),t},ate=(s=>s?VP(s):VP),Qi=ate(s=>({text:"Genial",selectedStrategyId:"spiral",config:{tightness:5},setText:e=>s({text:e}),setStrategy:e=>s({selectedStrategyId:e,config:{}}),setConfig:e=>s(t=>({config:{...t.config,...e}}))}));function zw(){return zw=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},zw.apply(null,arguments)}const YG=parseInt(fE.replace(/\D+/g,""));function ote(s,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},n=s.getIndex(),i=s.getAttribute("position"),r=n?n.count:i.count;let a=0;const o=Object.keys(s.attributes),l={},c={},h=[],f=["getX","getY","getZ","getW"];for(let x=0,E=o.length;x<E;x++){const _=o[x];l[_]=[];const b=s.morphAttributes[_];b&&(c[_]=new Array(b.length).fill(0).map(()=>[]))}const p=Math.log10(1/e),g=Math.pow(10,p);for(let x=0;x<r;x++){const E=n?n.getX(x):x;let _="";for(let b=0,C=o.length;b<C;b++){const I=o[b],M=s.getAttribute(I),R=M.itemSize;for(let D=0;D<R;D++)_+=`${~~(M[f[D]](E)*g)},`}if(_ in t)h.push(t[_]);else{for(let b=0,C=o.length;b<C;b++){const I=o[b],M=s.getAttribute(I),R=s.morphAttributes[I],D=M.itemSize,P=l[I],L=c[I];for(let O=0;O<D;O++){const U=f[O];if(P.push(M[U](E)),R)for(let j=0,H=R.length;j<H;j++)L[j].push(R[j][U](E))}}t[_]=a,h.push(a),a++}}const y=s.clone();for(let x=0,E=o.length;x<E;x++){const _=o[x],b=s.getAttribute(_),C=new b.array.constructor(l[_]),I=new ei(C,b.itemSize,b.normalized);if(y.setAttribute(_,I),_ in c)for(let M=0;M<c[_].length;M++){const R=s.morphAttributes[_][M],D=new R.array.constructor(c[_][M]),P=new ei(D,R.itemSize,R.normalized);y.morphAttributes[_][M]=P}}return y.setIndex(h),y}function jP(s,e){if(e===mk)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),s;if(e===Xb||e===fB){let t=s.getIndex();if(t===null){const a=[],o=s.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);s.setIndex(a),t=s.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s}const n=t.count-2,i=[];if(t)if(e===Xb)for(let a=1;a<=n;a++)i.push(t.getX(0)),i.push(t.getX(a)),i.push(t.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(i.push(t.getX(a)),i.push(t.getX(a+1)),i.push(t.getX(a+2))):(i.push(t.getX(a+2)),i.push(t.getX(a+1)),i.push(t.getX(a)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=s.clone();return r.setIndex(i),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),s}var ml=Uint8Array,Jf=Uint16Array,Qw=Uint32Array,XG=new ml([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),WG=new ml([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),lte=new ml([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$G=function(s,e){for(var t=new Jf(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];for(var i=new Qw(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)i[r]=r-t[n]<<5|n;return[t,i]},JG=$G(XG,2),ZG=JG[0],cte=JG[1];ZG[28]=258,cte[258]=28;var ute=$G(WG,0),hte=ute[0],Vw=new Jf(32768);for(var Yi=0;Yi<32768;++Yi){var kf=(Yi&43690)>>>1|(Yi&21845)<<1;kf=(kf&52428)>>>2|(kf&13107)<<2,kf=(kf&61680)>>>4|(kf&3855)<<4,Vw[Yi]=((kf&65280)>>>8|(kf&255)<<8)>>>1}var yv=(function(s,e,t){for(var n=s.length,i=0,r=new Jf(e);i<n;++i)++r[s[i]-1];var a=new Jf(e);for(i=0;i<e;++i)a[i]=a[i-1]+r[i-1]<<1;var o;if(t){o=new Jf(1<<e);var l=15-e;for(i=0;i<n;++i)if(s[i])for(var c=i<<4|s[i],h=e-s[i],f=a[s[i]-1]++<<h,p=f|(1<<h)-1;f<=p;++f)o[Vw[f]>>>l]=c}else for(o=new Jf(n),i=0;i<n;++i)s[i]&&(o[i]=Vw[a[s[i]-1]++]>>>15-s[i]);return o}),IE=new ml(288);for(var Yi=0;Yi<144;++Yi)IE[Yi]=8;for(var Yi=144;Yi<256;++Yi)IE[Yi]=9;for(var Yi=256;Yi<280;++Yi)IE[Yi]=7;for(var Yi=280;Yi<288;++Yi)IE[Yi]=8;var eH=new ml(32);for(var Yi=0;Yi<32;++Yi)eH[Yi]=5;var fte=yv(IE,9,1),dte=yv(eH,5,1),qI=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},tc=function(s,e,t){var n=e/8|0;return(s[n]|s[n+1]<<8)>>(e&7)&t},KI=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(e&7)},pte=function(s){return(s/8|0)+(s&7&&1)},mte=function(s,e,t){(t==null||t>s.length)&&(t=s.length);var n=new(s instanceof Jf?Jf:s instanceof Qw?Qw:ml)(t-e);return n.set(s.subarray(e,t)),n},gte=function(s,e,t){var n=s.length;if(!n||t&&!t.l&&n<5)return e||new ml(0);var i=!e||t,r=!t||t.i;t||(t={}),e||(e=new ml(n*3));var a=function(ie){var ne=e.length;if(ie>ne){var re=new ml(Math.max(ne*2,ie));re.set(e),e=re}},o=t.f||0,l=t.p||0,c=t.b||0,h=t.l,f=t.d,p=t.m,g=t.n,y=n*8;do{if(!h){t.f=o=tc(s,l,1);var x=tc(s,l+1,3);if(l+=3,x)if(x==1)h=fte,f=dte,p=9,g=5;else if(x==2){var C=tc(s,l,31)+257,I=tc(s,l+10,15)+4,M=C+tc(s,l+5,31)+1;l+=14;for(var R=new ml(M),D=new ml(19),P=0;P<I;++P)D[lte[P]]=tc(s,l+P*3,7);l+=I*3;for(var L=qI(D),O=(1<<L)-1,U=yv(D,L,1),P=0;P<M;){var j=U[tc(s,l,O)];l+=j&15;var E=j>>>4;if(E<16)R[P++]=E;else{var H=0,z=0;for(E==16?(z=3+tc(s,l,3),l+=2,H=R[P-1]):E==17?(z=3+tc(s,l,7),l+=3):E==18&&(z=11+tc(s,l,127),l+=7);z--;)R[P++]=H}}var q=R.subarray(0,C),k=R.subarray(C);p=qI(q),g=qI(k),h=yv(q,p,1),f=yv(k,g,1)}else throw"invalid block type";else{var E=pte(l)+4,_=s[E-4]|s[E-3]<<8,b=E+_;if(b>n){if(r)throw"unexpected EOF";break}i&&a(c+_),e.set(s.subarray(E,b),c),t.b=c+=_,t.p=l=b*8;continue}if(l>y){if(r)throw"unexpected EOF";break}}i&&a(c+131072);for(var W=(1<<p)-1,V=(1<<g)-1,X=l;;X=l){var H=h[KI(s,l)&W],K=H>>>4;if(l+=H&15,l>y){if(r)throw"unexpected EOF";break}if(!H)throw"invalid length/literal";if(K<256)e[c++]=K;else if(K==256){X=l,h=null;break}else{var te=K-254;if(K>264){var P=K-257,oe=XG[P];te=tc(s,l,(1<<oe)-1)+ZG[P],l+=oe}var Ee=f[KI(s,l)&V],Ce=Ee>>>4;if(!Ee)throw"invalid distance";l+=Ee&15;var k=hte[Ce];if(Ce>3){var oe=WG[Ce];k+=KI(s,l)&(1<<oe)-1,l+=oe}if(l>y){if(r)throw"unexpected EOF";break}i&&a(c+131072);for(var se=c+te;c<se;c+=4)e[c]=e[c-k],e[c+1]=e[c+1-k],e[c+2]=e[c+2-k],e[c+3]=e[c+3-k];c=se}}t.l=h,t.p=X,t.b=c,h&&(o=1,t.m=p,t.d=f,t.n=g)}while(!o);return c==e.length?e:mte(e,0,c)},Ate=new ml(0),yte=function(s){if((s[0]&15)!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(s[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function xS(s,e){return gte((yte(s),s.subarray(2,-4)),e)}var vte=typeof TextDecoder<"u"&&new TextDecoder,Ete=0;try{vte.decode(Ate,{stream:!0}),Ete=1}catch{}var xte=Object.defineProperty,_te=(s,e,t)=>e in s?xte(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Wp=(s,e,t)=>(_te(s,typeof e!="symbol"?e+"":e,t),t);class lC{constructor(){Wp(this,"enabled",!0),Wp(this,"needsSwap",!0),Wp(this,"clear",!1),Wp(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,n,i,r){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}class Ste{constructor(e){Wp(this,"camera",new Nh(-1,1,1,-1,0,1)),Wp(this,"geometry",new xd(2,2)),Wp(this,"mesh"),this.mesh=new bi(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var bte=Object.defineProperty,Tte=(s,e,t)=>e in s?bte(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,_S=(s,e,t)=>(Tte(s,typeof e!="symbol"?e+"":e,t),t);class jw extends lC{constructor(e,t="tDiffuse"){super(),_S(this,"textureID"),_S(this,"uniforms"),_S(this,"material"),_S(this,"fsQuad"),this.textureID=t,e instanceof Ra?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=UT.clone(e.uniforms),this.material=new Ra({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Ste(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.fsQuad.dispose(),this.material.dispose()}}const qP={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform float opacity;

    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 texel = texture2D( tDiffuse, vUv );
    	gl_FragColor = opacity * texel;

    }
  `};var Cte=Object.defineProperty,Ite=(s,e,t)=>e in s?Cte(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,YI=(s,e,t)=>(Ite(s,typeof e!="symbol"?e+"":e,t),t);class KP extends lC{constructor(e,t){super(),YI(this,"scene"),YI(this,"camera"),YI(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let a,o;this.inverse?(a=0,o=1):(a=1,o=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,a,4294967295),r.buffers.stencil.setClear(o),r.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}class Mte extends lC{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}var wte=Object.defineProperty,Rte=(s,e,t)=>e in s?wte(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,cl=(s,e,t)=>(Rte(s,typeof e!="symbol"?e+"":e,t),t);class Bte{constructor(e,t){if(cl(this,"renderer"),cl(this,"_pixelRatio"),cl(this,"_width"),cl(this,"_height"),cl(this,"renderTarget1"),cl(this,"renderTarget2"),cl(this,"writeBuffer"),cl(this,"readBuffer"),cl(this,"renderToScreen"),cl(this,"passes",[]),cl(this,"copyPass"),cl(this,"clock"),this.renderer=e,t===void 0){const n={minFilter:Si,magFilter:Si,format:rs},i=e.getSize(new We);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,t=new _l(this._width*this._pixelRatio,this._height*this._pixelRatio,n),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,qP===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),jw===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new jw(qP),this.copyPass.material.blending=Eu,this.clock=new TE}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;const i=this.passes.length;for(let r=0;r<i;r++){const a=this.passes[r];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),a.needsSwap){if(n){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}KP!==void 0&&(a instanceof KP?n=!0:a instanceof Mte&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new We);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}var Dte=Object.defineProperty,Lte=(s,e,t)=>e in s?Dte(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Dp=(s,e,t)=>(Lte(s,typeof e!="symbol"?e+"":e,t),t);class Ote extends lC{constructor(e,t,n,i,r=0){super(),Dp(this,"scene"),Dp(this,"camera"),Dp(this,"overrideMaterial"),Dp(this,"clearColor"),Dp(this,"clearAlpha"),Dp(this,"clearDepth",!1),Dp(this,"_oldClearColor",new Tt),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=r,this.clear=!0,this.needsSwap=!1}render(e,t,n){let i=e.autoClear;e.autoClear=!1;let r,a=null;this.overrideMaterial!==void 0&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=a),e.autoClear=i}}function sT(s){if(typeof TextDecoder<"u")return new TextDecoder().decode(s);let e="";for(let t=0,n=s.length;t<n;t++)e+=String.fromCharCode(s[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const $p="srgb",Mh="srgb-linear",YP=3001,Pte=3e3;class Nte extends Fs{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Hte(t)}),this.register(function(t){return new zte(t)}),this.register(function(t){return new $te(t)}),this.register(function(t){return new Jte(t)}),this.register(function(t){return new Zte(t)}),this.register(function(t){return new Vte(t)}),this.register(function(t){return new jte(t)}),this.register(function(t){return new qte(t)}),this.register(function(t){return new Kte(t)}),this.register(function(t){return new Gte(t)}),this.register(function(t){return new Yte(t)}),this.register(function(t){return new Qte(t)}),this.register(function(t){return new Wte(t)}),this.register(function(t){return new Xte(t)}),this.register(function(t){return new Ute(t)}),this.register(function(t){return new ene(t)}),this.register(function(t){return new tne(t)})}load(e,t,n,i){const r=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const c=Ih.extractUrlBase(e);a=Ih.resolveURL(c,this.path)}else a=Ih.extractUrlBase(e);this.manager.itemStart(e);const o=function(c){i?i(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new Js(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,a,function(h){t(h),r.manager.itemEnd(e)},o)}catch(h){o(h)}},n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;const a={},o={};if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(sT(new Uint8Array(e.slice(0,4)))===tH){try{a[Kn.KHR_BINARY_GLTF]=new nne(e)}catch(h){i&&i(h);return}r=JSON.parse(a[Kn.KHR_BINARY_GLTF].content)}else r=JSON.parse(sT(new Uint8Array(e)));else r=e;if(r.asset===void 0||r.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new mne(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const h=this.pluginCallbacks[c](l);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[h.name]=h,a[h.name]=!0}if(r.extensionsUsed)for(let c=0;c<r.extensionsUsed.length;++c){const h=r.extensionsUsed[c],f=r.extensionsRequired||[];switch(h){case Kn.KHR_MATERIALS_UNLIT:a[h]=new kte;break;case Kn.KHR_DRACO_MESH_COMPRESSION:a[h]=new ine(r,this.dracoLoader);break;case Kn.KHR_TEXTURE_TRANSFORM:a[h]=new sne;break;case Kn.KHR_MESH_QUANTIZATION:a[h]=new rne;break;default:f.indexOf(h)>=0&&o[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,r){n.parse(e,t,i,r)})}}function Fte(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const Kn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Ute{constructor(e){this.parser=e,this.name=Kn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const h=new Tt(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],Mh);const f=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new sC(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Yv(h),c.distance=f;break;case"spot":c=new iC(h),c.distance=f,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,vh(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),i=Promise.resolve(c),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(l){return n._getNodeRef(t.cache,o,l)})}}class kte{constructor(){this.name=Kn.KHR_MATERIALS_UNLIT}getMaterialType(){return io}extendParams(e,t,n){const i=[];e.color=new Tt(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const a=r.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],Mh),e.opacity=a[3]}r.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",r.baseColorTexture,$p))}return Promise.all(i)}}class Gte{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class Hte{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],a=i.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new We(o,o)}return Promise.all(r)}}class zte{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}class Qte{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],a=i.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(r)}}class Vte{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Tt(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=i.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],Mh)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,$p)),a.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(r)}}class jte{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],a=i.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)}}class qte{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],a=i.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return t.attenuationColor=new Tt().setRGB(o[0],o[1],o[2],Mh),Promise.all(r)}}class Kte{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class Yte{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],a=i.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return t.specularColor=new Tt().setRGB(o[0],o[1],o[2],Mh),a.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,$p)),Promise.all(r)}}class Xte{constructor(e){this.parser=e,this.name=Kn.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],a=i.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&r.push(n.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(r)}}class Wte{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],a=i.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&r.push(n.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(r)}}class $te{constructor(e){this.parser=e,this.name=Kn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,a)}}class Jte{constructor(e){this.parser=e,this.name=Kn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const a=r.extensions[t],o=i.images[a.source];let l=n.textureLoader;if(o.uri){const c=n.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,a.source,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Zte{constructor(e){this.parser=e,this.name=Kn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const a=r.extensions[t],o=i.images[a.source];let l=n.textureLoader;if(o.uri){const c=n.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,a.source,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ene{constructor(e){this.name=Kn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(o){const l=i.byteOffset||0,c=i.byteLength||0,h=i.count,f=i.byteStride,p=new Uint8Array(o,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(h,f,p,i.mode,i.filter).then(function(g){return g.buffer}):a.ready.then(function(){const g=new ArrayBuffer(h*f);return a.decodeGltfBuffer(new Uint8Array(g),h,f,p,i.mode,i.filter),g})})}else return null}}class tne{constructor(e){this.name=Kn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const i=t.meshes[n.mesh];for(const c of i.primitives)if(c.mode!==dl.TRIANGLES&&c.mode!==dl.TRIANGLE_STRIP&&c.mode!==dl.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=n.extensions[this.name].attributes,o=[],l={};for(const c in a)o.push(this.parser.getDependency("accessor",a[c]).then(h=>(l[c]=h,l[c])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(c=>{const h=c.pop(),f=h.isGroup?h.children:[h],p=c[0].count,g=[];for(const y of f){const x=new Pt,E=new de,_=new Xs,b=new de(1,1,1),C=new vB(y.geometry,y.material,p);for(let I=0;I<p;I++)l.TRANSLATION&&E.fromBufferAttribute(l.TRANSLATION,I),l.ROTATION&&_.fromBufferAttribute(l.ROTATION,I),l.SCALE&&b.fromBufferAttribute(l.SCALE,I),C.setMatrixAt(I,x.compose(E,_,b));for(const I in l)if(I==="_COLOR_0"){const M=l[I];C.instanceColor=new fm(M.array,M.itemSize,M.normalized)}else I!=="TRANSLATION"&&I!=="ROTATION"&&I!=="SCALE"&&y.geometry.setAttribute(I,l[I]);Qn.prototype.copy.call(C,y),this.parser.assignFinalMaterial(C),g.push(C)}return h.isGroup?(h.clear(),h.add(...g),h):g[0]}))}}const tH="glTF",Qy=12,XP={JSON:1313821514,BIN:5130562};class nne{constructor(e){this.name=Kn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Qy);if(this.header={magic:sT(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==tH)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Qy,i=new DataView(e,Qy);let r=0;for(;r<n;){const a=i.getUint32(r,!0);r+=4;const o=i.getUint32(r,!0);if(r+=4,o===XP.JSON){const l=new Uint8Array(e,Qy+r,a);this.content=sT(l)}else if(o===XP.BIN){const l=Qy+r;this.body=e.slice(l,l+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ine{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Kn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},l={},c={};for(const h in a){const f=qw[h]||h.toLowerCase();o[f]=a[h]}for(const h in e.attributes){const f=qw[h]||h.toLowerCase();if(a[h]!==void 0){const p=n.accessors[e.attributes[h]],g=bA[p.componentType];c[f]=g.name,l[f]=p.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(f,p){i.decodeDracoFile(h,function(g){for(const y in g.attributes){const x=g.attributes[y],E=l[y];E!==void 0&&(x.normalized=E)}f(g)},o,c,Mh,p)})})}}class sne{constructor(){this.name=Kn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class rne{constructor(){this.name=Kn.KHR_MESH_QUANTIZATION}}class nH extends c0{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let a=0;a!==i;a++)t[a]=n[r+a];return t}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=o*2,c=o*3,h=i-t,f=(n-t)/h,p=f*f,g=p*f,y=e*c,x=y-c,E=-2*g+3*p,_=g-p,b=1-E,C=_-p+f;for(let I=0;I!==o;I++){const M=a[x+I+o],R=a[x+I+l]*h,D=a[y+I+o],P=a[y+I]*h;r[I]=b*M+C*R+E*D+_*P}return r}}const ane=new Xs;class one extends nH{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return ane.fromArray(r).normalize().toArray(r),r}}const dl={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},bA={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WP={9728:Ws,9729:Si,9984:MT,9985:gA,9986:Vp,9987:Oo},$P={33071:Ur,33648:OA,10497:Cu},XI={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qw={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...YG>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Gf={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},lne={CUBICSPLINE:void 0,LINEAR:HA,STEP:GA},WI={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function cne(s){return s.DefaultMaterial===void 0&&(s.DefaultMaterial=new SE({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:bu})),s.DefaultMaterial}function Lp(s,e,t){for(const n in t.extensions)s[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function vh(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function une(s,e,t){let n=!1,i=!1,r=!1;for(let c=0,h=e.length;c<h;c++){const f=e[c];if(f.POSITION!==void 0&&(n=!0),f.NORMAL!==void 0&&(i=!0),f.COLOR_0!==void 0&&(r=!0),n&&i&&r)break}if(!n&&!i&&!r)return Promise.resolve(s);const a=[],o=[],l=[];for(let c=0,h=e.length;c<h;c++){const f=e[c];if(n){const p=f.POSITION!==void 0?t.getDependency("accessor",f.POSITION):s.attributes.position;a.push(p)}if(i){const p=f.NORMAL!==void 0?t.getDependency("accessor",f.NORMAL):s.attributes.normal;o.push(p)}if(r){const p=f.COLOR_0!==void 0?t.getDependency("accessor",f.COLOR_0):s.attributes.color;l.push(p)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(c){const h=c[0],f=c[1],p=c[2];return n&&(s.morphAttributes.position=h),i&&(s.morphAttributes.normal=f),r&&(s.morphAttributes.color=p),s.morphTargetsRelative=!0,s})}function hne(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)s.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function fne(s){let e;const t=s.extensions&&s.extensions[Kn.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+$I(t.attributes):e=s.indices+":"+$I(s.attributes)+":"+s.mode,s.targets!==void 0)for(let n=0,i=s.targets.length;n<i;n++)e+=":"+$I(s.targets[n]);return e}function $I(s){let e="";const t=Object.keys(s).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+s[t[n]]+";";return e}function Kw(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function dne(s){return s.search(/\.jpe?g($|\?)/i)>0||s.search(/^data\:image\/jpeg/)===0?"image/jpeg":s.search(/\.webp($|\?)/i)>0||s.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const pne=new Pt;class mne{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Fte,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,r=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&r<98?this.textureLoader=new bE(this.options.manager):this.textureLoader=new fG(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Js(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const o={scene:a[0][i.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:i.asset,parser:n,userData:{}};return Lp(r,o,i),vh(o,i),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){const a=t[i].joints;for(let o=0,l=a.length;o<l;o++)e[a[o]].isBone=!0}for(let i=0,r=e.length;i<r;i++){const a=e[i];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(a,o)=>{const l=this.associations.get(a);l!=null&&this.associations.set(o,l);for(const[c,h]of a.children.entries())r(h,o.children[c])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":i=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(r,a){return n.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Kn.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(r,a){n.load(Ih.resolveURL(t.uri,i.path),r,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const a=XI[i.type],o=bA[i.componentType],l=i.normalized===!0,c=new o(i.count*a);return Promise.resolve(new ei(c,a,l))}const r=[];return i.bufferView!==void 0?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),i.sparse!==void 0&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(a){const o=a[0],l=XI[i.type],c=bA[i.componentType],h=c.BYTES_PER_ELEMENT,f=h*l,p=i.byteOffset||0,g=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,y=i.normalized===!0;let x,E;if(g&&g!==f){const _=Math.floor(p/g),b="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+_+":"+i.count;let C=t.cache.get(b);C||(x=new c(o,_*g,i.count*g/h),C=new gE(x,g/h),t.cache.add(b,C)),E=new hd(C,l,p%g/h,y)}else o===null?x=new c(i.count*l):x=new c(o,p,i.count*l),E=new ei(x,l,y);if(i.sparse!==void 0){const _=XI.SCALAR,b=bA[i.sparse.indices.componentType],C=i.sparse.indices.byteOffset||0,I=i.sparse.values.byteOffset||0,M=new b(a[1],C,i.sparse.count*_),R=new c(a[2],I,i.sparse.count*l);o!==null&&(E=new ei(E.array.slice(),E.itemSize,E.normalized));for(let D=0,P=M.length;D<P;D++){const L=M[D];if(E.setX(L,R[D*l]),l>=2&&E.setY(L,R[D*l+1]),l>=3&&E.setZ(L,R[D*l+2]),l>=4&&E.setW(L,R[D*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return E})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,a=t.images[r];let o=this.textureLoader;if(a.uri){const l=n.manager.getHandler(a.uri);l!==null&&(o=l)}return this.loadTextureImage(e,r,o)}loadTextureImage(e,t,n){const i=this,r=this.json,a=r.textures[e],o=r.images[t],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,n).then(function(h){h.flipY=!1,h.name=a.name||o.name||"",h.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(h.name=o.uri);const p=(r.samplers||{})[a.sampler]||{};return h.magFilter=WP[p.magFilter]||Si,h.minFilter=WP[p.minFilter]||Oo,h.wrapS=$P[p.wrapS]||Cu,h.wrapT=$P[p.wrapT]||Cu,i.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const n=this,i=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(f=>f.clone());const a=i.images[e],o=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=n.getDependency("bufferView",a.bufferView).then(function(f){c=!0;const p=new Blob([f],{type:a.mimeType});return l=o.createObjectURL(p),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(f){return new Promise(function(p,g){let y=p;t.isImageBitmapLoader===!0&&(y=function(x){const E=new Hi(x);E.needsUpdate=!0,p(E)}),t.load(Ih.resolveURL(f,r.path),y,void 0,g)})}).then(function(f){return c===!0&&o.revokeObjectURL(l),vh(f,a),f.userData.mimeType=a.mimeType||dne(a.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),f});return this.sourceCache[e]=h,h}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),r.extensions[Kn.KHR_TEXTURE_TRANSFORM]){const o=n.extensions!==void 0?n.extensions[Kn.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=r.associations.get(a);a=r.extensions[Kn.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),r.associations.set(a,l)}}return i!==void 0&&(typeof i=="number"&&(i=i===YP?$p:Mh),"colorSpace"in a?a.colorSpace=i:a.encoding=i===$p?YP:Pte),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+n.uuid;let l=this.cache.get(o);l||(l=new $f,Ps.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(o,l)),n=l}else if(e.isLine){const o="LineBasicMaterial:"+n.uuid;let l=this.cache.get(o);l||(l=new $s,Ps.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(o,l)),n=l}if(i||r||a){let o="ClonedMaterial:"+n.uuid+":";i&&(o+="derivative-tangents:"),r&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=n.clone(),r&&(l.vertexColors=!0),a&&(l.flatShading=!0),i&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return SE}loadMaterial(e){const t=this,n=this.json,i=this.extensions,r=n.materials[e];let a;const o={},l=r.extensions||{},c=[];if(l[Kn.KHR_MATERIALS_UNLIT]){const f=i[Kn.KHR_MATERIALS_UNLIT];a=f.getMaterialType(),c.push(f.extendParams(o,r,t))}else{const f=r.pbrMetallicRoughness||{};if(o.color=new Tt(1,1,1),o.opacity=1,Array.isArray(f.baseColorFactor)){const p=f.baseColorFactor;o.color.setRGB(p[0],p[1],p[2],Mh),o.opacity=p[3]}f.baseColorTexture!==void 0&&c.push(t.assignTexture(o,"map",f.baseColorTexture,$p)),o.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,o.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(o,"metalnessMap",f.metallicRoughnessTexture)),c.push(t.assignTexture(o,"roughnessMap",f.metallicRoughnessTexture))),a=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,o)})))}r.doubleSided===!0&&(o.side=cc);const h=r.alphaMode||WI.OPAQUE;if(h===WI.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===WI.MASK&&(o.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&a!==io&&(c.push(t.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new We(1,1),r.normalTexture.scale!==void 0)){const f=r.normalTexture.scale;o.normalScale.set(f,f)}if(r.occlusionTexture!==void 0&&a!==io&&(c.push(t.assignTexture(o,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&a!==io){const f=r.emissiveFactor;o.emissive=new Tt().setRGB(f[0],f[1],f[2],Mh)}return r.emissiveTexture!==void 0&&a!==io&&c.push(t.assignTexture(o,"emissiveMap",r.emissiveTexture,$p)),Promise.all(c).then(function(){const f=new a(o);return r.name&&(f.name=r.name),vh(f,r),t.associations.set(f,{materials:e}),r.extensions&&Lp(i,f,r),f})}createUniqueName(e){const t=zn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function r(o){return n[Kn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(l){return JP(l,o,t)})}const a=[];for(let o=0,l=e.length;o<l;o++){const c=e[o],h=fne(c),f=i[h];if(f)a.push(f.promise);else{let p;c.extensions&&c.extensions[Kn.KHR_DRACO_MESH_COMPRESSION]?p=r(c):p=JP(new hn,c,t),i[h]={primitive:c,promise:p},a.push(p)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,i=this.extensions,r=n.meshes[e],a=r.primitives,o=[];for(let l=0,c=a.length;l<c;l++){const h=a[l].material===void 0?cne(this.cache):this.getDependency("material",a[l].material);o.push(h)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],f=[];for(let g=0,y=h.length;g<y;g++){const x=h[g],E=a[g];let _;const b=c[g];if(E.mode===dl.TRIANGLES||E.mode===dl.TRIANGLE_STRIP||E.mode===dl.TRIANGLE_FAN||E.mode===void 0)_=r.isSkinnedMesh===!0?new AE(x,b):new bi(x,b),_.isSkinnedMesh===!0&&_.normalizeSkinWeights(),E.mode===dl.TRIANGLE_STRIP?_.geometry=jP(_.geometry,fB):E.mode===dl.TRIANGLE_FAN&&(_.geometry=jP(_.geometry,Xb));else if(E.mode===dl.LINES)_=new Go(x,b);else if(E.mode===dl.LINE_STRIP)_=new Iu(x,b);else if(E.mode===dl.LINE_LOOP)_=new EB(x,b);else if(E.mode===dl.POINTS)_=new _A(x,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+E.mode);Object.keys(_.geometry.morphAttributes).length>0&&hne(_,r),_.name=t.createUniqueName(r.name||"mesh_"+e),vh(_,r),E.extensions&&Lp(i,_,E),t.assignFinalMaterial(_),f.push(_)}for(let g=0,y=f.length;g<y;g++)t.associations.set(f[g],{meshes:e,primitives:g});if(f.length===1)return r.extensions&&Lp(i,f[0],r),f[0];const p=new so;r.extensions&&Lp(i,p,r),t.associations.set(p,{meshes:e});for(let g=0,y=f.length;g<y;g++)p.add(f[g]);return p})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Ki(Fr.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new Nh(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),vh(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,r=t.joints.length;i<r;i++)n.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){const r=i.pop(),a=i,o=[],l=[];for(let c=0,h=a.length;c<h;c++){const f=a[c];if(f){o.push(f);const p=new Pt;r!==null&&p.fromArray(r.array,c*16),l.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new o0(o,l)})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],r=i.name?i.name:"animation_"+e,a=[],o=[],l=[],c=[],h=[];for(let f=0,p=i.channels.length;f<p;f++){const g=i.channels[f],y=i.samplers[g.sampler],x=g.target,E=x.node,_=i.parameters!==void 0?i.parameters[y.input]:y.input,b=i.parameters!==void 0?i.parameters[y.output]:y.output;x.node!==void 0&&(a.push(this.getDependency("node",E)),o.push(this.getDependency("accessor",_)),l.push(this.getDependency("accessor",b)),c.push(y),h.push(x))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(f){const p=f[0],g=f[1],y=f[2],x=f[3],E=f[4],_=[];for(let b=0,C=p.length;b<C;b++){const I=p[b],M=g[b],R=y[b],D=x[b],P=E[b];if(I===void 0)continue;I.updateMatrix&&I.updateMatrix();const L=n._createAnimationTracks(I,M,R,D,P);if(L)for(let O=0;O<L.length;O++)_.push(L[O])}return new pm(r,void 0,_)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(r){const a=n._getNodeRef(n.meshCache,i.mesh,r);return i.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let l=0,c=i.weights.length;l<c;l++)o.morphTargetInfluences[l]=i.weights[l]}),a})}loadNode(e){const t=this.json,n=this,i=t.nodes[e],r=n._loadNodeShallow(e),a=[],o=i.children||[];for(let c=0,h=o.length;c<h;c++)a.push(n.getDependency("node",o[c]));const l=i.skin===void 0?Promise.resolve(null):n.getDependency("skin",i.skin);return Promise.all([r,Promise.all(a),l]).then(function(c){const h=c[0],f=c[1],p=c[2];p!==null&&h.traverse(function(g){g.isSkinnedMesh&&g.bind(p,pne)});for(let g=0,y=f.length;g<y;g++)h.add(f[g]);return h})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],a=r.name?i.createUniqueName(r.name):"",o=[],l=i._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&o.push(l),r.camera!==void 0&&o.push(i.getDependency("camera",r.camera).then(function(c){return i._getNodeRef(i.cameraCache,r.camera,c)})),i._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){o.push(c)}),this.nodeCache[e]=Promise.all(o).then(function(c){let h;if(r.isBone===!0?h=new qA:c.length>1?h=new so:c.length===1?h=c[0]:h=new Qn,h!==c[0])for(let f=0,p=c.length;f<p;f++)h.add(c[f]);if(r.name&&(h.userData.name=r.name,h.name=a),vh(h,r),r.extensions&&Lp(n,h,r),r.matrix!==void 0){const f=new Pt;f.fromArray(r.matrix),h.applyMatrix4(f)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return i.associations.has(h)||i.associations.set(h,{}),i.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,r=new so;n.name&&(r.name=i.createUniqueName(n.name)),vh(r,n),n.extensions&&Lp(t,r,n);const a=n.nodes||[],o=[];for(let l=0,c=a.length;l<c;l++)o.push(i.getDependency("node",a[l]));return Promise.all(o).then(function(l){for(let h=0,f=l.length;h<f;h++)r.add(l[h]);const c=h=>{const f=new Map;for(const[p,g]of i.associations)(p instanceof Ps||p instanceof Hi)&&f.set(p,g);return h.traverse(p=>{const g=i.associations.get(p);g!=null&&f.set(p,g)}),f};return i.associations=c(r),r})}_createAnimationTracks(e,t,n,i,r){const a=[],o=e.name?e.name:e.uuid,l=[];Gf[r.path]===Gf.weights?e.traverse(function(p){p.morphTargetInfluences&&l.push(p.name?p.name:p.uuid)}):l.push(o);let c;switch(Gf[r.path]){case Gf.weights:c=fd;break;case Gf.rotation:c=dd;break;case Gf.position:case Gf.scale:c=pd;break;default:switch(n.itemSize){case 1:c=fd;break;case 2:case 3:default:c=pd;break}break}const h=i.interpolation!==void 0?lne[i.interpolation]:HA,f=this._getArrayFromAccessor(n);for(let p=0,g=l.length;p<g;p++){const y=new c(l[p]+"."+Gf[r.path],t.array,f,h);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(y),a.push(y)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=Kw(t.constructor),i=new Float32Array(t.length);for(let r=0,a=t.length;r<a;r++)i[r]=t[r]*n;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const i=this instanceof dd?one:nH;return new i(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function gne(s,e,t){const n=e.attributes,i=new kr;if(n.POSITION!==void 0){const o=t.json.accessors[n.POSITION],l=o.min,c=o.max;if(l!==void 0&&c!==void 0){if(i.set(new de(l[0],l[1],l[2]),new de(c[0],c[1],c[2])),o.normalized){const h=Kw(bA[o.componentType]);i.min.multiplyScalar(h),i.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const o=new de,l=new de;for(let c=0,h=r.length;c<h;c++){const f=r[c];if(f.POSITION!==void 0){const p=t.json.accessors[f.POSITION],g=p.min,y=p.max;if(g!==void 0&&y!==void 0){if(l.setX(Math.max(Math.abs(g[0]),Math.abs(y[0]))),l.setY(Math.max(Math.abs(g[1]),Math.abs(y[1]))),l.setZ(Math.max(Math.abs(g[2]),Math.abs(y[2]))),p.normalized){const x=Kw(bA[p.componentType]);l.multiplyScalar(x)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(o)}s.boundingBox=i;const a=new Sr;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,s.boundingSphere=a}function JP(s,e,t){const n=e.attributes,i=[];function r(a,o){return t.getDependency("accessor",a).then(function(l){s.setAttribute(o,l)})}for(const a in n){const o=qw[a]||a.toLowerCase();o in s.attributes||i.push(r(n[a],o))}if(e.indices!==void 0&&!s.index){const a=t.getDependency("accessor",e.indices).then(function(o){s.setIndex(o)});i.push(a)}return vh(s,e),gne(s,e,t),Promise.all(i).then(function(){return e.targets!==void 0?une(s,e.targets,t):s})}class Ane extends EE{constructor(e,t={}){const{bevelEnabled:n=!1,bevelSize:i=8,bevelThickness:r=10,font:a,height:o=50,size:l=100,lineHeight:c=1,letterSpacing:h=0,...f}=t;if(a===void 0)super();else{const p=a.generateShapes(e,l,{lineHeight:c,letterSpacing:h});super(p,{...f,bevelEnabled:n,bevelSize:i,bevelThickness:r,depth:o})}this.type="TextGeometry"}}var yne=Object.defineProperty,vne=(s,e,t)=>e in s?yne(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,JI=(s,e,t)=>(vne(s,typeof e!="symbol"?e+"":e,t),t);class iH extends Fs{constructor(e){super(e)}load(e,t,n,i){const r=new Js(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,a=>{if(typeof a!="string")throw new Error("unsupported data type");const o=JSON.parse(a),l=this.parse(o);t&&t(l)},n,i)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new Ene(e)}}class Ene{constructor(e){JI(this,"data"),JI(this,"isFont",!0),JI(this,"type","Font"),this.data=e}generateShapes(e,t=100,n){const i=[],r={letterSpacing:0,lineHeight:1,...n},a=xne(e,t,this.data,r);for(let o=0,l=a.length;o<l;o++)Array.prototype.push.apply(i,a[o].toShapes(!1));return i}}function xne(s,e,t,n){const i=Array.from(s),r=e/t.resolution,a=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*r,o=[];let l=0,c=0;for(let h=0;h<i.length;h++){const f=i[h];if(f===`
`)l=0,c-=a*n.lineHeight;else{const p=_ne(f,r,l,c,t);p&&(l+=p.offsetX+n.letterSpacing,o.push(p.path))}}return o}function _ne(s,e,t,n,i){const r=i.glyphs[s]||i.glyphs["?"];if(!r){console.error('THREE.Font: character "'+s+'" does not exists in font family '+i.familyName+".");return}const a=new yh;let o,l,c,h,f,p,g,y;if(r.o){const x=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let E=0,_=x.length;E<_;)switch(x[E++]){case"m":o=parseInt(x[E++])*e+t,l=parseInt(x[E++])*e+n,a.moveTo(o,l);break;case"l":o=parseInt(x[E++])*e+t,l=parseInt(x[E++])*e+n,a.lineTo(o,l);break;case"q":c=parseInt(x[E++])*e+t,h=parseInt(x[E++])*e+n,f=parseInt(x[E++])*e+t,p=parseInt(x[E++])*e+n,a.quadraticCurveTo(f,p,c,h);break;case"b":c=parseInt(x[E++])*e+t,h=parseInt(x[E++])*e+n,f=parseInt(x[E++])*e+t,p=parseInt(x[E++])*e+n,g=parseInt(x[E++])*e+t,y=parseInt(x[E++])*e+n,a.bezierCurveTo(f,p,g,y,c,h);break}}return{offsetX:r.ha*e,path:a}}class Sne extends Hi{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Ws,this.minFilter=Ws,this.wrapR=Ur,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bne{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:i,msg:r,transfer:a}=this.queue.shift();this.workersResolve[e]=i,this.workers[e].postMessage(r,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const i=this._getIdleWorker();i!==-1?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=n,this.workers[i].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const sH=0,ZP=2,Tne=0,Cne=0,Ine=2,Mne=0,wne=0,Rne=1,Yw=2,Bne=0,rH=1,Dne=10,Lne=64,aH=0,oH=9,lH=15,cH=16,uH=22,hH=37,fH=43,dH=76,pH=83,mH=97,gH=100,AH=103,yH=109,vH=165,EH=166;class One{constructor(){this.vkFormat=aH,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=sH,this.levels=[],this.dataFormatDescriptor=[{vendorId:Cne,descriptorType:Tne,descriptorBlockSize:0,versionNumber:Ine,colorModel:Mne,colorPrimaries:rH,transferFunction:Yw,flags:wne,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Vy{constructor(e,t,n,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*t;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){t===void 0&&(t=0);const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const ba=[171,75,84,88,32,50,48,187,13,10,26,10];function eN(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}function Pne(s){const e=new Uint8Array(s.buffer,s.byteOffset,ba.length);if(e[0]!==ba[0]||e[1]!==ba[1]||e[2]!==ba[2]||e[3]!==ba[3]||e[4]!==ba[4]||e[5]!==ba[5]||e[6]!==ba[6]||e[7]!==ba[7]||e[8]!==ba[8]||e[9]!==ba[9]||e[10]!==ba[10]||e[11]!==ba[11])throw new Error("Missing KTX 2.0 identifier.");const t=new One,n=17*Uint32Array.BYTES_PER_ELEMENT,i=new Vy(s,ba.length,n,!0);t.vkFormat=i._nextUint32(),t.typeSize=i._nextUint32(),t.pixelWidth=i._nextUint32(),t.pixelHeight=i._nextUint32(),t.pixelDepth=i._nextUint32(),t.layerCount=i._nextUint32(),t.faceCount=i._nextUint32();const r=i._nextUint32();t.supercompressionScheme=i._nextUint32();const a=i._nextUint32(),o=i._nextUint32(),l=i._nextUint32(),c=i._nextUint32(),h=i._nextUint64(),f=i._nextUint64(),p=r*3*8,g=new Vy(s,ba.length+n,p,!0);for(let K=0;K<r;K++)t.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+g._nextUint64(),g._nextUint64()),uncompressedByteLength:g._nextUint64()});const y=new Vy(s,a,o,!0),x={vendorId:y._skip(4)._nextUint16(),descriptorType:y._nextUint16(),versionNumber:y._nextUint16(),descriptorBlockSize:y._nextUint16(),colorModel:y._nextUint8(),colorPrimaries:y._nextUint8(),transferFunction:y._nextUint8(),flags:y._nextUint8(),texelBlockDimension:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],bytesPlane:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],samples:[]},b=(x.descriptorBlockSize/4-6)/4;for(let K=0;K<b;K++){const te={bitOffset:y._nextUint16(),bitLength:y._nextUint8(),channelType:y._nextUint8(),samplePosition:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};te.channelType&Lne?(te.sampleLower=y._nextInt32(),te.sampleUpper=y._nextInt32()):(te.sampleLower=y._nextUint32(),te.sampleUpper=y._nextUint32()),x.samples[K]=te}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(x);const C=new Vy(s,l,c,!0);for(;C._offset<c;){const K=C._nextUint32(),te=C._scan(K),oe=eN(te);if(t.keyValue[oe]=C._nextUint8Array(K-te.byteLength-1),oe.match(/^ktx/i)){const Ce=eN(t.keyValue[oe]);t.keyValue[oe]=Ce.substring(0,Ce.lastIndexOf("\0"))}const Ee=K%4?4-K%4:0;C._skip(Ee)}if(f<=0)return t;const I=new Vy(s,h,f,!0),M=I._nextUint16(),R=I._nextUint16(),D=I._nextUint32(),P=I._nextUint32(),L=I._nextUint32(),O=I._nextUint32(),U=[];for(let K=0;K<r;K++)U.push({imageFlags:I._nextUint32(),rgbSliceByteOffset:I._nextUint32(),rgbSliceByteLength:I._nextUint32(),alphaSliceByteOffset:I._nextUint32(),alphaSliceByteLength:I._nextUint32()});const j=h+I._offset,H=j+D,z=H+P,q=z+L,k=new Uint8Array(s.buffer,s.byteOffset+j,D),W=new Uint8Array(s.buffer,s.byteOffset+H,P),V=new Uint8Array(s.buffer,s.byteOffset+z,L),X=new Uint8Array(s.buffer,s.byteOffset+q,O);return t.globalData={endpointCount:M,selectorCount:R,imageDescs:U,endpointsData:k,selectorsData:W,tablesData:V,extendedData:X},t}let jy,mh,Xw;const ZI={env:{emscripten_notify_memory_growth:function(s){Xw=new Uint8Array(mh.exports.memory.buffer)}}};class Nne{init(){return jy||(typeof fetch<"u"?jy=fetch("data:application/wasm;base64,"+tN).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,ZI)).then(this._init):jy=WebAssembly.instantiate(Buffer.from(tN,"base64"),ZI).then(this._init),jy)}_init(e){mh=e.instance,ZI.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!mh)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,i=mh.exports.malloc(n);Xw.set(e,i),t=t||Number(mh.exports.ZSTD_findDecompressedSize(i,n));const r=mh.exports.malloc(t),a=mh.exports.ZSTD_decompress(r,t,i,n),o=Xw.slice(r,r+a);return mh.exports.free(i),mh.exports.free(r),o}}const tN="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";class Fne extends vd{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,Tu),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class Une extends vd{constructor(e,t,n,i,r,a){super(e,t,n,r,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=Ur}}var kne=Object.defineProperty,Gne=(s,e,t)=>e in s?kne(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,SS=(s,e,t)=>(Gne(s,typeof e!="symbol"?e+"":e,t),t);const xH=3e3,_H=3001,nN="",Hne="display-p3",zne="display-p3-linear",Qne="srgb-linear",WB="srgb",eM=new WeakMap;let tM=0,nM;const Vne=(()=>{const s=class extends Fs{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new bne,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}detectSupport(t){return this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},t.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const t=new Js(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const n=t.loadAsync("basis_transcoder.js"),i=new Js(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const r=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([n,r]).then(([a,o])=>{const l=s.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(s.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(s.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(s.BasisFormat),"/* basis_transcoder.js */",a,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const h=new Worker(this.workerSourceURL),f=this.transcoderBinary.slice(0);return h.postMessage({type:"init",config:this.workerConfig,transcoderBinary:f},[f]),h})}),tM>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),tM++}return this.transcoderPending}load(t,n,i,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const a=new Js(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials),a.load(t,o=>{if(eM.has(o))return eM.get(o).promise.then(n).catch(r);this._createTexture(o).then(l=>n?n(l):null).catch(r)},i,r)}_createTextureFrom(t,n){const{faces:i,width:r,height:a,format:o,type:l,error:c,dfdFlags:h}=t;if(l==="error")return Promise.reject(c);let f;if(n.faceCount===6)f=new Fne(i,o,ds);else{const g=i[0].mipmaps;f=n.layerCount>1?new Une(g,r,a,n.layerCount,o,ds):new vd(g,r,a,o,ds)}f.minFilter=i[0].mipmaps.length===1?Si:Oo,f.magFilter=Si,f.generateMipmaps=!1,f.needsUpdate=!0;const p=SH(n);return"colorSpace"in f?f.colorSpace=p:f.encoding=p===WB?_H:xH,f.premultiplyAlpha=!!(h&Rne),f}async _createTexture(t,n={}){const i=Pne(new Uint8Array(t));if(i.vkFormat!==aH)return qne(i);const r=n,a=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:r},[t])).then(o=>this._createTextureFrom(o.data,i));return eM.set(t,{promise:a}),a}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),tM--,this}};let e=s;return SS(e,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),SS(e,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),SS(e,"EngineFormat",{RGBAFormat:rs,RGBA_ASTC_4x4_Format:kv,RGBA_BPTC_Format:vA,RGBA_ETC2_EAC_Format:Uv,RGBA_PVRTC_4BPPV1_Format:Pv,RGBA_S3TC_DXT5_Format:yA,RGB_ETC1_Format:Nv,RGB_ETC2_Format:Fv,RGB_PVRTC_4BPPV1_Format:Ov,RGB_S3TC_DXT1_Format:AA}),SS(e,"BasisWorker",function(){let t,n,i;const r=_EngineFormat,a=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(E){const _=E.data;switch(_.type){case"init":t=_.config,l(_.transcoderBinary);break;case"transcode":n.then(()=>{try{const{faces:b,buffers:C,width:I,height:M,hasAlpha:R,format:D,dfdFlags:P}=c(_.buffer);self.postMessage({type:"transcode",id:_.id,faces:b,width:I,height:M,hasAlpha:R,format:D,dfdFlags:P},C)}catch(b){console.error(b),self.postMessage({type:"error",id:_.id,error:b.message})}});break}});function l(E){n=new Promise(_=>{i={wasmBinary:E,onRuntimeInitialized:_},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function c(E){const _=new i.KTX2File(new Uint8Array(E));function b(){_.close(),_.delete()}if(!_.isValid())throw b(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const C=_.isUASTC()?o.UASTC_4x4:o.ETC1S,I=_.getWidth(),M=_.getHeight(),R=_.getLayers()||1,D=_.getLevels(),P=_.getFaces(),L=_.getHasAlpha(),O=_.getDFDFlags(),{transcoderFormat:U,engineFormat:j}=g(C,I,M,L);if(!I||!M||!D)throw b(),new Error("THREE.KTX2Loader:	Invalid texture");if(!_.startTranscoding())throw b(),new Error("THREE.KTX2Loader: .startTranscoding failed");const H=[],z=[];for(let q=0;q<P;q++){const k=[];for(let W=0;W<D;W++){const V=[];let X,K;for(let oe=0;oe<R;oe++){const Ee=_.getImageLevelInfo(W,oe,q);q===0&&W===0&&oe===0&&(Ee.origWidth%4!==0||Ee.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),D>1?(X=Ee.origWidth,K=Ee.origHeight):(X=Ee.width,K=Ee.height);const Ce=new Uint8Array(_.getImageTranscodedSizeInBytes(W,oe,0,U));if(!_.transcodeImage(Ce,W,oe,q,U,0,-1,-1))throw b(),new Error("THREE.KTX2Loader: .transcodeImage failed.");V.push(Ce)}const te=x(V);k.push({data:te,width:X,height:K}),z.push(te.buffer)}H.push({mipmaps:k,width:I,height:M,format:j})}return b(),{faces:H,buffers:z,width:I,height:M,hasAlpha:L,format:j,dfdFlags:O}}const h=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[a.BC1,a.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[a.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],f=h.sort(function(E,_){return E.priorityETC1S-_.priorityETC1S}),p=h.sort(function(E,_){return E.priorityUASTC-_.priorityUASTC});function g(E,_,b,C){let I,M;const R=E===o.ETC1S?f:p;for(let D=0;D<R.length;D++){const P=R[D];if(t[P.if]&&P.basisFormat.includes(E)&&!(C&&P.transcoderFormat.length<2)&&!(P.needsPowerOfTwo&&!(y(_)&&y(b))))return I=P.transcoderFormat[C?1:0],M=P.engineFormat[C?1:0],{transcoderFormat:I,engineFormat:M}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),I=a.RGBA32,M=r.RGBAFormat,{transcoderFormat:I,engineFormat:M}}function y(E){return E<=2?!0:(E&E-1)===0&&E!==0}function x(E){if(E.length===1)return E[0];let _=0;for(let I=0;I<E.length;I++){const M=E[I];_+=M.byteLength}const b=new Uint8Array(_);let C=0;for(let I=0;I<E.length;I++){const M=E[I];b.set(M,C),C+=M.byteLength}return b}}),e})(),jne=new Set([rs,Xf,gu]),iM={[yH]:rs,[mH]:rs,[hH]:rs,[fH]:rs,[AH]:Xf,[pH]:Xf,[cH]:Xf,[uH]:Xf,[gH]:gu,[dH]:gu,[lH]:gu,[oH]:gu,[EH]:kA,[vH]:kA},sM={[yH]:ss,[mH]:hr,[hH]:ds,[fH]:ds,[AH]:ss,[pH]:hr,[cH]:ds,[uH]:ds,[gH]:ss,[dH]:hr,[lH]:ds,[oH]:ds,[EH]:ds,[vH]:ds};async function qne(s){const{vkFormat:e}=s;if(iM[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;s.supercompressionScheme===ZP&&(nM||(nM=new Promise(async a=>{const o=new Nne;await o.init(),a(o)})),t=await nM);const n=[];for(let a=0;a<s.levels.length;a++){const o=Math.max(1,s.pixelWidth>>a),l=Math.max(1,s.pixelHeight>>a),c=s.pixelDepth?Math.max(1,s.pixelDepth>>a):0,h=s.levels[a];let f;if(s.supercompressionScheme===sH)f=h.levelData;else if(s.supercompressionScheme===ZP)f=t.decode(h.levelData,h.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let p;sM[e]===ss?p=new Float32Array(f.buffer,f.byteOffset,f.byteLength/Float32Array.BYTES_PER_ELEMENT):sM[e]===hr?p=new Uint16Array(f.buffer,f.byteOffset,f.byteLength/Uint16Array.BYTES_PER_ELEMENT):p=f,n.push({data:p,width:o,height:l,depth:c})}let i;if(jne.has(iM[e]))i=s.pixelDepth===0?new fc(n[0].data,s.pixelWidth,s.pixelHeight):new Sne(n[0].data,s.pixelWidth,s.pixelHeight,s.pixelDepth);else{if(s.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");i=new vd(n,s.pixelWidth,s.pixelHeight)}i.mipmaps=n,i.type=sM[e],i.format=iM[e],i.needsUpdate=!0;const r=SH(s);return"colorSpace"in i?i.colorSpace=r:i.encoding=r===WB?_H:xH,Promise.resolve(i)}function SH(s){const e=s.dataFormatDescriptor[0];return e.colorPrimaries===rH?e.transferFunction===Yw?WB:Qne:e.colorPrimaries===Dne?e.transferFunction===Yw?Hne:zne:(e.colorPrimaries===Bne||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),nN)}class Kne extends NB{constructor(e){super(e),this.type=hr}parse(e){const a=function(P,L){switch(P){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(L||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(L||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(L||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(L||""))}},f=function(P,L,O){L=L||1024;let j=P.pos,H=-1,z=0,q="",k=String.fromCharCode.apply(null,new Uint16Array(P.subarray(j,j+128)));for(;0>(H=k.indexOf(`
`))&&z<L&&j<P.byteLength;)q+=k,z+=k.length,j+=128,k+=String.fromCharCode.apply(null,new Uint16Array(P.subarray(j,j+128)));return-1<H?(P.pos+=z+H+1,q+k.slice(0,H)):!1},p=function(P){const L=/^#\?(\S+)/,O=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,j=/^\s*FORMAT=(\S+)\s*$/,H=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,z={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let q,k;for((P.pos>=P.byteLength||!(q=f(P)))&&a(1,"no header found"),(k=q.match(L))||a(3,"bad initial token"),z.valid|=1,z.programtype=k[1],z.string+=q+`
`;q=f(P),q!==!1;){if(z.string+=q+`
`,q.charAt(0)==="#"){z.comments+=q+`
`;continue}if((k=q.match(O))&&(z.gamma=parseFloat(k[1])),(k=q.match(U))&&(z.exposure=parseFloat(k[1])),(k=q.match(j))&&(z.valid|=2,z.format=k[1]),(k=q.match(H))&&(z.valid|=4,z.height=parseInt(k[1],10),z.width=parseInt(k[2],10)),z.valid&2&&z.valid&4)break}return z.valid&2||a(3,"missing format specifier"),z.valid&4||a(3,"missing image size specifier"),z},g=function(P,L,O){const U=L;if(U<8||U>32767||P[0]!==2||P[1]!==2||P[2]&128)return new Uint8Array(P);U!==(P[2]<<8|P[3])&&a(3,"wrong scanline width");const j=new Uint8Array(4*L*O);j.length||a(4,"unable to allocate buffer space");let H=0,z=0;const q=4*U,k=new Uint8Array(4),W=new Uint8Array(q);let V=O;for(;V>0&&z<P.byteLength;){z+4>P.byteLength&&a(1),k[0]=P[z++],k[1]=P[z++],k[2]=P[z++],k[3]=P[z++],(k[0]!=2||k[1]!=2||(k[2]<<8|k[3])!=U)&&a(3,"bad rgbe scanline format");let X=0,K;for(;X<q&&z<P.byteLength;){K=P[z++];const oe=K>128;if(oe&&(K-=128),(K===0||X+K>q)&&a(3,"bad scanline data"),oe){const Ee=P[z++];for(let Ce=0;Ce<K;Ce++)W[X++]=Ee}else W.set(P.subarray(z,z+K),X),X+=K,z+=K}const te=U;for(let oe=0;oe<te;oe++){let Ee=0;j[H]=W[oe+Ee],Ee+=U,j[H+1]=W[oe+Ee],Ee+=U,j[H+2]=W[oe+Ee],Ee+=U,j[H+3]=W[oe+Ee],H+=4}V--}return j},y=function(P,L,O,U){const j=P[L+3],H=Math.pow(2,j-128)/255;O[U+0]=P[L+0]*H,O[U+1]=P[L+1]*H,O[U+2]=P[L+2]*H,O[U+3]=1},x=function(P,L,O,U){const j=P[L+3],H=Math.pow(2,j-128)/255;O[U+0]=Kp.toHalfFloat(Math.min(P[L+0]*H,65504)),O[U+1]=Kp.toHalfFloat(Math.min(P[L+1]*H,65504)),O[U+2]=Kp.toHalfFloat(Math.min(P[L+2]*H,65504)),O[U+3]=Kp.toHalfFloat(1)},E=new Uint8Array(e);E.pos=0;const _=p(E),b=_.width,C=_.height,I=g(E.subarray(E.pos),b,C);let M,R,D;switch(this.type){case ss:D=I.length/4;const P=new Float32Array(D*4);for(let O=0;O<D;O++)y(I,O*4,P,O*4);M=P,R=ss;break;case hr:D=I.length/4;const L=new Uint16Array(D*4);for(let O=0;O<D;O++)x(I,O*4,L,O*4);M=L,R=hr;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:b,height:C,data:M,header:_.string,gamma:_.gamma,exposure:_.exposure,type:R}}setDataType(e){return this.type=e,this}load(e,t,n,i){function r(a,o){switch(a.type){case ss:case hr:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=Si,a.magFilter=Si,a.generateMipmaps=!1,a.flipY=!0;break}t&&t(a,o)}return super.load(e,r,n,i)}}const qy=YG>=152;class Yne extends NB{constructor(e){super(e),this.type=hr}parse(e){const L=Math.pow(2.7182818,2.2);function O(Z,fe){for(var we=0,qe=0;qe<65536;++qe)(qe==0||Z[qe>>3]&1<<(qe&7))&&(fe[we++]=qe);for(var Ye=we-1;we<65536;)fe[we++]=0;return Ye}function U(Z){for(var fe=0;fe<16384;fe++)Z[fe]={},Z[fe].len=0,Z[fe].lit=0,Z[fe].p=null}const j={l:0,c:0,lc:0};function H(Z,fe,we,qe,Ye){for(;we<Z;)fe=fe<<8|Qt(qe,Ye),we+=8;we-=Z,j.l=fe>>we&(1<<Z)-1,j.c=fe,j.lc=we}const z=new Array(59);function q(Z){for(var fe=0;fe<=58;++fe)z[fe]=0;for(var fe=0;fe<65537;++fe)z[Z[fe]]+=1;for(var we=0,fe=58;fe>0;--fe){var qe=we+z[fe]>>1;z[fe]=we,we=qe}for(var fe=0;fe<65537;++fe){var Ye=Z[fe];Ye>0&&(Z[fe]=Ye|z[Ye]++<<6)}}function k(Z,fe,we,qe,Ye,it,xt){for(var J=we,ye=0,_e=0;Ye<=it;Ye++){if(J.value-we.value>qe)return!1;H(6,ye,_e,Z,J);var Me=j.l;if(ye=j.c,_e=j.lc,xt[Ye]=Me,Me==63){if(J.value-we.value>qe)throw"Something wrong with hufUnpackEncTable";H(8,ye,_e,Z,J);var xe=j.l+6;if(ye=j.c,_e=j.lc,Ye+xe>it+1)throw"Something wrong with hufUnpackEncTable";for(;xe--;)xt[Ye++]=0;Ye--}else if(Me>=59){var xe=Me-59+2;if(Ye+xe>it+1)throw"Something wrong with hufUnpackEncTable";for(;xe--;)xt[Ye++]=0;Ye--}}q(xt)}function W(Z){return Z&63}function V(Z){return Z>>6}function X(Z,fe,we,qe){for(;fe<=we;fe++){var Ye=V(Z[fe]),it=W(Z[fe]);if(Ye>>it)throw"Invalid table entry";if(it>14){var xt=qe[Ye>>it-14];if(xt.len)throw"Invalid table entry";if(xt.lit++,xt.p){var J=xt.p;xt.p=new Array(xt.lit);for(var ye=0;ye<xt.lit-1;++ye)xt.p[ye]=J[ye]}else xt.p=new Array(1);xt.p[xt.lit-1]=fe}else if(it)for(var _e=0,ye=1<<14-it;ye>0;ye--){var xt=qe[(Ye<<14-it)+_e];if(xt.len||xt.p)throw"Invalid table entry";xt.len=it,xt.lit=fe,_e++}}return!0}const K={c:0,lc:0};function te(Z,fe,we,qe){Z=Z<<8|Qt(we,qe),fe+=8,K.c=Z,K.lc=fe}const oe={c:0,lc:0};function Ee(Z,fe,we,qe,Ye,it,xt,J,ye,_e){if(Z==fe){qe<8&&(te(we,qe,Ye,xt),we=K.c,qe=K.lc),qe-=8;var Me=we>>qe,Me=new Uint8Array([Me])[0];if(ye.value+Me>_e)return!1;for(var xe=J[ye.value-1];Me-- >0;)J[ye.value++]=xe}else if(ye.value<_e)J[ye.value++]=Z;else return!1;oe.c=we,oe.lc=qe}function Ce(Z){return Z&65535}function se(Z){var fe=Ce(Z);return fe>32767?fe-65536:fe}const ie={a:0,b:0};function ne(Z,fe){var we=se(Z),qe=se(fe),Ye=qe,it=we+(Ye&1)+(Ye>>1),xt=it,J=it-Ye;ie.a=xt,ie.b=J}function re(Z,fe){var we=Ce(Z),qe=Ce(fe),Ye=we-(qe>>1)&65535,it=qe+Ye-32768&65535;ie.a=it,ie.b=Ye}function Be(Z,fe,we,qe,Ye,it,xt){for(var J=xt<16384,ye=we>Ye?Ye:we,_e=1,Me;_e<=ye;)_e<<=1;for(_e>>=1,Me=_e,_e>>=1;_e>=1;){for(var xe=0,ht=xe+it*(Ye-Me),tt=it*_e,at=it*Me,ot=qe*_e,_t=qe*Me,wt,It,Kt,on;xe<=ht;xe+=at){for(var nn=xe,Cn=xe+qe*(we-Me);nn<=Cn;nn+=_t){var Ht=nn+ot,Dt=nn+tt,Vn=Dt+ot;J?(ne(Z[nn+fe],Z[Dt+fe]),wt=ie.a,Kt=ie.b,ne(Z[Ht+fe],Z[Vn+fe]),It=ie.a,on=ie.b,ne(wt,It),Z[nn+fe]=ie.a,Z[Ht+fe]=ie.b,ne(Kt,on),Z[Dt+fe]=ie.a,Z[Vn+fe]=ie.b):(re(Z[nn+fe],Z[Dt+fe]),wt=ie.a,Kt=ie.b,re(Z[Ht+fe],Z[Vn+fe]),It=ie.a,on=ie.b,re(wt,It),Z[nn+fe]=ie.a,Z[Ht+fe]=ie.b,re(Kt,on),Z[Dt+fe]=ie.a,Z[Vn+fe]=ie.b)}if(we&_e){var Dt=nn+tt;J?ne(Z[nn+fe],Z[Dt+fe]):re(Z[nn+fe],Z[Dt+fe]),wt=ie.a,Z[Dt+fe]=ie.b,Z[nn+fe]=wt}}if(Ye&_e)for(var nn=xe,Cn=xe+qe*(we-Me);nn<=Cn;nn+=_t){var Ht=nn+ot;J?ne(Z[nn+fe],Z[Ht+fe]):re(Z[nn+fe],Z[Ht+fe]),wt=ie.a,Z[Ht+fe]=ie.b,Z[nn+fe]=wt}Me=_e,_e>>=1}return xe}function Ge(Z,fe,we,qe,Ye,it,xt,J,ye,_e){for(var Me=0,xe=0,ht=J,tt=Math.trunc(Ye.value+(it+7)/8);Ye.value<tt;)for(te(Me,xe,we,Ye),Me=K.c,xe=K.lc;xe>=14;){var at=Me>>xe-14&16383,ot=fe[at];if(ot.len)xe-=ot.len,Ee(ot.lit,xt,Me,xe,we,qe,Ye,ye,_e,ht),Me=oe.c,xe=oe.lc;else{if(!ot.p)throw"hufDecode issues";var _t;for(_t=0;_t<ot.lit;_t++){for(var wt=W(Z[ot.p[_t]]);xe<wt&&Ye.value<tt;)te(Me,xe,we,Ye),Me=K.c,xe=K.lc;if(xe>=wt&&V(Z[ot.p[_t]])==(Me>>xe-wt&(1<<wt)-1)){xe-=wt,Ee(ot.p[_t],xt,Me,xe,we,qe,Ye,ye,_e,ht),Me=oe.c,xe=oe.lc;break}}if(_t==ot.lit)throw"hufDecode issues"}}var It=8-it&7;for(Me>>=It,xe-=It;xe>0;){var ot=fe[Me<<14-xe&16383];if(ot.len)xe-=ot.len,Ee(ot.lit,xt,Me,xe,we,qe,Ye,ye,_e,ht),Me=oe.c,xe=oe.lc;else throw"hufDecode issues"}return!0}function Ue(Z,fe,we,qe,Ye,it){var xt={value:0},J=we.value,ye=At(fe,we),_e=At(fe,we);we.value+=4;var Me=At(fe,we);if(we.value+=4,ye<0||ye>=65537||_e<0||_e>=65537)throw"Something wrong with HUF_ENCSIZE";var xe=new Array(65537),ht=new Array(16384);U(ht);var tt=qe-(we.value-J);if(k(Z,fe,we,tt,ye,_e,xe),Me>8*(qe-(we.value-J)))throw"Something wrong with hufUncompress";X(xe,ye,_e,ht),Ge(xe,ht,Z,fe,we,Me,_e,it,Ye,xt)}function nt(Z,fe,we){for(var qe=0;qe<we;++qe)fe[qe]=Z[fe[qe]]}function pe(Z){for(var fe=1;fe<Z.length;fe++){var we=Z[fe-1]+Z[fe]-128;Z[fe]=we}}function ve(Z,fe){for(var we=0,qe=Math.floor((Z.length+1)/2),Ye=0,it=Z.length-1;!(Ye>it||(fe[Ye++]=Z[we++],Ye>it));)fe[Ye++]=Z[qe++]}function Ae(Z){for(var fe=Z.byteLength,we=new Array,qe=0,Ye=new DataView(Z);fe>0;){var it=Ye.getInt8(qe++);if(it<0){var xt=-it;fe-=xt+1;for(var J=0;J<xt;J++)we.push(Ye.getUint8(qe++))}else{var xt=it;fe-=2;for(var ye=Ye.getUint8(qe++),J=0;J<xt+1;J++)we.push(ye)}}return we}function Se(Z,fe,we,qe,Ye,it){var Ht=new DataView(it.buffer),xt=we[Z.idx[0]].width,J=we[Z.idx[0]].height,ye=3,_e=Math.floor(xt/8),Me=Math.ceil(xt/8),xe=Math.ceil(J/8),ht=xt-(Me-1)*8,tt=J-(xe-1)*8,at={value:0},ot=new Array(ye),_t=new Array(ye),wt=new Array(ye),It=new Array(ye),Kt=new Array(ye);for(let In=0;In<ye;++In)Kt[In]=fe[Z.idx[In]],ot[In]=In<1?0:ot[In-1]+Me*xe,_t[In]=new Float32Array(64),wt[In]=new Uint16Array(64),It[In]=new Uint16Array(Me*64);for(let In=0;In<xe;++In){var on=8;In==xe-1&&(on=tt);var nn=8;for(let yn=0;yn<Me;++yn){yn==Me-1&&(nn=ht);for(let $t=0;$t<ye;++$t)wt[$t].fill(0),wt[$t][0]=Ye[ot[$t]++],be(at,qe,wt[$t]),Re(wt[$t],_t[$t]),me(_t[$t]);ue(_t);for(let $t=0;$t<ye;++$t)$e(_t[$t],It[$t],yn*64)}let Yn=0;for(let yn=0;yn<ye;++yn){const $t=we[Z.idx[yn]].type;for(let li=8*In;li<8*In+on;++li){Yn=Kt[yn][li];for(let Oi=0;Oi<_e;++Oi){const Pn=Oi*64+(li&7)*8;Ht.setUint16(Yn+0*$t,It[yn][Pn+0],!0),Ht.setUint16(Yn+2*$t,It[yn][Pn+1],!0),Ht.setUint16(Yn+4*$t,It[yn][Pn+2],!0),Ht.setUint16(Yn+6*$t,It[yn][Pn+3],!0),Ht.setUint16(Yn+8*$t,It[yn][Pn+4],!0),Ht.setUint16(Yn+10*$t,It[yn][Pn+5],!0),Ht.setUint16(Yn+12*$t,It[yn][Pn+6],!0),Ht.setUint16(Yn+14*$t,It[yn][Pn+7],!0),Yn+=16*$t}}if(_e!=Me)for(let li=8*In;li<8*In+on;++li){const Oi=Kt[yn][li]+8*_e*2*$t,Pn=_e*64+(li&7)*8;for(let Ci=0;Ci<nn;++Ci)Ht.setUint16(Oi+Ci*2*$t,It[yn][Pn+Ci],!0)}}}for(var Cn=new Uint16Array(xt),Ht=new DataView(it.buffer),Dt=0;Dt<ye;++Dt){we[Z.idx[Dt]].decoded=!0;var Vn=we[Z.idx[Dt]].type;if(we[Dt].type==2)for(var An=0;An<J;++An){const In=Kt[Dt][An];for(var ii=0;ii<xt;++ii)Cn[ii]=Ht.getUint16(In+ii*2*Vn,!0);for(var ii=0;ii<xt;++ii)Ht.setFloat32(In+ii*2*Vn,Qe(Cn[ii]),!0)}}}function be(Z,fe,we){for(var qe,Ye=1;Ye<64;)qe=fe[Z.value],qe==65280?Ye=64:qe>>8==255?Ye+=qe&255:(we[Ye]=qe,Ye++),Z.value++}function Re(Z,fe){fe[0]=Qe(Z[0]),fe[1]=Qe(Z[1]),fe[2]=Qe(Z[5]),fe[3]=Qe(Z[6]),fe[4]=Qe(Z[14]),fe[5]=Qe(Z[15]),fe[6]=Qe(Z[27]),fe[7]=Qe(Z[28]),fe[8]=Qe(Z[2]),fe[9]=Qe(Z[4]),fe[10]=Qe(Z[7]),fe[11]=Qe(Z[13]),fe[12]=Qe(Z[16]),fe[13]=Qe(Z[26]),fe[14]=Qe(Z[29]),fe[15]=Qe(Z[42]),fe[16]=Qe(Z[3]),fe[17]=Qe(Z[8]),fe[18]=Qe(Z[12]),fe[19]=Qe(Z[17]),fe[20]=Qe(Z[25]),fe[21]=Qe(Z[30]),fe[22]=Qe(Z[41]),fe[23]=Qe(Z[43]),fe[24]=Qe(Z[9]),fe[25]=Qe(Z[11]),fe[26]=Qe(Z[18]),fe[27]=Qe(Z[24]),fe[28]=Qe(Z[31]),fe[29]=Qe(Z[40]),fe[30]=Qe(Z[44]),fe[31]=Qe(Z[53]),fe[32]=Qe(Z[10]),fe[33]=Qe(Z[19]),fe[34]=Qe(Z[23]),fe[35]=Qe(Z[32]),fe[36]=Qe(Z[39]),fe[37]=Qe(Z[45]),fe[38]=Qe(Z[52]),fe[39]=Qe(Z[54]),fe[40]=Qe(Z[20]),fe[41]=Qe(Z[22]),fe[42]=Qe(Z[33]),fe[43]=Qe(Z[38]),fe[44]=Qe(Z[46]),fe[45]=Qe(Z[51]),fe[46]=Qe(Z[55]),fe[47]=Qe(Z[60]),fe[48]=Qe(Z[21]),fe[49]=Qe(Z[34]),fe[50]=Qe(Z[37]),fe[51]=Qe(Z[47]),fe[52]=Qe(Z[50]),fe[53]=Qe(Z[56]),fe[54]=Qe(Z[59]),fe[55]=Qe(Z[61]),fe[56]=Qe(Z[35]),fe[57]=Qe(Z[36]),fe[58]=Qe(Z[48]),fe[59]=Qe(Z[49]),fe[60]=Qe(Z[57]),fe[61]=Qe(Z[58]),fe[62]=Qe(Z[62]),fe[63]=Qe(Z[63])}function me(Z){const fe=.5*Math.cos(.7853975),we=.5*Math.cos(3.14159/16),qe=.5*Math.cos(3.14159/8),Ye=.5*Math.cos(3*3.14159/16),it=.5*Math.cos(5*3.14159/16),xt=.5*Math.cos(3*3.14159/8),J=.5*Math.cos(7*3.14159/16);for(var ye=new Array(4),_e=new Array(4),Me=new Array(4),xe=new Array(4),ht=0;ht<8;++ht){var tt=ht*8;ye[0]=qe*Z[tt+2],ye[1]=xt*Z[tt+2],ye[2]=qe*Z[tt+6],ye[3]=xt*Z[tt+6],_e[0]=we*Z[tt+1]+Ye*Z[tt+3]+it*Z[tt+5]+J*Z[tt+7],_e[1]=Ye*Z[tt+1]-J*Z[tt+3]-we*Z[tt+5]-it*Z[tt+7],_e[2]=it*Z[tt+1]-we*Z[tt+3]+J*Z[tt+5]+Ye*Z[tt+7],_e[3]=J*Z[tt+1]-it*Z[tt+3]+Ye*Z[tt+5]-we*Z[tt+7],Me[0]=fe*(Z[tt+0]+Z[tt+4]),Me[3]=fe*(Z[tt+0]-Z[tt+4]),Me[1]=ye[0]+ye[3],Me[2]=ye[1]-ye[2],xe[0]=Me[0]+Me[1],xe[1]=Me[3]+Me[2],xe[2]=Me[3]-Me[2],xe[3]=Me[0]-Me[1],Z[tt+0]=xe[0]+_e[0],Z[tt+1]=xe[1]+_e[1],Z[tt+2]=xe[2]+_e[2],Z[tt+3]=xe[3]+_e[3],Z[tt+4]=xe[3]-_e[3],Z[tt+5]=xe[2]-_e[2],Z[tt+6]=xe[1]-_e[1],Z[tt+7]=xe[0]-_e[0]}for(var at=0;at<8;++at)ye[0]=qe*Z[16+at],ye[1]=xt*Z[16+at],ye[2]=qe*Z[48+at],ye[3]=xt*Z[48+at],_e[0]=we*Z[8+at]+Ye*Z[24+at]+it*Z[40+at]+J*Z[56+at],_e[1]=Ye*Z[8+at]-J*Z[24+at]-we*Z[40+at]-it*Z[56+at],_e[2]=it*Z[8+at]-we*Z[24+at]+J*Z[40+at]+Ye*Z[56+at],_e[3]=J*Z[8+at]-it*Z[24+at]+Ye*Z[40+at]-we*Z[56+at],Me[0]=fe*(Z[at]+Z[32+at]),Me[3]=fe*(Z[at]-Z[32+at]),Me[1]=ye[0]+ye[3],Me[2]=ye[1]-ye[2],xe[0]=Me[0]+Me[1],xe[1]=Me[3]+Me[2],xe[2]=Me[3]-Me[2],xe[3]=Me[0]-Me[1],Z[0+at]=xe[0]+_e[0],Z[8+at]=xe[1]+_e[1],Z[16+at]=xe[2]+_e[2],Z[24+at]=xe[3]+_e[3],Z[32+at]=xe[3]-_e[3],Z[40+at]=xe[2]-_e[2],Z[48+at]=xe[1]-_e[1],Z[56+at]=xe[0]-_e[0]}function ue(Z){for(var fe=0;fe<64;++fe){var we=Z[0][fe],qe=Z[1][fe],Ye=Z[2][fe];Z[0][fe]=we+1.5747*Ye,Z[1][fe]=we-.1873*qe-.4682*Ye,Z[2][fe]=we+1.8556*qe}}function $e(Z,fe,we){for(var qe=0;qe<64;++qe)fe[we+qe]=Kp.toHalfFloat(gt(Z[qe]))}function gt(Z){return Z<=1?Math.sign(Z)*Math.pow(Math.abs(Z),2.2):Math.sign(Z)*Math.pow(L,Math.abs(Z)-1)}function ge(Z){return new DataView(Z.array.buffer,Z.offset.value,Z.size)}function ae(Z){var fe=Z.viewer.buffer.slice(Z.offset.value,Z.offset.value+Z.size),we=new Uint8Array(Ae(fe)),qe=new Uint8Array(we.length);return pe(we),ve(we,qe),new DataView(qe.buffer)}function Pe(Z){var fe=Z.array.slice(Z.offset.value,Z.offset.value+Z.size),we=xS(fe),qe=new Uint8Array(we.length);return pe(we),ve(we,qe),new DataView(qe.buffer)}function Ve(Z){for(var fe=Z.viewer,we={value:Z.offset.value},qe=new Uint16Array(Z.width*Z.scanlineBlockSize*(Z.channels*Z.type)),Ye=new Uint8Array(8192),it=0,xt=new Array(Z.channels),J=0;J<Z.channels;J++)xt[J]={},xt[J].start=it,xt[J].end=xt[J].start,xt[J].nx=Z.width,xt[J].ny=Z.lines,xt[J].size=Z.type,it+=xt[J].nx*xt[J].ny*xt[J].size;var ye=St(fe,we),_e=St(fe,we);if(_e>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(ye<=_e)for(var J=0;J<_e-ye+1;J++)Ye[J+ye]=Ut(fe,we);var Me=new Uint16Array(65536),xe=O(Ye,Me),ht=At(fe,we);Ue(Z.array,fe,we,ht,qe,it);for(var J=0;J<Z.channels;++J)for(var tt=xt[J],at=0;at<xt[J].size;++at)Be(qe,tt.start+at,tt.nx,tt.size,tt.ny,tt.nx*tt.size,xe);nt(Me,qe,it);for(var ot=0,_t=new Uint8Array(qe.buffer.byteLength),wt=0;wt<Z.lines;wt++)for(var It=0;It<Z.channels;It++){var tt=xt[It],Kt=tt.nx*tt.size,on=new Uint8Array(qe.buffer,tt.end*2,Kt*2);_t.set(on,ot),ot+=Kt*2,tt.end+=Kt}return new DataView(_t.buffer)}function rt(Z){var fe=Z.array.slice(Z.offset.value,Z.offset.value+Z.size),we=xS(fe);const qe=Z.lines*Z.channels*Z.width,Ye=Z.type==1?new Uint16Array(qe):new Uint32Array(qe);let it=0,xt=0;const J=new Array(4);for(let ye=0;ye<Z.lines;ye++)for(let _e=0;_e<Z.channels;_e++){let Me=0;switch(Z.type){case 1:J[0]=it,J[1]=J[0]+Z.width,it=J[1]+Z.width;for(let xe=0;xe<Z.width;++xe){const ht=we[J[0]++]<<8|we[J[1]++];Me+=ht,Ye[xt]=Me,xt++}break;case 2:J[0]=it,J[1]=J[0]+Z.width,J[2]=J[1]+Z.width,it=J[2]+Z.width;for(let xe=0;xe<Z.width;++xe){const ht=we[J[0]++]<<24|we[J[1]++]<<16|we[J[2]++]<<8;Me+=ht,Ye[xt]=Me,xt++}break}}return new DataView(Ye.buffer)}function et(Z){var fe=Z.viewer,we={value:Z.offset.value},qe=new Uint8Array(Z.width*Z.lines*(Z.channels*Z.type*2)),Ye={version:vt(fe,we),unknownUncompressedSize:vt(fe,we),unknownCompressedSize:vt(fe,we),acCompressedSize:vt(fe,we),dcCompressedSize:vt(fe,we),rleCompressedSize:vt(fe,we),rleUncompressedSize:vt(fe,we),rleRawSize:vt(fe,we),totalAcUncompressedCount:vt(fe,we),totalDcUncompressedCount:vt(fe,we),acCompression:vt(fe,we)};if(Ye.version<2)throw"EXRLoader.parse: "+Ts.compression+" version "+Ye.version+" is unsupported";for(var it=new Array,xt=St(fe,we)-2;xt>0;){var J=Mt(fe.buffer,we),ye=Ut(fe,we),_e=ye>>2&3,Me=(ye>>4)-1,xe=new Int8Array([Me])[0],ht=Ut(fe,we);it.push({name:J,index:xe,type:ht,compression:_e}),xt-=J.length+3}for(var tt=Ts.channels,at=new Array(Z.channels),ot=0;ot<Z.channels;++ot){var _t=at[ot]={},wt=tt[ot];_t.name=wt.name,_t.compression=0,_t.decoded=!1,_t.type=wt.pixelType,_t.pLinear=wt.pLinear,_t.width=Z.width,_t.height=Z.lines}for(var It={idx:new Array(3)},Kt=0;Kt<Z.channels;++Kt)for(var _t=at[Kt],ot=0;ot<it.length;++ot){var on=it[ot];_t.name==on.name&&(_t.compression=on.compression,on.index>=0&&(It.idx[on.index]=Kt),_t.offset=Kt)}if(Ye.acCompressedSize>0)switch(Ye.acCompression){case 0:var Ht=new Uint16Array(Ye.totalAcUncompressedCount);Ue(Z.array,fe,we,Ye.acCompressedSize,Ht,Ye.totalAcUncompressedCount);break;case 1:var nn=Z.array.slice(we.value,we.value+Ye.totalAcUncompressedCount),Cn=xS(nn),Ht=new Uint16Array(Cn.buffer);we.value+=Ye.totalAcUncompressedCount;break}if(Ye.dcCompressedSize>0){var Dt={array:Z.array,offset:we,size:Ye.dcCompressedSize},Vn=new Uint16Array(Pe(Dt).buffer);we.value+=Ye.dcCompressedSize}if(Ye.rleRawSize>0){var nn=Z.array.slice(we.value,we.value+Ye.rleCompressedSize),Cn=xS(nn),An=Ae(Cn.buffer);we.value+=Ye.rleCompressedSize}for(var ii=0,In=new Array(at.length),ot=0;ot<In.length;++ot)In[ot]=new Array;for(var Yn=0;Yn<Z.lines;++Yn)for(var yn=0;yn<at.length;++yn)In[yn].push(ii),ii+=at[yn].width*Z.type*2;Se(It,In,at,Ht,Vn,qe);for(var ot=0;ot<at.length;++ot){var _t=at[ot];if(!_t.decoded)switch(_t.compression){case 2:for(var $t=0,li=0,Yn=0;Yn<Z.lines;++Yn){for(var Oi=In[ot][$t],Pn=0;Pn<_t.width;++Pn){for(var Ci=0;Ci<2*_t.type;++Ci)qe[Oi++]=An[li+Ci*_t.width*_t.height];li++}$t++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(qe.buffer)}function Mt(Z,fe){for(var we=new Uint8Array(Z),qe=0;we[fe.value+qe]!=0;)qe+=1;var Ye=new TextDecoder().decode(we.slice(fe.value,fe.value+qe));return fe.value=fe.value+qe+1,Ye}function Et(Z,fe,we){var qe=new TextDecoder().decode(new Uint8Array(Z).slice(fe.value,fe.value+we));return fe.value=fe.value+we,qe}function Rt(Z,fe){var we=pt(Z,fe),qe=At(Z,fe);return[we,qe]}function Gt(Z,fe){var we=At(Z,fe),qe=At(Z,fe);return[we,qe]}function pt(Z,fe){var we=Z.getInt32(fe.value,!0);return fe.value=fe.value+4,we}function At(Z,fe){var we=Z.getUint32(fe.value,!0);return fe.value=fe.value+4,we}function Qt(Z,fe){var we=Z[fe.value];return fe.value=fe.value+1,we}function Ut(Z,fe){var we=Z.getUint8(fe.value);return fe.value=fe.value+1,we}const vt=function(Z,fe){let we;return"getBigInt64"in DataView.prototype?we=Number(Z.getBigInt64(fe.value,!0)):we=Z.getUint32(fe.value+4,!0)+Number(Z.getUint32(fe.value,!0)<<32),fe.value+=8,we};function Vt(Z,fe){var we=Z.getFloat32(fe.value,!0);return fe.value+=4,we}function Oe(Z,fe){return Kp.toHalfFloat(Vt(Z,fe))}function Qe(Z){var fe=(Z&31744)>>10,we=Z&1023;return(Z>>15?-1:1)*(fe?fe===31?we?NaN:1/0:Math.pow(2,fe-15)*(1+we/1024):6103515625e-14*(we/1024))}function St(Z,fe){var we=Z.getUint16(fe.value,!0);return fe.value+=2,we}function Nt(Z,fe){return Qe(St(Z,fe))}function yt(Z,fe,we,qe){for(var Ye=we.value,it=[];we.value<Ye+qe-1;){var xt=Mt(fe,we),J=pt(Z,we),ye=Ut(Z,we);we.value+=3;var _e=pt(Z,we),Me=pt(Z,we);it.push({name:xt,pixelType:J,pLinear:ye,xSampling:_e,ySampling:Me})}return we.value+=1,it}function dt(Z,fe){var we=Vt(Z,fe),qe=Vt(Z,fe),Ye=Vt(Z,fe),it=Vt(Z,fe),xt=Vt(Z,fe),J=Vt(Z,fe),ye=Vt(Z,fe),_e=Vt(Z,fe);return{redX:we,redY:qe,greenX:Ye,greenY:it,blueX:xt,blueY:J,whiteX:ye,whiteY:_e}}function zt(Z,fe){var we=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],qe=Ut(Z,fe);return we[qe]}function tn(Z,fe){var we=At(Z,fe),qe=At(Z,fe),Ye=At(Z,fe),it=At(Z,fe);return{xMin:we,yMin:qe,xMax:Ye,yMax:it}}function Un(Z,fe){var we=["INCREASING_Y"],qe=Ut(Z,fe);return we[qe]}function Ln(Z,fe){var we=Vt(Z,fe),qe=Vt(Z,fe);return[we,qe]}function Hr(Z,fe){var we=Vt(Z,fe),qe=Vt(Z,fe),Ye=Vt(Z,fe);return[we,qe,Ye]}function $i(Z,fe,we,qe,Ye){if(qe==="string"||qe==="stringvector"||qe==="iccProfile")return Et(fe,we,Ye);if(qe==="chlist")return yt(Z,fe,we,Ye);if(qe==="chromaticities")return dt(Z,we);if(qe==="compression")return zt(Z,we);if(qe==="box2i")return tn(Z,we);if(qe==="lineOrder")return Un(Z,we);if(qe==="float")return Vt(Z,we);if(qe==="v2f")return Ln(Z,we);if(qe==="v3f")return Hr(Z,we);if(qe==="int")return pt(Z,we);if(qe==="rational")return Rt(Z,we);if(qe==="timecode")return Gt(Z,we);if(qe==="preview")return we.value+=Ye,"skipped";we.value+=Ye}function Ji(Z,fe,we){const qe={};if(Z.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";qe.version=Z.getUint8(4);const Ye=Z.getUint8(5);qe.spec={singleTile:!!(Ye&2),longName:!!(Ye&4),deepFormat:!!(Ye&8),multiPart:!!(Ye&16)},we.value=8;for(var it=!0;it;){var xt=Mt(fe,we);if(xt==0)it=!1;else{var J=Mt(fe,we),ye=At(Z,we),_e=$i(Z,fe,we,J,ye);_e===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${J}'.`):qe[xt]=_e}}if((Ye&-5)!=0)throw console.error("EXRHeader:",qe),"THREE.EXRLoader: provided file is currently unsupported.";return qe}function Ti(Z,fe,we,qe,Ye){const it={size:0,viewer:fe,array:we,offset:qe,width:Z.dataWindow.xMax-Z.dataWindow.xMin+1,height:Z.dataWindow.yMax-Z.dataWindow.yMin+1,channels:Z.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:Z.channels[0].pixelType,uncompress:null,getter:null,format:null,[qy?"colorSpace":"encoding"]:null};switch(Z.compression){case"NO_COMPRESSION":it.lines=1,it.uncompress=ge;break;case"RLE_COMPRESSION":it.lines=1,it.uncompress=ae;break;case"ZIPS_COMPRESSION":it.lines=1,it.uncompress=Pe;break;case"ZIP_COMPRESSION":it.lines=16,it.uncompress=Pe;break;case"PIZ_COMPRESSION":it.lines=32,it.uncompress=Ve;break;case"PXR24_COMPRESSION":it.lines=16,it.uncompress=rt;break;case"DWAA_COMPRESSION":it.lines=32,it.uncompress=et;break;case"DWAB_COMPRESSION":it.lines=256,it.uncompress=et;break;default:throw"EXRLoader.parse: "+Z.compression+" is unsupported"}if(it.scanlineBlockSize=it.lines,it.type==1)switch(Ye){case ss:it.getter=Nt,it.inputSize=2;break;case hr:it.getter=St,it.inputSize=2;break}else if(it.type==2)switch(Ye){case ss:it.getter=Vt,it.inputSize=4;break;case hr:it.getter=Oe,it.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+it.type+" for "+Z.compression+".";it.blockCount=(Z.dataWindow.yMax+1)/it.scanlineBlockSize;for(var xt=0;xt<it.blockCount;xt++)vt(fe,qe);it.outputChannels=it.channels==3?4:it.channels;const J=it.width*it.height*it.outputChannels;switch(Ye){case ss:it.byteArray=new Float32Array(J),it.channels<it.outputChannels&&it.byteArray.fill(1,0,J);break;case hr:it.byteArray=new Uint16Array(J),it.channels<it.outputChannels&&it.byteArray.fill(15360,0,J);break;default:console.error("THREE.EXRLoader: unsupported type: ",Ye);break}return it.bytesPerLine=it.width*it.inputSize*it.channels,it.outputChannels==4?it.format=rs:it.format=gu,qy?it.colorSpace="srgb-linear":it.encoding=3e3,it}const Zs=new DataView(e),Cr=new Uint8Array(e),fo={value:0},Ts=Ji(Zs,e,fo),an=Ti(Ts,Zs,Cr,fo,this.type),mr={value:0},pi={R:0,G:1,B:2,A:3,Y:0};for(let Z=0;Z<an.height/an.scanlineBlockSize;Z++){const fe=At(Zs,fo);an.size=At(Zs,fo),an.lines=fe+an.scanlineBlockSize>an.height?an.height-fe:an.scanlineBlockSize;const qe=an.size<an.lines*an.bytesPerLine?an.uncompress(an):ge(an);fo.value+=an.size;for(let Ye=0;Ye<an.scanlineBlockSize;Ye++){const it=Ye+Z*an.scanlineBlockSize;if(it>=an.height)break;for(let xt=0;xt<an.channels;xt++){const J=pi[Ts.channels[xt].name];for(let ye=0;ye<an.width;ye++){mr.value=(Ye*(an.channels*an.width)+xt*an.width+ye)*an.inputSize;const _e=(an.height-1-it)*(an.width*an.outputChannels)+ye*an.outputChannels+J;an.byteArray[_e]=an.getter(qe,mr)}}}}return{header:Ts,width:an.width,height:an.height,data:an.byteArray,format:an.format,[qy?"colorSpace":"encoding"]:an[qy?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,i){function r(a,o){qy?a.colorSpace=o.colorSpace:a.encoding=o.encoding,a.minFilter=Si,a.magFilter=Si,a.generateMipmaps=!1,a.flipY=!1,t&&t(a,o)}return super.load(e,r,n,i)}}const Xne="srgb",Wne=(()=>{class s extends Fs{constructor(t){super(t),this.defaultDPI=90,this.defaultUnit="px"}load(t,n,i,r){const a=this,o=new Js(a.manager);o.setPath(a.path),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(t,function(l){try{n(a.parse(l))}catch(c){r?r(c):console.error(c),a.manager.itemError(t)}},i,r)}parse(t){const n=this;function i(se,ie){if(se.nodeType!==1)return;const ne=M(se);let re=!1,Be=null;switch(se.nodeName){case"svg":ie=x(se,ie);break;case"style":a(se);break;case"g":ie=x(se,ie);break;case"path":ie=x(se,ie),se.hasAttribute("d")&&(Be=r(se));break;case"rect":ie=x(se,ie),Be=c(se);break;case"polygon":ie=x(se,ie),Be=h(se);break;case"polyline":ie=x(se,ie),Be=f(se);break;case"circle":ie=x(se,ie),Be=p(se);break;case"ellipse":ie=x(se,ie),Be=g(se);break;case"line":ie=x(se,ie),Be=y(se);break;case"defs":re=!0;break;case"use":ie=x(se,ie);const nt=(se.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),pe=se.viewportElement.getElementById(nt);pe?i(pe,ie):console.warn("SVGLoader: 'use node' references non-existent node id: "+nt);break}Be&&(ie.fill!==void 0&&ie.fill!=="none"&&Be.color.setStyle(ie.fill,Xne),D(Be,oe),H.push(Be),Be.userData={node:se,style:ie});const Ge=se.childNodes;for(let Ue=0;Ue<Ge.length;Ue++){const nt=Ge[Ue];re&&nt.nodeName!=="style"&&nt.nodeName!=="defs"||i(nt,ie)}ne&&(q.pop(),q.length>0?oe.copy(q[q.length-1]):oe.identity())}function r(se){const ie=new yh,ne=new We,re=new We,Be=new We;let Ge=!0,Ue=!1;const nt=se.getAttribute("d");if(nt===""||nt==="none")return null;const pe=nt.match(/[a-df-z][^a-df-z]*/gi);for(let ve=0,Ae=pe.length;ve<Ae;ve++){const Se=pe[ve],be=Se.charAt(0),Re=Se.slice(1).trim();Ge===!0&&(Ue=!0,Ge=!1);let me;switch(be){case"M":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=2)ne.x=me[ue+0],ne.y=me[ue+1],re.x=ne.x,re.y=ne.y,ue===0?ie.moveTo(ne.x,ne.y):ie.lineTo(ne.x,ne.y),ue===0&&Be.copy(ne);break;case"H":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue++)ne.x=me[ue],re.x=ne.x,re.y=ne.y,ie.lineTo(ne.x,ne.y),ue===0&&Ue===!0&&Be.copy(ne);break;case"V":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue++)ne.y=me[ue],re.x=ne.x,re.y=ne.y,ie.lineTo(ne.x,ne.y),ue===0&&Ue===!0&&Be.copy(ne);break;case"L":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=2)ne.x=me[ue+0],ne.y=me[ue+1],re.x=ne.x,re.y=ne.y,ie.lineTo(ne.x,ne.y),ue===0&&Ue===!0&&Be.copy(ne);break;case"C":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=6)ie.bezierCurveTo(me[ue+0],me[ue+1],me[ue+2],me[ue+3],me[ue+4],me[ue+5]),re.x=me[ue+2],re.y=me[ue+3],ne.x=me[ue+4],ne.y=me[ue+5],ue===0&&Ue===!0&&Be.copy(ne);break;case"S":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=4)ie.bezierCurveTo(E(ne.x,re.x),E(ne.y,re.y),me[ue+0],me[ue+1],me[ue+2],me[ue+3]),re.x=me[ue+0],re.y=me[ue+1],ne.x=me[ue+2],ne.y=me[ue+3],ue===0&&Ue===!0&&Be.copy(ne);break;case"Q":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=4)ie.quadraticCurveTo(me[ue+0],me[ue+1],me[ue+2],me[ue+3]),re.x=me[ue+0],re.y=me[ue+1],ne.x=me[ue+2],ne.y=me[ue+3],ue===0&&Ue===!0&&Be.copy(ne);break;case"T":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=2){const gt=E(ne.x,re.x),ge=E(ne.y,re.y);ie.quadraticCurveTo(gt,ge,me[ue+0],me[ue+1]),re.x=gt,re.y=ge,ne.x=me[ue+0],ne.y=me[ue+1],ue===0&&Ue===!0&&Be.copy(ne)}break;case"A":me=_(Re,[3,4],7);for(let ue=0,$e=me.length;ue<$e;ue+=7){if(me[ue+5]==ne.x&&me[ue+6]==ne.y)continue;const gt=ne.clone();ne.x=me[ue+5],ne.y=me[ue+6],re.x=ne.x,re.y=ne.y,o(ie,me[ue],me[ue+1],me[ue+2],me[ue+3],me[ue+4],gt,ne),ue===0&&Ue===!0&&Be.copy(ne)}break;case"m":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=2)ne.x+=me[ue+0],ne.y+=me[ue+1],re.x=ne.x,re.y=ne.y,ue===0?ie.moveTo(ne.x,ne.y):ie.lineTo(ne.x,ne.y),ue===0&&Be.copy(ne);break;case"h":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue++)ne.x+=me[ue],re.x=ne.x,re.y=ne.y,ie.lineTo(ne.x,ne.y),ue===0&&Ue===!0&&Be.copy(ne);break;case"v":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue++)ne.y+=me[ue],re.x=ne.x,re.y=ne.y,ie.lineTo(ne.x,ne.y),ue===0&&Ue===!0&&Be.copy(ne);break;case"l":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=2)ne.x+=me[ue+0],ne.y+=me[ue+1],re.x=ne.x,re.y=ne.y,ie.lineTo(ne.x,ne.y),ue===0&&Ue===!0&&Be.copy(ne);break;case"c":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=6)ie.bezierCurveTo(ne.x+me[ue+0],ne.y+me[ue+1],ne.x+me[ue+2],ne.y+me[ue+3],ne.x+me[ue+4],ne.y+me[ue+5]),re.x=ne.x+me[ue+2],re.y=ne.y+me[ue+3],ne.x+=me[ue+4],ne.y+=me[ue+5],ue===0&&Ue===!0&&Be.copy(ne);break;case"s":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=4)ie.bezierCurveTo(E(ne.x,re.x),E(ne.y,re.y),ne.x+me[ue+0],ne.y+me[ue+1],ne.x+me[ue+2],ne.y+me[ue+3]),re.x=ne.x+me[ue+0],re.y=ne.y+me[ue+1],ne.x+=me[ue+2],ne.y+=me[ue+3],ue===0&&Ue===!0&&Be.copy(ne);break;case"q":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=4)ie.quadraticCurveTo(ne.x+me[ue+0],ne.y+me[ue+1],ne.x+me[ue+2],ne.y+me[ue+3]),re.x=ne.x+me[ue+0],re.y=ne.y+me[ue+1],ne.x+=me[ue+2],ne.y+=me[ue+3],ue===0&&Ue===!0&&Be.copy(ne);break;case"t":me=_(Re);for(let ue=0,$e=me.length;ue<$e;ue+=2){const gt=E(ne.x,re.x),ge=E(ne.y,re.y);ie.quadraticCurveTo(gt,ge,ne.x+me[ue+0],ne.y+me[ue+1]),re.x=gt,re.y=ge,ne.x=ne.x+me[ue+0],ne.y=ne.y+me[ue+1],ue===0&&Ue===!0&&Be.copy(ne)}break;case"a":me=_(Re,[3,4],7);for(let ue=0,$e=me.length;ue<$e;ue+=7){if(me[ue+5]==0&&me[ue+6]==0)continue;const gt=ne.clone();ne.x+=me[ue+5],ne.y+=me[ue+6],re.x=ne.x,re.y=ne.y,o(ie,me[ue],me[ue+1],me[ue+2],me[ue+3],me[ue+4],gt,ne),ue===0&&Ue===!0&&Be.copy(ne)}break;case"Z":case"z":ie.currentPath.autoClose=!0,ie.currentPath.curves.length>0&&(ne.copy(Be),ie.currentPath.currentPoint.copy(ne),Ge=!0);break;default:console.warn(Se)}Ue=!1}return ie}function a(se){if(!(!se.sheet||!se.sheet.cssRules||!se.sheet.cssRules.length))for(let ie=0;ie<se.sheet.cssRules.length;ie++){const ne=se.sheet.cssRules[ie];if(ne.type!==1)continue;const re=ne.selectorText.split(/,/gm).filter(Boolean).map(Be=>Be.trim());for(let Be=0;Be<re.length;Be++){const Ge=Object.fromEntries(Object.entries(ne.style).filter(([,Ue])=>Ue!==""));z[re[Be]]=Object.assign(z[re[Be]]||{},Ge)}}}function o(se,ie,ne,re,Be,Ge,Ue,nt){if(ie==0||ne==0){se.lineTo(nt.x,nt.y);return}re=re*Math.PI/180,ie=Math.abs(ie),ne=Math.abs(ne);const pe=(Ue.x-nt.x)/2,ve=(Ue.y-nt.y)/2,Ae=Math.cos(re)*pe+Math.sin(re)*ve,Se=-Math.sin(re)*pe+Math.cos(re)*ve;let be=ie*ie,Re=ne*ne;const me=Ae*Ae,ue=Se*Se,$e=me/be+ue/Re;if($e>1){const Rt=Math.sqrt($e);ie=Rt*ie,ne=Rt*ne,be=ie*ie,Re=ne*ne}const gt=be*ue+Re*me,ge=(be*Re-gt)/gt;let ae=Math.sqrt(Math.max(0,ge));Be===Ge&&(ae=-ae);const Pe=ae*ie*Se/ne,Ve=-ae*ne*Ae/ie,rt=Math.cos(re)*Pe-Math.sin(re)*Ve+(Ue.x+nt.x)/2,et=Math.sin(re)*Pe+Math.cos(re)*Ve+(Ue.y+nt.y)/2,Mt=l(1,0,(Ae-Pe)/ie,(Se-Ve)/ne),Et=l((Ae-Pe)/ie,(Se-Ve)/ne,(-Ae-Pe)/ie,(-Se-Ve)/ne)%(Math.PI*2);se.currentPath.absellipse(rt,et,ie,ne,Mt,Mt+Et,Ge===0,re)}function l(se,ie,ne,re){const Be=se*ne+ie*re,Ge=Math.sqrt(se*se+ie*ie)*Math.sqrt(ne*ne+re*re);let Ue=Math.acos(Math.max(-1,Math.min(1,Be/Ge)));return se*re-ie*ne<0&&(Ue=-Ue),Ue}function c(se){const ie=I(se.getAttribute("x")||0),ne=I(se.getAttribute("y")||0),re=I(se.getAttribute("rx")||se.getAttribute("ry")||0),Be=I(se.getAttribute("ry")||se.getAttribute("rx")||0),Ge=I(se.getAttribute("width")),Ue=I(se.getAttribute("height")),nt=1-.551915024494,pe=new yh;return pe.moveTo(ie+re,ne),pe.lineTo(ie+Ge-re,ne),(re!==0||Be!==0)&&pe.bezierCurveTo(ie+Ge-re*nt,ne,ie+Ge,ne+Be*nt,ie+Ge,ne+Be),pe.lineTo(ie+Ge,ne+Ue-Be),(re!==0||Be!==0)&&pe.bezierCurveTo(ie+Ge,ne+Ue-Be*nt,ie+Ge-re*nt,ne+Ue,ie+Ge-re,ne+Ue),pe.lineTo(ie+re,ne+Ue),(re!==0||Be!==0)&&pe.bezierCurveTo(ie+re*nt,ne+Ue,ie,ne+Ue-Be*nt,ie,ne+Ue-Be),pe.lineTo(ie,ne+Be),(re!==0||Be!==0)&&pe.bezierCurveTo(ie,ne+Be*nt,ie+re*nt,ne,ie+re,ne),pe}function h(se){function ie(Ge,Ue,nt){const pe=I(Ue),ve=I(nt);Be===0?re.moveTo(pe,ve):re.lineTo(pe,ve),Be++}const ne=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,re=new yh;let Be=0;return se.getAttribute("points").replace(ne,ie),re.currentPath.autoClose=!0,re}function f(se){function ie(Ge,Ue,nt){const pe=I(Ue),ve=I(nt);Be===0?re.moveTo(pe,ve):re.lineTo(pe,ve),Be++}const ne=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,re=new yh;let Be=0;return se.getAttribute("points").replace(ne,ie),re.currentPath.autoClose=!1,re}function p(se){const ie=I(se.getAttribute("cx")||0),ne=I(se.getAttribute("cy")||0),re=I(se.getAttribute("r")||0),Be=new sm;Be.absarc(ie,ne,re,0,Math.PI*2);const Ge=new yh;return Ge.subPaths.push(Be),Ge}function g(se){const ie=I(se.getAttribute("cx")||0),ne=I(se.getAttribute("cy")||0),re=I(se.getAttribute("rx")||0),Be=I(se.getAttribute("ry")||0),Ge=new sm;Ge.absellipse(ie,ne,re,Be,0,Math.PI*2);const Ue=new yh;return Ue.subPaths.push(Ge),Ue}function y(se){const ie=I(se.getAttribute("x1")||0),ne=I(se.getAttribute("y1")||0),re=I(se.getAttribute("x2")||0),Be=I(se.getAttribute("y2")||0),Ge=new yh;return Ge.moveTo(ie,ne),Ge.lineTo(re,Be),Ge.currentPath.autoClose=!1,Ge}function x(se,ie){ie=Object.assign({},ie);let ne={};if(se.hasAttribute("class")){const Ue=se.getAttribute("class").split(/\s/).filter(Boolean).map(nt=>nt.trim());for(let nt=0;nt<Ue.length;nt++)ne=Object.assign(ne,z["."+Ue[nt]])}se.hasAttribute("id")&&(ne=Object.assign(ne,z["#"+se.getAttribute("id")]));function re(Ue,nt,pe){pe===void 0&&(pe=function(Ae){return Ae.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),Ae}),se.hasAttribute(Ue)&&(ie[nt]=pe(se.getAttribute(Ue))),ne[Ue]&&(ie[nt]=pe(ne[Ue])),se.style&&se.style[Ue]!==""&&(ie[nt]=pe(se.style[Ue]))}function Be(Ue){return Math.max(0,Math.min(1,I(Ue)))}function Ge(Ue){return Math.max(0,I(Ue))}return re("fill","fill"),re("fill-opacity","fillOpacity",Be),re("fill-rule","fillRule"),re("opacity","opacity",Be),re("stroke","stroke"),re("stroke-opacity","strokeOpacity",Be),re("stroke-width","strokeWidth",Ge),re("stroke-linejoin","strokeLineJoin"),re("stroke-linecap","strokeLineCap"),re("stroke-miterlimit","strokeMiterLimit",Ge),re("visibility","visibility"),ie}function E(se,ie){return se-(ie-se)}function _(se,ie,ne){if(typeof se!="string")throw new TypeError("Invalid input: "+typeof se);const re={WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},Be=0,Ge=1,Ue=2,nt=3;let pe=Be,ve=!0,Ae="",Se="";const be=[];function Re(gt,ge,ae){const Pe=new SyntaxError('Unexpected character "'+gt+'" at index '+ge+".");throw Pe.partial=ae,Pe}function me(){Ae!==""&&(Se===""?be.push(Number(Ae)):be.push(Number(Ae)*Math.pow(10,Number(Se)))),Ae="",Se=""}let ue;const $e=se.length;for(let gt=0;gt<$e;gt++){if(ue=se[gt],Array.isArray(ie)&&ie.includes(be.length%ne)&&re.FLAGS.test(ue)){pe=Ge,Ae=ue,me();continue}if(pe===Be){if(re.WHITESPACE.test(ue))continue;if(re.DIGIT.test(ue)||re.SIGN.test(ue)){pe=Ge,Ae=ue;continue}if(re.POINT.test(ue)){pe=Ue,Ae=ue;continue}re.COMMA.test(ue)&&(ve&&Re(ue,gt,be),ve=!0)}if(pe===Ge){if(re.DIGIT.test(ue)){Ae+=ue;continue}if(re.POINT.test(ue)){Ae+=ue,pe=Ue;continue}if(re.EXP.test(ue)){pe=nt;continue}re.SIGN.test(ue)&&Ae.length===1&&re.SIGN.test(Ae[0])&&Re(ue,gt,be)}if(pe===Ue){if(re.DIGIT.test(ue)){Ae+=ue;continue}if(re.EXP.test(ue)){pe=nt;continue}re.POINT.test(ue)&&Ae[Ae.length-1]==="."&&Re(ue,gt,be)}if(pe===nt){if(re.DIGIT.test(ue)){Se+=ue;continue}if(re.SIGN.test(ue)){if(Se===""){Se+=ue;continue}Se.length===1&&re.SIGN.test(Se)&&Re(ue,gt,be)}}re.WHITESPACE.test(ue)?(me(),pe=Be,ve=!1):re.COMMA.test(ue)?(me(),pe=Be,ve=!0):re.SIGN.test(ue)?(me(),pe=Ge,Ae=ue):re.POINT.test(ue)?(me(),pe=Ue,Ae=ue):Re(ue,gt,be)}return me(),be}const b=["mm","cm","in","pt","pc","px"],C={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function I(se){let ie="px";if(typeof se=="string"||se instanceof String)for(let re=0,Be=b.length;re<Be;re++){const Ge=b[re];if(se.endsWith(Ge)){ie=Ge,se=se.substring(0,se.length-Ge.length);break}}let ne;return ie==="px"&&n.defaultUnit!=="px"?ne=C.in[n.defaultUnit]/n.defaultDPI:(ne=C[ie][n.defaultUnit],ne<0&&(ne=C[ie].in*n.defaultDPI)),ne*parseFloat(se)}function M(se){if(!(se.hasAttribute("transform")||se.nodeName==="use"&&(se.hasAttribute("x")||se.hasAttribute("y"))))return null;const ie=R(se);return q.length>0&&ie.premultiply(q[q.length-1]),oe.copy(ie),q.push(ie),ie}function R(se){const ie=new un,ne=k;if(se.nodeName==="use"&&(se.hasAttribute("x")||se.hasAttribute("y"))){const re=I(se.getAttribute("x")),Be=I(se.getAttribute("y"));ie.translate(re,Be)}if(se.hasAttribute("transform")){const re=se.getAttribute("transform").split(")");for(let Be=re.length-1;Be>=0;Be--){const Ge=re[Be].trim();if(Ge==="")continue;const Ue=Ge.indexOf("("),nt=Ge.length;if(Ue>0&&Ue<nt){const pe=Ge.slice(0,Ue),ve=_(Ge.slice(Ue+1));switch(ne.identity(),pe){case"translate":if(ve.length>=1){const Ae=ve[0];let Se=0;ve.length>=2&&(Se=ve[1]),ne.translate(Ae,Se)}break;case"rotate":if(ve.length>=1){let Ae=0,Se=0,be=0;Ae=ve[0]*Math.PI/180,ve.length>=3&&(Se=ve[1],be=ve[2]),W.makeTranslation(-Se,-be),V.makeRotation(Ae),X.multiplyMatrices(V,W),W.makeTranslation(Se,be),ne.multiplyMatrices(W,X)}break;case"scale":if(ve.length>=1){const Ae=ve[0];let Se=Ae;ve.length>=2&&(Se=ve[1]),ne.scale(Ae,Se)}break;case"skewX":ve.length===1&&ne.set(1,Math.tan(ve[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":ve.length===1&&ne.set(1,0,0,Math.tan(ve[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":ve.length===6&&ne.set(ve[0],ve[2],ve[4],ve[1],ve[3],ve[5],0,0,1);break}}ie.premultiply(ne)}}return ie}function D(se,ie){function ne(Ue){te.set(Ue.x,Ue.y,1).applyMatrix3(ie),Ue.set(te.x,te.y)}function re(Ue){const nt=Ue.xRadius,pe=Ue.yRadius,ve=Math.cos(Ue.aRotation),Ae=Math.sin(Ue.aRotation),Se=new de(nt*ve,nt*Ae,0),be=new de(-pe*Ae,pe*ve,0),Re=Se.applyMatrix3(ie),me=be.applyMatrix3(ie),ue=k.set(Re.x,me.x,0,Re.y,me.y,0,0,0,1),$e=W.copy(ue).invert(),ae=V.copy($e).transpose().multiply($e).elements,Pe=j(ae[0],ae[1],ae[4]),Ve=Math.sqrt(Pe.rt1),rt=Math.sqrt(Pe.rt2);if(Ue.xRadius=1/Ve,Ue.yRadius=1/rt,Ue.aRotation=Math.atan2(Pe.sn,Pe.cs),!((Ue.aEndAngle-Ue.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const Mt=W.set(Ve,0,0,0,rt,0,0,0,1),Et=V.set(Pe.cs,Pe.sn,0,-Pe.sn,Pe.cs,0,0,0,1),Rt=Mt.multiply(Et).multiply(ue),Gt=pt=>{const{x:At,y:Qt}=new de(Math.cos(pt),Math.sin(pt),0).applyMatrix3(Rt);return Math.atan2(Qt,At)};Ue.aStartAngle=Gt(Ue.aStartAngle),Ue.aEndAngle=Gt(Ue.aEndAngle),P(ie)&&(Ue.aClockwise=!Ue.aClockwise)}}function Be(Ue){const nt=O(ie),pe=U(ie);Ue.xRadius*=nt,Ue.yRadius*=pe;const ve=nt>Number.EPSILON?Math.atan2(ie.elements[1],ie.elements[0]):Math.atan2(-ie.elements[3],ie.elements[4]);Ue.aRotation+=ve,P(ie)&&(Ue.aStartAngle*=-1,Ue.aEndAngle*=-1,Ue.aClockwise=!Ue.aClockwise)}const Ge=se.subPaths;for(let Ue=0,nt=Ge.length;Ue<nt;Ue++){const ve=Ge[Ue].curves;for(let Ae=0;Ae<ve.length;Ae++){const Se=ve[Ae];Se.isLineCurve?(ne(Se.v1),ne(Se.v2)):Se.isCubicBezierCurve?(ne(Se.v0),ne(Se.v1),ne(Se.v2),ne(Se.v3)):Se.isQuadraticBezierCurve?(ne(Se.v0),ne(Se.v1),ne(Se.v2)):Se.isEllipseCurve&&(K.set(Se.aX,Se.aY),ne(K),Se.aX=K.x,Se.aY=K.y,L(ie)?re(Se):Be(Se))}}}function P(se){const ie=se.elements;return ie[0]*ie[4]-ie[1]*ie[3]<0}function L(se){const ie=se.elements,ne=ie[0]*ie[3]+ie[1]*ie[4];if(ne===0)return!1;const re=O(se),Be=U(se);return Math.abs(ne/(re*Be))>Number.EPSILON}function O(se){const ie=se.elements;return Math.sqrt(ie[0]*ie[0]+ie[1]*ie[1])}function U(se){const ie=se.elements;return Math.sqrt(ie[3]*ie[3]+ie[4]*ie[4])}function j(se,ie,ne){let re,Be,Ge,Ue,nt;const pe=se+ne,ve=se-ne,Ae=Math.sqrt(ve*ve+4*ie*ie);return pe>0?(re=.5*(pe+Ae),nt=1/re,Be=se*nt*ne-ie*nt*ie):pe<0?Be=.5*(pe-Ae):(re=.5*Ae,Be=-.5*Ae),ve>0?Ge=ve+Ae:Ge=ve-Ae,Math.abs(Ge)>2*Math.abs(ie)?(nt=-2*ie/Ge,Ue=1/Math.sqrt(1+nt*nt),Ge=nt*Ue):Math.abs(ie)===0?(Ge=1,Ue=0):(nt=-.5*Ge/ie,Ge=1/Math.sqrt(1+nt*nt),Ue=nt*Ge),ve>0&&(nt=Ge,Ge=-Ue,Ue=nt),{rt1:re,rt2:Be,cs:Ge,sn:Ue}}const H=[],z={},q=[],k=new un,W=new un,V=new un,X=new un,K=new We,te=new de,oe=new un,Ee=new DOMParser().parseFromString(t,"image/svg+xml");return i(Ee.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:H,xml:Ee.documentElement}}static createShapes(t){const i={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},r={loc:i.ORIGIN,t:0};function a(E,_,b,C){const I=E.x,M=_.x,R=b.x,D=C.x,P=E.y,L=_.y,O=b.y,U=C.y,j=(D-R)*(P-O)-(U-O)*(I-R),H=(M-I)*(P-O)-(L-P)*(I-R),z=(U-O)*(M-I)-(D-R)*(L-P),q=j/z,k=H/z;if(z===0&&j!==0||q<=0||q>=1||k<0||k>1)return null;if(j===0&&z===0){for(let W=0;W<2;W++)if(o(W===0?b:C,E,_),r.loc==i.ORIGIN){const V=W===0?b:C;return{x:V.x,y:V.y,t:r.t}}else if(r.loc==i.BETWEEN){const V=+(I+r.t*(M-I)).toPrecision(10),X=+(P+r.t*(L-P)).toPrecision(10);return{x:V,y:X,t:r.t}}return null}else{for(let X=0;X<2;X++)if(o(X===0?b:C,E,_),r.loc==i.ORIGIN){const K=X===0?b:C;return{x:K.x,y:K.y,t:r.t}}const W=+(I+q*(M-I)).toPrecision(10),V=+(P+q*(L-P)).toPrecision(10);return{x:W,y:V,t:q}}}function o(E,_,b){const C=b.x-_.x,I=b.y-_.y,M=E.x-_.x,R=E.y-_.y,D=C*R-M*I;if(E.x===_.x&&E.y===_.y){r.loc=i.ORIGIN,r.t=0;return}if(E.x===b.x&&E.y===b.y){r.loc=i.DESTINATION,r.t=1;return}if(D<-Number.EPSILON){r.loc=i.LEFT;return}if(D>Number.EPSILON){r.loc=i.RIGHT;return}if(C*M<0||I*R<0){r.loc=i.BEHIND;return}if(Math.sqrt(C*C+I*I)<Math.sqrt(M*M+R*R)){r.loc=i.BEYOND;return}let P;C!==0?P=M/C:P=R/I,r.loc=i.BETWEEN,r.t=P}function l(E,_){const b=[],C=[];for(let I=1;I<E.length;I++){const M=E[I-1],R=E[I];for(let D=1;D<_.length;D++){const P=_[D-1],L=_[D],O=a(M,R,P,L);O!==null&&b.find(U=>U.t<=O.t+Number.EPSILON&&U.t>=O.t-Number.EPSILON)===void 0&&(b.push(O),C.push(new We(O.x,O.y)))}}return C}function c(E,_,b){const C=new We;_.getCenter(C);const I=[];return b.forEach(M=>{M.boundingBox.containsPoint(C)&&l(E,M.points).forEach(D=>{I.push({identifier:M.identifier,isCW:M.isCW,point:D})})}),I.sort((M,R)=>M.point.x-R.point.x),I}function h(E,_,b,C,I){(I==null||I==="")&&(I="nonzero");const M=new We;E.boundingBox.getCenter(M);const R=[new We(b,M.y),new We(C,M.y)],D=c(R,E.boundingBox,_);D.sort((H,z)=>H.point.x-z.point.x);const P=[],L=[];D.forEach(H=>{H.identifier===E.identifier?P.push(H):L.push(H)});const O=P[0].point.x,U=[];let j=0;for(;j<L.length&&L[j].point.x<O;)U.length>0&&U[U.length-1]===L[j].identifier?U.pop():U.push(L[j].identifier),j++;if(U.push(E.identifier),I==="evenodd"){const H=U.length%2===0,z=U[U.length-2];return{identifier:E.identifier,isHole:H,for:z}}else if(I==="nonzero"){let H=!0,z=null,q=null;for(let k=0;k<U.length;k++){const W=U[k];H?(q=_[W].isCW,H=!1,z=W):q!==_[W].isCW&&(q=_[W].isCW,H=!0)}return{identifier:E.identifier,isHole:H,for:z}}else console.warn('fill-rule: "'+I+'" is currently not implemented.')}let f=999999999,p=-999999999,g=t.subPaths.map(E=>{const _=E.getPoints();let b=-999999999,C=999999999,I=-999999999,M=999999999;for(let R=0;R<_.length;R++){const D=_[R];D.y>b&&(b=D.y),D.y<C&&(C=D.y),D.x>I&&(I=D.x),D.x<M&&(M=D.x)}return p<=I&&(p=I+1),f>=M&&(f=M-1),{curves:E.curves,points:_,isCW:Al.isClockWise(_),identifier:-1,boundingBox:new yG(new We(M,C),new We(I,b))}});g=g.filter(E=>E.points.length>1);for(let E=0;E<g.length;E++)g[E].identifier=E;const y=g.map(E=>h(E,g,f,p,t.userData?t.userData.style.fillRule:void 0)),x=[];return g.forEach(E=>{if(!y[E.identifier].isHole){const b=new id;b.curves=E.curves,y.filter(I=>I.isHole&&I.for===E.identifier).forEach(I=>{const M=g[I.identifier],R=new sm;R.curves=M.curves,b.holes.push(R)}),x.push(b)}}),x}static getStrokeStyle(t,n,i,r,a){return t=t!==void 0?t:1,n=n!==void 0?n:"#000",i=i!==void 0?i:"miter",r=r!==void 0?r:"butt",a=a!==void 0?a:4,{strokeColor:n,strokeWidth:t,strokeLineJoin:i,strokeLineCap:r,strokeMiterLimit:a}}static pointsToStroke(t,n,i,r){const a=[],o=[],l=[];if(s.pointsToStrokeWithBuffers(t,n,i,r,a,o,l)===0)return null;const c=new hn;return c.setAttribute("position",new Bt(a,3)),c.setAttribute("normal",new Bt(o,3)),c.setAttribute("uv",new Bt(l,2)),c}static pointsToStrokeWithBuffers(t,n,i,r,a,o,l,c){const h=new We,f=new We,p=new We,g=new We,y=new We,x=new We,E=new We,_=new We,b=new We,C=new We,I=new We,M=new We,R=new We,D=new We,P=new We,L=new We,O=new We;i=i!==void 0?i:12,r=r!==void 0?r:.001,c=c!==void 0?c:0,t=ve(t);const U=t.length;if(U<2)return 0;const j=t[0].equals(t[U-1]);let H,z=t[0],q;const k=n.strokeWidth/2,W=1/(U-1);let V=0,X,K,te,oe,Ee=!1,Ce=0,se=c*3,ie=c*2;ne(t[0],t[1],h).multiplyScalar(k),_.copy(t[0]).sub(h),b.copy(t[0]).add(h),C.copy(_),I.copy(b);for(let Ae=1;Ae<U;Ae++){H=t[Ae],Ae===U-1?j?q=t[1]:q=void 0:q=t[Ae+1];const Se=h;if(ne(z,H,Se),p.copy(Se).multiplyScalar(k),M.copy(H).sub(p),R.copy(H).add(p),X=V+W,K=!1,q!==void 0){ne(H,q,f),p.copy(f).multiplyScalar(k),D.copy(H).sub(p),P.copy(H).add(p),te=!0,p.subVectors(q,z),Se.dot(p)<0&&(te=!1),Ae===1&&(Ee=te),p.subVectors(q,H),p.normalize();const be=Math.abs(Se.dot(p));if(be>Number.EPSILON){const Re=k/be;p.multiplyScalar(-Re),g.subVectors(H,z),y.copy(g).setLength(Re).add(p),L.copy(y).negate();const me=y.length(),ue=g.length();g.divideScalar(ue),x.subVectors(q,H);const $e=x.length();switch(x.divideScalar($e),g.dot(L)<ue&&x.dot(L)<$e&&(K=!0),O.copy(y).add(H),L.add(H),oe=!1,K?te?(P.copy(L),R.copy(L)):(D.copy(L),M.copy(L)):Ge(),n.strokeLineJoin){case"bevel":Ue(te,K,X);break;case"round":nt(te,K),te?Be(H,M,D,X,0):Be(H,P,R,X,1);break;case"miter":case"miter-clip":default:const gt=k*n.strokeMiterLimit/me;if(gt<1)if(n.strokeLineJoin!=="miter-clip"){Ue(te,K,X);break}else nt(te,K),te?(x.subVectors(O,M).multiplyScalar(gt).add(M),E.subVectors(O,D).multiplyScalar(gt).add(D),re(M,X,0),re(x,X,0),re(H,X,.5),re(H,X,.5),re(x,X,0),re(E,X,0),re(H,X,.5),re(E,X,0),re(D,X,0)):(x.subVectors(O,R).multiplyScalar(gt).add(R),E.subVectors(O,P).multiplyScalar(gt).add(P),re(R,X,1),re(x,X,1),re(H,X,.5),re(H,X,.5),re(x,X,1),re(E,X,1),re(H,X,.5),re(E,X,1),re(P,X,1));else K?(te?(re(b,V,1),re(_,V,0),re(O,X,0),re(b,V,1),re(O,X,0),re(L,X,1)):(re(b,V,1),re(_,V,0),re(O,X,1),re(_,V,0),re(L,X,0),re(O,X,1)),te?D.copy(O):P.copy(O)):te?(re(M,X,0),re(O,X,0),re(H,X,.5),re(H,X,.5),re(O,X,0),re(D,X,0)):(re(R,X,1),re(O,X,1),re(H,X,.5),re(H,X,.5),re(O,X,1),re(P,X,1)),oe=!0;break}}else Ge()}else Ge();!j&&Ae===U-1&&pe(t[0],C,I,te,!0,V),V=X,z=H,_.copy(D),b.copy(P)}if(!j)pe(H,M,R,te,!1,X);else if(K&&a){let Ae=O,Se=L;Ee!==te&&(Ae=L,Se=O),te?(oe||Ee)&&(Se.toArray(a,0),Se.toArray(a,9),oe&&Ae.toArray(a,3)):(oe||!Ee)&&(Se.toArray(a,3),Se.toArray(a,9),oe&&Ae.toArray(a,0))}return Ce;function ne(Ae,Se,be){return be.subVectors(Se,Ae),be.set(-be.y,be.x).normalize()}function re(Ae,Se,be){a&&(a[se]=Ae.x,a[se+1]=Ae.y,a[se+2]=0,o&&(o[se]=0,o[se+1]=0,o[se+2]=1),se+=3,l&&(l[ie]=Se,l[ie+1]=be,ie+=2)),Ce+=3}function Be(Ae,Se,be,Re,me){h.copy(Se).sub(Ae).normalize(),f.copy(be).sub(Ae).normalize();let ue=Math.PI;const $e=h.dot(f);Math.abs($e)<1&&(ue=Math.abs(Math.acos($e))),ue/=i,p.copy(Se);for(let gt=0,ge=i-1;gt<ge;gt++)g.copy(p).rotateAround(Ae,ue),re(p,Re,me),re(g,Re,me),re(Ae,Re,.5),p.copy(g);re(g,Re,me),re(be,Re,me),re(Ae,Re,.5)}function Ge(){re(b,V,1),re(_,V,0),re(M,X,0),re(b,V,1),re(M,X,0),re(R,X,1)}function Ue(Ae,Se,be){Se?Ae?(re(b,V,1),re(_,V,0),re(M,X,0),re(b,V,1),re(M,X,0),re(L,X,1),re(M,be,0),re(D,be,0),re(L,be,.5)):(re(b,V,1),re(_,V,0),re(R,X,1),re(_,V,0),re(L,X,0),re(R,X,1),re(R,be,1),re(L,be,0),re(P,be,1)):Ae?(re(M,be,0),re(D,be,0),re(H,be,.5)):(re(R,be,1),re(P,be,0),re(H,be,.5))}function nt(Ae,Se){Se&&(Ae?(re(b,V,1),re(_,V,0),re(M,X,0),re(b,V,1),re(M,X,0),re(L,X,1),re(M,V,0),re(H,X,.5),re(L,X,1),re(H,X,.5),re(D,V,0),re(L,X,1)):(re(b,V,1),re(_,V,0),re(R,X,1),re(_,V,0),re(L,X,0),re(R,X,1),re(R,V,1),re(L,X,0),re(H,X,.5),re(H,X,.5),re(L,X,0),re(P,V,1)))}function pe(Ae,Se,be,Re,me,ue){switch(n.strokeLineCap){case"round":me?Be(Ae,be,Se,ue,.5):Be(Ae,Se,be,ue,.5);break;case"square":if(me)h.subVectors(Se,Ae),f.set(h.y,-h.x),p.addVectors(h,f).add(Ae),g.subVectors(f,h).add(Ae),Re?(p.toArray(a,3),g.toArray(a,0),g.toArray(a,9)):(p.toArray(a,3),l[7]===1?g.toArray(a,9):p.toArray(a,9),g.toArray(a,0));else{h.subVectors(be,Ae),f.set(h.y,-h.x),p.addVectors(h,f).add(Ae),g.subVectors(f,h).add(Ae);const $e=a.length;Re?(p.toArray(a,$e-3),g.toArray(a,$e-6),g.toArray(a,$e-12)):(g.toArray(a,$e-6),p.toArray(a,$e-3),g.toArray(a,$e-12))}break}}function ve(Ae){let Se=!1;for(let Re=1,me=Ae.length-1;Re<me;Re++)if(Ae[Re].distanceTo(Ae[Re+1])<r){Se=!0;break}if(!Se)return Ae;const be=[];be.push(Ae[0]);for(let Re=1,me=Ae.length-1;Re<me;Re++)Ae[Re].distanceTo(Ae[Re+1])>=r&&be.push(Ae[Re]);return be.push(Ae[Ae.length-1]),be}}}return s})(),$ne=/^[og]\s*(.+)?/,Jne=/^mtllib /,Zne=/^usemtl /,eie=/^usemap /,iN=new de,rM=new de,sN=new de,rN=new de,ul=new de;function tie(){const s={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(i,r){const a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);const o={index:this.materials.length,name:i||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:a!==void 0?a.smooth:this.smooth,groupStart:a!==void 0?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(o),o},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(i){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),i&&this.materials.length>1)for(let a=this.materials.length-1;a>=0;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return i&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},n&&n.name&&typeof n.clone=="function"){const i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseNormalIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseUVIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/2)*2},addVertex:function(e,t,n){const i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const i=this.normals,r=this.object.geometry.normals;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(e,t,n){const i=this.vertices,r=this.object.geometry.normals;iN.fromArray(i,e),rM.fromArray(i,t),sN.fromArray(i,n),ul.subVectors(sN,rM),rN.subVectors(iN,rM),ul.cross(rN),ul.normalize(),r.push(ul.x,ul.y,ul.z),r.push(ul.x,ul.y,ul.z),r.push(ul.x,ul.y,ul.z)},addColor:function(e,t,n){const i=this.colors,r=this.object.geometry.colors;i[e]!==void 0&&r.push(i[e+0],i[e+1],i[e+2]),i[t]!==void 0&&r.push(i[t+0],i[t+1],i[t+2]),i[n]!==void 0&&r.push(i[n+0],i[n+1],i[n+2])},addUV:function(e,t,n){const i=this.uvs,r=this.object.geometry.uvs;r.push(i[e+0],i[e+1]),r.push(i[t+0],i[t+1]),r.push(i[n+0],i[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,i,r,a,o,l,c){const h=this.vertices.length;let f=this.parseVertexIndex(e,h),p=this.parseVertexIndex(t,h),g=this.parseVertexIndex(n,h);if(this.addVertex(f,p,g),this.addColor(f,p,g),o!==void 0&&o!==""){const y=this.normals.length;f=this.parseNormalIndex(o,y),p=this.parseNormalIndex(l,y),g=this.parseNormalIndex(c,y),this.addNormal(f,p,g)}else this.addFaceNormal(f,p,g);if(i!==void 0&&i!==""){const y=this.uvs.length;f=this.parseUVIndex(i,y),p=this.parseUVIndex(r,y),g=this.parseUVIndex(a,y),this.addUV(f,p,g),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,i=e.length;n<i;n++){const r=this.parseVertexIndex(e[n],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,i=this.uvs.length;for(let r=0,a=e.length;r<a;r++)this.addVertexLine(this.parseVertexIndex(e[r],n));for(let r=0,a=t.length;r<a;r++)this.addUVLine(this.parseUVIndex(t[r],i))}};return s.startObject("",!1),s}class nie extends Fs{constructor(e){super(e),this.materials=null}load(e,t,n,i){const r=this,a=new Js(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(r.parse(o))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}setMaterials(e){return this.materials=e,this}parse(e){const t=new tie;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let i="",r="",a=0,o=[];const l=typeof"".trimLeft=="function";for(let f=0,p=n.length;f<p;f++)if(i=n[f],i=l?i.trimLeft():i.trim(),a=i.length,a!==0&&(r=i.charAt(0),r!=="#"))if(r==="v"){const g=i.split(/\s+/);switch(g[0]){case"v":t.vertices.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])),g.length>=7?t.colors.push(parseFloat(g[4]),parseFloat(g[5]),parseFloat(g[6])):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3]));break;case"vt":t.uvs.push(parseFloat(g[1]),parseFloat(g[2]));break}}else if(r==="f"){const y=i.substr(1).trim().split(/\s+/),x=[];for(let _=0,b=y.length;_<b;_++){const C=y[_];if(C.length>0){const I=C.split("/");x.push(I)}}const E=x[0];for(let _=1,b=x.length-1;_<b;_++){const C=x[_],I=x[_+1];t.addFace(E[0],C[0],I[0],E[1],C[1],I[1],E[2],C[2],I[2])}}else if(r==="l"){const g=i.substring(1).trim().split(" ");let y=[];const x=[];if(i.indexOf("/")===-1)y=g;else for(let E=0,_=g.length;E<_;E++){const b=g[E].split("/");b[0]!==""&&y.push(b[0]),b[1]!==""&&x.push(b[1])}t.addLineGeometry(y,x)}else if(r==="p"){const y=i.substr(1).trim().split(" ");t.addPointGeometry(y)}else if((o=$ne.exec(i))!==null){const g=(" "+o[0].substr(1).trim()).substr(1);t.startObject(g)}else if(Zne.test(i))t.object.startMaterial(i.substring(7).trim(),t.materialLibraries);else if(Jne.test(i))t.materialLibraries.push(i.substring(7).trim());else if(eie.test(i))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(r==="s"){if(o=i.split(" "),o.length>1){const y=o[1].trim().toLowerCase();t.object.smooth=y!=="0"&&y!=="off"}else t.object.smooth=!0;const g=t.object.currentMaterial();g&&(g.smooth=t.object.smooth)}else{if(i==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+i+'"')}t.finalize();const c=new so;if(c.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let f=0,p=t.objects.length;f<p;f++){const g=t.objects[f],y=g.geometry,x=g.materials,E=y.type==="Line",_=y.type==="Points";let b=!1;if(y.vertices.length===0)continue;const C=new hn;C.setAttribute("position",new Bt(y.vertices,3)),y.normals.length>0&&C.setAttribute("normal",new Bt(y.normals,3)),y.colors.length>0&&(b=!0,C.setAttribute("color",new Bt(y.colors,3))),y.hasUVIndices===!0&&C.setAttribute("uv",new Bt(y.uvs,2));const I=[];for(let R=0,D=x.length;R<D;R++){const P=x[R],L=P.name+"_"+P.smooth+"_"+b;let O=t.materials[L];if(this.materials!==null){if(O=this.materials.create(P.name),E&&O&&!(O instanceof $s)){const U=new $s;Ps.prototype.copy.call(U,O),U.color.copy(O.color),O=U}else if(_&&O&&!(O instanceof $f)){const U=new $f({size:10,sizeAttenuation:!1});Ps.prototype.copy.call(U,O),U.color.copy(O.color),U.map=O.map,O=U}}O===void 0&&(E?O=new $s:_?O=new $f({size:1,sizeAttenuation:!1}):O=new SA,O.name=P.name,O.flatShading=!P.smooth,O.vertexColors=b,t.materials[L]=O),I.push(O)}let M;if(I.length>1){for(let R=0,D=x.length;R<D;R++){const P=x[R];C.addGroup(P.groupStart,P.groupCount,R)}E?M=new Go(C,I):_?M=new _A(C,I):M=new bi(C,I)}else E?M=new Go(C,I[0]):_?M=new _A(C,I[0]):M=new bi(C,I[0]);M.name=g.name,c.add(M)}else if(t.vertices.length>0){const f=new $f({size:1,sizeAttenuation:!1}),p=new hn;p.setAttribute("position",new Bt(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(p.setAttribute("color",new Bt(t.colors,3)),f.vertexColors=!0);const g=new _A(p,f);c.add(g)}return c}}const aM=new WeakMap;class iie extends Fs{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const r=new Js(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,a=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,o).then(t).catch(i)},n,i)}decodeDracoFile(e,t,n,i){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){for(const l in t.attributeTypes){const c=t.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[l]=c.name)}const n=JSON.stringify(t);if(aM.has(e)){const l=aM.get(e);if(l.key===n)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(r,a).then(l=>(i=l,new Promise((c,h)=>{i._callbacks[r]={resolve:c,reject:h},i.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{i&&r&&this._releaseTask(i,r)}),aM.set(e,{key:n,promise:o}),o}_createGeometry(e){const t=new hn;e.index&&t.setIndex(new ei(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],r=i.name,a=i.array,o=i.itemSize;t.setAttribute(r,new ei(a,o))}return t}_loadLibrary(e,t){const n=new Js(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((i,r)=>{n.load(e,i,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const i=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const r=sie.toString(),a=["/* draco decoder */",i,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(r){const a=r.data;switch(a.type){case"decode":i._callbacks[a.id].resolve(a);break;case"error":i._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,r){return i._taskLoad>r._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function sie(){let s,e;onmessage=function(a){const o=a.data;switch(o.type){case"init":s=o.decoderConfig,e=new Promise(function(h){s.onModuleLoaded=function(f){h({draco:f})},DracoDecoderModule(s)});break;case"decode":const l=o.buffer,c=o.taskConfig;e.then(h=>{const f=h.draco,p=new f.Decoder,g=new f.DecoderBuffer;g.Init(new Int8Array(l),l.byteLength);try{const y=t(f,p,g,c),x=y.attributes.map(E=>E.array.buffer);y.index&&x.push(y.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:y},x)}catch(y){console.error(y),self.postMessage({type:"error",id:o.id,error:y.message})}finally{f.destroy(g),f.destroy(p)}});break}};function t(a,o,l,c){const h=c.attributeIDs,f=c.attributeTypes;let p,g;const y=o.GetEncodedGeometryType(l);if(y===a.TRIANGULAR_MESH)p=new a.Mesh,g=o.DecodeBufferToMesh(l,p);else if(y===a.POINT_CLOUD)p=new a.PointCloud,g=o.DecodeBufferToPointCloud(l,p);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!g.ok()||p.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+g.error_msg());const x={index:null,attributes:[]};for(const E in h){const _=self[f[E]];let b,C;if(c.useUniqueIDs)C=h[E],b=o.GetAttributeByUniqueId(p,C);else{if(C=o.GetAttributeId(p,a[h[E]]),C===-1)continue;b=o.GetAttribute(p,C)}x.attributes.push(i(a,o,p,E,_,b))}return y===a.TRIANGULAR_MESH&&(x.index=n(a,o,p)),a.destroy(p),x}function n(a,o,l){const h=l.num_faces()*3,f=h*4,p=a._malloc(f);o.GetTrianglesUInt32Array(l,f,p);const g=new Uint32Array(a.HEAPF32.buffer,p,h).slice();return a._free(p),{array:g,itemSize:1}}function i(a,o,l,c,h,f){const p=f.num_components(),y=l.num_points()*p,x=y*h.BYTES_PER_ELEMENT,E=r(a,h),_=a._malloc(x);o.GetAttributeDataArrayForAllPoints(l,f,E,x,_);const b=new h(a.HEAPF32.buffer,_,y).slice();return a._free(_),{name:c,array:b,itemSize:p}}function r(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let bS;const rie=()=>{if(bS)return bS;const s="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let i=s;WebAssembly.validate(t)&&(i=e);let r;const a=WebAssembly.instantiate(o(i),{}).then(f=>{r=f.instance,r.exports.__wasm_call_ctors()});function o(f){const p=new Uint8Array(f.length);for(let y=0;y<f.length;++y){const x=f.charCodeAt(y);p[y]=x>96?x-71:x>64?x-65:x>47?x+4:x>46?63:62}let g=0;for(let y=0;y<f.length;++y)p[g++]=p[y]<60?n[p[y]]:(p[y]-60)*64+p[++y];return p.buffer.slice(0,g)}function l(f,p,g,y,x,E){const _=r.exports.sbrk,b=g+3&-4,C=_(b*y),I=_(x.length),M=new Uint8Array(r.exports.memory.buffer);M.set(x,I);const R=f(C,g,y,I,x.length);if(R===0&&E&&E(C,b,y),p.set(M.subarray(C,C+g*y)),_(C-_(0)),R!==0)throw new Error(`Malformed buffer data: ${R}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return bS={ready:a,supported:!0,decodeVertexBuffer(f,p,g,y,x){l(r.exports.meshopt_decodeVertexBuffer,f,p,g,y,r.exports[c[x]])},decodeIndexBuffer(f,p,g,y){l(r.exports.meshopt_decodeIndexBuffer,f,p,g,y)},decodeIndexSequence(f,p,g,y){l(r.exports.meshopt_decodeIndexSequence,f,p,g,y)},decodeGltfBuffer(f,p,g,y,x,E){l(r.exports[h[x]],f,p,g,y,r.exports[c[E]])}},bS};let oM=null;async function aie(s){return typeof s=="string"?await(await fetch(s)).json():s}function oie(s){return oM||(oM=new iH),oM.parse(s)}async function bH(s){const e=await aie(s);return oie(e)}function $B(s){return nee(bH,[s])}$B.preload=s=>iee(bH,[s]);$B.clear=s=>see([s]);const lie=["string","number"],cie=s=>{let e="";const t=[];return ee.Children.forEach(s,n=>{lie.includes(typeof n)?e+=n+"":t.push(n)}),[e,...t]},cC=ee.forwardRef(({font:s,letterSpacing:e=0,lineHeight:t=1,size:n=1,height:i=.2,bevelThickness:r=.1,bevelSize:a=.01,bevelEnabled:o=!1,bevelOffset:l=0,bevelSegments:c=4,curveSegments:h=8,smooth:f,children:p,...g},y)=>{ee.useMemo(()=>HG({RenamedTextGeometry:Ane}),[]);const x=ee.useRef(null),E=$B(s),_=ee.useMemo(()=>({font:E,size:n,height:i,bevelThickness:r,bevelSize:a,bevelEnabled:o,bevelSegments:c,bevelOffset:l,curveSegments:h,letterSpacing:e,lineHeight:t}),[E,n,i,r,a,o,c,l,h,e,t]),[b,...C]=ee.useMemo(()=>cie(p),[p]),I=ee.useMemo(()=>[b,_],[b,_]);return ee.useLayoutEffect(()=>{f&&(x.current.geometry=ote(x.current.geometry,f),x.current.geometry.computeVertexNormals())},[I,f]),ee.useImperativeHandle(y,()=>x.current,[]),ee.createElement("mesh",zw({},g,{ref:x}),ee.createElement("renamedTextGeometry",{args:I}),C)});var $S={exports:{}},uie=$S.exports,aN;function hie(){return aN||(aN=1,(function(s,e){(function(t,n){s.exports=n()})(uie,function(){var t=function(){function n(g){return a.appendChild(g.dom),g}function i(g){for(var y=0;y<a.children.length;y++)a.children[y].style.display=y===g?"block":"none";r=g}var r=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(g){g.preventDefault(),i(++r%a.children.length)},!1);var o=(performance||Date).now(),l=o,c=0,h=n(new t.Panel("FPS","#0ff","#002")),f=n(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var p=n(new t.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:a,addPanel:n,showPanel:i,begin:function(){o=(performance||Date).now()},end:function(){c++;var g=(performance||Date).now();if(f.update(g-o,200),g>l+1e3&&(h.update(1e3*c/(g-l),100),l=g,c=0,p)){var y=performance.memory;p.update(y.usedJSHeapSize/1048576,y.jsHeapSizeLimit/1048576)}return g},update:function(){o=this.end()},domElement:a,setMode:i}};return t.Panel=function(n,i,r){var a=1/0,o=0,l=Math.round,c=l(window.devicePixelRatio||1),h=80*c,f=48*c,p=3*c,g=2*c,y=3*c,x=15*c,E=74*c,_=30*c,b=document.createElement("canvas");b.width=h,b.height=f,b.style.cssText="width:80px;height:48px";var C=b.getContext("2d");return C.font="bold "+9*c+"px Helvetica,Arial,sans-serif",C.textBaseline="top",C.fillStyle=r,C.fillRect(0,0,h,f),C.fillStyle=i,C.fillText(n,p,g),C.fillRect(y,x,E,_),C.fillStyle=r,C.globalAlpha=.9,C.fillRect(y,x,E,_),{dom:b,update:function(I,M){a=Math.min(a,I),o=Math.max(o,I),C.fillStyle=r,C.globalAlpha=1,C.fillRect(0,0,h,x),C.fillStyle=i,C.fillText(l(I)+" "+n+" ("+l(a)+"-"+l(o)+")",p,g),C.drawImage(b,y+c,x,E-c,_,y,x,E-c,_),C.fillRect(y+E-c,x,c,_),C.fillStyle=r,C.globalAlpha=.9,C.fillRect(y+E-c,x,c,l((1-I/M)*_))}}},t})})($S)),$S.exports}hie();const fie=({text:s})=>{const e=ee.useRef(null),t=Qi(i=>i.config.tightness??5),n=ee.useMemo(()=>new bB(Array.from({length:Math.max(s.length,10)}).map((i,r)=>new de(Math.sin(r*.5)*t,r-5,Math.cos(r*.5)*t))),[t,s.length]);return Lee((i,r)=>{e.current&&(e.current.rotation.y+=r*.3)}),G.jsx("group",{ref:e,children:s.split("").map((i,r)=>G.jsxs(cC,{font:"https://unpkg.com/three@0.158.0/examples/fonts/helvetiker_regular.typeface.json",position:n.getPoint(r/Math.max(1,s.length-1)),size:.8,children:[i,G.jsx("meshStandardMaterial",{color:"white"})]},r))})},die=()=>{const s=Qi(t=>t.config.tightness??5),e=Qi(t=>t.setConfig);return G.jsxs("div",{style:{display:"grid",gap:8},children:[G.jsx("label",{htmlFor:"tightness",children:"Spiralen-Enge"}),G.jsx("input",{id:"tightness",type:"range",min:1,max:15,value:s,onChange:t=>e({tightness:parseFloat(t.target.value)})})]})};class TH{id="spiral";name="3D Spirale";getAnimationComponent(){return fie}getControlComponent(){return die}}const pie="https://unpkg.com/three@0.158.0/examples/fonts/helvetiker_regular.typeface.json",mie=({text:s})=>{const e=Qi(a=>a.config.progress??.8),t=Qi(a=>a.config.spread??6),n=s.split(""),i=ee.useMemo(()=>n.map(()=>new de((Math.random()*2-1)*t,(Math.random()*2-1)*t,(Math.random()*2-1)*t)),[n.length,t]),r=ee.useMemo(()=>n.map((a,o)=>new de((o-(n.length-1)/2)*1.2,0,0)),[n.length]);return G.jsx("group",{children:n.map((a,o)=>{const l=i[o],c=r[o],h=new de().lerpVectors(l,c,Fr.clamp(e,0,1));return G.jsxs(cC,{font:pie,position:h,size:.8,children:[a,G.jsx("meshStandardMaterial",{color:"white"})]},`${a}-${o}`)})})},gie=()=>{const s=Qi(n=>n.config.progress??.8),e=Qi(n=>n.config.spread??6),t=Qi(n=>n.setConfig);return G.jsxs("div",{style:{display:"grid",gap:8},children:[G.jsx("label",{htmlFor:"c-progress",children:"Fortschritt (Chaos  Ordnung)"}),G.jsx("input",{id:"c-progress",type:"range",min:0,max:1,step:.01,value:s,onChange:n=>t({progress:parseFloat(n.target.value)})}),G.jsx("label",{htmlFor:"c-spread",children:"Streuung"}),G.jsx("input",{id:"c-spread",type:"range",min:1,max:12,step:.5,value:e,onChange:n=>t({spread:parseFloat(n.target.value)})})]})};class Aie{id="chaos";name="Chaos  Ordnung";getAnimationComponent(){return mie}getControlComponent(){return gie}}const yie="https://unpkg.com/three@0.158.0/examples/fonts/helvetiker_regular.typeface.json",vie=({text:s})=>{const e=Qi(o=>o.config.amplitude??.9),t=Qi(o=>o.config.frequency??1.2),n=Qi(o=>o.config.speed??1.5),i=Date.now()%1e5/1e3,r=s.split(""),a=ee.useMemo(()=>r.map((o,l)=>new de(l*1.2,0,0)),[r.length]);return G.jsx("group",{position:[-(r.length-1)*.6,0,0],children:r.map((o,l)=>{const c=a[l],h=Math.sin(l*t+i*n)*e;return G.jsxs(cC,{font:yie,position:[c.x,h,0],size:.8,children:[o,G.jsx("meshStandardMaterial",{color:"white"})]},`${o}-${l}`)})})},Eie=()=>{const s=Qi(i=>i.config.amplitude??.9),e=Qi(i=>i.config.frequency??1.2),t=Qi(i=>i.config.speed??1.5),n=Qi(i=>i.setConfig);return G.jsxs("div",{style:{display:"grid",gap:8},children:[G.jsx("label",{htmlFor:"w-amp",children:"Amplitude"}),G.jsx("input",{id:"w-amp",type:"range",min:0,max:3,step:.1,value:s,onChange:i=>n({amplitude:parseFloat(i.target.value)})}),G.jsx("label",{htmlFor:"w-freq",children:"Frequenz"}),G.jsx("input",{id:"w-freq",type:"range",min:.2,max:3,step:.1,value:e,onChange:i=>n({frequency:parseFloat(i.target.value)})}),G.jsx("label",{htmlFor:"w-speed",children:"Geschwindigkeit"}),G.jsx("input",{id:"w-speed",type:"range",min:0,max:5,step:.1,value:t,onChange:i=>n({speed:parseFloat(i.target.value)})})]})};class xie{id="wave";name="Wave Field";getAnimationComponent(){return vie}getControlComponent(){return Eie}}const _ie="https://unpkg.com/three@0.158.0/examples/fonts/helvetiker_regular.typeface.json",Sie=({text:s})=>{const e=Qi(a=>a.config.radius??5),t=Qi(a=>a.config.orbitSpeed??.6),n=Date.now()%1e5/1e3,i=s.split(""),r=Math.PI*2/Math.max(1,i.length);return G.jsx("group",{children:i.map((a,o)=>{const l=o*r+n*t,c=Math.cos(l)*e,h=Math.sin(l)*e;return G.jsxs(cC,{font:_ie,position:[c,0,h],size:.8,children:[a,G.jsx("meshStandardMaterial",{color:"white"})]},`${a}-${o}`)})})},bie=()=>{const s=Qi(n=>n.config.radius??5),e=Qi(n=>n.config.orbitSpeed??.6),t=Qi(n=>n.setConfig);return G.jsxs("div",{style:{display:"grid",gap:8},children:[G.jsx("label",{htmlFor:"o-radius",children:"Radius"}),G.jsx("input",{id:"o-radius",type:"range",min:1,max:15,step:.5,value:s,onChange:n=>t({radius:parseFloat(n.target.value)})}),G.jsx("label",{htmlFor:"o-speed",children:"Orbit Speed"}),G.jsx("input",{id:"o-speed",type:"range",min:0,max:3,step:.05,value:e,onChange:n=>t({orbitSpeed:parseFloat(n.target.value)})})]})};class Tie{id="orbit";name="Orbit Letters";getAnimationComponent(){return Sie}getControlComponent(){return bie}}const CH={spiral:TH,chaos:Aie,wave:xie,orbit:Tie},Cie=Object.values(CH).map(s=>new s);function IH(s){const e=CH[s];return e?new e:(console.warn(`No strategy found for id: ${s}. Falling back to default.`),new TH)}const Iie=()=>{const s=Qi(i=>i.text),e=Qi(i=>i.setText),t=Qi(i=>i.selectedStrategyId),n=Qi(i=>i.setStrategy);return G.jsxs("div",{style:{display:"grid",gap:12,marginBottom:16},children:[G.jsx("input",{type:"text",value:s,onChange:i=>e(i.target.value),placeholder:"Text",style:{padding:"10px 12px",borderRadius:8,border:"1px solid var(--ring)"}}),G.jsx("select",{value:t,onChange:i=>n(i.target.value),style:{padding:"10px 12px",borderRadius:8,border:"1px solid var(--ring)"},children:Cie.map(i=>G.jsx("option",{value:i.id,children:i.name},i.id))})]})},Mie=({strategy:s})=>{const e=s.getControlComponent?s.getControlComponent():null;return e?G.jsx("div",{style:{marginTop:8},children:G.jsx(e,{})}):null},wie=()=>{const{text:s,selectedStrategyId:e}=Qi(),n=IH(e).getAnimationComponent();return G.jsx(n,{text:s})};function Rie(){const s=Qi(t=>t.selectedStrategyId),e=IH(s);return G.jsxs("div",{className:"section",style:{paddingTop:100},children:[G.jsxs("div",{className:"card",style:{marginBottom:16},children:[G.jsx("h2",{className:"h2",children:"Motion Design App"}),G.jsx(Iie,{}),G.jsx(Mie,{strategy:e})]}),G.jsx("div",{className:"card",style:{height:600},children:G.jsxs(ite,{camera:{position:[0,0,15],fov:45},children:[G.jsx("ambientLight",{intensity:.8}),G.jsx("pointLight",{position:[10,10,10]}),G.jsx(sA.Suspense,{fallback:null,children:G.jsx(wie,{})})]})})]})}const xu=ee.forwardRef(function({src:e,autoplay:t=!0,muted:n=!1,loop:i=!1,scaleMode:r="fit",fullscreenScaleMode:a,disableDoubleClickFullscreen:o=!1,onPlayChange:l,onTimeUpdate:c,onError:h,onMetadata:f},p){const g=ee.useRef(null),y=ee.useRef(null),[x,E]=ee.useState(!1),[_,b]=ee.useState(!1),[C,I]=ee.useState(0),[M,R]=ee.useState(0),D=ee.useRef(null),[P,L]=ee.useState("fit");ee.useImperativeHandle(p,()=>({play:()=>g.current?.play(),pause:()=>g.current?.pause(),togglePlay:()=>{const H=g.current;H&&(H.paused?H.play():H.pause())},setMuted:H=>{g.current&&(g.current.muted=H)},getCurrentTime:()=>g.current?.currentTime??0,setCurrentTime:H=>{g.current&&(g.current.currentTime=H)},getDuration:()=>g.current?.duration??0,toggleFullscreen:()=>{const H=y.current;H&&(document.fullscreenElement?document.exitFullscreen?.():H.requestFullscreen?.())},enterFullscreen:()=>{y.current?.requestFullscreen?.()},exitFullscreen:()=>{document.exitFullscreen?.()}}),[]),ee.useEffect(()=>{const H=g.current;if(!H)return;let z=null;return e.endsWith(".m3u8")?H.canPlayType("application/vnd.apple.mpegurl")?H.src=e:eo.isSupported()?(z=new eo({enableWorker:!0}),z.loadSource(e),z.attachMedia(H),z.on(eo.Events.ERROR,()=>h?.("Stream error"))):h?.("HLS not supported"):H.src=e,()=>{z&&z.destroy()}},[e,h]),ee.useEffect(()=>{const H=g.current;if(!H)return;const z=()=>{l?.(!0),b(!0),D.current&&window.clearTimeout(D.current),D.current=window.setTimeout(()=>b(!1),2e3)},q=()=>{l?.(!1),b(!0)},k=()=>{c?.(H.currentTime,H.duration),I(H.currentTime),R(H.duration||0)},W=()=>f?.({width:H.videoWidth,height:H.videoHeight});return H.addEventListener("play",z),H.addEventListener("pause",q),H.addEventListener("timeupdate",k),H.addEventListener("loadedmetadata",W),()=>{H.removeEventListener("play",z),H.removeEventListener("pause",q),H.removeEventListener("timeupdate",k),H.removeEventListener("loadedmetadata",W)}},[l,c,f]),ee.useEffect(()=>{const H=()=>E(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",H),()=>document.removeEventListener("fullscreenchange",H)},[]);const O=()=>{const H=y.current;H&&(document.fullscreenElement?document.exitFullscreen?.():H.requestFullscreen?.())},U=M?C/M*100:0,j=x?a??P:r??"fit";return G.jsxs("div",{ref:y,style:{position:"relative",width:"100%",height:"100%"},onMouseMove:()=>{b(!0),D.current&&window.clearTimeout(D.current),g.current?.paused||(D.current=window.setTimeout(()=>b(!1),2e3))},onDoubleClick:o?void 0:O,children:[G.jsx("video",{ref:g,playsInline:!0,autoPlay:t,muted:n,loop:i,style:{width:"100%",height:"100%",objectFit:j==="fill"?"cover":"contain",background:"#000",cursor:"pointer"},onClick:()=>{const H=g.current;H&&(H.paused?H.play():H.pause())}}),x&&G.jsxs("div",{style:{position:"absolute",inset:0,pointerEvents:"none",transition:"opacity .25s",opacity:_?1:0},children:[G.jsx("button",{style:{position:"absolute",top:12,right:12,pointerEvents:"auto"},className:"pill",onClick:O,children:"Exit"}),G.jsx("button",{style:{position:"absolute",top:12,right:72,pointerEvents:"auto"},className:"pill",onClick:()=>L(H=>H==="fit"?"fill":"fit"),title:P==="fit"?"Switch to Fill":"Switch to Fit",children:P==="fit"?"Fit":"Fill"}),G.jsx("div",{style:{position:"absolute",bottom:18,left:"2%",width:"96%",height:5,background:"rgba(255,255,255,0.3)",pointerEvents:"auto",borderRadius:3},onClick:H=>{const z=H.currentTarget.getBoundingClientRect(),q=(H.clientX-z.left)/z.width;g.current&&(g.current.currentTime=q*(M||0))},children:G.jsx("div",{style:{width:`${U}%`,height:"100%",background:"var(--brand-2)"}})})]})]})}),lM="https://api.arkturian.com",cM="Inetpass1";function Bie(){const s=new URL(window.location.href),e=s.searchParams.get("collection_id"),t=s.searchParams.get("current_id"),n=s.searchParams.get("src"),[i,r]=ee.useState([]),[a,o]=ee.useState(-1),[l,c]=ee.useState(!0),[h,f]=ee.useState("fit"),[p,g]=ee.useState(!1),[y,x]=ee.useState(0),[E,_]=ee.useState(0),[b,C]=ee.useState({w:16,h:9}),I=ee.useRef(null),M=a>=0?i[a]:null;ee.useEffect(()=>{(async()=>{try{if(e){const z=await fetch(`${lM}/storage/list?collection_id=${e}`,{headers:{"X-API-KEY":cM}});if(!z.ok)throw new Error("collection load failed");const k=(await z.json()).items.filter(W=>W.hls_url);if(r(k),k.length){const W=t?k.findIndex(V=>String(V.id)===String(t)):0;o(W>=0?W:0)}}else if(t){const z=await fetch(`${lM}/storage/objects/${t}`,{headers:{"X-API-KEY":cM}});if(!z.ok)throw new Error("object load failed");const q=await z.json();q.hls_url&&(r([q]),o(0))}else n&&(r([{id:-1,hls_url:n,title:"Single Video"}]),o(0))}catch(z){console.error(z)}})()},[e,t,n]);const R=ee.useMemo(()=>M?.title||M?.original_filename||"",[M]),D=ee.useMemo(()=>M?.description||"",[M]),P=M?.likes??0;function L(){!M||M.id<0||fetch(`${lM}/storage/objects/${M.id}/like`,{method:"POST",headers:{"X-API-KEY":cM}}).then(z=>z.ok?z.json():Promise.reject("like failed")).then(z=>{r(q=>q.map(k=>k.id===z.id?{...k,likes:z.likes}:k))}).catch(console.error)}const O=(z,q)=>{x(z),_(q||0)},U=E?y/E*100:0,H=`${1/(b.h?b.w/b.h:16/9)*100}%`;return G.jsx("main",{role:"main",children:G.jsxs("section",{className:"section",style:{paddingTop:40},children:[G.jsxs("div",{className:"card",style:{display:"grid",gridTemplateColumns:"1fr 280px",gap:16},children:[G.jsxs("div",{style:{position:"relative",width:"100%"},children:[G.jsx("div",{style:{width:"100%",paddingTop:H}}),G.jsxs("div",{style:{position:"absolute",inset:0},children:[M&&G.jsx(xu,{ref:I,src:M.hls_url,autoplay:!0,muted:p,scaleMode:h,onPlayChange:()=>c(!0),onTimeUpdate:O,onError:z=>console.warn(z),onMetadata:({width:z,height:q})=>C({w:z,h:q})}),G.jsxs("div",{style:{position:"absolute",inset:0,pointerEvents:"none",transition:"opacity .3s",opacity:l?1:0},children:[G.jsx("button",{className:"pill",style:{position:"absolute",top:16,right:16,pointerEvents:"auto"},onClick:()=>g(z=>!z),children:p?"":""}),G.jsx("button",{className:"pill",style:{position:"absolute",top:16,right:76,pointerEvents:"auto"},onClick:()=>f(z=>z==="fit"?"fill":"fit"),children:""}),G.jsx("div",{style:{position:"absolute",bottom:18,left:"2%",width:"96%",height:5,background:"rgba(255,255,255,0.3)",pointerEvents:"auto",borderRadius:3},onClick:z=>{if(!I.current)return;const q=z.currentTarget.getBoundingClientRect(),k=(z.clientX-q.left)/q.width;I.current.setCurrentTime(k*E)},children:G.jsx("div",{style:{width:`${U}%`,height:"100%",background:"var(--brand-2)"}})})]})]})]}),G.jsxs("div",{style:{display:"grid",gap:8,alignContent:"start"},children:[G.jsx("div",{className:"muted",style:{fontSize:12},children:"Up next"}),i.slice(a+1,a+4).map(z=>G.jsx("button",{className:"flat-card",style:{textAlign:"left"},onClick:()=>o(i.findIndex(q=>q.id===z.id)),children:G.jsxs("div",{className:"flat-card-inner",children:[G.jsx("div",{className:"flat-card-title",style:{fontSize:14},children:z.title||z.original_filename}),G.jsx("div",{className:"flat-card-sub",style:{fontSize:12},children:z.description||""})]})},z.id))]})]}),G.jsxs("div",{className:"card",style:{marginTop:12,display:"grid",gap:8},children:[G.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[G.jsxs("div",{children:[G.jsx("h3",{style:{margin:"0 0 6px 0"},children:R}),D&&G.jsx("p",{className:"muted",style:{margin:0},children:D})]}),G.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[G.jsx("button",{className:"pill",onClick:()=>o(z=>Math.max(0,z-1)),disabled:a<=0,children:" Prev"}),G.jsx("button",{className:"pill",onClick:()=>o(z=>Math.min(i.length-1,z+1)),disabled:a>=i.length-1,children:"Next "}),G.jsxs("button",{className:"pill",onClick:L,children:[" ",P]})]})]}),i.length>1&&G.jsx("div",{className:"flat-grid",children:i.map((z,q)=>G.jsx("button",{className:"flat-card",style:{textAlign:"left",cursor:"pointer",borderColor:q===a?"var(--brand-2)":"var(--ring)"},onClick:()=>o(q),children:G.jsxs("div",{className:"flat-card-inner",children:[G.jsx("div",{className:"flat-card-title",style:{fontSize:14},children:z.title||z.original_filename}),G.jsx("div",{className:"flat-card-sub",style:{fontSize:12},children:z.description||""})]})},z.id))})]})]})})}function MH({item:s,mode:e,width:t,fixedHeight:n,showMeta:i=!0,autoplay:r=!0,cover:a=!1,onDoubleClick:o,onMeta:l,playerRef:c,muted:h,scaleMode:f,fullscreenScaleMode:p,onTimeUpdate:g,onPlayChange:y,miniContainerRef:x,miniStyle:E}){const[_,b]=ee.useState({w:16,h:9}),C=_.h?_.w/_.h:16/9,I=t?Math.ceil(t/C):void 0,M=n??I,R=s.title||s.original_filename||"";if(e==="theater")return G.jsx("div",{style:{position:"relative",width:"100%",height:"100%"},onDoubleClick:o,children:G.jsx(xu,{ref:c,src:s.hls_url,autoplay:r,muted:!!h,loop:!1,scaleMode:f??(a?"fill":"fit"),fullscreenScaleMode:p??f,onTimeUpdate:g,onPlayChange:y,onMetadata:({width:P,height:L})=>{b({w:P,h:L}),l?.(s.id,{w:P,h:L})}})});const D=G.jsxs(G.Fragment,{children:[t?G.jsx("div",{ref:x||void 0,style:{width:"100%",height:M,...E||{}},onDoubleClick:o,children:G.jsx(xu,{src:s.hls_url,autoplay:r,muted:!0,loop:!0,scaleMode:a?"fill":"fit",disableDoubleClickFullscreen:!!o,onMetadata:({width:P,height:L})=>{b({w:P,h:L}),l?.(s.id,{w:P,h:L})}})}):G.jsxs("div",{style:{position:"relative",width:"100%"},onDoubleClick:o,children:[G.jsx("div",{style:{width:"100%",paddingTop:`${1/C*100}%`}}),G.jsx("div",{ref:x||void 0,style:{position:"absolute",inset:0,...E||{}},children:G.jsx(xu,{src:s.hls_url,autoplay:r,muted:!0,loop:!0,scaleMode:a?"fill":"fit",disableDoubleClickFullscreen:!!o,onMetadata:({width:P,height:L})=>{b({w:P,h:L}),l?.(s.id,{w:P,h:L})}})})]}),i&&G.jsxs("div",{style:{marginTop:8},children:[G.jsx("div",{className:"flat-card-title",style:{fontSize:14},children:R}),s.description&&G.jsx("div",{className:"flat-card-sub",style:{fontSize:12},children:s.description})]})]});if(t){const P=(M||0)+(i?40:0)+24;return G.jsx("article",{className:"flat-card hitem",style:{width:t,height:P,overflow:"hidden"},children:G.jsx("div",{className:"flat-card-inner",style:{padding:12,display:"flex",flexDirection:"column",justifyContent:"flex-end",height:"100%"},children:D})})}return G.jsx("article",{className:"flat-card",style:{overflow:"hidden"},children:G.jsx("div",{className:"flat-card-inner",style:{padding:12},children:D})})}const Die="https://api.arkturian.com",Lie="Inetpass1";function Oie(){const[s,e]=ee.useState([]),[t,n]=ee.useState(null),[i,r]=ee.useState(!1),a=s0();return ee.useEffect(()=>{(async()=>{try{r(!0);const o=await fetch(`${Die}/storage/list?mine=false`,{headers:{"X-API-KEY":Lie}});if(!o.ok)throw new Error("list failed");const c=(await o.json()).items.filter(h=>h.hls_url);e(c),n(null)}catch(o){console.error(o),n("Could not load video list.")}finally{r(!1)}})()},[]),G.jsx("main",{role:"main",children:G.jsxs("section",{className:"section","aria-labelledby":"vodall-title",children:[G.jsx("h2",{id:"vodall-title",className:"h2",children:"All Videos"}),i&&G.jsx("p",{className:"muted",children:"Loading"}),t&&G.jsx("p",{className:"muted",style:{color:"crimson"},children:t}),!i&&!t&&G.jsx("div",{className:"masonry",children:s.map(o=>G.jsx("div",{className:"masonry-item",children:G.jsx(MH,{item:o,mode:"mini",onDoubleClick:()=>a(`/vod/theater?current_id=${o.id}&from=/vod/all`)})},o.id))})]})})}function oN(s,e,t){return Math.max(e,Math.min(t,s))}function Pie({label:s="Loading",durationMs:e=3e3,sizePx:t=230,heightRem:n=2.625,className:i,style:r,progress:a,onComplete:o}){const[l,c]=ee.useState(0),h=ee.useRef(0),f=ee.useRef(null),p=ee.useRef(!1),g=typeof a=="number",y=oN(g?a:l,0,100);ee.useEffect(()=>{if(g)return;function b(C){f.current==null&&(f.current=C);const I=C-f.current,M=oN(I/e,0,1),R=Nie(M),D=Math.round(R*100);c(D),D<100?h.current=requestAnimationFrame(b):p.current||(p.current=!0,o?.())}return h.current=requestAnimationFrame(b),()=>cancelAnimationFrame(h.current)},[e,g,o]);const x=ee.useMemo(()=>`ls-${Math.random().toString(36).slice(2,9)}`,[]),E=ee.useMemo(()=>{const b=`.loading-slider-${x}`;return`
${b}{ position:relative; --width:${t}; --height:${n}rem; color:white; width: min(calc(var(--width) * 1px), calc(100vw - 2rem)); }
${b} .slider{ position:relative; display:flex; align-items:center; border-radius:100px; }
${b} .slider__track{ flex:1; height:var(--height); position:relative; container-type:inline-size; }
${b} .slider__fill{ position:absolute; left:0; top:50%; translate:0 -50%; height:100%; width:100%; border-radius:100px; display:grid; place-items:center; clip-path: inset(0 calc(90% - ((var(--slider-complete, 0) / 100) * 90%)) 0 0 round 120px); background: linear-gradient(90deg, oklch(0.32 0.15 259.94), oklch(0.61 0.2 247.14), oklch(0.71 0.24 313.75), oklch(0.72 0.28 349.83), oklch(0.72 0.23 3.74)); }
${b} .slider__fill span{ font-family: 'Grand Hotel', cursive; font-size: calc(var(--height) * 0.65); letter-spacing:.1ch; font-weight:400; font-style:italic; line-height:1; }
${b} .slider__indicator{ position:absolute; top:50%; left:0; translate: calc((((var(--slider-complete, 0) / 100) * (100cqi - 54%)) - 28%)) -56%; height:144%; aspect-ratio:1; border-radius:50%; background:hsl(0 0% 0%); box-shadow: 0 12px 8px -2px hsl(0 0% 10% / 0.25), 0 8px 12px -4px hsl(0 0% 20% / 0.45), 0 16px 16px -10px hsl(0 0% 30% / 0.45), 0 24px 24px -8px hsl(0 0% 40% / 0.45), 0 32px 32px -2px hsl(0 0% 50% / 0.45), 0 -6px 10px 0 hsl(0 0% 100% / 0.6) inset; pointer-events:none; }
${b} .shines{ position:absolute; inset:0; overflow:hidden; border-radius:50%; z-index:3; }
${b} .shines::before{ content:''; position:absolute; width:70%; height:50%; background: linear-gradient(#fff, hsl(222 53% 93% / 0.9)); filter: blur(20px); top:12%; left:50%; translate:-50% 0; }
${b} .shines::after{ content:''; width:60%; aspect-ratio:1; background: radial-gradient(circle at 50% 0, #fff 50%, hsl(0 0% 100% / 1)); filter: blur(7px); position:absolute; top:10%; left:50%; translate:-50% 0; border-radius:50%; }
${b} .arrows-holder{ position:absolute; inset:0; z-index:4; mask: radial-gradient(circle at 50% 30%, #fff 25%, #0000 65%); clip-path: circle(50%); }
${b} .arrows{ position:absolute; height:182%; aspect-ratio:1; border-radius:50%; left:50%; top:0; translate:-50% 0; }
${b} .arrows svg{ filter: drop-shadow(0 0 1px hsl(0 0% 50%)); width:1.35rem; position:absolute; color:hsl(0 0% 30%); left:50%; top:50%; transform: translate(-50%, -50%) rotate(calc(var(--i, 0) * 90deg)) translate(10%, -2.25rem); }
${b} .arrows svg:nth-of-type(1){ --i:0; }
${b} .arrows svg:nth-of-type(2){ --i:1; }
${b} .arrows svg:nth-of-type(3){ --i:2; }
${b} .arrows svg:nth-of-type(4){ --i:3; }
${b} .noise-holder{ position:absolute; inset:0; overflow:hidden; border-radius:50%; mask: radial-gradient(circle at 50% 40%, #0000 0%, #fff 75%); pointer-events:none; }
${b} .noise{ height:182%; aspect-ratio:1; border-radius:50%; left:50%; position:absolute; translate:-50% 0; display:grid; opacity:0.3; }
${b} .noise div{ grid-area:1 / 1; }
${b} .noise div:nth-of-type(1){ background:black; filter:url(#noiseshow-${x}) contrast(2); }
${b} .noise div:nth-of-type(2){ background:hsl(0 0% 50%); mix-blend-mode:saturation; }
${b} .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border-width:0; }
${b} .percent{ position:absolute; right:0; top:-1.25rem; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size:.75rem; color: color-mix(in lch, canvasText, transparent 30%); }
    `},[x,t,n]),_={...r||{},"--slider-complete":y};return G.jsxs("div",{className:`loading-slider-${x}${i?` ${i}`:""}`,style:_,"aria-live":"polite","aria-label":`${s} ${y}% complete`,children:[G.jsx("style",{children:E}),G.jsx("svg",{className:"sr-only",xmlns:"http://www.w3.org/2000/svg",children:G.jsx("defs",{children:G.jsx("filter",{id:`noiseshow-${x}`,children:G.jsx("feTurbulence",{type:"turbulence",baseFrequency:"0.6",numOctaves:10,result:"noise"})})})}),G.jsxs("div",{className:"slider",children:[G.jsxs("div",{className:"slider__track",children:[G.jsx("div",{className:"slider__fill",children:G.jsx("span",{children:s})}),G.jsxs("div",{className:"slider__indicator",children:[G.jsx("div",{className:"shines"}),G.jsx("div",{className:"noise-holder",children:G.jsxs("div",{className:"noise",children:[G.jsx("div",{}),G.jsx("div",{})]})}),G.jsx("div",{className:"arrows-holder",children:G.jsx("div",{className:"arrows","aria-hidden":!0,children:Array.from({length:4}).map((b,C)=>G.jsx("svg",{viewBox:"0 0 120 80",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:G.jsx("path",{d:"M71.5542 7.10156C71.5542 7.10156 91.68 18.4986 100.553 26.104C111.053 35.104 112.553 39.104 112.053 42.604C111.553 46.104 104.614 51.1058 97.6141 55.6058C89 61.1435 72.5003 72.1101 72.5003 72.1101M7 42.6126C7 42.6126 36.3395 36.643 56 36.6103C75.9938 36.5771 109 40.6102 109 40.6102",stroke:"currentColor",strokeWidth:"14",strokeLinecap:"round",strokeLinejoin:"round"})},C))})})]})]}),G.jsxs("div",{className:"percent",children:[y,"%"]})]})]})}function Nie(s){return 1-Math.pow(1-s,3)}const Fie="https://api.arkturian.com",Uie="Inetpass1";function kie(){const[s,e]=ee.useState([]),[t,n]=ee.useState(null),[i,r]=ee.useState(!1),[a,o]=ee.useState([]),[l,c]=ee.useState(null),[h,f]=ee.useState(""),p=s0(),g=ee.useRef({baseWidth:400,smallHeight:330,largeHeight:500,itemGap:65,columns:4,buffer:3,expandedScale:.4,overlayOpacity:.9,zoomDurationMs:600}),y=ee.useRef(null),x=ee.useRef(null),E=ee.useRef(null),_=ee.useRef(!1),b=ee.useRef(!0),C=ee.useRef(0),I=ee.useRef(0),M=ee.useRef(0),R=ee.useRef(0),D=ee.useRef(0),P=ee.useRef(0),L=ee.useRef(0),O=ee.useRef(0),U=ee.useRef(0),j=ee.useRef(!1),H=ee.useMemo(()=>[{width:g.current.baseWidth,height:g.current.smallHeight},{width:g.current.baseWidth,height:g.current.largeHeight}],[]),z=g.current.baseWidth+g.current.itemGap,q=Math.max(g.current.smallHeight,g.current.largeHeight)+g.current.itemGap;ee.useEffect(()=>{(async()=>{try{r(!0);const X=await fetch(`${Fie}/storage/list?mine=false`,{headers:{"X-API-KEY":Uie}});if(!X.ok)throw new Error("list failed");const te=(await X.json()).items.filter(oe=>oe.hls_url);e(te),n(null)}catch(X){console.error(X),n("Could not load video list.")}finally{r(!1)}})()},[]);function k(){const X=y.current,K=x.current;if(!X||!K||s.length===0)return;const te=g.current.buffer,oe=window.innerWidth,Ee=window.innerHeight,Ce=D.current,se=P.current,ie=Math.floor((-Ce-oe*te)/z),ne=Math.ceil((-Ce+oe*(1+te))/z),re=Math.floor((-se-Ee*te)/q),Be=Math.ceil((-se+Ee*(1+te))/q),Ge=g.current.columns,Ue=[];for(let nt=re;nt<=Be;nt++)for(let pe=ie;pe<=ne;pe++){const ve=Math.abs((nt*Ge+pe)%H.length),Ae=H[ve],Se=pe*z,be=nt*q,Re=Math.abs((nt*Ge+pe)%s.length);Ue.push({col:pe,row:nt,width:Ae.width,height:Ae.height,left:Se,top:be,itemIndex:Re})}o(Ue)}ee.useEffect(()=>{let X=0;const K=()=>{const te=x.current;if(te&&b.current){D.current+=(M.current-D.current)*.075,P.current+=(R.current-P.current)*.075,te.style.transform=`translate3d(${D.current}px, ${P.current}px, 0)`;const Ee=performance.now(),Ce=D.current-O.current,se=P.current-U.current;(Math.hypot(Ce,se)>100||Ee-L.current>120)&&(O.current=D.current,U.current=P.current,L.current=Ee,k())}X=requestAnimationFrame(K)};return X=requestAnimationFrame(K),()=>cancelAnimationFrame(X)},[s.length]),ee.useEffect(()=>{const X=y.current;if(!X)return;const K=ne=>{b.current&&(_.current=!0,j.current=!1,C.current=ne.clientX,I.current=ne.clientY,X.style.cursor="grabbing")},te=ne=>{if(!_.current||!b.current)return;const re=ne.clientX-C.current,Be=ne.clientY-I.current;(Math.abs(re)>5||Math.abs(Be)>5)&&(j.current=!0),M.current+=re,R.current+=Be,C.current=ne.clientX,I.current=ne.clientY},oe=()=>{_.current&&(_.current=!1,b.current&&(X.style.cursor="grab"))},Ee=ne=>{b.current&&(_.current=!0,j.current=!1,C.current=ne.touches[0].clientX,I.current=ne.touches[0].clientY)},Ce=ne=>{if(!_.current||!b.current)return;const re=ne.touches[0].clientX-C.current,Be=ne.touches[0].clientY-I.current;(Math.abs(re)>5||Math.abs(Be)>5)&&(j.current=!0),M.current+=re,R.current+=Be,C.current=ne.touches[0].clientX,I.current=ne.touches[0].clientY},se=()=>{_.current=!1};X.addEventListener("mousedown",K),window.addEventListener("mousemove",te),window.addEventListener("mouseup",oe),X.addEventListener("touchstart",Ee,{passive:!0}),window.addEventListener("touchmove",Ce,{passive:!0}),window.addEventListener("touchend",se);const ie=()=>k();return window.addEventListener("resize",ie),()=>{X.removeEventListener("mousedown",K),window.removeEventListener("mousemove",te),window.removeEventListener("mouseup",oe),X.removeEventListener("touchstart",Ee),window.removeEventListener("touchmove",Ce),window.removeEventListener("touchend",se),window.removeEventListener("resize",ie)}},[s.length]);function W(X){if(j.current)return;const K=`cell-${X.col}-${X.row}`,te=document.getElementById(K);if(!te)return;const oe=te.getBoundingClientRect(),Ee=s[X.itemIndex];f(Ee.title||Ee.original_filename||""),b.current=!1,c({id:K,item:Ee,fromRect:oe,width:X.width,height:X.height})}function V(){b.current=!0,c(null)}return ee.useEffect(()=>{k()},[s.length]),G.jsx("main",{role:"main",children:G.jsxs("div",{className:"vod-canvas-root",ref:y,"aria-busy":i,children:[G.jsx("style",{children:`
          .vod-canvas-root{ position:relative; width:100vw; height:100vh; overflow:hidden; background:#000; color:#fff; cursor:grab; }
          .vod-canvas-root .noise-overlay{ position:fixed; inset:0; pointer-events:none; z-index:2; background:transparent url('http://assets.iceable.com/img/noise-transparent.png') repeat 0 0; background-size:300px 300px; opacity:.35; }
          .vod-canvas-root .header, .vod-canvas-root .footer{ position:absolute; left:0; width:100vw; padding:1.5rem; z-index:5; display:grid; grid-template-columns:repeat(12, 1fr); column-gap:1rem; }
          .vod-canvas-root .header{ top:0; }
          .vod-canvas-root .footer{ bottom:0; }
          .vod-canvas-root .nav-section{ grid-column:1 / span 3; }
          .vod-canvas-root .values-section{ grid-column:5 / span 2; }
          .vod-canvas-root .location-section{ grid-column:7 / span 2; }
          .vod-canvas-root .contact-section{ grid-column:9 / span 2; }
          .vod-canvas-root .social-section{ grid-column:11 / span 2; text-align:right; }
          .vod-canvas-root .coordinates-section{ grid-column:1 / span 3; font-family:monospace; }
          .vod-canvas-root .links-section{ grid-column:5 / span 4; text-align:center; display:flex; justify-content:center; align-items:center; gap:1rem; }
          .vod-canvas-root .info-section{ grid-column:9 / span 4; text-align:right; }
          .vod-canvas-root a{ color:#fff; text-decoration:none; font-weight:700; font-size:14px }
          .vod-canvas-root h3{ font-size:14px; margin-bottom:1rem; font-weight:600 }
          .vod-canvas-root ul{ list-style:none }
          .vod-canvas-root p{ font-size:14px; font-weight:600 }
          .vod-canvas-root .container{ position:relative; width:100%; height:100%; }
          .vod-canvas-root .canvas{ position:absolute; inset:auto; will-change:transform; z-index:1 }
          .vod-canvas-root .item{ position:absolute; overflow:hidden; background:#000; border-radius:0px; cursor:pointer }
          .vod-canvas-root .item .img-wrap{ width:100%; height:100%; overflow:hidden; position:relative }
          .vod-canvas-root .item img{ width:100%; height:100%; object-fit:cover; transition:transform .25s ease }
          .vod-canvas-root .item:hover img{ transform:scale(1.05) }
          .vod-canvas-root .item .caption{ position:absolute; left:0; bottom:0; width:100%; padding:10px; z-index:2 }
          .vod-canvas-root .item .name{ font-size:12px; text-transform:uppercase; letter-spacing:-.03em; margin-bottom:2px }
          .vod-canvas-root .item .num{ font-size:10px; color:#888; font-family:monospace }
          .vod-canvas-root .overlay{ position:fixed; inset:0; background:#000; opacity:0; pointer-events:none; transition:opacity .6s ease; z-index:3 }
          .vod-canvas-root .overlay.active{ opacity:.9; pointer-events:auto }
          .vod-canvas-root .expanded{ position:fixed; z-index:4; background:#000; overflow:hidden; border-radius:0px; transition: all .6s cubic-bezier(.9,0,.1,1) }
          .vod-canvas-root .expanded img{ width:100%; height:100%; object-fit:cover }
          .vod-canvas-root .project-title{ position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); z-index:6; pointer-events:none; width:100%; text-align:center }
          .vod-canvas-root .project-title p{ font-size:36px; letter-spacing:-.03em; text-transform:uppercase }
        `}),G.jsxs("div",{className:"header",role:"banner",children:[G.jsx("div",{className:"nav-section",children:G.jsx("div",{className:"logo-container",children:G.jsxs("div",{className:"logo-circles",children:[G.jsx("div",{className:"circle circle-1"}),G.jsx("div",{className:"circle circle-2"})]})})}),G.jsxs("div",{className:"values-section",children:[G.jsx("h3",{children:"+Menu"}),G.jsxs("ul",{children:[G.jsx("li",{children:G.jsx("a",{href:"#",children:"Clarity"})}),G.jsx("li",{children:G.jsx("a",{href:"#",children:"Simplicity"})}),G.jsx("li",{children:G.jsx("a",{href:"#",children:"Creativity"})}),G.jsx("li",{children:G.jsx("a",{href:"#",children:"Authenticity"})}),G.jsx("li",{children:G.jsx("a",{href:"#",children:"Connect"})})]})]}),G.jsxs("div",{className:"location-section",children:[G.jsx("h3",{children:"+Location"}),G.jsx("p",{children:"6357 Selma Ave"}),G.jsx("p",{children:"Los Angeles"}),G.jsx("p",{children:"CA 90028"})]}),G.jsxs("div",{className:"contact-section",children:[G.jsx("h3",{children:"+Get In Touch"}),G.jsx("p",{children:"(310) 456-7890"}),G.jsx("p",{children:G.jsx("a",{href:"mailto:hi@filip.fyi",children:"hi@filip.fyi"})})]}),G.jsxs("div",{className:"social-section",children:[G.jsx("h3",{children:"+Social"}),G.jsxs("ul",{children:[G.jsx("li",{children:G.jsx("a",{href:"https://instagram.com/filipz__",children:"Instagram"})}),G.jsx("li",{children:G.jsx("a",{href:"https://x.com/filipz",children:"X / Twitter"})}),G.jsx("li",{children:G.jsx("a",{href:"https://linkedin.com/in/filipzrnzevic",children:"LinkedIn"})})]})]})]}),G.jsxs("div",{className:"footer",role:"contentinfo",children:[G.jsx("div",{className:"coordinates-section",children:G.jsx("p",{children:"34.0522 N, 118.2437 W"})}),G.jsx("div",{className:"links-section",children:G.jsxs("p",{children:["Press ",G.jsx("span",{className:"key-hint",children:"H"})," to toggle panel"]})}),G.jsx("div",{className:"info-section",children:G.jsx("p",{children:"Est. 2025  Summer Days"})})]}),G.jsx("div",{className:"noise-overlay","aria-hidden":"true"}),G.jsxs("div",{className:"container",children:[G.jsx("div",{className:"canvas",ref:x,"aria-live":"polite","aria-label":"Draggable VOD grid",children:a.map(X=>{const K=s[X.itemIndex],te=K?.title||K?.original_filename||"",oe=`#${String(X.itemIndex+1).padStart(5,"0")}`,Ee=K?.thumbnail_url||"",Ce=`cell-${X.col}-${X.row}`;return G.jsxs("div",{id:Ce,className:"item",style:{width:X.width,height:X.height,left:X.left,top:X.top},onClick:()=>W(X),onDoubleClick:()=>p(`/vod/theater?current_id=${K.id}&from=/vod/all`),children:[G.jsx("div",{className:"img-wrap",children:Ee?G.jsx("img",{src:Ee,alt:te}):G.jsx("div",{style:{width:"100%",height:"100%",background:"#111"}})}),G.jsxs("div",{className:"caption",children:[G.jsx("div",{className:"name",children:te}),G.jsx("div",{className:"num",children:oe})]})]},Ce)})}),G.jsx("div",{ref:E,className:`overlay ${l?"active":""}`,onClick:V})]}),l&&G.jsx("div",{className:"project-title","aria-live":"assertive",children:G.jsx("p",{children:h})}),l&&(()=>{const X=window.innerWidth,K=Math.max(200,Math.floor(X*g.current.expandedScale)),te=l.height/l.width,oe=Math.floor(K*te),Ee=l.fromRect,Ce=Ee.left+Ee.width/2-window.innerWidth/2,se=Ee.top+Ee.height/2-window.innerHeight/2,ie={width:Ee.width,height:Ee.height,transform:`translate(${Ce}px, ${se}px)`},ne={width:K,height:oe,transform:"translate(0px, 0px)"};return G.jsx(Gie,{src:l.item.thumbnail_url||"",fromStyle:ie,toStyle:ne,durationMs:g.current.zoomDurationMs})})(),i&&G.jsx("div",{style:{position:"absolute",inset:0,display:"grid",placeItems:"center",zIndex:7},children:G.jsx(Pie,{label:"Loading"})}),t&&G.jsx("div",{style:{position:"absolute",top:10,left:10,zIndex:7,color:"crimson"},children:t})]})})}function Gie({src:s,fromStyle:e,toStyle:t,durationMs:n}){const i=ee.useRef(null),[r,a]=ee.useState(e);return ee.useEffect(()=>{const o=setTimeout(()=>{a(t)},15);return()=>clearTimeout(o)},[]),G.jsx("div",{ref:i,className:"expanded",style:{...r,transitionDuration:`${n}ms`},children:s?G.jsx("img",{src:s,alt:"Selected"}):G.jsx("div",{style:{width:"100%",height:"100%",background:"#111"}})})}function Hie({item:s,width:e,fixedHeight:t,showMeta:n=!0,autoplay:i=!0,onClick:r,onMeta:a,cover:o=!1,onDoubleClick:l}){const[c,h]=ee.useState({w:16,h:9}),f=c.h?c.w/c.h:16/9,p=e?Math.ceil(e/f):void 0,g=t??p,y=s.title||s.original_filename||"",x=G.jsxs(G.Fragment,{children:[e?G.jsx("div",{style:{width:"100%",height:g},onClick:r,onDoubleClick:l,children:G.jsx(xu,{src:s.hls_url,autoplay:i,muted:!0,loop:!0,scaleMode:o?"fill":"fit",disableDoubleClickFullscreen:!!l,onMetadata:({width:E,height:_})=>{h({w:E,h:_}),a?.(s.id,{w:E,h:_})}})}):G.jsxs("div",{style:{position:"relative",width:"100%"},onClick:r,onDoubleClick:l,children:[G.jsx("div",{style:{width:"100%",paddingTop:`${1/f*100}%`}}),G.jsx("div",{style:{position:"absolute",inset:0},children:G.jsx(xu,{src:s.hls_url,autoplay:i,muted:!0,loop:!0,scaleMode:o?"fill":"fit",disableDoubleClickFullscreen:!!l,onMetadata:({width:E,height:_})=>{h({w:E,h:_}),a?.(s.id,{w:E,h:_})}})})]}),n&&G.jsxs("div",{style:{marginTop:8},children:[G.jsx("div",{className:"flat-card-title",style:{fontSize:14},children:y}),s.description&&G.jsx("div",{className:"flat-card-sub",style:{fontSize:12},children:s.description})]})]});if(e){const E=(g||0)+(n?40:0)+24;return G.jsx("article",{className:"flat-card hitem",style:{width:e,height:E,overflow:"hidden"},children:G.jsx("div",{className:"flat-card-inner",style:{padding:12,display:"flex",flexDirection:"column",justifyContent:"flex-end",height:"100%"},children:x})})}return G.jsx("article",{className:"flat-card",style:{overflow:"hidden"},children:G.jsx("div",{className:"flat-card-inner",style:{padding:12},children:x})})}const zie="https://api.arkturian.com",Qie="Inetpass1";function Vie(){const s=new URL(window.location.href),e=s.searchParams.get("h"),t=e?parseInt(e,10):240,n=s.searchParams.get("meta")!=="0",[i,r]=ee.useState([]),[a,o]=ee.useState({}),[l,c]=ee.useState(null),[h,f]=ee.useState(!1),p=ee.useRef(null),[g,y]=ee.useState(0),[x,E]=ee.useState(typeof window<"u"?window.innerWidth:0);ee.useEffect(()=>{const b=p.current;if(!b)return;function C(){b&&y(b.scrollLeft)}function I(){b&&E(b.clientWidth)}I(),b.addEventListener("scroll",C,{passive:!0});const M=new ResizeObserver(I);M.observe(b);function R(D){b&&Math.abs(D.deltaY)>Math.abs(D.deltaX)&&(b.scrollLeft+=D.deltaY,D.preventDefault())}return b.addEventListener("wheel",R,{passive:!1}),()=>{b.removeEventListener("scroll",C),b.removeEventListener("wheel",R),M.disconnect()}},[]),ee.useEffect(()=>{(async()=>{try{f(!0);const b=await fetch(`${zie}/storage/list?mine=false`,{headers:{"X-API-KEY":Qie}});if(!b.ok)throw new Error("list failed");const I=(await b.json()).items.filter(M=>M.hls_url);r(I),c(null)}catch{c("Could not load video list.")}finally{f(!1)}})()},[]);function _(b,C){o(I=>({...I,[b]:{w:C.width,h:C.height}}))}return G.jsx("main",{role:"main",children:G.jsxs("section",{className:"section section-full","aria-labelledby":"vodstrip-title",children:[G.jsx("h2",{id:"vodstrip-title",className:"h2",children:"Video Strip"}),G.jsxs("p",{className:"muted",style:{marginTop:0},children:["Height fixed = ",t,"px  Width auto per aspect. Toggle meta: &meta=0"]}),h&&G.jsx("p",{className:"muted",children:"Loading"}),l&&G.jsx("p",{className:"muted",style:{color:"crimson"},children:l}),!h&&!l&&G.jsx("div",{className:"hstrip",ref:p,style:{overflowX:"hidden",position:"relative"},children:(()=>{const C=i.map(P=>{const L=a[P.id],O=L&&L.h?L.w/L.h:16/9;return Math.ceil(t*O)}),I=[];let M=0;for(let P=0;P<C.length;P++)I.push(M),M+=C[P]+12;const R=Math.max(0,M-12),D=t+(n?40:0);return G.jsx("div",{style:{position:"relative",width:R,height:D},children:i.map((P,L)=>{const O=C[L],U=I[L],j=U+O,H=Math.max(1,Math.ceil(x/(O+12))),z=Math.max(x,H*(O+12)*2),q=j>=g-z&&U<=g+x+z;return q?G.jsx("div",{style:{position:"absolute",left:U,top:0,width:O},children:G.jsx(Hie,{item:P,width:O,fixedHeight:t,showMeta:n,cover:!1,autoplay:q,onMeta:(k,W)=>_(k,{width:W.w,height:W.h}),onClick:()=>{const k=p.current;if(!k)return;const W=U+O/2,V=Math.max(0,W-k.clientWidth/2);k.scrollTo({left:V,behavior:"smooth"})}})},P.id):null})})})()})]})})}const TS="https://api.arkturian.com",CS="Inetpass1";function jie(){const s=s0(),e=new URL(window.location.href),t=e.searchParams.get("collection_id"),n=e.searchParams.get("current_id"),i=n?parseInt(n,10):void 0,r=e.searchParams.get("src"),a=e.searchParams.get("from")||"/vod/all",[o,l]=ee.useState([]),[c,h]=ee.useState(0),f=o[c],[p,g]=ee.useState(!0),[y,x]=ee.useState(!1),[E,_]=ee.useState(!0),[b,C]=ee.useState(0),[,I]=ee.useState(!0),[,M]=ee.useState(null),R=ee.useRef(null),D=ee.useRef(null),[P,L]=ee.useState(0),[O,U]=ee.useState(0);function j(){D.current&&window.clearTimeout(D.current),R.current&&(D.current=window.setTimeout(()=>g(!1),2500))}ee.useEffect(()=>{const V=X=>{X.key==="Escape"&&s(a)};return window.addEventListener("keydown",V),()=>window.removeEventListener("keydown",V)},[s,a]),ee.useEffect(()=>{(async()=>{try{if(I(!0),t){const V=await fetch(`${TS}/storage/list?collection_id=${t}`,{headers:{"X-API-KEY":CS}});if(!V.ok)throw new Error("list failed");const K=(await V.json()).items.filter(oe=>oe.hls_url);l(K);const te=i?Math.max(0,K.findIndex(oe=>oe.id===i)):0;h(te),C(K[te]?.likes??0)}else if(i){const V=await fetch(`${TS}/storage/objects/${i}`,{headers:{"X-API-KEY":CS}});if(!V.ok)throw new Error("object failed");const X=await V.json();l(X.hls_url?[X]:[]),h(0),C(X.likes??0)}else if(r)l([{id:-1,hls_url:r,title:"Single Video"}]),h(0);else{const V=await fetch(`${TS}/storage/list?mine=false`,{headers:{"X-API-KEY":CS}});if(V.ok){const K=(await V.json()).items.filter(te=>te.hls_url);if(K.length){const te=K.reduce((oe,Ee)=>Number(Ee.id)>Number(oe.id)?Ee:oe,K[0]);l([te]),h(0),C(te.likes??0)}else M("No playable videos available.")}else M("Failed to load videos.")}}catch{M("Failed to load videos.")}finally{I(!1)}})()},[t,i,r]);async function H(){if(!(!f||f.id<0))try{const V=await fetch(`${TS}/storage/objects/${f.id}/like`,{method:"POST",headers:{"X-API-KEY":CS}});if(!V.ok)throw new Error("like failed");const X=await V.json();C(X.likes??0)}catch(V){console.error(V)}}const z=V=>{g(!0),V&&j()},q=(V,X)=>{L(V),U(X||0)},k=f?.title||f?.original_filename||"",W=f?.description||"";return G.jsxs("main",{role:"main",onMouseMove:()=>{g(!0),j()},children:[G.jsx("section",{className:"section section-full","aria-labelledby":"vodtheater-title",style:{padding:0},children:G.jsxs("div",{style:{position:"relative",width:"100%",height:"100vh"},children:[f&&G.jsx(xu,{ref:R,src:f.hls_url,autoplay:!0,muted:y,loop:!1,scaleMode:E?"fit":"fill",fullscreenScaleMode:E?"fit":"fill",onPlayChange:z,onTimeUpdate:q}),G.jsxs("div",{style:{position:"absolute",inset:0,pointerEvents:"none",opacity:p?1:0,transition:"opacity .25s"},children:[G.jsxs("div",{style:{position:"absolute",top:12,right:12,display:"flex",gap:8},children:[G.jsx("button",{className:"pill",style:{pointerEvents:"auto",background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"var(--text)"},onClick:()=>_(V=>!V),children:E?"Fit":"Fill"}),G.jsx("button",{className:"pill",style:{pointerEvents:"auto",background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"var(--text)"},onClick:()=>x(V=>!V),children:y?"Unmute":"Mute"}),G.jsx("button",{className:"pill",style:{pointerEvents:"auto",background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"var(--text)"},onClick:()=>R.current?.toggleFullscreen(),children:"Fullscreen"})]}),G.jsx("div",{style:{position:"absolute",bottom:18,left:"2%",right:"2%",height:6,background:"rgba(255,255,255,0.3)",borderRadius:3,pointerEvents:"auto",cursor:"pointer"},onClick:V=>{const X=V.currentTarget.getBoundingClientRect(),K=(V.clientX-X.left)/X.width;O&&R.current&&R.current.setCurrentTime(K*O)},children:G.jsx("div",{style:{width:`${O?P/O*100:0}%`,height:"100%",background:"var(--brand-2)",borderRadius:3}})}),G.jsx("div",{style:{position:"absolute",bottom:60,left:20,maxWidth:640,pointerEvents:"none"},children:G.jsxs("div",{style:{background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",padding:"12px 14px",color:"var(--text)"},children:[G.jsx("div",{style:{fontWeight:700,marginBottom:6},children:k}),W&&G.jsx("div",{className:"muted",style:{margin:0},children:W})]})}),G.jsx("div",{style:{position:"absolute",bottom:18,right:18},children:G.jsxs("button",{className:"pill",style:{pointerEvents:"auto",background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"var(--text)"},onClick:H,children:[" ",b]})}),o.length>1&&G.jsxs(G.Fragment,{children:[G.jsx("button",{className:"pill",style:{position:"absolute",left:18,top:"50%",transform:"translateY(-50%)",pointerEvents:"auto"},onClick:()=>h(V=>(V-1+o.length)%o.length),children:" Prev"}),G.jsx("button",{className:"pill",style:{position:"absolute",right:18,top:"50%",transform:"translateY(-50%)",pointerEvents:"auto"},onClick:()=>h(V=>(V+1)%o.length),children:"Next "})]})]})]})}),G.jsx("section",{className:"section","aria-labelledby":"vodtheater-comments",children:G.jsxs("div",{className:"card",children:[G.jsx("h2",{id:"vodtheater-comments",className:"h2",children:"Comments"}),G.jsx("p",{className:"muted",children:"Coming next: threaded comments, reactions and related videos."})]})})]})}const qie="https://api.arkturian.com",Kie="Inetpass1";function Yie(){const[s,e]=ee.useState([]),[t,n]=ee.useState(null),[i,r]=ee.useState(!1),[a,o]=ee.useState(null),l=ee.useRef(null),[c,h]=ee.useState(!1),[f,p]=ee.useState(!0),[g,y]=ee.useState(0),[x,E]=ee.useState(0),_=ee.useRef({}),b=ee.useRef({}),[C,I]=ee.useState({}),[M,R]=ee.useState(null),[D,P]=ee.useState(null),L=ee.useRef({});return ee.useEffect(()=>{(async()=>{try{r(!0);const O=await fetch(`${qie}/storage/list?mine=false`,{headers:{"X-API-KEY":Kie}});if(!O.ok)throw new Error("list failed");const j=(await O.json()).items.filter(H=>H.hls_url);e(j)}catch{n("Could not load videos.")}finally{r(!1)}})()},[]),ee.useEffect(()=>{const O=U=>{U.key==="Escape"&&o(null)};return window.addEventListener("keydown",O),()=>window.removeEventListener("keydown",O)},[]),ee.useEffect(()=>{if(a===null){R(null),P(null);return}const O=_.current[a],U=b.current[a];if(!O||!U)return;const j=O.getBoundingClientRect();I(q=>({...q,[a]:j.height}));const H=window.innerWidth/j.width,z=window.innerHeight/j.height;L.current[a]={w:j.width,h:j.height},R({position:"fixed",left:0,top:0,width:"100vw",height:"100vh",zIndex:60,pointerEvents:"none"}),P({pointerEvents:"auto",transformOrigin:"top left",transform:`translate(${j.left}px, ${j.top}px) scale(1, 1)`,transition:"transform .45s cubic-bezier(.2,.8,.2,1)"}),requestAnimationFrame(()=>{P(q=>q&&{...q,transform:`translate(0px, 0px) scale(${H}, ${z})`})})},[a]),G.jsx("main",{role:"main",children:G.jsxs("section",{className:"section","aria-labelledby":"fusion-title",children:[G.jsx("h2",{id:"fusion-title",className:"h2",children:"All Videos"}),i&&G.jsx("p",{className:"muted",children:"Loading"}),t&&G.jsx("p",{className:"muted",style:{color:"crimson"},children:t}),!i&&!t&&G.jsxs("div",{className:"masonry",style:{position:"relative"},children:[s.map(O=>{const U=a===O.id,j=C[O.id];return G.jsxs("div",{className:"masonry-item",ref:H=>{_.current[O.id]=H},children:[U&&j?G.jsx("div",{style:{height:j}}):null,G.jsx("div",{onDoubleClick:()=>o(O.id),children:G.jsx("div",{ref:H=>{b.current[O.id]=H},style:U&&M?M:void 0,children:G.jsx("div",{style:U&&D?D:void 0,children:G.jsx(MH,{item:O,mode:U?"theater":"mini",playerRef:U?l:void 0,muted:U?c:void 0,scaleMode:U?f?"fit":"fill":void 0,fullscreenScaleMode:U?f?"fit":"fill":void 0,onTimeUpdate:U?((H,z)=>{y(H),E(z||0)}):void 0,onPlayChange:U?(()=>{}):void 0,miniContainerRef:H=>{b.current[O.id]=H},onMeta:()=>{},miniStyle:U?{width:(L.current[O.id]?.w||0)+"px",height:(L.current[O.id]?.h||0)+"px"}:void 0})})})})]},O.id)}),a!==null&&G.jsxs(G.Fragment,{children:[G.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:55},onClick:()=>o(null)}),G.jsxs("div",{style:{position:"fixed",top:12,right:12,zIndex:65,display:"flex",gap:8},children:[G.jsx("button",{className:"pill",style:{background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"var(--text)"},onClick:()=>p(O=>!O),children:f?"Fit":"Fill"}),G.jsx("button",{className:"pill",style:{background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"var(--text)"},onClick:()=>h(O=>!O),children:c?"Unmute":"Mute"}),G.jsx("button",{className:"pill",style:{background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"var(--text)"},onClick:()=>o(null),children:"Close"})]}),G.jsx("div",{style:{position:"fixed",bottom:18,left:"2%",right:"2%",height:6,background:"rgba(255,255,255,0.3)",borderRadius:3,zIndex:65},onClick:O=>{const U=O.currentTarget.getBoundingClientRect(),j=(O.clientX-U.left)/U.width;x&&l.current&&l.current.setCurrentTime(j*x)},children:G.jsx("div",{style:{width:`${x?g/x*100:0}%`,height:"100%",background:"var(--brand-2)",borderRadius:3}})})]})]})]})})}function wH(s,e){return function(){return s.apply(e,arguments)}}const{toString:Xie}=Object.prototype,{getPrototypeOf:JB}=Object,{iterator:uC,toStringTag:RH}=Symbol,hC=(s=>e=>{const t=Xie.call(e);return s[t]||(s[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),pc=s=>(s=s.toLowerCase(),e=>hC(e)===s),fC=s=>e=>typeof e===s,{isArray:f0}=Array,Wv=fC("undefined");function ME(s){return s!==null&&!Wv(s)&&s.constructor!==null&&!Wv(s.constructor)&&ro(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const BH=pc("ArrayBuffer");function Wie(s){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(s):e=s&&s.buffer&&BH(s.buffer),e}const $ie=fC("string"),ro=fC("function"),DH=fC("number"),wE=s=>s!==null&&typeof s=="object",Jie=s=>s===!0||s===!1,JS=s=>{if(hC(s)!=="object")return!1;const e=JB(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(RH in s)&&!(uC in s)},Zie=s=>{if(!wE(s)||ME(s))return!1;try{return Object.keys(s).length===0&&Object.getPrototypeOf(s)===Object.prototype}catch{return!1}},ese=pc("Date"),tse=pc("File"),nse=pc("Blob"),ise=pc("FileList"),sse=s=>wE(s)&&ro(s.pipe),rse=s=>{let e;return s&&(typeof FormData=="function"&&s instanceof FormData||ro(s.append)&&((e=hC(s))==="formdata"||e==="object"&&ro(s.toString)&&s.toString()==="[object FormData]"))},ase=pc("URLSearchParams"),[ose,lse,cse,use]=["ReadableStream","Request","Response","Headers"].map(pc),hse=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function RE(s,e,{allOwnKeys:t=!1}={}){if(s===null||typeof s>"u")return;let n,i;if(typeof s!="object"&&(s=[s]),f0(s))for(n=0,i=s.length;n<i;n++)e.call(null,s[n],n,s);else{if(ME(s))return;const r=t?Object.getOwnPropertyNames(s):Object.keys(s),a=r.length;let o;for(n=0;n<a;n++)o=r[n],e.call(null,s[o],o,s)}}function LH(s,e){if(ME(s))return null;e=e.toLowerCase();const t=Object.keys(s);let n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}const Jp=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,OH=s=>!Wv(s)&&s!==Jp;function Ww(){const{caseless:s}=OH(this)&&this||{},e={},t=(n,i)=>{const r=s&&LH(e,i)||i;JS(e[r])&&JS(n)?e[r]=Ww(e[r],n):JS(n)?e[r]=Ww({},n):f0(n)?e[r]=n.slice():e[r]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&RE(arguments[n],t);return e}const fse=(s,e,t,{allOwnKeys:n}={})=>(RE(e,(i,r)=>{t&&ro(i)?s[r]=wH(i,t):s[r]=i},{allOwnKeys:n}),s),dse=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),pse=(s,e,t,n)=>{s.prototype=Object.create(e.prototype,n),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:e.prototype}),t&&Object.assign(s.prototype,t)},mse=(s,e,t,n)=>{let i,r,a;const o={};if(e=e||{},s==null)return e;do{for(i=Object.getOwnPropertyNames(s),r=i.length;r-- >0;)a=i[r],(!n||n(a,s,e))&&!o[a]&&(e[a]=s[a],o[a]=!0);s=t!==!1&&JB(s)}while(s&&(!t||t(s,e))&&s!==Object.prototype);return e},gse=(s,e,t)=>{s=String(s),(t===void 0||t>s.length)&&(t=s.length),t-=e.length;const n=s.indexOf(e,t);return n!==-1&&n===t},Ase=s=>{if(!s)return null;if(f0(s))return s;let e=s.length;if(!DH(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=s[e];return t},yse=(s=>e=>s&&e instanceof s)(typeof Uint8Array<"u"&&JB(Uint8Array)),vse=(s,e)=>{const n=(s&&s[uC]).call(s);let i;for(;(i=n.next())&&!i.done;){const r=i.value;e.call(s,r[0],r[1])}},Ese=(s,e)=>{let t;const n=[];for(;(t=s.exec(e))!==null;)n.push(t);return n},xse=pc("HTMLFormElement"),_se=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),lN=(({hasOwnProperty:s})=>(e,t)=>s.call(e,t))(Object.prototype),Sse=pc("RegExp"),PH=(s,e)=>{const t=Object.getOwnPropertyDescriptors(s),n={};RE(t,(i,r)=>{let a;(a=e(i,r,s))!==!1&&(n[r]=a||i)}),Object.defineProperties(s,n)},bse=s=>{PH(s,(e,t)=>{if(ro(s)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=s[t];if(ro(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Tse=(s,e)=>{const t={},n=i=>{i.forEach(r=>{t[r]=!0})};return f0(s)?n(s):n(String(s).split(e)),t},Cse=()=>{},Ise=(s,e)=>s!=null&&Number.isFinite(s=+s)?s:e;function Mse(s){return!!(s&&ro(s.append)&&s[RH]==="FormData"&&s[uC])}const wse=s=>{const e=new Array(10),t=(n,i)=>{if(wE(n)){if(e.indexOf(n)>=0)return;if(ME(n))return n;if(!("toJSON"in n)){e[i]=n;const r=f0(n)?[]:{};return RE(n,(a,o)=>{const l=t(a,i+1);!Wv(l)&&(r[o]=l)}),e[i]=void 0,r}}return n};return t(s,0)},Rse=pc("AsyncFunction"),Bse=s=>s&&(wE(s)||ro(s))&&ro(s.then)&&ro(s.catch),NH=((s,e)=>s?setImmediate:e?((t,n)=>(Jp.addEventListener("message",({source:i,data:r})=>{i===Jp&&r===t&&n.length&&n.shift()()},!1),i=>{n.push(i),Jp.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",ro(Jp.postMessage)),Dse=typeof queueMicrotask<"u"?queueMicrotask.bind(Jp):typeof process<"u"&&process.nextTick||NH,Lse=s=>s!=null&&ro(s[uC]),st={isArray:f0,isArrayBuffer:BH,isBuffer:ME,isFormData:rse,isArrayBufferView:Wie,isString:$ie,isNumber:DH,isBoolean:Jie,isObject:wE,isPlainObject:JS,isEmptyObject:Zie,isReadableStream:ose,isRequest:lse,isResponse:cse,isHeaders:use,isUndefined:Wv,isDate:ese,isFile:tse,isBlob:nse,isRegExp:Sse,isFunction:ro,isStream:sse,isURLSearchParams:ase,isTypedArray:yse,isFileList:ise,forEach:RE,merge:Ww,extend:fse,trim:hse,stripBOM:dse,inherits:pse,toFlatObject:mse,kindOf:hC,kindOfTest:pc,endsWith:gse,toArray:Ase,forEachEntry:vse,matchAll:Ese,isHTMLForm:xse,hasOwnProperty:lN,hasOwnProp:lN,reduceDescriptors:PH,freezeMethods:bse,toObjectSet:Tse,toCamelCase:_se,noop:Cse,toFiniteNumber:Ise,findKey:LH,global:Jp,isContextDefined:OH,isSpecCompliantForm:Mse,toJSONObject:wse,isAsyncFn:Rse,isThenable:Bse,setImmediate:NH,asap:Dse,isIterable:Lse};function Rn(s,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}st.inherits(Rn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:st.toJSONObject(this.config),code:this.code,status:this.status}}});const FH=Rn.prototype,UH={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{UH[s]={value:s}});Object.defineProperties(Rn,UH);Object.defineProperty(FH,"isAxiosError",{value:!0});Rn.from=(s,e,t,n,i,r)=>{const a=Object.create(FH);return st.toFlatObject(s,a,function(l){return l!==Error.prototype},o=>o!=="isAxiosError"),Rn.call(a,s.message,e,t,n,i),a.cause=s,a.name=s.name,r&&Object.assign(a,r),a};const Ose=null;function $w(s){return st.isPlainObject(s)||st.isArray(s)}function kH(s){return st.endsWith(s,"[]")?s.slice(0,-2):s}function cN(s,e,t){return s?s.concat(e).map(function(i,r){return i=kH(i),!t&&r?"["+i+"]":i}).join(t?".":""):e}function Pse(s){return st.isArray(s)&&!s.some($w)}const Nse=st.toFlatObject(st,{},null,function(e){return/^is[A-Z]/.test(e)});function dC(s,e,t){if(!st.isObject(s))throw new TypeError("target must be an object");e=e||new FormData,t=st.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,E){return!st.isUndefined(E[x])});const n=t.metaTokens,i=t.visitor||h,r=t.dots,a=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&st.isSpecCompliantForm(e);if(!st.isFunction(i))throw new TypeError("visitor must be a function");function c(y){if(y===null)return"";if(st.isDate(y))return y.toISOString();if(st.isBoolean(y))return y.toString();if(!l&&st.isBlob(y))throw new Rn("Blob is not supported. Use a Buffer instead.");return st.isArrayBuffer(y)||st.isTypedArray(y)?l&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function h(y,x,E){let _=y;if(y&&!E&&typeof y=="object"){if(st.endsWith(x,"{}"))x=n?x:x.slice(0,-2),y=JSON.stringify(y);else if(st.isArray(y)&&Pse(y)||(st.isFileList(y)||st.endsWith(x,"[]"))&&(_=st.toArray(y)))return x=kH(x),_.forEach(function(C,I){!(st.isUndefined(C)||C===null)&&e.append(a===!0?cN([x],I,r):a===null?x:x+"[]",c(C))}),!1}return $w(y)?!0:(e.append(cN(E,x,r),c(y)),!1)}const f=[],p=Object.assign(Nse,{defaultVisitor:h,convertValue:c,isVisitable:$w});function g(y,x){if(!st.isUndefined(y)){if(f.indexOf(y)!==-1)throw Error("Circular reference detected in "+x.join("."));f.push(y),st.forEach(y,function(_,b){(!(st.isUndefined(_)||_===null)&&i.call(e,_,st.isString(b)?b.trim():b,x,p))===!0&&g(_,x?x.concat(b):[b])}),f.pop()}}if(!st.isObject(s))throw new TypeError("data must be an object");return g(s),e}function uN(s){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function ZB(s,e){this._pairs=[],s&&dC(s,this,e)}const GH=ZB.prototype;GH.append=function(e,t){this._pairs.push([e,t])};GH.toString=function(e){const t=e?function(n){return e.call(this,n,uN)}:uN;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function Fse(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function HH(s,e,t){if(!e)return s;const n=t&&t.encode||Fse;st.isFunction(t)&&(t={serialize:t});const i=t&&t.serialize;let r;if(i?r=i(e,t):r=st.isURLSearchParams(e)?e.toString():new ZB(e,t).toString(n),r){const a=s.indexOf("#");a!==-1&&(s=s.slice(0,a)),s+=(s.indexOf("?")===-1?"?":"&")+r}return s}class hN{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){st.forEach(this.handlers,function(n){n!==null&&e(n)})}}const zH={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Use=typeof URLSearchParams<"u"?URLSearchParams:ZB,kse=typeof FormData<"u"?FormData:null,Gse=typeof Blob<"u"?Blob:null,Hse={isBrowser:!0,classes:{URLSearchParams:Use,FormData:kse,Blob:Gse},protocols:["http","https","file","blob","url","data"]},eD=typeof window<"u"&&typeof document<"u",Jw=typeof navigator=="object"&&navigator||void 0,zse=eD&&(!Jw||["ReactNative","NativeScript","NS"].indexOf(Jw.product)<0),Qse=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Vse=eD&&window.location.href||"http://localhost",jse=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:eD,hasStandardBrowserEnv:zse,hasStandardBrowserWebWorkerEnv:Qse,navigator:Jw,origin:Vse},Symbol.toStringTag,{value:"Module"})),ra={...jse,...Hse};function qse(s,e){return dC(s,new ra.classes.URLSearchParams,{visitor:function(t,n,i,r){return ra.isNode&&st.isBuffer(t)?(this.append(n,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...e})}function Kse(s){return st.matchAll(/\w+|\[(\w*)]/g,s).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Yse(s){const e={},t=Object.keys(s);let n;const i=t.length;let r;for(n=0;n<i;n++)r=t[n],e[r]=s[r];return e}function QH(s){function e(t,n,i,r){let a=t[r++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),l=r>=t.length;return a=!a&&st.isArray(i)?i.length:a,l?(st.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!o):((!i[a]||!st.isObject(i[a]))&&(i[a]=[]),e(t,n,i[a],r)&&st.isArray(i[a])&&(i[a]=Yse(i[a])),!o)}if(st.isFormData(s)&&st.isFunction(s.entries)){const t={};return st.forEachEntry(s,(n,i)=>{e(Kse(n),i,t,0)}),t}return null}function Xse(s,e,t){if(st.isString(s))try{return(e||JSON.parse)(s),st.trim(s)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(s)}const BE={transitional:zH,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,r=st.isObject(e);if(r&&st.isHTMLForm(e)&&(e=new FormData(e)),st.isFormData(e))return i?JSON.stringify(QH(e)):e;if(st.isArrayBuffer(e)||st.isBuffer(e)||st.isStream(e)||st.isFile(e)||st.isBlob(e)||st.isReadableStream(e))return e;if(st.isArrayBufferView(e))return e.buffer;if(st.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return qse(e,this.formSerializer).toString();if((o=st.isFileList(e))||n.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return dC(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),Xse(e)):e}],transformResponse:[function(e){const t=this.transitional||BE.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(st.isResponse(e)||st.isReadableStream(e))return e;if(e&&st.isString(e)&&(n&&!this.responseType||i)){const a=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?Rn.from(o,Rn.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ra.classes.FormData,Blob:ra.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};st.forEach(["delete","get","head","post","put","patch"],s=>{BE.headers[s]={}});const Wse=st.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),$se=s=>{const e={};let t,n,i;return s&&s.split(`
`).forEach(function(a){i=a.indexOf(":"),t=a.substring(0,i).trim().toLowerCase(),n=a.substring(i+1).trim(),!(!t||e[t]&&Wse[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},fN=Symbol("internals");function Ky(s){return s&&String(s).trim().toLowerCase()}function ZS(s){return s===!1||s==null?s:st.isArray(s)?s.map(ZS):String(s)}function Jse(s){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(s);)e[n[1]]=n[2];return e}const Zse=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function uM(s,e,t,n,i){if(st.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!st.isString(e)){if(st.isString(n))return e.indexOf(n)!==-1;if(st.isRegExp(n))return n.test(e)}}function ere(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function tre(s,e){const t=st.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(s,n+t,{value:function(i,r,a){return this[n].call(this,e,i,r,a)},configurable:!0})})}let ao=class{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function r(o,l,c){const h=Ky(l);if(!h)throw new Error("header name must be a non-empty string");const f=st.findKey(i,h);(!f||i[f]===void 0||c===!0||c===void 0&&i[f]!==!1)&&(i[f||l]=ZS(o))}const a=(o,l)=>st.forEach(o,(c,h)=>r(c,h,l));if(st.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(st.isString(e)&&(e=e.trim())&&!Zse(e))a($se(e),t);else if(st.isObject(e)&&st.isIterable(e)){let o={},l,c;for(const h of e){if(!st.isArray(h))throw TypeError("Object iterator must return a key-value pair");o[c=h[0]]=(l=o[c])?st.isArray(l)?[...l,h[1]]:[l,h[1]]:h[1]}a(o,t)}else e!=null&&r(t,e,n);return this}get(e,t){if(e=Ky(e),e){const n=st.findKey(this,e);if(n){const i=this[n];if(!t)return i;if(t===!0)return Jse(i);if(st.isFunction(t))return t.call(this,i,n);if(st.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ky(e),e){const n=st.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||uM(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let i=!1;function r(a){if(a=Ky(a),a){const o=st.findKey(n,a);o&&(!t||uM(n,n[o],o,t))&&(delete n[o],i=!0)}}return st.isArray(e)?e.forEach(r):r(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const r=t[n];(!e||uM(this,this[r],r,e,!0))&&(delete this[r],i=!0)}return i}normalize(e){const t=this,n={};return st.forEach(this,(i,r)=>{const a=st.findKey(n,r);if(a){t[a]=ZS(i),delete t[r];return}const o=e?ere(r):String(r).trim();o!==r&&delete t[r],t[o]=ZS(i),n[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return st.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&st.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){const n=(this[fN]=this[fN]={accessors:{}}).accessors,i=this.prototype;function r(a){const o=Ky(a);n[o]||(tre(i,a),n[o]=!0)}return st.isArray(e)?e.forEach(r):r(e),this}};ao.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);st.reduceDescriptors(ao.prototype,({value:s},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>s,set(n){this[t]=n}}});st.freezeMethods(ao);function hM(s,e){const t=this||BE,n=e||t,i=ao.from(n.headers);let r=n.data;return st.forEach(s,function(o){r=o.call(t,r,i.normalize(),e?e.status:void 0)}),i.normalize(),r}function VH(s){return!!(s&&s.__CANCEL__)}function d0(s,e,t){Rn.call(this,s??"canceled",Rn.ERR_CANCELED,e,t),this.name="CanceledError"}st.inherits(d0,Rn,{__CANCEL__:!0});function jH(s,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?s(t):e(new Rn("Request failed with status code "+t.status,[Rn.ERR_BAD_REQUEST,Rn.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function nre(s){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return e&&e[1]||""}function ire(s,e){s=s||10;const t=new Array(s),n=new Array(s);let i=0,r=0,a;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),h=n[r];a||(a=c),t[i]=l,n[i]=c;let f=r,p=0;for(;f!==i;)p+=t[f++],f=f%s;if(i=(i+1)%s,i===r&&(r=(r+1)%s),c-a<e)return;const g=h&&c-h;return g?Math.round(p*1e3/g):void 0}}function sre(s,e){let t=0,n=1e3/e,i,r;const a=(c,h=Date.now())=>{t=h,i=null,r&&(clearTimeout(r),r=null),s(...c)};return[(...c)=>{const h=Date.now(),f=h-t;f>=n?a(c,h):(i=c,r||(r=setTimeout(()=>{r=null,a(i)},n-f)))},()=>i&&a(i)]}const rT=(s,e,t=3)=>{let n=0;const i=ire(50,250);return sre(r=>{const a=r.loaded,o=r.lengthComputable?r.total:void 0,l=a-n,c=i(l),h=a<=o;n=a;const f={loaded:a,total:o,progress:o?a/o:void 0,bytes:l,rate:c||void 0,estimated:c&&o&&h?(o-a)/c:void 0,event:r,lengthComputable:o!=null,[e?"download":"upload"]:!0};s(f)},t)},dN=(s,e)=>{const t=s!=null;return[n=>e[0]({lengthComputable:t,total:s,loaded:n}),e[1]]},pN=s=>(...e)=>st.asap(()=>s(...e)),rre=ra.hasStandardBrowserEnv?((s,e)=>t=>(t=new URL(t,ra.origin),s.protocol===t.protocol&&s.host===t.host&&(e||s.port===t.port)))(new URL(ra.origin),ra.navigator&&/(msie|trident)/i.test(ra.navigator.userAgent)):()=>!0,are=ra.hasStandardBrowserEnv?{write(s,e,t,n,i,r){const a=[s+"="+encodeURIComponent(e)];st.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),st.isString(n)&&a.push("path="+n),st.isString(i)&&a.push("domain="+i),r===!0&&a.push("secure"),document.cookie=a.join("; ")},read(s){const e=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ore(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function lre(s,e){return e?s.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):s}function qH(s,e,t){let n=!ore(e);return s&&(n||t==!1)?lre(s,e):e}const mN=s=>s instanceof ao?{...s}:s;function gm(s,e){e=e||{};const t={};function n(c,h,f,p){return st.isPlainObject(c)&&st.isPlainObject(h)?st.merge.call({caseless:p},c,h):st.isPlainObject(h)?st.merge({},h):st.isArray(h)?h.slice():h}function i(c,h,f,p){if(st.isUndefined(h)){if(!st.isUndefined(c))return n(void 0,c,f,p)}else return n(c,h,f,p)}function r(c,h){if(!st.isUndefined(h))return n(void 0,h)}function a(c,h){if(st.isUndefined(h)){if(!st.isUndefined(c))return n(void 0,c)}else return n(void 0,h)}function o(c,h,f){if(f in e)return n(c,h);if(f in s)return n(void 0,c)}const l={url:r,method:r,data:r,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(c,h,f)=>i(mN(c),mN(h),f,!0)};return st.forEach(Object.keys({...s,...e}),function(h){const f=l[h]||i,p=f(s[h],e[h],h);st.isUndefined(p)&&f!==o||(t[h]=p)}),t}const KH=s=>{const e=gm({},s);let{data:t,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:r,headers:a,auth:o}=e;e.headers=a=ao.from(a),e.url=HH(qH(e.baseURL,e.url,e.allowAbsoluteUrls),s.params,s.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let l;if(st.isFormData(t)){if(ra.hasStandardBrowserEnv||ra.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((l=a.getContentType())!==!1){const[c,...h]=l?l.split(";").map(f=>f.trim()).filter(Boolean):[];a.setContentType([c||"multipart/form-data",...h].join("; "))}}if(ra.hasStandardBrowserEnv&&(n&&st.isFunction(n)&&(n=n(e)),n||n!==!1&&rre(e.url))){const c=i&&r&&are.read(r);c&&a.set(i,c)}return e},cre=typeof XMLHttpRequest<"u",ure=cre&&function(s){return new Promise(function(t,n){const i=KH(s);let r=i.data;const a=ao.from(i.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:c}=i,h,f,p,g,y;function x(){g&&g(),y&&y(),i.cancelToken&&i.cancelToken.unsubscribe(h),i.signal&&i.signal.removeEventListener("abort",h)}let E=new XMLHttpRequest;E.open(i.method.toUpperCase(),i.url,!0),E.timeout=i.timeout;function _(){if(!E)return;const C=ao.from("getAllResponseHeaders"in E&&E.getAllResponseHeaders()),M={data:!o||o==="text"||o==="json"?E.responseText:E.response,status:E.status,statusText:E.statusText,headers:C,config:s,request:E};jH(function(D){t(D),x()},function(D){n(D),x()},M),E=null}"onloadend"in E?E.onloadend=_:E.onreadystatechange=function(){!E||E.readyState!==4||E.status===0&&!(E.responseURL&&E.responseURL.indexOf("file:")===0)||setTimeout(_)},E.onabort=function(){E&&(n(new Rn("Request aborted",Rn.ECONNABORTED,s,E)),E=null)},E.onerror=function(){n(new Rn("Network Error",Rn.ERR_NETWORK,s,E)),E=null},E.ontimeout=function(){let I=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const M=i.transitional||zH;i.timeoutErrorMessage&&(I=i.timeoutErrorMessage),n(new Rn(I,M.clarifyTimeoutError?Rn.ETIMEDOUT:Rn.ECONNABORTED,s,E)),E=null},r===void 0&&a.setContentType(null),"setRequestHeader"in E&&st.forEach(a.toJSON(),function(I,M){E.setRequestHeader(M,I)}),st.isUndefined(i.withCredentials)||(E.withCredentials=!!i.withCredentials),o&&o!=="json"&&(E.responseType=i.responseType),c&&([p,y]=rT(c,!0),E.addEventListener("progress",p)),l&&E.upload&&([f,g]=rT(l),E.upload.addEventListener("progress",f),E.upload.addEventListener("loadend",g)),(i.cancelToken||i.signal)&&(h=C=>{E&&(n(!C||C.type?new d0(null,s,E):C),E.abort(),E=null)},i.cancelToken&&i.cancelToken.subscribe(h),i.signal&&(i.signal.aborted?h():i.signal.addEventListener("abort",h)));const b=nre(i.url);if(b&&ra.protocols.indexOf(b)===-1){n(new Rn("Unsupported protocol "+b+":",Rn.ERR_BAD_REQUEST,s));return}E.send(r||null)})},hre=(s,e)=>{const{length:t}=s=s?s.filter(Boolean):[];if(e||t){let n=new AbortController,i;const r=function(c){if(!i){i=!0,o();const h=c instanceof Error?c:this.reason;n.abort(h instanceof Rn?h:new d0(h instanceof Error?h.message:h))}};let a=e&&setTimeout(()=>{a=null,r(new Rn(`timeout ${e} of ms exceeded`,Rn.ETIMEDOUT))},e);const o=()=>{s&&(a&&clearTimeout(a),a=null,s.forEach(c=>{c.unsubscribe?c.unsubscribe(r):c.removeEventListener("abort",r)}),s=null)};s.forEach(c=>c.addEventListener("abort",r));const{signal:l}=n;return l.unsubscribe=()=>st.asap(o),l}},fre=function*(s,e){let t=s.byteLength;if(t<e){yield s;return}let n=0,i;for(;n<t;)i=n+e,yield s.slice(n,i),n=i},dre=async function*(s,e){for await(const t of pre(s))yield*fre(t,e)},pre=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const e=s.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)break;yield n}}finally{await e.cancel()}},gN=(s,e,t,n)=>{const i=dre(s,e);let r=0,a,o=l=>{a||(a=!0,n&&n(l))};return new ReadableStream({async pull(l){try{const{done:c,value:h}=await i.next();if(c){o(),l.close();return}let f=h.byteLength;if(t){let p=r+=f;t(p)}l.enqueue(new Uint8Array(h))}catch(c){throw o(c),c}},cancel(l){return o(l),i.return()}},{highWaterMark:2})},pC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",YH=pC&&typeof ReadableStream=="function",mre=pC&&(typeof TextEncoder=="function"?(s=>e=>s.encode(e))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),XH=(s,...e)=>{try{return!!s(...e)}catch{return!1}},gre=YH&&XH(()=>{let s=!1;const e=new Request(ra.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!e}),AN=64*1024,Zw=YH&&XH(()=>st.isReadableStream(new Response("").body)),aT={stream:Zw&&(s=>s.body)};pC&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!aT[e]&&(aT[e]=st.isFunction(s[e])?t=>t[e]():(t,n)=>{throw new Rn(`Response type '${e}' is not supported`,Rn.ERR_NOT_SUPPORT,n)})})})(new Response);const Are=async s=>{if(s==null)return 0;if(st.isBlob(s))return s.size;if(st.isSpecCompliantForm(s))return(await new Request(ra.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(st.isArrayBufferView(s)||st.isArrayBuffer(s))return s.byteLength;if(st.isURLSearchParams(s)&&(s=s+""),st.isString(s))return(await mre(s)).byteLength},yre=async(s,e)=>{const t=st.toFiniteNumber(s.getContentLength());return t??Are(e)},vre=pC&&(async s=>{let{url:e,method:t,data:n,signal:i,cancelToken:r,timeout:a,onDownloadProgress:o,onUploadProgress:l,responseType:c,headers:h,withCredentials:f="same-origin",fetchOptions:p}=KH(s);c=c?(c+"").toLowerCase():"text";let g=hre([i,r&&r.toAbortSignal()],a),y;const x=g&&g.unsubscribe&&(()=>{g.unsubscribe()});let E;try{if(l&&gre&&t!=="get"&&t!=="head"&&(E=await yre(h,n))!==0){let M=new Request(e,{method:"POST",body:n,duplex:"half"}),R;if(st.isFormData(n)&&(R=M.headers.get("content-type"))&&h.setContentType(R),M.body){const[D,P]=dN(E,rT(pN(l)));n=gN(M.body,AN,D,P)}}st.isString(f)||(f=f?"include":"omit");const _="credentials"in Request.prototype;y=new Request(e,{...p,signal:g,method:t.toUpperCase(),headers:h.normalize().toJSON(),body:n,duplex:"half",credentials:_?f:void 0});let b=await fetch(y,p);const C=Zw&&(c==="stream"||c==="response");if(Zw&&(o||C&&x)){const M={};["status","statusText","headers"].forEach(L=>{M[L]=b[L]});const R=st.toFiniteNumber(b.headers.get("content-length")),[D,P]=o&&dN(R,rT(pN(o),!0))||[];b=new Response(gN(b.body,AN,D,()=>{P&&P(),x&&x()}),M)}c=c||"text";let I=await aT[st.findKey(aT,c)||"text"](b,s);return!C&&x&&x(),await new Promise((M,R)=>{jH(M,R,{data:I,headers:ao.from(b.headers),status:b.status,statusText:b.statusText,config:s,request:y})})}catch(_){throw x&&x(),_&&_.name==="TypeError"&&/Load failed|fetch/i.test(_.message)?Object.assign(new Rn("Network Error",Rn.ERR_NETWORK,s,y),{cause:_.cause||_}):Rn.from(_,_&&_.code,s,y)}}),eR={http:Ose,xhr:ure,fetch:vre};st.forEach(eR,(s,e)=>{if(s){try{Object.defineProperty(s,"name",{value:e})}catch{}Object.defineProperty(s,"adapterName",{value:e})}});const yN=s=>`- ${s}`,Ere=s=>st.isFunction(s)||s===null||s===!1,WH={getAdapter:s=>{s=st.isArray(s)?s:[s];const{length:e}=s;let t,n;const i={};for(let r=0;r<e;r++){t=s[r];let a;if(n=t,!Ere(t)&&(n=eR[(a=String(t)).toLowerCase()],n===void 0))throw new Rn(`Unknown adapter '${a}'`);if(n)break;i[a||"#"+r]=n}if(!n){const r=Object.entries(i).map(([o,l])=>`adapter ${o} `+(l===!1?"is not supported by the environment":"is not available in the build"));let a=e?r.length>1?`since :
`+r.map(yN).join(`
`):" "+yN(r[0]):"as no adapter specified";throw new Rn("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return n},adapters:eR};function fM(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new d0(null,s)}function vN(s){return fM(s),s.headers=ao.from(s.headers),s.data=hM.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),WH.getAdapter(s.adapter||BE.adapter)(s).then(function(n){return fM(s),n.data=hM.call(s,s.transformResponse,n),n.headers=ao.from(n.headers),n},function(n){return VH(n)||(fM(s),n&&n.response&&(n.response.data=hM.call(s,s.transformResponse,n.response),n.response.headers=ao.from(n.response.headers))),Promise.reject(n)})}const $H="1.11.0",mC={};["object","boolean","number","function","string","symbol"].forEach((s,e)=>{mC[s]=function(n){return typeof n===s||"a"+(e<1?"n ":" ")+s}});const EN={};mC.transitional=function(e,t,n){function i(r,a){return"[Axios v"+$H+"] Transitional option '"+r+"'"+a+(n?". "+n:"")}return(r,a,o)=>{if(e===!1)throw new Rn(i(a," has been removed"+(t?" in "+t:"")),Rn.ERR_DEPRECATED);return t&&!EN[a]&&(EN[a]=!0,console.warn(i(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(r,a,o):!0}};mC.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function xre(s,e,t){if(typeof s!="object")throw new Rn("options must be an object",Rn.ERR_BAD_OPTION_VALUE);const n=Object.keys(s);let i=n.length;for(;i-- >0;){const r=n[i],a=e[r];if(a){const o=s[r],l=o===void 0||a(o,r,s);if(l!==!0)throw new Rn("option "+r+" must be "+l,Rn.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Rn("Unknown option "+r,Rn.ERR_BAD_OPTION)}}const eb={assertOptions:xre,validators:mC},Zc=eb.validators;let rm=class{constructor(e){this.defaults=e||{},this.interceptors={request:new hN,response:new hN}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=gm(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:r}=t;n!==void 0&&eb.assertOptions(n,{silentJSONParsing:Zc.transitional(Zc.boolean),forcedJSONParsing:Zc.transitional(Zc.boolean),clarifyTimeoutError:Zc.transitional(Zc.boolean)},!1),i!=null&&(st.isFunction(i)?t.paramsSerializer={serialize:i}:eb.assertOptions(i,{encode:Zc.function,serialize:Zc.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),eb.assertOptions(t,{baseUrl:Zc.spelling("baseURL"),withXsrfToken:Zc.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=r&&st.merge(r.common,r[t.method]);r&&st.forEach(["delete","get","head","post","put","patch","common"],y=>{delete r[y]}),t.headers=ao.concat(a,r);const o=[];let l=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(t)===!1||(l=l&&x.synchronous,o.unshift(x.fulfilled,x.rejected))});const c=[];this.interceptors.response.forEach(function(x){c.push(x.fulfilled,x.rejected)});let h,f=0,p;if(!l){const y=[vN.bind(this),void 0];for(y.unshift(...o),y.push(...c),p=y.length,h=Promise.resolve(t);f<p;)h=h.then(y[f++],y[f++]);return h}p=o.length;let g=t;for(f=0;f<p;){const y=o[f++],x=o[f++];try{g=y(g)}catch(E){x.call(this,E);break}}try{h=vN.call(this,g)}catch(y){return Promise.reject(y)}for(f=0,p=c.length;f<p;)h=h.then(c[f++],c[f++]);return h}getUri(e){e=gm(this.defaults,e);const t=qH(e.baseURL,e.url,e.allowAbsoluteUrls);return HH(t,e.params,e.paramsSerializer)}};st.forEach(["delete","get","head","options"],function(e){rm.prototype[e]=function(t,n){return this.request(gm(n||{},{method:e,url:t,data:(n||{}).data}))}});st.forEach(["post","put","patch"],function(e){function t(n){return function(r,a,o){return this.request(gm(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:a}))}}rm.prototype[e]=t(),rm.prototype[e+"Form"]=t(!0)});let _re=class JH{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(r){t=r});const n=this;this.promise.then(i=>{if(!n._listeners)return;let r=n._listeners.length;for(;r-- >0;)n._listeners[r](i);n._listeners=null}),this.promise.then=i=>{let r;const a=new Promise(o=>{n.subscribe(o),r=o}).then(i);return a.cancel=function(){n.unsubscribe(r)},a},e(function(r,a,o){n.reason||(n.reason=new d0(r,a,o),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=n=>{e.abort(n)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new JH(function(i){e=i}),cancel:e}}};function Sre(s){return function(t){return s.apply(null,t)}}function bre(s){return st.isObject(s)&&s.isAxiosError===!0}const tR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(tR).forEach(([s,e])=>{tR[e]=s});function ZH(s){const e=new rm(s),t=wH(rm.prototype.request,e);return st.extend(t,rm.prototype,e,{allOwnKeys:!0}),st.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return ZH(gm(s,i))},t}const fi=ZH(BE);fi.Axios=rm;fi.CanceledError=d0;fi.CancelToken=_re;fi.isCancel=VH;fi.VERSION=$H;fi.toFormData=dC;fi.AxiosError=Rn;fi.Cancel=fi.CanceledError;fi.all=function(e){return Promise.all(e)};fi.spread=Sre;fi.isAxiosError=bre;fi.mergeConfig=gm;fi.AxiosHeaders=ao;fi.formToJSON=s=>QH(st.isHTMLForm(s)?new FormData(s):s);fi.getAdapter=WH.getAdapter;fi.HttpStatusCode=tR;fi.default=fi;const{Axios:$de,AxiosError:Jde,CanceledError:Zde,isCancel:epe,CancelToken:tpe,VERSION:npe,all:ipe,Cancel:spe,isAxiosError:rpe,spread:ape,toFormData:ope,AxiosHeaders:lpe,HttpStatusCode:cpe,formToJSON:upe,getAdapter:hpe,mergeConfig:fpe}=fi,ac="http://localhost".replace(/\/+$/,"");class Tre{configuration;basePath;axios;constructor(e,t=ac,n=fi){this.basePath=t,this.axios=n,e&&(this.configuration=e,this.basePath=e.basePath??t)}}class Cre extends Error{field;constructor(e,t){super(t),this.name="RequiredError",this.field=e}}const eu={},tu="https://example.com",nc=function(s,e,t){if(t==null)throw new Cre(e,`Required parameter ${e} was null or undefined when calling ${s}.`)};function nR(s,e,t=""){e!=null&&(typeof e=="object"?Array.isArray(e)?e.forEach(n=>nR(s,n,t)):Object.keys(e).forEach(n=>nR(s,e[n],`${t}${t!==""?".":""}${n}`)):s.has(t)?s.append(t,e):s.set(t,e))}const nu=function(s,...e){const t=new URLSearchParams(s.search);nR(t,e),s.search=t.toString()},xN=function(s,e,t){const n=typeof s!="string";return(n&&t&&t.isJsonMime?t.isJsonMime(e.headers["Content-Type"]):n)?JSON.stringify(s!==void 0?s:{}):s||""},iu=function(s){return s.pathname+s.search+s.hash},su=function(s,e,t,n){return(i=e,r=t)=>{const a={...s.options,url:(i.defaults.baseURL?"":n?.basePath??r)+s.url};return i.request(a)}},Ire=function(s){return{analyzeExistingObjectStorageObjectsObjectIdAnalyzePost:async(e,t,n={})=>{nc("analyzeExistingObjectStorageObjectsObjectIdAnalyzePost","objectId",e);const i="/storage/objects/{object_id}/analyze".replace("{object_id}",encodeURIComponent(String(e))),r=new URL(i,tu);let a;s&&(a=s.baseOptions);const o={method:"POST",...a,...n},l={},c={};t!=null&&(l["X-API-KEY"]=String(t)),nu(r,c);let h=a&&a.headers?a.headers:{};return o.headers={...l,...h,...n.headers},{url:iu(r),options:o}},deleteObjectStorageObjectIdDelete:async(e,t,n={})=>{nc("deleteObjectStorageObjectIdDelete","objectId",e);const i="/storage/{object_id}".replace("{object_id}",encodeURIComponent(String(e))),r=new URL(i,tu);let a;s&&(a=s.baseOptions);const o={method:"DELETE",...a,...n},l={},c={};t!=null&&(l["X-API-KEY"]=String(t)),nu(r,c);let h=a&&a.headers?a.headers:{};return o.headers={...l,...h,...n.headers},{url:iu(r),options:o}},downloadFileStorageFilesObjectIdGet:async(e,t,n={})=>{nc("downloadFileStorageFilesObjectIdGet","objectId",e);const i="/storage/files/{object_id}".replace("{object_id}",encodeURIComponent(String(e))),r=new URL(i,tu);let a;s&&(a=s.baseOptions);const o={method:"GET",...a,...n},l={},c={};t!=null&&(l["X-API-KEY"]=String(t)),nu(r,c);let h=a&&a.headers?a.headers:{};return o.headers={...l,...h,...n.headers},{url:iu(r),options:o}},fetchAndStoreRemoteStorageFetchPost:async(e,t,n={})=>{nc("fetchAndStoreRemoteStorageFetchPost","remoteFetchRequest",e);const i="/storage/fetch",r=new URL(i,tu);let a;s&&(a=s.baseOptions);const o={method:"POST",...a,...n},l={},c={};l["Content-Type"]="application/json",t!=null&&(l["X-API-KEY"]=String(t)),nu(r,c);let h=a&&a.headers?a.headers:{};return o.headers={...l,...h,...n.headers},o.data=xN(e,o,s),{url:iu(r),options:o}},getObjectMetadataStorageObjectsObjectIdGet:async(e,t,n={})=>{nc("getObjectMetadataStorageObjectsObjectIdGet","objectId",e);const i="/storage/objects/{object_id}".replace("{object_id}",encodeURIComponent(String(e))),r=new URL(i,tu);let a;s&&(a=s.baseOptions);const o={method:"GET",...a,...n},l={},c={};t!=null&&(l["X-API-KEY"]=String(t)),nu(r,c);let h=a&&a.headers?a.headers:{};return o.headers={...l,...h,...n.headers},{url:iu(r),options:o}},likeObjectStorageObjectsObjectIdLikePost:async(e,t={})=>{nc("likeObjectStorageObjectsObjectIdLikePost","objectId",e);const n="/storage/objects/{object_id}/like".replace("{object_id}",encodeURIComponent(String(e))),i=new URL(n,tu);let r;s&&(r=s.baseOptions);const a={method:"POST",...r,...t},o={};nu(i,{});let c=r&&r.headers?r.headers:{};return a.headers={...o,...c,...t.headers},{url:iu(i),options:a}},listObjectsStorageListGet:async(e,t,n,i,r,a={})=>{const o="/storage/list",l=new URL(o,tu);let c;s&&(c=s.baseOptions);const h={method:"GET",...c,...a},f={},p={};e!==void 0&&(p.mine=e),t!==void 0&&(p.context=t),n!==void 0&&(p.collection_id=n),i!==void 0&&(p.link_id=i),r!=null&&(f["X-API-KEY"]=String(r)),nu(l,p);let g=c&&c.headers?c.headers:{};return h.headers={...f,...g,...a.headers},{url:iu(l),options:h}},replaceFileStorageFilesObjectIdPut:async(e,t,n,i={})=>{nc("replaceFileStorageFilesObjectIdPut","objectId",e),nc("replaceFileStorageFilesObjectIdPut","file",t);const r="/storage/files/{object_id}".replace("{object_id}",encodeURIComponent(String(e))),a=new URL(r,tu);let o;s&&(o=s.baseOptions);const l={method:"PUT",...o,...i},c={},h={},f=new(s&&s.formDataCtor||FormData);t!==void 0&&f.append("file",t),c["Content-Type"]="multipart/form-data",n!=null&&(c["X-API-KEY"]=String(n)),nu(a,h);let p=o&&o.headers?o.headers:{};return l.headers={...c,...p,...i.headers},l.data=f,{url:iu(a),options:l}},updateObjectMetadataStorageObjectsObjectIdPatch:async(e,t,n,i={})=>{nc("updateObjectMetadataStorageObjectsObjectIdPatch","objectId",e),nc("updateObjectMetadataStorageObjectsObjectIdPatch","storageObjectUpdate",t);const r="/storage/objects/{object_id}".replace("{object_id}",encodeURIComponent(String(e))),a=new URL(r,tu);let o;s&&(o=s.baseOptions);const l={method:"PATCH",...o,...i},c={},h={};c["Content-Type"]="application/json",n!=null&&(c["X-API-KEY"]=String(n)),nu(a,h);let f=o&&o.headers?o.headers:{};return l.headers={...c,...f,...i.headers},l.data=xN(t,l,s),{url:iu(a),options:l}},uploadFileStorageUploadPost:async(e,t,n,i,r,a,o,l,c={})=>{nc("uploadFileStorageUploadPost","file",e);const h="/storage/upload",f=new URL(h,tu);let p;s&&(p=s.baseOptions);const g={method:"POST",...p,...c},y={},x={},E=new(s&&s.formDataCtor||FormData);e!==void 0&&E.append("file",e),n!==void 0&&E.append("context",n),i!==void 0&&E.append("is_public",String(i)),r!==void 0&&E.append("owner_email",r),a!==void 0&&E.append("collection_id",a),o!==void 0&&E.append("link_id",o),l!==void 0&&E.append("analyze",String(l)),y["Content-Type"]="multipart/form-data",t!=null&&(y["X-API-KEY"]=String(t)),nu(f,x);let _=p&&p.headers?p.headers:{};return g.headers={...y,..._,...c.headers},g.data=E,{url:iu(f),options:g}}}},ru=function(s){const e=Ire(s);return{async analyzeExistingObjectStorageObjectsObjectIdAnalyzePost(t,n,i){const r=await e.analyzeExistingObjectStorageObjectsObjectIdAnalyzePost(t,n,i),a=s?.serverIndex??0,o=eu["StorageApi.analyzeExistingObjectStorageObjectsObjectIdAnalyzePost"]?.[a]?.url;return(l,c)=>su(r,fi,ac,s)(l,o||c)},async deleteObjectStorageObjectIdDelete(t,n,i){const r=await e.deleteObjectStorageObjectIdDelete(t,n,i),a=s?.serverIndex??0,o=eu["StorageApi.deleteObjectStorageObjectIdDelete"]?.[a]?.url;return(l,c)=>su(r,fi,ac,s)(l,o||c)},async downloadFileStorageFilesObjectIdGet(t,n,i){const r=await e.downloadFileStorageFilesObjectIdGet(t,n,i),a=s?.serverIndex??0,o=eu["StorageApi.downloadFileStorageFilesObjectIdGet"]?.[a]?.url;return(l,c)=>su(r,fi,ac,s)(l,o||c)},async fetchAndStoreRemoteStorageFetchPost(t,n,i){const r=await e.fetchAndStoreRemoteStorageFetchPost(t,n,i),a=s?.serverIndex??0,o=eu["StorageApi.fetchAndStoreRemoteStorageFetchPost"]?.[a]?.url;return(l,c)=>su(r,fi,ac,s)(l,o||c)},async getObjectMetadataStorageObjectsObjectIdGet(t,n,i){const r=await e.getObjectMetadataStorageObjectsObjectIdGet(t,n,i),a=s?.serverIndex??0,o=eu["StorageApi.getObjectMetadataStorageObjectsObjectIdGet"]?.[a]?.url;return(l,c)=>su(r,fi,ac,s)(l,o||c)},async likeObjectStorageObjectsObjectIdLikePost(t,n){const i=await e.likeObjectStorageObjectsObjectIdLikePost(t,n),r=s?.serverIndex??0,a=eu["StorageApi.likeObjectStorageObjectsObjectIdLikePost"]?.[r]?.url;return(o,l)=>su(i,fi,ac,s)(o,a||l)},async listObjectsStorageListGet(t,n,i,r,a,o){const l=await e.listObjectsStorageListGet(t,n,i,r,a,o),c=s?.serverIndex??0,h=eu["StorageApi.listObjectsStorageListGet"]?.[c]?.url;return(f,p)=>su(l,fi,ac,s)(f,h||p)},async replaceFileStorageFilesObjectIdPut(t,n,i,r){const a=await e.replaceFileStorageFilesObjectIdPut(t,n,i,r),o=s?.serverIndex??0,l=eu["StorageApi.replaceFileStorageFilesObjectIdPut"]?.[o]?.url;return(c,h)=>su(a,fi,ac,s)(c,l||h)},async updateObjectMetadataStorageObjectsObjectIdPatch(t,n,i,r){const a=await e.updateObjectMetadataStorageObjectsObjectIdPatch(t,n,i,r),o=s?.serverIndex??0,l=eu["StorageApi.updateObjectMetadataStorageObjectsObjectIdPatch"]?.[o]?.url;return(c,h)=>su(a,fi,ac,s)(c,l||h)},async uploadFileStorageUploadPost(t,n,i,r,a,o,l,c,h){const f=await e.uploadFileStorageUploadPost(t,n,i,r,a,o,l,c,h),p=s?.serverIndex??0,g=eu["StorageApi.uploadFileStorageUploadPost"]?.[p]?.url;return(y,x)=>su(f,fi,ac,s)(y,g||x)}}};class e4 extends Tre{analyzeExistingObjectStorageObjectsObjectIdAnalyzePost(e,t,n){return ru(this.configuration).analyzeExistingObjectStorageObjectsObjectIdAnalyzePost(e,t,n).then(i=>i(this.axios,this.basePath))}deleteObjectStorageObjectIdDelete(e,t,n){return ru(this.configuration).deleteObjectStorageObjectIdDelete(e,t,n).then(i=>i(this.axios,this.basePath))}downloadFileStorageFilesObjectIdGet(e,t,n){return ru(this.configuration).downloadFileStorageFilesObjectIdGet(e,t,n).then(i=>i(this.axios,this.basePath))}fetchAndStoreRemoteStorageFetchPost(e,t,n){return ru(this.configuration).fetchAndStoreRemoteStorageFetchPost(e,t,n).then(i=>i(this.axios,this.basePath))}getObjectMetadataStorageObjectsObjectIdGet(e,t,n){return ru(this.configuration).getObjectMetadataStorageObjectsObjectIdGet(e,t,n).then(i=>i(this.axios,this.basePath))}likeObjectStorageObjectsObjectIdLikePost(e,t){return ru(this.configuration).likeObjectStorageObjectsObjectIdLikePost(e,t).then(n=>n(this.axios,this.basePath))}listObjectsStorageListGet(e,t,n,i,r,a){return ru(this.configuration).listObjectsStorageListGet(e,t,n,i,r,a).then(o=>o(this.axios,this.basePath))}replaceFileStorageFilesObjectIdPut(e,t,n,i){return ru(this.configuration).replaceFileStorageFilesObjectIdPut(e,t,n,i).then(r=>r(this.axios,this.basePath))}updateObjectMetadataStorageObjectsObjectIdPatch(e,t,n,i){return ru(this.configuration).updateObjectMetadataStorageObjectsObjectIdPatch(e,t,n,i).then(r=>r(this.axios,this.basePath))}uploadFileStorageUploadPost(e,t,n,i,r,a,o,l,c){return ru(this.configuration).uploadFileStorageUploadPost(e,t,n,i,r,a,o,l,c).then(h=>h(this.axios,this.basePath))}}class t4{apiKey;username;password;accessToken;basePath;serverIndex;baseOptions;formDataCtor;constructor(e={}){this.apiKey=e.apiKey,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.serverIndex=e.serverIndex,this.baseOptions={...e.baseOptions,headers:{...e.baseOptions?.headers}},this.formDataCtor=e.formDataCtor}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(;.*)?$","i");return e!==null&&(t.test(e)||e.toLowerCase()==="application/json-patch+json")}}const Mre=()=>{};var _N={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n4=function(s){const e=[];let t=0;for(let n=0;n<s.length;n++){let i=s.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<s.length&&(s.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(s.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},wre=function(s){const e=[];let t=0,n=0;for(;t<s.length;){const i=s[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const r=s[t++];e[n++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=s[t++],a=s[t++],o=s[t++],l=((i&7)<<18|(r&63)<<12|(a&63)<<6|o&63)-65536;e[n++]=String.fromCharCode(55296+(l>>10)),e[n++]=String.fromCharCode(56320+(l&1023))}else{const r=s[t++],a=s[t++];e[n++]=String.fromCharCode((i&15)<<12|(r&63)<<6|a&63)}}return e.join("")},i4={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<s.length;i+=3){const r=s[i],a=i+1<s.length,o=a?s[i+1]:0,l=i+2<s.length,c=l?s[i+2]:0,h=r>>2,f=(r&3)<<4|o>>4;let p=(o&15)<<2|c>>6,g=c&63;l||(g=64,a||(p=64)),n.push(t[h],t[f],t[p],t[g])}return n.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(n4(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):wre(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<s.length;){const r=t[s.charAt(i++)],o=i<s.length?t[s.charAt(i)]:0;++i;const c=i<s.length?t[s.charAt(i)]:64;++i;const f=i<s.length?t[s.charAt(i)]:64;if(++i,r==null||o==null||c==null||f==null)throw new Rre;const p=r<<2|o>>4;if(n.push(p),c!==64){const g=o<<4&240|c>>2;if(n.push(g),f!==64){const y=c<<6&192|f;n.push(y)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class Rre extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Bre=function(s){const e=n4(s);return i4.encodeByteArray(e,!0)},s4=function(s){return Bre(s).replace(/\./g,"")},r4=function(s){try{return i4.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dre(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lre=()=>Dre().__FIREBASE_DEFAULTS__,Ore=()=>{if(typeof process>"u"||typeof _N>"u")return;const s=_N.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},Pre=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&r4(s[1]);return e&&JSON.parse(e)},Nre=()=>{try{return Mre()||Lre()||Ore()||Pre()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},Fre=s=>{var e;return(e=Nre())===null||e===void 0?void 0:e[`_${s}`]};/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a4(s){try{return(s.startsWith("http://")||s.startsWith("https://")?new URL(s).hostname:s).endsWith(".cloudworkstations.dev")}catch{return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mu(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ure(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Mu())}function kre(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Gre(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function Hre(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function zre(){try{return typeof indexedDB=="object"}catch{return!1}}function Qre(){return new Promise((s,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),s(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var r;e(((r=i.error)===null||r===void 0?void 0:r.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vre="FirebaseError";class xm extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Vre,Object.setPrototypeOf(this,xm.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,DE.prototype.create)}}class DE{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],a=r?jre(r,n):"Error",o=`${this.serviceName}: ${a} (${i}).`;return new xm(i,o,n)}}function jre(s,e){return s.replace(qre,(t,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const qre=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o4(s){const e=[];for(const[t,n]of Object.entries(s))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Kre(s,e){const t=new Yre(s,e);return t.subscribe.bind(t)}class Yre{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");Xre(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:n},i.next===void 0&&(i.next=dM),i.error===void 0&&(i.error=dM),i.complete===void 0&&(i.complete=dM);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Xre(s,e){if(typeof s!="object"||s===null)return!1;for(const t of e)if(t in s&&typeof s[t]=="function")return!0;return!1}function dM(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gC(s){return s&&s._delegate?s._delegate:s}let $v=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ui;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(Ui||(Ui={}));const Wre={debug:Ui.DEBUG,verbose:Ui.VERBOSE,info:Ui.INFO,warn:Ui.WARN,error:Ui.ERROR,silent:Ui.SILENT},$re=Ui.INFO,Jre={[Ui.DEBUG]:"log",[Ui.VERBOSE]:"log",[Ui.INFO]:"info",[Ui.WARN]:"warn",[Ui.ERROR]:"error"},Zre=(s,e,...t)=>{if(e<s.logLevel)return;const n=new Date().toISOString(),i=Jre[e];if(i)console[i](`[${n}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class l4{constructor(e){this.name=e,this._logLevel=$re,this._logHandler=Zre,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ui))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Wre[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ui.DEBUG,...e),this._logHandler(this,Ui.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ui.VERBOSE,...e),this._logHandler(this,Ui.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ui.INFO,...e),this._logHandler(this,Ui.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ui.WARN,...e),this._logHandler(this,Ui.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ui.ERROR,...e),this._logHandler(this,Ui.ERROR,...e)}}const eae=(s,e)=>e.some(t=>s instanceof t);let SN,bN;function tae(){return SN||(SN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function nae(){return bN||(bN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const c4=new WeakMap,iR=new WeakMap,u4=new WeakMap,pM=new WeakMap,tD=new WeakMap;function iae(s){const e=new Promise((t,n)=>{const i=()=>{s.removeEventListener("success",r),s.removeEventListener("error",a)},r=()=>{t(sd(s.result)),i()},a=()=>{n(s.error),i()};s.addEventListener("success",r),s.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&c4.set(t,s)}).catch(()=>{}),tD.set(e,s),e}function sae(s){if(iR.has(s))return;const e=new Promise((t,n)=>{const i=()=>{s.removeEventListener("complete",r),s.removeEventListener("error",a),s.removeEventListener("abort",a)},r=()=>{t(),i()},a=()=>{n(s.error||new DOMException("AbortError","AbortError")),i()};s.addEventListener("complete",r),s.addEventListener("error",a),s.addEventListener("abort",a)});iR.set(s,e)}let sR={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return iR.get(s);if(e==="objectStoreNames")return s.objectStoreNames||u4.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return sd(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function rae(s){sR=s(sR)}function aae(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=s.call(mM(this),e,...t);return u4.set(n,e.sort?e.sort():[e]),sd(n)}:nae().includes(s)?function(...e){return s.apply(mM(this),e),sd(c4.get(this))}:function(...e){return sd(s.apply(mM(this),e))}}function oae(s){return typeof s=="function"?aae(s):(s instanceof IDBTransaction&&sae(s),eae(s,tae())?new Proxy(s,sR):s)}function sd(s){if(s instanceof IDBRequest)return iae(s);if(pM.has(s))return pM.get(s);const e=oae(s);return e!==s&&(pM.set(s,e),tD.set(e,s)),e}const mM=s=>tD.get(s);function lae(s,e,{blocked:t,upgrade:n,blocking:i,terminated:r}={}){const a=indexedDB.open(s,e),o=sd(a);return n&&a.addEventListener("upgradeneeded",l=>{n(sd(a.result),l.oldVersion,l.newVersion,sd(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),o.then(l=>{r&&l.addEventListener("close",()=>r()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),o}const cae=["get","getKey","getAll","getAllKeys","count"],uae=["put","add","delete","clear"],gM=new Map;function TN(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(gM.get(e))return gM.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,i=uae.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||cae.includes(t)))return;const r=async function(a,...o){const l=this.transaction(a,i?"readwrite":"readonly");let c=l.store;return n&&(c=c.index(o.shift())),(await Promise.all([c[t](...o),i&&l.done]))[0]};return gM.set(e,r),r}rae(s=>({...s,get:(e,t,n)=>TN(e,t)||s.get(e,t,n),has:(e,t)=>!!TN(e,t)||s.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hae{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(fae(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function fae(s){const e=s.getComponent();return e?.type==="VERSION"}const rR="@firebase/app",CN="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bh=new l4("@firebase/app"),dae="@firebase/app-compat",pae="@firebase/analytics-compat",mae="@firebase/analytics",gae="@firebase/app-check-compat",Aae="@firebase/app-check",yae="@firebase/auth",vae="@firebase/auth-compat",Eae="@firebase/database",xae="@firebase/data-connect",_ae="@firebase/database-compat",Sae="@firebase/functions",bae="@firebase/functions-compat",Tae="@firebase/installations",Cae="@firebase/installations-compat",Iae="@firebase/messaging",Mae="@firebase/messaging-compat",wae="@firebase/performance",Rae="@firebase/performance-compat",Bae="@firebase/remote-config",Dae="@firebase/remote-config-compat",Lae="@firebase/storage",Oae="@firebase/storage-compat",Pae="@firebase/firestore",Nae="@firebase/ai",Fae="@firebase/firestore-compat",Uae="firebase",kae="11.10.0",Gae={[rR]:"fire-core",[dae]:"fire-core-compat",[mae]:"fire-analytics",[pae]:"fire-analytics-compat",[Aae]:"fire-app-check",[gae]:"fire-app-check-compat",[yae]:"fire-auth",[vae]:"fire-auth-compat",[Eae]:"fire-rtdb",[xae]:"fire-data-connect",[_ae]:"fire-rtdb-compat",[Sae]:"fire-fn",[bae]:"fire-fn-compat",[Tae]:"fire-iid",[Cae]:"fire-iid-compat",[Iae]:"fire-fcm",[Mae]:"fire-fcm-compat",[wae]:"fire-perf",[Rae]:"fire-perf-compat",[Bae]:"fire-rc",[Dae]:"fire-rc-compat",[Lae]:"fire-gcs",[Oae]:"fire-gcs-compat",[Pae]:"fire-fst",[Fae]:"fire-fst-compat",[Nae]:"fire-vertex","fire-js":"fire-js",[Uae]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hae=new Map,zae=new Map,IN=new Map;function MN(s,e){try{s.container.addComponent(e)}catch(t){Bh.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function Jv(s){const e=s.name;if(IN.has(e))return Bh.debug(`There were multiple attempts to register component ${e}.`),!1;IN.set(e,s);for(const t of Hae.values())MN(t,s);for(const t of zae.values())MN(t,s);return!0}function iA(s){return s==null?!1:s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qae={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},nD=new DE("app","Firebase",Qae);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iD=kae;function TA(s,e,t){var n;let i=(n=Gae[s])!==null&&n!==void 0?n:s;t&&(i+=`-${t}`);const r=i.match(/\s|\//),a=e.match(/\s|\//);if(r||a){const o=[`Unable to register library "${i}" with version "${e}":`];r&&o.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&a&&o.push("and"),a&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Bh.warn(o.join(" "));return}Jv(new $v(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vae="firebase-heartbeat-database",jae=1,Zv="firebase-heartbeat-store";let AM=null;function h4(){return AM||(AM=lae(Vae,jae,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(Zv)}catch(t){console.warn(t)}}}}).catch(s=>{throw nD.create("idb-open",{originalErrorMessage:s.message})})),AM}async function qae(s){try{const t=(await h4()).transaction(Zv),n=await t.objectStore(Zv).get(f4(s));return await t.done,n}catch(e){if(e instanceof xm)Bh.warn(e.message);else{const t=nD.create("idb-get",{originalErrorMessage:e?.message});Bh.warn(t.message)}}}async function wN(s,e){try{const n=(await h4()).transaction(Zv,"readwrite");await n.objectStore(Zv).put(e,f4(s)),await n.done}catch(t){if(t instanceof xm)Bh.warn(t.message);else{const n=nD.create("idb-set",{originalErrorMessage:t?.message});Bh.warn(n.message)}}}function f4(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kae=1024,Yae=30;class Xae{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new $ae(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=RN();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(a=>a.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats.length>Yae){const a=Jae(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){Bh.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=RN(),{heartbeatsToSend:n,unsentEntries:i}=Wae(this._heartbeatsCache.heartbeats),r=s4(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return Bh.warn(t),""}}}function RN(){return new Date().toISOString().substring(0,10)}function Wae(s,e=Kae){const t=[];let n=s.slice();for(const i of s){const r=t.find(a=>a.agent===i.agent);if(r){if(r.dates.push(i.date),BN(t)>e){r.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),BN(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class $ae{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return zre()?Qre().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await qae(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return wN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return wN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function BN(s){return s4(JSON.stringify({version:2,heartbeats:s})).length}function Jae(s){if(s.length===0)return-1;let e=0,t=s[0].date;for(let n=1;n<s.length;n++)s[n].date<t&&(t=s[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zae(s){Jv(new $v("platform-logger",e=>new hae(e),"PRIVATE")),Jv(new $v("heartbeat",e=>new Xae(e),"PRIVATE")),TA(rR,CN,s),TA(rR,CN,"esm2017"),TA("fire-js","")}Zae("");var eoe="firebase",toe="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */TA(eoe,toe,"app");function d4(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(s);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(s,n[i])&&(t[n[i]]=s[n[i]]);return t}function p4(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const noe=p4,m4=new DE("auth","Firebase",p4());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oT=new l4("@firebase/auth");function ioe(s,...e){oT.logLevel<=Ui.WARN&&oT.warn(`Auth (${iD}): ${s}`,...e)}function tb(s,...e){oT.logLevel<=Ui.ERROR&&oT.error(`Auth (${iD}): ${s}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DN(s,...e){throw sD(s,...e)}function g4(s,...e){return sD(s,...e)}function A4(s,e,t){const n=Object.assign(Object.assign({},noe()),{[e]:t});return new DE("auth","Firebase",n).create(e,{appName:s.name})}function nb(s){return A4(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function sD(s,...e){if(typeof s!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=s.name),s._errorFactory.create(t,...n)}return m4.create(s,...e)}function di(s,e,...t){if(!s)throw sD(e,...t)}function vv(s){const e="INTERNAL ASSERTION FAILED: "+s;throw tb(e),new Error(e)}function lT(s,e){s||vv(e)}function soe(){return LN()==="http:"||LN()==="https:"}function LN(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function roe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(soe()||Gre()||"connection"in navigator)?navigator.onLine:!0}function aoe(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LE{constructor(e,t){this.shortDelay=e,this.longDelay=t,lT(t>e,"Short delay should be less than long delay!"),this.isMobile=Ure()||Hre()}get(){return roe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ooe(s,e){lT(s.emulator,"Emulator should always be set here");const{url:t}=s.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y4{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;vv("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;vv("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;vv("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const loe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const coe=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],uoe=new LE(3e4,6e4);function v4(s,e){return s.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:s.tenantId}):e}async function AC(s,e,t,n,i={}){return E4(s,i,async()=>{let r={},a={};n&&(e==="GET"?a=n:r={body:JSON.stringify(n)});const o=o4(Object.assign({key:s.config.apiKey},a)).slice(1),l=await s._getAdditionalHeaders();l["Content-Type"]="application/json",s.languageCode&&(l["X-Firebase-Locale"]=s.languageCode);const c=Object.assign({method:e,headers:l},r);return kre()||(c.referrerPolicy="no-referrer"),s.emulatorConfig&&a4(s.emulatorConfig.host)&&(c.credentials="include"),y4.fetch()(await x4(s,s.config.apiHost,t,o),c)})}async function E4(s,e,t){s._canInitEmulator=!1;const n=Object.assign(Object.assign({},loe),e);try{const i=new hoe(s),r=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const a=await r.json();if("needConfirmation"in a)throw IS(s,"account-exists-with-different-credential",a);if(r.ok&&!("errorMessage"in a))return a;{const o=r.ok?a.errorMessage:a.error.message,[l,c]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw IS(s,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw IS(s,"email-already-in-use",a);if(l==="USER_DISABLED")throw IS(s,"user-disabled",a);const h=n[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw A4(s,h,c);DN(s,h)}}catch(i){if(i instanceof xm)throw i;DN(s,"network-request-failed",{message:String(i)})}}async function x4(s,e,t,n){const i=`${e}${t}?${n}`,r=s,a=r.config.emulator?ooe(s.config,i):`${s.config.apiScheme}://${i}`;return coe.includes(t)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(a).toString():a}class hoe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(g4(this.auth,"network-request-failed")),uoe.get())})}}function IS(s,e,t){const n={appName:s.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const i=g4(s,e,n);return i.customData._tokenResponse=t,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function foe(s,e){return AC(s,"POST","/v1/accounts:delete",e)}async function cT(s,e){return AC(s,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ev(s){if(s)try{const e=new Date(Number(s));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function doe(s,e=!1){const t=gC(s),n=await t.getIdToken(e),i=_4(n);di(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,a=r?.sign_in_provider;return{claims:i,token:n,authTime:Ev(yM(i.auth_time)),issuedAtTime:Ev(yM(i.iat)),expirationTime:Ev(yM(i.exp)),signInProvider:a||null,signInSecondFactor:r?.sign_in_second_factor||null}}function yM(s){return Number(s)*1e3}function _4(s){const[e,t,n]=s.split(".");if(e===void 0||t===void 0||n===void 0)return tb("JWT malformed, contained fewer than 3 sections"),null;try{const i=r4(t);return i?JSON.parse(i):(tb("Failed to decode base64 JWT payload"),null)}catch(i){return tb("Caught error parsing JWT payload as JSON",i?.toString()),null}}function ON(s){const e=_4(s);return di(e,"internal-error"),di(typeof e.exp<"u","internal-error"),di(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aR(s,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof xm&&poe(n)&&s.auth.currentUser===s&&await s.auth.signOut(),n}}function poe({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class moe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oR{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ev(this.lastLoginAt),this.creationTime=Ev(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uT(s){var e;const t=s.auth,n=await s.getIdToken(),i=await aR(s,cT(t,{idToken:n}));di(i?.users.length,t,"internal-error");const r=i.users[0];s._notifyReloadListener(r);const a=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?S4(r.providerUserInfo):[],o=Aoe(s.providerData,a),l=s.isAnonymous,c=!(s.email&&r.passwordHash)&&!o?.length,h=l?c:!1,f={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new oR(r.createdAt,r.lastLoginAt),isAnonymous:h};Object.assign(s,f)}async function goe(s){const e=gC(s);await uT(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Aoe(s,e){return[...s.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function S4(s){return s.map(e=>{var{providerId:t}=e,n=d4(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yoe(s,e){const t=await E4(s,{},async()=>{const n=o4({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=s.config,a=await x4(s,i,"/v1/token",`key=${r}`),o=await s._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:n};return s.emulatorConfig&&a4(s.emulatorConfig.host)&&(l.credentials="include"),y4.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function voe(s,e){return AC(s,"POST","/v2/accounts:revokeToken",v4(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CA{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){di(e.idToken,"internal-error"),di(typeof e.idToken<"u","internal-error"),di(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ON(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){di(e.length!==0,"internal-error");const t=ON(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(di(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await yoe(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,a=new CA;return n&&(di(typeof n=="string","internal-error",{appName:e}),a.refreshToken=n),i&&(di(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),r&&(di(typeof r=="number","internal-error",{appName:e}),a.expirationTime=r),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new CA,this.toJSON())}_performRefresh(){return vv("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hf(s,e){di(typeof s=="string"||typeof s>"u","internal-error",{appName:e})}class yu{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=d4(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new moe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new oR(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await aR(this,this.stsTokenManager.getToken(this.auth,e));return di(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return doe(this,e)}reload(){return goe(this)}_assign(e){this!==e&&(di(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new yu(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){di(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await uT(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(iA(this.auth.app))return Promise.reject(nb(this.auth));const e=await this.getIdToken();return await aR(this,foe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,a,o,l,c,h;const f=(n=t.displayName)!==null&&n!==void 0?n:void 0,p=(i=t.email)!==null&&i!==void 0?i:void 0,g=(r=t.phoneNumber)!==null&&r!==void 0?r:void 0,y=(a=t.photoURL)!==null&&a!==void 0?a:void 0,x=(o=t.tenantId)!==null&&o!==void 0?o:void 0,E=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,_=(c=t.createdAt)!==null&&c!==void 0?c:void 0,b=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:C,emailVerified:I,isAnonymous:M,providerData:R,stsTokenManager:D}=t;di(C&&D,e,"internal-error");const P=CA.fromJSON(this.name,D);di(typeof C=="string",e,"internal-error"),Hf(f,e.name),Hf(p,e.name),di(typeof I=="boolean",e,"internal-error"),di(typeof M=="boolean",e,"internal-error"),Hf(g,e.name),Hf(y,e.name),Hf(x,e.name),Hf(E,e.name),Hf(_,e.name),Hf(b,e.name);const L=new yu({uid:C,auth:e,email:p,emailVerified:I,displayName:f,isAnonymous:M,photoURL:y,phoneNumber:g,tenantId:x,stsTokenManager:P,createdAt:_,lastLoginAt:b});return R&&Array.isArray(R)&&(L.providerData=R.map(O=>Object.assign({},O))),E&&(L._redirectEventId=E),L}static async _fromIdTokenResponse(e,t,n=!1){const i=new CA;i.updateFromServerResponse(t);const r=new yu({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await uT(r),r}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];di(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?S4(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!r?.length,o=new CA;o.updateFromIdToken(n);const l=new yu({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:a}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new oR(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!r?.length};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PN=new Map;function Zp(s){lT(s instanceof Function,"Expected a class definition");let e=PN.get(s);return e?(lT(e instanceof s,"Instance stored in cache mismatched with class"),e):(e=new s,PN.set(s,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b4{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}b4.type="NONE";const NN=b4;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vM(s,e,t){return`firebase:${s}:${e}:${t}`}class IA{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=vM(this.userKey,i.apiKey,r),this.fullPersistenceKey=vM("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await cT(this.auth,{idToken:e}).catch(()=>{});return t?yu._fromGetAccountInfoResponse(this.auth,t,e):null}return yu._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new IA(Zp(NN),e,n);const i=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let r=i[0]||Zp(NN);const a=vM(n,e.config.apiKey,e.name);let o=null;for(const c of t)try{const h=await c._get(a);if(h){let f;if(typeof h=="string"){const p=await cT(e,{idToken:h}).catch(()=>{});if(!p)break;f=await yu._fromGetAccountInfoResponse(e,p,h)}else f=yu._fromJSON(e,h);c!==r&&(o=f),r=c;break}}catch{}const l=i.filter(c=>c._shouldAllowMigration);return!r._shouldAllowMigration||!l.length?new IA(r,e,n):(r=l[0],o&&await r._set(a,o.toJSON()),await Promise.all(t.map(async c=>{if(c!==r)try{await c._remove(a)}catch{}})),new IA(r,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FN(s){const e=s.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Soe(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Eoe(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Toe(e))return"Blackberry";if(Coe(e))return"Webos";if(xoe(e))return"Safari";if((e.includes("chrome/")||_oe(e))&&!e.includes("edge/"))return"Chrome";if(boe(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=s.match(t);if(n?.length===2)return n[1]}return"Other"}function Eoe(s=Mu()){return/firefox\//i.test(s)}function xoe(s=Mu()){const e=s.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function _oe(s=Mu()){return/crios\//i.test(s)}function Soe(s=Mu()){return/iemobile/i.test(s)}function boe(s=Mu()){return/android/i.test(s)}function Toe(s=Mu()){return/blackberry/i.test(s)}function Coe(s=Mu()){return/webos/i.test(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T4(s,e=[]){let t;switch(s){case"Browser":t=FN(Mu());break;case"Worker":t=`${FN(Mu())}-${s}`;break;default:t=s}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${iD}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ioe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=r=>new Promise((a,o)=>{try{const l=e(r);a(l)}catch(l){o(l)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Moe(s,e={}){return AC(s,"GET","/v2/passwordPolicy",v4(s,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const woe=6;class Roe{constructor(e){var t,n,i,r;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:woe,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,r,a,o;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(n=l.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(i=l.containsLowercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(r=l.containsUppercaseLetter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(a=l.containsNumericCharacter)!==null&&a!==void 0?a:!0),l.isValid&&(l.isValid=(o=l.containsNonAlphanumericCharacter)!==null&&o!==void 0?o:!0),l}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Boe{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new UN(this),this.idTokenSubscription=new UN(this),this.beforeStateQueue=new Ioe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=m4,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Zp(t)),this._initializationPromise=this.queue(async()=>{var n,i,r;if(!this._deleted&&(this.persistenceManager=await IA.create(this,e),(n=this._resolvePersistenceManagerAvailable)===null||n===void 0||n.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await cT(this,{idToken:e}),n=await yu._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(iA(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,o=i?._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===o)&&l?.user&&(i=l.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return di(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await uT(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=aoe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(iA(this.app))return Promise.reject(nb(this));const t=e?gC(e):null;return t&&di(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&di(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return iA(this.app)?Promise.reject(nb(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return iA(this.app)?Promise.reject(nb(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Zp(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Moe(this),t=new Roe(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new DE("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await voe(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Zp(e)||this._popupRedirectResolver;di(t,this,"argument-error"),this.redirectPersistenceManager=await IA.create(this,[Zp(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r=typeof t=="function"?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(di(o,this,"internal-error"),o.then(()=>{a||r(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,n,i);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return di(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=T4(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(iA(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&ioe(`Error while retrieving App Check token: ${t.error}`),t?.token}}function Doe(s){return gC(s)}class UN{constructor(e){this.auth=e,this.observer=null,this.addObserver=Kre(t=>this.observer=t)}get next(){return di(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Loe(s,e){const t=e?.persistence||[],n=(Array.isArray(t)?t:[t]).map(Zp);e?.errorMap&&s._updateErrorMap(e.errorMap),s._initializeWithPersistence(n,e?.popupRedirectResolver)}new LE(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new LE(2e3,1e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new LE(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new LE(5e3,15e3);var kN="@firebase/auth",GN="1.10.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ooe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){di(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Poe(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Noe(s){Jv(new $v("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;di(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const l={apiKey:a,authDomain:o,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:T4(s)},c=new Boe(n,i,r,l);return Loe(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Jv(new $v("auth-internal",e=>{const t=Doe(e.getProvider("auth").getImmediate());return(n=>new Ooe(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),TA(kN,GN,Poe(s)),TA(kN,GN,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Foe=300;Fre("authIdTokenMaxAge");Noe("Browser");function Yy(s){return`${Number((s*100).toFixed(3))}%`}function C4({text:s,durationMs:e=8e3,fragments:t=80,treadHalfRem:n=8,treadRadiusRem:i=2,sizeEm:r=20,fontSizeEm:a=3,className:o,style:l}){const c=ee.useMemo(()=>`tot-${Math.random().toString(36).slice(2,9)}`,[]),h=ee.useMemo(()=>{const x=n,E=i,_=2*Math.PI*E,b=x*4+_;return{treadHalf:x,treadRadius:E,treadCircle:_,treadLength:b}},[n,i]),f=ee.useMemo(()=>h.treadLength/t,[h.treadLength,t]),p=ee.useMemo(()=>{const x=c,{treadHalf:E,treadRadius:_,treadCircle:b,treadLength:C}=h,I=Yy(E/C),M=Yy((E+b*.5)/C),R=Yy((E*2+b*.5)/C),D=Yy((E*3+b*.5)/C),P=Yy((E*3+b)/C);return`
@keyframes letter-tread-back-${x} {
  from { transform: translate(-50%, -50%) translateX(0) rotateY(0) translateZ(-${_}rem); }
  ${I} { transform: translate(-50%, -50%) translateX(${E}rem) rotateY(0) translateZ(-${_}rem); }
  ${M} { transform: translate(-50%, -50%) translateX(${E}rem) rotateY(-180deg) translateZ(-${_}rem); }
  ${R} { transform: translate(-50%, -50%) translateX(0) rotateY(-180deg) translateZ(-${_}rem); }
  ${D} { transform: translate(-50%, -50%) translateX(-${E}rem) rotateY(-180deg) translateZ(-${_}rem); }
  ${P} { transform: translate(-50%, -50%) translateX(-${E}rem) rotateY(-360deg) translateZ(-${_}rem); }
  to   { transform: translate(-50%, -50%) translateX(0) rotateY(-360deg) translateZ(-${_}rem); }
}
@keyframes letter-tread-front-${x} {
  from { transform: translate(-50%, -50%) translateX(0) rotateY(0) translateZ(${_}rem); }
  ${I} { transform: translate(-50%, -50%) translateX(-${E}rem) rotateY(0) translateZ(${_}rem); }
  ${M} { transform: translate(-50%, -50%) translateX(-${E}rem) rotateY(-180deg) translateZ(${_}rem); }
  ${R} { transform: translate(-50%, -50%) translateX(0) rotateY(-180deg) translateZ(${_}rem); }
  ${D} { transform: translate(-50%, -50%) translateX(${E}rem) rotateY(-180deg) translateZ(${_}rem); }
  ${P} { transform: translate(-50%, -50%) translateX(${E}rem) rotateY(-360deg) translateZ(${_}rem); }
  to   { transform: translate(-50%, -50%) translateX(0) rotateY(-360deg) translateZ(${_}rem); }
}
`},[h,c]),g=ee.useMemo(()=>{const x=c,E=`.tot-${x}`;return`
${E} { position: relative; width: ${r}em; height: ${r}em; perspective: 60rem; }
${E}__layer, ${E}__tread { position: absolute; top: 50%; left: 50%; }
${E}__layer {
  color: transparent;
  direction: ltr;
  font-size: ${a}em;
  font-weight: 900;
  line-height: 1;
  transform: translate(-50%, -50%) rotateX(45deg) rotateZ(45deg);
  transform-style: preserve-3d;
}
${E}__tread { 
  backface-visibility: hidden;
  overflow: hidden;
  height: 100%;
  transform: translate(-50%, -50%);
  transform-style: preserve-3d;
  will-change: transform;
  color: var(--back, hsl(223 90% 5%));
}
${E}__tread--back { animation-name: letter-tread-back-${x}; animation-timing-function: linear; animation-iteration-count: infinite; }
${E}__tread--front { animation-name: letter-tread-front-${x}; animation-timing-function: linear; animation-iteration-count: infinite; color: var(--front, hsl(223 90% 95%)); }
${E}__text { display: block; white-space: nowrap; transform: rotateY(180deg); will-change: transform; }
${E}__tread--front ${E}__text { transform: rotateY(0); }
`},[c,r,a]),y=ee.useMemo(()=>Array.from({length:t},(x,E)=>E),[t]);return G.jsxs("div",{className:`tot-${c}${o?` ${o}`:""}`,style:l,children:[G.jsx("style",{children:p+g}),G.jsx(HN,{uniqueId:c,text:s,fragmentsArray:y,durationMs:e,fragmentWidthRem:f,isFront:!0}),G.jsx(HN,{uniqueId:c,text:s,fragmentsArray:y,durationMs:e,fragmentWidthRem:f,isFront:!1})]})}function HN({uniqueId:s,text:e,fragmentsArray:t,durationMs:n,fragmentWidthRem:i,isFront:r}){const a=`tot-${s}`;return G.jsxs("div",{className:`${a}__layer`,"aria-hidden":!r,children:[e,t.map(o=>{const l=o/t.length,c=r?-n+(l-.5)*n:-n+l*n,h=(r?1:-1)*(o*i),f={animationName:`letter-tread-${r?"front":"back"}-${s}`,animationTimingFunction:"linear",animationIterationCount:"infinite",animationDuration:`${n}ms`,animationDelay:`${c}ms`,width:`calc(${i}rem + 1px)`},p={transform:`translateX(${h}rem)`},g={"--moveX":`${h}rem`};return G.jsx("div",{className:`${a}__tread ${a}__tread--${r?"front":"back"}`,"data-text":e,style:{...f,...g},children:G.jsx("span",{className:`${a}__text`,"aria-hidden":!0,style:p,children:e})},`${r?"front":"back"}-${o}`)})]})}const Uoe="radial-gradient(circle at 40% 30%, rgba(255,255,255,0.25) 0%, rgba(0,0,0,0.0) 60%), radial-gradient(circle at 70% 60%, rgba(255,255,255,0.15) 0%, rgba(0,0,0,0.0) 55%), radial-gradient(circle at 30% 70%, rgba(0,0,0,0.15) 0%, rgba(0,0,0,0.0) 50%)",koe="radial-gradient(circle at 50% 50%, rgba(255,255,255,0.25), rgba(0,0,0,0) 60%)",Goe="radial-gradient(circle at 50% 50%, rgba(0,0,0,0.25), rgba(0,0,0,0) 60%)";function I4({children:s,className:e,style:t,variant:n="default",speedFactor:i,saturate:r,sepia:a,hueDegrees:o,hueDurationSec:l=20,brightness:c,contrast:h,img1:f=Uoe,img2:p=koe,img3:g=Goe,beforeBlendMode:y,afterBlendMode:x,afterDirection:E,fill:_="parent"}){const b=ee.useMemo(()=>`shader-${Math.random().toString(36).slice(2,9)}`,[]),C=ee.useMemo(()=>{switch(n){case"vivid":return{speedFactor:2,saturate:16,sepia:0,hueDegrees:360,brightness:1.45,contrast:1.3,beforeBlend:"screen",afterBlend:"screen",afterDir:"normal"};case"metal":return{speedFactor:7,saturate:0,sepia:0,hueDegrees:0,brightness:1,contrast:1,beforeBlend:"luminosity",afterBlend:"color-dodge",afterDir:"normal"};case"silk":return{speedFactor:6,saturate:10,sepia:1,hueDegrees:360,brightness:1.05,contrast:1.05,beforeBlend:"multiply",afterBlend:"hard-light",afterDir:"reverse"};default:return{speedFactor:4,saturate:6,sepia:1,hueDegrees:360,brightness:1,contrast:1,beforeBlend:"hard-light",afterBlend:"lighten",afterDir:"reverse"}}},[n]),I={speedFactor:i??C.speedFactor,saturate:r??C.saturate,sepia:a??C.sepia,hueDegrees:o??C.hueDegrees,beforeBlend:y??C.beforeBlend,afterBlend:x??C.afterBlend,afterDir:E??C.afterDir,brightness:c??C.brightness,contrast:h??C.contrast},M=1*I.speedFactor,R=2.5*I.speedFactor,D=ee.useMemo(()=>{const L=`.shader-${b}`,O=`spin-${b}`,U=`hue-${b}`;return`
${L}{ position:relative; overflow:hidden; background-image: var(--img-1); background-position:center; background-size:cover; animation: ${U} ${l}s linear infinite; }
${L} > * { position:relative; z-index:3; }
${L}::before, ${L}::after{ content:''; position:absolute; inset:-100%; z-index:1; background-size:cover; aspect-ratio:1; pointer-events:none; animation: ${O} ${M}s linear infinite; }
${L}::before{ mix-blend-mode: ${I.beforeBlend}; background-image: var(--img-2); }
${L}::after{ z-index:2; mix-blend-mode: ${I.afterBlend}; background-image: var(--img-3); animation-duration: ${R}s; animation-direction: ${I.afterDir}; }
@keyframes ${O}{ to{ transform: rotate(360deg) } }
@keyframes ${U}{ from{ filter: saturate(var(--saturate)) contrast(var(--contrast)) brightness(var(--brightness)) sepia(var(--sepia)) hue-rotate(0deg) } to{ filter: saturate(var(--saturate)) contrast(var(--contrast)) brightness(var(--brightness)) sepia(var(--sepia)) hue-rotate(var(--hue)) } }
`},[b,l,M,R,I.beforeBlend,I.afterBlend,I.afterDir]),P={...t||{},"--speed-factor":I.speedFactor,"--saturate":I.saturate,"--sepia":I.sepia,"--hue":`${I.hueDegrees}deg`,"--brightness":I.brightness??1,"--contrast":I.contrast??1,"--img-1":f,"--img-2":p,"--img-3":g,width:_==="viewport"?"100vw":void 0,minHeight:_==="viewport"?"100vh":void 0};return G.jsxs("div",{className:`shader-${b}${e?` ${e}`:""}`,style:P,children:[G.jsx("style",{children:D}),s]})}function MS(s){return("00000000"+(s>>>0).toString(16)).slice(-8)}function Hoe(s,e){return s<<e|s>>>32-e}function yC(s,e,t,n,i,r){return Hoe(e+s+n+r|0,i)+t|0}function ea(s,e,t,n,i,r,a){return yC(e&t|~e&n,s,e,i,r,a)}function ta(s,e,t,n,i,r,a){return yC(e&n|t&~n,s,e,i,r,a)}function na(s,e,t,n,i,r,a){return yC(e^t^n,s,e,i,r,a)}function hl(s,e,t,n,i,r,a){return yC(t^(e|~n),s,e,i,r,a)}async function zoe(s){const e=new Uint8Array(s),t=e.length,n=t*8,i=new Uint8Array(t+9+63&-64);i.set(e),i[t]=128;const r=new DataView(i.buffer);r.setUint32(i.length-8,n>>>0,!0),r.setUint32(i.length-4,Math.floor(n/4294967296)>>>0,!0);let a=1732584193,o=4023233417,l=2562383102,c=271733878;for(let h=0;h<i.length;h+=64){const f=new Array(16);for(let E=0;E<16;E++)f[E]=r.getUint32(h+E*4,!0);let p=a,g=o,y=l,x=c;a=ea(a,o,l,c,f[0],7,-680876936),c=ea(c,a,o,l,f[1],12,-389564586),l=ea(l,c,a,o,f[2],17,606105819),o=ea(o,l,c,a,f[3],22,-1044525330),a=ea(a,o,l,c,f[4],7,-176418897),c=ea(c,a,o,l,f[5],12,1200080426),l=ea(l,c,a,o,f[6],17,-1473231341),o=ea(o,l,c,a,f[7],22,-45705983),a=ea(a,o,l,c,f[8],7,1770035416),c=ea(c,a,o,l,f[9],12,-1958414417),l=ea(l,c,a,o,f[10],17,-42063),o=ea(o,l,c,a,f[11],22,-1990404162),a=ea(a,o,l,c,f[12],7,1804603682),c=ea(c,a,o,l,f[13],12,-40341101),l=ea(l,c,a,o,f[14],17,-1502002290),o=ea(o,l,c,a,f[15],22,1236535329),a=ta(a,o,l,c,f[1],5,-165796510),c=ta(c,a,o,l,f[6],9,-1069501632),l=ta(l,c,a,o,f[11],14,643717713),o=ta(o,l,c,a,f[0],20,-373897302),a=ta(a,o,l,c,f[5],5,-701558691),c=ta(c,a,o,l,f[10],9,38016083),l=ta(l,c,a,o,f[15],14,-660478335),o=ta(o,l,c,a,f[4],20,-405537848),a=ta(a,o,l,c,f[9],5,568446438),c=ta(c,a,o,l,f[14],9,-1019803690),l=ta(l,c,a,o,f[3],14,-187363961),o=ta(o,l,c,a,f[8],20,1163531501),a=ta(a,o,l,c,f[13],5,-1444681467),c=ta(c,a,o,l,f[2],9,-51403784),l=ta(l,c,a,o,f[7],14,1735328473),o=ta(o,l,c,a,f[12],20,-1926607734),a=na(a,o,l,c,f[5],4,-378558),c=na(c,a,o,l,f[8],11,-2022574463),l=na(l,c,a,o,f[11],16,1839030562),o=na(o,l,c,a,f[14],23,-35309556),a=na(a,o,l,c,f[1],4,-1530992060),c=na(c,a,o,l,f[4],11,1272893353),l=na(l,c,a,o,f[7],16,-155497632),o=na(o,l,c,a,f[10],23,-1094730640),a=na(a,o,l,c,f[13],4,681279174),c=na(c,a,o,l,f[0],11,-358537222),l=na(l,c,a,o,f[3],16,-722521979),o=na(o,l,c,a,f[6],23,76029189),a=na(a,o,l,c,f[9],4,-640364487),c=na(c,a,o,l,f[12],11,-421815835),l=na(l,c,a,o,f[15],16,530742520),o=na(o,l,c,a,f[2],23,-995338651),a=hl(a,o,l,c,f[0],6,-198630844),c=hl(c,a,o,l,f[7],10,1126891415),l=hl(l,c,a,o,f[14],15,-1416354905),o=hl(o,l,c,a,f[5],21,-57434055),a=hl(a,o,l,c,f[12],6,1700485571),c=hl(c,a,o,l,f[3],10,-1894986606),l=hl(l,c,a,o,f[10],15,-1051523),o=hl(o,l,c,a,f[1],21,-2054922799),a=hl(a,o,l,c,f[8],6,1873313359),c=hl(c,a,o,l,f[15],10,-30611744),l=hl(l,c,a,o,f[6],15,-1560198380),o=hl(o,l,c,a,f[13],21,1309151649),a=a+p|0,o=o+g|0,l=l+y|0,c=c+x|0}return MS(a)+MS(o)+MS(l)+MS(c)}async function Qoe(s){const e=await s.arrayBuffer();return(await zoe(e)).slice(0,12)}function Voe(){const s=s0(),[e,t]=ee.useState([]),[n,i]=ee.useState(!1),[r,a]=ee.useState(!1),[o,l]=ee.useState(""),[c,h]=ee.useState(""),[f,p]=ee.useState(""),g=ee.useRef(null),y=ee.useRef(null),x=ee.useRef(null),[E,_]=ee.useState(!1);ee.useEffect(()=>{const R=new t4({basePath:"https://api.arkturian.com"});return x.current=new e4(R),()=>{}},[]),ee.useEffect(()=>{try{const R=typeof CSS<"u"&&CSS.supports("mix-blend-mode","color-dodge")&&CSS.supports("filter","hue-rotate(360deg)")&&CSS.supports("animation","name");_(!!R)}catch{_(!1)}},[]),ee.useEffect(()=>{const R=y.current;if(!R)return;const D=O=>{O.preventDefault(),R.classList.add("active")},P=()=>R.classList.remove("active"),L=O=>{O.preventDefault(),R.classList.remove("active");const U=Array.from(O.dataTransfer?.files||[]);U.length&&(t(U),I(U))};return R.addEventListener("dragover",D),R.addEventListener("dragleave",P),R.addEventListener("drop",L),()=>{R.removeEventListener("dragover",D),R.removeEventListener("dragleave",P),R.removeEventListener("drop",L)}},[]);function b(){g.current?.click()}function C(R){const D=Array.from(R.target.files||[]).filter(P=>P&&P.size>0);D.length&&(t(D),I(D))}async function I(R){const D=(R&&R.length?R:e).filter(P=>P&&P.size>0);if(!(!D.length||n)){i(!0);try{const P=x.current;if(!P)throw new Error("SDK not ready");const L=[],O=await Qoe(D[0]);for(const j of D){const{data:H}=await P.uploadFileStorageUploadPost(j,"Inetpass1",void 0,!0,f||void 0,c||void 0,O,!0);try{const k=H?.id;k&&await fetch(`https://api.arkturian.com/storage/objects/${k}`,{method:"PATCH",headers:{"X-API-KEY":"Inetpass1","Content-Type":"application/json"},body:JSON.stringify({link_id:O})})}catch{}H?.id&&L.push(H.id);const z=j.name.toLowerCase(),q=z.endsWith(".mp4")||z.endsWith(".mov")||z.endsWith(".m4v")||z.endsWith(".webm");s(q?`/share/videoshare?current_id=${H.id}`:`/share/imageshare?current_id=${H.id}`)}const U=L.length===1?`/share/videoshare?current_id=${L[0]}`:`/vod/theater?collection_id=${encodeURIComponent(c||"recent")}&from=/fieldshare`;l(U),a(!0)}catch(P){console.error(P),alert("Upload failed. Please try again.")}finally{i(!1)}}}const M=ee.useMemo(()=>e.length?`${e.length} file(s) selected`:"Drop your files here",[e]);return G.jsxs("main",{role:"main",style:{position:"relative"},children:[G.jsxs("div",{"aria-hidden":!0,style:{position:"fixed",inset:0,zIndex:0,pointerEvents:"none"},children:[E&&G.jsx(I4,{variant:"vivid",speedFactor:3,saturate:6,sepia:0,hueDegrees:360,hueDurationSec:20,fill:"viewport",style:{opacity:.6}}),G.jsx("div",{style:{position:"absolute",inset:0,display:"grid",placeItems:"center",opacity:E?.13:.18},children:G.jsx(C4,{text:"RESILIENCE",style:{perspective:"60rem","--front":"#0f172a","--back":"#94a3b8"}})})]}),G.jsx("section",{className:"section","aria-labelledby":"fsu-title",style:{position:"relative",zIndex:1},children:G.jsxs("div",{style:{padding:0},children:[G.jsxs("div",{className:"hero-section",style:{textAlign:"center",marginBottom:24},children:[G.jsx("h1",{id:"fsu-title",className:"h2",style:{margin:0},children:"Share your creation like it matters."}),G.jsx("p",{className:"muted",style:{marginTop:8},children:"Because it does."})]}),!r&&G.jsxs("div",{className:"upload-area",style:{background:"transparent",borderRadius:20,padding:24,marginBottom:24},children:[G.jsxs("div",{ref:y,className:"drop-zone",onClick:b,style:{border:"2px dashed var(--ring)",borderRadius:16,padding:32,cursor:"pointer",background:"rgba(255,255,255,0.6)",textAlign:"center",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)"},children:[G.jsx("div",{className:"upload-icon",style:{fontSize:36,opacity:.6,marginBottom:10},children:""}),G.jsx("div",{className:"upload-text",style:{fontWeight:600},children:n?"Uploading":M}),G.jsx("div",{className:"upload-subtext muted",children:"or tap to select"}),G.jsx("input",{ref:g,type:"file",multiple:!0,accept:"image/*,video/*",style:{display:"none"},onChange:C})]}),G.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12,alignItems:"center"},children:[G.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:G.jsx("span",{className:"muted",style:{fontSize:12},children:"Auth disabled"})}),G.jsx("input",{placeholder:"Collection ID (optional)",value:c,onChange:R=>h(R.target.value),className:"pill",style:{padding:10}})]}),G.jsxs("div",{className:"action-buttons",style:{display:"flex",gap:12,marginTop:16},children:[G.jsx("button",{className:"action-btn secondary pill",onClick:()=>alert("Camera access not implemented yet"),children:" Camera"}),G.jsx("button",{className:"action-btn secondary pill",onClick:()=>g.current?.click(),children:" Photos"})]})]}),r&&G.jsxs("div",{className:"success-section",style:{textAlign:"center"},children:[G.jsx("div",{className:"success-icon",style:{fontSize:48,marginBottom:12},children:""}),G.jsx("h2",{className:"success-title",style:{margin:"0 0 6px 0"},children:"Ready to share"}),G.jsx("p",{className:"success-subtitle muted",style:{margin:"0 0 16px 0"},children:"Your cinematic link is ready"}),G.jsxs("div",{className:"generated-link",style:{background:"#f8f8f8",border:"1px solid var(--ring)",borderRadius:12,padding:12,fontFamily:"var(--mono)"},children:[o||"fieldshare.app/c/your-link",G.jsx("button",{className:"pill",style:{marginLeft:8},onClick:()=>{o&&navigator.clipboard.writeText(o)},children:"Copy"})]}),G.jsxs("div",{className:"action-buttons",style:{display:"flex",gap:12,justifyContent:"center"},children:[G.jsx("button",{className:"action-btn secondary pill",onClick:()=>{o&&window.open(o,"_blank")},children:" Preview"}),G.jsx("button",{className:"action-btn primary pill",onClick:()=>{navigator.share?navigator.share({title:"FieldShare",url:o}):o&&navigator.clipboard.writeText(o)},children:" Share"})]})]})]})})]})}const joe="https://api.arkturian.com",qoe="Inetpass1";function Koe(){const[s]=LR(),e=s.get("current_id"),t=e?parseInt(e,10):void 0,[n,i]=ee.useState(null),[r,a]=ee.useState(null),[o,l]=ee.useState(!0),c=ee.useRef(null),[h,f]=ee.useState(!1),[p,g]=ee.useState(!0),[y,x]=ee.useState(0),[E,_]=ee.useState(0);ee.useEffect(()=>{(async()=>{try{if(!t){a("Missing current_id");return}const I=await fetch(`${joe}/storage/objects/${t}`,{headers:{"X-API-KEY":qoe}});if(!I.ok)throw new Error("load failed");const M=await I.json();i(M)}catch{a("Could not load shared item.")}finally{l(!1)}})()},[t]);const b=ee.useMemo(()=>n?.title||n?.original_filename||"",[n]);if(o)return G.jsx("main",{role:"main",children:G.jsx("section",{className:"section",children:G.jsx("p",{className:"muted",children:"Loading"})})});if(r||!n)return G.jsx("main",{role:"main",children:G.jsxs("section",{className:"section",children:[G.jsx("p",{className:"muted",style:{color:"crimson"},children:r||"Not found"}),G.jsx(Yf,{className:"pill",to:"/fieldshare",children:"Back"})]})});const C=!!n.hls_url;return G.jsx("main",{role:"main",children:G.jsx("section",{className:"section section-full","aria-labelledby":"share-title",children:G.jsxs("div",{className:"card",style:{padding:24},children:[G.jsx("h2",{id:"share-title",className:"h2",style:{marginTop:0},children:b}),C?G.jsxs("div",{style:{position:"relative",width:"100%",height:"60vh",marginTop:12},children:[G.jsx(xu,{ref:c,src:n.hls_url,autoplay:!0,muted:h,loop:!1,scaleMode:p?"fit":"fill",fullscreenScaleMode:p?"fit":"fill",onTimeUpdate:(I,M)=>{x(I),_(M||0)}}),G.jsxs("div",{style:{position:"absolute",inset:0,pointerEvents:"none"},children:[G.jsxs("div",{style:{position:"absolute",top:12,right:12,display:"flex",gap:8},children:[G.jsx("button",{className:"pill",style:{pointerEvents:"auto"},onClick:()=>g(I=>!I),children:p?"Fit":"Fill"}),G.jsx("button",{className:"pill",style:{pointerEvents:"auto"},onClick:()=>f(I=>!I),children:h?"Unmute":"Mute"})]}),G.jsx("div",{style:{position:"absolute",bottom:18,left:"2%",right:"2%",height:6,background:"rgba(0,0,0,0.2)",borderRadius:3},onClick:I=>{const M=I.currentTarget.getBoundingClientRect(),R=(I.clientX-M.left)/M.width;E&&c.current&&c.current.setCurrentTime(R*E)},children:G.jsx("div",{style:{width:`${E?y/E*100:0}%`,height:"100%",background:"var(--brand-2)",borderRadius:3}})})]})]}):G.jsx("div",{className:"card",style:{marginTop:12},children:G.jsx("div",{className:"muted",children:"Preview coming soon for this file type."})}),G.jsxs("div",{className:"card",style:{marginTop:12,display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[n.file_url&&G.jsx("a",{className:"pill",href:n.file_url,download:!0,children:" Download Original"}),G.jsx(Yf,{className:"pill",to:"/fieldshare",children:"Back"})]})]})})})}const EM="https://api.arkturian.com",xM="Inetpass1";function Yoe(){const[s]=LR(),e=s.get("current_id"),t=e?parseInt(e,10):void 0,[n,i]=ee.useState(null),[r,a]=ee.useState(null),[o,l]=ee.useState(!0),[c,h]=ee.useState(!1),[f,p]=ee.useState(!0),[g,y]=ee.useState(0),[x,E]=ee.useState(0),[_,b]=ee.useState(0),C=ee.useRef(null),[I,M]=ee.useState(!0),R=ee.useRef(null);ee.useEffect(()=>{(async()=>{try{if(!t){a("Missing current_id");return}const O=await fetch(`${EM}/storage/objects/${t}`,{headers:{"X-API-KEY":xM}});if(!O.ok)throw new Error("load failed");const U=await O.json();i(U),y(U.likes??0)}catch{a("Could not load video.")}finally{l(!1)}})()},[t]),ee.useEffect(()=>{if(!t)return;let O=0;const U=window.setInterval(async()=>{O+=1;try{const j=await fetch(`${EM}/storage/objects/${t}`,{headers:{"X-API-KEY":xM}});if(!j.ok)return;const H=await j.json();i(z=>z?H.title&&H.title!==z.title||H.description&&H.description!==z.description?{...z,title:H.title??z.title,description:H.description??z.description}:z:H)}catch{}O>=6&&window.clearInterval(U)},5e3);return()=>window.clearInterval(U)},[t]);async function D(){if(!(!n||n.id<0))try{const O=await fetch(`${EM}/storage/objects/${n.id}/like`,{method:"POST",headers:{"X-API-KEY":xM}});if(!O.ok)throw new Error("like failed");const U=await O.json();y(U.likes??0)}catch(O){console.error(O)}}const P=ee.useMemo(()=>n?.title||n?.original_filename||"",[n]),L=ee.useMemo(()=>n?.description||"",[n]);return o?G.jsx("main",{role:"main",children:G.jsx("section",{className:"section",children:G.jsx("p",{className:"muted",children:"Loading"})})}):r||!n||!n.hls_url?G.jsx("main",{role:"main",children:G.jsx("section",{className:"section",children:G.jsx("p",{className:"muted",style:{color:"crimson"},children:r||"Not found"})})}):G.jsx("main",{role:"main",onMouseMove:()=>{M(!0),R.current&&window.clearTimeout(R.current),R.current=window.setTimeout(()=>M(!1),2500)},children:G.jsx("section",{className:"section section-full","aria-labelledby":"videoshare-title",style:{padding:0},children:G.jsxs("div",{style:{position:"relative",width:"100%",height:"100vh"},children:[G.jsx(xu,{ref:C,src:n.hls_url,autoplay:!0,muted:c,loop:!1,scaleMode:f?"fit":"fill",fullscreenScaleMode:f?"fit":"fill",onTimeUpdate:(O,U)=>{E(O),b(U||0)}}),G.jsxs("div",{style:{position:"absolute",inset:0,pointerEvents:"none",opacity:I?1:0,transition:"opacity .25s"},children:[G.jsxs("div",{style:{position:"absolute",top:12,right:12,display:"flex",gap:8},children:[G.jsx("button",{className:"pill",style:{pointerEvents:"auto",background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"var(--text)"},onClick:()=>p(O=>!O),children:f?"Fit":"Fill"}),G.jsx("button",{className:"pill",style:{pointerEvents:"auto",background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"var(--text)"},onClick:()=>h(O=>!O),children:c?"Unmute":"Mute"}),G.jsx("a",{className:"pill",style:{pointerEvents:"auto",background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"var(--text)"},href:n.file_url||"#",download:!0,children:" Download"})]}),G.jsx("div",{style:{position:"absolute",bottom:18,left:"2%",right:"2%",height:6,background:"rgba(255,255,255,0.3)",borderRadius:3,pointerEvents:"auto",cursor:"pointer"},onClick:O=>{const U=O.currentTarget.getBoundingClientRect(),j=(O.clientX-U.left)/U.width;_&&C.current&&C.current.setCurrentTime(j*_)},children:G.jsx("div",{style:{width:`${_?x/_*100:0}%`,height:"100%",background:"var(--brand-2)",borderRadius:3}})}),G.jsx("div",{style:{position:"absolute",bottom:60,left:"15%",maxWidth:640,pointerEvents:"none"},children:G.jsxs("div",{style:{background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",padding:"12px 14px",color:"var(--text)"},children:[G.jsx("div",{style:{fontWeight:700,marginBottom:6},children:P}),L&&G.jsx("div",{className:"muted",style:{margin:0},children:L})]})}),G.jsx("div",{style:{position:"absolute",bottom:18,right:18},children:G.jsxs("button",{className:"pill",style:{pointerEvents:"auto",background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"var(--text)"},onClick:D,children:[" ",g]})})]})]})})})}function Xoe({src:s,title:e,artist:t,size:n=520}){const i=ee.useRef(null),r=ee.useRef(null),a=ee.useRef(null),o=ee.useRef(null),l=ee.useRef(null),c=ee.useRef(null),[h,f]=ee.useState(!1),[p,g]=ee.useState("00:00"),y=typeof window<"u"&&window.devicePixelRatio||1,x=ee.useMemo(()=>({outerRadius:n*.46,innerRadius:n*.38,ringWidth:2,tickCount:180}),[n]);ee.useEffect(()=>{const I=i.current;if(!I)return;const M=I.getContext("2d"),R=n,D=n;I.width=Math.floor(R*y),I.height=Math.floor(D*y),I.style.width=R+"px",I.style.height=D+"px",M.scale(y,y)},[n,y]);function E(I){const M=Math.floor(I),R=Math.floor(M/60),D=M%60;return`${R.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}`}function _(){const I=i.current,M=I?.getContext("2d"),R=o.current;if(!I||!M)return;M.clearRect(0,0,n,n);const D=n/2,P=n/2;if(M.save(),M.strokeStyle="rgba(254,67,101,0.4)",M.lineWidth=x.ringWidth,M.beginPath(),M.arc(D,P,x.innerRadius,0,Math.PI*2),M.stroke(),M.beginPath(),M.arc(D,P,x.outerRadius,0,Math.PI*2),M.stroke(),M.restore(),R){const O=new Uint8Array(256);R.getByteFrequencyData(O);const U=x.tickCount;for(let j=0;j<U;j++){const H=j/U*Math.PI*2,z=Math.cos(H),q=Math.sin(H),W=6+O[Math.floor(j/U*256)]/255*34,V=D+z*(x.outerRadius-W),X=P+q*(x.outerRadius-W),K=D+z*x.outerRadius,te=P+q*x.outerRadius,oe=M.createLinearGradient(V,X,K,te);oe.addColorStop(0,"#FE4365"),oe.addColorStop(1,"rgba(255,255,255,0.9)"),M.strokeStyle=oe,M.lineWidth=2,M.beginPath(),M.moveTo(V,X),M.lineTo(K,te),M.stroke()}}else M.save(),M.strokeStyle="rgba(254,67,101,0.7)",M.setLineDash([2,6]),M.lineWidth=2,M.beginPath(),M.arc(D,P,x.outerRadius,0,Math.PI*2),M.stroke(),M.restore();c.current=requestAnimationFrame(_)}async function b(){if(a.current)return;const I=new(window.AudioContext||window.webkitAudioContext),M=r.current,R=I.createMediaElementSource(M),D=I.createAnalyser();D.fftSize=512,D.smoothingTimeConstant=.8,R.connect(D),D.connect(I.destination),a.current=I,l.current=R,o.current=D}async function C(){const I=r.current;a.current||await b(),I.paused?(await I.play(),f(!0)):(I.pause(),f(!1))}return ee.useEffect(()=>{const I=r.current;if(!I)return;const M=()=>g(E(I.currentTime||0));return I.addEventListener("timeupdate",M),()=>I.removeEventListener("timeupdate",M)},[]),ee.useEffect(()=>(c.current=requestAnimationFrame(_),()=>{c.current&&cancelAnimationFrame(c.current),a.current?.close().catch(()=>{})}),[]),G.jsxs("div",{style:{position:"relative",width:n,height:n,display:"grid",placeItems:"center"},children:[G.jsx("canvas",{ref:i}),G.jsx("div",{style:{position:"absolute",inset:0,display:"grid",placeItems:"center",pointerEvents:"none"},children:G.jsxs("div",{style:{textAlign:"center",color:"#FE4365",fontFamily:"Roboto, system-ui, -apple-system, Segoe UI, sans-serif",pointerEvents:"auto"},children:[(t||e)&&G.jsxs("div",{style:{marginBottom:18},children:[t&&G.jsx("div",{style:{fontSize:22,marginBottom:6},children:t}),e&&G.jsx("div",{style:{fontSize:18},children:e})]}),G.jsx("button",{onClick:C,className:"pill",style:{width:120,height:120,borderRadius:120,border:"3px solid #FE4365",background:"transparent",color:"#FE4365",fontSize:18},children:h?"Pause":"Play"}),G.jsx("div",{style:{marginTop:16,color:"#FE4365"},children:p})]})}),G.jsx("audio",{ref:r,src:s,preload:"auto"})]})}function zN({id:s,title:e,description:t,downloadHref:n,shareUrl:i,likeCount:r,onLike:a,onDelete:o,onTitleChange:l,onDescriptionChange:c,onSelect:h}){const f=!!e,p=!!t;return G.jsxs("div",{"data-id":s,onClick:h,style:{background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",padding:"12px 14px"},children:[f&&G.jsx("div",{style:{fontWeight:700,marginBottom:10,fontSize:"1.15rem",outline:"none"},contentEditable:!0,suppressContentEditableWarning:!0,onMouseDown:g=>g.stopPropagation(),onBlur:g=>l?.(g.currentTarget.textContent||""),children:e}),p&&G.jsx("div",{className:"muted",style:{margin:0,color:"#fff",fontSize:".9rem",outline:"none"},contentEditable:!0,suppressContentEditableWarning:!0,onMouseDown:g=>g.stopPropagation(),onBlur:g=>c?.(g.currentTarget.textContent||""),children:t}),G.jsxs("div",{style:{position:"relative",display:"flex",gap:12,marginTop:14,flexWrap:"wrap",alignItems:"center"},children:[G.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[G.jsxs("button",{className:"pill",style:{background:"transparent",border:"1px solid var(--ring)",borderRadius:12,color:"#fff"},onClick:g=>{g.stopPropagation(),a()},children:[" ",typeof r=="number"?r:0]}),n&&G.jsx("a",{className:"pill",style:{background:"transparent",border:"1px solid var(--ring)",borderRadius:12,color:"#fff"},href:n,download:!0,onClick:g=>g.stopPropagation(),children:" Download"}),G.jsx("button",{className:"pill",style:{background:"transparent",border:"1px solid var(--ring)",borderRadius:12,color:"#fff"},onClick:g=>{g.stopPropagation(),navigator.share?navigator.share({url:i}):navigator.clipboard.writeText(i)},children:"Share"}),G.jsx("button",{className:"pill",title:"Delete",style:{background:"transparent",border:"1px solid var(--ring)",borderRadius:12,color:"#fff"},onClick:g=>{g.stopPropagation(),o()},children:""})]}),G.jsx("div",{style:{flex:1}})]})]})}const qa="https://api.arkturian.com",Ka="Inetpass1";function Woe(){const[s]=LR(),e=s.get("current_id"),t=e?parseInt(e,10):void 0,[n,i]=ee.useState(null),[r,a]=ee.useState(null),[o,l]=ee.useState(!0),[c,h]=ee.useState(!1),[f,p]=ee.useState(0),[g,y]=ee.useState(""),[x,E]=ee.useState(""),[_,b]=ee.useState(null),[C,I]=ee.useState([]),[M,R]=ee.useState(null),[D,P]=ee.useState(0),[L,O]=ee.useState(null),U=ee.useRef(null),j=ee.useRef(null),H=ee.useRef(null),[z,q]=ee.useState(!1),[k,W]=ee.useState(!1),V=ee.useRef(null),X=ee.useRef(null),K=ee.useRef([]),te=ee.useRef(null),oe=ee.useRef(null),Ee=ee.useRef(null),[,Ce]=ee.useState(0);ee.useEffect(()=>{(async()=>{try{if(!t){a("Missing current_id");return}const ve=await fetch(`${qa}/storage/objects/${t}`,{headers:{"X-API-KEY":Ka}});if(!ve.ok)throw new Error("load failed");const Ae=await ve.json();i(Ae),R(Ae.id),y(Ae.title||""),E(Ae.description||"");const Se=Ae;Se&&typeof Se.link_id=="string"&&O(Se.link_id)}catch{a("Could not load image.")}finally{l(!1)}})()},[t]),ee.useEffect(()=>{if(!t)return;let ve=0;const Ae=window.setInterval(async()=>{ve+=1;try{const Se=await fetch(`${qa}/storage/objects/${t}`,{headers:{"X-API-KEY":Ka}});if(!Se.ok)return;const be=await Se.json();i(me=>me?be.title&&be.title!==me.title||be.description&&be.description!==me.description?{...me,title:be.title??me.title,description:be.description??me.description}:me:be),be.title&&y(be.title),be.description&&E(be.description);const Re=be;Re&&Re.link_id&&!L&&O(Re.link_id)}catch{}ve>=6&&window.clearInterval(Ae)},5e3);return()=>window.clearInterval(Ae)},[t,L]),ee.useEffect(()=>{(async()=>{if(L)try{const ve=await fetch(`${qa}/storage/list?link_id=${encodeURIComponent(L)}`,{headers:{"X-API-KEY":Ka}});if(!ve.ok)return;const be=((await ve.json()).items||[]).filter(me=>me.id!==n?.id);I(be);const Re=be.find(me=>me.mime_type&&me.mime_type.startsWith("audio/")||me.original_filename&&/\.(mp3|wav|m4a|ogg|weba)$/i.test(me.original_filename));Re&&Re.file_url&&b(Re.file_url)}catch{}})()},[L]),ee.useEffect(()=>{if(!L)return;let ve=0;const Ae=window.setInterval(async()=>{ve+=1;try{const Se=await fetch(`${qa}/storage/list?link_id=${encodeURIComponent(L)}`,{headers:{"X-API-KEY":Ka}});if(!Se.ok)return;const me=((await Se.json()).items||[]).filter($e=>$e.id!==n?.id);I(me);const ue=me.find($e=>$e.mime_type&&$e.mime_type.startsWith("audio/")||$e.original_filename&&/\.(mp3|wav|m4a|ogg|weba)$/i.test($e.original_filename||""));ue&&ue.file_url&&b(ue.file_url)}catch{}ve>=6&&window.clearInterval(Ae)},5e3);return()=>window.clearInterval(Ae)},[L,n?.id]);const se=ee.useMemo(()=>(n?[n,...C]:[...C]).filter(Ae=>!!Ae&&(!!Ae.mime_type||!!Ae.hls_url)&&(Ae.mime_type?.startsWith("image/")||Ae.mime_type?.startsWith("video/")||Ae.hls_url)),[n,C]);ee.useEffect(()=>{if(!n)return;let ve=!1,Ae=null;const Se=()=>{if(ve||se.length<=1)return;const Re=(se.findIndex($e=>$e.id===M)+1)%se.length,me=se[Re];!!(me.mime_type&&me.mime_type.startsWith("video/"))||(R(me.id),P($e=>$e+1))};return Ae=window.setInterval(Se,5e3),()=>{Ae&&window.clearInterval(Ae),ve=!0}},[n,se,M]);async function ie(ve){if(!(!ve||ve<0))try{const Ae=await fetch(`${qa}/storage/objects/${ve}/like`,{method:"POST",headers:{"X-API-KEY":Ka}});if(!Ae.ok)throw new Error("like failed");if(n&&ve===n.id){const Se=await Ae.json();p(Se.likes??f+1)}}catch(Ae){console.error(Ae)}}async function ne(ve){try{if(!ve||ve.size===0)return;H.current||(H.current=new e4(new t4({basePath:qa})));let Ae=L||String(n?.id||Date.now());if(!L&&n?.id)try{await fetch(`${qa}/storage/objects/${n.id}`,{method:"PATCH",headers:{"X-API-KEY":Ka,"Content-Type":"application/json"},body:JSON.stringify({link_id:Ae})}),O(Ae)}catch{}const{data:Se}=await H.current.uploadFileStorageUploadPost(ve,Ka,void 0,!0,void 0,n?.collection_id||void 0,Ae,!0);try{const be=Se?.id;be&&await fetch(`${qa}/storage/objects/${be}`,{method:"PATCH",headers:{"X-API-KEY":Ka,"Content-Type":"application/json"},body:JSON.stringify({link_id:Ae})})}catch{}q(!1);try{if(Ae){const be=await fetch(`${qa}/storage/list?link_id=${encodeURIComponent(Ae)}`,{headers:{"X-API-KEY":Ka}});if(be.ok){const ue=((await be.json()).items||[]).filter(gt=>gt.id!==n?.id);I(ue);const $e=ue.find(gt=>gt.mime_type&&gt.mime_type.startsWith("audio/")||gt.original_filename&&/\.(mp3|wav|m4a|ogg|weba)$/i.test(gt.original_filename));$e&&$e.file_url&&b($e.file_url)}}}catch{}}catch(Ae){console.error(Ae)}}async function re(ve){try{if(!window.confirm("Delete this item?"))return;if(!(await fetch(`${qa}/storage/${ve}`,{method:"DELETE",headers:{"X-API-KEY":Ka}})).ok){alert("Failed to delete");return}n&&ve===n.id&&a("Deleted"),I(be=>be.filter(Re=>Re.id!==ve)),b(be=>C.some(me=>me.mime_type&&me.mime_type.startsWith("audio/")||me.original_filename&&/\.(mp3|wav|m4a|ogg|weba)$/i.test(me.original_filename))?be:null)}catch(Ae){console.error(Ae)}}function Be(ve){const Ae=ve.target.files?.[0];Ae&&Ae.size>0&&ne(Ae),ve.target.value=""}function Ge(ve){const Ae=ve.target.files?.[0];Ae&&Ae.size>0&&ne(Ae),ve.target.value=""}const Ue=ee.useRef(0);async function nt(){try{const ve=await navigator.mediaDevices.getUserMedia({audio:!0});V.current=ve;try{const Re=new(window.AudioContext||window.webkitAudioContext);te.current=Re;const me=Re.createMediaStreamSource(ve),ue=Re.createAnalyser();ue.fftSize=2048,ue.smoothingTimeConstant=.8,me.connect(ue),oe.current=ue;const $e=new Uint8Array(ue.frequencyBinCount),gt=()=>{ue.getByteTimeDomainData($e);let ge=0;for(let Pe=0;Pe<$e.length;Pe++){const Ve=($e[Pe]-128)/128;ge+=Ve*Ve}const ae=Math.sqrt(ge/$e.length);Ce(Math.min(1,ae*2)),Ee.current=requestAnimationFrame(gt)};Ee.current=requestAnimationFrame(gt)}catch(Re){console.warn("Audio meter unavailable",Re)}let Ae;const Se=["audio/webm;codecs=opus","audio/webm","audio/mp4;codecs=mp4a.40.2","audio/mp4"];for(const Re of Se)if(window.MediaRecorder&&window.MediaRecorder.isTypeSupported&&window.MediaRecorder.isTypeSupported(Re)){Ae=Re;break}const be=new MediaRecorder(ve,Ae?{mimeType:Ae}:void 0);K.current=[],be.ondataavailable=Re=>{Re.data&&Re.data.size>0&&K.current.push(Re.data)},be.onstop=async()=>{try{const Re=Date.now()-(Ue.current||Date.now()),me=new Blob(K.current,{type:be.mimeType||Ae||"audio/webm"});if(me.size===0||Re<400)alert("No audio captured. Please press Record and speak for a moment.");else{const ue=me.type.includes("mp4")?"m4a":"webm",$e=new File([me],`recording_${Date.now()}.${ue}`,{type:me.type});try{const gt=URL.createObjectURL(me);b(gt)}catch{}await ne($e)}}catch(Re){console.error(Re)}finally{W(!1);try{V.current?.getTracks().forEach(Re=>Re.stop())}catch{}V.current=null,X.current=null,Ee.current&&(cancelAnimationFrame(Ee.current),Ee.current=null);try{await te.current?.close()}catch{}te.current=null,oe.current=null,Ce(0)}},X.current=be,be.start(250),Ue.current=Date.now(),W(!0)}catch(ve){console.error("Mic access failed",ve)}}function pe(){try{X.current?.stop()}catch(ve){console.error(ve)}}return o?G.jsx("main",{role:"main",children:G.jsx("section",{className:"section",children:G.jsx("p",{className:"muted",children:"Loading"})})}):r||!n||!n.file_url?G.jsx("main",{role:"main",children:G.jsx("section",{className:"section",children:G.jsx("p",{className:"muted",style:{color:"crimson"},children:r||"Not found"})})}):n.ai_safety_rating==="unsafe"||n.ai_safety_status==="failed"?G.jsx("main",{role:"main",children:G.jsx("section",{className:"section",children:G.jsxs("div",{className:"card",style:{padding:16},children:[G.jsx("h2",{className:"h2",style:{marginTop:0},children:"Content not allowed"}),G.jsx("p",{className:"muted",children:"This image failed our safety policy checks and cannot be displayed."})]})})}):G.jsx("main",{role:"main",children:G.jsx("section",{className:"section section-full","aria-labelledby":"imageshare-title",style:{padding:0},children:G.jsxs("div",{style:{position:"relative",width:"100%",height:"100vh",background:"#000"},children:[se.map(ve=>!!(ve.mime_type&&ve.mime_type.startsWith("video/"))||!!ve.hls_url?G.jsx("div",{style:{position:"absolute",inset:0,opacity:ve.id===M?1:0,transition:"opacity 800ms ease-in-out"},children:G.jsx(xu,{src:ve.hls_url||ve.file_url||"",autoplay:!0,muted:!1,scaleMode:c?"fit":"fill",onPlayChange:()=>{},onTimeUpdate:()=>{},onError:()=>{},onMetadata:()=>{}})},`vid-${ve.id}-${D}`):G.jsx("img",{src:ve.file_url,alt:ve.title||"",style:{position:"absolute",inset:0,width:"100%",height:"100%",objectFit:c?"contain":"cover",opacity:ve.id===M?1:0,transition:"opacity 800ms ease-in-out"}},`img-${ve.id}-${D}`)),_&&G.jsx("div",{style:{position:"absolute",inset:0,display:"grid",placeItems:"center",pointerEvents:"none"},children:G.jsx("div",{style:{pointerEvents:"auto"},children:G.jsx(Xoe,{src:_,title:g,artist:void 0,size:420})})}),G.jsxs("div",{style:{position:"absolute",inset:0,pointerEvents:"none"},children:[G.jsx("div",{style:{position:"absolute",top:12,right:12,display:"flex",gap:8},children:G.jsx("button",{className:"pill",style:{pointerEvents:"auto",background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",color:"#fff"},onClick:()=>h(ve=>!ve),children:c?"Fit":"Fill"})}),G.jsxs("div",{style:{position:"absolute",bottom:60,left:"5%",pointerEvents:"auto",display:"flex",gap:12,alignItems:"flex-end"},children:[G.jsx("div",{style:{color:"#fff",maxWidth:640},children:G.jsx(zN,{id:n.id,title:g,description:x,downloadHref:n.file_url,shareUrl:window.location.href,likeCount:f,onLike:()=>ie(n.id),onDelete:()=>re(n.id),onSelect:()=>R(n.id),onTitleChange:ve=>{y(ve),fetch(`${qa}/storage/objects/${n.id}`,{method:"PATCH",headers:{"X-API-KEY":Ka,"Content-Type":"application/json"},body:JSON.stringify({title:ve})}).catch(()=>{})},onDescriptionChange:ve=>{E(ve),fetch(`${qa}/storage/objects/${n.id}`,{method:"PATCH",headers:{"X-API-KEY":Ka,"Content-Type":"application/json"},body:JSON.stringify({description:ve})}).catch(()=>{})}})}),C.map(ve=>{const Ae=ve.mime_type&&ve.mime_type.startsWith("audio/")||ve.original_filename&&/(\.mp3|\.wav|\.m4a|\.ogg|\.weba)$/i.test(ve.original_filename||"");return G.jsx("div",{style:{color:"#fff",maxWidth:420},children:G.jsx(zN,{id:ve.id,title:ve.title||(Ae?"Audio":void 0),description:ve.description,downloadHref:ve.file_url,shareUrl:`${window.location.origin}${window.location.pathname}?current_id=${ve.id}`,likeCount:void 0,onLike:()=>ie(ve.id),onDelete:()=>re(ve.id),onSelect:()=>R(ve.id),onTitleChange:Se=>{fetch(`${qa}/storage/objects/${ve.id}`,{method:"PATCH",headers:{"X-API-KEY":Ka,"Content-Type":"application/json"},body:JSON.stringify({title:Se})}).catch(()=>{})},onDescriptionChange:Se=>{fetch(`${qa}/storage/objects/${ve.id}`,{method:"PATCH",headers:{"X-API-KEY":Ka,"Content-Type":"application/json"},body:JSON.stringify({description:Se})}).catch(()=>{})}})},ve.id)}),G.jsxs("div",{style:{position:"relative"},children:[G.jsx("button",{className:"pill",style:{background:"transparent",border:"1px solid var(--ring)",borderRadius:12,color:"#fff"},onClick:()=>q(ve=>!ve),title:"Link another media",children:"+"}),z&&G.jsxs("div",{style:{position:"absolute",bottom:"100%",left:0,marginBottom:6,background:"var(--glass)",border:"1px solid var(--ring)",borderRadius:12,backdropFilter:"blur(10px) saturate(180%)",WebkitBackdropFilter:"blur(10px) saturate(180%)",padding:8,display:"grid",gap:6,pointerEvents:"auto",zIndex:5,minWidth:180},children:[!k&&G.jsxs(G.Fragment,{children:[G.jsx("button",{className:"pill",style:{background:"transparent",border:"1px solid var(--ring)",color:"#fff"},onClick:()=>U.current?.click(),children:"Add Media"}),G.jsx("button",{className:"pill",style:{background:"transparent",border:"1px solid var(--ring)",color:"#fff"},onClick:()=>j.current?.click(),children:"Upload Audio"}),G.jsx("button",{className:"pill",style:{background:"transparent",border:"1px solid var(--ring)",color:"#fff"},onClick:nt,children:"Record Audio"})]}),k&&G.jsx(G.Fragment,{children:G.jsxs("div",{style:{display:"grid",gap:6},children:[G.jsx("div",{className:"muted",style:{color:"#fff"},children:"Recording"}),G.jsx("div",{style:{width:"100%",height:8,background:"rgba(255,255,255,0.25)",borderRadius:6,overflow:"hidden"},children:G.jsx("div",{style:{width:"12%",height:"100%",background:"#fff"}})}),G.jsx("button",{className:"pill",style:{background:"crimson",border:"1px solid var(--ring)",color:"#fff"},onClick:pe,children:"Stop Recording"})]})}),G.jsx("input",{ref:U,type:"file",accept:"image/*,video/*,application/pdf",onChange:Be,style:{display:"none"}}),G.jsx("input",{ref:j,type:"file",accept:"audio/*",onChange:Ge,style:{display:"none"}})]})]})]})]})]})})})}function $oe(){const[s,e]=ee.useState("default"),[t,n]=ee.useState(4),[i,r]=ee.useState(6),[a,o]=ee.useState(1),[l,c]=ee.useState(360),[h,f]=ee.useState(20),[p,g]=ee.useState(1.45),[y,x]=ee.useState(1.3),[E,_]=ee.useState("hard-light"),[b,C]=ee.useState("lighten"),[I,M]=ee.useState("reverse"),R=ee.useMemo(()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],[]);return G.jsxs("main",{style:{minHeight:"100vh"},children:[G.jsx(I4,{variant:s,speedFactor:t,saturate:i,sepia:a,hueDegrees:l,hueDurationSec:h,brightness:p,contrast:y,beforeBlendMode:E,afterBlendMode:b,afterDirection:I,fill:"viewport",style:{position:"fixed",inset:0,zIndex:0}}),G.jsx("div",{style:{position:"relative",zIndex:1,display:"grid",placeItems:"center",minHeight:"100vh"},children:G.jsxs("div",{style:{width:"min(720px, 92vw)",background:"color-mix(in lch, white, black 10%)",backdropFilter:"blur(10px)",border:"1px solid color-mix(in lch, black, white 80%)",borderRadius:12,padding:"1.25rem",boxShadow:"0 10px 30px rgba(0,0,0,0.25)"},children:[G.jsx("h2",{style:{margin:"0 0 1rem 0"},children:"Shader Background Controls"}),G.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0,1fr))",gap:"0.75rem 1rem"},children:[G.jsxs("label",{style:{display:"grid",gap:6},children:[G.jsx("span",{children:"Variant"}),G.jsxs("select",{value:s,onChange:D=>e(D.target.value),children:[G.jsx("option",{value:"default",children:"default"}),G.jsx("option",{value:"vivid",children:"vivid"}),G.jsx("option",{value:"metal",children:"metal"}),G.jsx("option",{value:"silk",children:"silk"})]})]}),G.jsxs("label",{style:{display:"grid",gap:6},children:[G.jsxs("span",{children:["Brightness (",p.toFixed(2),")"]}),G.jsx("input",{type:"range",min:.5,max:2,step:.05,value:p,onChange:D=>g(parseFloat(D.target.value))})]}),G.jsxs("label",{style:{display:"grid",gap:6},children:[G.jsxs("span",{children:["Contrast (",y.toFixed(2),")"]}),G.jsx("input",{type:"range",min:.5,max:2,step:.05,value:y,onChange:D=>x(parseFloat(D.target.value))})]}),G.jsxs("label",{style:{display:"grid",gap:6},children:[G.jsxs("span",{children:["Speed factor (",t,")"]}),G.jsx("input",{type:"range",min:1,max:12,step:1,value:t,onChange:D=>n(parseInt(D.target.value))})]}),G.jsxs("label",{style:{display:"grid",gap:6},children:[G.jsxs("span",{children:["Saturate (",i,")"]}),G.jsx("input",{type:"range",min:0,max:12,step:1,value:i,onChange:D=>r(parseInt(D.target.value))})]}),G.jsxs("label",{style:{display:"grid",gap:6},children:[G.jsxs("span",{children:["Sepia (",a,")"]}),G.jsx("input",{type:"range",min:0,max:10,step:1,value:a,onChange:D=>o(parseInt(D.target.value))})]}),G.jsxs("label",{style:{display:"grid",gap:6},children:[G.jsxs("span",{children:["Hue degrees (",l,")"]}),G.jsx("input",{type:"range",min:0,max:720,step:10,value:l,onChange:D=>c(parseInt(D.target.value))})]}),G.jsxs("label",{style:{display:"grid",gap:6},children:[G.jsxs("span",{children:["Hue cycle duration (s) (",h,")"]}),G.jsx("input",{type:"range",min:0,max:60,step:1,value:h,onChange:D=>f(parseInt(D.target.value))})]}),G.jsxs("label",{style:{display:"grid",gap:6},children:[G.jsx("span",{children:"Before blend"}),G.jsx("select",{value:E,onChange:D=>_(D.target.value),children:R.map(D=>G.jsx("option",{value:D,children:D},D))})]}),G.jsxs("label",{style:{display:"grid",gap:6},children:[G.jsx("span",{children:"After blend"}),G.jsx("select",{value:b,onChange:D=>C(D.target.value),children:R.map(D=>G.jsx("option",{value:D,children:D},D))})]}),G.jsxs("label",{style:{display:"grid",gap:6},children:[G.jsx("span",{children:"After direction"}),G.jsxs("select",{value:I,onChange:D=>M(D.target.value),children:[G.jsx("option",{value:"normal",children:"normal"}),G.jsx("option",{value:"reverse",children:"reverse"})]})]})]})]})})]})}function Joe(){return G.jsx("main",{style:{minHeight:"100vh",display:"grid",placeItems:"center",gap:"2rem",padding:"2rem"},children:G.jsx("div",{style:{display:"grid",gap:"2rem"},children:G.jsx("div",{style:{display:"grid",placeItems:"center"},children:G.jsx(C4,{text:"RESILIENCE",style:{perspective:"60rem","--front":"#0f172a","--back":"#94a3b8"}})})})})}var QN=class{target;name;intersected;wasIntersected=!1;wasIntersectedOnMouseDown=!1;distance;constructor(e,t){this.target=e,this.name=t,this.intersected=!1,this.distance=0}},Ya=class{type;cancelBubble;originalEvent;coords=new We(0,0);distance=0;intersected=!1;wasIntersected=!1;wasIntersectedOnMouseDown=!1;constructor(e,t=null){this.cancelBubble=!1,this.type=e,this.originalEvent=t}stopPropagation(){this.cancelBubble=!0}},Zoe=class{renderer;camera;domElement;bindEventsOnBodyElement;autoAdd;scene;mouse;supportsPointerEvents;interactiveObjects;closestObject;raycaster;treatTouchEventsAsMouseEvents;constructor(s,e,t,n){this.renderer=s,this.camera=e,this.domElement=t,this.bindEventsOnBodyElement=n&&typeof n.bindEventsOnBodyElement<"u"?n.bindEventsOnBodyElement:!0,this.scene=n&&typeof n.scene<"u"?n.scene:null,this.scene&&(this.scene.onBeforeRender=()=>{this.autoAdd&&this.scene!==null&&this.scene.traverse(i=>{this.add(i),i.addEventListener("removed",r=>{this.remove(r.target)})}),this.update()}),this.autoAdd=n&&typeof n.autoAdd<"u"?n.autoAdd:!1,this.autoAdd&&this.scene===null&&console.error("Attention: Options.scene needs to be set when using options.autoAdd"),this.mouse=new We(-1,1),this.supportsPointerEvents=!!window.PointerEvent,this.interactiveObjects=[],this.closestObject=null,this.raycaster=new QB,t.addEventListener("click",this.onMouseClick),this.supportsPointerEvents&&(this.bindEventsOnBodyElement?t.ownerDocument.addEventListener("pointermove",this.onDocumentPointerMove):t.addEventListener("pointermove",this.onDocumentPointerMove),t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointerup",this.onPointerUp)),this.bindEventsOnBodyElement?t.ownerDocument.addEventListener("mousemove",this.onDocumentMouseMove):t.addEventListener("mousemove",this.onDocumentMouseMove),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("mouseup",this.onMouseUp),t.addEventListener("touchstart",this.onTouchStart,{passive:!0}),t.addEventListener("touchmove",this.onTouchMove,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this.treatTouchEventsAsMouseEvents=!0}dispose=()=>{this.domElement.removeEventListener("click",this.onMouseClick),this.supportsPointerEvents&&(this.bindEventsOnBodyElement?this.domElement.ownerDocument.removeEventListener("pointermove",this.onDocumentPointerMove):this.domElement.removeEventListener("pointermove",this.onDocumentPointerMove),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointerup",this.onPointerUp)),this.bindEventsOnBodyElement?this.domElement.ownerDocument.removeEventListener("mousemove",this.onDocumentMouseMove):this.domElement.removeEventListener("mousemove",this.onDocumentMouseMove),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mouseup",this.onMouseUp),this.domElement.removeEventListener("touchstart",this.onTouchStart),this.domElement.removeEventListener("touchmove",this.onTouchMove),this.domElement.removeEventListener("touchend",this.onTouchEnd)};add=(s,e=[])=>{if(s&&!this.interactiveObjects.find(t=>t.target===s))if(e.length>0)e.forEach(t=>{let n=s.getObjectByName(t);if(n){let i=new QN(n,t);this.interactiveObjects.push(i)}});else{let t=new QN(s,s.name);this.interactiveObjects.push(t)}};remove=(s,e=[])=>{!s||(e.length>0?e.forEach(t=>{let n=s.getObjectByName(t);n&&(this.interactiveObjects=this.interactiveObjects.filter(i=>i.target!==n))}):this.interactiveObjects=this.interactiveObjects.filter(t=>t.target!==s))};update=()=>{this.raycaster.setFromCamera(this.mouse,this.camera),this.interactiveObjects.forEach(n=>{n.target&&this.checkIntersection(n)}),this.interactiveObjects.sort(function(n,i){return n.distance-i.distance});let s=this.interactiveObjects.find(n=>n.intersected)??null;if(s!=this.closestObject){if(this.closestObject){let n=new Ya("mouseout");this.dispatch(this.closestObject,n)}if(s){let n=new Ya("mouseover");this.dispatch(s,n)}this.closestObject=s}let e;this.interactiveObjects.forEach(n=>{!n.intersected&&n.wasIntersected&&(e||(e=new Ya("mouseleave")),this.dispatch(n,e))});let t;this.interactiveObjects.forEach(n=>{n.intersected&&!n.wasIntersected&&(t||(t=new Ya("mouseenter")),this.dispatch(n,t))})};checkIntersection=s=>{let e=this.raycaster.intersectObjects([s.target],!0);if(s.wasIntersected=s.intersected,e.length>0){let t=e[0].distance;e.forEach(n=>{n.distance<t&&(t=n.distance)}),s.intersected=!0,s.distance=t}else s.intersected=!1};onDocumentMouseMove=s=>{this.mapPositionToPoint(this.mouse,s.clientX,s.clientY);let e=new Ya("mousemove",s);this.interactiveObjects.forEach(t=>{this.dispatch(t,e)})};onDocumentPointerMove=s=>{this.mapPositionToPoint(this.mouse,s.clientX,s.clientY);let e=new Ya("pointermove",s);this.interactiveObjects.forEach(t=>{this.dispatch(t,e)})};onTouchMove=s=>{s.touches.length>0&&this.mapPositionToPoint(this.mouse,s.touches[0].clientX,s.touches[0].clientY);let e=new Ya(this.treatTouchEventsAsMouseEvents?"mousemove":"touchmove",s);this.interactiveObjects.forEach(t=>{this.dispatch(t,e)})};onMouseClick=s=>{this.update();let e=new Ya("click",s);this.interactiveObjects.forEach(t=>{t.intersected&&this.dispatch(t,e)})};onMouseDown=s=>{this.mapPositionToPoint(this.mouse,s.clientX,s.clientY),this.update();let e=new Ya("mousedown",s);this.interactiveObjects.forEach(t=>{t.intersected?(t.wasIntersectedOnMouseDown=!0,this.dispatch(t,e)):t.wasIntersectedOnMouseDown=!1})};onPointerDown=s=>{this.mapPositionToPoint(this.mouse,s.clientX,s.clientY),this.update();let e=new Ya("pointerdown",s);this.interactiveObjects.forEach(t=>{t.intersected&&this.dispatch(t,e)})};onTouchStart=s=>{s.touches.length>0&&this.mapPositionToPoint(this.mouse,s.touches[0].clientX,s.touches[0].clientY),this.update();let e=new Ya(this.treatTouchEventsAsMouseEvents?"mousedown":"touchstart",s);this.interactiveObjects.forEach(t=>{t.intersected&&this.dispatch(t,e)})};onMouseUp=s=>{let e=new Ya("mouseup",s);this.interactiveObjects.forEach(t=>{this.dispatch(t,e)})};onPointerUp=s=>{let e=new Ya("pointerup",s);this.interactiveObjects.forEach(t=>{this.dispatch(t,e)})};onTouchEnd=s=>{s.touches.length>0&&this.mapPositionToPoint(this.mouse,s.touches[0].clientX,s.touches[0].clientY),this.update();let e=new Ya(this.treatTouchEventsAsMouseEvents?"mouseup":"touchend",s);this.interactiveObjects.forEach(t=>{this.dispatch(t,e)})};dispatch=(s,e)=>{s.target&&!e.cancelBubble&&(e.coords=this.mouse,e.distance=s.distance,e.intersected=s.intersected,e.wasIntersected=s.wasIntersected,e.wasIntersectedOnMouseDown=s.wasIntersectedOnMouseDown,s.target.dispatchEvent(e))};mapPositionToPoint=(s,e,t)=>{let n=this.renderer.domElement.getBoundingClientRect();s.x=(e-n.left)/n.width*2-1,s.y=-((t-n.top)/n.height)*2+1}};function ele(s){return{all:s=s||new Map,on:function(e,t){var n=s.get(e);n?n.push(t):s.set(e,[t])},off:function(e,t){var n=s.get(e);n&&(t?n.splice(n.indexOf(t)>>>0,1):s.set(e,[]))},emit:function(e,t){var n=s.get(e);n&&n.slice().map(function(i){i(t)}),(n=s.get("*"))&&n.slice().map(function(i){i(e,t)})}}}class Sd{base;emitter;container;constructor(e){this.base=e,this.base.update(t=>this.update(t)),this.emitter=ele(),this.container=this.base.scene}addExisting(){}update(e){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}emit(e,t={}){this.emitter.emit(e,t)}}class tle{base;tasks;autoRender;constructor(e,t={}){const{autoRender:n=!0}=t;this.autoRender=n,this.base=e,this.tasks=[]}add(e){this.tasks.push(e)}update(){this.base.renderer.setAnimationLoop(e=>{this.tick(e)})}tick(e=0){this.tasks.forEach(t=>{t(e)}),this.autoRender&&this.base.render()}}new We,new We;new Tt;var ib={exports:{}},nle=ib.exports,VN;function ile(){return VN||(VN=1,(function(s){(function(e){function t(M,R){var D=(M&65535)+(R&65535),P=(M>>16)+(R>>16)+(D>>16);return P<<16|D&65535}function n(M,R){return M<<R|M>>>32-R}function i(M,R,D,P,L,O){return t(n(t(t(R,M),t(P,O)),L),D)}function r(M,R,D,P,L,O,U){return i(R&D|~R&P,M,R,L,O,U)}function a(M,R,D,P,L,O,U){return i(R&P|D&~P,M,R,L,O,U)}function o(M,R,D,P,L,O,U){return i(R^D^P,M,R,L,O,U)}function l(M,R,D,P,L,O,U){return i(D^(R|~P),M,R,L,O,U)}function c(M,R){M[R>>5]|=128<<R%32,M[(R+64>>>9<<4)+14]=R;var D,P,L,O,U,j=1732584193,H=-271733879,z=-1732584194,q=271733878;for(D=0;D<M.length;D+=16)P=j,L=H,O=z,U=q,j=r(j,H,z,q,M[D],7,-680876936),q=r(q,j,H,z,M[D+1],12,-389564586),z=r(z,q,j,H,M[D+2],17,606105819),H=r(H,z,q,j,M[D+3],22,-1044525330),j=r(j,H,z,q,M[D+4],7,-176418897),q=r(q,j,H,z,M[D+5],12,1200080426),z=r(z,q,j,H,M[D+6],17,-1473231341),H=r(H,z,q,j,M[D+7],22,-45705983),j=r(j,H,z,q,M[D+8],7,1770035416),q=r(q,j,H,z,M[D+9],12,-1958414417),z=r(z,q,j,H,M[D+10],17,-42063),H=r(H,z,q,j,M[D+11],22,-1990404162),j=r(j,H,z,q,M[D+12],7,1804603682),q=r(q,j,H,z,M[D+13],12,-40341101),z=r(z,q,j,H,M[D+14],17,-1502002290),H=r(H,z,q,j,M[D+15],22,1236535329),j=a(j,H,z,q,M[D+1],5,-165796510),q=a(q,j,H,z,M[D+6],9,-1069501632),z=a(z,q,j,H,M[D+11],14,643717713),H=a(H,z,q,j,M[D],20,-373897302),j=a(j,H,z,q,M[D+5],5,-701558691),q=a(q,j,H,z,M[D+10],9,38016083),z=a(z,q,j,H,M[D+15],14,-660478335),H=a(H,z,q,j,M[D+4],20,-405537848),j=a(j,H,z,q,M[D+9],5,568446438),q=a(q,j,H,z,M[D+14],9,-1019803690),z=a(z,q,j,H,M[D+3],14,-187363961),H=a(H,z,q,j,M[D+8],20,1163531501),j=a(j,H,z,q,M[D+13],5,-1444681467),q=a(q,j,H,z,M[D+2],9,-51403784),z=a(z,q,j,H,M[D+7],14,1735328473),H=a(H,z,q,j,M[D+12],20,-1926607734),j=o(j,H,z,q,M[D+5],4,-378558),q=o(q,j,H,z,M[D+8],11,-2022574463),z=o(z,q,j,H,M[D+11],16,1839030562),H=o(H,z,q,j,M[D+14],23,-35309556),j=o(j,H,z,q,M[D+1],4,-1530992060),q=o(q,j,H,z,M[D+4],11,1272893353),z=o(z,q,j,H,M[D+7],16,-155497632),H=o(H,z,q,j,M[D+10],23,-1094730640),j=o(j,H,z,q,M[D+13],4,681279174),q=o(q,j,H,z,M[D],11,-358537222),z=o(z,q,j,H,M[D+3],16,-722521979),H=o(H,z,q,j,M[D+6],23,76029189),j=o(j,H,z,q,M[D+9],4,-640364487),q=o(q,j,H,z,M[D+12],11,-421815835),z=o(z,q,j,H,M[D+15],16,530742520),H=o(H,z,q,j,M[D+2],23,-995338651),j=l(j,H,z,q,M[D],6,-198630844),q=l(q,j,H,z,M[D+7],10,1126891415),z=l(z,q,j,H,M[D+14],15,-1416354905),H=l(H,z,q,j,M[D+5],21,-57434055),j=l(j,H,z,q,M[D+12],6,1700485571),q=l(q,j,H,z,M[D+3],10,-1894986606),z=l(z,q,j,H,M[D+10],15,-1051523),H=l(H,z,q,j,M[D+1],21,-2054922799),j=l(j,H,z,q,M[D+8],6,1873313359),q=l(q,j,H,z,M[D+15],10,-30611744),z=l(z,q,j,H,M[D+6],15,-1560198380),H=l(H,z,q,j,M[D+13],21,1309151649),j=l(j,H,z,q,M[D+4],6,-145523070),q=l(q,j,H,z,M[D+11],10,-1120210379),z=l(z,q,j,H,M[D+2],15,718787259),H=l(H,z,q,j,M[D+9],21,-343485551),j=t(j,P),H=t(H,L),z=t(z,O),q=t(q,U);return[j,H,z,q]}function h(M){var R,D="",P=M.length*32;for(R=0;R<P;R+=8)D+=String.fromCharCode(M[R>>5]>>>R%32&255);return D}function f(M){var R,D=[];for(D[(M.length>>2)-1]=void 0,R=0;R<D.length;R+=1)D[R]=0;var P=M.length*8;for(R=0;R<P;R+=8)D[R>>5]|=(M.charCodeAt(R/8)&255)<<R%32;return D}function p(M){return h(c(f(M),M.length*8))}function g(M,R){var D,P=f(M),L=[],O=[],U;for(L[15]=O[15]=void 0,P.length>16&&(P=c(P,M.length*8)),D=0;D<16;D+=1)L[D]=P[D]^909522486,O[D]=P[D]^1549556828;return U=c(L.concat(f(R)),512+R.length*8),h(c(O.concat(U),640))}function y(M){var R="0123456789abcdef",D="",P,L;for(L=0;L<M.length;L+=1)P=M.charCodeAt(L),D+=R.charAt(P>>>4&15)+R.charAt(P&15);return D}function x(M){return unescape(encodeURIComponent(M))}function E(M){return p(x(M))}function _(M){return y(E(M))}function b(M,R){return g(x(M),x(R))}function C(M,R){return y(b(M,R))}function I(M,R,D){return R?D?b(R,M):C(R,M):D?E(M):_(M)}s.exports?s.exports=I:e.md5=I})(nle)})(ib)),ib.exports}ile();var _M,jN;function M4(){return jN||(jN=1,_M=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]),_M}var SM,qN;function sle(){return qN||(qN=1,SM=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]),SM}var bM,KN;function w4(){return KN||(KN=1,bM=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]),bM}var TM,YN;function rle(){if(YN)return TM;YN=1;var s=M4();return TM=s.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"]),TM}var CM,XN;function ale(){if(XN)return CM;XN=1;var s=w4();return s=s.slice().filter(function(e){return!/^(gl\_|texture)/.test(e)}),CM=s.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]),CM}var IM,WN;function ole(){if(WN)return IM;WN=1,IM=I;var s=M4(),e=sle(),t=w4(),n=rle(),i=ale(),r=999,a=9999,o=0,l=1,c=2,h=3,f=4,p=5,g=6,y=7,x=8,E=9,_=10,b=11,C=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function I(M){var R=0,D=0,P=r,L,O,U=[],j=[],H=1,z=0,q=0,k=!1,W=!1,V="",X;M=M||{};var K=t,te=s;M.version==="300 es"&&(K=i,te=n);for(var oe={},Ee={},R=0;R<K.length;R++)oe[K[R]]=!0;for(var R=0;R<te.length;R++)Ee[te[R]]=!0;return function(Re){return j=[],Re!==null?se(Re):ie()};function Ce(Re){Re.length&&j.push({type:C[P],data:Re,position:q,line:H,column:z})}function se(Re){R=0,Re.toString&&(Re=Re.toString()),V+=Re.replace(/\r\n/g,`
`),X=V.length;for(var me;L=V[R],R<X;){switch(me=R,P){case o:R=Ue();break;case l:R=Ge();break;case c:R=Be();break;case h:R=nt();break;case f:R=Ae();break;case b:R=ve();break;case p:R=Se();break;case a:R=be();break;case E:R=re();break;case r:R=ne();break}if(me!==R)switch(V[me]){case`
`:z=0,++H;break;default:++z;break}}return D+=R,V=V.slice(R),j}function ie(Re){return U.length&&Ce(U.join("")),P=_,Ce("(eof)"),j}function ne(){return U=U.length?[]:U,O==="/"&&L==="*"?(q=D+R-1,P=o,O=L,R+1):O==="/"&&L==="/"?(q=D+R-1,P=l,O=L,R+1):L==="#"?(P=c,q=D+R,R):/\s/.test(L)?(P=E,q=D+R,R):(k=/\d/.test(L),W=/[^\w_]/.test(L),q=D+R,P=k?f:W?h:a,R)}function re(){return/[^\s]/g.test(L)?(Ce(U.join("")),P=r,R):(U.push(L),O=L,R+1)}function Be(){return(L==="\r"||L===`
`)&&O!=="\\"?(Ce(U.join("")),P=r,R):(U.push(L),O=L,R+1)}function Ge(){return Be()}function Ue(){return L==="/"&&O==="*"?(U.push(L),Ce(U.join("")),P=r,R+1):(U.push(L),O=L,R+1)}function nt(){if(O==="."&&/\d/.test(L))return P=p,R;if(O==="/"&&L==="*")return P=o,R;if(O==="/"&&L==="/")return P=l,R;if(L==="."&&U.length){for(;pe(U););return P=p,R}if(L===";"||L===")"||L==="("){if(U.length)for(;pe(U););return Ce(L),P=r,R+1}var Re=U.length===2&&L!=="=";if(/[\w_\d\s]/.test(L)||Re){for(;pe(U););return P=r,R}return U.push(L),O=L,R+1}function pe(Re){var me=0,ue,$e;do{if(ue=e.indexOf(Re.slice(0,Re.length+me).join("")),$e=e[ue],ue===-1){if(me--+Re.length>0)continue;$e=Re.slice(0,1).join("")}return Ce($e),q+=$e.length,U=U.slice($e.length),U.length}while(!0)}function ve(){return/[^a-fA-F0-9]/.test(L)?(Ce(U.join("")),P=r,R):(U.push(L),O=L,R+1)}function Ae(){return L==="."||/[eE]/.test(L)?(U.push(L),P=p,O=L,R+1):L==="x"&&U.length===1&&U[0]==="0"?(P=b,U.push(L),O=L,R+1):/[^\d]/.test(L)?(Ce(U.join("")),P=r,R):(U.push(L),O=L,R+1)}function Se(){return L==="f"&&(U.push(L),O=L,R+=1),/[eE]/.test(L)||(L==="-"||L==="+")&&/[eE]/.test(O)?(U.push(L),O=L,R+1):/[^\d]/.test(L)?(Ce(U.join("")),P=r,R):(U.push(L),O=L,R+1)}function be(){if(/[^\d\w_]/.test(L)){var Re=U.join("");return Ee[Re]?P=x:oe[Re]?P=y:P=g,Ce(U.join("")),P=r,R}return U.push(L),O=L,R+1}}return IM}var MM,$N;function lle(){if($N)return MM;$N=1;var s=ole();MM=e;function e(t,n){var i=s(n),r=[];return r=r.concat(i(t)),r=r.concat(i(null)),r}return MM}lle();const{ShaderChunk:lA,UniformsLib:cle,Vector2:ule,Color:hle,EventDispatcher:fle,TangentSpaceNormalMap:dle,MultiplyOperation:ple,Material:R4,ShaderMaterial:OE,RawShaderMaterial:mle}=Zb;function gle(s){return s&&s.isShaderMaterial}function Ale(s){return s&&s.isMeshDepthMaterial||s===nC}const xi=cle;xi.clearcoatnormalmap={clearcoatNormalScale:{value:new ule(1,1)}};const yle=["MeshDistanceMaterial","MeshMatcapMaterial","ShadowMaterial","SpriteMaterial","RawShaderMaterial","ShaderMaterial","PointsMaterial","MeshPhysicalMaterial","MeshStandardMaterial","MeshPhongMaterial","MeshToonMaterial","MeshNormalMaterial","MeshLambertMaterial","MeshDepthMaterial","MeshBasicMaterial","LineDashedMaterial","LineBasicMaterial","Material","MeshFaceMaterial","MultiMaterial","PointCloudMaterial","ParticleBasicMaterial","ParticleSystemMaterial"];for(let s of yle)if(Zb[s]!==void 0){const e=Zb[s].prototype;e.type=s,e.customDepthMaterial=null,e.customDistanceMaterial=null,e.templates=[]}const B4=OE.prototype.clone;function rD(){const s=B4.call(this);return s.templates=this.templates,s}function D4(s){if(s&&s.uniforms)for(let e in s.uniforms)s.uniforms[e].linked&&(this.uniforms[e]=s.uniforms[e]);return this}function aD(s){R4.prototype.copy.call(this,s);for(let e of xle)s[e]&&(this[e]=s[e]);for(let e of vle)s[e]&&(this[e]=s[e]);return this.fragmentShader=s.fragmentShader,this.vertexShader=s.vertexShader,this.uniforms=ui(s.uniforms),this.defines=Object.assign({},s.defines),this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.lights=s.lights,this.clipping=s.clipping,this.skinning=s.skinning,this.morphTargets=s.morphTargets,this.morphNormals=s.morphNormals,this.extensions=s.extensions,s.customDepthMaterial&&(this.customDepthMaterial=s.customDepthMaterial.clone().link(this)),s.customDistanceMaterial&&(this.customDistanceMaterial=s.customDistanceMaterial.clone().link(this)),this}function L4(s){return this.uniforms[s]===void 0&&(this.uniforms[s]={value:null}),this.uniforms[s]}function md(s,e){e=e||{};let t={},n="",i="";const r=e.template||e.extends,a=e.class||(s.isMaterial&&s.constructor?s.constructor:null)||oD,o=new a,l=e.material=e.material||{},c=Object.assign({},l.defines);o.templates=[e],s.templates instanceof Array&&(o.templates=s.templates.concat(o.templates));let h;if(s instanceof Function){h=s.prototype.type;const p=JN[h];if(p===void 0)return console.error('THREE.extendMaterial: no mapping for material class "%s" found',h),o;l.lights=l.lights===void 0?!0:l.lights,t=tF(p.name,t,e),n=lA[p.id+"_vert"],i=lA[p.id+"_frag"]}else if(gle(s))h=s.type,t=ui(s.uniforms,t),n=s.vertexShader,i=s.fragmentShader,o.copy(s,!1),s.defines&&Object.assign(c,s.defines);else{h=s.type;const p=JN[h];if(p===void 0)return console.error('THREE.extendMaterial: no mapping for material class "%s" found',h),o;l.lights=l.lights===void 0?!0:l.lights,t=tF(p.name,t,e),n=lA[p.id+"_vert"],i=lA[p.id+"_frag"];const g=Do[p.name].uniforms;for(let y in g)t[y]===void 0&&s[y]!==void 0&&(s[y]!==null||e.explicit===!1)&&(t[y]=t[y]||{value:null},t[y].value=s[y])}e.defines&&Object.assign(c,e.defines);let f=(e.header||"")+`
`;if(e.vertex!==void 0&&(n=eE(n,e.vertex)),e.fragment!==void 0&&(i=eE(i,e.fragment)),l.defines=c,l.uniforms=t,l.vertexShader=f+(e.vertexHeader||"")+`
`+n,l.fragmentShader=f+(e.fragmentHeader||"")+`
`+i,e.vertexEnd&&(l.vertexShader=l.vertexShader.replace(/\}(?=[^.]*$)/g,e.vertexEnd+`
}`)),e.fragmentEnd&&(l.fragmentShader=l.fragmentShader.replace(/\}(?=[^.]*$)/g,e.fragmentEnd+`
}`)),e.override)for(let p in e.override){const g=e.override[p],y=t[p]=t[p]||{value:null};for(let x in g)y[x]=g[x];y.mixed&&(e.uniforms||(e.uniforms={}),e.uniforms[p]=y)}if(r&&r.templates&&r.templates.length){e.class=e.class||r.class;for(let p of r.templates)Ile(l,p,Cle,c);for(let p in r.uniforms){const g=r.uniforms[p];g.linked&&(t[p]=g)}}if(U4(o,e,l),o.setValues(l),o.isCustomMaterial)for(let p in t)P4[p]&&t[p].value&&(o[p]=t[p].value);for(let p in c)c[p]===!1&&delete c[p];return Ale(s)&&c.DEPTH_PACKING===void 0&&(c.DEPTH_PACKING=dB),o}Object.assign(mle.prototype,{extend:md,uniform:L4,clone:rD,link:D4,copy:aD});Object.assign(OE.prototype,{extend:md,uniform:L4,clone:rD,link:D4,copy:aD});if(OE.prototype.customDepthMaterial!==void 0){const s={_customDepthMaterial:{enumerable:!0,value:void 0,writable:!0},_customDistanceMaterial:{enumerable:!0,value:void 0,writable:!0},customDepthMaterial:{get:function(){return this._customDepthMaterial||(this.material&&this.material.customDepthMaterial?this.material.customDepthMaterial:void 0)},set:function(e){this._customDepthMaterial=e}},customDistanceMaterial:{get:function(){return this._customDistanceMaterial||(this.material&&this.material.customDistanceMaterial?this.material.customDistanceMaterial:void 0)},set:function(e){this._customDistanceMaterial=e}}};Object.defineProperties(bi.prototype,s),Object.defineProperties(AE.prototype,s)}md.CustomMaterial=function(e){OE.call(this,e),this.type="CustomMaterial"};Object.assign(md.CustomMaterial.prototype,R4.prototype,OE.prototype,fle.prototype,{isShaderMaterial:!0,isCustomMaterial:!0,isMeshPhongMaterial:!1,isMeshDistanceMaterial:!1,isMeshMatcapMaterial:!1,isShadowMaterial:!1,isSpriteMaterial:!1,isRawShaderMaterial:!1,isPointsMaterial:!1,isMeshPhysicalMaterial:!1,isMeshStandardMaterial:!1,isMeshToonMaterial:!1,isMeshNormalMaterial:!1,isMeshLambertMaterial:!1,isMeshDepthMaterial:!1,isMeshBasicMaterial:!1,isLineDashedMaterial:!1,isLineBasicMaterial:!1,isMaterial:!1,isMeshFaceMaterial:!1,isMultiMaterial:!1,isPointCloudMaterial:!1,isParticleBasicMaterial:!1,isParticleSystemMaterial:!1,constructor:md.CustomMaterial,map:null,aoMap:null,envMap:null,bumpMap:null,normalMap:null,lightMap:null,emissiveMap:null,specularMap:null,roughnessMap:null,metalnessMap:null,alphaMap:null,displacementMap:null,clearcoatMap:null,clearcoatRoughnessMap:null,clearcoatNormalMap:null,normalMapType:dle,combine:ple,clone:function(s){const e=B4.call(this);return this.map&&(e.map=this.map),this.aoMap&&(e.aoMap=this.aoMap),this.envMap&&(e.envMap=this.envMap),this.bumpMap&&(e.bumpMap=this.bumpMap),this.normalMap&&(e.normalMap=this.normalMap),this.lightMap&&(e.lightMap=this.lightMap),this.emissiveMap&&(e.emissiveMap=this.emissiveMap),this.specularMap&&(e.specularMap=this.specularMap),this.roughnessMap&&(e.roughnessMap=this.roughnessMap),this.metalnessMap&&(e.metalnessMap=this.metalnessMap),this.alphaMap&&(e.alphaMap=this.alphaMap),this.displacementMap&&(e.displacementMap=this.displacementMap),this.clearcoatMap&&(e.clearcoatMap=this.clearcoatMap),this.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap=this.clearcoatRoughnessMap),this.clearcoatNormalMap&&(e.clearcoatNormalMap=this.clearcoatNormalMap),e.templates=this.templates,e}});Object.defineProperties(md.CustomMaterial.prototype,{reflectivity:{get:function(){return this.uniforms.reflectivity?this.uniforms.reflectivity.value:0},set:function(s){this.uniforms.reflectivity.value=s}},specular:{get:function(){return this.uniforms.specular===void 0&&(this.uniforms.specular={value:new Tt("white")}),this.uniforms.specular.value},set:function(s){this.uniforms.specular===void 0&&(this.uniforms.specular={value:s}),this.uniforms.specular.value=s}},shininess:{get:function(){return this.uniforms.shininess?this.uniforms.shininess.value:0},set:function(s){this.uniforms.shininess===void 0&&(this.uniforms.shininess={value:s}),this.uniforms.shininess.value=s}}});class oD extends Ra{constructor(e){super(e),this.type="CustomMaterial"}get specular(){return this.uniforms.specular===void 0&&(this.uniforms.specular={value:new Tt("white")}),this.uniforms.specular.value}set specular(e){this.uniforms.specular===void 0&&(this.uniforms.specular={value:e}),this.uniforms.specular.value=e}get shininess(){return this.uniforms.shininess?this.uniforms.shininess.value:0}set shininess(e){this.uniforms.shininess===void 0&&(this.uniforms.shininess={value:e}),this.uniforms.shininess.value=e}get reflectivity(){return this.uniforms.reflectivity?this.uniforms.reflectivity.value:0}set reflectivity(e){this.uniforms.reflectivity.value=e}}Object.assign(oD,md.CustomMaterial);Object.assign(oD.prototype,md.CustomMaterial.prototype,{copy:aD,clone:rD});let O4;const vle=["bumpScale","roughness","metalness","shininess","envMapIntensity","opacity","dashSize","totalSize"],Ele={bumpScale:"bumpScale",roughness:"roughness",metalness:"metalness",shininess:"shininess",envMapIntensity:"envMapIntensity",opacity:"opacity",dashSize:"dashSize",totalSize:"totalSize"},xle=["map","aoMap","envMap","bumpMap","normalMap","lightMap","emissiveMap","specularMap","roughnessMap","metalnessMap","alphaMap","displacementMap"],JN={MeshLambertMaterial:{id:"meshlambert",name:"lambert"},MeshBasicMaterial:{id:"meshbasic",name:"basic"},MeshStandardMaterial:{id:"meshphysical",name:"physical"},MeshPhongMaterial:{id:"meshphong",name:"phong"},MeshMatcapMaterial:{id:"meshmatcap",name:"matcap"},MeshToonMaterial:{id:"meshtoon",name:"toon"},PointsMaterial:{id:"points",name:"points"},LineDashedMaterial:{id:"dashed",name:"linedashed"},MeshDepthMaterial:{id:"depth",name:"depth"},MeshNormalMaterial:{id:"normal",name:"normal"},MeshDistanceMaterial:{id:"distanceRGBA",name:"distanceRGBA"},SpriteMaterial:{id:"sprite",name:"sprite"}},ZN={lightsBegin:"?#include <lights_fragment_maps>",lightsEnd:"?#include <aomap_fragment>",colorBegin:"?#include <logdepthbuf_fragment>",colorEnd:"?#include <tonemapping_fragment>",transformBegin:"?#include <morphtarget_vertex>",transformEnd:"?#include <project_vertex>"},_le={alphaTest:{as:"ALPHATEST",not:0}},Xy={opacity:{value:1},specular:{value:new hle(1118481)}},eF={points:xi.points,sprite:xi.sprite,dashed:{scale:{value:1},dashSize:{value:1},totalSize:{value:2}},normal:{opacity:Xy.opacity},toon:{specular:Xy.specular,shininess:{value:30}},standard:{shininess:{value:30},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}},physical:{shininess:{value:30},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}},phong:{specular:Xy.specular,shininess:{value:30}},cube:{opacity:Xy.opacity},distanceRGBA:{nearDistance:{value:1},farDistance:{value:1e3}},shadow:{opacity:Xy.opacity}},P4={map:"USE_MAP",aoMap:"USE_AOMAP",envMap:"USE_ENVMAP",bumpMap:"USE_BUMPMAP",normalMap:"USE_NORMALMAP",lightMap:"USE_LIGHTMAP",emissiveMap:"USE_EMISSIVEMAP",specularMap:"USE_SPECULARMAP",roughnessMap:"USE_ROUGHNESSMAP",metalnessMap:"USE_METALNESSMAP",alphaMap:"USE_ALPHAMAP",displacementMap:"USE_DISPLACEMENTMAP"};function Sle(s,e){s&&(s.envMap&&ui(xi.envmap,e),s.aoMap&&ui(xi.aomap,e),s.lightMap&&ui(xi.lightmap,e),s.bumpMap&&ui(xi.bumpmap,e),s.normalMap&&ui(xi.normalmap,e),s.displacementMap&&ui(xi.displacementmap,e),s.clearcoatNormalMap&&ui(xi.clearcoatnormalmap,e))}function ble(s,e,t){Sle(e.uniforms,t),e.common!==!1&&ui(xi.common,t),eF[s]!==void 0&&ui(eF[s],t);const n=e.fog||(e.material?e.material.fog||e.material.useFog:null),i=e.lights||(e.material?e.material.lights:null);if(n&&ui(xi.fog,t),i)if(e.use){const r=e.use;r.indexOf("sharedLights")>-1;const a=r.indexOf("shadows")>-1;r.indexOf("PointLight")>-1&&(ui(xi.lights.pointLights,t),a&&(ui(xi.pointLightShadows,t),ui(xi.pointShadowMap,t),ui(xi.pointShadowMatrix,t))),r.indexOf("SpotLight")>-1&&(ui(xi.lights.spotLights,t),a&&(ui(xi.spotLightShadows,t),ui(xi.spotShadowMap,t),ui(xi.spotShadowMatrix,t))),r.indexOf("DirectionalLight")>-1&&(ui(xi.lights.directionalLights,t),a&&(ui(xi.directionalLightShadows,t),ui(xi.directionalShadowMap,t),ui(xi.directionalShadowMatrix,t))),r.indexOf("LightProbe")>-1&&ui(xi.lights.lightProbe,t),r.indexOf("AmbientLight")>-1&&ui(xi.lights.ambientLightColor,t),r.indexOf("ReactAreaLight")>-1&&ui(xi.lights.rectAreaLights,t),r.indexOf("HemisphereLight")>-1&&ui(xi.lights.hemisphereLights,t)}else ui(O4,t);return t}function N4(s,e={}){for(let t in s){const n=s[t];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?e[t]=n.clone():Array.isArray(n)?e[t]=n.slice():e[t]=n}return e}function F4(s){return s&&s.value!==void 0?s:{value:s}}function ui(s,e={},t=!1,n=!1,i=!1,r=!1){for(let a in s){const o=s[a];o&&(t&&(o.value===null||o.value===0)||(o.shared||o.linked&&r?e[a]=o:(e[a]=N4(o),n===!0&&(e[a].shared=!0),i===!0&&(e[a].mixed=!0))))}return e}function eE(s,e){for(let t in e){const n=e[t];if(ZN[t]!==void 0&&(t=ZN[t]),n instanceof Object)lA[t]===void 0?console.error('ShaderMaterial.extend: ShaderChunk "%s" not found',t):s=s.replace("#include <"+t+">",eE(lA[t],n));else if(t[0]==="@"){const i=t.substr(1);s=s.replace(i,n)}else if(t[0]==="?"){const i=t.substr(1);s=s.replace(i,n+`
`+i)}else s?s=s.replace(t,t+`
`+n):console.error("THREE.patchShader: chunk not found '%s'",t)}return s}function Tle(s,e,t,n,i){e&&e.value&&Ele[s]!==void 0&&(i[s]=e.value),P4[s]!==void 0&&e&&e.value!==void 0&&(i[s]=e.value);const r=_le[s];r!==void 0&&(r.not===void 0||r.not!==e.value)&&(t[r.as]=e.value)}function U4(s,e,t,n){if(!(!e.uniforms||!t))for(let i in e.uniforms){t.uniforms[i]||(t.uniforms[i]={});let r=F4(e.uniforms[i]);t.uniforms[i]=r}}function Cle(s,e,t){if(s.uniforms)for(let n in s.uniforms){let i=s.uniforms[n];i&&(i=F4(i),i.mixed&&e.uniforms[n]===void 0&&(e.uniforms[n]=i.shared?i:N4(i),t&&Tle(n,i,t,s,s)))}}function tF(s,e,t){return t.explicit===!1?ui(Do[s].uniforms,e):ble(s,t,e)}function Ile(s,e,t=U4,n=null){let i=(e.header||"")+`
`,r=(e.vertexHeader||"")+`
`+s.vertexShader,a=(e.fragmentHeader||"")+`
`+s.fragmentShader;return e.vertexEnd&&(r=r.replace(/\}(?=[^.]*$)/g,e.vertexEnd+`
}`)),e.fragmentEnd&&(a=a.replace(/\}(?=[^.]*$)/g,e.fragmentEnd+`
}`)),e.vertex!==void 0&&(r=eE(r,e.vertex)),e.fragment!==void 0&&(a=eE(a,e.fragment)),s.vertexShader=i+r,s.fragmentShader=i+a,t instanceof Function&&t(e,s,n,n),s}O4=ui(xi.lights,{},!1,!0);/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var nF=function(s){return URL.createObjectURL(new Blob([s],{type:"text/javascript"}))};try{URL.revokeObjectURL(nF(""))}catch{nF=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var gl=Uint8Array,Zf=Uint16Array,lR=Uint32Array,k4=new gl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),G4=new gl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Mle=new gl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),H4=function(s,e){for(var t=new Zf(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];for(var i=new lR(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)i[r]=r-t[n]<<5|n;return[t,i]},z4=H4(k4,2),Q4=z4[0],wle=z4[1];Q4[28]=258,wle[258]=28;var Rle=H4(G4,0),Ble=Rle[0],cR=new Zf(32768);for(var Xi=0;Xi<32768;++Xi){var zf=(Xi&43690)>>>1|(Xi&21845)<<1;zf=(zf&52428)>>>2|(zf&13107)<<2,zf=(zf&61680)>>>4|(zf&3855)<<4,cR[Xi]=((zf&65280)>>>8|(zf&255)<<8)>>>1}var xv=function(s,e,t){for(var n=s.length,i=0,r=new Zf(e);i<n;++i)++r[s[i]-1];var a=new Zf(e);for(i=0;i<e;++i)a[i]=a[i-1]+r[i-1]<<1;var o;if(t){o=new Zf(1<<e);var l=15-e;for(i=0;i<n;++i)if(s[i])for(var c=i<<4|s[i],h=e-s[i],f=a[s[i]-1]++<<h,p=f|(1<<h)-1;f<=p;++f)o[cR[f]>>>l]=c}else for(o=new Zf(n),i=0;i<n;++i)s[i]&&(o[i]=cR[a[s[i]-1]++]>>>15-s[i]);return o},PE=new gl(288);for(var Xi=0;Xi<144;++Xi)PE[Xi]=8;for(var Xi=144;Xi<256;++Xi)PE[Xi]=9;for(var Xi=256;Xi<280;++Xi)PE[Xi]=7;for(var Xi=280;Xi<288;++Xi)PE[Xi]=8;var V4=new gl(32);for(var Xi=0;Xi<32;++Xi)V4[Xi]=5;var Dle=xv(PE,9,1),Lle=xv(V4,5,1),wM=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},ic=function(s,e,t){var n=e/8|0;return(s[n]|s[n+1]<<8)>>(e&7)&t},RM=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(e&7)},Ole=function(s){return(s/8|0)+(s&7&&1)},Ple=function(s,e,t){(t==null||t>s.length)&&(t=s.length);var n=new(s instanceof Zf?Zf:s instanceof lR?lR:gl)(t-e);return n.set(s.subarray(e,t)),n},Nle=function(s,e,t){var n=s.length;if(!n||t&&!t.l&&n<5)return e||new gl(0);var i=!e||t,r=!t||t.i;t||(t={}),e||(e=new gl(n*3));var a=function(ie){var ne=e.length;if(ie>ne){var re=new gl(Math.max(ne*2,ie));re.set(e),e=re}},o=t.f||0,l=t.p||0,c=t.b||0,h=t.l,f=t.d,p=t.m,g=t.n,y=n*8;do{if(!h){t.f=o=ic(s,l,1);var x=ic(s,l+1,3);if(l+=3,x)if(x==1)h=Dle,f=Lle,p=9,g=5;else if(x==2){var C=ic(s,l,31)+257,I=ic(s,l+10,15)+4,M=C+ic(s,l+5,31)+1;l+=14;for(var R=new gl(M),D=new gl(19),P=0;P<I;++P)D[Mle[P]]=ic(s,l+P*3,7);l+=I*3;for(var L=wM(D),O=(1<<L)-1,U=xv(D,L,1),P=0;P<M;){var j=U[ic(s,l,O)];l+=j&15;var E=j>>>4;if(E<16)R[P++]=E;else{var H=0,z=0;for(E==16?(z=3+ic(s,l,3),l+=2,H=R[P-1]):E==17?(z=3+ic(s,l,7),l+=3):E==18&&(z=11+ic(s,l,127),l+=7);z--;)R[P++]=H}}var q=R.subarray(0,C),k=R.subarray(C);p=wM(q),g=wM(k),h=xv(q,p,1),f=xv(k,g,1)}else throw"invalid block type";else{var E=Ole(l)+4,_=s[E-4]|s[E-3]<<8,b=E+_;if(b>n){if(r)throw"unexpected EOF";break}i&&a(c+_),e.set(s.subarray(E,b),c),t.b=c+=_,t.p=l=b*8;continue}if(l>y){if(r)throw"unexpected EOF";break}}i&&a(c+131072);for(var W=(1<<p)-1,V=(1<<g)-1,X=l;;X=l){var H=h[RM(s,l)&W],K=H>>>4;if(l+=H&15,l>y){if(r)throw"unexpected EOF";break}if(!H)throw"invalid length/literal";if(K<256)e[c++]=K;else if(K==256){X=l,h=null;break}else{var te=K-254;if(K>264){var P=K-257,oe=k4[P];te=ic(s,l,(1<<oe)-1)+Q4[P],l+=oe}var Ee=f[RM(s,l)&V],Ce=Ee>>>4;if(!Ee)throw"invalid distance";l+=Ee&15;var k=Ble[Ce];if(Ce>3){var oe=G4[Ce];k+=RM(s,l)&(1<<oe)-1,l+=oe}if(l>y){if(r)throw"unexpected EOF";break}i&&a(c+131072);for(var se=c+te;c<se;c+=4)e[c]=e[c-k],e[c+1]=e[c+1-k],e[c+2]=e[c+2-k],e[c+3]=e[c+3-k];c=se}}t.l=h,t.p=X,t.b=c,h&&(o=1,t.m=p,t.d=f,t.n=g)}while(!o);return c==e.length?e:Ple(e,0,c)},Fle=new gl(0),Ule=function(s){if((s[0]&15)!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(s[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function kle(s,e){return Nle((Ule(s),s.subarray(2,-4)),e)}var Gle=typeof TextDecoder<"u"&&new TextDecoder,Hle=0;try{Gle.decode(Fle,{stream:!0}),Hle=1}catch{}function j4(s,e,t){const n=t.length-s-1;if(e>=t[n])return n-1;if(e<=t[s])return s;let i=s,r=n,a=Math.floor((i+r)/2);for(;e<t[a]||e>=t[a+1];)e<t[a]?r=a:i=a,a=Math.floor((i+r)/2);return a}function zle(s,e,t,n){const i=[],r=[],a=[];i[0]=1;for(let o=1;o<=t;++o){r[o]=e-n[s+1-o],a[o]=n[s+o]-e;let l=0;for(let c=0;c<o;++c){const h=a[c+1],f=r[o-c],p=i[c]/(h+f);i[c]=l+h*p,l=f*p}i[o]=l}return i}function Qle(s,e,t,n){const i=j4(s,n,e),r=zle(i,n,s,e),a=new Tn(0,0,0,0);for(let o=0;o<=s;++o){const l=t[i-s+o],c=r[o],h=l.w*c;a.x+=l.x*h,a.y+=l.y*h,a.z+=l.z*h,a.w+=l.w*c}return a}function Vle(s,e,t,n,i){const r=[];for(let f=0;f<=t;++f)r[f]=0;const a=[];for(let f=0;f<=n;++f)a[f]=r.slice(0);const o=[];for(let f=0;f<=t;++f)o[f]=r.slice(0);o[0][0]=1;const l=r.slice(0),c=r.slice(0);for(let f=1;f<=t;++f){l[f]=e-i[s+1-f],c[f]=i[s+f]-e;let p=0;for(let g=0;g<f;++g){const y=c[g+1],x=l[f-g];o[f][g]=y+x;const E=o[g][f-1]/o[f][g];o[g][f]=p+y*E,p=x*E}o[f][f]=p}for(let f=0;f<=t;++f)a[0][f]=o[f][t];for(let f=0;f<=t;++f){let p=0,g=1;const y=[];for(let x=0;x<=t;++x)y[x]=r.slice(0);y[0][0]=1;for(let x=1;x<=n;++x){let E=0;const _=f-x,b=t-x;f>=x&&(y[g][0]=y[p][0]/o[b+1][_],E=y[g][0]*o[_][b]);const C=_>=-1?1:-_,I=f-1<=b?x-1:t-f;for(let R=C;R<=I;++R)y[g][R]=(y[p][R]-y[p][R-1])/o[b+1][_+R],E+=y[g][R]*o[_+R][b];f<=b&&(y[g][x]=-y[p][x-1]/o[b+1][f],E+=y[g][x]*o[f][b]),a[x][f]=E;const M=p;p=g,g=M}}let h=t;for(let f=1;f<=n;++f){for(let p=0;p<=t;++p)a[f][p]*=h;h*=t-f}return a}function jle(s,e,t,n,i){const r=i<s?i:s,a=[],o=j4(s,n,e),l=Vle(o,n,s,r,e),c=[];for(let h=0;h<t.length;++h){const f=t[h].clone(),p=f.w;f.x*=p,f.y*=p,f.z*=p,c[h]=f}for(let h=0;h<=r;++h){const f=c[o-s].clone().multiplyScalar(l[h][0]);for(let p=1;p<=s;++p)f.add(c[o-s+p].clone().multiplyScalar(l[h][p]));a[h]=f}for(let h=r+1;h<=i+1;++h)a[h]=new Tn(0,0,0);return a}function qle(s,e){let t=1;for(let i=2;i<=s;++i)t*=i;let n=1;for(let i=2;i<=e;++i)n*=i;for(let i=2;i<=s-e;++i)n*=i;return t/n}function Kle(s){const e=s.length,t=[],n=[];for(let r=0;r<e;++r){const a=s[r];t[r]=new de(a.x,a.y,a.z),n[r]=a.w}const i=[];for(let r=0;r<e;++r){const a=t[r].clone();for(let o=1;o<=r;++o)a.sub(i[r-o].clone().multiplyScalar(qle(r,o)*n[o]));i[r]=a.divideScalar(n[0])}return i}function Yle(s,e,t,n,i){const r=jle(s,e,t,n,i);return Kle(r)}class Xle extends bl{constructor(e,t,n,i,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let a=0;a<n.length;++a){const o=n[a];this.controlPoints[a]=new Tn(o.x,o.y,o.z,o.w)}}getPoint(e,t=new de){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=Qle(this.degree,this.knots,this.controlPoints,i);return r.w!==1&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new de){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=Yle(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n}}let qn,Ds,$a;class Wle extends Fs{constructor(e){super(e)}load(e,t,n,i){const r=this,a=r.path===""?Ih.extractUrlBase(e):r.path,o=new Js(this.manager);o.setPath(r.path),o.setResponseType("arraybuffer"),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(l){try{t(r.parse(l,a))}catch(c){i?i(c):console.error(c),r.manager.itemError(e)}},n,i)}parse(e,t){if(nce(e))qn=new tce().parse(e);else{const i=X4(e);if(!ice(i))throw new Error("THREE.FBXLoader: Unknown format.");if(sF(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+sF(i));qn=new ece().parse(i)}const n=new bE(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new $le(n,this.manager).parse(qn)}}class $le{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Ds=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),r=new Jle().parse(i);return this.parseScene(i,r,n),$a}parseConnections(){const e=new Map;return"Connections"in qn&&qn.Connections.connections.forEach(function(n){const i=n[0],r=n[1],a=n[2];e.has(i)||e.set(i,{parents:[],children:[]});const o={ID:r,relationship:a};e.get(i).parents.push(o),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:i,relationship:a};e.get(r).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in qn.Objects){const n=qn.Objects.Video;for(const i in n){const r=n[i],a=parseInt(i);if(e[a]=r.RelativeFilename||r.Filename,"Content"in r){const o=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(o||l){const c=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=c}}}}for(const n in e){const i=e[n];t[i]!==void 0?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in qn.Objects){const n=qn.Objects.Texture;for(const i in n){const r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,r=e.WrapModeV,a=i!==void 0?i.value:0,o=r!==void 0?r.value:0;if(n.wrapS=a===0?Cu:Ur,n.wrapT=o===0?Cu:Ur,"Scaling"in e){const l=e.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;n.offset.x=l[0],n.offset.y=l[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,r=Ds.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(n=t[r[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let a;const o=e.FileName.slice(-3).toLowerCase();if(o==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new Hi):(l.setPath(this.textureLoader.path),a=l.load(n))}else o==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new Hi):a=this.textureLoader.load(n);return this.textureLoader.setPath(i),a}parseMaterials(e){const t=new Map;if("Material"in qn.Objects){const n=qn.Objects.Material;for(const i in n){const r=this.parseMaterial(n[i],e);r!==null&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!Ds.has(n))return null;const a=this.parseParameters(e,t,n);let o;switch(r.toLowerCase()){case"phong":o=new SA;break;case"lambert":o=new RB;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),o=new SA;break}return o.setValues(a),o.name=i,o}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new Tt().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(i.color=new Tt().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new Tt().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(i.emissive=new Tt().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new Tt().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new Tt().fromArray(e.SpecularColor.value));const r=this;return Ds.get(n).children.forEach(function(a){const o=a.relationship;switch(o){case"Bump":i.bumpMap=r.getTexture(t,a.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(t,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(t,a.ID),i.map!==void 0&&("colorSpace"in i.map?i.map.colorSpace="srgb":i.map.encoding=3001);break;case"DisplacementColor":i.displacementMap=r.getTexture(t,a.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(t,a.ID),i.emissiveMap!==void 0&&("colorSpace"in i.emissiveMap?i.emissiveMap.colorSpace="srgb":i.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(t,a.ID);break;case"ReflectionColor":i.envMap=r.getTexture(t,a.ID),i.envMap!==void 0&&(i.envMap.mapping=LA,"colorSpace"in i.envMap?i.envMap.colorSpace="srgb":i.envMap.encoding=3001);break;case"SpecularColor":i.specularMap=r.getTexture(t,a.ID),i.specularMap!==void 0&&("colorSpace"in i.specularMap?i.specularMap.colorSpace="srgb":i.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(t,a.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",o);break}}),i}getTexture(e,t){return"LayeredTexture"in qn.Objects&&t in qn.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Ds.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in qn.Objects){const n=qn.Objects.Deformer;for(const i in n){const r=n[i],a=Ds.get(parseInt(i));if(a){if(r.attrType==="Skin"){const o=this.parseSkeleton(a,n);o.ID=i,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=a.parents[0].ID,e[i]=o}else if(r.attrType==="BlendShape"){const o={id:i};o.rawTargets=this.parseMorphTargets(a,n),o.id=i,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=o}}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e?.children.forEach(function(i){const r=t[i.ID];if(r.attrType!=="Cluster")return;const a={ID:i.ID,indices:[],weights:[],transformLink:new Pt().fromArray(r.TransformLink.a)};"Indexes"in r&&(a.indices=r.Indexes.a,a.weights=r.Weights.a),n.push(a)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const r=e.children[i],a=t[r.ID],o={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;o.geoID=Ds.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,n.push(o)}return n}parseScene(e,t,n){$a=new so;const i=this.parseModels(e.skeletons,t,n),r=qn.Objects.Model,a=this;i.forEach(function(l){const c=r[l.ID];a.setLookAtProperties(l,c),Ds.get(l.ID).parents.forEach(function(f){const p=i.get(f.ID);p!==void 0&&p.add(l)}),l.parent===null&&$a.add(l)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),$a.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=K4(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const o=new Zle().parse();$a.children.length===1&&$a.children[0].isGroup&&($a.children[0].animations=o,$a=$a.children[0]),$a.animations=o}parseModels(e,t,n){const i=new Map,r=qn.Objects.Model;for(const a in r){const o=parseInt(a),l=r[a],c=Ds.get(o);let h=this.buildSkeleton(c,e,o,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,n);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new qA;break;case"Null":default:h=new so;break}h.name=l.attrName?zn.sanitizeNodeName(l.attrName):"",h.ID=o}this.getTransformData(h,l),i.set(o,h)}return i}buildSkeleton(e,t,n,i){let r=null;return e.parents.forEach(function(a){for(const o in t){const l=t[o];l.rawBones.forEach(function(c,h){if(c.ID===a.ID){const f=r;r=new qA,r.matrixWorld.copy(c.transformLink),r.name=i?zn.sanitizeNodeName(i):"",r.ID=n,l.bones[h]=r,f!==null&&r.add(f)}})}}),r}createCamera(e){let t,n;if(e.children.forEach(function(i){const r=qn.Objects.NodeAttribute[i.ID];r!==void 0&&(n=r)}),n===void 0)t=new Qn;else{let i=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(i=1);let r=1;n.NearPlane!==void 0&&(r=n.NearPlane.value/1e3);let a=1e3;n.FarPlane!==void 0&&(a=n.FarPlane.value/1e3);let o=window.innerWidth,l=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(o=n.AspectWidth.value,l=n.AspectHeight.value);const c=o/l;let h=45;n.FieldOfView!==void 0&&(h=n.FieldOfView.value);const f=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:t=new Ki(h,c,r,a),f!==null&&t.setFocalLength(f);break;case 1:t=new Nh(-o/2,o/2,l/2,-l/2,r,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new Qn;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(i){const r=qn.Objects.NodeAttribute[i.ID];r!==void 0&&(n=r)}),n===void 0)t=new Qn;else{let i;n.LightType===void 0?i=0:i=n.LightType.value;let r=16777215;n.Color!==void 0&&(r=new Tt().fromArray(n.Color.value).convertSRGBToLinear());let a=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(a=0);let o=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?o=0:o=n.FarAttenuationEnd.value);const l=1;switch(i){case 0:t=new Yv(r,a,o,l);break;case 1:t=new sC(r,a);break;case 2:let c=Math.PI/3;n.InnerAngle!==void 0&&(c=Fr.degToRad(n.InnerAngle.value));let h=0;n.OuterAngle!==void 0&&(h=Fr.degToRad(n.OuterAngle.value),h=Math.max(h,1)),t=new iC(r,a,o,c,h,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new Yv(r,a);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,r=null,a=null;const o=[];return e.children.forEach(function(l){t.has(l.ID)&&(r=t.get(l.ID)),n.has(l.ID)&&o.push(n.get(l.ID))}),o.length>1?a=o:o.length>0?a=o[0]:(a=new SA({color:13421772}),o.push(a)),"color"in r.attributes&&o.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(i=new AE(r,a),i.normalizeSkinWeights()):i=new bi(r,a),i}createCurve(e,t){const n=e.children.reduce(function(r,a){return t.has(a.ID)&&(r=t.get(a.ID)),r},null),i=new $s({color:3342591,linewidth:1});return new Iu(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=Y4(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&Ds.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const r=qn.Objects.Model[i.ID];if("Lcl_Translation"in r){const a=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(a),$a.add(e.target)):e.lookAt(new de().fromArray(a))}}})}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const r in e){const a=e[r];Ds.get(parseInt(a.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;Ds.get(c).parents.forEach(function(f){n.has(f.ID)&&n.get(f.ID).bind(new o0(a.bones),i[f.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in qn.Objects){const t=qn.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(r){e[r.Node]=new Pt().fromArray(r.Matrix.a)}):e[i.Node]=new Pt().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in qn&&"AmbientColor"in qn.GlobalSettings){const e=qn.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(t!==0||n!==0||i!==0){const r=new Tt(t,n,i).convertSRGBToLinear();$a.add(new UB(r,1))}}}}class Jle{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in qn.Objects){const n=qn.Objects.Geometry;for(const i in n){const r=Ds.get(parseInt(i)),a=this.parseGeometry(r,n[i],e);t.set(parseInt(i),a)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,r=[],a=e.parents.map(function(f){return qn.Objects.Model[f.ID]});if(a.length===0)return;const o=e.children.reduce(function(f,p){return i[p.ID]!==void 0&&(f=i[p.ID]),f},null);e.children.forEach(function(f){n.morphTargets[f.ID]!==void 0&&r.push(n.morphTargets[f.ID])});const l=a[0],c={};"RotationOrder"in l&&(c.eulerOrder=Y4(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=K4(c);return this.genGeometry(t,o,r,h)}genGeometry(e,t,n,i){const r=new hn;e.attrName&&(r.name=e.attrName);const a=this.parseGeoNode(e,t),o=this.genBuffers(a),l=new Bt(o.vertex,3);if(l.applyMatrix4(i),r.setAttribute("position",l),o.colors.length>0&&r.setAttribute("color",new Bt(o.colors,3)),t&&(r.setAttribute("skinIndex",new FT(o.weightsIndices,4)),r.setAttribute("skinWeight",new Bt(o.vertexWeights,4)),r.FBX_Deformer=t),o.normal.length>0){const c=new un().getNormalMatrix(i),h=new Bt(o.normal,3);h.applyNormalMatrix(c),r.setAttribute("normal",h)}if(o.uvs.forEach(function(c,h){let f="uv"+(h+1).toString();h===0&&(f="uv"),r.setAttribute(f,new Bt(o.uvs[h],2))}),a.material&&a.material.mappingType!=="AllSame"){let c=o.materialIndex[0],h=0;if(o.materialIndex.forEach(function(f,p){f!==c&&(r.addGroup(h,p-h,c),c=f,h=p)}),r.groups.length>0){const f=r.groups[r.groups.length-1],p=f.start+f.count;p!==o.materialIndex.length&&r.addGroup(p,o.materialIndex.length-p,c)}r.groups.length===0&&r.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(r,e,n,i),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(i,r){i.indices.forEach(function(a,o){n.weightTable[a]===void 0&&(n.weightTable[a]=[]),n.weightTable[a].push({id:r,weight:i.weights[o]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,r=!1,a=[],o=[],l=[],c=[],h=[],f=[];const p=this;return e.vertexIndices.forEach(function(g,y){let x,E=!1;g<0&&(g=g^-1,E=!0);let _=[],b=[];if(a.push(g*3,g*3+1,g*3+2),e.color){const C=wS(y,n,g,e.color);l.push(C[0],C[1],C[2])}if(e.skeleton){if(e.weightTable[g]!==void 0&&e.weightTable[g].forEach(function(C){b.push(C.weight),_.push(C.id)}),b.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const C=[0,0,0,0],I=[0,0,0,0];b.forEach(function(M,R){let D=M,P=_[R];I.forEach(function(L,O,U){if(D>L){U[O]=D,D=L;const j=C[O];C[O]=P,P=j}})}),_=C,b=I}for(;b.length<4;)b.push(0),_.push(0);for(let C=0;C<4;++C)h.push(b[C]),f.push(_[C])}if(e.normal){const C=wS(y,n,g,e.normal);o.push(C[0],C[1],C[2])}e.material&&e.material.mappingType!=="AllSame"&&(x=wS(y,n,g,e.material)[0],x<0&&(p.negativeMaterialIndices=!0,x=0)),e.uv&&e.uv.forEach(function(C,I){const M=wS(y,n,g,C);c[I]===void 0&&(c[I]=[]),c[I].push(M[0]),c[I].push(M[1])}),i++,E&&(i>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),p.genFace(t,e,a,x,o,l,c,h,f,i),n++,i=0,a=[],o=[],l=[],c=[],h=[],f=[])}),t}genFace(e,t,n,i,r,a,o,l,c,h){for(let f=2;f<h;f++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(f-1)*3]]),e.vertex.push(t.vertexPositions[n[(f-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(f-1)*3+2]]),e.vertex.push(t.vertexPositions[n[f*3]]),e.vertex.push(t.vertexPositions[n[f*3+1]]),e.vertex.push(t.vertexPositions[n[f*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(f-1)*4]),e.vertexWeights.push(l[(f-1)*4+1]),e.vertexWeights.push(l[(f-1)*4+2]),e.vertexWeights.push(l[(f-1)*4+3]),e.vertexWeights.push(l[f*4]),e.vertexWeights.push(l[f*4+1]),e.vertexWeights.push(l[f*4+2]),e.vertexWeights.push(l[f*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(f-1)*4]),e.weightsIndices.push(c[(f-1)*4+1]),e.weightsIndices.push(c[(f-1)*4+2]),e.weightsIndices.push(c[(f-1)*4+3]),e.weightsIndices.push(c[f*4]),e.weightsIndices.push(c[f*4+1]),e.weightsIndices.push(c[f*4+2]),e.weightsIndices.push(c[f*4+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[(f-1)*3]),e.colors.push(a[(f-1)*3+1]),e.colors.push(a[(f-1)*3+2]),e.colors.push(a[f*3]),e.colors.push(a[f*3+1]),e.colors.push(a[f*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[(f-1)*3]),e.normal.push(r[(f-1)*3+1]),e.normal.push(r[(f-1)*3+2]),e.normal.push(r[f*3]),e.normal.push(r[f*3+1]),e.normal.push(r[f*3+2])),t.uv&&t.uv.forEach(function(p,g){e.uvs[g]===void 0&&(e.uvs[g]=[]),e.uvs[g].push(o[g][0]),e.uvs[g].push(o[g][1]),e.uvs[g].push(o[g][(f-1)*2]),e.uvs[g].push(o[g][(f-1)*2+1]),e.uvs[g].push(o[g][f*2]),e.uvs[g].push(o[g][f*2+1])})}addMorphTargets(e,t,n,i){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach(function(a){a.rawTargets.forEach(function(o){const l=qn.Objects.Geometry[o.geoID];l!==void 0&&r.genMorphGeometry(e,t,l,i,o.name)})})}genMorphGeometry(e,t,n,i,r){const a=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],o=n.Vertices!==void 0?n.Vertices.a:[],l=n.Indexes!==void 0?n.Indexes.a:[],c=e.attributes.position.count*3,h=new Float32Array(c);for(let y=0;y<l.length;y++){const x=l[y]*3;h[x]=o[y*3],h[x+1]=o[y*3+1],h[x+2]=o[y*3+2]}const f={vertexIndices:a,vertexPositions:h},p=this.genBuffers(f),g=new Bt(p.vertex,3);g.name=r||n.attrName,g.applyMatrix4(i),e.morphAttributes.position.push(g)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let r=[];return n==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let r=[];return n==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let r=[];n==="IndexToDirect"&&(r=e.ColorIndex.a);for(let a=0,o=new Tt;a<i.length;a+=4)o.fromArray(i,a).convertSRGBToLinear().toArray(i,a);return{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,r=[];for(let a=0;a<i.length;++a)r.push(a);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new hn;const n=t-1,i=e.KnotVector.a,r=[],a=e.Points.a;for(let f=0,p=a.length;f<p;f+=4)r.push(new Tn().fromArray(a,f));let o,l;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){o=n,l=i.length-1-o;for(let f=0;f<n;++f)r.push(r[f])}const h=new Xle(n,i,r,o,l).getPoints(r.length*12);return new hn().setFromPoints(h)}}class Zle{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const i=t[n],r=this.addClip(i);e.push(r)}return e}parseClips(){if(qn.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=qn.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:i.id,attr:i.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=qn.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(sce),values:t[n].KeyValueFloat.a},r=Ds.get(i.id);if(r!==void 0){const a=r.parents[0].ID,o=r.parents[0].relationship;o.match(/X/)?e.get(a).curves.x=i:o.match(/Y/)?e.get(a).curves.y=i:o.match(/Z/)?e.get(a).curves.z=i:o.match(/d|DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=i)}}}parseAnimationLayers(e){const t=qn.Objects.AnimationLayer,n=new Map;for(const i in t){const r=[],a=Ds.get(parseInt(i));a!==void 0&&(a.children.forEach(function(l,c){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(r[c]===void 0){const f=Ds.get(l.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID;if(f!==void 0){const p=qn.Objects.Model[f.toString()];if(p===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const g={modelName:p.attrName?zn.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};$a.traverse(function(y){y.ID===p.id&&(g.transform=y.matrix,y.userData.transformData&&(g.eulerOrder=y.userData.transformData.eulerOrder))}),g.transform||(g.transform=new Pt),"PreRotation"in p&&(g.preRotation=p.PreRotation.value),"PostRotation"in p&&(g.postRotation=p.PostRotation.value),r[c]=g}}r[c]&&(r[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(r[c]===void 0){const f=Ds.get(l.ID).parents.filter(function(_){return _.relationship!==void 0})[0].ID,p=Ds.get(f).parents[0].ID,g=Ds.get(p).parents[0].ID,y=Ds.get(g).parents[0].ID,x=qn.Objects.Model[y],E={modelName:x.attrName?zn.sanitizeNodeName(x.attrName):"",morphName:qn.Objects.Deformer[f].attrName};r[c]=E}r[c][h.attr]=h}}}),n.set(parseInt(i),r))}return n}parseAnimStacks(e){const t=qn.Objects.AnimationStack,n={};for(const i in t){const r=Ds.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:a}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(i){t=t.concat(n.generateTracks(i))}),new pm(e.name,-1,t)}generateTracks(e){const t=[];let n=new de,i=new Xs,r=new de;if(e.transform&&e.transform.decompose(n,i,r),n=n.toArray(),i=new Os().setFromQuaternion(i,e.eulerOrder).toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");a!==void 0&&t.push(a)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const a=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);a!==void 0&&t.push(a)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");a!==void 0&&t.push(a)}if(e.DeformPercent!==void 0){const a=this.generateMorphTrack(e);a!==void 0&&t.push(a)}return t}generateVectorTrack(e,t,n,i){const r=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(r,t,n);return new pd(e+"."+i,r,a)}generateRotationTrack(e,t,n,i,r,a){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(Fr.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(Fr.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(Fr.degToRad));const o=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(o,t,n);i!==void 0&&(i=i.map(Fr.degToRad),i.push(a),i=new Os().fromArray(i),i=new Xs().setFromEuler(i)),r!==void 0&&(r=r.map(Fr.degToRad),r.push(a),r=new Os().fromArray(r),r=new Xs().setFromEuler(r).invert());const c=new Xs,h=new Os,f=[];for(let p=0;p<l.length;p+=3)h.set(l[p],l[p+1],l[p+2],a),c.setFromEuler(h),i!==void 0&&c.premultiply(i),r!==void 0&&c.multiply(r),c.toArray(f,p/3*4);return new dd(e+".quaternion",o,f)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(r){return r/100}),i=$a.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new fd(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,i){return n-i}),t.length>1){let n=1,i=t[0];for(let r=1;r<t.length;r++){const a=t[r];a!==i&&(t[n]=a,i=a,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const i=n,r=[];let a=-1,o=-1,l=-1;return e.forEach(function(c){if(t.x&&(a=t.x.times.indexOf(c)),t.y&&(o=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),a!==-1){const h=t.x.values[a];r.push(h),i[0]=h}else r.push(i[0]);if(o!==-1){const h=t.y.values[o];r.push(h),i[1]=h}else r.push(i[1]);if(l!==-1){const h=t.z.values[l];r.push(h),i[2]=h}else r.push(i[2])}),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,r=Math.abs(i);if(r>=180){const a=r/180,o=i/a;let l=n+o;const c=e.times[t-1],f=(e.times[t]-c)/a;let p=c+f;const g=[],y=[];for(;p<e.times[t];)g.push(p),p+=f,y.push(l),l+=o;e.times=rF(e.times,t,g),e.values=rF(e.values,t,y)}}}}class ece{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new q4,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(i,r){const a=i.match(/^[\s\t]*;/),o=i.match(/^[\s\t]*$/);if(a||o)return;const l=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=i.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(i,l):c?t.parseNodeProperty(i,c,n[++r]):h?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:n},a=this.parseNodeAttr(i),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,r):n in o?(n==="PoseNode"?o.PoseNode.push(r):o[n].id!==void 0&&(o[n]={},o[n][o[n].id]=o[n]),a.id!==""&&(o[n][a.id]=r)):typeof a.id=="number"?(o[n]={},o[n][a.id]=r):n!=="Properties70"&&(n==="PoseNode"?o[n]=[r]:o[n]=r),typeof a.id=="number"&&(r.id=a.id),a.name!==""&&(r.attrName=a.name),a.type!==""&&(r.attrType=a.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&r===","&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if(a.name==="Properties70"){this.parseNodeSpecialProperty(e,i,r);return}if(i==="C"){const l=r.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]);let f=r.split(",").slice(3);f=f.map(function(p){return p.trim().replace(/^"/,"")}),i="connections",r=[c,h],ace(r,f),a[i]===void 0&&(a[i]=[])}i==="Node"&&(a.id=r),i in a&&Array.isArray(a[i])?a[i].push(r):i!=="a"?a[i]=r:a.a=r,this.setCurrentProp(a,i),i==="a"&&r.slice(-1)!==","&&(a.a=DM(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=DM(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=i[0],a=i[1],o=i[2],l=i[3];let c=i[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=DM(c);break}this.getPrevNode()[r]={type:a,type2:o,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),r)}}class tce{parse(e){const t=new iF(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new q4;for(;!this.endOfContent(t);){const r=this.parseNode(t,n);r!==null&&i.add(r.name,r)}return i}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),o=e.getString(a);if(i===0)return null;const l=[];for(let p=0;p<r;p++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",f=l.length>2?l[2]:"";for(n.singleProperty=r===1&&e.getOffset()===i;i>e.getOffset();){const p=this.parseNode(e,t);p!==null&&this.parseSubNode(o,n,p)}return n.propertyList=l,typeof c=="number"&&(n.id=c),h!==""&&(n.attrName=h),f!==""&&(n.attrType=f),o!==""&&(n.name=o),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if(e==="Connections"&&n.name==="C"){const i=[];n.propertyList.forEach(function(r,a){a!==0&&i.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(n.name==="Properties70")Object.keys(n).forEach(function(r){t[r]=n[r]});else if(e==="Properties70"&&n.name==="P"){let i=n.propertyList[0],r=n.propertyList[1];const a=n.propertyList[2],o=n.propertyList[3];let l;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:l=n.propertyList[4],t[i]={type:r,type2:a,flag:o,value:l}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),r=e.getUint32(),a=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const o=kle(new Uint8Array(e.getArrayBuffer(a))),l=new iF(o.buffer);switch(t){case"b":case"c":return l.getBooleanArray(i);case"d":return l.getFloat64Array(i);case"f":return l.getFloat32Array(i);case"i":return l.getInt32Array(i);case"l":return l.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class iF{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const i=n.indexOf(0);return i>=0&&(n=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(n)}}class q4{add(e,t){this[e]=t}}function nce(s){const e="Kaydara FBX Binary  \0";return s.byteLength>=e.length&&e===X4(s,0,e.length)}function ice(s){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(i){const r=s[i-1];return s=s.slice(t+i),t++,r}for(let i=0;i<e.length;++i)if(n(1)===e[i])return!1;return!0}function sF(s){const e=/FBXVersion: (\d+)/,t=s.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function sce(s){return s/46186158e3}const rce=[];function wS(s,e,t,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=s;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(i=n.indices[i]);const r=i*n.dataSize,a=r+n.dataSize;return oce(rce,n.buffer,r,a)}const BM=new Os,Jg=new de;function K4(s){const e=new Pt,t=new Pt,n=new Pt,i=new Pt,r=new Pt,a=new Pt,o=new Pt,l=new Pt,c=new Pt,h=new Pt,f=new Pt,p=new Pt,g=s.inheritType?s.inheritType:0;if(s.translation&&e.setPosition(Jg.fromArray(s.translation)),s.preRotation){const O=s.preRotation.map(Fr.degToRad);O.push(s.eulerOrder||Os.DEFAULT_ORDER),t.makeRotationFromEuler(BM.fromArray(O))}if(s.rotation){const O=s.rotation.map(Fr.degToRad);O.push(s.eulerOrder||Os.DEFAULT_ORDER),n.makeRotationFromEuler(BM.fromArray(O))}if(s.postRotation){const O=s.postRotation.map(Fr.degToRad);O.push(s.eulerOrder||Os.DEFAULT_ORDER),i.makeRotationFromEuler(BM.fromArray(O)),i.invert()}s.scale&&r.scale(Jg.fromArray(s.scale)),s.scalingOffset&&o.setPosition(Jg.fromArray(s.scalingOffset)),s.scalingPivot&&a.setPosition(Jg.fromArray(s.scalingPivot)),s.rotationOffset&&l.setPosition(Jg.fromArray(s.rotationOffset)),s.rotationPivot&&c.setPosition(Jg.fromArray(s.rotationPivot)),s.parentMatrixWorld&&(f.copy(s.parentMatrix),h.copy(s.parentMatrixWorld));const y=t.clone().multiply(n).multiply(i),x=new Pt;x.extractRotation(h);const E=new Pt;E.copyPosition(h);const _=E.clone().invert().multiply(h),b=x.clone().invert().multiply(_),C=r,I=new Pt;if(g===0)I.copy(x).multiply(y).multiply(b).multiply(C);else if(g===1)I.copy(x).multiply(b).multiply(y).multiply(C);else{const U=new Pt().scale(new de().setFromMatrixScale(f)).clone().invert(),j=b.clone().multiply(U);I.copy(x).multiply(y).multiply(j).multiply(C)}const M=c.clone().invert(),R=a.clone().invert();let D=e.clone().multiply(l).multiply(c).multiply(t).multiply(n).multiply(i).multiply(M).multiply(o).multiply(a).multiply(r).multiply(R);const P=new Pt().copyPosition(D),L=h.clone().multiply(P);return p.copyPosition(L),D=p.clone().multiply(I),D.premultiply(h.invert()),D}function Y4(s){s=s||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return s===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[s]}function DM(s){return s.split(",").map(function(t){return parseFloat(t)})}function X4(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=s.byteLength),new TextDecoder().decode(new Uint8Array(s,e,t))}function ace(s,e){for(let t=0,n=s.length,i=e.length;t<i;t++,n++)s[n]=e[t]}function oce(s,e,t,n){for(let i=t,r=0;i<n;i++,r++)s[r]=e[i];return s}function rF(s,e,t){return s.slice(0,e).concat(t).concat(s.slice(e))}class lD extends bi{ignoreObjects;isReflector;camera;material;getRenderTarget;dispose;constructor(e,t={}){super(e);const n=t.ignoreObjects||[];this.ignoreObjects=n,this.isReflector=!0,this.type="Reflector",this.camera=new Ki;const i=this,r=t.color!==void 0?new Tt(t.color):new Tt(8355711),a=t.textureWidth||512,o=t.textureHeight||512,l=t.clipBias||0,c=t.shader||lD.ReflectorShader,h=t.multisample!==void 0?t.multisample:4,f=new xh,p=new de,g=new de,y=new de,x=new Pt,E=new de(0,0,-1),_=new Tn,b=new de,C=new de,I=new Tn,M=new Pt,R=this.camera,D=new _l(a,o,{samples:h,type:hr}),P=new Ra({uniforms:UT.clone(c.uniforms),fragmentShader:c.fragmentShader,vertexShader:c.vertexShader});P.uniforms.tDiffuse.value=D.texture,P.uniforms.color.value=r,P.uniforms.textureMatrix.value=M,this.material=P,this.onBeforeRender=function(L,O,U){if(g.setFromMatrixPosition(i.matrixWorld),y.setFromMatrixPosition(U.matrixWorld),x.extractRotation(i.matrixWorld),p.set(0,0,1),p.applyMatrix4(x),b.subVectors(g,y),b.dot(p)>0)return;b.reflect(p).negate(),b.add(g),x.extractRotation(U.matrixWorld),E.set(0,0,-1),E.applyMatrix4(x),E.add(y),C.subVectors(g,E),C.reflect(p).negate(),C.add(g),R.position.copy(b),R.up.set(0,1,0),R.up.applyMatrix4(x),R.up.reflect(p),R.lookAt(C),R.far=U.far,R.updateMatrixWorld(),R.projectionMatrix.copy(U.projectionMatrix),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(R.projectionMatrix),M.multiply(R.matrixWorldInverse),M.multiply(i.matrixWorld),f.setFromNormalAndCoplanarPoint(p,g),f.applyMatrix4(R.matrixWorldInverse),_.set(f.normal.x,f.normal.y,f.normal.z,f.constant);const j=R.projectionMatrix;I.x=(Math.sign(_.x)+j.elements[8])/j.elements[0],I.y=(Math.sign(_.y)+j.elements[9])/j.elements[5],I.z=-1,I.w=(1+j.elements[10])/j.elements[14],_.multiplyScalar(2/_.dot(I)),j.elements[2]=_.x,j.elements[6]=_.y,j.elements[10]=_.z+1-l,j.elements[14]=_.w,i.visible=!1,n.forEach(K=>{K.visible=!1});const H=L.getRenderTarget(),z=L.xr.enabled,q=L.shadowMap.autoUpdate,k=L.outputEncoding,W=L.toneMapping;let V=!1;"outputColorSpace"in L?V=L.outputColorSpace==="srgb":V=L.outputEncoding===3001,L.xr.enabled=!1,L.shadowMap.autoUpdate=!1,"outputColorSpace"in L?L.outputColorSpace=V?"srgb":"srgb-linear":L.outputEncoding=V?3001:3e3,L.toneMapping=hc,L.setRenderTarget(D),L.state.buffers.depth.setMask(!0),L.autoClear===!1&&L.clear(),L.render(O,R),L.xr.enabled=z,L.shadowMap.autoUpdate=q,L.outputEncoding=k,L.toneMapping=W,L.setRenderTarget(H);const X=U.viewport;X!==void 0&&L.state.viewport(X),i.visible=!0,n.forEach(K=>{K.visible=!0})},this.getRenderTarget=function(){return D},this.dispose=function(){D.dispose(),i.material.dispose()}}}lD.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <encodings_fragment>

		}`};class uc{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new ce);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new ce);const n=this.elements,i=e.x,r=e.y,a=e.z;return t.x=n[0]*i+n[1]*r+n[2]*a,t.y=n[3]*i+n[4]*r+n[5]*a,t.z=n[6]*i+n[7]*r+n[8]*a,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new uc);const n=this.elements,i=e.elements,r=t.elements,a=n[0],o=n[1],l=n[2],c=n[3],h=n[4],f=n[5],p=n[6],g=n[7],y=n[8],x=i[0],E=i[1],_=i[2],b=i[3],C=i[4],I=i[5],M=i[6],R=i[7],D=i[8];return r[0]=a*x+o*b+l*M,r[1]=a*E+o*C+l*R,r[2]=a*_+o*I+l*D,r[3]=c*x+h*b+f*M,r[4]=c*E+h*C+f*R,r[5]=c*_+h*I+f*D,r[6]=p*x+g*b+y*M,r[7]=p*E+g*C+y*R,r[8]=p*_+g*I+y*D,t}scale(e,t){t===void 0&&(t=new uc);const n=this.elements,i=t.elements;for(let r=0;r!==3;r++)i[3*r+0]=e.x*n[3*r+0],i[3*r+1]=e.y*n[3*r+1],i[3*r+2]=e.z*n[3*r+2];return t}solve(e,t){t===void 0&&(t=new ce);const n=3,i=4,r=[];let a,o;for(a=0;a<n*i;a++)r.push(0);for(a=0;a<3;a++)for(o=0;o<3;o++)r[a+i*o]=this.elements[a+3*o];r[3]=e.x,r[7]=e.y,r[11]=e.z;let l=3;const c=l;let h;const f=4;let p;do{if(a=c-l,r[a+i*a]===0){for(o=a+1;o<c;o++)if(r[a+i*o]!==0){h=f;do p=f-h,r[p+i*a]+=r[p+i*o];while(--h);break}}if(r[a+i*a]!==0)for(o=a+1;o<c;o++){const g=r[a+i*o]/r[a+i*a];h=f;do p=f-h,r[p+i*o]=p<=a?0:r[p+i*o]-r[p+i*a]*g;while(--h)}}while(--l);if(t.z=r[2*i+3]/r[2*i+2],t.y=(r[1*i+3]-r[1*i+2]*t.z)/r[1*i+1],t.x=(r[0*i+3]-r[0*i+2]*t.z-r[0*i+1]*t.y)/r[0*i+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let n=0;n<9;n++)e+=this.elements[n]+",";return e}reverse(e){e===void 0&&(e=new uc);const t=3,n=6,i=lce;let r,a;for(r=0;r<3;r++)for(a=0;a<3;a++)i[r+n*a]=this.elements[r+3*a];i[3]=1,i[9]=0,i[15]=0,i[4]=0,i[10]=1,i[16]=0,i[5]=0,i[11]=0,i[17]=1;let o=3;const l=o;let c;const h=n;let f;do{if(r=l-o,i[r+n*r]===0){for(a=r+1;a<l;a++)if(i[r+n*a]!==0){c=h;do f=h-c,i[f+n*r]+=i[f+n*a];while(--c);break}}if(i[r+n*r]!==0)for(a=r+1;a<l;a++){const p=i[r+n*a]/i[r+n*r];c=h;do f=h-c,i[f+n*a]=f<=r?0:i[f+n*a]-i[f+n*r]*p;while(--c)}}while(--o);r=2;do{a=r-1;do{const p=i[r+n*a]/i[r+n*r];c=n;do f=n-c,i[f+n*a]=i[f+n*a]-i[f+n*r]*p;while(--c)}while(a--)}while(--r);r=2;do{const p=1/i[r+n*r];c=n;do f=n-c,i[f+n*r]=i[f+n*r]*p;while(--c)}while(r--);r=2;do{a=2;do{if(f=i[t+a+n*r],isNaN(f)||f===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(r,a,f)}while(a--)}while(r--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,r=e.w,a=t+t,o=n+n,l=i+i,c=t*a,h=t*o,f=t*l,p=n*o,g=n*l,y=i*l,x=r*a,E=r*o,_=r*l,b=this.elements;return b[0]=1-(p+y),b[1]=h-_,b[2]=f+E,b[3]=h+_,b[4]=1-(c+y),b[5]=g-x,b[6]=f-E,b[7]=g+x,b[8]=1-(c+p),this}transpose(e){e===void 0&&(e=new uc);const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const lce=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class ce{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new ce);const n=e.x,i=e.y,r=e.z,a=this.x,o=this.y,l=this.z;return t.x=o*r-l*i,t.y=l*n-a*r,t.z=a*i-o*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new ce(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new ce(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new uc([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const r=1/i;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return i}unit(e){e===void 0&&(e=new ce);const t=this.x,n=this.y,i=this.z;let r=Math.sqrt(t*t+n*n+i*i);return r>0?(r=1/r,e.x=t*r,e.y=n*r,e.z=i*r):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z;return Math.sqrt((r-t)*(r-t)+(a-n)*(a-n)+(o-i)*(o-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z;return(r-t)*(r-t)+(a-n)*(a-n)+(o-i)*(o-i)}scale(e,t){t===void 0&&(t=new ce);const n=this.x,i=this.y,r=this.z;return t.x=e*n,t.y=e*i,t.z=e*r,t}vmul(e,t){return t===void 0&&(t=new ce),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new ce),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new ce),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=cce,r=1/n;i.set(this.x*r,this.y*r,this.z*r);const a=uce;Math.abs(i.x)<.9?(a.set(1,0,0),i.cross(a,e)):(a.set(0,1,0),i.cross(a,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,r=this.y,a=this.z;n.x=i+(e.x-i)*t,n.y=r+(e.y-r)*t,n.z=a+(e.z-a)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(aF),aF.almostEquals(e,t)}clone(){return new ce(this.x,this.y,this.z)}}ce.ZERO=new ce(0,0,0);ce.UNIT_X=new ce(1,0,0);ce.UNIT_Y=new ce(0,1,0);ce.UNIT_Z=new ce(0,0,1);const cce=new ce,uce=new ce,aF=new ce;class Qo{constructor(e){e===void 0&&(e={}),this.lowerBound=new ce,this.upperBound=new ce,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const r=this.lowerBound,a=this.upperBound,o=n;r.copy(e[0]),o&&o.vmult(r,r),a.copy(r);for(let l=1;l<e.length;l++){let c=e[l];o&&(o.vmult(c,oF),c=oF),c.x>a.x&&(a.x=c.x),c.x<r.x&&(r.x=c.x),c.y>a.y&&(a.y=c.y),c.y<r.y&&(r.y=c.y),c.z>a.z&&(a.z=c.z),c.z<r.z&&(r.z=c.z)}return t&&(t.vadd(r,r),t.vadd(a,a)),i&&(r.x-=i,r.y-=i,r.z-=i,a.x+=i,a.y+=i,a.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Qo().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound,a=i.x<=n.x&&n.x<=r.x||t.x<=r.x&&r.x<=n.x,o=i.y<=n.y&&n.y<=r.y||t.y<=r.y&&r.y<=n.y,l=i.z<=n.z&&n.z<=r.z||t.z<=r.z&&r.z<=n.z;return a&&o&&l}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound;return t.x<=i.x&&n.x>=r.x&&t.y<=i.y&&n.y>=r.y&&t.z<=i.z&&n.z>=r.z}getCorners(e,t,n,i,r,a,o,l){const c=this.lowerBound,h=this.upperBound;e.copy(c),t.set(h.x,c.y,c.z),n.set(h.x,h.y,c.z),i.set(c.x,h.y,h.z),r.set(h.x,c.y,h.z),a.set(c.x,h.y,c.z),o.set(c.x,c.y,h.z),l.copy(h)}toLocalFrame(e,t){const n=lF,i=n[0],r=n[1],a=n[2],o=n[3],l=n[4],c=n[5],h=n[6],f=n[7];this.getCorners(i,r,a,o,l,c,h,f);for(let p=0;p!==8;p++){const g=n[p];e.pointToLocal(g,g)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=lF,i=n[0],r=n[1],a=n[2],o=n[3],l=n[4],c=n[5],h=n[6],f=n[7];this.getCorners(i,r,a,o,l,c,h,f);for(let p=0;p!==8;p++){const g=n[p];e.pointToWorld(g,g)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,r=1/t.y,a=1/t.z,o=(this.lowerBound.x-n.x)*i,l=(this.upperBound.x-n.x)*i,c=(this.lowerBound.y-n.y)*r,h=(this.upperBound.y-n.y)*r,f=(this.lowerBound.z-n.z)*a,p=(this.upperBound.z-n.z)*a,g=Math.max(Math.max(Math.min(o,l),Math.min(c,h)),Math.min(f,p)),y=Math.min(Math.min(Math.max(o,l),Math.max(c,h)),Math.max(f,p));return!(y<0||g>y)}}const oF=new ce,lF=[new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce];class cF{constructor(){this.matrix=[]}get(e,t){let{index:n}=e,{index:i}=t;if(i>n){const r=i;i=n,n=r}return this.matrix[(n*(n+1)>>1)+i-1]}set(e,t,n){let{index:i}=e,{index:r}=t;if(r>i){const a=r;r=i,i=a}this.matrix[(i*(i+1)>>1)+r-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class W4{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return!!(n[e]!==void 0&&n[e].includes(t))}hasAnyEventListener(e){return this._listeners===void 0?!1:this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners;if(n[e]===void 0)return this;const i=n[e].indexOf(t);return i!==-1&&n[e].splice(i,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const n=this._listeners[e.type];if(n!==void 0){e.target=this;for(let i=0,r=n.length;i<r;i++)n[i].call(this,e)}return this}}class Ys{constructor(e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),i===void 0&&(i=1),this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new ce),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=hce,i=fce;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Ys);const n=this.x,i=this.y,r=this.z,a=this.w,o=e.x,l=e.y,c=e.z,h=e.w;return t.x=n*h+a*o+i*c-r*l,t.y=i*h+a*l+r*o-n*c,t.z=r*h+a*c+n*l-i*o,t.w=a*h-n*o-i*l-r*c,t}inverse(e){e===void 0&&(e=new Ys);const t=this.x,n=this.y,i=this.z,r=this.w;this.conjugate(e);const a=1/(t*t+n*n+i*i+r*r);return e.x*=a,e.y*=a,e.z*=a,e.w*=a,e}conjugate(e){return e===void 0&&(e=new Ys),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new ce);const n=e.x,i=e.y,r=e.z,a=this.x,o=this.y,l=this.z,c=this.w,h=c*n+o*r-l*i,f=c*i+l*n-a*r,p=c*r+a*i-o*n,g=-a*n-o*i-l*r;return t.x=h*c+g*-a+f*-l-p*-o,t.y=f*c+g*-o+p*-a-h*-l,t.z=p*c+g*-l+h*-o-f*-a,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,i,r;const a=this.x,o=this.y,l=this.z,c=this.w;switch(t){case"YZX":const h=a*o+l*c;if(h>.499&&(n=2*Math.atan2(a,c),i=Math.PI/2,r=0),h<-.499&&(n=-2*Math.atan2(a,c),i=-Math.PI/2,r=0),n===void 0){const f=a*a,p=o*o,g=l*l;n=Math.atan2(2*o*c-2*a*l,1-2*p-2*g),i=Math.asin(2*h),r=Math.atan2(2*a*c-2*o*l,1-2*f-2*g)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=i,e.x=r}setFromEuler(e,t,n,i){i===void 0&&(i="XYZ");const r=Math.cos(e/2),a=Math.cos(t/2),o=Math.cos(n/2),l=Math.sin(e/2),c=Math.sin(t/2),h=Math.sin(n/2);return i==="XYZ"?(this.x=l*a*o+r*c*h,this.y=r*c*o-l*a*h,this.z=r*a*h+l*c*o,this.w=r*a*o-l*c*h):i==="YXZ"?(this.x=l*a*o+r*c*h,this.y=r*c*o-l*a*h,this.z=r*a*h-l*c*o,this.w=r*a*o+l*c*h):i==="ZXY"?(this.x=l*a*o-r*c*h,this.y=r*c*o+l*a*h,this.z=r*a*h+l*c*o,this.w=r*a*o-l*c*h):i==="ZYX"?(this.x=l*a*o-r*c*h,this.y=r*c*o+l*a*h,this.z=r*a*h-l*c*o,this.w=r*a*o+l*c*h):i==="YZX"?(this.x=l*a*o+r*c*h,this.y=r*c*o+l*a*h,this.z=r*a*h-l*c*o,this.w=r*a*o-l*c*h):i==="XZY"&&(this.x=l*a*o-r*c*h,this.y=r*c*o-l*a*h,this.z=r*a*h+l*c*o,this.w=r*a*o+l*c*h),this}clone(){return new Ys(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new Ys);const i=this.x,r=this.y,a=this.z,o=this.w;let l=e.x,c=e.y,h=e.z,f=e.w,p,g,y,x,E;return g=i*l+r*c+a*h+o*f,g<0&&(g=-g,l=-l,c=-c,h=-h,f=-f),1-g>1e-6?(p=Math.acos(g),y=Math.sin(p),x=Math.sin((1-t)*p)/y,E=Math.sin(t*p)/y):(x=1-t,E=t),n.x=x*i+E*l,n.y=x*r+E*c,n.z=x*a+E*h,n.w=x*o+E*f,n}integrate(e,t,n,i){i===void 0&&(i=new Ys);const r=e.x*n.x,a=e.y*n.y,o=e.z*n.z,l=this.x,c=this.y,h=this.z,f=this.w,p=t*.5;return i.x+=p*(r*f+a*h-o*c),i.y+=p*(a*f+o*l-r*h),i.z+=p*(o*f+r*c-a*l),i.w+=p*(-r*l-a*c-o*h),i}}const hce=new ce,fce=new ce,dce={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Yt{constructor(e){e===void 0&&(e={}),this.id=Yt.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Yt.idCounter=0;Yt.types=dce;class hi{constructor(e){e===void 0&&(e={}),this.position=new ce,this.quaternion=new Ys,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return hi.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return hi.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new ce),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return i===void 0&&(i=new ce),n.vsub(e,i),t.conjugate(uF),uF.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return i===void 0&&(i=new ce),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new ce),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return i===void 0&&(i=new ce),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const uF=new Ys;class _v extends Yt{constructor(e){e===void 0&&(e={});const{vertices:t=[],faces:n=[],normals:i=[],axes:r,boundingSphereRadius:a}=e;super({type:Yt.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=n,this.faceNormals=i,this.faceNormals.length===0&&this.computeNormals(),a?this.boundingSphereRadius=a:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=r?r.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const i=new ce;for(let r=0;r!==e.length;r++){const a=e[r],o=a.length;for(let l=0;l!==o;l++){const c=(l+1)%o;t[a[l]].vsub(t[a[c]],i),i.normalize();let h=!1;for(let f=0;f!==n.length;f++)if(n[f].almostEquals(i)||n[f].almostEquals(i)){h=!0;break}h||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let i=0;i<this.faces[e].length;i++)if(!this.vertices[this.faces[e][i]])throw new Error(`Vertex ${this.faces[e][i]} not found!`);const t=this.faceNormals[e]||new ce;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let i=0;i<this.faces[e].length;i++)console.warn(`.vertices[${this.faces[e][i]}] = Vec3(${this.vertices[this.faces[e][i]].toString()})`)}}}getFaceNormal(e,t){const n=this.faces[e],i=this.vertices[n[0]],r=this.vertices[n[1]],a=this.vertices[n[2]];_v.computeNormal(i,r,a,t)}static computeNormal(e,t,n,i){const r=new ce,a=new ce;t.vsub(e,a),n.vsub(t,r),r.cross(a,i),i.isZero()||i.normalize()}clipAgainstHull(e,t,n,i,r,a,o,l,c){const h=new ce;let f=-1,p=-Number.MAX_VALUE;for(let y=0;y<n.faces.length;y++){h.copy(n.faceNormals[y]),r.vmult(h,h);const x=h.dot(a);x>p&&(p=x,f=y)}const g=[];for(let y=0;y<n.faces[f].length;y++){const x=n.vertices[n.faces[f][y]],E=new ce;E.copy(x),r.vmult(E,E),i.vadd(E,E),g.push(E)}f>=0&&this.clipFaceAgainstHull(a,e,t,g,o,l,c)}findSeparatingAxis(e,t,n,i,r,a,o,l){const c=new ce,h=new ce,f=new ce,p=new ce,g=new ce,y=new ce;let x=Number.MAX_VALUE;const E=this;if(E.uniqueAxes)for(let _=0;_!==E.uniqueAxes.length;_++){n.vmult(E.uniqueAxes[_],c);const b=E.testSepAxis(c,e,t,n,i,r);if(b===!1)return!1;b<x&&(x=b,a.copy(c))}else{const _=o?o.length:E.faces.length;for(let b=0;b<_;b++){const C=o?o[b]:b;c.copy(E.faceNormals[C]),n.vmult(c,c);const I=E.testSepAxis(c,e,t,n,i,r);if(I===!1)return!1;I<x&&(x=I,a.copy(c))}}if(e.uniqueAxes)for(let _=0;_!==e.uniqueAxes.length;_++){r.vmult(e.uniqueAxes[_],h);const b=E.testSepAxis(h,e,t,n,i,r);if(b===!1)return!1;b<x&&(x=b,a.copy(h))}else{const _=l?l.length:e.faces.length;for(let b=0;b<_;b++){const C=l?l[b]:b;h.copy(e.faceNormals[C]),r.vmult(h,h);const I=E.testSepAxis(h,e,t,n,i,r);if(I===!1)return!1;I<x&&(x=I,a.copy(h))}}for(let _=0;_!==E.uniqueEdges.length;_++){n.vmult(E.uniqueEdges[_],p);for(let b=0;b!==e.uniqueEdges.length;b++)if(r.vmult(e.uniqueEdges[b],g),p.cross(g,y),!y.almostZero()){y.normalize();const C=E.testSepAxis(y,e,t,n,i,r);if(C===!1)return!1;C<x&&(x=C,a.copy(y))}}return i.vsub(t,f),f.dot(a)>0&&a.negate(a),!0}testSepAxis(e,t,n,i,r,a){const o=this;_v.project(o,e,n,i,LM),_v.project(t,e,r,a,OM);const l=LM[0],c=LM[1],h=OM[0],f=OM[1];if(l<f||h<c)return!1;const p=l-f,g=h-c;return p<g?p:g}calculateLocalInertia(e,t){const n=new ce,i=new ce;this.computeLocalAABB(i,n);const r=n.x-i.x,a=n.y-i.y,o=n.z-i.z;t.x=1/12*e*(2*a*2*a+2*o*2*o),t.y=1/12*e*(2*r*2*r+2*o*2*o),t.z=1/12*e*(2*a*2*a+2*r*2*r)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]];return-n.dot(i)}clipFaceAgainstHull(e,t,n,i,r,a,o){const l=new ce,c=new ce,h=new ce,f=new ce,p=new ce,g=new ce,y=new ce,x=new ce,E=this,_=[],b=i,C=_;let I=-1,M=Number.MAX_VALUE;for(let O=0;O<E.faces.length;O++){l.copy(E.faceNormals[O]),n.vmult(l,l);const U=l.dot(e);U<M&&(M=U,I=O)}if(I<0)return;const R=E.faces[I];R.connectedFaces=[];for(let O=0;O<E.faces.length;O++)for(let U=0;U<E.faces[O].length;U++)R.indexOf(E.faces[O][U])!==-1&&O!==I&&R.connectedFaces.indexOf(O)===-1&&R.connectedFaces.push(O);const D=R.length;for(let O=0;O<D;O++){const U=E.vertices[R[O]],j=E.vertices[R[(O+1)%D]];U.vsub(j,c),h.copy(c),n.vmult(h,h),t.vadd(h,h),f.copy(this.faceNormals[I]),n.vmult(f,f),t.vadd(f,f),h.cross(f,p),p.negate(p),g.copy(U),n.vmult(g,g),t.vadd(g,g);const H=R.connectedFaces[O];y.copy(this.faceNormals[H]);const z=this.getPlaneConstantOfFace(H);x.copy(y),n.vmult(x,x);const q=z-x.dot(t);for(this.clipFaceAgainstPlane(b,C,x,q);b.length;)b.shift();for(;C.length;)b.push(C.shift())}y.copy(this.faceNormals[I]);const P=this.getPlaneConstantOfFace(I);x.copy(y),n.vmult(x,x);const L=P-x.dot(t);for(let O=0;O<b.length;O++){let U=x.dot(b[O])+L;if(U<=r&&(console.log(`clamped: depth=${U} to minDist=${r}`),U=r),U<=a){const j=b[O];if(U<=1e-6){const H={point:j,normal:x,depth:U};o.push(H)}}}}clipFaceAgainstPlane(e,t,n,i){let r,a;const o=e.length;if(o<2)return t;let l=e[e.length-1],c=e[0];r=n.dot(l)+i;for(let h=0;h<o;h++){if(c=e[h],a=n.dot(c)+i,r<0)if(a<0){const f=new ce;f.copy(c),t.push(f)}else{const f=new ce;l.lerp(c,r/(r-a),f),t.push(f)}else if(a<0){const f=new ce;l.lerp(c,r/(r-a),f),t.push(f),t.push(c)}l=c,r=a}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new ce);const n=this.vertices,i=this.worldVertices;for(let r=0;r!==this.vertices.length;r++)t.vmult(n[r],i[r]),e.vadd(i[r],i[r]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const r=n[i];r.x<e.x?e.x=r.x:r.x>t.x&&(t.x=r.x),r.y<e.y?e.y=r.y:r.y>t.y&&(t.y=r.y),r.z<e.z?e.z=r.z:r.z>t.z&&(t.z=r.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new ce);const n=this.faceNormals,i=this.worldFaceNormals;for(let r=0;r!==t;r++)e.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const i=t[n].lengthSquared();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const r=this.vertices;let a,o,l,c,h,f,p=new ce;for(let g=0;g<r.length;g++){p.copy(r[g]),t.vmult(p,p),e.vadd(p,p);const y=p;(a===void 0||y.x<a)&&(a=y.x),(c===void 0||y.x>c)&&(c=y.x),(o===void 0||y.y<o)&&(o=y.y),(h===void 0||y.y>h)&&(h=y.y),(l===void 0||y.z<l)&&(l=y.z),(f===void 0||y.z>f)&&(f=y.z)}n.set(a,o,l),i.set(c,h,f)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new ce);const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,i=this.vertices;if(t){for(let r=0;r<n;r++){const a=i[r];t.vmult(a,a)}for(let r=0;r<this.faceNormals.length;r++){const a=this.faceNormals[r];t.vmult(a,a)}}if(e)for(let r=0;r<n;r++){const a=i[r];a.vadd(e,a)}}pointIsInside(e){const t=this.vertices,n=this.faces,i=this.faceNormals,r=new ce;this.getAveragePointLocal(r);for(let a=0;a<this.faces.length;a++){let o=i[a];const l=t[n[a][0]],c=new ce;e.vsub(l,c);const h=o.dot(c),f=new ce;r.vsub(l,f);const p=o.dot(f);if(h<0&&p>0||h>0&&p<0)return!1}return-1}static project(e,t,n,i,r){const a=e.vertices.length,o=pce;let l=0,c=0;const h=mce,f=e.vertices;h.setZero(),hi.vectorToLocalFrame(n,i,t,o),hi.pointToLocalFrame(n,i,h,h);const p=h.dot(o);c=l=f[0].dot(o);for(let g=1;g<a;g++){const y=f[g].dot(o);y>l&&(l=y),y<c&&(c=y)}if(c-=p,l-=p,c>l){const g=c;c=l,l=g}r[0]=l,r[1]=c}}const LM=[],OM=[];new ce;const pce=new ce,mce=new ce;class cD extends Yt{constructor(e){super({type:Yt.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=ce,r=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],a=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],o=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],l=new _v({vertices:r,faces:a,axes:o});this.convexPolyhedronRepresentation=l,l.material=this.material}calculateLocalInertia(e,t){return t===void 0&&(t=new ce),cD.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(e,t){const n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),t!==void 0)for(let r=0;r!==n.length;r++)t.vmult(n[r],n[r]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let a=0;a<r.length;a++)Qf.set(r[a][0],r[a][1],r[a][2]),t.vmult(Qf,Qf),e.vadd(Qf,Qf),n(Qf.x,Qf.y,Qf.z)}calculateWorldAABB(e,t,n,i){const r=this.halfExtents;au[0].set(r.x,r.y,r.z),au[1].set(-r.x,r.y,r.z),au[2].set(-r.x,-r.y,r.z),au[3].set(-r.x,-r.y,-r.z),au[4].set(r.x,-r.y,-r.z),au[5].set(r.x,r.y,-r.z),au[6].set(-r.x,r.y,-r.z),au[7].set(r.x,-r.y,r.z);const a=au[0];t.vmult(a,a),e.vadd(a,a),i.copy(a),n.copy(a);for(let o=1;o<8;o++){const l=au[o];t.vmult(l,l),e.vadd(l,l);const c=l.x,h=l.y,f=l.z;c>i.x&&(i.x=c),h>i.y&&(i.y=h),f>i.z&&(i.z=f),c<n.x&&(n.x=c),h<n.y&&(n.y=h),f<n.z&&(n.z=f)}}}const Qf=new ce,au=[new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce],uD={DYNAMIC:1,STATIC:2,KINEMATIC:4},hD={AWAKE:0,SLEEPY:1,SLEEPING:2};class Xt extends W4{constructor(e){e===void 0&&(e={}),super(),this.id=Xt.idCounter++,this.index=-1,this.world=null,this.vlambda=new ce,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse=="boolean"?e.collisionResponse:!0,this.position=new ce,this.previousPosition=new ce,this.interpolatedPosition=new ce,this.initPosition=new ce,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new ce,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new ce,this.force=new ce;const t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?Xt.STATIC:Xt.DYNAMIC,typeof e.type==typeof Xt.STATIC&&(this.type=e.type),this.allowSleep=typeof e.allowSleep<"u"?e.allowSleep:!0,this.sleepState=Xt.AWAKE,this.sleepSpeedLimit=typeof e.sleepSpeedLimit<"u"?e.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof e.sleepTimeLimit<"u"?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new ce,this.quaternion=new Ys,this.initQuaternion=new Ys,this.previousQuaternion=new Ys,this.interpolatedQuaternion=new Ys,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new ce,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new ce,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new ce,this.invInertia=new ce,this.invInertiaWorld=new uc,this.invMassSolve=0,this.invInertiaSolve=new ce,this.invInertiaWorldSolve=new uc,this.fixedRotation=typeof e.fixedRotation<"u"?e.fixedRotation:!1,this.angularDamping=typeof e.angularDamping<"u"?e.angularDamping:.01,this.linearFactor=new ce(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new ce(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new Qo,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new ce,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=Xt.AWAKE,this.wakeUpAfterNarrowphase=!1,e===Xt.SLEEPING&&this.dispatchEvent(Xt.wakeupEvent)}sleep(){this.sleepState=Xt.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;t===Xt.AWAKE&&n<i?(this.sleepState=Xt.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(Xt.sleepyEvent)):t===Xt.SLEEPY&&n>i?this.wakeUp():t===Xt.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Xt.sleepEvent))}}updateSolveMassProperties(){this.sleepState===Xt.SLEEPING||this.type===Xt.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return t===void 0&&(t=new ce),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return t===void 0&&(t=new ce),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return t===void 0&&(t=new ce),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return t===void 0&&(t=new ce),this.quaternion.vmult(e,t),t}addShape(e,t,n){const i=new ce,r=new Ys;return t&&i.copy(t),n&&r.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let i=0;for(let r=0;r!==n;r++){const a=e[r];a.updateBoundingSphereRadius();const o=t[r].length(),l=a.boundingSphereRadius;o+l>i&&(i=o+l)}this.boundingRadius=i}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,r=gce,a=Ace,o=this.quaternion,l=this.aabb,c=yce;for(let h=0;h!==i;h++){const f=e[h];o.vmult(t[h],r),r.vadd(this.position,r),o.mult(n[h],a),f.calculateWorldAABB(r,a,c.lowerBound,c.upperBound),h===0?l.copy(c):l.extend(c)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(!(t.x===t.y&&t.y===t.z&&!e)){const n=vce,i=Ece;n.setRotationFromQuaternion(this.quaternion),n.transpose(i),n.scale(t,n),n.mmult(i,this.invInertiaWorld)}}applyForce(e,t){if(t===void 0&&(t=new ce),this.type!==Xt.DYNAMIC)return;this.sleepState===Xt.SLEEPING&&this.wakeUp();const n=xce;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t){if(t===void 0&&(t=new ce),this.type!==Xt.DYNAMIC)return;const n=_ce,i=Sce;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyForce(n,i)}applyTorque(e){this.type===Xt.DYNAMIC&&(this.sleepState===Xt.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(t===void 0&&(t=new ce),this.type!==Xt.DYNAMIC)return;this.sleepState===Xt.SLEEPING&&this.wakeUp();const n=t,i=bce;i.copy(e),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const r=Tce;n.cross(e,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}applyLocalImpulse(e,t){if(t===void 0&&(t=new ce),this.type!==Xt.DYNAMIC)return;const n=Cce,i=Ice;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyImpulse(n,i)}updateMassProperties(){const e=Mce;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),cD.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new ce;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===Xt.DYNAMIC||this.type===Xt.KINEMATIC)||this.sleepState===Xt.SLEEPING)return;const i=this.velocity,r=this.angularVelocity,a=this.position,o=this.force,l=this.torque,c=this.quaternion,h=this.invMass,f=this.invInertiaWorld,p=this.linearFactor,g=h*e;i.x+=o.x*g*p.x,i.y+=o.y*g*p.y,i.z+=o.z*g*p.z;const y=f.elements,x=this.angularFactor,E=l.x*x.x,_=l.y*x.y,b=l.z*x.z;r.x+=e*(y[0]*E+y[1]*_+y[2]*b),r.y+=e*(y[3]*E+y[4]*_+y[5]*b),r.z+=e*(y[6]*E+y[7]*_+y[8]*b),a.x+=i.x*e,a.y+=i.y*e,a.z+=i.z*e,c.integrate(this.angularVelocity,e,this.angularFactor,c),t&&(n?c.normalizeFast():c.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}Xt.idCounter=0;Xt.COLLIDE_EVENT_NAME="collide";Xt.DYNAMIC=uD.DYNAMIC;Xt.STATIC=uD.STATIC;Xt.KINEMATIC=uD.KINEMATIC;Xt.AWAKE=hD.AWAKE;Xt.SLEEPY=hD.SLEEPY;Xt.SLEEPING=hD.SLEEPING;Xt.wakeupEvent={type:"wakeup"};Xt.sleepyEvent={type:"sleepy"};Xt.sleepEvent={type:"sleep"};const gce=new ce,Ace=new Ys,yce=new Qo,vce=new uc,Ece=new uc;new uc;const xce=new ce,_ce=new ce,Sce=new ce,bce=new ce,Tce=new ce,Cce=new ce,Ice=new ce,Mce=new ce;class wce{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return!((e.collisionFilterGroup&t.collisionFilterMask)===0||(t.collisionFilterGroup&e.collisionFilterMask)===0||((e.type&Xt.STATIC)!==0||e.sleepState===Xt.SLEEPING)&&((t.type&Xt.STATIC)!==0||t.sleepState===Xt.SLEEPING))}intersectionTest(e,t,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,i):this.doBoundingSphereBroadphase(e,t,n,i)}doBoundingSphereBroadphase(e,t,n,i){const r=Rce;t.position.vsub(e.position,r);const a=(e.boundingRadius+t.boundingRadius)**2;r.lengthSquared()<a&&(n.push(e),i.push(t))}doBoundingBoxBroadphase(e,t,n,i){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),i.push(t))}makePairsUnique(e,t){const n=Bce,i=Dce,r=Lce,a=e.length;for(let o=0;o!==a;o++)i[o]=e[o],r[o]=t[o];e.length=0,t.length=0;for(let o=0;o!==a;o++){const l=i[o].id,c=r[o].id,h=l<c?`${l},${c}`:`${c},${l}`;n[h]=o,n.keys.push(h)}for(let o=0;o!==n.keys.length;o++){const l=n.keys.pop(),c=n[l];e.push(i[c]),t.push(r[c]),delete n[l]}}setWorld(e){}static boundingSphereCheck(e,t){const n=new ce;e.position.vsub(t.position,n);const i=e.shapes[0],r=t.shapes[0];return Math.pow(i.boundingSphereRadius+r.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const Rce=new ce;new ce;new Ys;new ce;const Bce={keys:[]},Dce=[],Lce=[];new ce;new ce;new ce;class Oce extends wce{constructor(){super()}collisionPairs(e,t,n){const i=e.bodies,r=i.length;let a,o;for(let l=0;l!==r;l++)for(let c=0;c!==l;c++)a=i[l],o=i[c],this.needBroadphaseCollision(a,o)&&this.intersectionTest(a,o,t,n)}aabbQuery(e,t,n){n===void 0&&(n=[]);for(let i=0;i<e.bodies.length;i++){const r=e.bodies[i];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(t)&&n.push(r)}return n}}class hT{constructor(){this.rayFromWorld=new ce,this.rayToWorld=new ce,this.hitNormalWorld=new ce,this.hitPointWorld=new ce,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,r,a,o){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=a,this.distance=o}}let $4,J4,Z4,ez,tz,nz,iz;const fD={CLOSEST:1,ANY:2,ALL:4};$4=Yt.types.SPHERE;J4=Yt.types.PLANE;Z4=Yt.types.BOX;ez=Yt.types.CYLINDER;tz=Yt.types.CONVEXPOLYHEDRON;nz=Yt.types.HEIGHTFIELD;iz=Yt.types.TRIMESH;class Vs{get[$4](){return this._intersectSphere}get[J4](){return this._intersectPlane}get[Z4](){return this._intersectBox}get[ez](){return this._intersectConvex}get[tz](){return this._intersectConvex}get[nz](){return this._intersectHeightfield}get[iz](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new ce),t===void 0&&(t=new ce),this.from=e.clone(),this.to=t.clone(),this.direction=new ce,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Vs.ANY,this.result=new hT,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Vs.ANY,this.result=t.result||new hT,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(hF),PM.length=0,e.broadphase.aabbQuery(e,hF,PM),this.intersectBodies(PM),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;const i=Pce,r=Nce;for(let a=0,o=e.shapes.length;a<o;a++){const l=e.shapes[a];if(!(n&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[a],r),e.quaternion.vmult(e.shapeOffsets[a],i),i.vadd(e.position,i),this.intersectShape(l,r,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){const r=this.from;if(Wce(r,this.direction,n)>e.boundingSphereRadius)return;const o=this[e.type];o&&o.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,r)}_intersectPlane(e,t,n,i,r){const a=this.from,o=this.to,l=this.direction,c=new ce(0,0,1);t.vmult(c,c);const h=new ce;a.vsub(n,h);const f=h.dot(c);o.vsub(n,h);const p=h.dot(c);if(f*p>0||a.distanceTo(o)<f)return;const g=c.dot(l);if(Math.abs(g)<this.precision)return;const y=new ce,x=new ce,E=new ce;a.vsub(n,y);const _=-c.dot(y)/g;l.scale(_,x),a.vadd(x,E),this.reportIntersection(c,E,r,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,r=this.from;t.x=Math.min(i.x,r.x),t.y=Math.min(i.y,r.y),t.z=Math.min(i.z,r.z),n.x=Math.max(i.x,r.x),n.y=Math.max(i.y,r.y),n.z=Math.max(i.z,r.z)}_intersectHeightfield(e,t,n,i,r){e.data,e.elementSize;const a=Fce;a.from.copy(this.from),a.to.copy(this.to),hi.pointToLocalFrame(n,t,a.from,a.from),hi.pointToLocalFrame(n,t,a.to,a.to),a.updateDirection();const o=Uce;let l,c,h,f;l=c=0,h=f=e.data.length-1;const p=new Qo;a.getAABB(p),e.getIndexOfPosition(p.lowerBound.x,p.lowerBound.y,o,!0),l=Math.max(l,o[0]),c=Math.max(c,o[1]),e.getIndexOfPosition(p.upperBound.x,p.upperBound.y,o,!0),h=Math.min(h,o[0]+1),f=Math.min(f,o[1]+1);for(let g=l;g<h;g++)for(let y=c;y<f;y++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(g,y,p),!!p.overlapsRay(a)){if(e.getConvexTrianglePillar(g,y,!1),hi.pointToWorldFrame(n,t,e.pillarOffset,RS),this._intersectConvex(e.pillarConvex,t,RS,i,r,fF),this.result.shouldStop)return;e.getConvexTrianglePillar(g,y,!0),hi.pointToWorldFrame(n,t,e.pillarOffset,RS),this._intersectConvex(e.pillarConvex,t,RS,i,r,fF)}}}_intersectSphere(e,t,n,i,r){const a=this.from,o=this.to,l=e.radius,c=(o.x-a.x)**2+(o.y-a.y)**2+(o.z-a.z)**2,h=2*((o.x-a.x)*(a.x-n.x)+(o.y-a.y)*(a.y-n.y)+(o.z-a.z)*(a.z-n.z)),f=(a.x-n.x)**2+(a.y-n.y)**2+(a.z-n.z)**2-l**2,p=h**2-4*c*f,g=kce,y=Gce;if(!(p<0))if(p===0)a.lerp(o,p,g),g.vsub(n,y),y.normalize(),this.reportIntersection(y,g,r,i,-1);else{const x=(-h-Math.sqrt(p))/(2*c),E=(-h+Math.sqrt(p))/(2*c);if(x>=0&&x<=1&&(a.lerp(o,x,g),g.vsub(n,y),y.normalize(),this.reportIntersection(y,g,r,i,-1)),this.result.shouldStop)return;E>=0&&E<=1&&(a.lerp(o,E,g),g.vsub(n,y),y.normalize(),this.reportIntersection(y,g,r,i,-1))}}_intersectConvex(e,t,n,i,r,a){const o=Hce,l=dF,c=a&&a.faceList||null,h=e.faces,f=e.vertices,p=e.faceNormals,g=this.direction,y=this.from,x=this.to,E=y.distanceTo(x),_=c?c.length:h.length,b=this.result;for(let C=0;!b.shouldStop&&C<_;C++){const I=c?c[C]:C,M=h[I],R=p[I],D=t,P=n;l.copy(f[M[0]]),D.vmult(l,l),l.vadd(P,l),l.vsub(y,l),D.vmult(R,o);const L=g.dot(o);if(Math.abs(L)<this.precision)continue;const O=o.dot(l)/L;if(!(O<0)){g.scale(O,Xa),Xa.vadd(y,Xa),sc.copy(f[M[0]]),D.vmult(sc,sc),P.vadd(sc,sc);for(let U=1;!b.shouldStop&&U<M.length-1;U++){ou.copy(f[M[U]]),lu.copy(f[M[U+1]]),D.vmult(ou,ou),D.vmult(lu,lu),P.vadd(ou,ou),P.vadd(lu,lu);const j=Xa.distanceTo(y);!(Vs.pointInTriangle(Xa,sc,ou,lu)||Vs.pointInTriangle(Xa,ou,sc,lu))||j>E||this.reportIntersection(o,Xa,r,i,I)}}}}_intersectTrimesh(e,t,n,i,r,a){const o=zce,l=Yce,c=Xce,h=dF,f=Qce,p=Vce,g=jce,y=Kce,x=qce,E=e.indices;e.vertices;const _=this.from,b=this.to,C=this.direction;c.position.copy(n),c.quaternion.copy(t),hi.vectorToLocalFrame(n,t,C,f),hi.pointToLocalFrame(n,t,_,p),hi.pointToLocalFrame(n,t,b,g),g.x*=e.scale.x,g.y*=e.scale.y,g.z*=e.scale.z,p.x*=e.scale.x,p.y*=e.scale.y,p.z*=e.scale.z,g.vsub(p,f),f.normalize();const I=p.distanceSquared(g);e.tree.rayQuery(this,c,l);for(let M=0,R=l.length;!this.result.shouldStop&&M!==R;M++){const D=l[M];e.getNormal(D,o),e.getVertex(E[D*3],sc),sc.vsub(p,h);const P=f.dot(o),L=o.dot(h)/P;if(L<0)continue;f.scale(L,Xa),Xa.vadd(p,Xa),e.getVertex(E[D*3+1],ou),e.getVertex(E[D*3+2],lu);const O=Xa.distanceSquared(p);!(Vs.pointInTriangle(Xa,ou,sc,lu)||Vs.pointInTriangle(Xa,sc,ou,lu))||O>I||(hi.vectorToWorldFrame(t,o,x),hi.pointToWorldFrame(n,t,Xa,y),this.reportIntersection(x,y,r,i,D))}l.length=0}reportIntersection(e,t,n,i,r){const a=this.from,o=this.to,l=a.distanceTo(t),c=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(c.hitFaceIndex=typeof r<"u"?r:-1,this.mode){case Vs.ALL:this.hasHit=!0,c.set(a,o,e,t,n,i,l),c.hasHit=!0,this.callback(c);break;case Vs.CLOSEST:(l<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(a,o,e,t,n,i,l));break;case Vs.ANY:this.hasHit=!0,c.hasHit=!0,c.set(a,o,e,t,n,i,l),c.shouldStop=!0;break}}static pointInTriangle(e,t,n,i){i.vsub(t,zp),n.vsub(t,Wy),e.vsub(t,NM);const r=zp.dot(zp),a=zp.dot(Wy),o=zp.dot(NM),l=Wy.dot(Wy),c=Wy.dot(NM);let h,f;return(h=l*o-a*c)>=0&&(f=r*c-a*o)>=0&&h+f<r*l-a*a}}Vs.CLOSEST=fD.CLOSEST;Vs.ANY=fD.ANY;Vs.ALL=fD.ALL;const hF=new Qo,PM=[],Wy=new ce,NM=new ce,Pce=new ce,Nce=new Ys,Xa=new ce,sc=new ce,ou=new ce,lu=new ce;new ce;new hT;const fF={faceList:[0]},RS=new ce,Fce=new Vs,Uce=[],kce=new ce,Gce=new ce,Hce=new ce;new ce;new ce;const dF=new ce,zce=new ce,Qce=new ce,Vce=new ce,jce=new ce,qce=new ce,Kce=new ce;new Qo;const Yce=[],Xce=new hi,zp=new ce,BS=new ce;function Wce(s,e,t){t.vsub(s,zp);const n=zp.dot(e);return e.scale(n,BS),BS.vadd(s,BS),t.distanceTo(BS)}class $ce{static defaults(e,t){e===void 0&&(e={});for(let n in t)n in e||(e[n]=t[n]);return e}}class pF{constructor(){this.spatial=new ce,this.rotational=new ce}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class NE{constructor(e,t,n,i){n===void 0&&(n=-1e6),i===void 0&&(i=1e6),this.id=NE.idCounter++,this.minForce=n,this.maxForce=i,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new pF,this.jacobianElementB=new pF,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){const i=t,r=e,a=n;this.a=4/(a*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(a*a*r*(1+4*i))}computeB(e,t,n){const i=this.computeGW(),r=this.computeGq(),a=this.computeGiMf();return-r*e-i*t-a*n}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.position,a=i.position;return e.spatial.dot(r)+t.spatial.dot(a)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,a=i.velocity,o=n.angularVelocity,l=i.angularVelocity;return e.multiplyVectors(r,o)+t.multiplyVectors(a,l)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,a=i.vlambda,o=n.wlambda,l=i.wlambda;return e.multiplyVectors(r,o)+t.multiplyVectors(a,l)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,a=n.torque,o=i.force,l=i.torque,c=n.invMassSolve,h=i.invMassSolve;return r.scale(c,mF),o.scale(h,gF),n.invInertiaWorldSolve.vmult(a,AF),i.invInertiaWorldSolve.vmult(l,yF),e.multiplyVectors(mF,AF)+t.multiplyVectors(gF,yF)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,a=i.invMassSolve,o=n.invInertiaWorldSolve,l=i.invInertiaWorldSolve;let c=r+a;return o.vmult(e.rotational,DS),c+=DS.dot(e.rotational),l.vmult(t.rotational,DS),c+=DS.dot(t.rotational),c}addToWlambda(e){const t=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,a=Jce;i.vlambda.addScaledVector(i.invMassSolve*e,t.spatial,i.vlambda),r.vlambda.addScaledVector(r.invMassSolve*e,n.spatial,r.vlambda),i.invInertiaWorldSolve.vmult(t.rotational,a),i.wlambda.addScaledVector(e,a,i.wlambda),r.invInertiaWorldSolve.vmult(n.rotational,a),r.wlambda.addScaledVector(e,a,r.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}NE.idCounter=0;const mF=new ce,gF=new ce,AF=new ce,yF=new ce,DS=new ce,Jce=new ce;class Zce extends NE{constructor(e,t,n){n===void 0&&(n=1e6),super(e,t,0,n),this.restitution=0,this.ri=new ce,this.rj=new ce,this.ni=new ce}computeB(e){const t=this.a,n=this.b,i=this.bi,r=this.bj,a=this.ri,o=this.rj,l=eue,c=tue,h=i.velocity,f=i.angularVelocity;i.force,i.torque;const p=r.velocity,g=r.angularVelocity;r.force,r.torque;const y=nue,x=this.jacobianElementA,E=this.jacobianElementB,_=this.ni;a.cross(_,l),o.cross(_,c),_.negate(x.spatial),l.negate(x.rotational),E.spatial.copy(_),E.rotational.copy(c),y.copy(r.position),y.vadd(o,y),y.vsub(i.position,y),y.vsub(a,y);const b=_.dot(y),C=this.restitution+1,I=C*p.dot(_)-C*h.dot(_)+g.dot(c)-f.dot(l),M=this.computeGiMf();return-b*t-I*n-e*M}getImpactVelocityAlongNormal(){const e=iue,t=sue,n=rue,i=aue,r=oue;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(i,t),e.vsub(t,r),this.ni.dot(r)}}const eue=new ce,tue=new ce,nue=new ce,iue=new ce,sue=new ce,rue=new ce,aue=new ce,oue=new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;class vF extends NE{constructor(e,t,n){super(e,t,-n,n),this.ri=new ce,this.rj=new ce,this.t=new ce}computeB(e){this.a;const t=this.b;this.bi,this.bj;const n=this.ri,i=this.rj,r=lue,a=cue,o=this.t;n.cross(o,r),i.cross(o,a);const l=this.jacobianElementA,c=this.jacobianElementB;o.negate(l.spatial),r.negate(l.rotational),c.spatial.copy(o),c.rotational.copy(a);const h=this.computeGW(),f=this.computeGiMf();return-h*t-e*f}}const lue=new ce,cue=new ce;class vC{constructor(e,t,n){n=$ce.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=vC.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}vC.idCounter=0;class EC{constructor(e){e===void 0&&(e={});let t="";typeof e=="string"&&(t=e,e={}),this.name=t,this.id=EC.idCounter++,this.friction=typeof e.friction<"u"?e.friction:-1,this.restitution=typeof e.restitution<"u"?e.restitution:-1}}EC.idCounter=0;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new Vs;new ce;new ce;new ce;new ce(1,0,0),new ce(0,1,0),new ce(0,0,1);new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new Qo;new ce;new Qo;new ce;new ce;new ce;new ce;new ce;new ce;new ce;new Qo;new ce;new hi;new Qo;class uue{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){e.enabled&&!e.bi.isTrigger&&!e.bj.isTrigger&&this.equations.push(e)}removeEquation(e){const t=this.equations,n=t.indexOf(e);n!==-1&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}}class hue extends uue{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0;const i=this.iterations,r=this.tolerance*this.tolerance,a=this.equations,o=a.length,l=t.bodies,c=l.length,h=e;let f,p,g,y,x,E;if(o!==0)for(let I=0;I!==c;I++)l[I].updateSolveMassProperties();const _=due,b=pue,C=fue;_.length=o,b.length=o,C.length=o;for(let I=0;I!==o;I++){const M=a[I];C[I]=0,b[I]=M.computeB(h),_[I]=1/M.computeC()}if(o!==0){for(let R=0;R!==c;R++){const D=l[R],P=D.vlambda,L=D.wlambda;P.set(0,0,0),L.set(0,0,0)}for(n=0;n!==i;n++){y=0;for(let R=0;R!==o;R++){const D=a[R];f=b[R],p=_[R],E=C[R],x=D.computeGWlambda(),g=p*(f-x-D.eps*E),E+g<D.minForce?g=D.minForce-E:E+g>D.maxForce&&(g=D.maxForce-E),C[R]+=g,y+=g>0?g:-g,D.addToWlambda(g)}if(y*y<r)break}for(let R=0;R!==c;R++){const D=l[R],P=D.velocity,L=D.angularVelocity;D.vlambda.vmul(D.linearFactor,D.vlambda),P.vadd(D.vlambda,P),D.wlambda.vmul(D.angularFactor,D.wlambda),L.vadd(D.wlambda,L)}let I=a.length;const M=1/h;for(;I--;)a[I].multiplier=C[I]*M}return n}}const fue=[],due=[],pue=[];class mue{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class gue extends mue{constructor(){super(...arguments),this.type=ce}constructObject(){return new ce}}const qi={sphereSphere:Yt.types.SPHERE,spherePlane:Yt.types.SPHERE|Yt.types.PLANE,boxBox:Yt.types.BOX|Yt.types.BOX,sphereBox:Yt.types.SPHERE|Yt.types.BOX,planeBox:Yt.types.PLANE|Yt.types.BOX,convexConvex:Yt.types.CONVEXPOLYHEDRON,sphereConvex:Yt.types.SPHERE|Yt.types.CONVEXPOLYHEDRON,planeConvex:Yt.types.PLANE|Yt.types.CONVEXPOLYHEDRON,boxConvex:Yt.types.BOX|Yt.types.CONVEXPOLYHEDRON,sphereHeightfield:Yt.types.SPHERE|Yt.types.HEIGHTFIELD,boxHeightfield:Yt.types.BOX|Yt.types.HEIGHTFIELD,convexHeightfield:Yt.types.CONVEXPOLYHEDRON|Yt.types.HEIGHTFIELD,sphereParticle:Yt.types.PARTICLE|Yt.types.SPHERE,planeParticle:Yt.types.PLANE|Yt.types.PARTICLE,boxParticle:Yt.types.BOX|Yt.types.PARTICLE,convexParticle:Yt.types.PARTICLE|Yt.types.CONVEXPOLYHEDRON,cylinderCylinder:Yt.types.CYLINDER,sphereCylinder:Yt.types.SPHERE|Yt.types.CYLINDER,planeCylinder:Yt.types.PLANE|Yt.types.CYLINDER,boxCylinder:Yt.types.BOX|Yt.types.CYLINDER,convexCylinder:Yt.types.CONVEXPOLYHEDRON|Yt.types.CYLINDER,heightfieldCylinder:Yt.types.HEIGHTFIELD|Yt.types.CYLINDER,particleCylinder:Yt.types.PARTICLE|Yt.types.CYLINDER,sphereTrimesh:Yt.types.SPHERE|Yt.types.TRIMESH,planeTrimesh:Yt.types.PLANE|Yt.types.TRIMESH};class Aue{get[qi.sphereSphere](){return this.sphereSphere}get[qi.spherePlane](){return this.spherePlane}get[qi.boxBox](){return this.boxBox}get[qi.sphereBox](){return this.sphereBox}get[qi.planeBox](){return this.planeBox}get[qi.convexConvex](){return this.convexConvex}get[qi.sphereConvex](){return this.sphereConvex}get[qi.planeConvex](){return this.planeConvex}get[qi.boxConvex](){return this.boxConvex}get[qi.sphereHeightfield](){return this.sphereHeightfield}get[qi.boxHeightfield](){return this.boxHeightfield}get[qi.convexHeightfield](){return this.convexHeightfield}get[qi.sphereParticle](){return this.sphereParticle}get[qi.planeParticle](){return this.planeParticle}get[qi.boxParticle](){return this.boxParticle}get[qi.convexParticle](){return this.convexParticle}get[qi.cylinderCylinder](){return this.convexConvex}get[qi.sphereCylinder](){return this.sphereConvex}get[qi.planeCylinder](){return this.planeConvex}get[qi.boxCylinder](){return this.boxConvex}get[qi.convexCylinder](){return this.convexConvex}get[qi.heightfieldCylinder](){return this.heightfieldCylinder}get[qi.particleCylinder](){return this.particleCylinder}get[qi.sphereTrimesh](){return this.sphereTrimesh}get[qi.planeTrimesh](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new gue,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,i,r,a){let o;this.contactPointPool.length?(o=this.contactPointPool.pop(),o.bi=e,o.bj=t):o=new Zce(e,t),o.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&i.collisionResponse;const l=this.currentContactMaterial;o.restitution=l.restitution,o.setSpookParams(l.contactEquationStiffness,l.contactEquationRelaxation,this.world.dt);const c=n.material||e.material,h=i.material||t.material;return c&&h&&c.restitution>=0&&h.restitution>=0&&(o.restitution=c.restitution*h.restitution),o.si=r||n,o.sj=a||i,o}createFrictionEquationsFromContact(e,t){const n=e.bi,i=e.bj,r=e.si,a=e.sj,o=this.world,l=this.currentContactMaterial;let c=l.friction;const h=r.material||n.material,f=a.material||i.material;if(h&&f&&h.friction>=0&&f.friction>=0&&(c=h.friction*f.friction),c>0){const p=c*(o.frictionGravity||o.gravity).length();let g=n.invMass+i.invMass;g>0&&(g=1/g);const y=this.frictionEquationPool,x=y.length?y.pop():new vF(n,i,p*g),E=y.length?y.pop():new vF(n,i,p*g);return x.bi=E.bi=n,x.bj=E.bj=i,x.minForce=E.minForce=-p*g,x.maxForce=E.maxForce=p*g,x.ri.copy(e.ri),x.rj.copy(e.rj),E.ri.copy(e.ri),E.rj.copy(e.rj),e.ni.tangents(x.t,E.t),x.setSpookParams(l.frictionEquationStiffness,l.frictionEquationRelaxation,o.dt),E.setSpookParams(l.frictionEquationStiffness,l.frictionEquationRelaxation,o.dt),x.enabled=E.enabled=e.enabled,t.push(x,E),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;const n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];Op.setZero(),Zg.setZero(),eA.setZero();const r=t.bi;t.bj;for(let o=0;o!==e;o++)t=this.result[this.result.length-1-o],t.bi!==r?(Op.vadd(t.ni,Op),Zg.vadd(t.ri,Zg),eA.vadd(t.rj,eA)):(Op.vsub(t.ni,Op),Zg.vadd(t.rj,Zg),eA.vadd(t.ri,eA));const a=1/e;Zg.scale(a,n.ri),eA.scale(a,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),Op.normalize(),Op.tangents(n.t,i.t)}getContacts(e,t,n,i,r,a,o){this.contactPointPool=r,this.frictionEquationPool=o,this.result=i,this.frictionResult=a;const l=Eue,c=xue,h=yue,f=vue;for(let p=0,g=e.length;p!==g;p++){const y=e[p],x=t[p];let E=null;y.material&&x.material&&(E=n.getContactMaterial(y.material,x.material)||null);const _=y.type&Xt.KINEMATIC&&x.type&Xt.STATIC||y.type&Xt.STATIC&&x.type&Xt.KINEMATIC||y.type&Xt.KINEMATIC&&x.type&Xt.KINEMATIC;for(let b=0;b<y.shapes.length;b++){y.quaternion.mult(y.shapeOrientations[b],l),y.quaternion.vmult(y.shapeOffsets[b],h),h.vadd(y.position,h);const C=y.shapes[b];for(let I=0;I<x.shapes.length;I++){x.quaternion.mult(x.shapeOrientations[I],c),x.quaternion.vmult(x.shapeOffsets[I],f),f.vadd(x.position,f);const M=x.shapes[I];if(!(C.collisionFilterMask&M.collisionFilterGroup&&M.collisionFilterMask&C.collisionFilterGroup)||h.distanceTo(f)>C.boundingSphereRadius+M.boundingSphereRadius)continue;let R=null;C.material&&M.material&&(R=n.getContactMaterial(C.material,M.material)||null),this.currentContactMaterial=R||E||n.defaultContactMaterial;const D=C.type|M.type,P=this[D];if(P){let L=!1;C.type<M.type?L=P.call(this,C,M,h,f,l,c,y,x,C,M,_):L=P.call(this,M,C,f,h,c,l,x,y,C,M,_),L&&_&&(n.shapeOverlapKeeper.set(C.id,M.id),n.bodyOverlapKeeper.set(y.id,x.id))}}}}}sphereSphere(e,t,n,i,r,a,o,l,c,h,f){if(f)return n.distanceSquared(i)<(e.radius+t.radius)**2;const p=this.createContactEquation(o,l,e,t,c,h);i.vsub(n,p.ni),p.ni.normalize(),p.ri.copy(p.ni),p.rj.copy(p.ni),p.ri.scale(e.radius,p.ri),p.rj.scale(-t.radius,p.rj),p.ri.vadd(n,p.ri),p.ri.vsub(o.position,p.ri),p.rj.vadd(i,p.rj),p.rj.vsub(l.position,p.rj),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}spherePlane(e,t,n,i,r,a,o,l,c,h,f){const p=this.createContactEquation(o,l,e,t,c,h);if(p.ni.set(0,0,1),a.vmult(p.ni,p.ni),p.ni.negate(p.ni),p.ni.normalize(),p.ni.scale(e.radius,p.ri),n.vsub(i,LS),p.ni.scale(p.ni.dot(LS),EF),LS.vsub(EF,p.rj),-LS.dot(p.ni)<=e.radius){if(f)return!0;const g=p.ri,y=p.rj;g.vadd(n,g),g.vsub(o.position,g),y.vadd(i,y),y.vsub(l.position,y),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}}boxBox(e,t,n,i,r,a,o,l,c,h,f){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,i,r,a,o,l,e,t,f)}sphereBox(e,t,n,i,r,a,o,l,c,h,f){const p=this.v3pool,g=Kue;n.vsub(i,OS),t.getSideNormals(g,a);const y=e.radius;let x=!1;const E=Xue,_=Wue,b=$ue;let C=null,I=0,M=0,R=0,D=null;for(let k=0,W=g.length;k!==W&&x===!1;k++){const V=Vue;V.copy(g[k]);const X=V.length();V.normalize();const K=OS.dot(V);if(K<X+y&&K>0){const te=jue,oe=que;te.copy(g[(k+1)%3]),oe.copy(g[(k+2)%3]);const Ee=te.length(),Ce=oe.length();te.normalize(),oe.normalize();const se=OS.dot(te),ie=OS.dot(oe);if(se<Ee&&se>-Ee&&ie<Ce&&ie>-Ce){const ne=Math.abs(K-X-y);if((D===null||ne<D)&&(D=ne,M=se,R=ie,C=X,E.copy(V),_.copy(te),b.copy(oe),I++,f))return!0}}}if(I){x=!0;const k=this.createContactEquation(o,l,e,t,c,h);E.scale(-y,k.ri),k.ni.copy(E),k.ni.negate(k.ni),E.scale(C,E),_.scale(M,_),E.vadd(_,E),b.scale(R,b),E.vadd(b,k.rj),k.ri.vadd(n,k.ri),k.ri.vsub(o.position,k.ri),k.rj.vadd(i,k.rj),k.rj.vsub(l.position,k.rj),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult)}let P=p.get();const L=Yue;for(let k=0;k!==2&&!x;k++)for(let W=0;W!==2&&!x;W++)for(let V=0;V!==2&&!x;V++)if(P.set(0,0,0),k?P.vadd(g[0],P):P.vsub(g[0],P),W?P.vadd(g[1],P):P.vsub(g[1],P),V?P.vadd(g[2],P):P.vsub(g[2],P),i.vadd(P,L),L.vsub(n,L),L.lengthSquared()<y*y){if(f)return!0;x=!0;const X=this.createContactEquation(o,l,e,t,c,h);X.ri.copy(L),X.ri.normalize(),X.ni.copy(X.ri),X.ri.scale(y,X.ri),X.rj.copy(P),X.ri.vadd(n,X.ri),X.ri.vsub(o.position,X.ri),X.rj.vadd(i,X.rj),X.rj.vsub(l.position,X.rj),this.result.push(X),this.createFrictionEquationsFromContact(X,this.frictionResult)}p.release(P),P=null;const O=p.get(),U=p.get(),j=p.get(),H=p.get(),z=p.get(),q=g.length;for(let k=0;k!==q&&!x;k++)for(let W=0;W!==q&&!x;W++)if(k%3!==W%3){g[W].cross(g[k],O),O.normalize(),g[k].vadd(g[W],U),j.copy(n),j.vsub(U,j),j.vsub(i,j);const V=j.dot(O);O.scale(V,H);let X=0;for(;X===k%3||X===W%3;)X++;z.copy(n),z.vsub(H,z),z.vsub(U,z),z.vsub(i,z);const K=Math.abs(V),te=z.length();if(K<g[X].length()&&te<y){if(f)return!0;x=!0;const oe=this.createContactEquation(o,l,e,t,c,h);U.vadd(H,oe.rj),oe.rj.copy(oe.rj),z.negate(oe.ni),oe.ni.normalize(),oe.ri.copy(oe.rj),oe.ri.vadd(i,oe.ri),oe.ri.vsub(n,oe.ri),oe.ri.normalize(),oe.ri.scale(y,oe.ri),oe.ri.vadd(n,oe.ri),oe.ri.vsub(o.position,oe.ri),oe.rj.vadd(i,oe.rj),oe.rj.vsub(l.position,oe.rj),this.result.push(oe),this.createFrictionEquationsFromContact(oe,this.frictionResult)}}p.release(O,U,j,H,z)}planeBox(e,t,n,i,r,a,o,l,c,h,f){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,i,r,a,o,l,e,t,f)}convexConvex(e,t,n,i,r,a,o,l,c,h,f,p,g){const y=fhe;if(!(n.distanceTo(i)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,r,i,a,y,p,g)){const x=[],E=dhe;e.clipAgainstHull(n,r,t,i,a,y,-100,100,x);let _=0;for(let b=0;b!==x.length;b++){if(f)return!0;const C=this.createContactEquation(o,l,e,t,c,h),I=C.ri,M=C.rj;y.negate(C.ni),x[b].normal.negate(E),E.scale(x[b].depth,E),x[b].point.vadd(E,I),M.copy(x[b].point),I.vsub(n,I),M.vsub(i,M),I.vadd(n,I),I.vsub(o.position,I),M.vadd(i,M),M.vsub(l.position,M),this.result.push(C),_++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(C,this.frictionResult)}this.enableFrictionReduction&&_&&this.createFrictionFromAverage(_)}}sphereConvex(e,t,n,i,r,a,o,l,c,h,f){const p=this.v3pool;n.vsub(i,Jue);const g=t.faceNormals,y=t.faces,x=t.vertices,E=e.radius;let _=!1;for(let b=0;b!==x.length;b++){const C=x[b],I=nhe;a.vmult(C,I),i.vadd(I,I);const M=the;if(I.vsub(n,M),M.lengthSquared()<E*E){if(f)return!0;_=!0;const R=this.createContactEquation(o,l,e,t,c,h);R.ri.copy(M),R.ri.normalize(),R.ni.copy(R.ri),R.ri.scale(E,R.ri),I.vsub(i,R.rj),R.ri.vadd(n,R.ri),R.ri.vsub(o.position,R.ri),R.rj.vadd(i,R.rj),R.rj.vsub(l.position,R.rj),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult);return}}for(let b=0,C=y.length;b!==C&&_===!1;b++){const I=g[b],M=y[b],R=ihe;a.vmult(I,R);const D=she;a.vmult(x[M[0]],D),D.vadd(i,D);const P=rhe;R.scale(-E,P),n.vadd(P,P);const L=ahe;P.vsub(D,L);const O=L.dot(R),U=ohe;if(n.vsub(D,U),O<0&&U.dot(R)>0){const j=[];for(let H=0,z=M.length;H!==z;H++){const q=p.get();a.vmult(x[M[H]],q),i.vadd(q,q),j.push(q)}if(Que(j,R,n)){if(f)return!0;_=!0;const H=this.createContactEquation(o,l,e,t,c,h);R.scale(-E,H.ri),R.negate(H.ni);const z=p.get();R.scale(-O,z);const q=p.get();R.scale(-E,q),n.vsub(i,H.rj),H.rj.vadd(q,H.rj),H.rj.vadd(z,H.rj),H.rj.vadd(i,H.rj),H.rj.vsub(l.position,H.rj),H.ri.vadd(n,H.ri),H.ri.vsub(o.position,H.ri),p.release(z),p.release(q),this.result.push(H),this.createFrictionEquationsFromContact(H,this.frictionResult);for(let k=0,W=j.length;k!==W;k++)p.release(j[k]);return}else for(let H=0;H!==M.length;H++){const z=p.get(),q=p.get();a.vmult(x[M[(H+1)%M.length]],z),a.vmult(x[M[(H+2)%M.length]],q),i.vadd(z,z),i.vadd(q,q);const k=Zue;q.vsub(z,k);const W=ehe;k.unit(W);const V=p.get(),X=p.get();n.vsub(z,X);const K=X.dot(W);W.scale(K,V),V.vadd(z,V);const te=p.get();if(V.vsub(n,te),K>0&&K*K<k.lengthSquared()&&te.lengthSquared()<E*E){if(f)return!0;const oe=this.createContactEquation(o,l,e,t,c,h);V.vsub(i,oe.rj),V.vsub(n,oe.ni),oe.ni.normalize(),oe.ni.scale(E,oe.ri),oe.rj.vadd(i,oe.rj),oe.rj.vsub(l.position,oe.rj),oe.ri.vadd(n,oe.ri),oe.ri.vsub(o.position,oe.ri),this.result.push(oe),this.createFrictionEquationsFromContact(oe,this.frictionResult);for(let Ee=0,Ce=j.length;Ee!==Ce;Ee++)p.release(j[Ee]);p.release(z),p.release(q),p.release(V),p.release(te),p.release(X);return}p.release(z),p.release(q),p.release(V),p.release(te),p.release(X)}for(let H=0,z=j.length;H!==z;H++)p.release(j[H])}}}planeConvex(e,t,n,i,r,a,o,l,c,h,f){const p=lhe,g=che;g.set(0,0,1),r.vmult(g,g);let y=0;const x=uhe;for(let E=0;E!==t.vertices.length;E++)if(p.copy(t.vertices[E]),a.vmult(p,p),i.vadd(p,p),p.vsub(n,x),g.dot(x)<=0){if(f)return!0;const b=this.createContactEquation(o,l,e,t,c,h),C=hhe;g.scale(g.dot(x),C),p.vsub(C,C),C.vsub(n,b.ri),b.ni.copy(g),p.vsub(i,b.rj),b.ri.vadd(n,b.ri),b.ri.vsub(o.position,b.ri),b.rj.vadd(i,b.rj),b.rj.vsub(l.position,b.rj),this.result.push(b),y++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(b,this.frictionResult)}this.enableFrictionReduction&&y&&this.createFrictionFromAverage(y)}boxConvex(e,t,n,i,r,a,o,l,c,h,f){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,i,r,a,o,l,e,t,f)}sphereHeightfield(e,t,n,i,r,a,o,l,c,h,f){const p=t.data,g=e.radius,y=t.elementSize,x=The,E=bhe;hi.pointToLocalFrame(i,a,n,E);let _=Math.floor((E.x-g)/y)-1,b=Math.ceil((E.x+g)/y)+1,C=Math.floor((E.y-g)/y)-1,I=Math.ceil((E.y+g)/y)+1;if(b<0||I<0||_>p.length||C>p[0].length)return;_<0&&(_=0),b<0&&(b=0),C<0&&(C=0),I<0&&(I=0),_>=p.length&&(_=p.length-1),b>=p.length&&(b=p.length-1),I>=p[0].length&&(I=p[0].length-1),C>=p[0].length&&(C=p[0].length-1);const M=[];t.getRectMinMax(_,C,b,I,M);const R=M[0],D=M[1];if(E.z-g>D||E.z+g<R)return;const P=this.result;for(let L=_;L<b;L++)for(let O=C;O<I;O++){const U=P.length;let j=!1;if(t.getConvexTrianglePillar(L,O,!1),hi.pointToWorldFrame(i,a,t.pillarOffset,x),n.distanceTo(x)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(j=this.sphereConvex(e,t.pillarConvex,n,x,r,a,o,l,e,t,f)),f&&j||(t.getConvexTrianglePillar(L,O,!0),hi.pointToWorldFrame(i,a,t.pillarOffset,x),n.distanceTo(x)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(j=this.sphereConvex(e,t.pillarConvex,n,x,r,a,o,l,e,t,f)),f&&j))return!0;if(P.length-U>2)return}}boxHeightfield(e,t,n,i,r,a,o,l,c,h,f){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,i,r,a,o,l,e,t,f)}convexHeightfield(e,t,n,i,r,a,o,l,c,h,f){const p=t.data,g=t.elementSize,y=e.boundingSphereRadius,x=_he,E=She,_=xhe;hi.pointToLocalFrame(i,a,n,_);let b=Math.floor((_.x-y)/g)-1,C=Math.ceil((_.x+y)/g)+1,I=Math.floor((_.y-y)/g)-1,M=Math.ceil((_.y+y)/g)+1;if(C<0||M<0||b>p.length||I>p[0].length)return;b<0&&(b=0),C<0&&(C=0),I<0&&(I=0),M<0&&(M=0),b>=p.length&&(b=p.length-1),C>=p.length&&(C=p.length-1),M>=p[0].length&&(M=p[0].length-1),I>=p[0].length&&(I=p[0].length-1);const R=[];t.getRectMinMax(b,I,C,M,R);const D=R[0],P=R[1];if(!(_.z-y>P||_.z+y<D))for(let L=b;L<C;L++)for(let O=I;O<M;O++){let U=!1;if(t.getConvexTrianglePillar(L,O,!1),hi.pointToWorldFrame(i,a,t.pillarOffset,x),n.distanceTo(x)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(U=this.convexConvex(e,t.pillarConvex,n,x,r,a,o,l,null,null,f,E,null)),f&&U||(t.getConvexTrianglePillar(L,O,!0),hi.pointToWorldFrame(i,a,t.pillarOffset,x),n.distanceTo(x)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(U=this.convexConvex(e,t.pillarConvex,n,x,r,a,o,l,null,null,f,E,null)),f&&U))return!0}}sphereParticle(e,t,n,i,r,a,o,l,c,h,f){const p=Ahe;if(p.set(0,0,1),i.vsub(n,p),p.lengthSquared()<=e.radius*e.radius){if(f)return!0;const y=this.createContactEquation(l,o,t,e,c,h);p.normalize(),y.rj.copy(p),y.rj.scale(e.radius,y.rj),y.ni.copy(p),y.ni.negate(y.ni),y.ri.set(0,0,0),this.result.push(y),this.createFrictionEquationsFromContact(y,this.frictionResult)}}planeParticle(e,t,n,i,r,a,o,l,c,h,f){const p=phe;p.set(0,0,1),o.quaternion.vmult(p,p);const g=mhe;if(i.vsub(o.position,g),p.dot(g)<=0){if(f)return!0;const x=this.createContactEquation(l,o,t,e,c,h);x.ni.copy(p),x.ni.negate(x.ni),x.ri.set(0,0,0);const E=ghe;p.scale(p.dot(i),E),i.vsub(E,E),x.rj.copy(E),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult)}}boxParticle(e,t,n,i,r,a,o,l,c,h,f){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,i,r,a,o,l,e,t,f)}convexParticle(e,t,n,i,r,a,o,l,c,h,f){let p=-1;const g=vhe,y=Ehe;let x=null;const E=yhe;if(E.copy(i),E.vsub(n,E),r.conjugate(xF),xF.vmult(E,E),e.pointIsInside(E)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,r),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(r);for(let _=0,b=e.faces.length;_!==b;_++){const C=[e.worldVertices[e.faces[_][0]]],I=e.worldFaceNormals[_];i.vsub(C[0],_F);const M=-I.dot(_F);if(x===null||Math.abs(M)<Math.abs(x)){if(f)return!0;x=M,p=_,g.copy(I)}}if(p!==-1){const _=this.createContactEquation(l,o,t,e,c,h);g.scale(x,y),y.vadd(i,y),y.vsub(n,y),_.rj.copy(y),g.negate(_.ni),_.ri.set(0,0,0);const b=_.ri,C=_.rj;b.vadd(i,b),b.vsub(l.position,b),C.vadd(n,C),C.vsub(o.position,C),this.result.push(_),this.createFrictionEquationsFromContact(_,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,i,r,a,o,l,c,h,f){return this.convexHeightfield(t,e,i,n,a,r,l,o,c,h,f)}particleCylinder(e,t,n,i,r,a,o,l,c,h,f){return this.convexParticle(t,e,i,n,a,r,l,o,c,h,f)}sphereTrimesh(e,t,n,i,r,a,o,l,c,h,f){const p=wue,g=Rue,y=Bue,x=Due,E=Lue,_=Oue,b=Uue,C=Mue,I=Cue,M=kue;hi.pointToLocalFrame(i,a,n,E);const R=e.radius;b.lowerBound.set(E.x-R,E.y-R,E.z-R),b.upperBound.set(E.x+R,E.y+R,E.z+R),t.getTrianglesInAABB(b,M);const D=Iue,P=e.radius*e.radius;for(let H=0;H<M.length;H++)for(let z=0;z<3;z++)if(t.getVertex(t.indices[M[H]*3+z],D),D.vsub(E,I),I.lengthSquared()<=P){if(C.copy(D),hi.pointToWorldFrame(i,a,C,D),D.vsub(n,I),f)return!0;let q=this.createContactEquation(o,l,e,t,c,h);q.ni.copy(I),q.ni.normalize(),q.ri.copy(q.ni),q.ri.scale(e.radius,q.ri),q.ri.vadd(n,q.ri),q.ri.vsub(o.position,q.ri),q.rj.copy(D),q.rj.vsub(l.position,q.rj),this.result.push(q),this.createFrictionEquationsFromContact(q,this.frictionResult)}for(let H=0;H<M.length;H++)for(let z=0;z<3;z++){t.getVertex(t.indices[M[H]*3+z],p),t.getVertex(t.indices[M[H]*3+(z+1)%3],g),g.vsub(p,y),E.vsub(g,_);const q=_.dot(y);E.vsub(p,_);let k=_.dot(y);if(k>0&&q<0&&(E.vsub(p,_),x.copy(y),x.normalize(),k=_.dot(x),x.scale(k,_),_.vadd(p,_),_.distanceTo(E)<e.radius)){if(f)return!0;const V=this.createContactEquation(o,l,e,t,c,h);_.vsub(E,V.ni),V.ni.normalize(),V.ni.scale(e.radius,V.ri),V.ri.vadd(n,V.ri),V.ri.vsub(o.position,V.ri),hi.pointToWorldFrame(i,a,_,_),_.vsub(l.position,V.rj),hi.vectorToWorldFrame(a,V.ni,V.ni),hi.vectorToWorldFrame(a,V.ri,V.ri),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult)}}const L=Pue,O=Nue,U=Fue,j=Tue;for(let H=0,z=M.length;H!==z;H++){t.getTriangleVertices(M[H],L,O,U),t.getNormal(M[H],j),E.vsub(L,_);let q=_.dot(j);if(j.scale(q,_),E.vsub(_,_),q=_.distanceTo(E),Vs.pointInTriangle(_,L,O,U)&&q<e.radius){if(f)return!0;let k=this.createContactEquation(o,l,e,t,c,h);_.vsub(E,k.ni),k.ni.normalize(),k.ni.scale(e.radius,k.ri),k.ri.vadd(n,k.ri),k.ri.vsub(o.position,k.ri),hi.pointToWorldFrame(i,a,_,_),_.vsub(l.position,k.rj),hi.vectorToWorldFrame(a,k.ni,k.ni),hi.vectorToWorldFrame(a,k.ri,k.ri),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult)}}M.length=0}planeTrimesh(e,t,n,i,r,a,o,l,c,h,f){const p=new ce,g=_ue;g.set(0,0,1),r.vmult(g,g);for(let y=0;y<t.vertices.length/3;y++){t.getVertex(y,p);const x=new ce;x.copy(p),hi.pointToWorldFrame(i,a,x,p);const E=Sue;if(p.vsub(n,E),g.dot(E)<=0){if(f)return!0;const b=this.createContactEquation(o,l,e,t,c,h);b.ni.copy(g);const C=bue;g.scale(E.dot(g),C),p.vsub(C,C),b.ri.copy(C),b.ri.vsub(o.position,b.ri),b.rj.copy(p),b.rj.vsub(l.position,b.rj),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult)}}}}const Op=new ce,Zg=new ce,eA=new ce,yue=new ce,vue=new ce,Eue=new Ys,xue=new Ys,_ue=new ce,Sue=new ce,bue=new ce,Tue=new ce,Cue=new ce;new ce;const Iue=new ce,Mue=new ce,wue=new ce,Rue=new ce,Bue=new ce,Due=new ce,Lue=new ce,Oue=new ce,Pue=new ce,Nue=new ce,Fue=new ce,Uue=new Qo,kue=[],LS=new ce,EF=new ce,Gue=new ce,Hue=new ce,zue=new ce;function Que(s,e,t){let n=null;const i=s.length;for(let r=0;r!==i;r++){const a=s[r],o=Gue;s[(r+1)%i].vsub(a,o);const l=Hue;o.cross(e,l);const c=zue;t.vsub(a,c);const h=l.dot(c);if(n===null||h>0&&n===!0||h<=0&&n===!1){n===null&&(n=h>0);continue}else return!1}return!0}const OS=new ce,Vue=new ce,jue=new ce,que=new ce,Kue=[new ce,new ce,new ce,new ce,new ce,new ce],Yue=new ce,Xue=new ce,Wue=new ce,$ue=new ce,Jue=new ce,Zue=new ce,ehe=new ce,the=new ce,nhe=new ce,ihe=new ce,she=new ce,rhe=new ce,ahe=new ce,ohe=new ce;new ce;new ce;const lhe=new ce,che=new ce,uhe=new ce,hhe=new ce,fhe=new ce,dhe=new ce,phe=new ce,mhe=new ce,ghe=new ce,Ahe=new ce,xF=new Ys,yhe=new ce;new ce;const vhe=new ce,_F=new ce,Ehe=new ce,xhe=new ce,_he=new ce,She=[0],bhe=new ce,The=new ce;class SF{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const n=t;t=e,e=n}return e<<16|t}set(e,t){const n=this.getKey(e,t),i=this.current;let r=0;for(;n>i[r];)r++;if(n!==i[r]){for(let a=i.length-1;a>=r;a--)i[a+1]=i[a];i[r]=n}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const n=this.current,i=this.previous,r=n.length,a=i.length;let o=0;for(let l=0;l<r;l++){let c=!1;const h=n[l];for(;h>i[o];)o++;c=h===i[o],c||bF(e,h)}o=0;for(let l=0;l<a;l++){let c=!1;const h=i[l];for(;h>n[o];)o++;c=n[o]===h,c||bF(t,h)}}}function bF(s,e){s.push((e&4294901760)>>16,e&65535)}const FM=(s,e)=>s<e?`${s}-${e}`:`${e}-${s}`;class Che{constructor(){this.data={keys:[]}}get(e,t){const n=FM(e,t);return this.data[n]}set(e,t,n){const i=FM(e,t);this.get(e,t)||this.data.keys.push(i),this.data[i]=n}delete(e,t){const n=FM(e,t),i=this.data.keys.indexOf(n);i!==-1&&this.data.keys.splice(i,1),delete this.data[n]}reset(){const e=this.data,t=e.keys;for(;t.length>0;){const n=t.pop();delete e[n]}}}class Ihe extends W4{constructor(e){e===void 0&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0?e.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new ce,e.gravity&&this.gravity.copy(e.gravity),e.frictionGravity&&(this.frictionGravity=new ce,this.frictionGravity.copy(e.frictionGravity)),this.broadphase=e.broadphase!==void 0?e.broadphase:new Oce,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new hue,this.constraints=[],this.narrowphase=new Aue(this),this.collisionMatrix=new cF,this.collisionMatrixPrevious=new cF,this.bodyOverlapKeeper=new SF,this.shapeOverlapKeeper=new SF,this.contactmaterials=[],this.contactMaterialTable=new Che,this.defaultMaterial=new EC("default"),this.defaultContactMaterial=new vC(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof hT?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n,i){return n===void 0&&(n={}),n.mode=Vs.ALL,n.from=e,n.to=t,n.callback=i,UM.intersectWorld(this,n)}raycastAny(e,t,n,i){return n===void 0&&(n={}),n.mode=Vs.ANY,n.from=e,n.to=t,n.result=i,UM.intersectWorld(this,n)}raycastClosest(e,t,n,i){return n===void 0&&(n={}),n.mode=Vs.CLOSEST,n.from=e,n.to=t,n.result=i,UM.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof Xt&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,n=this.bodies,i=n.indexOf(e);if(i!==-1){n.splice(i,1);for(let r=0;r!==n.length;r++)n[r].index=r;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let n=0;n<t.length;n++){const i=t[n].shapes;for(let r=0;r<i.length;r++){const a=i[r];if(a.id===e)return a}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);t!==-1&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){e===void 0&&(e=1/60),t===void 0&&(t=10);const n=lr.now()/1e3;if(!this.lastCallTime)this.step(e,void 0,t);else{const i=n-this.lastCallTime;this.step(e,i,t)}this.lastCallTime=n}step(e,t,n){if(n===void 0&&(n=10),t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const i=lr.now();let r=0;for(;this.accumulator>=e&&r<n&&(this.internalStep(e),this.accumulator-=e,r++,!(lr.now()-i>e*1e3)););this.accumulator=this.accumulator%e;const a=this.accumulator/e;for(let o=0;o!==this.bodies.length;o++){const l=this.bodies[o];l.previousPosition.lerp(l.position,a,l.interpolatedPosition),l.previousQuaternion.slerp(l.quaternion,a,l.interpolatedQuaternion),l.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,n=Dhe,i=Lhe,r=this.bodies.length,a=this.bodies,o=this.solver,l=this.gravity,c=this.doProfiling,h=this.profile,f=Xt.DYNAMIC;let p=-1/0;const g=this.constraints,y=Bhe;l.length();const x=l.x,E=l.y,_=l.z;let b=0;for(c&&(p=lr.now()),b=0;b!==r;b++){const H=a[b];if(H.type===f){const z=H.force,q=H.mass;z.x+=q*x,z.y+=q*E,z.z+=q*_}}for(let H=0,z=this.subsystems.length;H!==z;H++)this.subsystems[H].update();c&&(p=lr.now()),n.length=0,i.length=0,this.broadphase.collisionPairs(this,n,i),c&&(h.broadphase=lr.now()-p);let C=g.length;for(b=0;b!==C;b++){const H=g[b];if(!H.collideConnected)for(let z=n.length-1;z>=0;z-=1)(H.bodyA===n[z]&&H.bodyB===i[z]||H.bodyB===n[z]&&H.bodyA===i[z])&&(n.splice(z,1),i.splice(z,1))}this.collisionMatrixTick(),c&&(p=lr.now());const I=Rhe,M=t.length;for(b=0;b!==M;b++)I.push(t[b]);t.length=0;const R=this.frictionEquations.length;for(b=0;b!==R;b++)y.push(this.frictionEquations[b]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,i,this,t,I,this.frictionEquations,y),c&&(h.narrowphase=lr.now()-p),c&&(p=lr.now()),b=0;b<this.frictionEquations.length;b++)o.addEquation(this.frictionEquations[b]);const D=t.length;for(let H=0;H!==D;H++){const z=t[H],q=z.bi,k=z.bj,W=z.si,V=z.sj;let X;if(q.material&&k.material?X=this.getContactMaterial(q.material,k.material)||this.defaultContactMaterial:X=this.defaultContactMaterial,X.friction,q.material&&k.material&&(q.material.friction>=0&&k.material.friction>=0&&q.material.friction*k.material.friction,q.material.restitution>=0&&k.material.restitution>=0&&(z.restitution=q.material.restitution*k.material.restitution)),o.addEquation(z),q.allowSleep&&q.type===Xt.DYNAMIC&&q.sleepState===Xt.SLEEPING&&k.sleepState===Xt.AWAKE&&k.type!==Xt.STATIC){const K=k.velocity.lengthSquared()+k.angularVelocity.lengthSquared(),te=k.sleepSpeedLimit**2;K>=te*2&&(q.wakeUpAfterNarrowphase=!0)}if(k.allowSleep&&k.type===Xt.DYNAMIC&&k.sleepState===Xt.SLEEPING&&q.sleepState===Xt.AWAKE&&q.type!==Xt.STATIC){const K=q.velocity.lengthSquared()+q.angularVelocity.lengthSquared(),te=q.sleepSpeedLimit**2;K>=te*2&&(k.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(q,k,!0),this.collisionMatrixPrevious.get(q,k)||($y.body=k,$y.contact=z,q.dispatchEvent($y),$y.body=q,k.dispatchEvent($y)),this.bodyOverlapKeeper.set(q.id,k.id),this.shapeOverlapKeeper.set(W.id,V.id)}for(this.emitContactEvents(),c&&(h.makeContactConstraints=lr.now()-p,p=lr.now()),b=0;b!==r;b++){const H=a[b];H.wakeUpAfterNarrowphase&&(H.wakeUp(),H.wakeUpAfterNarrowphase=!1)}for(C=g.length,b=0;b!==C;b++){const H=g[b];H.update();for(let z=0,q=H.equations.length;z!==q;z++){const k=H.equations[z];o.addEquation(k)}}o.solve(e,this),c&&(h.solve=lr.now()-p),o.removeAllEquations();const P=Math.pow;for(b=0;b!==r;b++){const H=a[b];if(H.type&f){const z=P(1-H.linearDamping,e),q=H.velocity;q.scale(z,q);const k=H.angularVelocity;if(k){const W=P(1-H.angularDamping,e);k.scale(W,k)}}}this.dispatchEvent(whe),c&&(p=lr.now());const O=this.stepnumber%(this.quatNormalizeSkip+1)===0,U=this.quatNormalizeFast;for(b=0;b!==r;b++)a[b].integrate(e,O,U);this.clearForces(),this.broadphase.dirty=!0,c&&(h.integrate=lr.now()-p),this.stepnumber+=1,this.dispatchEvent(Mhe);let j=!0;if(this.allowSleep)for(j=!1,b=0;b!==r;b++){const H=a[b];H.sleepTick(this.time),H.sleepState!==Xt.SLEEPING&&(j=!0)}this.hasActiveBodies=j}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(hh,fh),e){for(let r=0,a=hh.length;r<a;r+=2)Jy.bodyA=this.getBodyById(hh[r]),Jy.bodyB=this.getBodyById(hh[r+1]),this.dispatchEvent(Jy);Jy.bodyA=Jy.bodyB=null}if(t){for(let r=0,a=fh.length;r<a;r+=2)Zy.bodyA=this.getBodyById(fh[r]),Zy.bodyB=this.getBodyById(fh[r+1]),this.dispatchEvent(Zy);Zy.bodyA=Zy.bodyB=null}hh.length=fh.length=0;const n=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((n||i)&&this.shapeOverlapKeeper.getDiff(hh,fh),n){for(let r=0,a=hh.length;r<a;r+=2){const o=this.getShapeById(hh[r]),l=this.getShapeById(hh[r+1]);dh.shapeA=o,dh.shapeB=l,o&&(dh.bodyA=o.body),l&&(dh.bodyB=l.body),this.dispatchEvent(dh)}dh.bodyA=dh.bodyB=dh.shapeA=dh.shapeB=null}if(i){for(let r=0,a=fh.length;r<a;r+=2){const o=this.getShapeById(fh[r]),l=this.getShapeById(fh[r+1]);ph.shapeA=o,ph.shapeB=l,o&&(ph.bodyA=o.body),l&&(ph.bodyB=l.body),this.dispatchEvent(ph)}ph.bodyA=ph.bodyB=ph.shapeA=ph.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let n=0;n!==t;n++){const i=e[n];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}}}new Qo;const UM=new Vs,lr=globalThis.performance||{};if(!lr.now){let s=Date.now();lr.timing&&lr.timing.navigationStart&&(s=lr.timing.navigationStart),lr.now=()=>Date.now()-s}new ce;const Mhe={type:"postStep"},whe={type:"preStep"},$y={type:Xt.COLLIDE_EVENT_NAME,body:null,contact:null},Rhe=[],Bhe=[],Dhe=[],Lhe=[],hh=[],fh=[],Jy={type:"beginContact",bodyA:null,bodyB:null},Zy={type:"endContact",bodyA:null,bodyB:null},dh={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},ph={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var sb={exports:{}},rb={exports:{}},Ohe=rb.exports,TF;function Phe(){return TF||(TF=1,(function(s){(function(e,t){s.exports?s.exports=t():e.EvEmitter=t()})(typeof window<"u"?window:Ohe,function(){function e(){}let t=e.prototype;return t.on=function(n,i){if(!n||!i)return this;let r=this._events=this._events||{},a=r[n]=r[n]||[];return a.includes(i)||a.push(i),this},t.once=function(n,i){if(!n||!i)return this;this.on(n,i);let r=this._onceEvents=this._onceEvents||{},a=r[n]=r[n]||{};return a[i]=!0,this},t.off=function(n,i){let r=this._events&&this._events[n];if(!r||!r.length)return this;let a=r.indexOf(i);return a!=-1&&r.splice(a,1),this},t.emitEvent=function(n,i){let r=this._events&&this._events[n];if(!r||!r.length)return this;r=r.slice(0),i=i||[];let a=this._onceEvents&&this._onceEvents[n];for(let o of r)a&&a[o]&&(this.off(n,o),delete a[o]),o.apply(this,i);return this},t.allOff=function(){return delete this._events,delete this._onceEvents,this},e})})(rb)),rb.exports}/*!
 * imagesLoaded v5.0.0
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */var Nhe=sb.exports,CF;function Fhe(){return CF||(CF=1,(function(s){(function(e,t){s.exports?s.exports=t(e,Phe()):e.imagesLoaded=t(e,e.EvEmitter)})(typeof window<"u"?window:Nhe,function(t,n){let i=t.jQuery,r=t.console;function a(p){return Array.isArray(p)?p:typeof p=="object"&&typeof p.length=="number"?[...p]:[p]}function o(p,g,y){if(!(this instanceof o))return new o(p,g,y);let x=p;if(typeof p=="string"&&(x=document.querySelectorAll(p)),!x){r.error(`Bad element for imagesLoaded ${x||p}`);return}this.elements=a(x),this.options={},typeof g=="function"?y=g:Object.assign(this.options,g),y&&this.on("always",y),this.getImages(),i&&(this.jqDeferred=new i.Deferred),setTimeout(this.check.bind(this))}o.prototype=Object.create(n.prototype),o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)};const l=[1,9,11];o.prototype.addElementImages=function(p){p.nodeName==="IMG"&&this.addImage(p),this.options.background===!0&&this.addElementBackgroundImages(p);let{nodeType:g}=p;if(!g||!l.includes(g))return;let y=p.querySelectorAll("img");for(let x of y)this.addImage(x);if(typeof this.options.background=="string"){let x=p.querySelectorAll(this.options.background);for(let E of x)this.addElementBackgroundImages(E)}};const c=/url\((['"])?(.*?)\1\)/gi;o.prototype.addElementBackgroundImages=function(p){let g=getComputedStyle(p);if(!g)return;let y=c.exec(g.backgroundImage);for(;y!==null;){let x=y&&y[2];x&&this.addBackground(x,p),y=c.exec(g.backgroundImage)}},o.prototype.addImage=function(p){let g=new h(p);this.images.push(g)},o.prototype.addBackground=function(p,g){let y=new f(p,g);this.images.push(y)},o.prototype.check=function(){if(this.progressedCount=0,this.hasAnyBroken=!1,!this.images.length){this.complete();return}let p=(g,y,x)=>{setTimeout(()=>{this.progress(g,y,x)})};this.images.forEach(function(g){g.once("progress",p),g.check()})},o.prototype.progress=function(p,g,y){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!p.isLoaded,this.emitEvent("progress",[this,p,g]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,p),this.progressedCount===this.images.length&&this.complete(),this.options.debug&&r&&r.log(`progress: ${y}`,p,g)},o.prototype.complete=function(){let p=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(p,[this]),this.emitEvent("always",[this]),this.jqDeferred){let g=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[g](this)}};function h(p){this.img=p}h.prototype=Object.create(n.prototype),h.prototype.check=function(){if(this.getIsImageComplete()){this.confirm(this.img.naturalWidth!==0,"naturalWidth");return}this.proxyImage=new Image,this.img.crossOrigin&&(this.proxyImage.crossOrigin=this.img.crossOrigin),this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.proxyImage.src=this.img.currentSrc||this.img.src},h.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},h.prototype.confirm=function(p,g){this.isLoaded=p;let{parentNode:y}=this.img,x=y.nodeName==="PICTURE"?y:this.img;this.emitEvent("progress",[this,x,g])},h.prototype.handleEvent=function(p){let g="on"+p.type;this[g]&&this[g](p)},h.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},h.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},h.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)};function f(p,g){this.url=p,this.element=g,this.img=new Image}return f.prototype=Object.create(h.prototype),f.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(this.img.naturalWidth!==0,"naturalWidth"),this.unbindEvents())},f.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},f.prototype.confirm=function(p,g){this.isLoaded=p,this.emitEvent("progress",[this,this.element,g])},o.makeJQueryPlugin=function(p){p=p||t.jQuery,p&&(i=p,i.fn.imagesLoaded=function(g,y){return new o(this,g,y).jqDeferred.promise(i(this))})},o.makeJQueryPlugin(),o})})(sb)),sb.exports}Fhe();const sz=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"Mobile":"Desktop",Uhe="https://www.gstatic.com/draco/versioned/decoders/1.5.7/",khe=(s,e={})=>{const{unsuspend:t="loadedmetadata",crossOrigin:n="Anonymous",loop:i=!0,muted:r=!0,start:a=!0}=e;return new Promise(o=>{const l=Object.assign(document.createElement("video"),{src:s,crossOrigin:n,loop:i,muted:r,...e}),c=new xB(l);l.addEventListener(t,()=>{a&&c.image.play(),o(c)})})},Ghe=(s,e)=>{const t=document.createElement("a");document.body.appendChild(t),t.style.display="none";const n=window.URL.createObjectURL(s);t.href=n,t.download=e,t.click()},Hhe=1/3,cu=1/6,kM=s=>Math.floor(s)|0,GM=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function zhe(s=Math.random){const e=Qhe(s),t=new Float64Array(e).map(r=>GM[r%12*3]),n=new Float64Array(e).map(r=>GM[r%12*3+1]),i=new Float64Array(e).map(r=>GM[r%12*3+2]);return function(a,o,l){let c,h,f,p;const g=(a+o+l)*Hhe,y=kM(a+g),x=kM(o+g),E=kM(l+g),_=(y+x+E)*cu,b=y-_,C=x-_,I=E-_,M=a-b,R=o-C,D=l-I;let P,L,O,U,j,H;M>=R?R>=D?(P=1,L=0,O=0,U=1,j=1,H=0):M>=D?(P=1,L=0,O=0,U=1,j=0,H=1):(P=0,L=0,O=1,U=1,j=0,H=1):R<D?(P=0,L=0,O=1,U=0,j=1,H=1):M<D?(P=0,L=1,O=0,U=0,j=1,H=1):(P=0,L=1,O=0,U=1,j=1,H=0);const z=M-P+cu,q=R-L+cu,k=D-O+cu,W=M-U+2*cu,V=R-j+2*cu,X=D-H+2*cu,K=M-1+3*cu,te=R-1+3*cu,oe=D-1+3*cu,Ee=y&255,Ce=x&255,se=E&255;let ie=.6-M*M-R*R-D*D;if(ie<0)c=0;else{const Ge=Ee+e[Ce+e[se]];ie*=ie,c=ie*ie*(t[Ge]*M+n[Ge]*R+i[Ge]*D)}let ne=.6-z*z-q*q-k*k;if(ne<0)h=0;else{const Ge=Ee+P+e[Ce+L+e[se+O]];ne*=ne,h=ne*ne*(t[Ge]*z+n[Ge]*q+i[Ge]*k)}let re=.6-W*W-V*V-X*X;if(re<0)f=0;else{const Ge=Ee+U+e[Ce+j+e[se+H]];re*=re,f=re*re*(t[Ge]*W+n[Ge]*V+i[Ge]*X)}let Be=.6-K*K-te*te-oe*oe;if(Be<0)p=0;else{const Ge=Ee+1+e[Ce+1+e[se+1]];Be*=Be,p=Be*Be*(t[Ge]*K+n[Ge]*te+i[Ge]*oe)}return 32*(c+h+f+p)}}function Qhe(s){const t=new Uint8Array(512);for(let n=0;n<512/2;n++)t[n]=n;for(let n=0;n<512/2-1;n++){const i=n+~~(s()*(256-n)),r=t[n];t[n]=t[i],t[i]=r}for(let n=256;n<512;n++)t[n]=t[n-256];return t}zhe();new de;new de;new de;new We;class Vhe extends Sd{config;resourceList;items;toLoad;loaded;loaders;constructor(e,t,n={}){super(e);const{useDracoLoader:i=!1,useMeshoptDecoder:r=!1,dracoDecoderPath:a=Uhe,ktx2TranscoderPath:o="https://unpkg.com/three/examples/jsm/libs/basis/"}=n;this.config={useDracoLoader:i,useMeshoptDecoder:r,dracoDecoderPath:a,ktx2TranscoderPath:o},this.resourceList=t,this.items={},this.toLoad=t.length,this.loaded=0,this.loaders={},this.setLoaders(),i&&this.setDracoLoader(),r&&this.setMeshoptDecoder(),this.setKTX2Loader(),this.startLoading()}setLoaders(){this.loaders.gltfLoader=new Nte,this.loaders.textureLoader=new bE,this.loaders.cubeTextureLoader=new rG,this.loaders.fontLoader=new iH,this.loaders.fbxLoader=new Wle,this.loaders.audioLoader=new dG,this.loaders.objLoader=new nie,this.loaders.hdrTextureLoader=new Kne,this.loaders.svgLoader=new Wne,this.loaders.exrLoader=new Yne,this.loaders.ktx2Loader=new Vne}setDracoLoader(){const e=new iie;e.setDecoderPath(this.config.dracoDecoderPath),this.loaders.gltfLoader?.setDRACOLoader(e)}setMeshoptDecoder(){const e=rie();this.loaders.gltfLoader?.setMeshoptDecoder(e)}setKTX2Loader(){this.loaders.ktx2Loader?.setTranscoderPath(this.config.ktx2TranscoderPath)?.detectSupport(this.base.renderer),this.loaders.ktx2Loader&&this.loaders.gltfLoader?.setKTX2Loader(this.loaders.ktx2Loader)}startLoading(){for(const e of this.resourceList)e.type==="gltfModel"?this.loaders.gltfLoader?.load(e.path,t=>{this.resourceLoaded(e,t)}):e.type==="texture"?this.loaders.textureLoader?.load(e.path,t=>{this.resourceLoaded(e,t)}):e.type==="cubeTexture"?this.loaders.cubeTextureLoader?.load(e.path,t=>{this.resourceLoaded(e,t)}):e.type==="font"?this.loaders.fontLoader?.load(e.path,t=>{this.resourceLoaded(e,t)}):e.type==="fbxModel"?this.loaders.fbxLoader?.load(e.path,t=>{this.resourceLoaded(e,t)}):e.type==="audio"?this.loaders.audioLoader?.load(e.path,t=>{this.resourceLoaded(e,t)}):e.type==="objModel"?this.loaders.objLoader?.load(e.path,t=>{this.resourceLoaded(e,t)}):e.type==="hdrTexture"?this.loaders.hdrTextureLoader?.load(e.path,t=>{this.resourceLoaded(e,t)}):e.type==="svg"?this.loaders.svgLoader?.load(e.path,t=>{this.resourceLoaded(e,t)}):e.type==="exrTexture"?this.loaders.exrLoader?.load(e.path,t=>{this.resourceLoaded(e,t)}):e.type==="video"?khe(e.path).then(t=>{this.resourceLoaded(e,t)}):e.type==="ktx2Texture"&&this.loaders.ktx2Loader?.load(e.path,t=>{this.resourceLoaded(e,t)})}resourceLoaded(e,t){this.items[e.name]=t,this.loaded+=1,this.isLoaded&&this.emit("ready")}get loadProgress(){return this.loaded/this.toLoad}get isLoaded(){return this.loaded===this.toLoad}}class jhe extends Sd{clock;deltaTime;elapsedTime;constructor(e){super(e);const t=new TE;this.clock=t,this.deltaTime=0,this.elapsedTime=0}update(e){const t=this.clock.getElapsedTime(),n=t-this.elapsedTime;this.deltaTime=n,this.elapsedTime=t,this.emit("tick")}}class qhe extends Sd{shadertoyUniforms;constructor(e){super(e),this.shadertoyUniforms={iGlobalTime:{value:0},iTime:{value:0},iTimeDelta:{value:0},iResolution:{value:new de(window.innerWidth,window.innerHeight,1)},iMouse:{value:new Tn(0,0,0,0)},iFrame:{value:0},iDate:{value:new Tn(new Date().getFullYear(),new Date().getMonth()+1,new Date().getDate(),new Date().getHours())},iSampleRate:{value:44100},iChannelTime:{value:[0,0,0,0]}}}injectShadertoyUniforms(e=this.shadertoyUniforms){const t=this.base.clock.elapsedTime;e.iGlobalTime.value=t,e.iTime.value=t;const n=this.base.clock.deltaTime;e.iTimeDelta.value=n,e.iResolution.value=new de(window.innerWidth,window.innerHeight,1);const{x:i,y:r}=this.base.iMouse.mouse;e.iMouse.value=new Tn(i,r,0,0),e.iDate.value=new Tn(new Date().getFullYear(),new Date().getMonth()+1,new Date().getDate(),new Date().getHours()),e.iChannelTime.value=[t,t,t,t],e.iFrame.value+=1}}class Khe extends Sd{mouse;mouseDOM;mouseScreen;prevMouseDOM;isMouseMoving;mouseMoveOffset;mouseDOMDelta;constructor(e){super(e);const t=new We(0,0);this.mouse=t;const n=new We(0,0);this.mouseDOM=n;const i=new We(0,0);this.mouseScreen=i,this.prevMouseDOM=new We(0,0),this.isMouseMoving=!1,this.mouseMoveOffset=4,this.mouseDOMDelta=new We(0,0)}getMouse(e,t){return new We(e,window.innerHeight-t)}getMouseDOM(e,t){return new We(e,t)}getMouseScreen(e,t){return new We(e-window.innerWidth/2,-(t-window.innerHeight/2))}listenForMouse(){const e=sz();e==="Desktop"?this.listenForDesktop():e==="Mobile"&&this.listenForMobile()}listenForDesktop(){window.addEventListener("mousemove",e=>{const t=this.getMouse(e.clientX,e.clientY);this.mouse=t;const n=this.getMouseDOM(e.clientX,e.clientY);this.mouseDOM=n;const i=this.getMouseScreen(e.clientX,e.clientY);this.mouseScreen=i})}listenForMobile(){window.addEventListener("touchstart",e=>{const t=this.getMouse(e.touches[0].clientX,e.touches[0].clientY);this.mouse=t;const n=this.getMouseDOM(e.touches[0].clientX,e.touches[0].clientY);this.mouseDOM=n;const i=this.getMouseScreen(e.touches[0].clientX,e.touches[0].clientY);this.mouseScreen=i}),window.addEventListener("touchmove",e=>{const t=this.getMouse(e.touches[0].clientX,e.touches[0].clientY);this.mouse=t;const n=this.getMouseDOM(e.touches[0].clientX,e.touches[0].clientY);this.mouseDOM=n;const i=this.getMouseScreen(e.touches[0].clientX,e.touches[0].clientY);this.mouseScreen=i})}syncMouseDOM(){this.prevMouseDOM.x=this.mouseDOM.x,this.prevMouseDOM.y=this.mouseDOM.y}judgeIsMouseMoving(){Math.abs(this.mouseDOMDelta.x)<this.mouseMoveOffset&&Math.abs(this.mouseDOMDelta.y)<this.mouseMoveOffset?this.isMouseMoving=!1:this.isMouseMoving=!0}getMouseDOMDelta(){const e=this.mouseDOM.x-this.prevMouseDOM.x,t=this.mouseDOM.y-this.prevMouseDOM.y,n=new We(e,t);this.mouseDOMDelta=n}update(e){this.getMouseDOMDelta(),this.judgeIsMouseMoving(),this.syncMouseDOM()}}const ab=(s,e)=>{const t=e.x-s.x,n=e.y-s.y;return Math.sqrt(t*t+n*n)},Yhe=(s,e)=>{const t=e.x-s.x,n=e.y-s.y;return Whe(Math.atan2(n,t))},Xhe=(s,e,t)=>{const n={x:0,y:0};return t=uR(t),n.x=s.x-e*Math.cos(t),n.y=s.y-e*Math.sin(t),n},uR=s=>s*(Math.PI/180),Whe=s=>s*(180/Math.PI),$he=s=>isNaN(s.buttons)?s.pressure!==0:s.buttons!==0,HM=new Map,IF=s=>{HM.has(s)&&clearTimeout(HM.get(s)),HM.set(s,setTimeout(s,100))},fT=(s,e,t)=>{const n=e.split(/[ ,]+/g);let i;for(let r=0;r<n.length;r+=1)i=n[r],s.addEventListener?s.addEventListener(i,t,!1):s.attachEvent&&s.attachEvent(i,t)},MF=(s,e,t)=>{const n=e.split(/[ ,]+/g);let i;for(let r=0;r<n.length;r+=1)i=n[r],s.removeEventListener?s.removeEventListener(i,t):s.detachEvent&&s.detachEvent(i,t)},rz=s=>(s.preventDefault(),s.type.match(/^touch/)?s.changedTouches:s),wF=()=>{const s=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:s,y:e}},RF=(s,e)=>{e.top||e.right||e.bottom||e.left?(s.style.top=e.top,s.style.right=e.right,s.style.bottom=e.bottom,s.style.left=e.left):(s.style.left=e.x+"px",s.style.top=e.y+"px")},dD=(s,e,t)=>{const n=az(s);for(let i in n)if(n.hasOwnProperty(i))if(typeof e=="string")n[i]=e+" "+t;else{let r="";for(let a=0,o=e.length;a<o;a+=1)r+=e[a]+" "+t+", ";n[i]=r.slice(0,-2)}return n},Jhe=(s,e)=>{const t=az(s);for(let n in t)t.hasOwnProperty(n)&&(t[n]=e);return t},az=s=>{const e={};return e[s]="",["webkit","Moz","o"].forEach(function(n){e[n+s.charAt(0).toUpperCase()+s.slice(1)]=""}),e},zM=(s,e)=>{for(let t in e)e.hasOwnProperty(t)&&(s[t]=e[t]);return s},Zhe=(s,e)=>{const t={};for(let n in s)s.hasOwnProperty(n)&&e.hasOwnProperty(n)?t[n]=e[n]:s.hasOwnProperty(n)&&(t[n]=s[n]);return t},hR=(s,e)=>{if(s.length)for(let t=0,n=s.length;t<n;t+=1)e(s[t]);else e(s)},efe=(s,e,t)=>({x:Math.min(Math.max(s.x,e.x-t),e.x+t),y:Math.min(Math.max(s.y,e.y-t),e.y+t)});var tfe="ontouchstart"in window,nfe=!!window.PointerEvent,ife=!!window.MSPointerEvent,ev={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},cA,tE={};nfe?cA=ev.pointer:ife?cA=ev.MSPointer:tfe?(cA=ev.touch,tE=ev.mouse):cA=ev.mouse;function Fh(){}Fh.prototype.on=function(s,e){var t=this,n=s.split(/[ ,]+/g),i;t._handlers_=t._handlers_||{};for(var r=0;r<n.length;r+=1)i=n[r],t._handlers_[i]=t._handlers_[i]||[],t._handlers_[i].push(e);return t};Fh.prototype.off=function(s,e){var t=this;return t._handlers_=t._handlers_||{},s===void 0?t._handlers_={}:e===void 0?t._handlers_[s]=null:t._handlers_[s]&&t._handlers_[s].indexOf(e)>=0&&t._handlers_[s].splice(t._handlers_[s].indexOf(e),1),t};Fh.prototype.trigger=function(s,e){var t=this,n=s.split(/[ ,]+/g),i;t._handlers_=t._handlers_||{};for(var r=0;r<n.length;r+=1)i=n[r],t._handlers_[i]&&t._handlers_[i].length&&t._handlers_[i].forEach(function(a){a.call(t,{type:i,target:t},e)})};Fh.prototype.config=function(s){var e=this;e.options=e.defaults||{},s&&(e.options=Zhe(e.options,s))};Fh.prototype.bindEvt=function(s,e){var t=this;return t._domHandlers_=t._domHandlers_||{},t._domHandlers_[e]=function(){typeof t["on"+e]=="function"?t["on"+e].apply(t,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},fT(s,cA[e],t._domHandlers_[e]),tE[e]&&fT(s,tE[e],t._domHandlers_[e]),t};Fh.prototype.unbindEvt=function(s,e){var t=this;return t._domHandlers_=t._domHandlers_||{},MF(s,cA[e],t._domHandlers_[e]),tE[e]&&MF(s,tE[e],t._domHandlers_[e]),delete t._domHandlers_[e],this};function pr(s,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=s,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=pr.id,pr.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}pr.prototype=new Fh;pr.constructor=pr;pr.id=0;pr.prototype.buildEl=function(s){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};pr.prototype.stylize=function(){if(this.options.dataOnly)return this;var s=this.options.fadeTime+"ms",e=Jhe("borderRadius","50%"),t=dD("transition","opacity",s),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},zM(n.el,t),this.options.shape==="circle"&&zM(n.back,e),zM(n.front,e),this.applyStyles(n),this};pr.prototype.applyStyles=function(s){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var t in s[e])this.ui[e].style[t]=s[e][t];return this};pr.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};pr.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};pr.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};pr.prototype.show=function(s){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof s=="function"&&s.call(this)},e.options.fadeTime)),e};pr.prototype.hide=function(s){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var t=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=t,typeof s=="function"&&s.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){const t=e.options.restJoystick,n={};n.x=t===!0||t.x!==!1?0:e.instance.frontPosition.x,n.y=t===!0||t.y!==!1?0:e.instance.frontPosition.y,e.setPosition(s,n)}return e};pr.prototype.setPosition=function(s,e){var t=this;t.frontPosition={x:e.x,y:e.y};var n=t.options.fadeTime+"ms",i={};i.front=dD("transition",["transform"],n);var r={front:{}};r.front={transform:"translate("+t.frontPosition.x+"px,"+t.frontPosition.y+"px)"},t.applyStyles(i),t.applyStyles(r),t.restTimeout=setTimeout(function(){typeof s=="function"&&s.call(t),t.restCallback()},t.options.fadeTime)};pr.prototype.restCallback=function(){var s=this,e={};e.front=dD("transition","none",""),s.applyStyles(e),s.trigger("rested",s.instance)};pr.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};pr.prototype.computeDirection=function(s){var e=s.angle.radian,t=Math.PI/4,n=Math.PI/2,i,r,a;if(e>t&&e<t*3&&!s.lockX?i="up":e>-t&&e<=t&&!s.lockY?i="left":e>-t*3&&e<=-t&&!s.lockX?i="down":s.lockY||(i="right"),s.lockY||(e>-n&&e<n?r="left":r="right"),s.lockX||(e>0?a="up":a="down"),s.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var c={};this.direction={x:r,y:a,angle:i},s.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return s;(!c.x||!c.y)&&this.trigger("plain",s),c.x||this.trigger("plain:"+r,s),c.y||this.trigger("plain:"+a,s),c.angle||this.trigger("dir dir:"+i,s)}else this.resetDirection();return s};function Ns(s,e){var t=this;t.nipples=[],t.idles=[],t.actives=[],t.ids=[],t.pressureIntervals={},t.manager=s,t.id=Ns.id,Ns.id+=1,t.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},t.config(e),(t.options.mode==="static"||t.options.mode==="semi")&&(t.options.multitouch=!1),t.options.multitouch||(t.options.maxNumberOfNipples=1);const n=getComputedStyle(t.options.zone.parentElement);return n&&n.display==="flex"&&(t.parentIsFlex=!0),t.updateBox(),t.prepareNipples(),t.bindings(),t.begin(),t.nipples}Ns.prototype=new Fh;Ns.constructor=Ns;Ns.id=0;Ns.prototype.prepareNipples=function(){var s=this,e=s.nipples;e.on=s.on.bind(s),e.off=s.off.bind(s),e.options=s.options,e.destroy=s.destroy.bind(s),e.ids=s.ids,e.id=s.id,e.processOnMove=s.processOnMove.bind(s),e.processOnEnd=s.processOnEnd.bind(s),e.get=function(t){if(t===void 0)return e[0];for(var n=0,i=e.length;n<i;n+=1)if(e[n].identifier===t)return e[n];return!1}};Ns.prototype.bindings=function(){var s=this;s.bindEvt(s.options.zone,"start"),s.options.zone.style.touchAction="none",s.options.zone.style.msTouchAction="none"};Ns.prototype.begin=function(){var s=this,e=s.options;if(e.mode==="static"){var t=s.createNipple(e.position,s.manager.getIdentifier());t.add(),s.idles.push(t)}};Ns.prototype.createNipple=function(s,e){var t=this,n=t.manager.scroll,i={},r=t.options,a={x:t.parentIsFlex?n.x:n.x+t.box.left,y:t.parentIsFlex?n.y:n.y+t.box.top};if(s.x&&s.y)i={x:s.x-a.x,y:s.y-a.y};else if(s.top||s.right||s.bottom||s.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=s.top,o.style.right=s.right,o.style.bottom=s.bottom,o.style.left=s.left,o.style.position="absolute",r.zone.appendChild(o);var l=o.getBoundingClientRect();r.zone.removeChild(o),i=s,s={x:l.left+n.x,y:l.top+n.y}}var c=new pr(t,{color:r.color,size:r.size,threshold:r.threshold,fadeTime:r.fadeTime,dataOnly:r.dataOnly,restJoystick:r.restJoystick,restOpacity:r.restOpacity,mode:r.mode,identifier:e,position:s,zone:r.zone,frontPosition:{x:0,y:0},shape:r.shape});return r.dataOnly||(RF(c.ui.el,i),RF(c.ui.front,c.frontPosition)),t.nipples.push(c),t.trigger("added "+c.identifier+":added",c),t.manager.trigger("added "+c.identifier+":added",c),t.bindNipple(c),c};Ns.prototype.updateBox=function(){var s=this;s.box=s.options.zone.getBoundingClientRect()};Ns.prototype.bindNipple=function(s){var e=this,t,n=function(i,r){t=i.type+" "+r.id+":"+i.type,e.trigger(t,r)};s.on("destroyed",e.onDestroyed.bind(e)),s.on("shown hidden rested dir plain",n),s.on("dir:up dir:right dir:down dir:left",n),s.on("plain:up plain:right plain:down plain:left",n)};Ns.prototype.pressureFn=function(s,e,t){var n=this,i=0;clearInterval(n.pressureIntervals[t]),n.pressureIntervals[t]=setInterval((function(){var r=s.force||s.pressure||s.webkitForce||0;r!==i&&(e.trigger("pressure",r),n.trigger("pressure "+e.identifier+":pressure",r),i=r)}).bind(n),100)};Ns.prototype.onstart=function(s){var e=this,t=e.options,n=s;s=rz(s),e.updateBox();var i=function(r){e.actives.length<t.maxNumberOfNipples?e.processOnStart(r):n.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(a){if(Object.values(n.touches).findIndex(function(l){return l.identifier===a})<0){var o=[s[0]];o.identifier=a,e.processOnEnd(o)}}),e.actives.length<t.maxNumberOfNipples&&e.processOnStart(r))};return hR(s,i),e.manager.bindDocument(),!1};Ns.prototype.processOnStart=function(s){var e=this,t=e.options,n,i=e.manager.getIdentifier(s),r=s.force||s.pressure||s.webkitForce||0,a={x:s.pageX,y:s.pageY},o=e.getOrCreate(i,a);o.identifier!==i&&e.manager.removeIdentifier(o.identifier),o.identifier=i;var l=function(h){h.trigger("start",h),e.trigger("start "+h.id+":start",h),h.show(),r>0&&e.pressureFn(s,h,h.identifier),e.processOnMove(s)};if((n=e.idles.indexOf(o))>=0&&e.idles.splice(n,1),e.actives.push(o),e.ids.push(o.identifier),t.mode!=="semi")l(o);else{var c=ab(a,o.position);if(c<=t.catchDistance)l(o);else{o.destroy(),e.processOnStart(s);return}}return o};Ns.prototype.getOrCreate=function(s,e){var t=this,n=t.options,i;return/(semi|static)/.test(n.mode)?(i=t.idles[0],i?(t.idles.splice(0,1),i):n.mode==="semi"?t.createNipple(e,s):(console.warn("Coudln't find the needed nipple."),!1)):(i=t.createNipple(e,s),i)};Ns.prototype.processOnMove=function(s){var e=this,t=e.options,n=e.manager.getIdentifier(s),i=e.nipples.get(n),r=e.manager.scroll;if(!$he(s)){this.processOnEnd(s);return}if(!i){console.error("Found zombie joystick with ID "+n),e.manager.removeIdentifier(n);return}if(t.dynamicPage){var a=i.el.getBoundingClientRect();i.position={x:r.x+a.left,y:r.y+a.top}}i.identifier=n;var o=i.options.size/2,l={x:s.pageX,y:s.pageY};t.lockX&&(l.y=i.position.y),t.lockY&&(l.x=i.position.x);var c=ab(l,i.position),h=Yhe(l,i.position),f=uR(h),p=c/o,g={distance:c,position:l},y,x;if(i.options.shape==="circle"?(y=Math.min(c,o),x=Xhe(i.position,y,h)):(x=efe(l,i.position,o),y=ab(x,i.position)),t.follow){if(c>o){let C=l.x-x.x,I=l.y-x.y;i.position.x+=C,i.position.y+=I,i.el.style.top=i.position.y-(e.box.top+r.y)+"px",i.el.style.left=i.position.x-(e.box.left+r.x)+"px",c=ab(l,i.position)}}else l=x,c=y;var E=l.x-i.position.x,_=l.y-i.position.y;i.frontPosition={x:E,y:_},t.dataOnly||(i.ui.front.style.transform="translate("+E+"px,"+_+"px)");var b={identifier:i.identifier,position:l,force:p,pressure:s.force||s.pressure||s.webkitForce||0,distance:c,angle:{radian:f,degree:h},vector:{x:E/o,y:-_/o},raw:g,instance:i,lockX:t.lockX,lockY:t.lockY};b=i.computeDirection(b),b.angle={radian:uR(180-h),degree:180-h},i.trigger("move",b),e.trigger("move "+i.id+":move",b)};Ns.prototype.processOnEnd=function(s){var e=this,t=e.options,n=e.manager.getIdentifier(s),i=e.nipples.get(n),r=e.manager.removeIdentifier(i.identifier);i&&(t.dataOnly||i.hide(function(){t.mode==="dynamic"&&(i.trigger("removed",i),e.trigger("removed "+i.id+":removed",i),e.manager.trigger("removed "+i.id+":removed",i),i.destroy())}),clearInterval(e.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),e.trigger("end "+i.id+":end",i),e.ids.indexOf(i.identifier)>=0&&e.ids.splice(e.ids.indexOf(i.identifier),1),e.actives.indexOf(i)>=0&&e.actives.splice(e.actives.indexOf(i),1),/(semi|static)/.test(t.mode)?e.idles.push(i):e.nipples.indexOf(i)>=0&&e.nipples.splice(e.nipples.indexOf(i),1),e.manager.unbindDocument(),/(semi|static)/.test(t.mode)&&(e.manager.ids[r.id]=r.identifier))};Ns.prototype.onDestroyed=function(s,e){var t=this;t.nipples.indexOf(e)>=0&&t.nipples.splice(t.nipples.indexOf(e),1),t.actives.indexOf(e)>=0&&t.actives.splice(t.actives.indexOf(e),1),t.idles.indexOf(e)>=0&&t.idles.splice(t.idles.indexOf(e),1),t.ids.indexOf(e.identifier)>=0&&t.ids.splice(t.ids.indexOf(e.identifier),1),t.manager.removeIdentifier(e.identifier),t.manager.unbindDocument()};Ns.prototype.destroy=function(){var s=this;s.unbindEvt(s.options.zone,"start"),s.nipples.forEach(function(t){t.destroy()});for(var e in s.pressureIntervals)s.pressureIntervals.hasOwnProperty(e)&&clearInterval(s.pressureIntervals[e]);s.trigger("destroyed",s.nipples),s.manager.unbindDocument(),s.off()};function br(s){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=wF(),e.config(s),e.prepareCollections();var t=function(){var i;e.collections.forEach(function(r){r.forEach(function(a){i=a.el.getBoundingClientRect(),a.position={x:e.scroll.x+i.left,y:e.scroll.y+i.top}})})};fT(window,"resize",function(){IF(t)});var n=function(){e.scroll=wF()};return fT(window,"scroll",function(){IF(n)}),e.collections}br.prototype=new Fh;br.constructor=br;br.prototype.prepareCollections=function(){var s=this;s.collections.create=s.create.bind(s),s.collections.on=s.on.bind(s),s.collections.off=s.off.bind(s),s.collections.destroy=s.destroy.bind(s),s.collections.get=function(e){var t;return s.collections.every(function(n){return t=n.get(e),!t}),t}};br.prototype.create=function(s){return this.createCollection(s)};br.prototype.createCollection=function(s){var e=this,t=new Ns(e,s);return e.bindCollection(t),e.collections.push(t),t};br.prototype.bindCollection=function(s){var e=this,t,n=function(i,r){t=i.type+" "+r.id+":"+i.type,e.trigger(t,r)};s.on("destroyed",e.onDestroyed.bind(e)),s.on("shown hidden rested dir plain",n),s.on("dir:up dir:right dir:down dir:left",n),s.on("plain:up plain:right plain:down plain:left",n)};br.prototype.bindDocument=function(){var s=this;s.binded||(s.bindEvt(document,"move").bindEvt(document,"end"),s.binded=!0)};br.prototype.unbindDocument=function(s){var e=this;(!Object.keys(e.ids).length||s===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)};br.prototype.getIdentifier=function(s){var e;return s?(e=s.identifier===void 0?s.pointerId:s.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]};br.prototype.removeIdentifier=function(s){var e={};for(var t in this.ids)if(this.ids[t]===s){e.id=t,e.identifier=this.ids[t],delete this.ids[t];break}return e};br.prototype.onmove=function(s){var e=this;return e.onAny("move",s),!1};br.prototype.onend=function(s){var e=this;return e.onAny("end",s),!1};br.prototype.oncancel=function(s){var e=this;return e.onAny("end",s),!1};br.prototype.onAny=function(s,e){var t=this,n,i="processOn"+s.charAt(0).toUpperCase()+s.slice(1);e=rz(e);var r=function(o,l,c){c.ids.indexOf(l)>=0&&(c[i](o),o._found_=!0)},a=function(o){n=t.getIdentifier(o),hR(t.collections,r.bind(null,o,n)),o._found_||t.removeIdentifier(n)};return hR(e,a),!1};br.prototype.destroy=function(){var s=this;s.unbindDocument(!0),s.ids={},s.index=0,s.collections.forEach(function(e){e.destroy()}),s.off()};br.prototype.onDestroyed=function(s,e){var t=this;if(t.collections.indexOf(e)<0)return!1;t.collections.splice(t.collections.indexOf(e),1)};new br;class sfe{keys;constructor(){this.keys={}}listenForKey(){window.addEventListener("keydown",e=>{this.onKeyDown(e)}),window.addEventListener("keyup",e=>{this.onKeyUp(e)})}onKeyDown(e){this.keys[e.key]=!0}onKeyUp(e){this.keys[e.key]=!1}get isUpKeyDown(){return this.keys.w||this.keys.ArrowUp}get isDownKeyDown(){return this.keys.s||this.keys.ArrowDown}get isLeftKeyDown(){return this.keys.a||this.keys.ArrowLeft}get isRightKeyDown(){return this.keys.d||this.keys.ArrowRight}get isSpaceKeyDown(){return this.keys[" "]}get isEnterKeyDown(){return this.keys.Enter}get isBackspaceKeyDown(){return this.keys.Backspace}get isCtrlKeyDown(){return this.keys.Control}get isShiftKeyDown(){return this.keys.Shift}get isTabKeyDown(){return this.keys.Tab}get isEscKeyDown(){return this.keys.Escape}}class rfe extends Sd{world;meshPhysicsObjects;constructor(e){super(e);const t=new Ihe;t.gravity.set(0,-9.82,0),this.world=t,this.meshPhysicsObjects=[]}add({mesh:e,body:t,copyPosition:n=!0,copyQuaternion:i=!0}){const r=new afe(e,t,n,i);this.base.physics.world.addBody(t),this.meshPhysicsObjects.push(r)}tick(){const e=this.world,t=this.base.clock.deltaTime;e.step(1/60,t,3)}sync(){this.meshPhysicsObjects.forEach(e=>{const{mesh:t,body:n,copyPosition:i,copyQuaternion:r}=e;i&&t.position.copy(n.position),r&&t.quaternion.copy(n.quaternion)})}update(e){this.sync(),this.tick()}}class afe{mesh;body;copyPosition;copyQuaternion;constructor(e,t,n=!0,i=!0){this.mesh=e,this.body=t,this.copyPosition=n,this.copyQuaternion=i}}class ofe extends Nh{frustum;useAspect;constructor(e={}){const t=window.innerWidth/window.innerHeight,{frustum:n=5.7,near:i=.1,far:r=2e3,useAspect:a=!0}=e,o=a?t:1;super(o*n*-.5,o*n*.5,n*.5,n*-.5,i,r),this.frustum=n,this.useAspect=a}}new bE;class lfe extends Sd{enabled;autoAdaptMobile;constructor(e,t={}){super(e),this.enabled=!0;const{autoAdaptMobile:n=!1}=t;this.autoAdaptMobile=n,this.autoAdaptMobile&&this.resize()}get aspect(){return window.innerWidth/window.innerHeight}resizeRenderer(e){e.setSize(window.innerWidth,window.innerHeight),e.setPixelRatio(Math.min(2,window.devicePixelRatio))}resizeComposer(e){e.setSize(window.innerWidth,window.innerHeight),e.setPixelRatio&&e.setPixelRatio(Math.min(2,window.devicePixelRatio))}resizeCamera(e){const{aspect:t}=this;if(e instanceof Ki)e.aspect=t,e.updateProjectionMatrix();else if(e instanceof ofe){const{frustum:n,useAspect:i}=e;if(n){const r=i?t:1;[e.left,e.right,e.top,e.bottom]=[r*n*-.5,r*n*.5,n*.5,n*-.5],e.updateProjectionMatrix()}}}resize(){const{base:e}=this,{renderer:t,camera:n,composer:i}=e;this.resizeRenderer(t),i&&this.resizeComposer(i),this.resizeCamera(n),this.autoAdaptMobile&&this.adaptMobile(),this.emit("resize")}listenForResize(){window.addEventListener("resize",()=>{this.enabled&&this.resize()})}enable(){this.enabled=!0}disable(){this.enabled=!1}adaptMobile(){const{base:e}=this,{renderer:t,camera:n}=e,i=document.documentElement.clientWidth,r=document.documentElement.clientHeight;i>r?(t.setSize(i,r),n instanceof Ki&&(n.aspect=i/r,n.updateProjectionMatrix())):(t.setSize(r,i),n instanceof Ki&&(n.aspect=r/i,n.updateProjectionMatrix()))}}class cfe{camera;scene;renderer;container;animator;interactionManager;composer;clock;iMouse;physics;resizer;keyboard;constructor(e="#sketch",t={}){const{hello:n=!0,gl:i={},autoAdaptMobile:r=!1,autoRender:a=!0}=t;n&&console.log("%c- powered by kokomi.js -","padding: 5px 10px; background: #030A8C; font-size: 11px");const o=new Ki(70,window.innerWidth/window.innerHeight,.01,100);o.position.z=1,this.camera=o;const l=new zT;this.scene=l;const c=new qB({antialias:!0,alpha:!0,...i});c.setSize(window.innerWidth,window.innerHeight),c.setPixelRatio(Math.min(2,window.devicePixelRatio)),this.renderer=c;const h=document.querySelector(e);h?.appendChild(c.domElement),this.container=h;const f=new tle(this,{autoRender:a});this.animator=f;const p=new Zoe(this.renderer,this.camera,this.renderer.domElement);this.interactionManager=p,this.composer=null;const g=new jhe(this);this.clock=g;const y=new Khe(this);this.iMouse=y;const x=new rfe(this);this.physics=x;const E=new lfe(this,{autoAdaptMobile:r});this.resizer=E;const _=new sfe;this.keyboard=_,this.init(),this.addEventListeners()}addEventListeners(){this.resizer.listenForResize(),this.iMouse.listenForMouse(),this.keyboard.listenForKey()}update(e){this.animator.add(e)}init(){this.update(()=>{this.interactionManager.update()}),this.animator.update()}render(){this.composer?this.composer.render():this.renderer.render(this.scene,this.camera)}async saveScreenshot(e="screenshot.png"){this.render();const t=await new Promise(n=>{this.renderer.domElement.toBlob(n,"image/png")});t&&Ghe(t,e)}destroy(){this.scene.traverse(e=>{e instanceof bi&&(e.geometry?.dispose(),Object.values(e.material).forEach(t=>{t&&typeof t.dispose=="function"&&t.dispose()}))}),this.renderer.dispose()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */var QM;/Mac/.test((QM=globalThis?.navigator)===null||QM===void 0?void 0:QM.platform);function Eh(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function oz(s,e){s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.__proto__=e}/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var ko={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},XA={duration:.5,overwrite:!1,delay:0},pD,Gr,is,yl=1e8,ki=1/yl,fR=Math.PI*2,ufe=fR/4,hfe=0,lz=Math.sqrt,ffe=Math.cos,dfe=Math.sin,Tr=function(e){return typeof e=="string"},bs=function(e){return typeof e=="function"},Dh=function(e){return typeof e=="number"},mD=function(e){return typeof e>"u"},wu=function(e){return typeof e=="object"},oo=function(e){return e!==!1},gD=function(){return typeof window<"u"},PS=function(e){return bs(e)||Tr(e)},cz=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},oa=Array.isArray,dR=/(?:-?\.?\d|\.)+/gi,uz=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,uA=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,VM=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,hz=/[+-]=-?[.\d]+/,fz=/[^,'"\[\]\s]+/gi,pfe=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ps,hu,pR,AD,Ho={},dT={},dz,pz=function(e){return(dT=WA(e,Ho))&&ho},yD=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},nE=function(e,t){return!t&&console.warn(e)},mz=function(e,t){return e&&(Ho[e]=t)&&dT&&(dT[e]=t)||Ho},iE=function(){return 0},mfe={suppressEvents:!0,isStart:!0,kill:!1},ob={suppressEvents:!0,kill:!1},gfe={suppressEvents:!0},vD={},rd=[],mR={},gz,Ro={},jM={},BF=30,lb=[],ED="",xD=function(e){var t=e[0],n,i;if(wu(t)||bs(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(i=lb.length;i--&&!lb[i].targetTest(t););n=lb[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new Gz(e[i],n)))||e.splice(i,1);return e},am=function(e){return e._gsap||xD(vl(e))[0]._gsap},Az=function(e,t,n){return(n=e[t])&&bs(n)?e[t]():mD(n)&&e.getAttribute&&e.getAttribute(t)||n},lo=function(e,t){return(e=e.split(",")).forEach(t)||e},Ls=function(e){return Math.round(e*1e5)/1e5||0},qs=function(e){return Math.round(e*1e7)/1e7||0},MA=function(e,t){var n=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+i:n==="-"?e-i:n==="*"?e*i:e/i},Afe=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},pT=function(){var e=rd.length,t=rd.slice(0),n,i;for(mR={},rd.length=0,n=0;n<e;n++)i=t[n],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},_D=function(e){return!!(e._initted||e._startAt||e.add)},yz=function(e,t,n,i){rd.length&&!Gr&&pT(),e.render(t,n,!!(Gr&&t<0&&_D(e))),rd.length&&!Gr&&pT()},vz=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(fz).length<2?t:Tr(e)?e.trim():e},Ez=function(e){return e},zo=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},yfe=function(e){return function(t,n){for(var i in n)i in t||i==="duration"&&e||i==="ease"||(t[i]=n[i])}},WA=function(e,t){for(var n in t)e[n]=t[n];return e},DF=function s(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=wu(t[n])?s(e[n]||(e[n]={}),t[n]):t[n]);return e},mT=function(e,t){var n={},i;for(i in e)i in t||(n[i]=e[i]);return n},Sv=function(e){var t=e.parent||ps,n=e.keyframes?yfe(oa(e.keyframes)):zo;if(oo(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},vfe=function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0},xz=function(e,t,n,i,r){var a=e[i],o;if(r)for(o=t[r];a&&a[r]>o;)a=a._prev;return a?(t._next=a._next,a._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=a,t.parent=t._dp=e,t},xC=function(e,t,n,i){n===void 0&&(n="_first"),i===void 0&&(i="_last");var r=t._prev,a=t._next;r?r._next=a:e[n]===t&&(e[n]=a),a?a._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},gd=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},om=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},Efe=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},gR=function(e,t,n,i){return e._startAt&&(Gr?e._startAt.revert(ob):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},xfe=function s(e){return!e||e._ts&&s(e.parent)},LF=function(e){return e._repeat?$A(e._tTime,e=e.duration()+e._rDelay)*e:0},$A=function(e,t){var n=Math.floor(e=qs(e/t));return e&&n===e?n-1:n},gT=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},_C=function(e){return e._end=qs(e._start+(e._tDur/Math.abs(e._ts||e._rts||ki)||0))},SC=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=qs(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),_C(e),n._dirty||om(n,e)),e},_z=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=gT(e.rawTime(),t),(!t._dur||FE(0,t.totalDuration(),n)-t._tTime>ki)&&t.render(n,!0)),om(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-ki}},du=function(e,t,n,i){return t.parent&&gd(t),t._start=qs((Dh(n)?n:n||e!==ps?fl(e,n,t):e._time)+t._delay),t._end=qs(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),xz(e,t,"_first","_last",e._sort?"_start":0),AR(t)||(e._recent=t),i||_z(e,t),e._ts<0&&SC(e,e._tTime),e},Sz=function(e,t){return(Ho.ScrollTrigger||yD("scrollTrigger",t))&&Ho.ScrollTrigger.create(t,e)},bz=function(e,t,n,i,r){if(bD(e,t,r),!e._initted)return 1;if(!n&&e._pt&&!Gr&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&gz!==Lo.frame)return rd.push(e),e._lazy=[r,i],1},_fe=function s(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||s(t))},AR=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},Sfe=function(e,t,n,i){var r=e.ratio,a=t<0||!t&&(!e._start&&_fe(e)&&!(!e._initted&&AR(e))||(e._ts<0||e._dp._ts<0)&&!AR(e))?0:1,o=e._rDelay,l=0,c,h,f;if(o&&e._repeat&&(l=FE(0,e._tDur,t),h=$A(l,o),e._yoyo&&h&1&&(a=1-a),h!==$A(e._tTime,o)&&(r=1-a,e.vars.repeatRefresh&&e._initted&&e.invalidate())),a!==r||Gr||i||e._zTime===ki||!t&&e._zTime){if(!e._initted&&bz(e,t,i,n,l))return;for(f=e._zTime,e._zTime=t||(n?ki:0),n||(n=t&&!f),e.ratio=a,e._from&&(a=1-a),e._time=0,e._tTime=l,c=e._pt;c;)c.r(a,c.d),c=c._next;t<0&&gR(e,t,n,!0),e._onUpdate&&!n&&No(e,"onUpdate"),l&&e._repeat&&!n&&e.parent&&No(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===a&&(a&&gd(e,1),!n&&!Gr&&(No(e,a?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},bfe=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},JA=function(e,t,n,i){var r=e._repeat,a=qs(t)||0,o=e._tTime/e._tDur;return o&&!i&&(e._time*=a/e._dur),e._dur=a,e._tDur=r?r<0?1e10:qs(a*(r+1)+e._rDelay*r):a,o>0&&!i&&SC(e,e._tTime=e._tDur*o),e.parent&&_C(e),n||om(e.parent,e),e},OF=function(e){return e instanceof Ia?om(e):JA(e,e._dur)},Tfe={_start:0,endTime:iE,totalDuration:iE},fl=function s(e,t,n){var i=e.labels,r=e._recent||Tfe,a=e.duration()>=yl?r.endTime(!1):e._dur,o,l,c;return Tr(t)&&(isNaN(t)||t in i)?(l=t.charAt(0),c=t.substr(-1)==="%",o=t.indexOf("="),l==="<"||l===">"?(o>=0&&(t=t.replace(/=/,"")),(l==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(o<0?r:n).totalDuration()/100:1)):o<0?(t in i||(i[t]=a),i[t]):(l=parseFloat(t.charAt(o-1)+t.substr(o+1)),c&&n&&(l=l/100*(oa(n)?n[0]:n).totalDuration()),o>1?s(e,t.substr(0,o-1),n)+l:a+l)):t==null?a:+t},bv=function(e,t,n){var i=Dh(t[1]),r=(i?2:1)+(e<2?0:1),a=t[r],o,l;if(i&&(a.duration=t[1]),a.parent=n,e){for(o=a,l=n;l&&!("immediateRender"in o);)o=l.vars.defaults||{},l=oo(l.vars.inherit)&&l.parent;a.immediateRender=oo(o.immediateRender),e<2?a.runBackwards=1:a.startAt=t[r-1]}return new js(t[0],a,t[r+1])},bd=function(e,t){return e||e===0?t(e):t},FE=function(e,t,n){return n<e?e:n>t?t:n},aa=function(e,t){return!Tr(e)||!(t=pfe.exec(e))?"":t[1]},Cfe=function(e,t,n){return bd(n,function(i){return FE(e,t,i)})},yR=[].slice,Tz=function(e,t){return e&&wu(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&wu(e[0]))&&!e.nodeType&&e!==hu},Ife=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(i){var r;return Tr(i)&&!t||Tz(i,1)?(r=n).push.apply(r,vl(i)):n.push(i)})||n},vl=function(e,t,n){return is&&!t&&is.selector?is.selector(e):Tr(e)&&!n&&(pR||!ZA())?yR.call((t||AD).querySelectorAll(e),0):oa(e)?Ife(e,n):Tz(e)?yR.call(e,0):e?[e]:[]},vR=function(e){return e=vl(e)[0]||nE("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return vl(t,n.querySelectorAll?n:n===e?nE("Invalid scope")||AD.createElement("div"):e)}},Cz=function(e){return e.sort(function(){return .5-Math.random()})},Iz=function(e){if(bs(e))return e;var t=wu(e)?e:{each:e},n=lm(t.ease),i=t.from||0,r=parseFloat(t.base)||0,a={},o=i>0&&i<1,l=isNaN(i)||o,c=t.axis,h=i,f=i;return Tr(i)?h=f={center:.5,edges:.5,end:1}[i]||0:!o&&l&&(h=i[0],f=i[1]),function(p,g,y){var x=(y||t).length,E=a[x],_,b,C,I,M,R,D,P,L;if(!E){if(L=t.grid==="auto"?0:(t.grid||[1,yl])[1],!L){for(D=-yl;D<(D=y[L++].getBoundingClientRect().left)&&L<x;);L<x&&L--}for(E=a[x]=[],_=l?Math.min(L,x)*h-.5:i%L,b=L===yl?0:l?x*f/L-.5:i/L|0,D=0,P=yl,R=0;R<x;R++)C=R%L-_,I=b-(R/L|0),E[R]=M=c?Math.abs(c==="y"?I:C):lz(C*C+I*I),M>D&&(D=M),M<P&&(P=M);i==="random"&&Cz(E),E.max=D-P,E.min=P,E.v=x=(parseFloat(t.amount)||parseFloat(t.each)*(L>x?x-1:c?c==="y"?x/L:L:Math.max(L,x/L))||0)*(i==="edges"?-1:1),E.b=x<0?r-x:r,E.u=aa(t.amount||t.each)||0,n=n&&x<0?Fz(n):n}return x=(E[p]-E.min)/E.max||0,qs(E.b+(n?n(x):x)*E.v)+E.u}},ER=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var i=qs(Math.round(parseFloat(n)/e)*e*t);return(i-i%1)/t+(Dh(n)?0:aa(n))}},Mz=function(e,t){var n=oa(e),i,r;return!n&&wu(e)&&(i=n=e.radius||yl,e.values?(e=vl(e.values),(r=!Dh(e[0]))&&(i*=i)):e=ER(e.increment)),bd(t,n?bs(e)?function(a){return r=e(a),Math.abs(r-a)<=i?r:a}:function(a){for(var o=parseFloat(r?a.x:a),l=parseFloat(r?a.y:0),c=yl,h=0,f=e.length,p,g;f--;)r?(p=e[f].x-o,g=e[f].y-l,p=p*p+g*g):p=Math.abs(e[f]-o),p<c&&(c=p,h=f);return h=!i||c<=i?e[h]:a,r||h===a||Dh(a)?h:h+aa(a)}:ER(e))},wz=function(e,t,n,i){return bd(oa(e)?!t:n===!0?!!(n=0):!i,function(){return oa(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*i)/i})},Mfe=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(i){return t.reduce(function(r,a){return a(r)},i)}},wfe=function(e,t){return function(n){return e(parseFloat(n))+(t||aa(n))}},Rfe=function(e,t,n){return Bz(e,t,0,1,n)},Rz=function(e,t,n){return bd(n,function(i){return e[~~t(i)]})},Bfe=function s(e,t,n){var i=t-e;return oa(e)?Rz(e,s(0,e.length),t):bd(n,function(r){return(i+(r-e)%i)%i+e})},Dfe=function s(e,t,n){var i=t-e,r=i*2;return oa(e)?Rz(e,s(0,e.length-1),t):bd(n,function(a){return a=(r+(a-e)%r)%r||0,e+(a>i?r-a:a)})},sE=function(e){for(var t=0,n="",i,r,a,o;~(i=e.indexOf("random(",t));)a=e.indexOf(")",i),o=e.charAt(i+7)==="[",r=e.substr(i+7,a-i-7).match(o?fz:dR),n+=e.substr(t,i-t)+wz(o?r:+r[0],o?0:+r[1],+r[2]||1e-5),t=a+1;return n+e.substr(t,e.length-t)},Bz=function(e,t,n,i,r){var a=t-e,o=i-n;return bd(r,function(l){return n+((l-e)/a*o||0)})},Lfe=function s(e,t,n,i){var r=isNaN(e+t)?0:function(g){return(1-g)*e+g*t};if(!r){var a=Tr(e),o={},l,c,h,f,p;if(n===!0&&(i=1)&&(n=null),a)e={p:e},t={p:t};else if(oa(e)&&!oa(t)){for(h=[],f=e.length,p=f-2,c=1;c<f;c++)h.push(s(e[c-1],e[c]));f--,r=function(y){y*=f;var x=Math.min(p,~~y);return h[x](y-x)},n=t}else i||(e=WA(oa(e)?[]:{},e));if(!h){for(l in t)SD.call(o,e,l,"get",t[l]);r=function(y){return ID(y,o)||(a?e.p:e)}}}return bd(n,r)},PF=function(e,t,n){var i=e.labels,r=yl,a,o,l;for(a in i)o=i[a]-t,o<0==!!n&&o&&r>(o=Math.abs(o))&&(l=a,r=o);return l},No=function(e,t,n){var i=e.vars,r=i[t],a=is,o=e._ctx,l,c,h;if(r)return l=i[t+"Params"],c=i.callbackScope||e,n&&rd.length&&pT(),o&&(is=o),h=l?r.apply(c,l):r.call(c),is=a,h},av=function(e){return gd(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Gr),e.progress()<1&&No(e,"onInterrupt"),e},hA,Dz=[],Lz=function(e){if(e)if(e=!e.name&&e.default||e,gD()||e.headless){var t=e.name,n=bs(e),i=t&&!n&&e.init?function(){this._props=[]}:e,r={init:iE,render:ID,add:SD,kill:Xfe,modifier:Yfe,rawVars:0},a={targetTest:0,get:0,getSetter:CD,aliases:{},register:0};if(ZA(),e!==i){if(Ro[t])return;zo(i,zo(mT(e,r),a)),WA(i.prototype,WA(r,mT(e,a))),Ro[i.prop=t]=i,e.targetTest&&(lb.push(i),vD[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}mz(t,i),e.register&&e.register(ho,i,co)}else Dz.push(e)},Fi=255,ov={aqua:[0,Fi,Fi],lime:[0,Fi,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Fi],navy:[0,0,128],white:[Fi,Fi,Fi],olive:[128,128,0],yellow:[Fi,Fi,0],orange:[Fi,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Fi,0,0],pink:[Fi,192,203],cyan:[0,Fi,Fi],transparent:[Fi,Fi,Fi,0]},qM=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*Fi+.5|0},Oz=function(e,t,n){var i=e?Dh(e)?[e>>16,e>>8&Fi,e&Fi]:0:ov.black,r,a,o,l,c,h,f,p,g,y;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),ov[e])i=ov[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),a=e.charAt(2),o=e.charAt(3),e="#"+r+r+a+a+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&Fi,i&Fi,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&Fi,e&Fi]}else if(e.substr(0,3)==="hsl"){if(i=y=e.match(dR),!t)l=+i[0]%360/360,c=+i[1]/100,h=+i[2]/100,a=h<=.5?h*(c+1):h+c-h*c,r=h*2-a,i.length>3&&(i[3]*=1),i[0]=qM(l+1/3,r,a),i[1]=qM(l,r,a),i[2]=qM(l-1/3,r,a);else if(~e.indexOf("="))return i=e.match(uz),n&&i.length<4&&(i[3]=1),i}else i=e.match(dR)||ov.transparent;i=i.map(Number)}return t&&!y&&(r=i[0]/Fi,a=i[1]/Fi,o=i[2]/Fi,f=Math.max(r,a,o),p=Math.min(r,a,o),h=(f+p)/2,f===p?l=c=0:(g=f-p,c=h>.5?g/(2-f-p):g/(f+p),l=f===r?(a-o)/g+(a<o?6:0):f===a?(o-r)/g+2:(r-a)/g+4,l*=60),i[0]=~~(l+.5),i[1]=~~(c*100+.5),i[2]=~~(h*100+.5)),n&&i.length<4&&(i[3]=1),i},Pz=function(e){var t=[],n=[],i=-1;return e.split(ad).forEach(function(r){var a=r.match(uA)||[];t.push.apply(t,a),n.push(i+=a.length+1)}),t.c=n,t},NF=function(e,t,n){var i="",r=(e+i).match(ad),a=t?"hsla(":"rgba(",o=0,l,c,h,f;if(!r)return e;if(r=r.map(function(p){return(p=Oz(p,t,1))&&a+(t?p[0]+","+p[1]+"%,"+p[2]+"%,"+p[3]:p.join(","))+")"}),n&&(h=Pz(e),l=n.c,l.join(i)!==h.c.join(i)))for(c=e.replace(ad,"1").split(uA),f=c.length-1;o<f;o++)i+=c[o]+(~l.indexOf(o)?r.shift()||a+"0,0,0,0)":(h.length?h:r.length?r:n).shift());if(!c)for(c=e.split(ad),f=c.length-1;o<f;o++)i+=c[o]+r[o];return i+c[f]},ad=(function(){var s="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in ov)s+="|"+e+"\\b";return new RegExp(s+")","gi")})(),Ofe=/hsl[a]?\(/,Nz=function(e){var t=e.join(" "),n;if(ad.lastIndex=0,ad.test(t))return n=Ofe.test(t),e[1]=NF(e[1],n),e[0]=NF(e[0],n,Pz(e[1])),!0},rE,Lo=(function(){var s=Date.now,e=500,t=33,n=s(),i=n,r=1e3/240,a=r,o=[],l,c,h,f,p,g,y=function x(E){var _=s()-i,b=E===!0,C,I,M,R;if((_>e||_<0)&&(n+=_-t),i+=_,M=i-n,C=M-a,(C>0||b)&&(R=++f.frame,p=M-f.time*1e3,f.time=M=M/1e3,a+=C+(C>=r?4:r-C),I=1),b||(l=c(x)),I)for(g=0;g<o.length;g++)o[g](M,p,R,E)};return f={time:0,frame:0,tick:function(){y(!0)},deltaRatio:function(E){return p/(1e3/(E||60))},wake:function(){dz&&(!pR&&gD()&&(hu=pR=window,AD=hu.document||{},Ho.gsap=ho,(hu.gsapVersions||(hu.gsapVersions=[])).push(ho.version),pz(dT||hu.GreenSockGlobals||!hu.gsap&&hu||{}),Dz.forEach(Lz)),h=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&f.sleep(),c=h||function(E){return setTimeout(E,a-f.time*1e3+1|0)},rE=1,y(2))},sleep:function(){(h?cancelAnimationFrame:clearTimeout)(l),rE=0,c=iE},lagSmoothing:function(E,_){e=E||1/0,t=Math.min(_||33,e)},fps:function(E){r=1e3/(E||240),a=f.time*1e3+r},add:function(E,_,b){var C=_?function(I,M,R,D){E(I,M,R,D),f.remove(C)}:E;return f.remove(E),o[b?"unshift":"push"](C),ZA(),C},remove:function(E,_){~(_=o.indexOf(E))&&o.splice(_,1)&&g>=_&&g--},_listeners:o},f})(),ZA=function(){return!rE&&Lo.wake()},Zn={},Pfe=/^[\d.\-M][\d.\-,\s]/,Nfe=/["']/g,Ffe=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),i=n[0],r=1,a=n.length,o,l,c;r<a;r++)l=n[r],o=r!==a-1?l.lastIndexOf(","):l.length,c=l.substr(0,o),t[i]=isNaN(c)?c.replace(Nfe,"").trim():+c,i=l.substr(o+1).trim();return t},Ufe=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<n?e.indexOf(")",n+1):n)},kfe=function(e){var t=(e+"").split("("),n=Zn[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[Ffe(t[1])]:Ufe(e).split(",").map(vz)):Zn._CE&&Pfe.test(e)?Zn._CE("",e):n},Fz=function(e){return function(t){return 1-e(1-t)}},Uz=function s(e,t){for(var n=e._first,i;n;)n instanceof Ia?s(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?s(n.timeline,t):(i=n._ease,n._ease=n._yEase,n._yEase=i,n._yoyo=t)),n=n._next},lm=function(e,t){return e&&(bs(e)?e:Zn[e]||kfe(e))||t},_m=function(e,t,n,i){n===void 0&&(n=function(l){return 1-t(1-l)}),i===void 0&&(i=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var r={easeIn:t,easeOut:n,easeInOut:i},a;return lo(e,function(o){Zn[o]=Ho[o]=r,Zn[a=o.toLowerCase()]=n;for(var l in r)Zn[a+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=Zn[o+"."+l]=r[l]}),r},kz=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},KM=function s(e,t,n){var i=t>=1?t:1,r=(n||(e?.3:.45))/(t<1?t:1),a=r/fR*(Math.asin(1/i)||0),o=function(h){return h===1?1:i*Math.pow(2,-10*h)*dfe((h-a)*r)+1},l=e==="out"?o:e==="in"?function(c){return 1-o(1-c)}:kz(o);return r=fR/r,l.config=function(c,h){return s(e,c,h)},l},YM=function s(e,t){t===void 0&&(t=1.70158);var n=function(a){return a?--a*a*((t+1)*a+t)+1:0},i=e==="out"?n:e==="in"?function(r){return 1-n(1-r)}:kz(n);return i.config=function(r){return s(e,r)},i};lo("Linear,Quad,Cubic,Quart,Quint,Strong",function(s,e){var t=e<5?e+1:e;_m(s+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});Zn.Linear.easeNone=Zn.none=Zn.Linear.easeIn;_m("Elastic",KM("in"),KM("out"),KM());(function(s,e){var t=1/e,n=2*t,i=2.5*t,r=function(o){return o<t?s*o*o:o<n?s*Math.pow(o-1.5/e,2)+.75:o<i?s*(o-=2.25/e)*o+.9375:s*Math.pow(o-2.625/e,2)+.984375};_m("Bounce",function(a){return 1-r(1-a)},r)})(7.5625,2.75);_m("Expo",function(s){return Math.pow(2,10*(s-1))*s+s*s*s*s*s*s*(1-s)});_m("Circ",function(s){return-(lz(1-s*s)-1)});_m("Sine",function(s){return s===1?1:-ffe(s*ufe)+1});_m("Back",YM("in"),YM("out"),YM());Zn.SteppedEase=Zn.steps=Ho.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,i=e+(t?0:1),r=t?1:0,a=1-ki;return function(o){return((i*FE(0,a,o)|0)+r)*n}}};XA.ease=Zn["quad.out"];lo("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(s){return ED+=s+","+s+"Params,"});var Gz=function(e,t){this.id=hfe++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Az,this.set=t?t.getSetter:CD},aE=(function(){function s(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,JA(this,+t.duration,1,1),this.data=t.data,is&&(this._ctx=is,is.data.push(this)),rE||Lo.wake()}var e=s.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,JA(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,i){if(ZA(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(SC(this,n),!r._dp||r.parent||_z(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&du(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===ki||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),yz(this,n,i)),this},e.time=function(n,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+LF(this))%(this._dur+this._rDelay)||(n?this._dur:0),i):this._time},e.totalProgress=function(n,i){return arguments.length?this.totalTime(this.totalDuration()*n,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(n,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+LF(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(n,i){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*r,i):this._repeat?$A(this._tTime,r)+1:1},e.timeScale=function(n,i){if(!arguments.length)return this._rts===-ki?0:this._rts;if(this._rts===n)return this;var r=this.parent&&this._ts?gT(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-ki?0:this._rts,this.totalTime(FE(-Math.abs(this._delay),this.totalDuration(),r),i!==!1),_C(this),Efe(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(ZA(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==ki&&(this._tTime-=ki)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&du(i,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(oo(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var i=this.parent||this._dp;return i?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?gT(i.rawTime(n),this):this._tTime:this._tTime},e.revert=function(n){n===void 0&&(n=gfe);var i=Gr;return Gr=n,_D(this)&&(this.timeline&&this.timeline.revert(n),this.totalTime(-.01,n.suppressEvents)),this.data!=="nested"&&n.kill!==!1&&this.kill(),Gr=i,this},e.globalTime=function(n){for(var i=this,r=arguments.length?n:i.rawTime();i;)r=i._start+r/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(n):r},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,OF(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var i=this._time;return this._rDelay=n,OF(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,i){return this.totalTime(fl(this,n),oo(i))},e.restart=function(n,i){return this.play().totalTime(n?-this._delay:0,oo(i)),this._dur||(this._zTime=-ki),this},e.play=function(n,i){return n!=null&&this.seek(n,i),this.reversed(!1).paused(!1)},e.reverse=function(n,i){return n!=null&&this.seek(n||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(n,i){return n!=null&&this.seek(n,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-ki:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-ki,this},e.isActive=function(){var n=this.parent||this._dp,i=this._start,r;return!!(!n||this._ts&&this._initted&&n.isActive()&&(r=n.rawTime(!0))>=i&&r<this.endTime(!0)-ki)},e.eventCallback=function(n,i,r){var a=this.vars;return arguments.length>1?(i?(a[n]=i,r&&(a[n+"Params"]=r),n==="onUpdate"&&(this._onUpdate=i)):delete a[n],this):a[n]},e.then=function(n){var i=this;return new Promise(function(r){var a=bs(n)?n:Ez,o=function(){var c=i.then;i.then=null,bs(a)&&(a=a(i))&&(a.then||a===i)&&(i.then=c),r(a),i.then=c};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?o():i._prom=o})},e.kill=function(){av(this)},s})();zo(aE.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-ki,_prom:0,_ps:!1,_rts:1});var Ia=(function(s){oz(e,s);function e(n,i){var r;return n===void 0&&(n={}),r=s.call(this,n)||this,r.labels={},r.smoothChildTiming=!!n.smoothChildTiming,r.autoRemoveChildren=!!n.autoRemoveChildren,r._sort=oo(n.sortChildren),ps&&du(n.parent||ps,Eh(r),i),n.reversed&&r.reverse(),n.paused&&r.paused(!0),n.scrollTrigger&&Sz(Eh(r),n.scrollTrigger),r}var t=e.prototype;return t.to=function(i,r,a){return bv(0,arguments,this),this},t.from=function(i,r,a){return bv(1,arguments,this),this},t.fromTo=function(i,r,a,o){return bv(2,arguments,this),this},t.set=function(i,r,a){return r.duration=0,r.parent=this,Sv(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new js(i,r,fl(this,a),1),this},t.call=function(i,r,a){return du(this,js.delayedCall(0,i,r),a)},t.staggerTo=function(i,r,a,o,l,c,h){return a.duration=r,a.stagger=a.stagger||o,a.onComplete=c,a.onCompleteParams=h,a.parent=this,new js(i,a,fl(this,l)),this},t.staggerFrom=function(i,r,a,o,l,c,h){return a.runBackwards=1,Sv(a).immediateRender=oo(a.immediateRender),this.staggerTo(i,r,a,o,l,c,h)},t.staggerFromTo=function(i,r,a,o,l,c,h,f){return o.startAt=a,Sv(o).immediateRender=oo(o.immediateRender),this.staggerTo(i,r,o,l,c,h,f)},t.render=function(i,r,a){var o=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,h=i<=0?0:qs(i),f=this._zTime<0!=i<0&&(this._initted||!c),p,g,y,x,E,_,b,C,I,M,R,D;if(this!==ps&&h>l&&i>=0&&(h=l),h!==this._tTime||a||f){if(o!==this._time&&c&&(h+=this._time-o,i+=this._time-o),p=h,I=this._start,C=this._ts,_=!C,f&&(c||(o=this._zTime),(i||!r)&&(this._zTime=i)),this._repeat){if(R=this._yoyo,E=c+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(E*100+i,r,a);if(p=qs(h%E),h===l?(x=this._repeat,p=c):(M=qs(h/E),x=~~M,x&&x===M&&(p=c,x--),p>c&&(p=c)),M=$A(this._tTime,E),!o&&this._tTime&&M!==x&&this._tTime-M*E-this._dur<=0&&(M=x),R&&x&1&&(p=c-p,D=1),x!==M&&!this._lock){var P=R&&M&1,L=P===(R&&x&1);if(x<M&&(P=!P),o=P?0:h%c?c:h,this._lock=1,this.render(o||(D?0:qs(x*E)),r,!c)._lock=0,this._tTime=h,!r&&this.parent&&No(this,"onRepeat"),this.vars.repeatRefresh&&!D&&(this.invalidate()._lock=1),o&&o!==this._time||_!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,L&&(this._lock=2,o=P?c:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!D&&this.invalidate()),this._lock=0,!this._ts&&!_)return this;Uz(this,D)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(b=bfe(this,qs(o),qs(p)),b&&(h-=p-(p=b._start))),this._tTime=h,this._time=p,this._act=!C,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,o=0),!o&&h&&!r&&!M&&(No(this,"onStart"),this._tTime!==h))return this;if(p>=o&&i>=0)for(g=this._first;g;){if(y=g._next,(g._act||p>=g._start)&&g._ts&&b!==g){if(g.parent!==this)return this.render(i,r,a);if(g.render(g._ts>0?(p-g._start)*g._ts:(g._dirty?g.totalDuration():g._tDur)+(p-g._start)*g._ts,r,a),p!==this._time||!this._ts&&!_){b=0,y&&(h+=this._zTime=-ki);break}}g=y}else{g=this._last;for(var O=i<0?i:p;g;){if(y=g._prev,(g._act||O<=g._end)&&g._ts&&b!==g){if(g.parent!==this)return this.render(i,r,a);if(g.render(g._ts>0?(O-g._start)*g._ts:(g._dirty?g.totalDuration():g._tDur)+(O-g._start)*g._ts,r,a||Gr&&_D(g)),p!==this._time||!this._ts&&!_){b=0,y&&(h+=this._zTime=O?-ki:ki);break}}g=y}}if(b&&!r&&(this.pause(),b.render(p>=o?0:-ki)._zTime=p>=o?1:-1,this._ts))return this._start=I,_C(this),this.render(i,r,a);this._onUpdate&&!r&&No(this,"onUpdate",!0),(h===l&&this._tTime>=this.totalDuration()||!h&&o)&&(I===this._start||Math.abs(C)!==Math.abs(this._ts))&&(this._lock||((i||!c)&&(h===l&&this._ts>0||!h&&this._ts<0)&&gd(this,1),!r&&!(i<0&&!o)&&(h||o||!l)&&(No(this,h===l&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,r){var a=this;if(Dh(r)||(r=fl(this,r,i)),!(i instanceof aE)){if(oa(i))return i.forEach(function(o){return a.add(o,r)}),this;if(Tr(i))return this.addLabel(i,r);if(bs(i))i=js.delayedCall(0,i);else return this}return this!==i?du(this,i,r):this},t.getChildren=function(i,r,a,o){i===void 0&&(i=!0),r===void 0&&(r=!0),a===void 0&&(a=!0),o===void 0&&(o=-yl);for(var l=[],c=this._first;c;)c._start>=o&&(c instanceof js?r&&l.push(c):(a&&l.push(c),i&&l.push.apply(l,c.getChildren(!0,r,a)))),c=c._next;return l},t.getById=function(i){for(var r=this.getChildren(1,1,1),a=r.length;a--;)if(r[a].vars.id===i)return r[a]},t.remove=function(i){return Tr(i)?this.removeLabel(i):bs(i)?this.killTweensOf(i):(i.parent===this&&xC(this,i),i===this._recent&&(this._recent=this._last),om(this))},t.totalTime=function(i,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=qs(Lo.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),s.prototype.totalTime.call(this,i,r),this._forcing=0,this):this._tTime},t.addLabel=function(i,r){return this.labels[i]=fl(this,r),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,r,a){var o=js.delayedCall(0,r||iE,a);return o.data="isPause",this._hasPause=1,du(this,o,fl(this,i))},t.removePause=function(i){var r=this._first;for(i=fl(this,i);r;)r._start===i&&r.data==="isPause"&&gd(r),r=r._next},t.killTweensOf=function(i,r,a){for(var o=this.getTweensOf(i,a),l=o.length;l--;)ed!==o[l]&&o[l].kill(i,r);return this},t.getTweensOf=function(i,r){for(var a=[],o=vl(i),l=this._first,c=Dh(r),h;l;)l instanceof js?Afe(l._targets,o)&&(c?(!ed||l._initted&&l._ts)&&l.globalTime(0)<=r&&l.globalTime(l.totalDuration())>r:!r||l.isActive())&&a.push(l):(h=l.getTweensOf(o,r)).length&&a.push.apply(a,h),l=l._next;return a},t.tweenTo=function(i,r){r=r||{};var a=this,o=fl(a,i),l=r,c=l.startAt,h=l.onStart,f=l.onStartParams,p=l.immediateRender,g,y=js.to(a,zo({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:r.duration||Math.abs((o-(c&&"time"in c?c.time:a._time))/a.timeScale())||ki,onStart:function(){if(a.pause(),!g){var E=r.duration||Math.abs((o-(c&&"time"in c?c.time:a._time))/a.timeScale());y._dur!==E&&JA(y,E,0,1).render(y._time,!0,!0),g=1}h&&h.apply(y,f||[])}},r));return p?y.render(0):y},t.tweenFromTo=function(i,r,a){return this.tweenTo(r,zo({startAt:{time:fl(this,i)}},a))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),PF(this,fl(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),PF(this,fl(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+ki)},t.shiftChildren=function(i,r,a){a===void 0&&(a=0);for(var o=this._first,l=this.labels,c;o;)o._start>=a&&(o._start+=i,o._end+=i),o=o._next;if(r)for(c in l)l[c]>=a&&(l[c]+=i);return om(this)},t.invalidate=function(i){var r=this._first;for(this._lock=0;r;)r.invalidate(i),r=r._next;return s.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var r=this._first,a;r;)a=r._next,this.remove(r),r=a;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),om(this)},t.totalDuration=function(i){var r=0,a=this,o=a._last,l=yl,c,h,f;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-i:i));if(a._dirty){for(f=a.parent;o;)c=o._prev,o._dirty&&o.totalDuration(),h=o._start,h>l&&a._sort&&o._ts&&!a._lock?(a._lock=1,du(a,o,h-o._delay,1)._lock=0):l=h,h<0&&o._ts&&(r-=h,(!f&&!a._dp||f&&f.smoothChildTiming)&&(a._start+=h/a._ts,a._time-=h,a._tTime-=h),a.shiftChildren(-h,!1,-1/0),l=0),o._end>r&&o._ts&&(r=o._end),o=c;JA(a,a===ps&&a._time>r?a._time:r,1,1),a._dirty=0}return a._tDur},e.updateRoot=function(i){if(ps._ts&&(yz(ps,gT(i,ps)),gz=Lo.frame),Lo.frame>=BF){BF+=ko.autoSleep||120;var r=ps._first;if((!r||!r._ts)&&ko.autoSleep&&Lo._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||Lo.sleep()}}},e})(aE);zo(Ia.prototype,{_lock:0,_hasPause:0,_forcing:0});var Gfe=function(e,t,n,i,r,a,o){var l=new co(this._pt,e,t,0,1,qz,null,r),c=0,h=0,f,p,g,y,x,E,_,b;for(l.b=n,l.e=i,n+="",i+="",(_=~i.indexOf("random("))&&(i=sE(i)),a&&(b=[n,i],a(b,e,t),n=b[0],i=b[1]),p=n.match(VM)||[];f=VM.exec(i);)y=f[0],x=i.substring(c,f.index),g?g=(g+1)%5:x.substr(-5)==="rgba("&&(g=1),y!==p[h++]&&(E=parseFloat(p[h-1])||0,l._pt={_next:l._pt,p:x||h===1?x:",",s:E,c:y.charAt(1)==="="?MA(E,y)-E:parseFloat(y)-E,m:g&&g<4?Math.round:0},c=VM.lastIndex);return l.c=c<i.length?i.substring(c,i.length):"",l.fp=o,(hz.test(i)||_)&&(l.e=0),this._pt=l,l},SD=function(e,t,n,i,r,a,o,l,c,h){bs(i)&&(i=i(r||0,e,a));var f=e[t],p=n!=="get"?n:bs(f)?c?e[t.indexOf("set")||!bs(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():f,g=bs(f)?c?jfe:Vz:TD,y;if(Tr(i)&&(~i.indexOf("random(")&&(i=sE(i)),i.charAt(1)==="="&&(y=MA(p,i)+(aa(p)||0),(y||y===0)&&(i=y))),!h||p!==i||xR)return!isNaN(p*i)&&i!==""?(y=new co(this._pt,e,t,+p||0,i-(p||0),typeof f=="boolean"?Kfe:jz,0,g),c&&(y.fp=c),o&&y.modifier(o,this,e),this._pt=y):(!f&&!(t in e)&&yD(t,i),Gfe.call(this,e,t,p,i,g,l||ko.stringFilter,c))},Hfe=function(e,t,n,i,r){if(bs(e)&&(e=Tv(e,r,t,n,i)),!wu(e)||e.style&&e.nodeType||oa(e)||cz(e))return Tr(e)?Tv(e,r,t,n,i):e;var a={},o;for(o in e)a[o]=Tv(e[o],r,t,n,i);return a},Hz=function(e,t,n,i,r,a){var o,l,c,h;if(Ro[e]&&(o=new Ro[e]).init(r,o.rawVars?t[e]:Hfe(t[e],i,r,a,n),n,i,a)!==!1&&(n._pt=l=new co(n._pt,r,e,0,1,o.render,o,0,o.priority),n!==hA))for(c=n._ptLookup[n._targets.indexOf(r)],h=o._props.length;h--;)c[o._props[h]]=l;return o},ed,xR,bD=function s(e,t,n){var i=e.vars,r=i.ease,a=i.startAt,o=i.immediateRender,l=i.lazy,c=i.onUpdate,h=i.runBackwards,f=i.yoyoEase,p=i.keyframes,g=i.autoRevert,y=e._dur,x=e._startAt,E=e._targets,_=e.parent,b=_&&_.data==="nested"?_.vars.targets:E,C=e._overwrite==="auto"&&!pD,I=e.timeline,M,R,D,P,L,O,U,j,H,z,q,k,W;if(I&&(!p||!r)&&(r="none"),e._ease=lm(r,XA.ease),e._yEase=f?Fz(lm(f===!0?r:f,XA.ease)):0,f&&e._yoyo&&!e._repeat&&(f=e._yEase,e._yEase=e._ease,e._ease=f),e._from=!I&&!!i.runBackwards,!I||p&&!i.stagger){if(j=E[0]?am(E[0]).harness:0,k=j&&i[j.prop],M=mT(i,vD),x&&(x._zTime<0&&x.progress(1),t<0&&h&&o&&!g?x.render(-1,!0):x.revert(h&&y?ob:mfe),x._lazy=0),a){if(gd(e._startAt=js.set(E,zo({data:"isStart",overwrite:!1,parent:_,immediateRender:!0,lazy:!x&&oo(l),startAt:null,delay:0,onUpdate:c&&function(){return No(e,"onUpdate")},stagger:0},a))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Gr||!o&&!g)&&e._startAt.revert(ob),o&&y&&t<=0&&n<=0){t&&(e._zTime=t);return}}else if(h&&y&&!x){if(t&&(o=!1),D=zo({overwrite:!1,data:"isFromStart",lazy:o&&!x&&oo(l),immediateRender:o,stagger:0,parent:_},M),k&&(D[j.prop]=k),gd(e._startAt=js.set(E,D)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Gr?e._startAt.revert(ob):e._startAt.render(-1,!0)),e._zTime=t,!o)s(e._startAt,ki,ki);else if(!t)return}for(e._pt=e._ptCache=0,l=y&&oo(l)||l&&!y,R=0;R<E.length;R++){if(L=E[R],U=L._gsap||xD(E)[R]._gsap,e._ptLookup[R]=z={},mR[U.id]&&rd.length&&pT(),q=b===E?R:b.indexOf(L),j&&(H=new j).init(L,k||M,e,q,b)!==!1&&(e._pt=P=new co(e._pt,L,H.name,0,1,H.render,H,0,H.priority),H._props.forEach(function(V){z[V]=P}),H.priority&&(O=1)),!j||k)for(D in M)Ro[D]&&(H=Hz(D,M,e,q,L,b))?H.priority&&(O=1):z[D]=P=SD.call(e,L,D,"get",M[D],q,b,0,i.stringFilter);e._op&&e._op[R]&&e.kill(L,e._op[R]),C&&e._pt&&(ed=e,ps.killTweensOf(L,z,e.globalTime(t)),W=!e.parent,ed=0),e._pt&&l&&(mR[U.id]=1)}O&&Kz(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!W,p&&t<=0&&I.render(yl,!0,!0)},zfe=function(e,t,n,i,r,a,o,l){var c=(e._pt&&e._ptCache||(e._ptCache={}))[t],h,f,p,g;if(!c)for(c=e._ptCache[t]=[],p=e._ptLookup,g=e._targets.length;g--;){if(h=p[g][t],h&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==t&&h.fp!==t;)h=h._next;if(!h)return xR=1,e.vars[t]="+=0",bD(e,o),xR=0,l?nE(t+" not eligible for reset"):1;c.push(h)}for(g=c.length;g--;)f=c[g],h=f._pt||f,h.s=(i||i===0)&&!r?i:h.s+(i||0)+a*h.c,h.c=n-h.s,f.e&&(f.e=Ls(n)+aa(f.e)),f.b&&(f.b=h.s+aa(f.b))},Qfe=function(e,t){var n=e[0]?am(e[0]).harness:0,i=n&&n.aliases,r,a,o,l;if(!i)return t;r=WA({},t);for(a in i)if(a in r)for(l=i[a].split(","),o=l.length;o--;)r[l[o]]=r[a];return r},Vfe=function(e,t,n,i){var r=t.ease||i||"power1.inOut",a,o;if(oa(t))o=n[e]||(n[e]=[]),t.forEach(function(l,c){return o.push({t:c/(t.length-1)*100,v:l,e:r})});else for(a in t)o=n[a]||(n[a]=[]),a==="ease"||o.push({t:parseFloat(e),v:t[a],e:r})},Tv=function(e,t,n,i,r){return bs(e)?e.call(t,n,i,r):Tr(e)&&~e.indexOf("random(")?sE(e):e},zz=ED+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Qz={};lo(zz+",id,stagger,delay,duration,paused,scrollTrigger",function(s){return Qz[s]=1});var js=(function(s){oz(e,s);function e(n,i,r,a){var o;typeof i=="number"&&(r.duration=i,i=r,r=null),o=s.call(this,a?i:Sv(i))||this;var l=o.vars,c=l.duration,h=l.delay,f=l.immediateRender,p=l.stagger,g=l.overwrite,y=l.keyframes,x=l.defaults,E=l.scrollTrigger,_=l.yoyoEase,b=i.parent||ps,C=(oa(n)||cz(n)?Dh(n[0]):"length"in i)?[n]:vl(n),I,M,R,D,P,L,O,U;if(o._targets=C.length?xD(C):nE("GSAP target "+n+" not found. https://gsap.com",!ko.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=g,y||p||PS(c)||PS(h)){if(i=o.vars,I=o.timeline=new Ia({data:"nested",defaults:x||{},targets:b&&b.data==="nested"?b.vars.targets:C}),I.kill(),I.parent=I._dp=Eh(o),I._start=0,p||PS(c)||PS(h)){if(D=C.length,O=p&&Iz(p),wu(p))for(P in p)~zz.indexOf(P)&&(U||(U={}),U[P]=p[P]);for(M=0;M<D;M++)R=mT(i,Qz),R.stagger=0,_&&(R.yoyoEase=_),U&&WA(R,U),L=C[M],R.duration=+Tv(c,Eh(o),M,L,C),R.delay=(+Tv(h,Eh(o),M,L,C)||0)-o._delay,!p&&D===1&&R.delay&&(o._delay=h=R.delay,o._start+=h,R.delay=0),I.to(L,R,O?O(M,L,C):0),I._ease=Zn.none;I.duration()?c=h=0:o.timeline=0}else if(y){Sv(zo(I.vars.defaults,{ease:"none"})),I._ease=lm(y.ease||i.ease||"none");var j=0,H,z,q;if(oa(y))y.forEach(function(k){return I.to(C,k,">")}),I.duration();else{R={};for(P in y)P==="ease"||P==="easeEach"||Vfe(P,y[P],R,y.easeEach);for(P in R)for(H=R[P].sort(function(k,W){return k.t-W.t}),j=0,M=0;M<H.length;M++)z=H[M],q={ease:z.e,duration:(z.t-(M?H[M-1].t:0))/100*c},q[P]=z.v,I.to(C,q,j),j+=q.duration;I.duration()<c&&I.to({},{duration:c-I.duration()})}}c||o.duration(c=I.duration())}else o.timeline=0;return g===!0&&!pD&&(ed=Eh(o),ps.killTweensOf(C),ed=0),du(b,Eh(o),r),i.reversed&&o.reverse(),i.paused&&o.paused(!0),(f||!c&&!y&&o._start===qs(b._time)&&oo(f)&&xfe(Eh(o))&&b.data!=="nested")&&(o._tTime=-ki,o.render(Math.max(0,-h)||0)),E&&Sz(Eh(o),E),o}var t=e.prototype;return t.render=function(i,r,a){var o=this._time,l=this._tDur,c=this._dur,h=i<0,f=i>l-ki&&!h?l:i<ki?0:i,p,g,y,x,E,_,b,C,I;if(!c)Sfe(this,i,r,a);else if(f!==this._tTime||!i||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==h||this._lazy){if(p=f,C=this.timeline,this._repeat){if(x=c+this._rDelay,this._repeat<-1&&h)return this.totalTime(x*100+i,r,a);if(p=qs(f%x),f===l?(y=this._repeat,p=c):(E=qs(f/x),y=~~E,y&&y===E?(p=c,y--):p>c&&(p=c)),_=this._yoyo&&y&1,_&&(I=this._yEase,p=c-p),E=$A(this._tTime,x),p===o&&!a&&this._initted&&y===E)return this._tTime=f,this;y!==E&&(C&&this._yEase&&Uz(C,_),this.vars.repeatRefresh&&!_&&!this._lock&&p!==x&&this._initted&&(this._lock=a=1,this.render(qs(x*y),!0).invalidate()._lock=0))}if(!this._initted){if(bz(this,h?i:p,a,r,f))return this._tTime=0,this;if(o!==this._time&&!(a&&this.vars.repeatRefresh&&y!==E))return this;if(c!==this._dur)return this.render(i,r,a)}if(this._tTime=f,this._time=p,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=b=(I||this._ease)(p/c),this._from&&(this.ratio=b=1-b),!o&&f&&!r&&!E&&(No(this,"onStart"),this._tTime!==f))return this;for(g=this._pt;g;)g.r(b,g.d),g=g._next;C&&C.render(i<0?i:C._dur*C._ease(p/this._dur),r,a)||this._startAt&&(this._zTime=i),this._onUpdate&&!r&&(h&&gR(this,i,r,a),No(this,"onUpdate")),this._repeat&&y!==E&&this.vars.onRepeat&&!r&&this.parent&&No(this,"onRepeat"),(f===this._tDur||!f)&&this._tTime===f&&(h&&!this._onUpdate&&gR(this,i,!0,!0),(i||!c)&&(f===this._tDur&&this._ts>0||!f&&this._ts<0)&&gd(this,1),!r&&!(h&&!o)&&(f||o||_)&&(No(this,f===l?"onComplete":"onReverseComplete",!0),this._prom&&!(f<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),s.prototype.invalidate.call(this,i)},t.resetTo=function(i,r,a,o,l){rE||Lo.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),h;return this._initted||bD(this,c),h=this._ease(c/this._dur),zfe(this,i,r,a,o,h,c,l)?this.resetTo(i,r,a,o,1):(SC(this,0),this.parent||xz(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,r){if(r===void 0&&(r="all"),!i&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?av(this):this.scrollTrigger&&this.scrollTrigger.kill(!!Gr),this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(i,r,ed&&ed.vars.overwrite!==!0)._first||av(this),this.parent&&a!==this.timeline.totalDuration()&&JA(this,this._dur*this.timeline._tDur/a,0,1),this}var o=this._targets,l=i?vl(i):o,c=this._ptLookup,h=this._pt,f,p,g,y,x,E,_;if((!r||r==="all")&&vfe(o,l))return r==="all"&&(this._pt=0),av(this);for(f=this._op=this._op||[],r!=="all"&&(Tr(r)&&(x={},lo(r,function(b){return x[b]=1}),r=x),r=Qfe(o,r)),_=o.length;_--;)if(~l.indexOf(o[_])){p=c[_],r==="all"?(f[_]=r,y=p,g={}):(g=f[_]=f[_]||{},y=r);for(x in y)E=p&&p[x],E&&((!("kill"in E.d)||E.d.kill(x)===!0)&&xC(this,E,"_pt"),delete p[x]),g!=="all"&&(g[x]=1)}return this._initted&&!this._pt&&h&&av(this),this},e.to=function(i,r){return new e(i,r,arguments[2])},e.from=function(i,r){return bv(1,arguments)},e.delayedCall=function(i,r,a,o){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:r,onReverseComplete:r,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:o})},e.fromTo=function(i,r,a){return bv(2,arguments)},e.set=function(i,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(i,r)},e.killTweensOf=function(i,r,a){return ps.killTweensOf(i,r,a)},e})(aE);zo(js.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});lo("staggerTo,staggerFrom,staggerFromTo",function(s){js[s]=function(){var e=new Ia,t=yR.call(arguments,0);return t.splice(s==="staggerFromTo"?5:4,0,0),e[s].apply(e,t)}});var TD=function(e,t,n){return e[t]=n},Vz=function(e,t,n){return e[t](n)},jfe=function(e,t,n,i){return e[t](i.fp,n)},qfe=function(e,t,n){return e.setAttribute(t,n)},CD=function(e,t){return bs(e[t])?Vz:mD(e[t])&&e.setAttribute?qfe:TD},jz=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},Kfe=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},qz=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},ID=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},Yfe=function(e,t,n,i){for(var r=this._pt,a;r;)a=r._next,r.p===i&&r.modifier(e,t,n),r=a},Xfe=function(e){for(var t=this._pt,n,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?xC(this,t,"_pt"):t.dep||(n=1),t=i;return!n},Wfe=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},Kz=function(e){for(var t=e._pt,n,i,r,a;t;){for(n=t._next,i=r;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:a)?t._prev._next=t:r=t,(t._next=i)?i._prev=t:a=t,t=n}e._pt=r},co=(function(){function s(t,n,i,r,a,o,l,c,h){this.t=n,this.s=r,this.c=a,this.p=i,this.r=o||jz,this.d=l||this,this.set=c||TD,this.pr=h||0,this._next=t,t&&(t._prev=this)}var e=s.prototype;return e.modifier=function(n,i,r){this.mSet=this.mSet||this.set,this.set=Wfe,this.m=n,this.mt=r,this.tween=i},s})();lo(ED+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(s){return vD[s]=1});Ho.TweenMax=Ho.TweenLite=js;Ho.TimelineLite=Ho.TimelineMax=Ia;ps=new Ia({sortChildren:!1,defaults:XA,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});ko.stringFilter=Nz;var cm=[],cb={},$fe=[],FF=0,Jfe=0,XM=function(e){return(cb[e]||$fe).map(function(t){return t()})},_R=function(){var e=Date.now(),t=[];e-FF>2&&(XM("matchMediaInit"),cm.forEach(function(n){var i=n.queries,r=n.conditions,a,o,l,c;for(o in i)a=hu.matchMedia(i[o]).matches,a&&(l=1),a!==r[o]&&(r[o]=a,c=1);c&&(n.revert(),l&&t.push(n))}),XM("matchMediaRevert"),t.forEach(function(n){return n.onMatch(n,function(i){return n.add(null,i)})}),FF=e,XM("matchMedia"))},Yz=(function(){function s(t,n){this.selector=n&&vR(n),this.data=[],this._r=[],this.isReverted=!1,this.id=Jfe++,t&&this.add(t)}var e=s.prototype;return e.add=function(n,i,r){bs(n)&&(r=i,i=n,n=bs);var a=this,o=function(){var c=is,h=a.selector,f;return c&&c!==a&&c.data.push(a),r&&(a.selector=vR(r)),is=a,f=i.apply(a,arguments),bs(f)&&a._r.push(f),is=c,a.selector=h,a.isReverted=!1,f};return a.last=o,n===bs?o(a,function(l){return a.add(null,l)}):n?a[n]=o:o},e.ignore=function(n){var i=is;is=null,n(this),is=i},e.getTweens=function(){var n=[];return this.data.forEach(function(i){return i instanceof s?n.push.apply(n,i.getTweens()):i instanceof js&&!(i.parent&&i.parent.data==="nested")&&n.push(i)}),n},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(n,i){var r=this;if(n?(function(){for(var o=r.getTweens(),l=r.data.length,c;l--;)c=r.data[l],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(h){return o.splice(o.indexOf(h),1)}));for(o.map(function(h){return{g:h._dur||h._delay||h._sat&&!h._sat.vars.immediateRender?h.globalTime(0):-1/0,t:h}}).sort(function(h,f){return f.g-h.g||-1/0}).forEach(function(h){return h.t.revert(n)}),l=r.data.length;l--;)c=r.data[l],c instanceof Ia?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof js)&&c.revert&&c.revert(n);r._r.forEach(function(h){return h(n,r)}),r.isReverted=!0})():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),i)for(var a=cm.length;a--;)cm[a].id===this.id&&cm.splice(a,1)},e.revert=function(n){this.kill(n||{})},s})(),Zfe=(function(){function s(t){this.contexts=[],this.scope=t,is&&is.data.push(this)}var e=s.prototype;return e.add=function(n,i,r){wu(n)||(n={matches:n});var a=new Yz(0,r||this.scope),o=a.conditions={},l,c,h;is&&!a.selector&&(a.selector=is.selector),this.contexts.push(a),i=a.add("onMatch",i),a.queries=n;for(c in n)c==="all"?h=1:(l=hu.matchMedia(n[c]),l&&(cm.indexOf(a)<0&&cm.push(a),(o[c]=l.matches)&&(h=1),l.addListener?l.addListener(_R):l.addEventListener("change",_R)));return h&&i(a,function(f){return a.add(null,f)}),this},e.revert=function(n){this.kill(n||{})},e.kill=function(n){this.contexts.forEach(function(i){return i.kill(n,!0)})},s})(),AT={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(i){return Lz(i)})},timeline:function(e){return new Ia(e)},getTweensOf:function(e,t){return ps.getTweensOf(e,t)},getProperty:function(e,t,n,i){Tr(e)&&(e=vl(e)[0]);var r=am(e||{}).get,a=n?Ez:vz;return n==="native"&&(n=""),e&&(t?a((Ro[t]&&Ro[t].get||r)(e,t,n,i)):function(o,l,c){return a((Ro[o]&&Ro[o].get||r)(e,o,l,c))})},quickSetter:function(e,t,n){if(e=vl(e),e.length>1){var i=e.map(function(h){return ho.quickSetter(h,t,n)}),r=i.length;return function(h){for(var f=r;f--;)i[f](h)}}e=e[0]||{};var a=Ro[t],o=am(e),l=o.harness&&(o.harness.aliases||{})[t]||t,c=a?function(h){var f=new a;hA._pt=0,f.init(e,n?h+n:h,hA,0,[e]),f.render(1,f),hA._pt&&ID(1,hA)}:o.set(e,l);return a?c:function(h){return c(e,l,n?h+n:h,o,1)}},quickTo:function(e,t,n){var i,r=ho.to(e,zo((i={},i[t]="+=0.1",i.paused=!0,i.stagger=0,i),n||{})),a=function(l,c,h){return r.resetTo(t,l,c,h)};return a.tween=r,a},isTweening:function(e){return ps.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=lm(e.ease,XA.ease)),DF(XA,e||{})},config:function(e){return DF(ko,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,r=e.defaults,a=e.extendTimeline;(i||"").split(",").forEach(function(o){return o&&!Ro[o]&&!Ho[o]&&nE(t+" effect requires "+o+" plugin.")}),jM[t]=function(o,l,c){return n(vl(o),zo(l||{},r),c)},a&&(Ia.prototype[t]=function(o,l,c){return this.add(jM[t](o,wu(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){Zn[e]=lm(t)},parseEase:function(e,t){return arguments.length?lm(e,t):Zn},getById:function(e){return ps.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new Ia(e),i,r;for(n.smoothChildTiming=oo(e.smoothChildTiming),ps.remove(n),n._dp=0,n._time=n._tTime=ps._time,i=ps._first;i;)r=i._next,(t||!(!i._dur&&i instanceof js&&i.vars.onComplete===i._targets[0]))&&du(n,i,i._start-i._delay),i=r;return du(ps,n,0),n},context:function(e,t){return e?new Yz(e,t):is},matchMedia:function(e){return new Zfe(e)},matchMediaRefresh:function(){return cm.forEach(function(e){var t=e.conditions,n,i;for(i in t)t[i]&&(t[i]=!1,n=1);n&&e.revert()})||_R()},addEventListener:function(e,t){var n=cb[e]||(cb[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=cb[e],i=n&&n.indexOf(t);i>=0&&n.splice(i,1)},utils:{wrap:Bfe,wrapYoyo:Dfe,distribute:Iz,random:wz,snap:Mz,normalize:Rfe,getUnit:aa,clamp:Cfe,splitColor:Oz,toArray:vl,selector:vR,mapRange:Bz,pipe:Mfe,unitize:wfe,interpolate:Lfe,shuffle:Cz},install:pz,effects:jM,ticker:Lo,updateRoot:Ia.updateRoot,plugins:Ro,globalTimeline:ps,core:{PropTween:co,globals:mz,Tween:js,Timeline:Ia,Animation:aE,getCache:am,_removeLinkedListItem:xC,reverting:function(){return Gr},context:function(e){return e&&is&&(is.data.push(e),e._ctx=is),is},suppressOverwrites:function(e){return pD=e}}};lo("to,from,fromTo,delayedCall,set,killTweensOf",function(s){return AT[s]=js[s]});Lo.add(Ia.updateRoot);hA=AT.to({},{duration:0});var ede=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},tde=function(e,t){var n=e._targets,i,r,a;for(i in t)for(r=n.length;r--;)a=e._ptLookup[r][i],a&&(a=a.d)&&(a._pt&&(a=ede(a,i)),a&&a.modifier&&a.modifier(t[i],e,n[r],i))},WM=function(e,t){return{name:e,headless:1,rawVars:1,init:function(i,r,a){a._onInit=function(o){var l,c;if(Tr(r)&&(l={},lo(r,function(h){return l[h]=1}),r=l),t){l={};for(c in r)l[c]=t(r[c]);r=l}tde(o,r)}}}},ho=AT.registerPlugin({name:"attr",init:function(e,t,n,i,r){var a,o,l;this.tween=n;for(a in t)l=e.getAttribute(a)||"",o=this.add(e,"setAttribute",(l||0)+"",t[a],i,r,0,0,a),o.op=a,o.b=l,this._props.push(a)},render:function(e,t){for(var n=t._pt;n;)Gr?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",headless:1,init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},WM("roundProps",ER),WM("modifiers"),WM("snap",Mz))||AT;js.version=Ia.version=ho.version="3.13.0";dz=1;gD()&&ZA();Zn.Power0;Zn.Power1;Zn.Power2;Zn.Power3;Zn.Power4;Zn.Linear;Zn.Quad;Zn.Cubic;Zn.Quart;Zn.Quint;Zn.Strong;Zn.Elastic;Zn.Back;Zn.SteppedEase;Zn.Bounce;Zn.Sine;Zn.Expo;Zn.Circ;/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var UF,td,wA,MD,em,kF,wD,nde=function(){return typeof window<"u"},Lh={},Gp=180/Math.PI,RA=Math.PI/180,tA=Math.atan2,GF=1e8,RD=/([A-Z])/g,ide=/(left|right|width|margin|padding|x)/i,sde=/[\s,\(]\S/,vu={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},SR=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},rde=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},ade=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},ode=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},Xz=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Wz=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},lde=function(e,t,n){return e.style[t]=n},cde=function(e,t,n){return e.style.setProperty(t,n)},ude=function(e,t,n){return e._gsap[t]=n},hde=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},fde=function(e,t,n,i,r){var a=e._gsap;a.scaleX=a.scaleY=n,a.renderTransform(r,a)},dde=function(e,t,n,i,r){var a=e._gsap;a[t]=n,a.renderTransform(r,a)},gs="transform",uo=gs+"Origin",pde=function s(e,t){var n=this,i=this.target,r=i.style,a=i._gsap;if(e in Lh&&r){if(this.tfm=this.tfm||{},e!=="transform")e=vu[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return n.tfm[o]=_h(i,o)}):this.tfm[e]=a.x?a[e]:_h(i,e),e===uo&&(this.tfm.zOrigin=a.zOrigin);else return vu.transform.split(",").forEach(function(o){return s.call(n,o,t)});if(this.props.indexOf(gs)>=0)return;a.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(uo,t,"")),e=gs}(r||t)&&this.props.push(e,t,r[e])},$z=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},mde=function(){var e=this.props,t=this.target,n=t.style,i=t._gsap,r,a;for(r=0;r<e.length;r+=3)e[r+1]?e[r+1]===2?t[e[r]](e[r+2]):t[e[r]]=e[r+2]:e[r+2]?n[e[r]]=e[r+2]:n.removeProperty(e[r].substr(0,2)==="--"?e[r]:e[r].replace(RD,"-$1").toLowerCase());if(this.tfm){for(a in this.tfm)i[a]=this.tfm[a];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),r=wD(),(!r||!r.isStart)&&!n[gs]&&($z(n),i.zOrigin&&n[uo]&&(n[uo]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},Jz=function(e,t){var n={target:e,props:[],revert:mde,save:pde};return e._gsap||ho.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(i){return n.save(i)}),n},Zz,bR=function(e,t){var n=td.createElementNS?td.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):td.createElement(e);return n&&n.style?n:td.createElement(e)},El=function s(e,t,n){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(RD,"-$1").toLowerCase())||i.getPropertyValue(t)||!n&&s(e,e0(t)||t,1)||""},HF="O,Moz,ms,Ms,Webkit".split(","),e0=function(e,t,n){var i=t||em,r=i.style,a=5;if(e in r&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);a--&&!(HF[a]+e in r););return a<0?null:(a===3?"ms":a>=0?HF[a]:"")+e},TR=function(){nde()&&window.document&&(UF=window,td=UF.document,wA=td.documentElement,em=bR("div")||{style:{}},bR("div"),gs=e0(gs),uo=gs+"Origin",em.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Zz=!!e0("perspective"),wD=ho.core.reverting,MD=1)},zF=function(e){var t=e.ownerSVGElement,n=bR("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=e.cloneNode(!0),r;i.style.display="block",n.appendChild(i),wA.appendChild(n);try{r=i.getBBox()}catch{}return n.removeChild(i),wA.removeChild(n),r},QF=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},eQ=function(e){var t,n;try{t=e.getBBox()}catch{t=zF(e),n=1}return t&&(t.width||t.height)||n||(t=zF(e)),t&&!t.width&&!t.x&&!t.y?{x:+QF(e,["x","cx","x1"])||0,y:+QF(e,["y","cy","y1"])||0,width:0,height:0}:t},tQ=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&eQ(e))},Am=function(e,t){if(t){var n=e.style,i;t in Lh&&t!==uo&&(t=gs),n.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(i==="--"?t:t.replace(RD,"-$1").toLowerCase())):n.removeAttribute(t)}},nd=function(e,t,n,i,r,a){var o=new co(e._pt,t,n,0,1,a?Wz:Xz);return e._pt=o,o.b=i,o.e=r,e._props.push(n),o},VF={deg:1,rad:1,turn:1},gde={grid:1,flex:1},Ad=function s(e,t,n,i){var r=parseFloat(n)||0,a=(n+"").trim().substr((r+"").length)||"px",o=em.style,l=ide.test(t),c=e.tagName.toLowerCase()==="svg",h=(c?"client":"offset")+(l?"Width":"Height"),f=100,p=i==="px",g=i==="%",y,x,E,_;if(i===a||!r||VF[i]||VF[a])return r;if(a!=="px"&&!p&&(r=s(e,t,n,"px")),_=e.getCTM&&tQ(e),(g||a==="%")&&(Lh[t]||~t.indexOf("adius")))return y=_?e.getBBox()[l?"width":"height"]:e[h],Ls(g?r/y*f:r/100*y);if(o[l?"width":"height"]=f+(p?a:i),x=i!=="rem"&&~t.indexOf("adius")||i==="em"&&e.appendChild&&!c?e:e.parentNode,_&&(x=(e.ownerSVGElement||{}).parentNode),(!x||x===td||!x.appendChild)&&(x=td.body),E=x._gsap,E&&g&&E.width&&l&&E.time===Lo.time&&!E.uncache)return Ls(r/E.width*f);if(g&&(t==="height"||t==="width")){var b=e.style[t];e.style[t]=f+i,y=e[h],b?e.style[t]=b:Am(e,t)}else(g||a==="%")&&!gde[El(x,"display")]&&(o.position=El(e,"position")),x===e&&(o.position="static"),x.appendChild(em),y=em[h],x.removeChild(em),o.position="absolute";return l&&g&&(E=am(x),E.time=Lo.time,E.width=x[h]),Ls(p?y*r/f:y&&r?f/y*r:0)},_h=function(e,t,n,i){var r;return MD||TR(),t in vu&&t!=="transform"&&(t=vu[t],~t.indexOf(",")&&(t=t.split(",")[0])),Lh[t]&&t!=="transform"?(r=lE(e,i),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:vT(El(e,uo))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||i||~(r+"").indexOf("calc("))&&(r=yT[t]&&yT[t](e,t,n)||El(e,t)||Az(e,t)||(t==="opacity"?1:0))),n&&!~(r+"").trim().indexOf(" ")?Ad(e,t,r,n)+n:r},Ade=function(e,t,n,i){if(!n||n==="none"){var r=e0(t,e,1),a=r&&El(e,r,1);a&&a!==n?(t=r,n=a):t==="borderColor"&&(n=El(e,"borderTopColor"))}var o=new co(this._pt,e.style,t,0,1,qz),l=0,c=0,h,f,p,g,y,x,E,_,b,C,I,M;if(o.b=n,o.e=i,n+="",i+="",i.substring(0,6)==="var(--"&&(i=El(e,i.substring(4,i.indexOf(")")))),i==="auto"&&(x=e.style[t],e.style[t]=i,i=El(e,t)||i,x?e.style[t]=x:Am(e,t)),h=[n,i],Nz(h),n=h[0],i=h[1],p=n.match(uA)||[],M=i.match(uA)||[],M.length){for(;f=uA.exec(i);)E=f[0],b=i.substring(l,f.index),y?y=(y+1)%5:(b.substr(-5)==="rgba("||b.substr(-5)==="hsla(")&&(y=1),E!==(x=p[c++]||"")&&(g=parseFloat(x)||0,I=x.substr((g+"").length),E.charAt(1)==="="&&(E=MA(g,E)+I),_=parseFloat(E),C=E.substr((_+"").length),l=uA.lastIndex-C.length,C||(C=C||ko.units[t]||I,l===i.length&&(i+=C,o.e+=C)),I!==C&&(g=Ad(e,t,x,C)||0),o._pt={_next:o._pt,p:b||c===1?b:",",s:g,c:_-g,m:y&&y<4||t==="zIndex"?Math.round:0});o.c=l<i.length?i.substring(l,i.length):""}else o.r=t==="display"&&i==="none"?Wz:Xz;return hz.test(i)&&(o.e=0),this._pt=o,o},jF={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},yde=function(e){var t=e.split(" "),n=t[0],i=t[1]||"50%";return(n==="top"||n==="bottom"||i==="left"||i==="right")&&(e=n,n=i,i=e),t[0]=jF[n]||n,t[1]=jF[i]||i,t.join(" ")},vde=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,i=n.style,r=t.u,a=n._gsap,o,l,c;if(r==="all"||r===!0)i.cssText="",l=1;else for(r=r.split(","),c=r.length;--c>-1;)o=r[c],Lh[o]&&(l=1,o=o==="transformOrigin"?uo:gs),Am(n,o);l&&(Am(n,gs),a&&(a.svg&&n.removeAttribute("transform"),i.scale=i.rotate=i.translate="none",lE(n,1),a.uncache=1,$z(i)))}},yT={clearProps:function(e,t,n,i,r){if(r.data!=="isFromStart"){var a=e._pt=new co(e._pt,t,n,0,0,vde);return a.u=i,a.pr=-10,a.tween=r,e._props.push(n),1}}},oE=[1,0,0,1,0,0],nQ={},iQ=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},qF=function(e){var t=El(e,gs);return iQ(t)?oE:t.substr(7).match(uz).map(Ls)},BD=function(e,t){var n=e._gsap||am(e),i=e.style,r=qF(e),a,o,l,c;return n.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,r=[l.a,l.b,l.c,l.d,l.e,l.f],r.join(",")==="1,0,0,1,0,0"?oE:r):(r===oE&&!e.offsetParent&&e!==wA&&!n.svg&&(l=i.display,i.display="block",a=e.parentNode,(!a||!e.offsetParent&&!e.getBoundingClientRect().width)&&(c=1,o=e.nextElementSibling,wA.appendChild(e)),r=qF(e),l?i.display=l:Am(e,"display"),c&&(o?a.insertBefore(e,o):a?a.appendChild(e):wA.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},CR=function(e,t,n,i,r,a){var o=e._gsap,l=r||BD(e,!0),c=o.xOrigin||0,h=o.yOrigin||0,f=o.xOffset||0,p=o.yOffset||0,g=l[0],y=l[1],x=l[2],E=l[3],_=l[4],b=l[5],C=t.split(" "),I=parseFloat(C[0])||0,M=parseFloat(C[1])||0,R,D,P,L;n?l!==oE&&(D=g*E-y*x)&&(P=I*(E/D)+M*(-x/D)+(x*b-E*_)/D,L=I*(-y/D)+M*(g/D)-(g*b-y*_)/D,I=P,M=L):(R=eQ(e),I=R.x+(~C[0].indexOf("%")?I/100*R.width:I),M=R.y+(~(C[1]||C[0]).indexOf("%")?M/100*R.height:M)),i||i!==!1&&o.smooth?(_=I-c,b=M-h,o.xOffset=f+(_*g+b*x)-_,o.yOffset=p+(_*y+b*E)-b):o.xOffset=o.yOffset=0,o.xOrigin=I,o.yOrigin=M,o.smooth=!!i,o.origin=t,o.originIsAbsolute=!!n,e.style[uo]="0px 0px",a&&(nd(a,o,"xOrigin",c,I),nd(a,o,"yOrigin",h,M),nd(a,o,"xOffset",f,o.xOffset),nd(a,o,"yOffset",p,o.yOffset)),e.setAttribute("data-svg-origin",I+" "+M)},lE=function(e,t){var n=e._gsap||new Gz(e);if("x"in n&&!t&&!n.uncache)return n;var i=e.style,r=n.scaleX<0,a="px",o="deg",l=getComputedStyle(e),c=El(e,uo)||"0",h,f,p,g,y,x,E,_,b,C,I,M,R,D,P,L,O,U,j,H,z,q,k,W,V,X,K,te,oe,Ee,Ce,se;return h=f=p=x=E=_=b=C=I=0,g=y=1,n.svg=!!(e.getCTM&&tQ(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(i[gs]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[gs]!=="none"?l[gs]:"")),i.scale=i.rotate=i.translate="none"),D=BD(e,n.svg),n.svg&&(n.uncache?(V=e.getBBox(),c=n.xOrigin-V.x+"px "+(n.yOrigin-V.y)+"px",W=""):W=!t&&e.getAttribute("data-svg-origin"),CR(e,W||c,!!W||n.originIsAbsolute,n.smooth!==!1,D)),M=n.xOrigin||0,R=n.yOrigin||0,D!==oE&&(U=D[0],j=D[1],H=D[2],z=D[3],h=q=D[4],f=k=D[5],D.length===6?(g=Math.sqrt(U*U+j*j),y=Math.sqrt(z*z+H*H),x=U||j?tA(j,U)*Gp:0,b=H||z?tA(H,z)*Gp+x:0,b&&(y*=Math.abs(Math.cos(b*RA))),n.svg&&(h-=M-(M*U+R*H),f-=R-(M*j+R*z))):(se=D[6],Ee=D[7],K=D[8],te=D[9],oe=D[10],Ce=D[11],h=D[12],f=D[13],p=D[14],P=tA(se,oe),E=P*Gp,P&&(L=Math.cos(-P),O=Math.sin(-P),W=q*L+K*O,V=k*L+te*O,X=se*L+oe*O,K=q*-O+K*L,te=k*-O+te*L,oe=se*-O+oe*L,Ce=Ee*-O+Ce*L,q=W,k=V,se=X),P=tA(-H,oe),_=P*Gp,P&&(L=Math.cos(-P),O=Math.sin(-P),W=U*L-K*O,V=j*L-te*O,X=H*L-oe*O,Ce=z*O+Ce*L,U=W,j=V,H=X),P=tA(j,U),x=P*Gp,P&&(L=Math.cos(P),O=Math.sin(P),W=U*L+j*O,V=q*L+k*O,j=j*L-U*O,k=k*L-q*O,U=W,q=V),E&&Math.abs(E)+Math.abs(x)>359.9&&(E=x=0,_=180-_),g=Ls(Math.sqrt(U*U+j*j+H*H)),y=Ls(Math.sqrt(k*k+se*se)),P=tA(q,k),b=Math.abs(P)>2e-4?P*Gp:0,I=Ce?1/(Ce<0?-Ce:Ce):0),n.svg&&(W=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!iQ(El(e,gs)),W&&e.setAttribute("transform",W))),Math.abs(b)>90&&Math.abs(b)<270&&(r?(g*=-1,b+=x<=0?180:-180,x+=x<=0?180:-180):(y*=-1,b+=b<=0?180:-180)),t=t||n.uncache,n.x=h-((n.xPercent=h&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-h)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+a,n.y=f-((n.yPercent=f&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-f)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+a,n.z=p+a,n.scaleX=Ls(g),n.scaleY=Ls(y),n.rotation=Ls(x)+o,n.rotationX=Ls(E)+o,n.rotationY=Ls(_)+o,n.skewX=b+o,n.skewY=C+o,n.transformPerspective=I+a,(n.zOrigin=parseFloat(c.split(" ")[2])||!t&&n.zOrigin||0)&&(i[uo]=vT(c)),n.xOffset=n.yOffset=0,n.force3D=ko.force3D,n.renderTransform=n.svg?xde:Zz?sQ:Ede,n.uncache=0,n},vT=function(e){return(e=e.split(" "))[0]+" "+e[1]},$M=function(e,t,n){var i=aa(t);return Ls(parseFloat(t)+parseFloat(Ad(e,"x",n+"px",i)))+i},Ede=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,sQ(e,t)},Pp="0deg",tv="0px",Np=") ",sQ=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,a=n.x,o=n.y,l=n.z,c=n.rotation,h=n.rotationY,f=n.rotationX,p=n.skewX,g=n.skewY,y=n.scaleX,x=n.scaleY,E=n.transformPerspective,_=n.force3D,b=n.target,C=n.zOrigin,I="",M=_==="auto"&&e&&e!==1||_===!0;if(C&&(f!==Pp||h!==Pp)){var R=parseFloat(h)*RA,D=Math.sin(R),P=Math.cos(R),L;R=parseFloat(f)*RA,L=Math.cos(R),a=$M(b,a,D*L*-C),o=$M(b,o,-Math.sin(R)*-C),l=$M(b,l,P*L*-C+C)}E!==tv&&(I+="perspective("+E+Np),(i||r)&&(I+="translate("+i+"%, "+r+"%) "),(M||a!==tv||o!==tv||l!==tv)&&(I+=l!==tv||M?"translate3d("+a+", "+o+", "+l+") ":"translate("+a+", "+o+Np),c!==Pp&&(I+="rotate("+c+Np),h!==Pp&&(I+="rotateY("+h+Np),f!==Pp&&(I+="rotateX("+f+Np),(p!==Pp||g!==Pp)&&(I+="skew("+p+", "+g+Np),(y!==1||x!==1)&&(I+="scale("+y+", "+x+Np),b.style[gs]=I||"translate(0, 0)"},xde=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,a=n.x,o=n.y,l=n.rotation,c=n.skewX,h=n.skewY,f=n.scaleX,p=n.scaleY,g=n.target,y=n.xOrigin,x=n.yOrigin,E=n.xOffset,_=n.yOffset,b=n.forceCSS,C=parseFloat(a),I=parseFloat(o),M,R,D,P,L;l=parseFloat(l),c=parseFloat(c),h=parseFloat(h),h&&(h=parseFloat(h),c+=h,l+=h),l||c?(l*=RA,c*=RA,M=Math.cos(l)*f,R=Math.sin(l)*f,D=Math.sin(l-c)*-p,P=Math.cos(l-c)*p,c&&(h*=RA,L=Math.tan(c-h),L=Math.sqrt(1+L*L),D*=L,P*=L,h&&(L=Math.tan(h),L=Math.sqrt(1+L*L),M*=L,R*=L)),M=Ls(M),R=Ls(R),D=Ls(D),P=Ls(P)):(M=f,P=p,R=D=0),(C&&!~(a+"").indexOf("px")||I&&!~(o+"").indexOf("px"))&&(C=Ad(g,"x",a,"px"),I=Ad(g,"y",o,"px")),(y||x||E||_)&&(C=Ls(C+y-(y*M+x*D)+E),I=Ls(I+x-(y*R+x*P)+_)),(i||r)&&(L=g.getBBox(),C=Ls(C+i/100*L.width),I=Ls(I+r/100*L.height)),L="matrix("+M+","+R+","+D+","+P+","+C+","+I+")",g.setAttribute("transform",L),b&&(g.style[gs]=L)},_de=function(e,t,n,i,r){var a=360,o=Tr(r),l=parseFloat(r)*(o&&~r.indexOf("rad")?Gp:1),c=l-i,h=i+c+"deg",f,p;return o&&(f=r.split("_")[1],f==="short"&&(c%=a,c!==c%(a/2)&&(c+=c<0?a:-a)),f==="cw"&&c<0?c=(c+a*GF)%a-~~(c/a)*a:f==="ccw"&&c>0&&(c=(c-a*GF)%a-~~(c/a)*a)),e._pt=p=new co(e._pt,t,n,i,c,rde),p.e=h,p.u="deg",e._props.push(n),p},KF=function(e,t){for(var n in t)e[n]=t[n];return e},Sde=function(e,t,n){var i=KF({},n._gsap),r="perspective,force3D,transformOrigin,svgOrigin",a=n.style,o,l,c,h,f,p,g,y;i.svg?(c=n.getAttribute("transform"),n.setAttribute("transform",""),a[gs]=t,o=lE(n,1),Am(n,gs),n.setAttribute("transform",c)):(c=getComputedStyle(n)[gs],a[gs]=t,o=lE(n,1),a[gs]=c);for(l in Lh)c=i[l],h=o[l],c!==h&&r.indexOf(l)<0&&(g=aa(c),y=aa(h),f=g!==y?Ad(n,l,c,y):parseFloat(c),p=parseFloat(h),e._pt=new co(e._pt,o,l,f,p-f,SR),e._pt.u=y||0,e._props.push(l));KF(o,i)};lo("padding,margin,Width,Radius",function(s,e){var t="Top",n="Right",i="Bottom",r="Left",a=(e<3?[t,n,i,r]:[t+r,t+n,i+n,i+r]).map(function(o){return e<2?s+o:"border"+o+s});yT[e>1?"border"+s:s]=function(o,l,c,h,f){var p,g;if(arguments.length<4)return p=a.map(function(y){return _h(o,y,c)}),g=p.join(" "),g.split(p[0]).length===5?p[0]:g;p=(h+"").split(" "),g={},a.forEach(function(y,x){return g[y]=p[x]=p[x]||p[(x-1)/2|0]}),o.init(l,g,f)}});var rQ={name:"css",register:TR,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,r){var a=this._props,o=e.style,l=n.vars.startAt,c,h,f,p,g,y,x,E,_,b,C,I,M,R,D,P;MD||TR(),this.styles=this.styles||Jz(e),P=this.styles.props,this.tween=n;for(x in t)if(x!=="autoRound"&&(h=t[x],!(Ro[x]&&Hz(x,t,n,i,e,r)))){if(g=typeof h,y=yT[x],g==="function"&&(h=h.call(n,i,e,r),g=typeof h),g==="string"&&~h.indexOf("random(")&&(h=sE(h)),y)y(this,e,x,h,n)&&(D=1);else if(x.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(x)+"").trim(),h+="",ad.lastIndex=0,ad.test(c)||(E=aa(c),_=aa(h)),_?E!==_&&(c=Ad(e,x,c,_)+_):E&&(h+=E),this.add(o,"setProperty",c,h,i,r,0,0,x),a.push(x),P.push(x,0,o[x]);else if(g!=="undefined"){if(l&&x in l?(c=typeof l[x]=="function"?l[x].call(n,i,e,r):l[x],Tr(c)&&~c.indexOf("random(")&&(c=sE(c)),aa(c+"")||c==="auto"||(c+=ko.units[x]||aa(_h(e,x))||""),(c+"").charAt(1)==="="&&(c=_h(e,x))):c=_h(e,x),p=parseFloat(c),b=g==="string"&&h.charAt(1)==="="&&h.substr(0,2),b&&(h=h.substr(2)),f=parseFloat(h),x in vu&&(x==="autoAlpha"&&(p===1&&_h(e,"visibility")==="hidden"&&f&&(p=0),P.push("visibility",0,o.visibility),nd(this,o,"visibility",p?"inherit":"hidden",f?"inherit":"hidden",!f)),x!=="scale"&&x!=="transform"&&(x=vu[x],~x.indexOf(",")&&(x=x.split(",")[0]))),C=x in Lh,C){if(this.styles.save(x),g==="string"&&h.substring(0,6)==="var(--"&&(h=El(e,h.substring(4,h.indexOf(")"))),f=parseFloat(h)),I||(M=e._gsap,M.renderTransform&&!t.parseTransform||lE(e,t.parseTransform),R=t.smoothOrigin!==!1&&M.smooth,I=this._pt=new co(this._pt,o,gs,0,1,M.renderTransform,M,0,-1),I.dep=1),x==="scale")this._pt=new co(this._pt,M,"scaleY",M.scaleY,(b?MA(M.scaleY,b+f):f)-M.scaleY||0,SR),this._pt.u=0,a.push("scaleY",x),x+="X";else if(x==="transformOrigin"){P.push(uo,0,o[uo]),h=yde(h),M.svg?CR(e,h,0,R,0,this):(_=parseFloat(h.split(" ")[2])||0,_!==M.zOrigin&&nd(this,M,"zOrigin",M.zOrigin,_),nd(this,o,x,vT(c),vT(h)));continue}else if(x==="svgOrigin"){CR(e,h,1,R,0,this);continue}else if(x in nQ){_de(this,M,x,p,b?MA(p,b+h):h);continue}else if(x==="smoothOrigin"){nd(this,M,"smooth",M.smooth,h);continue}else if(x==="force3D"){M[x]=h;continue}else if(x==="transform"){Sde(this,h,e);continue}}else x in o||(x=e0(x)||x);if(C||(f||f===0)&&(p||p===0)&&!sde.test(h)&&x in o)E=(c+"").substr((p+"").length),f||(f=0),_=aa(h)||(x in ko.units?ko.units[x]:E),E!==_&&(p=Ad(e,x,c,_)),this._pt=new co(this._pt,C?M:o,x,p,(b?MA(p,b+f):f)-p,!C&&(_==="px"||x==="zIndex")&&t.autoRound!==!1?ode:SR),this._pt.u=_||0,E!==_&&_!=="%"&&(this._pt.b=c,this._pt.r=ade);else if(x in o)Ade.call(this,e,x,c,b?b+h:h);else if(x in e)this.add(e,x,c||e[x],b?b+h:h,i,r);else if(x!=="parseTransform"){yD(x,h);continue}C||(x in o?P.push(x,0,o[x]):typeof e[x]=="function"?P.push(x,2,e[x]()):P.push(x,1,c||e[x])),a.push(x)}}D&&Kz(this)},render:function(e,t){if(t.tween._time||!wD())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:_h,aliases:vu,getSetter:function(e,t,n){var i=vu[t];return i&&i.indexOf(",")<0&&(t=i),t in Lh&&t!==uo&&(e._gsap.x||_h(e,"x"))?n&&kF===n?t==="scale"?hde:ude:(kF=n||{})&&(t==="scale"?fde:dde):e.style&&!mD(e.style[t])?lde:~t.indexOf("-")?cde:CD(e,t)},core:{_removeProperty:Am,_getMatrix:BD}};ho.utils.checkPrefix=e0;ho.core.getStyleSaver=Jz;(function(s,e,t,n){var i=lo(s+","+e+","+t,function(r){Lh[r]=1});lo(e,function(r){ko.units[r]="deg",nQ[r]=1}),vu[i[13]]=s+","+e,lo(n,function(r){var a=r.split(":");vu[a[1]]=i[a[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");lo("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(s){ko.units[s]="px"});ho.registerPlugin(rQ);var aQ=ho.registerPlugin(rQ)||ho;aQ.core.Tween;const bde=`
uniform float iTime;
uniform vec2 iResolution;
uniform vec2 iMouse;

varying vec2 vUv;

void main(){
    vec3 p=position;
    gl_Position=projectionMatrix*modelViewMatrix*vec4(p,1.);
    
    vUv=uv;
}
`,Tde=`
uniform float iTime;
uniform vec2 iResolution;
uniform vec2 iMouse;

uniform sampler2D tDiffuse;

varying vec2 vUv;

void main(){
    vec2 p=vUv;
    vec4 color=texture(tDiffuse,p);
    gl_FragColor=color;
}
`;class Cde extends Sd{composer;customPass;uniformInjector;constructor(e,t={}){super(e);const{vertexShader:n=bde,fragmentShader:i=Tde,uniforms:r={}}=t,a=new Bte(e.renderer);this.composer=a;const o=new Ote(e.scene,e.camera);a.addPass(o);const l=new qhe(e);this.uniformInjector=l;const c=new jw({vertexShader:n,fragmentShader:i,uniforms:{tDiffuse:{value:null},...l.shadertoyUniforms,...r}});this.customPass=c,c.renderToScreen=!0,a.addPass(c)}addExisting(){this.base.composer=this.composer}update(e){const t=this.customPass.uniforms;this.uniformInjector.injectShadertoyUniforms(t)}}class Ide extends Sd{isDragging;isCursorChanged;enabled;constructor(e,t={}){super(e);const{isCursorChanged:n=!0}=t;this.isCursorChanged=n,this.isDragging=!1,this.enabled=!0}detectDrag(){const e=sz(),t={Mobile:"touchstart",Desktop:"mousedown"}[e],n={Mobile:"touchend",Desktop:"mouseup"}[e],i={Mobile:"touchmove",Desktop:"mousemove"}[e];this.changeCursorGrab(),window.addEventListener(t,()=>{if(!this.enabled){this.endDrag();return}this.isDragging=!0,this.changeCursorGrabbing(),this.emit("dragstart")}),window.addEventListener(n,()=>{if(!this.enabled){this.endDrag();return}this.isDragging=!1,this.changeCursorGrab(),this.emit("dragend")}),window.addEventListener(i,()=>{if(!this.enabled){this.endDrag();return}this.isDragging&&this.emit("drag",this.base.iMouse.mouseDOMDelta)})}enable(){this.enabled=!0}disable(){this.enabled=!1}changeCursorGrab(){const e=this.base.renderer.domElement;this.isCursorChanged&&(e.style.cursor="grab")}changeCursorGrabbing(){const e=this.base.renderer.domElement;this.isCursorChanged&&(e.style.cursor="grabbing")}resetCursor(){const e=this.base.renderer.domElement;e.style.cursor="auto"}endDrag(){this.isDragging=!1,this.resetCursor()}}class Mde{scroll;enabled;constructor(){this.scroll={current:0,target:0,ease:.05,last:0,delta:0,direction:""},this.enabled=!0}enable(){this.enabled=!0}disable(){this.enabled=!1}listenForScroll(){window.addEventListener("wheel",e=>{if(!this.enabled)return;const n=e.deltaY;this.scroll.target+=n})}syncScroll(){this.scroll.current=Fr.lerp(this.scroll.current,this.scroll.target,this.scroll.ease),this.scroll.delta=this.scroll.current-this.scroll.last,this.scroll.direction=this.scroll.delta>0?"down":"up",this.scroll.last=this.scroll.current}}function wde({bgColor:s="#0c0c0c",title:e="RING",subtitle:t="Just drag and scroll~",onComplete:n}){const i=ee.useRef(null),r=ee.useRef(null),a=ee.useRef(null),o=ee.useMemo(()=>`ring-sketch-${Math.random().toString(36).slice(2,9)}`,[]);return ee.useEffect(()=>{let l;const c=`
uniform float iTime;
uniform vec2 iResolution;
uniform vec2 iMouse;
uniform sampler2D tDiffuse;
varying vec2 vUv;
uniform vec3 uBgColor;
uniform float uRGBShiftIntensity;
uniform float uGrainIntensity;
uniform float uVignetteIntensity;
uniform float uTransitionProgress;
highp float random(vec2 co){ highp float a=12.9898; highp float b=78.233; highp float c=43758.5453; highp float dt=dot(co.xy,vec2(a,b)); highp float sn=mod(dt,3.14); return fract(sin(sn)*c); }
vec3 grain(vec2 uv,vec3 col,float amount){ float noise=random(uv+iTime); col+=(noise-.5)*amount; return col; }
vec4 RGBShift(sampler2D tex,vec2 uv,float amount){ vec2 rUv=uv; vec2 gUv=uv; vec2 bUv=uv; float noise=random(uv+iTime)*.5+.5; vec2 offset=amount*vec2(cos(noise),sin(noise)); rUv+=offset; gUv+=offset*.5; bUv+=offset*.25; vec4 rTex=texture(tex,rUv); vec4 gTex=texture(tex,gUv); vec4 bTex=texture(tex,bUv); vec4 col=vec4(rTex.r,gTex.g,bTex.b,gTex.a); return col; }
vec3 vignette(vec2 uv,vec3 col,vec3 vigColor,float amount){ vec2 p=uv; p-=.5; float d=length(p); float mask=smoothstep(.5,.3,d); mask=pow(mask,.6); float mixFactor=(1.-mask)*amount; col=mix(col,vigColor,mixFactor); return col; }
float sdCircle(vec2 p,float r){ return length(p)-r; }
vec3 transition(vec2 uv,vec3 col,float progress){ float ratio=iResolution.x/iResolution.y; vec2 p=uv; p-=.5; p.x*=ratio; float d=sdCircle(p,progress*sqrt(2.2)); float c=smoothstep(-.2,0.,d); col=mix(vec3(1.),col,1.-c); return col; }
void main(){ vec2 uv=vUv; vec4 tex=RGBShift(tDiffuse,uv,uRGBShiftIntensity); vec3 col=tex.xyz; col=grain(uv,col,uGrainIntensity); col=vignette(uv,col,uBgColor,uVignetteIntensity); col=transition(uv,col,uTransitionProgress); gl_FragColor=vec4(col,1.); }
`;class h extends cfe{create(){const g={bgColor:s},y={transitionProgress:0,enterProgress:0,rotateSpeed:15};this.renderer.setClearColor(new Tt(g.bgColor),1),this.camera.position.set(0,0,16);const x=M=>M*(M+1)/2,E=M=>M%2===1,_=3,b=12,C=Array.from({length:b*x(_)},(M,R)=>({name:`tex${R+1}`,type:"texture",path:`https://picsum.photos/id/${R+1}/320/400`})),I=new Vhe(this,C);I.on("ready",()=>{try{const z=r.current;z&&(z.style.opacity="0",setTimeout(()=>{try{z.style.pointerEvents="none"}catch{}},350))}catch{}const M=new io,R=6.4,D=.8,P=[],L=[];for(let z=0;z<_;z++){const q=x(z)*b,k=x(z+1)*b,W=Object.values(I.items).slice(q,k),V=new so;this.scene.add(V),P.push(V),W.forEach((X,K)=>{const te=new so;V.add(te),L.push(te);const oe=.005*D*(z*.36+1),Ee=X.image.width*oe,Ce=X.image.height*oe,se=new xd(Ee,Ce),ie=M.clone();ie.map=X,ie.needsUpdate=!0;const ne=new bi(se,ie),re=R*(z+1),Ge=K/(k-q)*Math.PI*2;ne.position.x=re,ne.rotation.z=-Math.PI/2,te.rotation.z=Ge,te.add(ne)})}const O=new Cde(this,{fragmentShader:c,uniforms:{uBgColor:{value:new Tt(g.bgColor)},uRGBShiftIntensity:{value:.0025},uGrainIntensity:{value:.025},uVignetteIntensity:{value:.8},uTransitionProgress:{value:0}}});O.addExisting(),this.ce=O;const U=new Mde;U.listenForScroll();const j=new Ide(this);j.detectDrag(),j.on("drag",z=>{U.scroll.target-=(z.x||z.y)*2}),this.update(()=>{U.syncScroll(),P.forEach((z,q)=>{z.rotation.z+=.0025*(E(q)?-1:1)*(1+U.scroll.delta)*y.rotateSpeed}),L.forEach(z=>{z.position.z=-Fr.lerp(0,100,Fr.mapLinear(U.scroll.delta,0,1e3,0,1))+Fr.lerp(10,0,y.enterProgress)}),O.customPass.material.uniforms.uTransitionProgress.value=y.transitionProgress}),aQ.timeline().to(y,{transitionProgress:1,duration:1,ease:"power1.inOut"}).fromTo(y,{enterProgress:0,rotateSpeed:10},{enterProgress:1,rotateSpeed:1,duration:1.5,ease:"power1.inOut"},"-=1").to(a.current,{opacity:1,duration:1,onComplete:()=>n?.()},"-=1")})}}const f=new h(`#${o}`);return f.create(),l=()=>{try{f.dispose?.()}catch{}},()=>{l?.()}},[s,e,t,n]),G.jsxs("div",{ref:i,style:{position:"relative",width:"100%",height:"100%",background:"black",overflow:"hidden"},children:[G.jsx("div",{id:o,style:{position:"absolute",inset:0}}),G.jsx("div",{ref:r,className:"loader-screen",style:{position:"fixed",inset:0,background:"white",transition:"opacity .3s ease",zIndex:2}}),G.jsx("div",{ref:a,className:"hero-dom",style:{position:"absolute",inset:0,opacity:0,zIndex:1,display:"grid",placeItems:"center",pointerEvents:"none"},children:G.jsxs("div",{style:{display:"grid",gap:8,textAlign:"center"},children:[G.jsx("div",{style:{fontSize:"72px",color:"#fff",letterSpacing:"0.05em"},children:e}),G.jsx("div",{style:{fontSize:"18px",color:"#8a8a8a"},children:t})]})})]})}function Rde(){return G.jsx("main",{style:{width:"100vw",height:"100vh"},children:G.jsx(wde,{})})}function Bde(){return ee.useEffect(()=>{const s=document.getElementById("y");s&&(s.textContent=String(new Date().getFullYear()));function e(){const E=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),_=getComputedStyle(document.documentElement).getPropertyValue("--bg");document.body.style.background=_,document.body.style.backgroundSize="100% "+E+"px",document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundAttachment="local"}const t=()=>e();window.addEventListener("load",t),window.addEventListener("resize",e);const n=window.setTimeout(e,100),i=new ResizeObserver(()=>e());try{i.observe(document.documentElement)}catch{}const r=new MutationObserver(()=>{window.requestAnimationFrame(e)});try{r.observe(document.body,{childList:!0,subtree:!0})}catch{}const a=document.querySelector(".scroll-indicator");let o=!1;function l(){!o&&window.scrollY>80&&a&&(a.style.opacity="0",a.style.transition="opacity .4s ease",o=!0,window.removeEventListener("scroll",l))}window.addEventListener("scroll",l,{passive:!0});const c=document.getElementById("parallax-phone");let h=!1;const f={rx:10,ry:-15};function p(E,_,b){return Math.max(_,Math.min(b,E))}function g(){h||(h=!0,requestAnimationFrame(()=>{const E=window.scrollY||0,_=p(E*-8e-4,-.6,0);c&&(c.style.transform=`rotateX(${f.rx}deg) rotateY(${f.ry}deg) translateY(${_*100}px)`),h=!1}))}window.addEventListener("scroll",g,{passive:!0});const y=E=>{const b=E.currentTarget.getAttribute("href");b&&b.startsWith("#")&&b.length>1&&(E.preventDefault(),document.querySelector(b)?.scrollIntoView({behavior:"smooth",block:"start"}))},x=Array.from(document.querySelectorAll('a[href^="#"]'));return x.forEach(E=>E.addEventListener("click",y)),()=>{window.removeEventListener("load",t),window.removeEventListener("resize",e),window.clearTimeout(n),window.removeEventListener("scroll",l),window.removeEventListener("scroll",g);try{i.disconnect()}catch{}try{r.disconnect()}catch{}x.forEach(E=>E.removeEventListener("click",y))}},[]),G.jsxs(m5,{children:[G.jsx(T5,{}),G.jsxs(j8,{children:[G.jsx(ia,{path:"/",element:G.jsx(Oq,{})}),G.jsx(ia,{path:"/motion",element:G.jsx(Rie,{})}),G.jsx(ia,{path:"/vod",element:G.jsx(Bie,{})}),G.jsx(ia,{path:"/all",element:G.jsx(Oie,{})}),G.jsx(ia,{path:"/allinfinite",element:G.jsx(kie,{})}),G.jsx(ia,{path:"/strip",element:G.jsx(Vie,{})}),G.jsx(ia,{path:"/theater",element:G.jsx(jie,{})}),G.jsx(ia,{path:"/fusion",element:G.jsx(Yie,{})}),G.jsx(ia,{path:"/fieldshare",element:G.jsx(Voe,{})}),G.jsx(ia,{path:"/share/receive",element:G.jsx(Koe,{})}),G.jsx(ia,{path:"/share/videoshare",element:G.jsx(Yoe,{})}),G.jsx(ia,{path:"/share/imageshare",element:G.jsx(Woe,{})}),G.jsx(ia,{path:"/test/shader",element:G.jsx($oe,{})}),G.jsx(ia,{path:"/test/tread",element:G.jsx(Joe,{})}),G.jsx(ia,{path:"/test/loader",element:G.jsx(Rde,{})})]}),G.jsx(C5,{}),G.jsx("div",{className:"scroll-indicator","aria-hidden":"true"})]})}t8.createRoot(document.getElementById("root")).render(G.jsx(ee.StrictMode,{children:G.jsx(Bde,{})}));
